<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Обращение доказательств: курс метаанализа</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&amp;family=Source+Sans+Pro:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
<style>
    :root {
      --navy: #1E2761;
      --deep-navy: #141B3D;
      --gold: #D4AF37;
      --cream: #FAF8F5;
      --light-cream: #FFFFFF;
      --text: #2D3748;
      --light-text: #718096;
      --red: #C53030;
      --green: #22c55e;
      --transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
      font-family: 'Source Sans Pro', sans-serif;
      background: var(--deep-navy);
      color: var(--cream);
    }

    /* ====== COURSE SHELL ====== */
    .course-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* ====== SIDEBAR NAV ====== */
    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, var(--deep-navy) 0%, #0a0f1a 100%);
      border-right: 1px solid rgba(212,175,55,0.2);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .sidebar-header h1 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.25rem;
    }

    .sidebar-header p {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
    }

    .module-list {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
    }

    .module-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .module-item:hover {
      background: rgba(212,175,55,0.1);
    }

    .module-item.active {
      background: rgba(212,175,55,0.15);
      border-left-color: var(--gold);
    }

    .module-item.completed .module-number {
      background: var(--green);
      color: white;
    }

    .module-number {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .module-item.active .module-number {
      background: var(--gold);
      color: var(--navy);
    }

    .module-info {
      flex: 1;
      min-width: 0;
    }

    .module-title {
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .module-subtitle {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.7); /* Increased for WCAG AA contrast */
    }

    .sidebar-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(212,175,55,0.2);
      font-size: 0.75rem;
      color: rgba(255,255,255,0.4);
    }

    /* ====== MAIN CONTENT ====== */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .content-header {
      padding: 1rem 2rem;
      background: rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(212,175,55,0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .breadcrumb {
      font-size: 0.85rem;
      color: rgba(255,255,255,0.6);
    }

    .breadcrumb span {
      color: var(--gold);
    }

    .header-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      background: rgba(212,175,55,0.2);
      border-color: var(--gold);
    }

    .btn.primary {
      background: var(--gold);
      color: var(--navy);
      border-color: var(--gold);
      font-weight: 600;
    }

    .content-body {
      flex: 1;
      overflow: hidden;
      display: flex;
    }

    /* ====== SLIDES AREA ====== */
    .slides-container {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .module-slides {
      display: none;
      width: 100%;
      height: 100%;
    }

    .module-slides.active {
      display: block;
    }

    .slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start; /* Changed from center - prevents content clipping */
      align-items: center;
      padding: 2rem 2rem 5rem 2rem; /* Extra bottom clearance for nav bar */
      padding-top: 3rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition), visibility var(--transition);
      overflow-y: auto; /* Allow scrolling if content is tall */
      overflow-x: hidden;
    }

    /* Center content vertically only when there's enough space */
    .slide .content,
    .slide .refrain,
    .slide .title {
      margin-top: auto;
      margin-bottom: auto;
    }

    /* Ensure content doesn't overflow horizontally */
    .slide > * {
      max-width: 100%;
      word-wrap: break-word;
    }

    .slide.active {
      opacity: 1;
      visibility: visible;
    }

    .slide.dark { background: var(--deep-navy); color: var(--cream); }
    .slide.light { background: var(--cream); color: var(--text); }
    .slide.black { background: #000; color: var(--cream); }

    /* Typography */
    .serif { font-family: 'Cormorant Garamond', Georgia, serif; }

    .title {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 700;
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .title.navy { color: var(--navy); }
    .title.gold { color: var(--gold); }
    .title.cream { color: var(--cream); }

    .subtitle {
      font-size: clamp(1rem, 2vw, 1.5rem);
      color: var(--light-text);
      margin-bottom: 2rem;
    }

    .slide.dark .subtitle { color: rgba(255,255,255,0.7); }

    .big-number {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(4rem, 15vw, 10rem);
      font-weight: 700;
      line-height: 1;
    }

    .big-number.navy { color: var(--navy); }
    .big-number.gold { color: var(--gold); }

    .refrain {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      max-width: 800px;
    }

    /* Cards */
    .card {
      background: var(--light-cream);
      border: 1px solid var(--gold);
      padding: 1.5rem 2rem;
      margin: 0.75rem 0;
      max-width: 800px;
      width: 100%;
    }

    .card.navy-bg {
      background: var(--navy);
      color: var(--cream);
    }

    .card.red-border { border: 2px solid var(--red); }

    .card-label {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .card-text {
      font-size: clamp(0.9rem, 1.8vw, 1.1rem);
    }

    .card.navy-bg .card-text { color: var(--cream); }

    /* Stats grid */
    .stats-grid {
      display: flex;
      gap: 1rem;
      margin: 1.5rem 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .stat-box {
      background: var(--navy);
      color: var(--cream);
      padding: 1rem 1.5rem;
      text-align: center;
      min-width: 140px;
    }

    .stat-value {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 700;
    }

    .stat-label {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-top: 0.25rem;
    }

    /* Design grid */
    .design-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      max-width: 900px;
      width: 100%;
    }

    @media (max-width: 768px) {
      .design-grid { grid-template-columns: repeat(2, 1fr); }
    }

    .design-item {
      background: var(--light-cream);
      border-left: 3px solid var(--gold);
      padding: 1rem;
    }

    .design-item-label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }

    .design-item-value {
      font-size: 0.85rem;
      color: var(--text);
      line-height: 1.4;
    }

    /* Results table */
    .results-table {
      width: 100%;
      max-width: 700px;
      border-collapse: collapse;
      margin: 1rem 0;
    }

    .results-table th {
      background: var(--navy);
      color: var(--cream);
      padding: 0.75rem 1rem;
      text-align: left;
      font-weight: 600;
    }

    .results-table th:not(:first-child) { text-align: center; }

    .results-table td {
      padding: 0.6rem 1rem;
      border-bottom: 1px solid #E2E8F0;
    }

    .results-table td:not(:first-child) { text-align: center; }
    .results-table .highlight { color: var(--red); font-weight: 700; }

    /* Result box */
    .result-box {
      background: var(--navy);
      padding: 1rem 2rem;
      text-align: center;
      margin: 1rem 0;
      max-width: 500px;
    }

    .result-box .value {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 700;
      color: var(--gold);
    }

    .result-box .label {
      font-size: 0.9rem;
      color: var(--cream);
      margin-top: 0.25rem;
    }

    /* Lesson items */
    .lesson-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin: 0.75rem 0;
      max-width: 800px;
    }

    .lesson-number {
      background: var(--gold);
      color: var(--navy);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }

    .lesson-content h4 {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .lesson-content p {
      font-size: 0.9rem;
      color: var(--light-text);
    }

    /* Gold line */
    .gold-line {
      width: 150px;
      height: 2px;
      background: var(--gold);
      margin: 1.5rem auto;
    }

    /* Closing lines */
    .closing-line {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.2rem, 2.5vw, 1.75rem);
      margin: 0.5rem 0;
      text-align: center;
    }

    .closing-line.gold { color: var(--gold); font-weight: 700; }
    .closing-line.italic { font-style: italic; opacity: 0.9; }

    /* Focus box */
    .focus-box {
      background: var(--navy);
      padding: 1rem 2rem;
      text-align: center;
      max-width: 600px;
    }

    .focus-box .main {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem;
      font-style: italic;
      color: var(--gold);
    }

    .focus-box .sub {
      font-size: 0.9rem;
      color: var(--cream);
      margin-top: 0.5rem;
    }

    /* Arrow */
    .arrow { color: var(--light-text); font-size: 1.2rem; margin: 0.25rem 0; }
    .footnote { font-size: 0.75rem; color: var(--light-text); font-style: italic; text-align: center; margin-top: 1rem; }
    .red { color: var(--red); }
    .text-center { text-align: center; }
    .mb-1 { margin-bottom: 1rem; }
    .mb-2 { margin-bottom: 2rem; }
    .mt-1 { margin-top: 1rem; }
    .mt-2 { margin-top: 2rem; }

    /* Content wrapper */
    .content {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 1000px;
    }

    /* Animation */
    .slide.active .animate { animation: fadeUp 0.6s ease-out forwards; }
    .slide.active .animate.delay-1 { animation-delay: 0.1s; }
    .slide.active .animate.delay-2 { animation-delay: 0.2s; }
    .slide.active .animate.delay-3 { animation-delay: 0.3s; }
    .slide.active .animate.delay-4 { animation-delay: 0.4s; }
    .slide.active .animate.delay-5 { animation-delay: 0.5s; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate { opacity: 0; }

    /* ====== SLIDE NAV ====== */
    /* Minimal floating arrows - no background strip */
    .slide-nav {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      padding: 1rem 1rem 1.5rem 1rem;
      z-index: 100;
      pointer-events: none; /* Allow clicks through to content */
    }

    .nav-btn {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 1.25rem;
      cursor: pointer;
      opacity: 0.6;
      transition: all 0.2s;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      pointer-events: auto; /* Buttons are clickable */
    }

    .nav-btn:hover {
      opacity: 1;
      background: rgba(0,0,0,0.7);
      border-color: var(--gold);
    }
    .nav-btn:disabled { opacity: 0.2; cursor: not-allowed; }

    /* Center info (counter + progress) - compact */
    .nav-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      pointer-events: none; /* Don't block quiz/content clicks beneath */
    }

    .slide-counter {
      font-size: 0.75rem;
      opacity: 0.6;
    }

    .progress { display: flex; gap: 4px; }

    .progress-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(255,255,255,0.25);
      cursor: pointer;
      transition: all 0.2s;
      pointer-events: auto; /* Only dots are clickable, not the whole nav-center */
    }

    .progress-dot.active {
      background: var(--gold);
      transform: scale(1.3);
    }

    .progress-dot:hover {
      background: rgba(255,255,255,0.5);
    }

    .progress-dot:hover { background: rgba(255,255,255,0.6); }

    .slide-counter {
      color: rgba(255,255,255,0.6);
      font-size: 0.85rem;
      min-width: 50px;
      text-align: center;
    }

    /* ====== TOOLS PANEL ====== */
    .tools-panel {
      width: 380px;
      max-width: 40vw; /* Limit to 40% of viewport so content isn't squeezed too much */
      background: var(--cream);
      border-left: 1px solid rgba(0,0,0,0.1);
      display: none; /* Hidden by default */
      flex-direction: column;
      flex-shrink: 0;
      overflow-y: auto;
    }

    .tools-panel.visible {
      display: flex;
    }

    .tools-panel.collapsed {
      width: 50px;
    }

    /* Adjust slide padding when tools panel is open */
    .content-body.tools-open .slide {
      padding-left: 1.5rem;
      padding-right: 1.5rem;
    }

    .content-body.tools-open .slide .content {
      max-width: 100%;
    }

    .tools-header {
      padding: 1rem;
      background: var(--navy);
      color: var(--cream);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tools-header h3 {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .tools-content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    /* Live Story Data Panel */
    .story-data-panel {
      background: linear-gradient(135deg, #1E2761 0%, #141B3D 100%);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      color: white;
    }

    .story-data-panel h4 {
      color: var(--gold);
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .story-toggle {
      display: flex;
      background: rgba(255,255,255,0.1);
      border-radius: 25px;
      padding: 4px;
      margin-bottom: 1rem;
    }

    .story-toggle button {
      flex: 1;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 20px;
      background: transparent;
      color: rgba(255,255,255,0.7);
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .story-toggle button.active {
      background: var(--gold);
      color: var(--navy);
    }

    .story-toggle button:hover:not(.active) {
      background: rgba(255,255,255,0.15);
      color: white;
    }

    .story-viz {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      min-height: 200px;
      transition: all 0.5s ease;
    }

    .story-viz svg {
      transition: all 0.5s ease;
    }

    .story-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }

    .story-metric {
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .story-metric.highlight-good {
      background: rgba(34, 197, 94, 0.3);
      border: 1px solid rgba(34, 197, 94, 0.5);
    }

    .story-metric.highlight-bad {
      background: rgba(197, 48, 48, 0.3);
      border: 1px solid rgba(197, 48, 48, 0.5);
    }

    .story-metric .value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
    }

    .story-metric .label {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.7);
      margin-top: 0.25rem;
    }

    .story-insight {
      background: rgba(212,175,55,0.2);
      border-left: 3px solid var(--gold);
      padding: 0.75rem;
      border-radius: 0 8px 8px 0;
      margin-top: 0.75rem;
      font-size: 0.75rem;
      line-height: 1.5;
    }

    /* ====== PREDICT FIRST INTERFACE ====== */
    .predict-first-panel {
      background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(30,39,97,0.3));
      border: 1px solid var(--gold);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      margin-top: 0.5rem;
    }

    .predict-first-panel .predict-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .predict-first-panel h4 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .predict-first-panel p {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.9);
      line-height: 1.4;
    }

    .predict-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .predict-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      border: 2px solid;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(0,0,0,0.2);
    }

    .predict-btn.benefit {
      border-color: #22c55e;
      color: #22c55e;
    }

    .predict-btn.benefit:hover {
      background: rgba(34,197,94,0.2);
    }

    .predict-btn.neutral {
      border-color: #94a3b8;
      color: #94a3b8;
    }

    .predict-btn.neutral:hover {
      background: rgba(148,163,184,0.2);
    }

    .predict-btn.harm {
      border-color: #ef4444;
      color: #ef4444;
    }

    .predict-btn.harm:hover {
      background: rgba(239,68,68,0.2);
    }

    .predict-icon-small {
      font-size: 1rem;
    }

    /* Prediction Feedback */
    .prediction-feedback {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .prediction-feedback.correct {
      background: rgba(34,197,94,0.2);
      border: 1px solid #22c55e;
      color: #22c55e;
    }

    .prediction-feedback.incorrect {
      background: rgba(239,68,68,0.15);
      border: 1px solid #ef4444;
      color: #fca5a5;
    }

    .feedback-icon {
      font-size: 1rem;
    }

    /* ====== PROGRESS DASHBOARD ====== */
    .progress-dashboard {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(5px);
      z-index: 2000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .progress-dashboard.open {
      display: flex;
    }

    .dashboard-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 1px solid var(--gold);
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(212,175,55,0.3);
    }

    .dashboard-header h2 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1.3rem;
    }

    .dashboard-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      opacity: 0.7;
    }

    .dashboard-close:hover { opacity: 1; }

    .level-display {
      background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(212,175,55,0.05));
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .level-badge {
      display: inline-block;
      background: var(--gold);
      color: var(--navy);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.8rem;
      margin-bottom: 0.5rem;
    }

    .points-display {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--gold);
    }

    .points-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .stat-card {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--gold);
    }

    .stat-label {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.6);
      margin-top: 0.25rem;
    }

    .principles-section h3, .badges-section h3, .streak-section h3 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .principle-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem;
      background: rgba(255,255,255,0.03);
      border-radius: 6px;
      margin-bottom: 0.35rem;
    }

    .principle-num {
      width: 20px;
      height: 20px;
      background: rgba(212,175,55,0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      color: var(--gold);
      flex-shrink: 0;
    }

    .principle-num.mastered {
      background: var(--gold);
      color: var(--navy);
    }

    .principle-text {
      flex: 1;
      font-size: 0.7rem;
      color: rgba(255,255,255,0.8);
    }

    .badges-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .badge {
      width: 44px;
      height: 44px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      opacity: 0.3;
      position: relative;
    }

    .badge.earned {
      opacity: 1;
      background: rgba(212,175,55,0.2);
      border-color: var(--gold);
    }

    .badge-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--navy);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.6rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .badge:hover .badge-tooltip {
      opacity: 1;
    }

    .streak-display {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
    }

    .streak-flame { font-size: 2rem; }

    .streak-count {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--gold);
    }

    .streak-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
    }

    .dashboard-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.6rem 0.75rem;
      background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.05));
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      color: var(--gold);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 0.5rem;
    }

    .dashboard-btn:hover {
      background: linear-gradient(135deg, rgba(212,175,55,0.25), rgba(212,175,55,0.1));
      border-color: var(--gold);
    }

    /* ====== DAILY REVIEW MODAL ====== */
    .daily-review-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 1rem;
    }

    .daily-review-modal.open {
      display: flex;
    }

    .daily-review-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 2px solid var(--gold);
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .daily-review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(212,175,55,0.3);
    }

    .daily-review-header h2 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1.5rem;
      margin: 0;
    }

    .daily-review-close {
      background: none;
      border: none;
      color: rgba(255,255,255,0.6);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .daily-review-close:hover {
      color: white;
    }

    .review-timer {
      text-align: center;
      margin-bottom: 1rem;
    }

    .timer-display {
      font-size: 2rem;
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
    }

    .timer-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    .review-progress {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      transition: all 0.3s;
    }

    .progress-dot.current {
      background: var(--gold);
      transform: scale(1.2);
    }

    .progress-dot.completed {
      background: #22c55e;
    }

    .review-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(212,175,55,0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .review-principle-num {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(212,175,55,0.2);
      border-radius: 50%;
      color: var(--gold);
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .review-principle-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.25rem;
      color: var(--cream);
      font-style: italic;
      margin-bottom: 1rem;
    }

    .review-question {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
    }

    .review-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .review-option {
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      font-size: 0.85rem;
    }

    .review-option:hover {
      background: rgba(212,175,55,0.15);
      border-color: var(--gold);
    }

    .review-option.correct {
      background: rgba(34,197,94,0.2);
      border-color: #22c55e;
    }

    .review-option.incorrect {
      background: rgba(239,68,68,0.2);
      border-color: #ef4444;
    }

    .review-option.selected {
      border-width: 2px;
    }

    .review-feedback {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .review-feedback.correct {
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.3);
      color: #86efac;
    }

    .review-feedback.incorrect {
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.3);
      color: #fca5a5;
    }

    .review-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      margin-top: 1rem;
    }

    .review-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .review-btn.skip {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: rgba(255,255,255,0.6);
    }

    .review-btn.skip:hover {
      border-color: rgba(255,255,255,0.5);
      color: white;
    }

    .review-btn.next {
      background: var(--gold);
      border: none;
      color: var(--navy);
      font-weight: 600;
    }

    .review-btn.next:hover {
      background: #e6c94a;
    }

    .review-summary {
      text-align: center;
    }

    .summary-score {
      font-size: 3rem;
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
    }

    .summary-text {
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
    }

    .summary-breakdown {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin: 1rem 0;
    }

    .summary-stat {
      text-align: center;
    }

    .summary-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .summary-stat-value.correct-val { color: #22c55e; }
    .summary-stat-value.incorrect-val { color: #ef4444; }

    .summary-stat-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    .review-streak-bonus {
      margin-top: 1rem;
      padding: 0.75rem;
      background: rgba(212,175,55,0.15);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .review-streak-bonus .flame { font-size: 1.5rem; }
    .review-streak-bonus .text { color: var(--gold); font-size: 0.9rem; }

    .daily-review-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.5rem 0.75rem;
      background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.05));
      border: 1px solid rgba(34,197,94,0.3);
      border-radius: 6px;
      color: #86efac;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 0.75rem;
    }

    .daily-review-btn:hover {
      background: linear-gradient(135deg, rgba(34,197,94,0.25), rgba(34,197,94,0.1));
      border-color: #22c55e;
    }

    .daily-review-btn.pending {
      animation: gentlePulse 2s infinite;
    }

    @keyframes gentlePulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(34,197,94,0.3); }
      50% { box-shadow: 0 0 0 6px rgba(34,197,94,0); }
    }

    /* ====== BRANCHING SCENARIOS ====== */
    .scenario-panel {
      background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(30,39,97,0.2));
      border: 2px solid rgba(124,58,237,0.4);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .scenario-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .scenario-icon { font-size: 1.5rem; }
    .scenario-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      color: #7C3AED;
      font-weight: 600;
    }

    .scenario-situation {
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--navy);
    }

    .scenario-question {
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--navy);
    }

    .scenario-choices {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .scenario-choice {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.8);
      border: 2px solid rgba(124,58,237,0.2);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .scenario-choice:hover:not(.answered) { background: rgba(124,58,237,0.1); border-color: rgba(124,58,237,0.5); }
    .scenario-choice.selected { border-color: #7C3AED; background: rgba(124,58,237,0.15); }
    .scenario-choice.correct { border-color: #22c55e; background: rgba(34,197,94,0.15); }
    .scenario-choice.incorrect { border-color: #ef4444; background: rgba(239,68,68,0.1); }

    .choice-letter {
      min-width: 24px; height: 24px; border-radius: 50%;
      background: rgba(124,58,237,0.2); color: #7C3AED;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 0.8rem;
    }
    .scenario-choice.correct .choice-letter { background: #22c55e; color: white; }
    .scenario-choice.incorrect .choice-letter { background: #ef4444; color: white; }
    .choice-text { flex: 1; font-size: 0.9rem; color: var(--navy); }

    .scenario-consequence {
      margin-top: 1rem; padding: 1rem; border-radius: 10px; display: none;
    }
    .scenario-consequence.visible { display: block; }
    .scenario-consequence.good { background: rgba(34,197,94,0.15); border: 1px solid rgba(34,197,94,0.3); }
    .scenario-consequence.bad { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); }
    .scenario-consequence.neutral { background: rgba(217,119,6,0.1); border: 1px solid rgba(217,119,6,0.3); }

    .consequence-title { font-weight: 700; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
    .scenario-consequence.good .consequence-title { color: #059669; }
    .scenario-consequence.bad .consequence-title { color: #dc2626; }
    .scenario-consequence.neutral .consequence-title { color: #d97706; }
    .consequence-text { font-size: 0.9rem; line-height: 1.5; }
    .consequence-lesson { margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed currentColor; font-style: italic; opacity: 0.9; }

    /* ====== CONFIDENCE CALIBRATION ====== */
    .confidence-section {
      margin-top: 1rem; padding: 0.75rem;
      background: rgba(212,175,55,0.1); border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);
    }
    .confidence-label { font-size: 0.8rem; color: var(--gold); margin-bottom: 0.5rem; }
    .confidence-slider-container { display: flex; align-items: center; gap: 0.75rem; }
    .confidence-slider {
      flex: 1; -webkit-appearance: none; height: 6px; border-radius: 3px;
      background: linear-gradient(to right, #ef4444, #eab308, #22c55e); outline: none;
    }
    .confidence-slider::-webkit-slider-thumb {
      -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: white; border: 2px solid var(--gold); cursor: pointer;
    }
    .confidence-value { min-width: 45px; font-size: 0.85rem; font-weight: 700; color: var(--gold); }
    .confidence-labels { display: flex; justify-content: space-between; font-size: 0.65rem; color: rgba(255,255,255,0.6); margin-top: 0.25rem; }

    /* ====== ANALOGY SYSTEM ====== */
    .analogy-card {
      background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(30,39,97,0.1));
      border: 1px solid rgba(212,175,55,0.4);
      border-radius: 12px;
      padding: 1rem;
      margin: 1rem 0;
    }
    .analogy-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
    .analogy-icon { font-size: 1.25rem; }
    .analogy-title { font-weight: 600; color: var(--gold); font-size: 0.9rem; }
    .analogy-concept { font-size: 0.75rem; color: rgba(255,255,255,0.6); }
    .analogy-text { font-size: 0.9rem; line-height: 1.5; font-style: italic; }

    /* ====== MISCONCEPTION CHALLENGE ====== */
    .misconception-challenge {
      background: linear-gradient(135deg, rgba(239,68,68,0.08), rgba(30,39,97,0.12));
      border: 2px solid rgba(239,68,68,0.25);
      border-radius: 12px;
      padding: 1.25rem;
      margin: 1rem 0;
    }
    .misconception-header { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: #dc2626; margin-bottom: 0.75rem; }
    .misconception-statement {
      font-size: 1rem; font-style: italic; color: var(--navy);
      margin-bottom: 1rem; padding: 0.75rem; background: rgba(255,255,255,0.85); border-radius: 8px;
    }
    .misconception-buttons { display: flex; gap: 0.75rem; justify-content: center; }
    .misconception-btn {
      padding: 0.6rem 1.5rem; border-radius: 8px; font-weight: 600;
      cursor: pointer; transition: all 0.2s; border: 2px solid;
    }
    .misconception-btn.true-btn { background: rgba(34,197,94,0.1); border-color: #22c55e; color: #059669; }
    .misconception-btn.false-btn { background: rgba(239,68,68,0.1); border-color: #ef4444; color: #dc2626; }
    .misconception-btn:hover { transform: scale(1.05); }
    .misconception-btn.correct { background: #22c55e; color: white; border-color: #22c55e; }
    .misconception-btn.wrong { background: #ef4444; color: white; border-color: #ef4444; }
    .misconception-result { margin-top: 1rem; padding: 0.75rem; border-radius: 8px; display: none; }
    .misconception-result.visible { display: block; }
    .misconception-result.correct { background: rgba(34,197,94,0.15); color: #059669; }
    .misconception-result.incorrect { background: rgba(239,68,68,0.1); color: #dc2626; }

    /* ====== PRACTICE PROBLEMS ====== */
    .practice-problem {
      background: linear-gradient(135deg, rgba(15,91,106,0.08), rgba(30,39,97,0.12));
      border: 2px solid rgba(15,91,106,0.3);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .practice-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .practice-category {
      background: rgba(15,91,106,0.2);
      color: #0f5b6a;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .practice-title {
      font-weight: 700;
      color: var(--navy);
      font-size: 1.1rem;
    }
    .practice-scenario {
      background: rgba(255,255,255,0.9);
      padding: 1rem;
      border-radius: 10px;
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--text);
      margin-bottom: 1rem;
    }
    .practice-question {
      color: var(--navy);
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    .practice-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .practice-option {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.95);
      border: 2px solid rgba(30,39,97,0.15);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      font-family: inherit;
      font-size: 0.9rem;
    }
    .practice-option:hover:not(:disabled) {
      border-color: var(--navy);
      transform: translateX(4px);
    }
    .practice-option .option-letter {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--navy);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.8rem;
      flex-shrink: 0;
    }
    .practice-option.correct {
      border-color: #22c55e;
      background: rgba(34,197,94,0.1);
    }
    .practice-option.correct .option-letter {
      background: #22c55e;
    }
    .practice-option.incorrect {
      border-color: #ef4444;
      background: rgba(239,68,68,0.08);
    }
    .practice-option.incorrect .option-letter {
      background: #ef4444;
    }
    .practice-option:disabled {
      cursor: default;
      opacity: 0.8;
    }
    .practice-feedback {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 10px;
      display: none;
      line-height: 1.6;
    }
    .practice-feedback.visible {
      display: block;
    }
    .practice-feedback.correct {
      background: rgba(34,197,94,0.12);
      border: 1px solid rgba(34,197,94,0.3);
      color: #047857;
    }
    .practice-feedback.incorrect {
      background: rgba(239,68,68,0.08);
      border: 1px solid rgba(239,68,68,0.2);
      color: #b91c1c;
    }
    .practice-feedback p {
      margin: 0.5rem 0;
    }
    .practice-feedback .principle-link {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(0,0,0,0.1);
      font-size: 0.85rem;
      color: var(--navy);
    }

    .story-insight strong {
      color: var(--gold);
    }

    .no-story-data {
      text-align: center;
      padding: 2rem 1rem;
      color: rgba(255,255,255,0.5);
      font-size: 0.8rem;
    }

    @keyframes pulseGold {
      0%, 100% { box-shadow: 0 0 0 0 rgba(212,175,55,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(212,175,55,0); }
    }

    .story-data-panel.updating {
      animation: pulseGold 0.5s ease;
    }

    .tool-section {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .tool-section-header {
      padding: 0.75rem 1rem;
      background: #f7fafc;
      border-bottom: 1px solid #e2e8f0;
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--navy);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tool-section-body {
      padding: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(212,175,55,0.2);
    }

    .btn-small {
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #e2e8f0;
      background: white;
      color: var(--text);
    }

    .btn-small.primary {
      background: var(--navy);
      color: white;
      border-color: var(--navy);
    }

    /* Study input table */
    .study-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .study-table th,
    .study-table td {
      padding: 0.4rem;
      border: 1px solid #e2e8f0;
      text-align: center;
    }

    .study-table th {
      background: #f7fafc;
      font-weight: 600;
    }

    .study-table input {
      width: 100%;
      padding: 0.25rem;
      border: 1px solid #e2e8f0;
      border-radius: 2px;
      font-size: 0.75rem;
      text-align: center;
    }

    /* Results display */
    .results-display {
      background: #f7fafc;
      border-radius: 6px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      padding: 0.4rem 0;
      font-size: 0.8rem;
      border-bottom: 1px solid #e2e8f0;
    }

    .result-row:last-child { border-bottom: none; }
    .result-row .label { color: var(--light-text); }
    .result-row .value { font-weight: 600; color: var(--navy); }

    /* Forest plot container */
    .forest-plot-container {
      margin-top: 1rem;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 1rem;
      overflow-x: auto;
    }

    /* Hide tools panel on small screens */
    @media (max-width: 1200px) {
      .tools-panel { display: none; }
      .sidebar { width: 60px; }
      .sidebar .module-info,
      .sidebar .sidebar-header p,
      .sidebar .sidebar-footer { display: none; }
      .sidebar .sidebar-header h1 { font-size: 1rem; }
    }

    /* Leap badge */
    .leap-badge {
      background: var(--red);
      color: white;
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      font-weight: 700;
      position: absolute;
      right: -10px;
      top: 50%;
      transform: translateY(-50%);
    }

    .card-wrapper {
      position: relative;
      max-width: 800px;
      width: 100%;
    }

    /* Wrong items */
    .wrong-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      background: var(--light-cream);
      padding: 1rem;
      margin: 0.5rem 0;
      max-width: 800px;
      width: 100%;
    }

    .wrong-number {
      background: var(--navy);
      color: var(--cream);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    /* Quiz styles */
    .quiz-container {
      max-width: 700px;
      width: 100%;
    }

    .quiz-question {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
    }

    .quiz-question h4 {
      font-size: 1rem;
      color: var(--navy);
      margin-bottom: 1rem;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .quiz-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      /* Accessibility: make focusable for keyboard nav */
      padding: 0.75rem 1rem;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quiz-option:hover {
      background: #f7fafc;
      border-color: var(--gold);
    }

    .quiz-option.selected {
      background: rgba(212,175,55,0.1);
      border-color: var(--gold);
    }

    .quiz-option.correct {
      background: rgba(34,197,94,0.1);
      border-color: var(--green);
    }

    .quiz-option.incorrect {
      background: rgba(197,48,48,0.1);
      border-color: var(--red);
    }

    /* RoB Domain Styles */
    .rob-domains {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .rob-domain {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .rob-domain label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text);
    }

    .rob-domain select {
      padding: 0.4rem;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 0.8rem;
    }

    /* GRADE factor styles */
    .grade-factors .form-group label {
      font-size: 0.75rem;
      color: var(--text);
    }

    .grade-factors select {
      font-size: 0.75rem;
    }

    /* Red text utility */
    .result-row .value.red {
      color: var(--red);
      font-weight: 700;
    }

    /* Interactive Investigation Exercises */
    .investigation-box {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 900px;
      width: 100%;
      margin: 1rem 0;
    }

    .investigation-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      color: var(--gold);
    }

    .investigation-header .icon {
      font-size: 1.5rem;
    }

    .investigation-header h3 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0;
    }

    .investigation-prompt {
      font-style: italic;
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
      font-size: 1.05rem;
      line-height: 1.5;
    }

    .data-table-investigation {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: 0.85rem;
    }

    .data-table-investigation th,
    .data-table-investigation td {
      padding: 0.5rem 0.75rem;
      border: 1px solid rgba(212,175,55,0.3);
      text-align: center;
      color: var(--cream);
    }

    .data-table-investigation th {
      background: rgba(212,175,55,0.2);
      color: var(--gold);
      font-weight: 600;
    }

    .data-table-investigation tr:nth-child(even) {
      background: rgba(255,255,255,0.05);
    }

    .reveal-btn {
      background: var(--gold);
      color: var(--navy);
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
      transition: all 0.2s;
    }

    .reveal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(212,175,55,0.3);
    }

    .hidden-reveal {
      display: none;
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(197,48,48,0.1);
      border-left: 3px solid var(--red);
      color: var(--cream);
    }

    .hidden-reveal.visible {
      display: block;
      animation: fadeUp 0.4s ease-out;
    }

    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 1rem 0;
    }

    .comparison-panel {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .comparison-panel h4 {
      color: var(--gold);
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .comparison-panel.after {
      border-color: var(--red);
    }

    .comparison-panel.after h4 {
      color: var(--red);
    }

    /* Rhetorical question styling */
    .rhetorical {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.3rem, 3vw, 1.8rem);
      font-style: italic;
      color: rgba(255,255,255,0.9);
      text-align: center;
      max-width: 700px;
      margin: 1rem 0;
    }

    /* Direct address styling */
    .direct-address {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.2rem;
      color: var(--gold);
      border-left: 3px solid var(--gold);
      padding-left: 1rem;
      margin: 1rem 0;
      font-style: italic;
    }

    /* Mini forest plot for exercises */
    .mini-forest {
      background: white;
      border-radius: 8px;
      padding: 0.75rem;
      margin-top: 0.5rem;
    }

    /* ============================================================
       ACCESSIBILITY IMPROVEMENTS
       ============================================================ */

    /* Focus states for keyboard navigation */
    *:focus {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }

    *:focus:not(:focus-visible) {
      outline: none;
    }

    *:focus-visible {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }

    .quiz-option:focus-visible,
    .btn:focus-visible,
    .module-item:focus-visible,
    .nav-btn:focus-visible {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }

    /* Skip to content link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--gold);
      color: var(--navy);
      padding: 8px 16px;
      z-index: 1000;
      font-weight: 600;
      text-decoration: none;
      border-radius: 0 0 4px 0;
    }

    .skip-link:focus {
      top: 0;
    }

    /* Screen reader only text */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Improved color contrast for accessibility */
    .light-text-accessible {
      color: #a0aec0; /* Lighter for better contrast on dark */
    }

    /* ============================================================
       MOBILE RESPONSIVE (< 768px)
       ============================================================ */

    .mobile-menu-btn {
      display: none;
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1001;
      background: var(--gold);
      color: var(--navy);
      border: none;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      font-size: 1.2rem;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: block;
      }

      .sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        height: 100vh;
        z-index: 1000;
        transition: left 0.3s ease;
      }

      .sidebar.open {
        left: 0;
      }

      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
      }

      .sidebar-overlay.open {
        display: block;
      }

      .content-header {
        padding-left: 4rem;
      }

      .tools-panel {
        width: 100%;
        right: -100%;
      }

      .tools-panel.open {
        right: 0;
      }

      .slide .content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
    }

    /* ============================================================
       GLOSSARY PANEL
       ============================================================ */

    .glossary-btn {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      background: var(--navy);
      color: var(--gold);
      border: 2px solid var(--gold);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .glossary-btn:hover {
      background: var(--gold);
      color: var(--navy);
    }

    /* Story Data Indicator Button */
    .story-indicator-btn {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background: linear-gradient(135deg, #1E2761 0%, #141B3D 100%);
      color: var(--gold);
      border: 2px solid var(--gold);
      border-radius: 25px;
      padding: 0.5rem 1rem;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      z-index: 100;
      display: none;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .story-indicator-btn.visible {
      display: flex;
    }

    .story-indicator-btn:hover {
      background: var(--gold);
      color: var(--navy);
      transform: translateY(-2px);
    }

    .story-indicator-btn.pulse {
      animation: pulseBtn 2s infinite;
    }

    @keyframes pulseBtn {
      0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 0 0 rgba(212,175,55,0.4); }
      50% { box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 0 8px rgba(212,175,55,0); }
    }

    .story-indicator-dot {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .glossary-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 0;
      background: var(--deep-navy);
      border-top: 2px solid var(--gold);
      z-index: 999;
      overflow: hidden;
      transition: height 0.3s ease;
    }

    .glossary-panel.open {
      height: 50vh;
    }

    .glossary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .glossary-header h3 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
    }

    .glossary-close {
      background: none;
      border: none;
      color: var(--cream);
      font-size: 1.5rem;
      cursor: pointer;
    }

    .glossary-search {
      padding: 0.75rem 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .glossary-search input {
      width: 100%;
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.9rem;
    }

    .glossary-content {
      padding: 1rem 1.5rem;
      overflow-y: auto;
      height: calc(50vh - 120px);
    }

    .glossary-term {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .glossary-term dt {
      color: var(--gold);
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
    }

    .glossary-term dd {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* ============================================================
       KEYBOARD SHORTCUTS HELP
       ============================================================ */

    .keyboard-help {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--deep-navy);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 2rem;
      z-index: 1001;
      display: none;
      min-width: 300px;
      max-width: 90vw;
    }

    .keyboard-help.open {
      display: block;
    }

    .keyboard-help h3 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      margin-bottom: 1rem;
      text-align: center;
    }

    .keyboard-help-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .keyboard-help-key {
      background: rgba(255,255,255,0.1);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.85rem;
    }

    /* ============================================================
       LEARNING OBJECTIVES BOX
       ============================================================ */

    .learning-objectives {
      background: rgba(212,175,55,0.1);
      border: 1px solid var(--gold);
      border-radius: 8px;
      padding: 1rem 1.5rem;
      margin: 1rem 0;
      max-width: 700px;
    }

    .learning-objectives h4 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .learning-objectives ul {
      margin: 0;
      padding-left: 1.25rem;
    }

    .learning-objectives li {
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    /* ============================================================
       DECISION TREE STORIES (Quranic Storytelling)
       ============================================================ */

    .story-box {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid var(--gold);
      border-radius: 16px;
      padding: 2rem;
      max-width: 900px;
      width: 100%;
      margin: 1rem 0;
    }

    .story-opener {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.4rem, 3vw, 2rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      margin-bottom: 1.5rem;
      line-height: 1.4;
    }

    .story-opener::before {
      content: '"';
      font-size: 1.5em;
      opacity: 0.5;
    }

    .story-opener::after {
      content: '"';
      font-size: 1.5em;
      opacity: 0.5;
    }

    .real-data-box {
      background: rgba(255,255,255,0.05);
      border-left: 4px solid #3b82f6;
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      border-radius: 0 8px 8px 0;
    }

    .real-data-box h4 {
      color: #60a5fa;
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .real-data-box h4::before {
      content: '📊';
    }

    .real-data-box p {
      color: var(--cream);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .real-data-box .data-highlight {
      color: var(--gold);
      font-weight: 700;
    }

    .decision-tree {
      background: rgba(212,175,55,0.1);
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .decision-tree-header {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.2rem;
      color: var(--gold);
      margin-bottom: 1rem;
      text-align: center;
      font-weight: 600;
    }

    .decision-scenario {
      background: rgba(0,0,0,0.3);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-style: italic;
      color: rgba(255,255,255,0.9);
      text-align: center;
    }

    .decision-paths {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    @media (max-width: 768px) {
      .decision-paths {
        grid-template-columns: 1fr;
      }
    }

    .decision-path {
      padding: 1.25rem;
      border-radius: 8px;
      position: relative;
    }

    .decision-path.path-a {
      background: rgba(197, 48, 48, 0.15);
      border: 2px solid rgba(197, 48, 48, 0.5);
    }

    .decision-path.path-b {
      background: rgba(34, 197, 94, 0.15);
      border: 2px solid rgba(34, 197, 94, 0.5);
    }

    .path-label {
      font-weight: 700;
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .decision-path.path-a .path-label {
      color: #f87171;
    }

    .decision-path.path-b .path-label {
      color: #4ade80;
    }

    .path-choice {
      font-size: 0.95rem;
      color: var(--cream);
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .path-arrow {
      color: rgba(255,255,255,0.5);
      text-align: center;
      margin: 0.5rem 0;
      font-size: 1.2rem;
    }

    .path-consequence {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      line-height: 1.5;
    }

    .path-outcome {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255,255,255,0.2);
      font-weight: 700;
    }

    .decision-path.path-a .path-outcome {
      color: #f87171;
    }

    .decision-path.path-b .path-outcome {
      color: #4ade80;
    }

    .decision-path:focus {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }

    .story-revelation {
      background: linear-gradient(135deg, rgba(212,175,55,0.3), rgba(212,175,55,0.1));
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 1.5rem;
      text-align: center;
    }

    .revelation-label {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.15em;
      margin-bottom: 0.75rem;
    }

    .revelation-text {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.1rem, 2.5vw, 1.4rem);
      color: var(--cream);
      line-height: 1.5;
      font-weight: 600;
    }

    .story-timeline {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }

    .timeline-point {
      background: rgba(255,255,255,0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      color: rgba(255,255,255,0.8);
    }

    .timeline-point.critical {
      background: rgba(197, 48, 48, 0.3);
      border: 1px solid rgba(197, 48, 48, 0.5);
      color: #fca5a5;
    }

    .timeline-point.resolution {
      background: rgba(34, 197, 94, 0.3);
      border: 1px solid rgba(34, 197, 94, 0.5);
      color: #86efac;
    }

    /* ============================================================
       REDUCED MOTION (Accessibility)
       ============================================================ */

    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }

      .animate {
        animation: none !important;
        opacity: 1 !important;
      }

      .slide {
        transition: none !important;
      }
    }

    /* ============================================================
       PRINT STYLESHEET
       ============================================================ */

    @media print {
      .sidebar,
      .content-header,
      .slide-nav,
      .tools-panel,
      .glossary-btn,
      .glossary-panel,
      .mobile-menu-btn,
      .keyboard-help,
      .btn,
      .nav-btn,
      .reveal-btn {
        display: none !important;
      }

      .course-container {
        display: block;
        height: auto;
      }

      .main-content {
        display: block;
      }

      .content-body {
        display: block;
      }

      .slides-container {
        display: block;
        height: auto;
        overflow: visible;
      }

      .module-slides {
        display: block !important;
      }

      .slide {
        display: block !important;
        page-break-inside: avoid;
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #ccc;
      }

      .slide.dark,
      .slide.black {
        background: white !important;
        color: black !important;
      }

      .slide.dark *,
      .slide.black * {
        color: black !important;
      }

      .refrain,
      .title {
        color: #1E2761 !important;
      }

      .gold-line {
        background: #D4AF37 !important;
      }

      body {
        background: white;
        color: black;
      }
    }

    /* ============================================================
       TIER SYSTEM — Clinician | Researcher | Methodologist
       ============================================================ */
    .tier-selector {
      display: flex;
      gap: 2px;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }
    .tier-btn {
      flex: 1;
      padding: 0.4rem 0.25rem;
      font-size: 0.65rem;
      font-weight: 600;
      text-align: center;
      border: 1px solid rgba(212,175,55,0.3);
      background: transparent;
      color: rgba(255,255,255,0.6);
      cursor: pointer;
      transition: all 0.2s;
      border-radius: 4px;
    }
    .tier-btn:hover { background: rgba(212,175,55,0.1); color: var(--cream); }
    .tier-btn.active {
      background: var(--gold);
      color: var(--navy);
      border-color: var(--gold);
    }
    .tier-btn .tier-icon { display: block; font-size: 1rem; margin-bottom: 2px; }

    /* Tier visibility: slides tagged data-tier="methods" or "mastery" */
    [data-tier="methods"],
    [data-tier="mastery"] {
      display: none;
    }
    body.tier-researcher [data-tier="methods"] { display: flex; }
    body.tier-methodologist [data-tier="methods"],
    body.tier-methodologist [data-tier="mastery"] { display: flex; }
    /* Foundation slides always visible — no data-tier attr needed */

    /* Tier badge shown on slides */
    .tier-badge {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      font-size: 0.65rem;
      font-weight: 700;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      z-index: 2;
    }
    .tier-badge.methods {
      background: rgba(59,130,246,0.2);
      color: #60a5fa;
      border: 1px solid rgba(59,130,246,0.3);
    }
    .tier-badge.mastery {
      background: rgba(168,85,247,0.2);
      color: #c084fc;
      border: 1px solid rgba(168,85,247,0.3);
    }
    .slide.light .tier-badge.methods {
      background: rgba(59,130,246,0.1);
      color: #2563eb;
      border-color: rgba(59,130,246,0.3);
    }
    .slide.light .tier-badge.mastery {
      background: rgba(168,85,247,0.1);
      color: #7c3aed;
      border-color: rgba(168,85,247,0.3);
    }
  </style>
</head>
<body>
<!-- Skip to content link for accessibility -->
<a class="skip-link" href="#main-content">Skip to content</a>
<!-- Mobile menu button -->
<button aria-expanded="false" aria-label="Toggle navigation menu" class="mobile-menu-btn" onclick="toggleSidebar()">☰</button>
<!-- Mobile sidebar overlay -->
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
<!-- Glossary button -->
 Индикатор данных истории 
<button aria-label="Просмотр данных истории" class="story-indicator-btn pulse" id="storyIndicatorBtn" onclick="openToolsWithStory()">
<span class="story-indicator-dot"></span>
<span>📊 Доступны живые данные</span>
</button>
<button aria-label="Open glossary" class="glossary-btn" onclick="toggleGlossary()" title="Glossary (press G)">📖</button>
<!-- Glossary Panel -->
<div aria-label="Glossary" class="glossary-panel" id="glossaryPanel" role="dialog">
<div class="glossary-header">
<h3>Glossary of Terms</h3>
<button aria-label="Close glossary" class="glossary-close" onclick="toggleGlossary()">×</button>
</div>
<div class="glossary-search">
<input aria-label="Search glossary" id="glossarySearch" onkeyup="filterGlossary()" placeholder="Search terms..." type="text"/>
</div>
<div class="glossary-content" id="glossaryContent">
<dl>
<div class="glossary-term" data-term="meta-analysis">
<dt>Meta-Analysis</dt>
<dd>Статистический метод объединения результатов нескольких независимых исследований, посвященных одному и тому же вопросу, для получения объединенной оценки.</dd>
</div>
<div class="glossary-term" data-term="systematic review">
<dt>Systematic Review</dt>
<dd>Всесторонний, воспроизводимый обзор литературы, в котором используются явные методы для выявления, отбора, оценки и обобщения всех соответствующих исследований по конкретному вопросу.</dd>
</div>
<div class="glossary-term" data-term="pico">
<dt>PICO</dt>
<dd>Framework for formulating clinical questions: Population, Intervention, Comparator, Outcome.</dd>
</div>
<div class="glossary-term" data-term="heterogeneity">
<dt>Heterogeneity</dt>
<dd>Вариабельность результатов исследования выходит за рамки ожидаемой случайности. Измеряется статистикой I², τ² и Q.</dd>
</div>
<div class="glossary-term" data-term="i-squared">
<dt>I² (I-squared)</dt>
<dd>Процент изменчивости оценок эффекта, обусловленный неоднородностью, а не ошибкой выборки. 0-25%: низкий, 25-50%: средний, 50-75%: существенный, 75-100%: значительный.</dd>
</div>
<div class="glossary-term" data-term="tau-squared">
<dt>τ² (Tau-squared)</dt>
<dd>Разница между исследованиями в модели случайных эффектов. Измеряет абсолютную величину неоднородности по шкале размера эффекта.</dd>
</div>
<div class="glossary-term" data-term="fixed effect">
<dt>Fixed Effect Model</dt>
<dd>Предполагается, что все исследования оценивают один и тот же истинный эффект. Исследования весов по обратной дисперсии (точности). Преобладают крупные исследования.</dd>
</div>
<div class="glossary-term" data-term="random effects">
<dt>Random Effects Model</dt>
<dd>Предполагается, что исследования оценивают разные, но связанные эффекты распределения. Включает в веса дисперсию между исследованиями (τ²).</dd>
</div>
<div class="glossary-term" data-term="forest plot">
<dt>Forest Plot</dt>
<dd>Графическое отображение величины эффекта отдельных исследований и объединенной оценки с доверительными интервалами.</dd>
</div>
<div class="glossary-term" data-term="funnel plot">
<dt>Funnel Plot</dt>
<dd>A scatter plot of effect size vs. standard error. Asymmetry may indicate publication bias or small-study effects.</dd>
</div>
<div class="glossary-term" data-term="publication bias">
<dt>Publication Bias</dt>
<dd>Тенденция к тому, что исследования с положительными/значимыми результатами публикуются чаще, чем исследования с нулевыми/отрицательными результатами.</dd>
</div>
<div class="glossary-term" data-term="egger test">
<dt>Egger's Test</dt>
<dd>A regression test for funnel plot asymmetry. P &lt; 0.10 suggests potential small-study effects or publication bias.</dd>
</div>
<div class="glossary-term" data-term="trim and fill">
<dt>Trim-and-Fill</dt>
<dd>Метод оценки количества пропущенных исследований из-за систематической ошибки публикации и соответствующей корректировки объединенного эффекта.</dd>
</div>
<div class="glossary-term" data-term="risk of bias">
<dt>Risk of Bias (RoB)</dt>
<dd>Оценка систематических ошибок в дизайне, проведении или отчетности исследования, которые могут повлиять на результаты. RoB 2.0 – это Кокрейновский инструмент для РКИ.</dd>
</div>
<div class="glossary-term" data-term="robins-i">
<dt>ROBINS-I</dt>
<dd>Риск систематической ошибки в нерандомизированных исследованиях вмешательств. Кокрейновский инструмент для оценки систематической ошибки в обсервационных исследованиях.</dd>
</div>
<div class="glossary-term" data-term="grade">
<dt>GRADE</dt>
<dd>Оценка рекомендаций, оценок, разработок и оценок. Система оценки достоверности доказательств (высокая, средняя, ​​низкая, очень низкая).</dd>
</div>
<div class="glossary-term" data-term="prediction interval">
<dt>Prediction Interval</dt>
<dd>Диапазон эффектов, ожидаемых в новом исследовании, с учетом гетерогенности между исследованиями. Шире доверительного интервала.</dd>
</div>
<!-- NNT defined in new glossary section below with fuller definition -->
<div class="glossary-term" data-term="nnh">
<dt>NNH (Number Needed to Harm)</dt>
<dd>Число пациентов, которых необходимо лечить, чтобы на одного дополнительного пациента был причинен вред. ННГ = 1/ОРИ.</dd>
</div>
<div class="glossary-term" data-term="hksj">
<dt>HKSJ Adjustment</dt>
<dd>Корректировка Хартунга-Кнаппа-Сидика-Йонкмана. Использует t-распределение для доверительных интервалов в моделях случайных эффектов, обеспечивая лучший охват при небольшом количестве исследований.</dd>
</div>
<div class="glossary-term" data-term="prospero">
<dt>PROSPERO</dt>
<dd>International prospective register of systematic reviews. Pre-registration prevents post-hoc methodological changes.</dd>
</div>
<div class="glossary-term" data-term="prisma">
<dt>PRISMA</dt>
<dd>Предпочтительные элементы отчетности для систематических обзоров и метаанализов. Руководство по отчетности с блок-схемой и контрольным списком.</dd>
</div>
<div class="glossary-term" data-term="nma">
<dt>Network Meta-Analysis (NMA)</dt>
<dd>Метод одновременного сравнения нескольких методов лечения с использованием прямых и косвенных данных с помощью общих компараторов.</dd>
</div>
<div class="glossary-term" data-term="sucra">
<dt>SUCRA</dt>
<dd>Поверхность под кривой совокупного ранжирования. Ранжирует лечение в NMA от 0% (худшее) до 100% (лучшее).</dd>
</div>
<div class="glossary-term" data-term="ipd">
<dt>IPD Meta-Analysis</dt>
<dd>Метаанализ индивидуальных данных пациентов. Использует необработанные данные исследований на уровне пациентов, а не опубликованные сводки. Золотой стандарт анализа подгрупп.</dd>
</div>
<div class="glossary-term" data-term="dta">
<dt>DTA Meta-Analysis</dt>
<dd>Diagnostic Test Accuracy meta-analysis. Synthesizes sensitivity and specificity using bivariate models.</dd>
</div>
<div class="glossary-term" data-term="sroc">
<dt>SROC Curve</dt>
<dd>Summary Receiver Operating Characteristic curve. Used in DTA meta-analysis to display pooled sensitivity/specificity.</dd>
</div>
<div class="glossary-term" data-term="iceman">
<dt>ICEMAN</dt>
<dd>Инструмент для оценки достоверности анализа модификации эффектов. Оценивает достоверность анализа подгрупп.</dd>
</div>
<div class="glossary-term" data-term="tsa">
<dt>Последовательный анализ испытаний (TSA)</dt>
<dd>Метод, применяющий границы остановки к кумулятивному метаанализу, чтобы определить, когда накопилось достаточно доказательств.</dd>
</div>
<div class="glossary-term" data-term="living review">
<dt>Живой систематический обзор</dt>
<dd>Обзор, который постоянно обновляется по мере появления новых данных, а не представляет собой публикацию с фиксированным моментом времени.</dd>
</div>
 Термины глоссария расширенного модуля 
<div class="glossary-term" data-term="bayesian"><dt>Bayesian Meta-Analysis</dt>
<dd>Метаанализ с использованием теоремы Байеса: объединяет априорные убеждения с данными (вероятностью) для получения апостериорных распределений параметров эффекта.</dd></div>
<div class="glossary-term" data-term="prior"><dt>Prior Distribution</dt>
<dd>Распределение вероятностей, отражающее убеждения о параметре до просмотра данных. Может быть расплывчатым, слабоинформативным или информативным.</dd></div>
<div class="glossary-term" data-term="posterior"><dt>Posterior Distribution</dt>
<dd>Обновленное распределение вероятностей после объединения априорного значения с правдоподобием данных. Основа для всех байесовских выводов.</dd></div>
<div class="glossary-term" data-term="credible interval"><dt>Credible Interval</dt>
<dd>Байесовский аналог доверительного интервала. 95% CrI означает, что с вероятностью 95% параметр находится в пределах интервала.</dd></div>
<div class="glossary-term" data-term="mcmc"><dt>MCMC (Markov Chain Monte Carlo)</dt>
<dd>Вычислительный метод для получения выборок из апостериорных распределений, когда аналитические решения недоступны. Инструменты: JAGS, Stan, PyMC.</dd></div>
<div class="glossary-term" data-term="bayes factor"><dt>Bayes Factor</dt>
<dd>Отношение предельных правдоподобий при сравнении двух гипотез. BF10 &gt; 10 = убедительное доказательство H1. Заменяет p-значения в байесовском тестировании.</dd></div>
<div class="glossary-term" data-term="transitivity"><dt>Transitivity</dt>
<dd>Основное предположение NMA: косвенные сравнения действительны, когда модификаторы эффекта одинаково распределены по сравнениям в сети.</dd></div>
<div class="glossary-term" data-term="consistency"><dt>Consistency (NMA)</dt>
<dd>Согласие между прямыми и косвенными свидетельствами. Протестировано посредством разделения узлов (локально) или взаимодействия «проектирование-обработка» (глобально).</dd></div>
<div class="glossary-term" data-term="p-score"><dt>P-score</dt>
<dd>Частомерный аналог SUCRA в NMA. Измеряет среднюю степень уверенности в том, что один метод лечения лучше всех остальных.</dd></div>
<div class="glossary-term" data-term="component nma"><dt>Component NMA</dt>
<dd>Decomposes multi-component interventions to estimate individual component effects. Uses additive models.</dd></div>
<div class="glossary-term" data-term="ecological bias"><dt>Ecological Bias</dt>
<dd>Происходит, когда ассоциации на уровне исследования отличаются от ассоциаций на уровне пациента. Только IPD может отделить эффекты внутри исследования от эффектов между исследованиями.</dd></div>
<div class="glossary-term" data-term="one-stage"><dt>One-Stage IPD Model</dt>
<dd>Одна модель смешанных эффектов, адаптированная ко всем данным пациента одновременно. Более эффективен для взаимодействий и редких событий, чем двухэтапный.</dd></div>
<div class="glossary-term" data-term="two-stage"><dt>Two-Stage IPD Model</dt>
<dd>Analyze each study separately, then combine estimates. Simpler but potentially loses information compared to one-stage.</dd></div>
<div class="glossary-term" data-term="dose-response"><dt>Dose-Response Meta-Analysis</dt>
<dd>Моделирует взаимосвязь между дозой воздействия и результатом в разных исследованиях. Использует линейную, полиномиальную или сплайн-регрессию.</dd></div>
<div class="glossary-term" data-term="restricted cubic spline"><dt>Restricted Cubic Splines (RCS)</dt>
<dd>Кусочные полиномиальные кривые с узлами в заранее заданных точках дозы. Линейные заграничные узлы. Используется для гибкого моделирования зависимости «доза-эффект».</dd></div>
<div class="glossary-term" data-term="fragility index"><dt>Fragility Index</dt>
<dd>The minimum number of patient outcome changes needed to flip a statistically significant result to non-significant. Lower = more fragile.</dd></div>
<div class="glossary-term" data-term="gosh"><dt>GOSH Plot</dt>
<dd>Графический обзор неоднородности исследования. Показывает объединенный эффект в сравнении с I² для всех возможных подгрупп исследований, чтобы выявить влиятельные исследования и кластеры.</dd></div>
<div class="glossary-term" data-term="contour funnel"><dt>Contour-Enhanced Funnel Plot</dt>
<dd>Воронкообразный график с заштрихованными контурами значимости (p&lt;0,01, 0,05, 0,10). Помогает отличить предвзятость публикации от других причин асимметрии.</dd></div>
<div class="glossary-term" data-term="copas"><dt>Copas Selection Model</dt>
<dd>Моделирует вероятность публикации исследования как функцию SE и размера эффекта. Совместно оценивает истинный эффект и механизм выбора.</dd></div>
<div class="glossary-term" data-term="pet-peese"><dt>PET-PEESE</dt>
<dd>Тест точного эффекта/Оценка точного эффекта со стандартной ошибкой. Регрессионный тест для выявления эффектов небольших исследований и предвзятости публикаций.</dd></div>
<div class="glossary-term" data-term="progress-plus"><dt>PROGRESS-Plus</dt>
<dd>Framework for assessing equity: Place, Race, Occupation, Gender, Religion, Education, SES, Social capital, plus age, disability, orientation.</dd></div>
<div class="glossary-term" data-term="prisma-equity"><dt>PRISMA-Equity</dt>
<dd>Расширение PRISMA для систематических обзоров, ориентированных на справедливость. Требуется отчетность о группах населения, находящихся в неблагоприятном положении, и применимость.</dd></div>
<div class="glossary-term" data-term="transportability"><dt>Transportability</dt>
<dd>Степень, в которой результаты исследования применимы к целевой группе населения, отличной от выборки исследования. Существуют методы для повторного взвешивания данных испытаний.</dd></div>
<div class="glossary-term" data-term="active learning"><dt>Active Learning (Screening)</dt>
<dd>Подход машинного обучения, который итеративно выбирает наиболее информативные цитаты для проверки человеком, извлекая уроки из каждого решения для улучшения рейтинга.</dd></div>
<div class="glossary-term" data-term="wss"><dt>WSS@95%</dt>
<dd>Work Saved over Sampling at 95% recall. Measures screening automation efficiency: what percentage of citations can be safely skipped.</dd></div>
<div class="glossary-term" data-term="meta-ethnography"><dt>Meta-Ethnography</dt>
<dd>Метод качественного синтеза (Noblit &amp; Hare 1988), который преобразует концепции разных исследований для получения новой интерпретации рамки.</dd></div>
<div class="glossary-term" data-term="cerqual"><dt>CERQual</dt>
<dd>Доверие к данным обзоров качественных исследований. Оценивает уверенность через методологические ограничения, последовательность, адекватность и актуальность.</dd></div>
<div class="glossary-term" data-term="thematic synthesis"><dt>Thematic Synthesis</dt>
<dd>Качественный подход, который кодирует результаты исследований и генерирует аналитические темы. Сочетает в себе элементы метаэтнографии и обоснованной теории.</dd></div>
<div class="glossary-term" data-term="rve"><dt>RVE (Robust Variance Estimation)</dt>
<dd>Оценщик сэндвич-типа, обеспечивающий действительные стандартные ошибки для зависимых размеров эффекта без знания истинной корреляции внутри исследования.</dd></div>
<div class="glossary-term" data-term="three-level model"><dt>Three-Level Model</dt>
<dd>Многоуровневая модель, разделяющая дисперсию на компоненты выборки (L1), внутри исследования (L2) и между исследованиями (L3) для вложенного эффекта размеры.</dd></div>
<div class="glossary-term" data-term="reproducibility"><dt>Reproducibility</dt>
<dd>Те же данные + тот же код = тот же результат. Минимальный стандарт для любого количественного анализа. Отличие от воспроизводимости (новые данные, те же методы).</dd></div>
<div class="glossary-term" data-term="proof-carrying number"><dt>Proof-Carrying Number</dt>
<dd>Числовой результат в сочетании с полной цепочкой происхождения: хеш входных данных, код преобразования, результаты проверки и контрольный журнал.</dd></div>
<div class="glossary-term" data-term="evidence hashing"><dt>Evidence Hashing</dt>
<dd>Криптографический отпечаток (SHA-256) входных данных и кода, который обнаруживает любые изменения. Основной компонент подтверждающих чисел.</dd></div>
<div class="glossary-term" data-term="bma"><dt>Bayesian Model Averaging (BMA)</dt>
<dd>Weights multiple models (FE, RE, etc.) by their posterior probability rather than choosing one. Accounts for model uncertainty.</dd></div>
<div class="glossary-term" data-term="half-cauchy"><dt>Half-Cauchy Prior</dt>
<dd>Обычно используемое предшествующее семейство для параметра неоднородности тау. Он допускает большие значения при концентрации вероятности около нуля, но выбор шкалы должен быть обоснован метрикой эффекта и клиническим контекстом.</dd></div>
<div class="glossary-term" data-term="league table"><dt>League Table</dt>
<dd>NMA output showing all pairwise comparisons in a matrix. Upper/lower triangles show effect estimates and credible intervals.</dd></div>
<div class="glossary-term" data-term="node-splitting"><dt>Node-Splitting</dt>
<dd>Тест на локальную несогласованность в NMA, сравнивающий прямые и косвенные доказательства для каждого сравнения. Значительное различие предполагает нарушение транзитивности.</dd></div>
<div class="glossary-term" data-term="sick-quitter bias"><dt>Sick-Quitter Bias</dt>
<dd>Происходит, когда бывшие потребители (которые бросили курить из-за болезни) классифицируются как не употребляющие наркотики, в результате чего группа не употребляющих курение выглядит более больной, чем она есть на самом деле.</dd></div>
<div class="glossary-term" data-term="knots"><dt>Knots (Spline)</dt>
<dd>Pre-specified dose points where polynomial segments join in restricted cubic splines. Typically 3-5 knots placed at dose distribution quantiles.</dd></div>
<div class="glossary-term" data-term="scoping-review"><dt>Scoping Review</dt>
<dd>Тип синтеза доказательств, который отображает масштабы, диапазон и характер исследовательской деятельности в определенной области. Использует структуру PCC (население, концепция, контекст). Об этом сообщает ПРИЗМА-НЦР. Не оценивает качество или результаты объединения.</dd></div>
<div class="glossary-term" data-term="umbrella-review"><dt>Umbrella Review</dt>
<dd>Обзор существующих систематических обзоров по теме. Использует AMSTAR 2 для оценки качества обзора и ROBIS для выявления риска предвзятости. Также называется «обзором отзывов». Корректирует перекрытие исследований с помощью метода скорректированной покрытой площади (CCA).</dd></div>
<div class="glossary-term" data-term="cluster-rct"><dt>Cluster-Randomized Trial</dt>
<dd>Исследование, в котором рандомизируются группы (больницы, школы, сообщества), а не отдельные лица. Требуется корректировка с учетом эффекта дизайна = 1 + (m−1) × ICC, где m — размер кластера, а ICC — внутрикластерная корреляция. Игнорирование кластеризации повышает точность.</dd></div>
<div class="glossary-term" data-term="crossover-trial"><dt>Crossover Trial</dt>
<dd>Исследование, в котором каждый участник последовательно получает оба препарата (с периодом вымывания). Парный анализ уменьшает дисперсию. Для правильного метааналитического объединения требуется корреляция внутри пациента или парная SE.</dd></div>
<div class="glossary-term" data-term="design-effect"><dt>Design Effect (DEFF)</dt>
<dd>Отношение дисперсии при кластерной выборке к дисперсии при простой случайной выборке. DEFF = 1 + (м-1) × ICC. Используется для корректировки размера выборки и стандартных ошибок кластерных рандомизированных исследований перед объединением в метаанализ.</dd></div>
<div class="glossary-term" data-term="hazard-ratio"><dt>Hazard Ratio (HR)</dt>
<dd>Соотношение уровней опасности между двумя группами в анализе времени до события. HR &lt; 1 благоприятствует лечению. Объединено по логарифмической шкале с использованием взвешивания обратной дисперсии. SE получено из 95% ДИ: SE = (ln(верхний) − ln(нижний)) / 3,92.</dd></div>
<div class="glossary-term" data-term="masem"><dt>MASEM (Meta-Analytic SEM)</dt>
<dd>Метааналитическое моделирование структурными уравнениями. Двухэтапный метод: (1) пуловые корреляционные матрицы между исследованиями, (2) сопоставление модели структурного уравнения с объединенной матрицей. Используется для проверки теоретических моделей траекторий в нескольких исследованиях.</dd></div>
<div class="glossary-term" data-term="nnt"><dt>Number Needed to Treat (NNT)</dt>
<dd>Число пациентов, которых необходимо лечить, чтобы получить выгоду от лечения еще одного пациента. NNT = 1/абсолютное снижение риска. Зависит от базового риска. Всегда сообщайте вместе с OR или RR для клинической интерпретации.</dd></div>
<div class="glossary-term" data-term="power-ma"><dt>Power in Meta-Analysis</dt>
<dd>Вероятность обнаружения истинного эффекта заданного размера. Зависит от количества исследований, размера исследований, гетерогенности (τ²) и размера эффекта. Существуют калькуляторы мощности для метаанализа (например, Валентайн и др., 2010). Немногие исследования с высокой гетерогенностью резко снижают мощность.</dd></div>
</dl>
</div>
</div>
<!-- Keyboard shortcuts help -->
<div aria-label="Keyboard shortcuts" class="keyboard-help" id="keyboardHelp" role="dialog">
<h3>Keyboard Shortcuts</h3>
<div class="keyboard-help-item">
<span>Next slide</span>
<span class="keyboard-help-key">→ or Space</span>
</div>
<div class="keyboard-help-item">
<span>Previous slide</span>
<span class="keyboard-help-key">← or Backspace</span>
</div>
<div class="keyboard-help-item">
<span>Next module</span>
<span class="keyboard-help-key">↓ or N</span>
</div>
<div class="keyboard-help-item">
<span>Previous module</span>
<span class="keyboard-help-key">↑ or P</span>
</div>
<div class="keyboard-help-item">
<span>Переключить панель инструментов</span>
<span class="keyboard-help-key">T</span>
</div>
<div class="keyboard-help-item">
<span>Toggle glossary</span>
<span class="keyboard-help-key">G</span>
</div>
<div class="keyboard-help-item">
<span>This help</span>
<span class="keyboard-help-key">?</span>
</div>
<div class="keyboard-help-item">
<span>Close dialogs</span>
<span class="keyboard-help-key">Esc</span>
</div>
<button class="btn" onclick="toggleKeyboardHelp()" style="margin-top: 1rem; width: 100%;">Close</button>
</div>
<div class="course-container">
<!-- Sidebar Navigation -->
<nav aria-label="Модуль навигации" class="sidebar" role="navigation">
<div class="sidebar-header">
<a href="index.html" onmouseout="this.style.color='rgba(212,175,55,0.7)'" onmouseover="this.style.color='#D4AF37'" style="display:block;font-size:0.7rem;color:rgba(212,175,55,0.7);text-decoration:none;margin-bottom:0.5rem;">← Course Library</a>
<h1>Курс обращения доказательств</h1>
<p>Meta-Analysis Methods</p>
</div>
<div class="module-list" id="moduleList">
 Элементы модуля, созданные JS 
</div>
<!-- Tier Selector -->
<div aria-label="Content depth level" class="tier-selector" role="radiogroup">
<button aria-checked="true" class="tier-btn active" data-tier="foundation" onclick="setTier('foundation')" role="radio">
<span class="tier-icon">🩺</span>Clinician
        </button>
<button aria-checked="false" class="tier-btn" data-tier="researcher" onclick="setTier('researcher')" role="radio">
<span class="tier-icon">🔬</span>Researcher
        </button>
<button aria-checked="false" class="tier-btn" data-tier="methodologist" onclick="setTier('methodologist')" role="radio">
<span class="tier-icon">🧮</span>Methodologist
        </button>
</div>
<div class="sidebar-footer">
<button class="dashboard-btn" onclick="openDashboard()">
<span>📊</span>
<span>Progress Dashboard</span>
<span id="sidebarPoints" style="margin-left: auto; font-weight: 700;">0 pts</span>
</button>
<button class="daily-review-btn" id="dailyReviewBtn" onclick="openDailyReview()">
<span>🧠</span>
<span>Daily Review</span>
<span id="reviewStatus" style="margin-left: auto;">Ready</span>
</button>
<p style="text-align: center; margin-bottom: 0.5rem;">Progress: <span id="progressPercent">0%</span></p>
<button class="btn" onclick="resetProgress()" style="padding: 0.25rem 0.5rem; font-size: 0.7rem; width: 100%;">Reset Progress</button>
</div>
</nav>
 Модальная панель мониторинга прогресса 
<div class="progress-dashboard" id="progressDashboard">
<div class="dashboard-content">
<div class="dashboard-header">
<h2>Your Progress</h2>
<button class="dashboard-close" onclick="closeDashboard()">×</button>
</div>
<div class="level-display">
<div class="level-badge" id="levelBadge">Level 1: Novice</div>
<div class="points-display" id="totalPoints">0</div>
<div class="points-label">Total Points</div>
</div>
<div class="stats-grid">
<div class="stat-card">
<div class="stat-value" id="modulesCompleted">0/25</div>
<div class="stat-label">Modules</div>
</div>
<div class="stat-card">
<div class="stat-value" id="predictionsCorrect">0/0</div>
<div class="stat-label">Predictions</div>
</div>
<div class="stat-card">
<div class="stat-value" id="quizzesCompleted">0</div>
<div class="stat-label">Quizzes</div>
</div>
</div>
<div class="principles-section">
<h3>Семь принципов</h3>
<div id="principlesList"></div>
</div>
<div class="badges-section">
<h3>Badges Earned</h3>
<div class="badges-grid" id="badgesGrid"></div>
</div>
<div class="streak-section">
<h3>Learning Streak</h3>
<div class="streak-display">
<div class="streak-flame" id="streakFlame">🔥</div>
<div class="streak-info">
<div class="streak-count" id="streakCount">0 days</div>
<div class="streak-label">Keep learning daily!</div>
</div>
</div>
</div>
</div>
</div>
 Модальное окно ежедневного обзора 
<div aria-label="Ежедневный обзор" class="daily-review-modal" id="dailyReviewModal" role="dialog">
<div class="daily-review-content">
<div class="daily-review-header">
<h2>📚 Daily Review</h2>
<button class="daily-review-close" onclick="closeDailyReview()">×</button>
</div>
<div class="review-timer">
<div class="timer-display" id="reviewTimer">2:00</div>
<div class="timer-label">Укрепите свою память</div>
</div>
<div class="review-progress" id="reviewProgress">
<!-- Progress dots inserted by JS -->
</div>
<div id="reviewCardContainer">
 Обзор карточек, вставленных JS 
</div>
<div class="review-actions" id="reviewActions">
<button class="review-btn skip" onclick="skipDailyReview()">Пропустить на сегодня</button>
<button class="review-btn next" disabled="" id="reviewNextBtn" onclick="nextReviewQuestion()">Continue</button>
</div>
</div>
</div>
<!-- Main Content -->
<main class="main-content">
<header class="content-header">
<div class="breadcrumb">
          Module <span id="currentModuleNum">0</span>: <span id="currentModuleName">The Opening</span>
</div>
<div class="header-actions">
<button class="btn" onclick="toggleToolsPanel()">Tools</button>
<button class="btn primary" onclick="nextModule()">Next Module</button>
</div>
</header>
<div class="content-body">
<!-- Accessibility: Screen reader announcements for slide changes -->
<div aria-atomic="true" aria-live="polite" class="sr-only" id="slideAnnouncer"></div>
<!-- Slides Container -->
<div aria-label="Слайды курса" class="slides-container" id="main-content" role="region">
 Модуль 0: Открытие 
<div class="module-slides active" data-module="0">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 0: Открытие</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Дать определение метаанализу и объяснить его роль в синтезе доказательств.</li>
<li>Определите, когда исследования НЕ следует объединять</li>
<li>Опишите иерархию доказательств и место проведения систематических обзоров.</li>
<li>Recognize that meta-analysis can mislead when done poorly</li>
<li>Вспомните семь принципов, лежащих в основе этого курса.</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">Этот курс существует, потому что</p>
<p class="title gold animate delay-1 text-center">медицина ошиблась.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                Ни разу. Не редко. Неоднократно. Такими способами, которые убивали пациентов, которые верили в достоверность доказательств.
              </p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">What is Meta-Analysis?</h2>
<div class="card animate delay-1">
<p class="card-text text-center">
                    Статистический метод объединения результатов нескольких независимых исследований, посвященных одному и тому же вопросу.
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">1976</div>
<div class="stat-label">Term coined by Gene Glass</div>
</div>
<div class="stat-box">
<div class="stat-value">~50,000</div>
<div class="stat-label">Published per year</div>
</div>
<div class="stat-box">
<div class="stat-value">#1</div>
<div class="stat-label">Evidence hierarchy*</div>
</div>
</div>
<p class="footnote animate delay-3">*When well conducted. Quality of conduct matters more than study design alone — as GRADE recognizes.</p>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Почему бассейновые исследования?</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Increase Statistical Power</h4>
<p>Individual studies may be too small to detect effects.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Improve Precision</h4>
<p>Narrower confidence intervals around effect estimates.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Resolve Disagreement</h4>
<p>Когда исследования конфликтуют, объединение может прояснить сигнал.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Explore Heterogeneity</h4>
<p>Identify why effects differ across populations or settings.</p>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="title cream animate text-center">But meta-analysis can also</p>
<p class="big-number gold animate delay-1">MISLEAD</p>
<p class="animate delay-2" style="font-size: 1.1rem; text-align: center; max-width: 600px; margin-top: 1rem;">
                When done poorly, it amplifies bias rather than truth.
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Когда НЕ объединяться в пул</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p>Исследования измеряют принципиально разные вещи (яблоки и апельсины)</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p>Extreme heterogeneity that cannot be explained</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p>One study dominates all others (megastudy problem)</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p>Исследования имеют высокий риск предвзятости, которую невозможно скорректировать с учетом</p>
</div>
<div class="focus-box animate delay-5 mt-2">
<p class="main">Объединение в пулы — это привилегия, а не право.</p>
<p class="sub">The decision to combine must be defended.</p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">Иерархия доказательств</h2>
<div style="max-width: 600px; margin-top: 1.5rem;">
<div class="card animate delay-1" style="background: var(--gold); color: var(--navy);">
<p class="card-text text-center" style="font-weight: 700;">Systematic Reviews &amp; Meta-Analyses of RCTs</p>
</div>
<div class="card animate delay-2">
<p class="card-text text-center">Randomized Controlled Trials</p>
</div>
<div class="card animate delay-3">
<p class="card-text text-center">Cohort Studies</p>
</div>
<div class="card animate delay-4">
<p class="card-text text-center">Case-Control Studies</p>
</div>
<div class="card animate delay-5">
<p class="card-text text-center">Case Series / Expert Opinion</p>
</div>
</div>
<p class="footnote animate delay-5">Положение в иерархии зависит от качества методологии, а не только от типа исследования.</p>
</div>
</div>
<div class="slide dark" data-index="7">
<p class="title cream animate text-center">Этот курс преподает через</p>
<p class="title gold animate delay-1 text-center">evidence reversals.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1rem; text-align: center; max-width: 700px;">
                Каждый модуль открывается рассказом о том, как медицина ошиблась. Затем мы изучаем метод, который позволил бы предотвратить вред.
              </p>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Семь принципов</h2>
<p class="animate delay-1" style="font-style: italic; margin-bottom: 1.5rem;">
                  Эти фразы будут возвращаться на протяжении всего вашего путешествия:
                </p>
<div style="text-align: left; max-width: 700px;">
<p class="animate delay-1" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">1.</span> «Не каждый сигнал является правдой».</p>
<p class="animate delay-2" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">2.</span> «Методы защищают пациентов от нашего доверия».</p>
<p class="animate delay-3" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">3.</span> "What was hidden in plain sight?"</p>
<p class="animate delay-3" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">4.</span> «Число без происхождения — не число».</p>
<p class="animate delay-4" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">5.</span> «Неоднородность — это сообщение, а не шум».</p>
<p class="animate delay-4" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">6.</span> «Отсутствие доказательств не является доказательством отсутствия».</p>
<p class="animate delay-5" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">7.</span> "Certainty must be earned, not assumed."</p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Module 0 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q0-1">
<h4>1. Почему иногда НЕ следует объединять исследования в метаанализ?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 0, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>A.</span> Pooling is always better than single studies
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 1, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>B.</span> When heterogeneity is extreme or studies measure different things
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 2, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>C.</span> Pooling is always appropriate for RCTs
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 3, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>D.</span> Statistical methods handle any situation
                      </div>
</div>
<div id="q0-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q0-2" style="margin-top: 1.5rem;">
<h4>2. Какое место в иерархии доказательств занимают систематические обзоры РКИ?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 0, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>A.</span> At the top
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 1, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>B.</span> Same level as individual RCTs
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 2, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>C.</span> Ниже когортных исследований
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 3, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>D.</span> Same as expert opinion
                      </div>
</div>
<div id="q0-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="10">
<p class="refrain animate">Начните путешествие.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 1: Вопрос</p>
</div>
<!-- Slide nav generated by JS -->
</div>
 Модуль 1: Вопрос (CAST) 
<div class="module-slides" data-module="1">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Это не история об ошибке.</p>
<p class="title gold animate delay-1 text-center">Это история об уверенности.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 1: Вопрос</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Сформулируйте конкретный вопрос PICO для систематического обзора.</li>
<li>Distinguish surrogate outcomes from patient-important outcomes</li>
<li>Explain why biological plausibility alone is insufficient evidence</li>
<li>Описать исследование CAST и его значение для доказательной медицины.</li>
<li>Применяйте принцип: «Не всякий яркий знак является руководством»</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">~9,000</p>
<p class="subtitle animate delay-1">excess deaths per year</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">From a treatment everyone believed worked.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">Это история о том, как мы верили – и как мы ошибались.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Observation</h2>
<div class="card animate delay-1">
<p class="card-text text-center">Patients with frequent PVCs after MI had 2-5x higher mortality.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">400,000+</div>
<div class="stat-label">MI survivors/year</div>
</div>
<div class="stat-box">
<div class="stat-value">~40%</div>
<div class="stat-label">со значительными ЖЭ</div>
</div>
<div class="stat-box">
<div class="stat-value">160,000</div>
<div class="stat-label">at elevated risk</div>
</div>
</div>
<p class="footnote animate delay-3">A massive clinical need. A clear target.</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">The Response</h2>
<p class="animate delay-1" style="font-size: 1.2rem; text-align: center; margin: 1rem 0;">
                  Antiarrhythmic drugs were developed, FDA approved,<br/>and prescribed to ~200,000 patients per year.
                </p>
<div class="focus-box animate delay-2">
<p class="main">В этой истории не фигурирует ни один злодей.</p>
<p class="sub">Все действовали на основании имеющихся доказательств.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Логика, которая убедила всех</h2>
<div class="card animate delay-1">
<div class="card-label">PREMISE 1</div>
<p class="card-text">PVCs after MI predict sudden cardiac death</p>
</div>
<div class="arrow animate delay-1">↓</div>
<div class="card animate delay-2">
<div class="card-label">PREMISE 2</div>
<p class="card-text">Antiarrhythmic drugs suppress PVCs</p>
</div>
<div class="arrow animate delay-2">↓</div>
<div class="card animate delay-3">
<div class="card-label">PREMISE 3</div>
<p class="card-text">Suppressing PVCs should prevent sudden death</p>
</div>
<div class="arrow animate delay-3">↓</div>
<div class="card navy-bg animate delay-4">
<div class="card-label">CONCLUSION</div>
<p class="card-text">Antiarrhythmics save lives in post-MI patients</p>
</div>
<p class="footnote animate delay-5">Цепочка была логичной. Вывод казался неизбежным.</p>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">CAST: The Cardiac Arrhythmia Suppression Trial</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1.5rem;">
                  Finally, someone asked: "Does suppressing PVCs actually save lives?"
                </p>
<div class="design-grid animate delay-2">
<div class="design-item">
<div class="design-item-label">Design</div>
<div class="design-item-value">Randomized, double-blind, placebo-controlled</div>
</div>
<div class="design-item">
<div class="design-item-label">Population</div>
<div class="design-item-value">Post-MI patients with asymptomatic PVCs</div>
</div>
<div class="design-item">
<div class="design-item-label">Intervention</div>
<div class="design-item-value">Encainide, flecainide, or moricizine vs placebo</div>
</div>
<div class="design-item">
<div class="design-item-label">Run-in</div>
<div class="design-item-value">Only patients with ≥80% PVC suppression randomized</div>
</div>
<div class="design-item">
<div class="design-item-label">Primary endpoint</div>
<div class="design-item-value">Death or cardiac arrest with resuscitation</div>
</div>
<div class="design-item">
<div class="design-item-label">Sample size</div>
<div class="design-item-value">1,498 patients (encainide/flecainide arms)</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">Результаты: апрель 1989 г.</h2>
<p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">
                  Совет по мониторингу безопасности данных досрочно прекращает судебное разбирательство.
                </p>
<table class="results-table animate delay-2">
<thead>
<tr>
<th>Outcome</th>
<th>Drug (n=755)</th>
<th>Placebo (n=743)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Arrhythmic deaths</td>
<td class="highlight">33</td>
<td>9</td>
</tr>
<tr>
<td>All cardiac deaths</td>
<td class="highlight">43</td>
<td>16</td>
</tr>
<tr>
<td>Total deaths</td>
<td class="highlight">56</td>
<td>22</td>
</tr>
<tr>
<td><strong>Death rate</strong></td>
<td class="highlight">7.4%</td>
<td><strong>3.0%</strong></td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">Relative Risk of Death: 2.5</div>
<div class="label">95% CI: 1.6 - 4.5 | p &lt; 0.001</div>
</div>
<p class="footnote animate delay-4">Препараты, прекрасно подавлявшие аритмии, повышали смертность на 150%.</p>
</div>
</div>
<div class="slide dark" data-index="8">
<div class="content">
<h2 class="title cream animate">Человеческая цена</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">Before CAST, ~200,000 Americans per year received these drugs.</p>
<p class="big-number gold animate delay-2">~9,000</p>
<p class="animate delay-2" style="font-size: 1.25rem;">excess deaths per year - possibly more</p>
<div class="animate delay-3" style="background: rgba(45,58,95,0.8); padding: 1rem 2rem; text-align: center; margin: 1rem 0;">
<p style="color: var(--cream);">Vietnam War: ~6,000 US deaths/year • These drugs: ~9,000+ deaths/year</p>
</div>
<p class="serif animate delay-4" style="font-style: italic; color: var(--gold); margin-top: 1.5rem; text-align: center;">
                  For every number, a name we will never know.
                </p>
</div>
</div>
<div class="slide black" data-index="9">
<p class="serif animate" style="font-size: clamp(2rem, 5vw, 3rem);">Look again.</p>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Логика - Возвращение</h2>
<div class="card animate delay-1">
<div class="card-label">PREMISE 1</div>
<p class="card-text">PVCs after MI predict sudden cardiac death</p>
</div>
<div class="arrow animate delay-1">↓</div>
<div class="card-wrapper animate delay-2">
<div class="card">
<div class="card-label">PREMISE 2</div>
<p class="card-text">Antiarrhythmic drugs suppress PVCs</p>
</div>
<div class="leap-badge">← THE LEAP</div>
</div>
<div class="arrow animate delay-2">↓</div>
<div class="card red-border animate delay-3">
<div class="card-label">PREMISE 3</div>
<p class="card-text">Suppressing PVCs should prevent sudden death</p>
</div>
<div class="arrow animate delay-3">↓</div>
<div class="card navy-bg animate delay-4">
<div class="card-label">CONCLUSION</div>
<p class="card-text">Antiarrhythmics save lives in post-MI patients</p>
</div>
<p class="footnote animate delay-5">Предположение о том, что подавление маркера исправит результат, никогда не проверялось.</p>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">What Went Wrong: The Surrogate Trap</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p>ЖЭ были маркером поврежденной ткани, а не причиной смерти</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p>The drugs had proarrhythmic effects - triggering deadlier rhythms</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p>Суррогатная мать улучшилась, а исход ухудшился - диссоциированный суррогат</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">Суррогатная мать не лгала. Мы задали неправильный вопрос.</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Структура PICO</h2>
<p class="animate delay-1" style="margin-bottom: 1.5rem; font-style: italic;">
                  Every answerable clinical question has four components:
                </p>
<div class="design-grid" style="grid-template-columns: repeat(2, 1fr);">
<div class="design-item animate delay-1" style="border-left-color: var(--navy);">
<div class="design-item-label" style="color: var(--navy);">P - POPULATION</div>
<div class="design-item-value">Кто пациенты? Каковы их характеристики?</div>
</div>
<div class="design-item animate delay-2" style="border-left-color: var(--green);">
<div class="design-item-label" style="color: var(--green);">I - INTERVENTION</div>
<div class="design-item-value">What treatment or exposure is being evaluated?</div>
</div>
<div class="design-item animate delay-3" style="border-left-color: var(--red);">
<div class="design-item-label" style="color: var(--red);">C - COMPARATOR</div>
<div class="design-item-value">What is the alternative? Placebo? Standard care?</div>
</div>
<div class="design-item animate delay-4" style="border-left-color: var(--gold);">
<div class="design-item-label" style="color: var(--gold);">O - OUTCOME</div>
<div class="design-item-value">What matters to patients? Hard endpoints vs surrogates.</div>
</div>
</div>
<div class="result-box animate delay-5" style="margin-top: 1.5rem;">
<div class="label">CAST PICO</div>
<div class="value" style="font-size: 1rem; line-height: 1.5;">
                    Post-MI patients with PVCs | Antiarrhythmics | Placebo | Mortality
                  </div>
</div>
</div>
</div>
<!-- CAST Investigation Exercise -->
<div class="slide dark" data-index="13">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Исследовательское упражнение: доказательства до CAST</h3>
</div>
<p class="direct-address">Вы работаете кардиологом в 1988 году. Пациент пережил ИМ, но у него часты ЖЭ. Данные наблюдательной литературы ясны...</p>
<table class="data-table-investigation">
<thead>
<tr><th>Study</th><th>Пациенты с ЖЭ</th><th>Mortality Risk</th></tr>
</thead>
<tbody>
<tr><td>Lown (1977)</td><td>High-grade PVCs</td><td>2.4x higher</td></tr>
<tr><td>Bigger (1984)</td><td>&gt;10 PVCs/hour</td><td>3.1x higher</td></tr>
<tr><td>Mukharji (1984)</td><td>Complex PVCs</td><td>4.8x higher</td></tr>
</tbody>
</table>
<p class="rhetorical" style="margin-top: 1rem;">Сигнал четкий. Механизм правдоподобен. Вы бы прописали антиаритмические препараты?</p>
<button class="reveal-btn" onclick="revealAnswer('cast-reveal')">See What CAST Revealed →</button>
<div class="hidden-reveal" id="cast-reveal">
<div class="comparison-grid">
<div class="comparison-panel">
<h4>Before: Observational Logic</h4>
<p>PVCs → Higher mortality</p>
<p>Drugs suppress PVCs</p>
<p><strong>∴ Drugs should reduce mortality</strong></p>
</div>
<div class="comparison-panel after">
<h4>After: CAST RCT (1989)</h4>
<p>Death rate on drug: <strong style="color: var(--red);">7.4%</strong></p>
<p>Death rate on placebo: <strong>3.0%</strong></p>
<p><strong style="color: var(--red);">RR = 2.5 (150% increase in deaths)</strong></p>
</div>
</div>
<p style="margin-top: 1rem; font-style: italic; color: var(--gold);">Суррогатная мать улучшилась. Больные умерли. Вот почему мы спрашиваем: «Какой результат имеет значение?»</p>
</div>
</div>
</div>
<div class="slide light" data-index="14">
<div class="content">
<h2 class="title navy animate">Уроки синтеза доказательств</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Биологическое правдоподобие не является доказательством</h4>
<p>A logical mechanism doesn't guarantee the expected effect.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Surrogate endpoints can mislead</h4>
<p>Improving a biomarker doesn't prove improvement in outcomes.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Рандомизированные исследования предоставляют самые убедительные причинно-следственные доказательства</h4>
<p>Только данные наблюдений редко устанавливает причинно-следственную связь для вмешательства из-за смешивания факторов.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Консенсус не является доказательством</h4>
<p>200 000 рецептов, одобрение FDA и рекомендации были неправильными.</p>
</div>
</div>
<p class="serif animate delay-5" style="font-style: italic; color: var(--gold); margin-top: 1.5rem; text-align: center;">
                  This is why we do meta-analysis: to see past apparent truths.
                </p>
</div>
</div>
 ИСТОРИЯ: Суррогат DES-II Трагедия 
<div class="slide dark" data-index="14b">
<div class="story-box animate">
<p class="story-opener">Что, если вопрос, который вы задаете, определяет, кто выживет, а кто умрет?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    В 1989 году кардиологи знали, что <span class="data-highlight">подавление ПВХ достижимо</span> с помощью энкаинида и флекаинида. Суррогатный конечный результат выглядел идеально: лекарства подавляли ЖЭ на <span class="data-highlight">80%+</span>.
                    But CAST randomized <span class="data-highlight">1,498 patients</span> активное лекарство по сравнению с плацебо. Исследование было остановлено досрочно: <span class="data-highlight">56 deaths in the drug group vs 22 in placebo</span>.
                    Mortality increased <span class="data-highlight">2.5-fold</span>.
                    An estimated <span class="data-highlight">~9,000 excess American deaths per year</span> было связано с этими препаратами.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Выбор кардиолога: 1987</div>
<div class="decision-scenario">
                    У вашего пациента после ИМ часто наблюдаются ЖЭ. У вас есть лекарства, которые полностью их подавляют. Что вы делаете?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">ПУТЬ A: Лечите суррогатную мать</div>
<div class="path-choice">Prescribe encainide — PVCs vanish, the ECG looks clean</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Биомаркер улучшается. Вы чувствуете себя уверенно. Пациент умирает.</div>
<div class="path-outcome">OUTCOME: An estimated 50,000+ excess deaths across the US during years of use</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Demand a Mortality Trial</div>
<div class="path-choice">Настаивайте: «Покажите мне, что выживаемость улучшается, а не только ЭКГ»</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Исследование выявило вред. Препараты отменяются. Жизни спасены.</div>
<div class="path-outcome">РЕЗУЛЬТАТ: Правильный вопрос PICO предотвращает катастрофу</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Вопрос никогда не был «Можем ли мы подавить ЖЭ?» Это было «Спасает ли подавление ПВХ жизни?» Суррогатная конечная точка ответила не на тот вопрос. Правильный PICO с самого начала потребовал бы смертность как исход.
                  </div>
</div>
</div>
</div>
<div class="slide dark" data-index="14">
<p class="closing-line animate">What appears certain may be wrong.</p>
<p class="closing-line animate delay-1">What everyone believes may be false.</p>
<p class="closing-line gold animate delay-2">Существуют методы, позволяющие пациентам не платить за наше доверие.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">Вот почему вы здесь.</p>
</div>
<!-- Module 1 Quiz -->
<div class="slide light" data-index="16">
<div class="content">
<h2 class="title navy animate">Module 1 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q1-1">
<h4>1. В чем заключалась фундаментальная ошибка антиаритмической логики?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 0, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>A.</span> Испытания не были рандомизированными
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 1, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>B.</span> Treating a surrogate (PVCs) was assumed to improve outcomes
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 2, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>C.</span> Размер выборки был слишком мал
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 3, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>D.</span> Одобрение FDA было поспешным
                      </div>
</div>
<div id="q1-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q1-2">
<h4>2. Что означает буква «О» в PICO и почему она имеет значение?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 0, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>A.</span> Observation - what researchers see
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 1, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>B.</span> Цель – цель исследования
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 2, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>C.</span> Outcome - what matters to patients
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 3, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>D.</span> Организация – структура исследования
                      </div>
</div>
<div id="q1-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="17">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">
                Методы защищают пациентов от нашего доверия.
              </p>
</div>
</div>
 Модуль 2: Протокол (HRT) 
<div class="module-slides" data-module="2">
<div class="slide dark active" data-index="0">
<p class="refrain animate">What was hidden in plain sight?</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Это история о</p>
<p class="title gold animate delay-1 text-center">observational evidence.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 2: Протокол</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Explain why protocol pre-registration prevents bias</li>
<li>Identify key elements of a PROSPERO registration</li>
<li>Distinguish healthy user bias from true treatment effects</li>
<li>Describe why observational studies overestimated HRT benefits</li>
<li>Применяйте принцип: «Методы защищают пациентов от нашего доверия»</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">30+</p>
<p class="subtitle animate delay-1">observational studies</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">
                All showing hormone replacement therapy protected postmenopausal women from heart disease.
              </p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">Доказательства казались неопровержимыми. Вывод казался однозначным.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Исследование здоровья медсестер</h2>
<div class="card animate delay-1">
<p class="card-text text-center">122,000 nurses followed for decades. HRT users had 40-50% lower cardiovascular mortality.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">RR 0.56</div>
<div class="stat-label">Cardiovascular mortality</div>
</div>
<div class="stat-box">
<div class="stat-value">122,000</div>
<div class="stat-label">Women followed</div>
</div>
<div class="stat-box">
<div class="stat-value">20+ years</div>
<div class="stat-label">Follow-up</div>
</div>
</div>
<p class="footnote animate delay-3">Landmark study. Impeccable methodology. Wrong conclusion.</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Скрытая предвзятость</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Healthy User Bias:</strong> Women who chose HRT were healthier, wealthier, better educated</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Compliance Bias:</strong> Women who took HRT consistently also took better care of themselves</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>Prescriber Bias:</strong> Doctors gave HRT to healthier women with fewer risk factors</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">Лечение не защищало их. Они уже были защищены.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">WHI: The Women's Health Initiative</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1.5rem;">
                  The largest randomized trial of HRT ever conducted.
                </p>
<div class="design-grid animate delay-2">
<div class="design-item">
<div class="design-item-label">Design</div>
<div class="design-item-value">Randomized, double-blind, placebo-controlled</div>
</div>
<div class="design-item">
<div class="design-item-label">Population</div>
<div class="design-item-value">Postmenopausal women aged 50-79</div>
</div>
<div class="design-item">
<div class="design-item-label">Intervention</div>
<div class="design-item-value">Estrogen + Progestin vs Placebo</div>
</div>
<div class="design-item">
<div class="design-item-label">Sample size</div>
<div class="design-item-value">16,608 women</div>
</div>
<div class="design-item">
<div class="design-item-label">Primary endpoint</div>
<div class="design-item-value">Coronary heart disease</div>
</div>
<div class="design-item">
<div class="design-item-label">Planned duration</div>
<div class="design-item-value">8.5 years</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">Результаты: июль 2002 г.</h2>
<p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">
                  Trial stopped early after 5.2 years. Harm exceeded benefits.
                </p>
<table class="results-table animate delay-2">
<thead>
<tr>
<th>Outcome</th>
<th>Hazard Ratio</th>
<th>Direction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Coronary heart disease</td>
<td class="highlight">1.29</td>
<td class="highlight">HARM</td>
</tr>
<tr>
<td>Stroke</td>
<td class="highlight">1.41</td>
<td class="highlight">HARM</td>
</tr>
<tr>
<td>Breast cancer</td>
<td class="highlight">1.26</td>
<td class="highlight">HARM</td>
</tr>
<tr>
<td>Pulmonary embolism</td>
<td class="highlight">2.13</td>
<td class="highlight">HARM</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">Complete Reversal</div>
<div class="label">30-летние данные наблюдений отменены</div>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<p class="title cream animate">The Lesson</p>
<p class="big-number gold animate delay-1" style="font-size: clamp(2rem, 8vw, 5rem);">PRE-SPECIFY</p>
<p class="animate delay-2" style="font-size: 1.1rem; text-align: center; max-width: 600px; margin-top: 1rem;">
                A protocol written before the search begins prevents fishing, prevents bias, prevents hindsight distortion.
              </p>
</div>
 ИСТОРИЯ: Гипотеза гормонального времени 
<div class="slide dark" data-index="7b">
<div class="story-box animate">
<p class="story-opener">Что, если лечение сработает, но только для некоторых?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    WHI showed HRT <span class="data-highlight">increased cardiovascular events overall</span>.
                    But later analyses revealed a critical pattern: women who started HRT
                    <span class="data-highlight">within 10 years of menopause</span> had
                    <span class="data-highlight">REDUCED cardiovascular risk</span>.
                    Women starting <span class="data-highlight">20+ years after menopause</span> had
                    <span class="data-highlight">INCREASED risk</span>.
                    The overall null/harm result hid a timing effect.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Дилемма аналитика</div>
<div class="decision-scenario">
                    Вы анализируете подгруппы WHI. Общий результат показывает вред. Вы копаете глубже?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Report Overall Only</div>
<div class="path-choice">Conclude HRT is harmful for all postmenopausal women</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Simple message. Guidelines recommend against HRT universally.</div>
<div class="path-outcome">OUTCOME: Deny potential benefit to younger menopausal women</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Pre-Specify Timing Subgroups</div>
<div class="path-choice">Analyze by years since menopause (biologically plausible)</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Откройте для себя «временное окно» для безопасного начала ЗГТ.</div>
<div class="path-outcome">OUTCOME: Enable personalized recommendations</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Анализ подгрупп опасен при ловле. Это важно, когда биология предсказывает изменение эффекта. Гипотеза о времени была биологически правдоподобной и должна была быть заранее определена.
                  </div>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">PROSPERO Registration</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Зарегистрируйтесь, прежде чем искать</h4>
<p>PROSPERO: International prospective register of systematic reviews</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Заблокируйте свои решения</h4>
<p>PICO, search strategy, outcomes, analysis plan - all pre-specified</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Document Amendments</h4>
<p>Изменения разрешены, но должны быть прозрачными и обоснованными.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Prevent Duplication</h4>
<p>Прежде чем начать, проверьте, существует ли ваш отзыв.</p>
</div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Module 2 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q2-1">
<h4>1. Почему исследование здоровья медсестер показало пользу от ЗГТ, а WHI – нет?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 0, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>A.</span> Nurses' Health had too few patients
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 1, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>B.</span> Healthy user bias in observational studies
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 2, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>C.</span> Nurses' Health had shorter follow-up
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 3, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>D.</span> Different hormone formulations were used
                      </div>
</div>
<div id="q2-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q2-2" style="margin-top: 1.5rem;">
<h4>2. What is the primary purpose of PROSPERO registration?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 0, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>A.</span> To register clinical trials
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 1, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>B.</span> Чтобы ускорить завершение проверки
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 2, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>C.</span> Предварительное определение методов и предотвращение предвзятости
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 3, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>D.</span> Чтобы получить финансирование на обзоры
                      </div>
</div>
<div id="q2-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="10">
<p class="closing-line animate">Предварительное уточнение – это не бюрократия.</p>
<p class="closing-line animate delay-1">It is protection.</p>
<p class="closing-line gold animate delay-2">Against our own tendency to find what we expect.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">Методы защищают пациентов от нашего доверия.</p>
</div>
<div class="slide black" data-index="11">
<p class="refrain animate">What was hidden in plain sight?</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 3: Поиск</p>
</div>
</div>
 Модуль 3: Поиск (Росиглитазон) 
<div class="module-slides" data-module="3">
<div class="slide dark active" data-index="0">
<p class="refrain animate">What was hidden in plain sight?</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Это история о</p>
<p class="title gold animate delay-1 text-center">what they didn't publish.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 3: Поиск</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Develop a comprehensive search strategy using PRESS guidelines</li>
<li>Search multiple databases including grey literature sources</li>
<li>Identify trial registries and regulatory databases (ClinicalTrials.gov, FDA)</li>
<li>Explain how the rosiglitazone case exposed hidden cardiovascular harms</li>
<li>Примените принцип: «Что было скрыто на виду?»</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">$3.2B</p>
<p class="subtitle animate delay-1">annual sales at peak</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">Авандия (росиглитазон) была одним из самых продаваемых в мире лекарств от диабета.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">Опубликованные испытания выглядели обнадеживающими. Неопубликованные материалы рассказывали другую историю.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Опубликованные доказательства (до 2007 г.)</h2>
<div class="card animate delay-1">
<p class="card-text text-center">Published trials showed rosiglitazone effectively lowered HbA1c. Cardiovascular outcomes were rarely reported.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">1999</div>
<div class="stat-label">FDA approval</div>
</div>
<div class="stat-box">
<div class="stat-value">6M+</div>
<div class="stat-label">Patients treated</div>
</div>
<div class="stat-box">
<div class="stat-value">~0.7%</div>
<div class="stat-label">HbA1c reduction</div>
</div>
</div>
<p class="footnote animate delay-3">Суррогатная мать выглядела хорошо. Но как насчет реальных сердечно-сосудистых событий?</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Nissen's Discovery: May 2007</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1rem;">Доктор Стивен Ниссен получил неопубликованные данные испытаний с собственного сайта GSK.</p>
<div class="card animate delay-2">
<p class="card-text text-center">В соответствии с юридическим соглашением компания GSK была обязана опубликовать результаты клинических испытаний в Интернете. Ниссен и Вольски проанализировали 42 исследования, многие из которых никогда не публиковались в журналах.</p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">Данные были технически общедоступными.</p>
<p class="sub">No one had systematically searched for it.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Результаты метаанализа</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>Outcome</th>
<th>Odds Ratio</th>
<th>95% CI</th>
</tr>
</thead>
<tbody>
<tr>
<td>Myocardial Infarction</td>
<td class="highlight">1.43</td>
<td class="highlight">1.03 - 1.98</td>
</tr>
<tr>
<td>CV Death</td>
<td>1.64</td>
<td>0.98 - 2.74</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-2">
<div class="value">43% Increased Risk of Heart Attack</div>
<div class="label">р = 0,03 для инфаркта миокарда</div>
</div>
<p class="footnote animate delay-3">Published in NEJM. The FDA called an emergency advisory committee meeting.</p>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="content">
<h2 class="title cream animate">The FDA Advisory Committee: July 2007</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">22-1</div>
<div class="stat-label">Voted: CV risk exists</div>
</div>
<div class="stat-box">
<div class="stat-value">20-3</div>
<div class="stat-label">Оставайтесь на рынке с предупреждениями</div>
</div>
</div>
<p class="animate delay-2" style="margin-top: 1.5rem; text-align: center;">Комитет разделился. Некоторые хотели его отозвать. Некоторые назвали метаанализ ошибочным.</p>
<p class="animate delay-3" style="margin-top: 1rem; font-size: 1.1rem; text-align: center; color: var(--gold);">Но сигнал нельзя было не заметить.</p>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">The Aftermath</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Black box warning</strong> added for heart failure risk (2007)</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Severe restrictions</strong> on prescribing in the US (2010)</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>Withdrawn</strong> полностью с европейского рынка (2010 г.)</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>FDA now requires</strong> cardiovascular outcome trials for all diabetes drugs</p>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">What a Comprehensive Search Requires</h2>
<div class="design-grid animate delay-1">
<div class="design-item">
<div class="design-item-label">PUBLISHED</div>
<div class="design-item-value">PubMed, Embase, CENTRAL, Web of Science</div>
</div>
<div class="design-item">
<div class="design-item-label">GREY LITERATURE</div>
<div class="design-item-value">Conference abstracts, dissertations, regulatory docs</div>
</div>
<div class="design-item">
<div class="design-item-label">TRIAL REGISTRIES</div>
<div class="design-item-value">ClinicalTrials.gov, WHO ICTRP, EU CTR</div>
</div>
<div class="design-item">
<div class="design-item-label">REGULATORY</div>
<div class="design-item-value">FDA, EMA, Health Canada submissions</div>
</div>
<div class="design-item">
<div class="design-item-label">COMPANY DATA</div>
<div class="design-item-value">GSK, Pfizer, Roche clinical trial registries</div>
</div>
<div class="design-item">
<div class="design-item-label">HAND SEARCH</div>
<div class="design-item-value">Reference lists, contact authors, experts</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Контрольный список для прессы</h2>
<p class="animate delay-1" style="font-style: italic; margin-bottom: 1rem;">Peer Review of Electronic Search Strategies</p>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Перевод исследовательского вопроса</h4>
<p>Отражает ли поиск PICO элементы?</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Булевы операторы и операторы близости</h4>
<p>Правильно ли используются И, ИЛИ, НЕ?</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Subject Headings</h4>
<p>Подходят ли термины MeSH/Emtree и развернуты ли они?</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Text Words</h4>
<p>Synonyms, spelling variants, truncation?</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">PRESS Checklist (continued)</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">5</div>
<div class="lesson-content">
<h4>Spelling, Syntax, Line Numbers</h4>
<p>Есть ли ошибки, которые могут привести к извлечению сбои?</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">6</div>
<div class="lesson-content">
<h4>Ограничения и фильтры</h4>
<p>Соответствуют ли дата, язык, ограничения дизайна исследования?</p>
</div>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">Peer-reviewed searches substantially improve retrieval of key studies.</p>
<p class="sub">PRESS guideline: McGowan et al., 2016</p>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Database Translation</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">Один и тот же поиск должен быть адаптирован для каждой базы данных:</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 700px;">
<div class="card animate delay-2">
<div class="card-label">PubMed</div>
<p class="card-text" style="font-family: monospace; font-size: 0.8rem;">"diabetes mellitus, type 2"[MeSH] OR "type 2 diabetes"[tiab]</p>
</div>
<div class="card animate delay-3">
<div class="card-label">Embase</div>
<p class="card-text" style="font-family: monospace; font-size: 0.8rem;">'non insulin dependent diabetes mellitus'/exp OR 'type 2 diabetes':ti,ab</p>
</div>
</div>
<p class="footnote animate delay-4">Subject headings, field tags, and operators differ between databases.</p>
</div>
</div>
 ИСТОРИЯ: Прозрачность Тамифлю Кампания 
<div class="slide dark" data-index="12b">
<div class="story-box animate">
<p class="story-opener">Что происходит, когда вы ищете и ничего не находите?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    Governments stockpiled <span class="data-highlight">$9 billion</span> осельтамивира (Тамифлю) для лечения пандемического гриппа. Кокрановское сотрудничество попыталось проанализировать доказательства. Of <span class="data-highlight">77 clinical trials</span>,
                    full reports existed for only <span class="data-highlight">20</span>. «Рош» отказалась предоставить данные для <span class="data-highlight">5 years</span>. Когда BMJ и Кокрейн наконец получили <span class="data-highlight">over 160,000 pages</span> of clinical study reports,
                    they found: Tamiflu reduced symptoms by <span class="data-highlight">less than 1 day</span>,
                    with <span class="data-highlight">no evidence</span> it prevented hospitalizations or complications.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Дилемма рецензента: 2009</div>
<div class="decision-scenario">
                    Вы обновляете Кокрейновский обзор Тамифлю. Опубликованные исследования выглядят позитивно. Но по 57 испытаниям нет доступных полных отчетов. Чем вы занимаетесь?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Analyze What's Published</div>
<div class="path-choice">Use the 20 available trials. Conclude Tamiflu is effective.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Ваш обзор поддерживает дальнейшее накопление запасов. 9 миллиардов долларов потрачено на слабые доказательства.</div>
<div class="path-outcome">OUTCOME: Billions wasted, true efficacy unknown</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">ПУТЬ B: Требование полных данных</div>
<div class="path-choice">Refuse to publish until all trial data is accessible</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">5-year campaign. 160,000+ pages finally obtained. Truth emerges.</div>
<div class="path-outcome">OUTCOME: Evidence policy changed; EMA now publishes all trial reports</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Поиск хорош настолько, насколько хорошо то, что можно найти. Когда серая литература спрятана за корпоративными стенами, даже самый полный поиск в PubMed упустит истину. Сага о Тамифлю изменила глобальную политику: теперь EMA публикует отчеты о клинических исследованиях всех лекарств.
                  </div>
</div>
</div>
</div>
<div class="slide dark" data-index="12">
<p class="closing-line animate">If Nissen had searched only PubMed,</p>
<p class="closing-line animate delay-1">the signal would have remained hidden.</p>
<p class="closing-line gold animate delay-2">Comprehensive search is survival.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">What was hidden in plain sight?</p>
</div>
<!-- Quiz -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">Module 3 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q3-1">
<h4>1. Какой тип источника данных выявил сердечно-сосудистый сигнал росиглитазона?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 0, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>A.</span> Published journal articles
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 1, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>B.</span> Cochrane Library
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 2, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>C.</span> Company clinical trial registry
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 3, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>D.</span> FDA approval documents
                      </div>
</div>
<div id="q3-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q3-2">
<h4>2. What does PRESS stand for?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 0, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>A.</span> Обзор публикаций стандартов поиска доказательств
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 1, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>B.</span> Peer Review of Electronic Search Strategies
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 2, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>C.</span> Протокол для отчетности об исследованиях синтеза данных
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 3, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>D.</span> Primary Research Evidence Search System
                      </div>
</div>
<div id="q3-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="14">
<p class="refrain animate">What was hidden in plain sight?</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 4: Скрининг</p>
</div>
</div>
 Модуль 4: Скрининг (Vioxx) 
<div class="module-slides" data-module="4">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Количество без происхождения не является числом.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Это история о</p>
<p class="title gold animate delay-1 text-center">what they chose to report.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 4: Скрининг</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Apply PRISMA flow diagram to document study selection</li>
<li>Implement dual-reviewer screening with conflict resolution</li>
<li>Определить выборочную отчетность о результатах и манипулирование данными</li>
<li>Calculate inter-rater reliability (Cohen's kappa)</li>
<li>Применить принцип: «Число без происхождения не является числом»</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">88,000</p>
<p class="subtitle animate delay-1">heart attacks attributed to Vioxx</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">A blockbuster drug. A hidden signal. A preventable catastrophe.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">Между В 1999 и 2004 годах это обезболивающее принимали миллионы. Некоторые так и не вернулись домой.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Расцвет Vioxx</h2>
<div class="card animate delay-1">
<p class="card-text text-center">Рофекоксиб (Vioxx) был селективным НПВП ЦОГ-2. Рекламируется как более безопасный для желудка, чем традиционные обезболивающие.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">1999</div>
<div class="stat-label">FDA approval</div>
</div>
<div class="stat-box">
<div class="stat-value">$2.5B</div>
<div class="stat-label">Peak annual sales</div>
</div>
<div class="stat-box">
<div class="stat-value">80M+</div>
<div class="stat-label">Patients prescribed</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Испытание VIGOR (2000)</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1rem;">Vioxx Gastrointestinal Outcomes Research</p>
<div class="design-grid animate delay-2">
<div class="design-item">
<div class="design-item-label">Design</div>
<div class="design-item-value">Randomized, double-blind</div>
</div>
<div class="design-item">
<div class="design-item-label">Comparison</div>
<div class="design-item-value">Vioxx vs Naproxen</div>
</div>
<div class="design-item">
<div class="design-item-label">Population</div>
<div class="design-item-value">Rheumatoid arthritis</div>
</div>
<div class="design-item">
<div class="design-item-label">Sample</div>
<div class="design-item-value">8,076 patients</div>
</div>
<div class="design-item">
<div class="design-item-label">Primary Outcome</div>
<div class="design-item-value">GI events</div>
</div>
<div class="design-item">
<div class="design-item-label">Published</div>
<div class="design-item-value">NEJM, November 2000</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">What VIGOR Published</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>GI Outcome</th>
<th>Vioxx</th>
<th>Naproxen</th>
</tr>
</thead>
<tbody>
<tr>
<td>Confirmed GI events</td>
<td style="color: var(--green);">2.1 per 100 pt-yrs</td>
<td>4.5 per 100 pt-yrs</td>
</tr>
<tr>
<td>Reduction</td>
<td colspan="2" style="color: var(--green); font-weight: 700;">54% fewer GI events</td>
</tr>
</tbody>
</table>
<div class="card navy-bg animate delay-2">
<p class="card-text text-center">Заголовок: Vioxx безопаснее для желудка!</p>
</div>
<p class="footnote animate delay-3">Так сказали врачи. Это то, во что верили пациенты.</p>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">What VIGOR Buried</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>CV Outcome</th>
<th>Vioxx</th>
<th>Naproxen</th>
</tr>
</thead>
<tbody>
<tr>
<td>Myocardial Infarction</td>
<td class="highlight">20 events</td>
<td>4 events</td>
</tr>
<tr>
<td>Relative Risk</td>
<td class="highlight" colspan="2">5x higher in Vioxx group</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-2">
<div class="value">5-fold Increase in Heart Attacks</div>
<div class="label">Mentioned only briefly, attributed to naproxen being "cardioprotective"</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">Выборочное сообщение</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Манипулирование данными:</strong> 3 additional heart attacks occurred after the cutoff used in publication</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Spin:</strong> Сигнал сердечно-сосудистых заболеваний объяснялся кардиозащитным действием напроксена (нет доказательств)</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>Outcome switching:</strong> Сердечно-сосудистые события были заранее определены, но не подчеркнуты</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>Internal knowledge:</strong> Электронные письма компании Merck показывают, что они знали об этом сигнале</p>
</div>
</div>
</div>
<div class="slide dark" data-index="8">
<div class="content">
<h2 class="title cream animate">Испытание APPROVe (2004 г.)</h2>
<p class="animate delay-1">Испытание по профилактике колоректальных полипов - остановлено досрочно из соображений безопасности.</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">RR 1.92</div>
<div class="stat-label">CV events vs placebo</div>
</div>
<div class="stat-box">
<div class="stat-value">Sept 2004</div>
<div class="stat-label">Vioxx withdrawn</div>
</div>
</div>
<p class="animate delay-3" style="margin-top: 1.5rem; color: var(--gold); font-style: italic; text-align: center;">
                  Four years after VIGOR showed a 5x risk. Four years too late.
                </p>
</div>
</div>
 ИСТОРИЯ: Дерево принятия решений Vioxx 
<div class="slide dark" data-index="8b">
<div class="story-box animate">
<p class="story-opener">А вы рассматривали, что происходит, когда сигнал скрывается в шуме?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    Vioxx (рофекоксиб) был одобрен в <span class="data-highlight">1999</span>.
                    By <span class="data-highlight">2004</span>, estimates suggest
                    <span class="data-highlight">88,000-140,000 excess heart attacks</span> and
                    <span class="data-highlight">30,000-40,000 deaths</span>.
                    Merck's own VIGOR trial showed <span class="data-highlight">5x cardiovascular risk</span> in 2000—but
                    it was dismissed as a "naproxen cardioprotective effect."
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Развилка на дороге</div>
<div class="decision-scenario">
                    Вы являетесь рецензентом FDA в 2001 году. Данные VIGOR показывают 5-кратный риск сердечного приступа при приеме Vioxx по сравнению с naproxen.
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">ПУТЬ A: Примите объяснение</div>
<div class="path-choice">Believe Merck's hypothesis: naproxen is cardioprotective</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">No additional safety studies required. Drug stays on market at full speed.</div>
<div class="path-outcome">РЕЗУЛЬТАТ: более 40 000 смертей за 4 года</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">ПУТЬ B: Требуйте доказательства</div>
<div class="path-choice">Require a dedicated CV safety trial before continued marketing</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Delay or restrict marketing until cardiovascular safety is established.</div>
<div class="path-outcome">OUTCOME: Signal detected early, lives saved</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Сигнал был там в 2000 году. неправильное объяснение задержало действие на 4 года. Альтернативная гипотеза, принятая без доказательств, стоила десятков тысяч жизней.
                  </div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Блок-схема PRISMA</h2>
<p class="animate delay-1" style="font-style: italic; margin-bottom: 1rem;">Every step of screening must be documented and transparent.</p>
<div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
<div class="stat-box animate delay-1" style="width: 300px;"><div class="stat-value">Identification</div><div class="stat-label">Records from databases + other sources</div></div>
<div class="arrow animate delay-1" style="font-size: 1.5rem;">↓</div>
<div class="stat-box animate delay-2" style="width: 300px;"><div class="stat-value">Screening</div><div class="stat-label">Title/abstract review (duplicates removed)</div></div>
<div class="arrow animate delay-2" style="font-size: 1.5rem;">↓</div>
<div class="stat-box animate delay-3" style="width: 300px;"><div class="stat-value">Eligibility</div><div class="stat-label">Full-text assessment (with exclusion reasons)</div></div>
<div class="arrow animate delay-3" style="font-size: 1.5rem;">↓</div>
<div class="stat-box animate delay-4" style="width: 300px; background: var(--gold); color: var(--navy);"><div class="stat-value">Included</div><div class="stat-label">Studies in synthesis</div></div>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Dual Screening: Why Two Reviewers?</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Reduces Selection Bias</h4>
<p>One reviewer might unconsciously favor certain studies</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Catches Errors</h4>
<p>Усталость, неправильное прочтение и ошибки неизбежны</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Forces Explicit Criteria</h4>
<p>Disagreements reveal ambiguity in inclusion rules</p>
</div>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">Typical agreement: κ = 0.6-0.8</p>
<p class="sub">Disagreements resolved by discussion or third reviewer</p>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Калибровка: пилотный этап</h2>
<div class="card animate delay-1">
<p class="card-text text-center">Before screening thousands of records, reviewers should calibrate on a sample of 50-100 records.</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">1</div>
<p>Screen the same set independently</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">2</div>
<p>Compare decisions and discuss disagreements</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">3</div>
<p>Refine inclusion criteria until κ &gt; 0.7</p>
</div>
<div class="wrong-item animate delay-5">
<div class="wrong-number">4</div>
<p>Задокументируйте процесс калибровки и о любых изменениях правил</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">PRISMA 2020 Updates</h2>
<div class="design-grid animate delay-1" style="grid-template-columns: 1fr 1fr;">
<div class="design-item">
<div class="design-item-label">New in 2020</div>
<div class="design-item-value">Separate reporting of database vs register searches</div>
</div>
<div class="design-item">
<div class="design-item-label">New in 2020</div>
<div class="design-item-value">Инструментам автоматизации необходимо сообщать</div>
</div>
<div class="design-item">
<div class="design-item-label">New in 2020</div>
<div class="design-item-value">Citation searching documented separately</div>
</div>
<div class="design-item">
<div class="design-item-label">New in 2020</div>
<div class="design-item-value">Reasons for exclusion at full-text mandatory</div>
</div>
</div>
<p class="footnote animate delay-2">В PRISMA 2020 существенно пересмотрен контрольный список с расширенной отчетностью по методам синтеза, оценке достоверности и регистрации протоколов.</p>
</div>
</div>
<div class="slide dark" data-index="13">
<p class="closing-line animate">If Vioxx's cardiovascular data had been screened by independent reviewers,</p>
<p class="closing-line animate delay-1">if all pre-specified outcomes had been required to be reported,</p>
<p class="closing-line gold animate delay-2">88,000 heart attacks might have been prevented.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">Количество без происхождения не является числом.</p>
</div>
<!-- Quiz -->
<div class="slide light" data-index="14">
<div class="content">
<h2 class="title navy animate">Module 4 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q4-1">
<h4>1. Каков был относительный риск ИМ в исследовании VIGOR в группе Vioxx по сравнению с напроксеном?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 0, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>A.</span> 1.5x higher
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 1, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>B.</span> 2x higher
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 2, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>C.</span> 5x higher
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 3, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>D.</span> 10x higher
                      </div>
</div>
<div id="q4-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q4-2">
<h4>2. Why is dual screening (two independent reviewers) important?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 0, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>A.</span> It makes screening faster
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 1, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>B.</span> It reduces selection bias and catches errors
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 2, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>C.</span> Это сокращает количество исследований для рассмотрения
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 3, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>D.</span> It allows reviewers to skip full-text review
                      </div>
</div>
<div id="q4-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="15">
<p class="refrain animate">Количество без происхождения не является числом.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 5: Извлечение</p>
</div>
</div>
 Модуль 5: Извлечение (УМЕНЬШЕНИЕ) 
<div class="module-slides" data-module="5">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Количество без происхождения не является числом.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Это история о</p>
<p class="title gold animate delay-1 text-center">числа, которых никогда не существовало.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 5: Извлечение</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Разработать стандартизированную форму извлечения данных с полями происхождения</li>
<li>Calculate effect sizes from various reported statistics (OR, RR, HR, SMD)</li>
<li>Implement dual-extraction with discrepancy resolution</li>
<li>Определить красные флажки для фальсификации данных и неправомерных действий</li>
<li>Explain how the DECREASE fraud affected clinical guidelines</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">~10,000</p>
<p class="subtitle animate delay-1">possible excess deaths in Europe</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">Из рекомендаций, основанных на сфабрикованных клинических испытаниях данные.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">Испытания DECREASE повлияли на периоперационный уход во всем мире. Данные были изобретены.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Don Poldermans: A Star Researcher</h2>
<div class="card animate delay-1">
<p class="card-text text-center">Professor at Erasmus Medical Center, Rotterdam. Author of over 500 papers. Lead author of ESC guidelines on perioperative cardiac care.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">500+</div>
<div class="stat-label">Publications</div>
</div>
<div class="stat-box">
<div class="stat-value">DECREASE</div>
<div class="stat-label">Trial series I-VI</div>
</div>
<div class="stat-box">
<div class="stat-value">ESC</div>
<div class="stat-label">Guideline chair</div>
</div>
</div>
<p class="footnote animate delay-3">Казалось бы, безупречный источник. Пока кто-то не посмотрел на данные.</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Испытания DECREASE: Заявление</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>Trial</th>
<th>Finding</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td>DECREASE-I (1999)</td>
<td>90% reduction in cardiac death</td>
<td>Changed guidelines</td>
</tr>
<tr>
<td>DECREASE-IV (2009)</td>
<td>Beta-blockers safe in low-risk</td>
<td>Expanded recommendations</td>
</tr>
</tbody>
</table>
<div class="focus-box animate delay-2 mt-2">
<p class="main">Effect sizes were implausibly large.</p>
<p class="sub">90% reduction? Almost nothing in medicine works that well.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">The Investigation: 2011</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p>Erasmus MC investigated after whistleblower complaints</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Сфабрикованные данные пациентов:</strong> Patients who didn't exist or weren't enrolled</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>No informed consent:</strong> Many "participants" never consented</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>Poldermans dismissed:</strong> From Erasmus MC in 2011</p>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="content">
<h2 class="title cream animate">Каскад вреда</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">Когда DECREASE был удален из метаанализ...</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">Benefit → Harm</div>
<div class="stat-label">Direction reversed</div>
</div>
<div class="stat-box">
<div class="stat-value">27% ↑</div>
<div class="stat-label">Stroke risk increase</div>
</div>
</div>
<p class="animate delay-3" style="margin-top: 1.5rem; color: var(--gold); font-style: italic; text-align: center;">
                  Исследование POISE (2008) показало вред. Оно было отклонено, поскольку противоречило DECREASE.
                </p>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">Почему это не было обнаружено?</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Trust in authority:</strong> Полдерманс был автором руководства, рассматривавшим свои собственные доказательства</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>No data verification:</strong> Никто не запрашивал данные отдельных пациентов</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>Publication prestige:</strong> Published in top journals, assumed valid</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>Implausible effects accepted:</strong> 90% reductions should raise suspicion</p>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Data Extraction: Defense Against Fraud</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Dual Extraction</h4>
<p>Two extractors independently - catches transcription errors and forces scrutiny</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Record Provenance</h4>
<p>Table, page, paragraph - every number traceable to source</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Verify Against Registry</h4>
<p>ClinicalTrials.gov результаты по сравнению с публикацией - расхождения являются красными флажками</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Request IPD</h4>
<p>Individual patient data reveals what aggregate summaries hide</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Effect Size Calculation</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">Во время извлечения вы рассчитываете величину эффекта на основе отчетных данных:</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 700px;">
<div class="card animate delay-2">
<div class="card-label">BINARY OUTCOMES</div>
<p class="card-text" style="font-size: 0.85rem;">Odds Ratio, Risk Ratio, Risk Difference from 2x2 tables</p>
</div>
<div class="card animate delay-3">
<div class="card-label">CONTINUOUS OUTCOMES</div>
<p class="card-text" style="font-size: 0.85rem;">Средняя разница, стандартизированная средняя разница от средних значений и стандартных отклонений</p>
</div>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">Всегда извлекайте данные из наиболее надежного источника.</p>
<p class="sub">Prefer: ITT results &gt; per-protocol &gt; subgroups</p>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Red Flags During Extraction</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">!</div>
<p><strong>Implausible effect sizes:</strong> 80-90% reductions should prompt scrutiny</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">!</div>
<p><strong>Baseline imbalances:</strong> Группы, которые «слишком идеально» подобраны</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">!</div>
<p><strong>Round numbers:</strong> "Exactly 50" or "exactly 100" patients per arm</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">!</div>
<p><strong>Registry discrepancies:</strong> Опубликованный N отличается от зарегистрированного N</p>
</div>
</div>
</div>
<div class="slide light" data-index="11c" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Effect Size Conversions</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Исследования сообщают о результатах в различных показателях. Чтобы их объединить, вам часто нужны конверсии:
                  </p>
</div>
<table class="results-table animate delay-2" style="font-size: 0.9rem;">
<thead><tr><th>From</th><th>To</th><th>Formula</th></tr></thead>
<tbody>
<tr><td>SMD (d)</td><td>log-OR</td><td>log-OR = d × π / √3</td></tr>
<tr><td>log-OR</td><td>SMD (d)</td><td>d = log-OR × √3 / π</td></tr>
<tr><td>Correlation (r)</td><td>Fisher z</td><td>z = 0.5 × ln((1+r)/(1−r))</td></tr>
<tr><td>OR</td><td>RR</td><td>RR = OR / (1 − P₀ + P₀ × OR)</td></tr>
<tr><td>OR</td><td>NNT</td><td>NNT = 1 / (P₀ − OR×P₀ / (1−P₀+OR×P₀))</td></tr>
</tbody>
</table>
<p class="footnote animate delay-3">
                  P₀ = исходный риск в контрольной группе. Эти формулы предполагают приближенные условия; см. Боренштейн и др. (гл. 7) для точных выводов.
                </p>
</div>
</div>
<div class="slide light" data-index="11d" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Данные о времени до события (выживаемости)</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Many trials report time-to-event outcomes using <strong>hazard ratios</strong> (HR).
                    Pooling HRs in meta-analysis requires special handling:
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Журнал (HR) + метод SE</h4>
<p>
                      Извлеките журнал (HR) и его SE из пробной версии. Если не указано, выведите SE из CI: SE = (ln(верхний) − ln(нижний)) / (2 × 1,96). Объединение с использованием стандартных методов обратной дисперсии.
                    </p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Когда HR не сообщается</h4>
<p>
                      Существуют методы восстановления IPD по кривым Каплана-Мейера (Guyot et al., 2012) или оценки ЧСС на основе значений p и количества событий (Parmar et al., 1998). Всегда отдавайте предпочтение скорректированному ЧСС, о котором сообщается напрямую, если таковой имеется.
                    </p>
</div>
</div>
<p class="footnote animate delay-4">
                  HR &lt; 1 favors treatment; HR &gt; 1 favors control.
                  Do <strong>not</strong> convert HRs to ORs or RRs—they measure fundamentally different quantities.
                </p>
</div>
</div>
 ИСТОРИЯ: Скандал с коллоидом Болдта 
<div class="slide dark" data-index="11b">
<div class="story-box animate">
<p class="story-opener">Что, если данные, которые вы извлекаете, никогда не были реальными?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    Йоахим Болдт был самым плодовитым исследователем в области управления анестезиологическими растворами. Над <span class="data-highlight">180 его публикаций были отозваны.</span> — один из крупнейших случаев ретракции в истории медицины. Его сфабрикованные данные показали, что гидроксиэтилкрахмал (ГЭК) безопасен. Мета-анализ, включавший его исследования, пришел к выводу, что ГЭК безвреден. Когда исследования Болдта были удалены, <span class="data-highlight">объединенный эффект обратился вспять</span>:
                    HES increased <span class="data-highlight">kidney injury by 59%</span> (RR 1.59, 95% CI 1.26-2.00)
                    and <span class="data-highlight">mortality by ~9%</span> (RR 1.09). An estimated
                    <span class="data-highlight">thousands of patients</span> received a harmful fluid based on fabricated evidence.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Бдительность экстрактора: 2010</div>
<div class="decision-scenario">
                    Вы извлекаете данные для метаанализа инфузионной терапии. Исследования Болдта доминируют в литературе (более 90 статей). Информатор выразил обеспокоенность. Что вы делаете?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Extract as Published</div>
<div class="path-choice">Trust peer-reviewed publications. Extract Boldt's data like any other.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Your meta-analysis shows HES is safe. Guidelines recommend it.</div>
<div class="path-outcome">OUTCOME: Thousands receive a nephrotoxic fluid</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Verify Provenance</div>
<div class="path-choice">Перекрестная проверка одобрений этики, запрос исходных данных, проведение анализа чувствительности, исключая подозрительные исследования.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Discover missing ethics approvals. Flag studies. Re-analyze without them.</div>
<div class="path-outcome">OUTCOME: True signal emerges — HES causes harm</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Провенанс – это не бюрократия. В этом разница между доказательствами и вымыслом. Каждое полученное число должно быть связано с исследованием, одобренным с точки зрения этики, с поддающимися проверке данными пациентов. Без происхождения номер без владельца может стать оружием.
                  </div>
</div>
</div>
</div>
<div class="slide dark" data-index="11">
<p class="closing-line animate">Каждое число в вашем метаанализе</p>
<p class="closing-line animate delay-1">must trace back to a verifiable source.</p>
<p class="closing-line gold animate delay-2">Количество без происхождения не является числом.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">Fraudulent data can kill as surely as fraudulent drugs.</p>
</div>
<!-- Quiz -->
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Module 5 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q5-1">
<h4>1. Что произошло, когда данные исследования DECREASE были исключены из метаанализа бета-блокаторов?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 0, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>A.</span> The benefit became even larger
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 1, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>B.</span> No change in conclusions
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 2, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>C.</span> The direction reversed to show potential harm
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 3, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>D.</span> Результаты стали неубедительными
                      </div>
</div>
<div id="q5-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q5-2">
<h4>2. Why should dual extraction be standard practice?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 0, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>A.</span> It catches transcription errors and forces scrutiny
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 1, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>B.</span> It makes extraction faster
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 2, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>C.</span> Это помогает найти больше исследований
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 3, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>D.</span> It reduces the amount of work needed
                      </div>
</div>
<div id="q5-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">Количество без происхождения не является числом.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 6: Предвзятость</p>
</div>
</div>
 Модуль 6: Предвзятость (апротинин/БАРТ) 
<div class="module-slides" data-module="6">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Методы защищают пациентов от нашего доверия.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Это история о</p>
<p class="title gold animate delay-1 text-center">предвзятость, которую мы не можем видеть.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 6: Предвзятость</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Apply Risk of Bias 2.0 (RoB 2) to randomized trials</li>
<li>Применить ROBINS-I к нерандомизированным исследованиям</li>
<li>Assess all five RoB 2 domains (randomization, deviations, missing data, measurement, selection)</li>
<li>Distinguish confounding by indication from true treatment effects</li>
<li>Explain how BART revealed hidden harms of aprotinin</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">20+</p>
<p class="subtitle animate delay-1">лет на рынке</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">Апротинин был золотым стандартом снижения хирургического кровотечения.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">Затем кто-то провел РКИ. Правда была иной.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Hidden Bias: Confounding by Indication</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Sicker patients got aprotinin:</strong> Surgeons used it in complex, high-risk cases</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Survivors bias:</strong> Dead patients can't report complications</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>Publication bias:</strong> Отрицательные исследования не были опубликованы</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">Наблюдательные исследования не смогли отделить эффект препарата от исходного риска для пациента.</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">БАРТ: Случайная правда</h2>
<p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">Blood Conservation Using Antifibrinolytics in a Randomized Trial</p>
<table class="results-table animate delay-2">
<thead><tr><th>Outcome</th><th>Aprotinin</th><th>Alternatives</th></tr></thead>
<tbody>
<tr><td>30-day mortality</td><td class="highlight">6.0%</td><td>3.9%</td></tr>
<tr><td>Relative Risk</td><td class="highlight" colspan="2">1.53 (53% increased death)</td></tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">Trial Stopped Early for Harm</div>
<div class="label">Снят с рынка в ноябре 2007 г.</div>
</div>
</div>
</div>
<!-- Investigation Exercise -->
<div class="slide dark" data-index="5">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Расследование: оцените предвзятость</h3>
</div>
<p class="direct-address">Вы просматриваете наблюдательные исследования. Примените мышление о риске предвзятости:</p>
<table class="data-table-investigation">
<thead><tr><th>Question</th><th>Observational</th><th>BART (RCT)</th></tr></thead>
<tbody>
<tr><td>Random allocation?</td><td>❌ Surgeon choice</td><td>✓ Yes</td></tr>
<tr><td>Baseline comparable?</td><td>❌ Sicker got drug</td><td>✓ Balanced</td></tr>
<tr><td>Blinding?</td><td>❌ Open label</td><td>✓ Double-blind</td></tr>
</tbody>
</table>
<button class="reveal-btn" onclick="revealAnswer('bias-reveal')">См. ключевую информацию →</button>
<div class="hidden-reveal" id="bias-reveal">
<p><strong>Confounding by indication:</strong> Самым тяжелым пациентам хирурги давали апротинин. В обсервационных исследованиях выживаемость приписывалась препарату, тогда как они измеряли систематическую ошибку выживаемости.</p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">Risk of Bias 2.0: The Five Domains</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">D1</div>
<div class="lesson-content"><h4>Randomization Process</h4></div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">D2</div>
<div class="lesson-content"><h4>Отклонения от запланированных вмешательств</h4></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">D3</div>
<div class="lesson-content"><h4>Отсутствующие данные о результатах</h4></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">D4</div>
<div class="lesson-content"><h4>Измерение результата</h4></div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">D5</div>
<div class="lesson-content"><h4>Выбор сообщаемого результата</h4></div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">РОБИНС-I: для нерандомизированных исследований</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">Если РКИ недоступны, используйте ROBINS-I (риск систематической ошибки в нерандомизированных исследованиях вмешательств).</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #7c3aed;">1</div>
<div class="lesson-content"><h4>Confounding</h4><p>Baseline differences between groups</p></div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #7c3aed;">2</div>
<div class="lesson-content"><h4>Selection of Participants</h4><p>Exclusions related to intervention</p></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #7c3aed;">3</div>
<div class="lesson-content"><h4>Classification of Interventions</h4><p>Misclassification of exposure status</p></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #7c3aed;">4</div>
<div class="lesson-content"><h4>Отклонения от запланированных вмешательств</h4><p>Co-interventions, contamination</p></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #7c3aed;">5</div>
<div class="lesson-content"><h4>Missing Data</h4><p>Differential loss to follow-up</p></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #7c3aed;">6</div>
<div class="lesson-content"><h4>Measurement of Outcomes</h4><p>Ascertainment bias</p></div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number" style="background: #7c3aed;">7</div>
<div class="lesson-content"><h4>Selection of Reported Result</h4><p>Selective reporting</p></div>
</div>
<p class="footnote animate delay-5" style="margin-top: 1rem;">Ratings: Low / Moderate / Serious / Critical / No information</p>
</div>
</div>
 ИСТОРИЯ: Испытание апротинина BART 
<div class="slide dark" data-index="8b">
<div class="story-box animate">
<p class="story-opener">Что происходит, когда 64 исследования соглашаются, но все они неправы?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    Апротинин использовался в кардиохирургии для уменьшения кровотечения. <span class="data-highlight">20 years</span>.
                    <span class="data-highlight">64 small randomized trials</span> предположил, что это безопасно и эффективно. Мета-анализ подтвердил пользу. Тогда <span class="data-highlight">BART trial</span> (2008)
                    randomized <span class="data-highlight">2,331 patients</span>: aprotinin vs. tranexamic acid vs. aminocaproic acid.
                    Result: aprotinin increased <span class="data-highlight">mortality by 53%</span> (ОР 1,53, 95% ДИ 1,06–2,22). Суд был <span class="data-highlight">остановился раньше времени из-за вреда</span>. Через несколько месяцев компания Bayer отозвала апротинин с рынка.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Показания хирурга: 2006 г.</div>
<div class="decision-scenario">
                    Вы кардиохирург, выбирающий антифибринолитик. В 64 небольших исследованиях предпочтение отдавалось апротинину, но ни в одном из них не удалось выявить смертность. В настоящее время проводится набор в крупное РКИ (BART). Вы ждете?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">ПУТЬ А: Доверьтесь метаанализу</div>
<div class="path-choice">64 trials can't all be wrong. Continue prescribing aprotinin.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">В небольших исследованиях измерялось кровотечение, а не смерть. Ни у кого не было достаточной силы для смертности. Мета-анализ объединил суррогатные результаты с недостаточной достоверностью.</div>
<div class="path-outcome">OUTCOME: Excess deaths in cardiac surgery patients</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Assess Risk of Bias First</div>
<div class="path-choice">Оцените все 64 испытания с помощью RoB. Обратите внимание, что они небольшие, используют суррогатные результаты и имеют высокий уровень отсева. Подождите, пока RCT будет иметь достаточное питание.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">BART reveals the truth. Switch to safer alternatives.</div>
<div class="path-outcome">OUTCOME: Lives saved by demanding adequately powered evidence</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Количество доказательств не равно качеству. Шестьдесят четыре исследования с недостаточной статистикой, дающие неправильный результат, не перевешивают одно исследование с адекватной статистикой, измеряющее смертность. Оценка риска предвзятости не является формальностью — это щит между пациентами и вводящими в заблуждение выводами на основе небольших суррогатных доказательств.
                  </div>
</div>
</div>
</div>
<div class="slide dark" data-index="8">
<p class="closing-line animate">Sixty-four small trials measured bleeding, not death.</p>
<p class="closing-line animate delay-1">One adequately powered trial revealed 53% increased mortality.</p>
<p class="closing-line gold animate delay-2">Количество доказательств не может заменить качество и силу.</p>
<div class="gold-line animate delay-3"></div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Module 6 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q6-1">
<h4>1. Why did 64 small trials miss aprotinin's harm?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 0, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
<span>A.</span> Underpowered for mortality; used surrogate outcomes
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 1, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
<span>B.</span> Confounding by indication
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 2, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
<span>C.</span> Outcome measured incorrectly
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 3, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
<span>D.</span> Follow-up too short
                      </div>
</div>
<div id="q6-1-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="9">
<p class="refrain animate">Методы защищают пациентов от нашего доверия.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 7: Синтез</p>
</div>
</div>
 Модуль 7: Синтез (Магний/ISIS-4) 
<div class="module-slides" data-module="7">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Гетерогенность — это сообщение, а не шум.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Споры о магнии: 1991–1995 гг.</p>
<p class="title gold animate delay-1 text-center">When pooling leads us astray.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 7: Синтез</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Calculate pooled effect sizes using fixed-effect and random-effects models</li>
<li>Choose between DerSimonian-Laird and HKSJ estimators appropriately</li>
<li>Interpret forest plots including weights, confidence intervals, and diamonds</li>
<li>Explain why small-study effects can mislead meta-analyses</li>
<li>Применяйте принцип: «Неоднородность — это сообщение, а не шум».</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Year: 1991</h2>
<p class="direct-address animate delay-1">
                  «Вы стоите на перекрестке надежд и доказательств...»
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    Heart disease kills more people worldwide than any other cause.
                    In 1991, a new hope emerges: Could something as simple and cheap as
                    <strong>intravenous magnesium</strong> save lives after myocardial infarction?
                  </p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">Биологическое обоснование было разумным:</p>
<p class="sub">Magnesium stabilizes cardiac membranes, prevents arrhythmias, and vasodilates coronary arteries.</p>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">ПРЕДЕЛ-2: Знаковое испытание</h2>
<p class="animate delay-1" style="font-style: italic;">Leicester Intravenous Magnesium Intervention Trial, 1992</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">2,316</div>
<div class="stat-label">Patients enrolled</div>
</div>
<div class="stat-box" style="background: rgba(34, 197, 94, 0.2); border-color: #22c55e;">
<div class="stat-value">24%</div>
<div class="stat-label">Mortality reduction</div>
</div>
<div class="stat-box">
<div class="stat-value">p = 0.04</div>
<div class="stat-label">Statistically significant</div>
</div>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">A cheap, safe intervention that could save 250,000 lives per year globally.</p>
<p class="sub">Медицинское сообщество было наэлектризовано.</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">The Meta-Analysis: 1993</h2>
<p class="animate delay-1">Researchers pooled <strong>seven randomized trials</strong> of IV magnesium in MI:</p>
<table class="results-table animate delay-2">
<thead>
<tr>
<th>Trial</th>
<th>Year</th>
<th>N</th>
<th>Odds Ratio</th>
</tr>
</thead>
<tbody>
<tr><td>Morton 1984</td><td>1984</td><td>40</td><td style="color: var(--green);">0.10</td></tr>
<tr><td>Rasmussen 1986</td><td>1986</td><td>273</td><td style="color: var(--green);">0.35</td></tr>
<tr><td>Smith 1986</td><td>1986</td><td>400</td><td style="color: var(--green);">0.48</td></tr>
<tr><td>Abraham 1987</td><td>1987</td><td>94</td><td>0.87</td></tr>
<tr><td>Shechter 1990</td><td>1990</td><td>103</td><td style="color: var(--green);">0.27</td></tr>
<tr><td>Ceremuzynski 1989</td><td>1989</td><td>48</td><td style="color: var(--green);">0.22</td></tr>
<tr><td>LIMIT-2</td><td>1992</td><td>2,316</td><td style="color: var(--green);">0.74</td></tr>
</tbody>
</table>
</div>
</div>
<div class="slide dark" data-index="5">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Investigation Exercise: The Meta-Analyst's Dilemma</h3>
</div>
<p class="direct-address">
                  Вы являетесь Кокрановским рецензентом в 1993 году. Вас попросили обобщить данные о применении магния при ИМ. Перед вами данные семи испытаний.
                </p>
<p class="rhetorical" style="margin: 1rem 0;">
                  Вы видите закономерность на этом лесном сюжете?
                </p>
<div id="magnesium-forest-small" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
<button class="reveal-btn" onclick="drawMagnesiumForest('small')">Generate Forest Plot →</button>
<button class="reveal-btn" onclick="revealAnswer('mag-pooled')">Объедините доказательства →</button>
</div>
<div class="hidden-reveal" id="mag-pooled">
<div class="result-box" style="background: rgba(34, 197, 94, 0.2); border-color: #22c55e;">
<div class="value">Pooled OR = 0.44 (95% CI: 0.27–0.71)</div>
<div class="label">55% mortality reduction! Publish in the Lancet?</div>
</div>
<p style="text-align: center; margin-top: 1rem; font-style: italic;">
                    Но подождите... вы что-нибудь заметили в пробных размерах?
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">Предупреждающие знаки</h2>
<p class="rhetorical animate">What should have given us pause?</p>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Small sample sizes:</strong> Six of seven trials had &lt;500 patients</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Extreme effects:</strong> OR of 0.10 (90% reduction) is implausible for any drug</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>All positive:</strong> Где были отрицательные испытания? Проблема с файловым ящиком...</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>Funnel asymmetry:</strong> Small trials showed much larger effects than larger ones</p>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Тест графика воронки</h3>
</div>
<p class="direct-address">
                  Прежде чем объединить данные, мы должны проверить предвзятость публикаций. Давайте рассмотрим график воронки.
                </p>
<div id="magnesium-funnel-small" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<button class="reveal-btn" onclick="drawMagnesiumFunnel('small')">Generate Funnel Plot →</button>
<div id="mag-funnel-interpretation" style="display: none; margin-top: 1rem;">
<div class="focus-box" style="border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">⚠️ Asymmetric Funnel</p>
<p class="sub">Группа небольших испытаний слева (показана польза). Где небольшие отрицательные испытания?</p>
<p class="sub">Egger's test p = 0.04 — statistically significant asymmetry.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Год: 1995 — Отчеты ИГИЛ-4</h2>
<p class="direct-address animate delay-1">
                  «И тут пришла правда…»
                </p>
<div class="card animate delay-2">
<p class="card-text text-center">
                    The <strong>Fourth International Study of Infarct Survival (ISIS-4)</strong>
                    enrolled 58,050 patients across 1,086 hospitals in 31 countries.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">58,050</div>
<div class="stat-label">Patients</div>
</div>
<div class="stat-box">
<div class="stat-value">2,216</div>
<div class="stat-label">Deaths in Mg group</div>
</div>
<div class="stat-box">
<div class="stat-value">2,103</div>
<div class="stat-label">Deaths in placebo</div>
</div>
</div>
<div class="result-box animate delay-4" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">OR = 1.06 (95% CI: 1.00–1.12)</div>
<div class="label">No benefit. If anything, a trend toward harm.</div>
</div>
</div>
</div>
<div class="slide dark" data-index="9">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>До и после: полная картина</h3>
</div>
<p class="direct-address">
                  Посмотрите, что произойдет, когда мы добавим мега-испытание на наш лесной участок...
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">BEFORE ISIS-4</h4>
<p>7 small trials (N = 3,274)</p>
<p style="color: #22c55e; font-weight: bold;">OR = 0.44</p>
<p style="font-size: 0.9rem;">Strong benefit signal</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">AFTER ISIS-4</h4>
<p>8 trials (N = 61,324)</p>
<p style="color: #C53030; font-weight: bold;">OR = 1.02</p>
<p style="font-size: 0.9rem;">No effect</p>
</div>
</div>
<div id="magnesium-forest-full" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<button class="reveal-btn" onclick="drawMagnesiumForest('full')">Показать полный лесной график →</button>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Why Did Small Trials Mislead?</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Publication Bias</h4>
<p>Small negative trials were never published—they sat in file drawers</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Small-Study Effects</h4>
<p>Smaller trials tend to show larger effects due to methodological weaknesses</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Random High Bias</h4>
<p>Совершенно случайно некоторые небольшие испытания дали экстремальные результаты — и они были опубликованы</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Random-Effects Amplification</h4>
<p>Random-effects models give more weight to small trials, amplifying bias</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Fixed vs. Random Effects</h2>
<p class="rhetorical animate">Which model should you choose?</p>
<div class="animate delay-1" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 850px;">
<div class="card" style="border-left: 4px solid #3b82f6;">
<div class="card-label">FIXED EFFECT MODEL</div>
<p class="card-text">Assumes <strong>one true effect</strong>. Weights studies by inverse variance (precision). Large trials dominate.</p>
<p style="font-size: 0.85rem; color: var(--navy); margin-top: 0.5rem;">
<strong>Magnesium result:</strong> OR = 0.96 (p = 0.52)
                    </p>
</div>
<div class="card" style="border-left: 4px solid #f59e0b;">
<div class="card-label">RANDOM EFFECTS MODEL</div>
<p class="card-text">Assumes <strong>distribution of effects</strong>. Gives more weight to small trials. Wider confidence intervals.</p>
<p style="font-size: 0.85rem; color: var(--navy); margin-top: 0.5rem;">
<strong>Magnesium result:</strong> OR = 0.59 (p = 0.01)
                    </p>
</div>
</div>
<div class="focus-box animate delay-2 mt-2" style="border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">⚠️ Выбор модели определил вывод!</p>
<p class="sub">Случайные эффекты не устраняют предвзятость; с эффектами небольших исследований это может сместить вес в сторону более мелких исследований и изменить выводы.</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Уроки магния</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.1rem;">
<strong>1. Проверьте наличие предвзятости публикации</strong> прежде чем доверять объединенной оценке. Ваши инструменты — воронкообразные графики и тест Эггера.
                  </p>
</div>
<div class="card animate delay-2">
<p class="card-text" style="font-size: 1.1rem;">
<strong>2. Be wary of small-study effects.</strong> If only small trials show benefit,
                    wait for a large, well-conducted trial.
                  </p>
</div>
<div class="card animate delay-3">
<p class="card-text" style="font-size: 1.1rem;">
<strong>3. Model choice matters.</strong> Случайные эффекты могут усилить предвзятые доказательства. Рассмотрите обе модели и поймите последствия.
                  </p>
</div>
<div class="card animate delay-4">
<p class="card-text" style="font-size: 1.1rem;">
<strong>4. One large trial can overturn many small ones.</strong>
                    Вот почему такие мега-испытания, как ISIS-4, так ценны.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="12c" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Специальные планы исследований в метаанализе</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Не во всех РКИ используются стандартные планы параллельных групп. Два распространенных варианта требуют особого подхода при объединении результатов:
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Cluster-Randomized Trials</h4>
<p>
                      Рандомизировать группы (больницы, школы), а не отдельных лиц. &lt; <strong>design effect</strong>
                      = 1 + (m-1) × ICC уменьшает эффективный размер выборки. Разделите N на расчетный эффект перед объединением или используйте скорректированную SE из исследования. Игнорирование кластеризации приводит к искусственному сужению ДИ.
                    </p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Crossover Trials</h4>
<p>
                      Каждый пациент получает оба вида лечения. Парный план уменьшает дисперсию, но для правильного объединения вам необходим <strong>within-patient correlation</strong> (или SE парного анализа). Использование SE параллельной группы консервативно; используя неправильные N пациентов с двойным подсчетом.
                    </p>
</div>
</div>
<p class="footnote animate delay-4">Подробные формулы и рабочие примеры см. в Кокрейновском справочнике v6.4, глава 23.</p>
</div>
</div>
 ИСТОРИЯ: Ранняя реверсия сурфактанта 
<div class="slide dark" data-index="12b">
<div class="story-box animate">
<p class="story-opener">Что, если способ объединения исследований определяет, спасет ли лечение жизнь или бесполезно?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    Ранний сурфактант для недоношенных детей был поддержан <span class="data-highlight">6 small trials</span>
                    showing <span class="data-highlight">reduced mortality</span> (RR 0.84).
                    A <span class="data-highlight">fixed-effect meta-analysis</span> confirmed benefit (p=0.04).
                    But a <span class="data-highlight">random-effects model</span> showed no significance (p=0.12)
                    — the confidence interval crossed 1.0.
                    Later, <span class="data-highlight">SUPPORT (2010)</span> and <span class="data-highlight">VON (2012)</span>,
                    two large pragmatic trials with <span class="data-highlight">~2,000 neonates</span> combined,
                    found <span class="data-highlight">no benefit</span> ранним и поздним сурфактантом. Клиническая практика была изменена на основе небольших исследований и неправильной модели.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Выбор модели неонатолога: 2005</div>
<div class="decision-scenario">
                    Вы обновляете Кокрейновский обзор раннего сурфактанта. Шесть небольших исследований показали преимущества модели с фиксированным эффектом. Модель случайных эффектов не имеет существенного значения. О чем вы сообщаете?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Report Fixed-Effect Only</div>
<div class="path-choice">Fixed-effect is significant. Report the positive result. Change practice.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">NICUs adopt early surfactant. Later trials show no benefit. Practice reverses.</div>
<div class="path-outcome">OUTCOME: Years of unnecessary intubation of premature infants</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Report Both Models</div>
<div class="path-choice">Покажите результаты FE и RE. Отметьте, что значимость зависит от выбора модели. Требуйте больших испытаний.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Honest uncertainty. Large trials prioritized. True answer emerges faster.</div>
<div class="path-outcome">OUTCOME: Premature babies spared unnecessary intervention</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Когда вывод меняется в зависимости от того, используете ли вы фиксированный эффект или случайный эффект, вывод становится хрупким. Сообщите об обоих. Признайте неопределенность. И помните: нестабильный результат небольших испытаний не является основанием для изменения практики.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">Module 7 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q7-1">
<h4>1. Почему метаанализ магния показал преимущества, которых не обнаружил ISIS-4?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 0, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>A.</span> Методология ISIS-4 имела недостатки
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 1, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>B.</span> Calculation error in meta-analysis
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 2, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>C.</span> Publication bias in small trials
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 3, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>D.</span> LIMIT-2 была недостаточно мощной
                      </div>
</div>
<div id="q7-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q7-2" style="margin-top: 1.5rem;">
<h4>2. What warning sign should have alerted reviewers to potential bias?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 0, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>A.</span> Asymmetric funnel plot (small trials showing larger effects)
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 1, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>B.</span> Low heterogeneity (I² = 0%)
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 2, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>C.</span> Strong biological plausibility
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 3, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>D.</span> Too few trials to analyze
                      </div>
</div>
<div id="q7-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q7-3" style="margin-top: 1.5rem;">
<h4>3. When publication bias is suspected, which model may amplify the bias?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 0, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>A.</span> Fixed effect model
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 1, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>B.</span> Random effects model
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 2, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>C.</span> Bayesian model
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 3, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>D.</span> Network meta-analysis
                      </div>
</div>
<div id="q7-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="14">
<p class="closing-line animate">Small trials can show false signals.</p>
<p class="closing-line animate delay-1">Large trials anchor the truth.</p>
<p class="closing-line gold animate delay-2">Гетерогенность — это сообщение, а не шум.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="15">
<p class="refrain animate">Гетерогенность — это сообщение, а не шум.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 8: Неоднородность</p>
</div>
</div>
 Модуль 8: Гетерогенность (ACCORD) 
<div class="module-slides" data-module="8">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Гетерогенность — это сообщение, а не шум.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">ACCORD: 2008</p>
<p class="title gold animate delay-1 text-center">Когда среднее значение скрывает правду.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 8: Неоднородность</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Рассчитать и интерпретировать I², τ² и интервалы прогнозирования</li>
<li>Apply ICEMAN criteria to assess subgroup credibility</li>
<li>Distinguish between clinical, methodological, and statistical heterogeneity</li>
<li>Conduct and interpret leave-one-out sensitivity analyses</li>
<li>Explain how ACCORD revealed differential effects across subgroups</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Year: 2008</h2>
<p class="direct-address animate delay-1">
                  "Вы собираетесь стать свидетелем одного из самых шокирующих прекращений испытаний в истории история...»
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    На протяжении десятилетий диабетическое сообщество придерживалось одного руководящего принципа: <strong>lower blood sugar is better</strong>. Знаменательные исследования DCCT (1993) и UKPDS (1998) показали, что интенсивный контроль уровня глюкозы снижает микрососудистые осложнения — слепоту, почечную недостаточность, повреждение нервов.
                  </p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">Логическая экстраполяция:</p>
<p class="sub">If controlling glucose prevents complications, shouldn't intensive control prevent cardiovascular disease too?</p>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">ACCORD: Action to Control Cardiovascular Risk in Diabetes</h2>
<p class="animate delay-1" style="font-style: italic;">The definitive test of intensive glucose control</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">10,251</div>
<div class="stat-label">Type 2 diabetics</div>
</div>
<div class="stat-box">
<div class="stat-value">HbA1c &lt;6%</div>
<div class="stat-label">Intensive target</div>
</div>
<div class="stat-box">
<div class="stat-value">HbA1c 7-7.9%</div>
<div class="stat-label">Standard target</div>
</div>
</div>
<div class="card animate delay-3">
<p class="card-text">
                    У всех пациентов был диабет 2 типа с высоким сердечно-сосудистым риском — либо установленное сердечно-сосудистое заболевание, либо множественные факторы риска. Исследование было рассчитано на 5,6 лет.
                  </p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="rhetorical animate" style="font-size: 2rem;">
                February 6, 2008
              </p>
<p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                Совет по мониторингу безопасности данных созывает экстренное совещание.
              </p>
<p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                After 3.5 years, they make an unprecedented decision:
              </p>
<p class="title gold animate delay-3" style="font-size: 2.5rem; margin-top: 1.5rem;">
                ПРЕКРАТИТЬ ИСПЫТАНИЕ.
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Шокирующие результаты</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>Outcome</th>
<th>Intensive</th>
<th>Standard</th>
<th>HR (95% CI)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Primary CV endpoint</td>
<td>352 events</td>
<td>371 events</td>
<td>0.90 (0.78–1.04)</td>
</tr>
<tr style="background: rgba(197, 48, 48, 0.15);">
<td><strong>All-cause mortality</strong></td>
<td><strong>257 deaths</strong></td>
<td><strong>203 deaths</strong></td>
<td class="highlight"><strong>1.22 (1.01–1.46)</strong></td>
</tr>
<tr>
<td>Severe hypoglycemia</td>
<td>10.5%</td>
<td>3.5%</td>
<td>3.0× higher</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-2" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">22% increase in mortality</div>
<div class="label">54 excess deaths in the intensive arm</div>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Investigation Exercise: The Clinician's Dilemma</h3>
</div>
<p class="direct-address">
                  Вы эндокринолог, у вас 500 пациентов с диабетом. Результаты ACCORD опубликованы. Что вы скажете своим пациентам, которые стремятся к HbA1c &lt;6%?
                </p>
<p class="rhetorical" style="margin: 1.5rem 0;">
                  Интенсивный контроль вреден для всех? Или только для некоторых?
                </p>
<div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
<button class="reveal-btn" onclick="revealAnswer('accord-subgroup')">Изучите подгруппы →</button>
</div>
<div class="hidden-reveal" id="accord-subgroup">
<h4 style="color: var(--gold); margin-top: 1rem;">Выявленный анализ подгрупп:</h4>
<table class="data-table-investigation" style="margin-top: 0.5rem;">
<thead><tr><th>Subgroup</th><th>Intensive HR</th><th>Interpretation</th></tr></thead>
<tbody>
<tr><td>No prior CVD</td><td>1.00 (0.76–1.32)</td><td>No effect</td></tr>
<tr><td>Prior CVD</td><td style="color: #C53030;">1.45 (1.15–1.84)</td><td>Significant harm</td></tr>
<tr><td>Baseline HbA1c &lt;8%</td><td>1.02 (0.75–1.40)</td><td>No effect</td></tr>
<tr><td>Baseline HbA1c ≥8%</td><td style="color: #C53030;">1.29 (1.03–1.60)</td><td>Harm</td></tr>
</tbody>
</table>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">The average effect masked critical heterogeneity!</p>
<p class="sub">Для пациентов с установленными сердечно-сосудистыми заболеваниями или плохим исходным контролем интенсивная терапия была вредной.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">Понимание гетерогенности: I² и за его пределами</h2>
<p class="animate delay-1">Когда проводятся исследования (или подгруппы) показывают разные эффекты, мы должны количественно оценить это изменение.</p>
<div class="animate delay-2" style="max-width: 700px;">
<div class="card" style="border-left: 4px solid #22c55e;">
<p class="card-text"><strong>I² = 0–25%:</strong> Низкая гетерогенность. Эффекты одинаковы во всех исследованиях.</p>
</div>
<div class="card" style="border-left: 4px solid #3b82f6; margin-top: 0.5rem;">
<p class="card-text"><strong>I² = 25–50%:</strong> Moderate. Look for sources of variation.</p>
</div>
<div class="card" style="border-left: 4px solid #f59e0b; margin-top: 0.5rem;">
<p class="card-text"><strong>I² = 50–75%:</strong> Substantial. Consider whether pooling is appropriate.</p>
</div>
<div class="card" style="border-left: 4px solid #C53030; margin-top: 0.5rem;">
<p class="card-text"><strong>I² = 75–100%:</strong> Considerable. A single pooled estimate may mislead.</p>
</div>
</div>
<p class="footnote animate delay-3">Но сам по себе I² не говорит вам, что делать — он сигнализирует о необходимости дальнейшего исследования.</p>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Tau² (τ²): дисперсия между исследованиями</h2>
<p class="animate delay-1">В то время как I² сообщает вам долю дисперсии из-за неоднородности, τ² сообщает вам величину.</p>
<div class="animate delay-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 800px;">
<div class="card">
<div class="card-label">I² (percentage)</div>
<p class="card-text">"Какая доля общей дисперсии обусловлена истинными различиями между исследованиями?"</p>
<p style="font-size: 0.85rem;">Scale: 0% to 100%</p>
</div>
<div class="card">
<div class="card-label">τ² (absolute)</div>
<p class="card-text">"Насколько истинные эффекты различаются между исследованиями?"</p>
<p style="font-size: 0.85rem;">Same scale as the effect measure</p>
</div>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">Use τ² to calculate <strong>prediction intervals</strong></p>
<p class="sub">Интервал прогнозирования показывает диапазон эффектов, которые вы ожидаете в новом исследовании - часто намного шире, чем доверительный интервал интервал.</p>
</div>
</div>
</div>
<div class="slide dark" data-index="9">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>The Prediction Interval: What ACCORD Really Tells Us</h3>
</div>
<p class="direct-address">
                  Consider a meta-analysis of intensive glucose control across multiple trials...
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">Confidence Interval</h4>
<p style="font-size: 1.2rem; font-weight: bold;">HR 1.10 (0.95–1.27)</p>
<p style="font-size: 0.9rem;">"Наша лучшая оценка среднего эффекта"</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">Prediction Interval</h4>
<p style="font-size: 1.2rem; font-weight: bold;">HR 1.10 (0.70–1.73)</p>
<p style="font-size: 0.9rem;">"The range of effects in a new setting"</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">Интервал прогнозирования охватывает как пользу, так и вред!</p>
<p class="sub">In some settings, intensive control might help. In others, it could kill.</p>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">When Is a Subgroup Effect Credible?</h2>
<p class="animate delay-1" style="font-style: italic;">Subgroup Credibility Criteria (adapted from ICEMAN, Schandelmaier 2020 &amp; Sun 2012)</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Был ли анализ подгрупп заранее определен?</h4>
<p>Апостериорные подгруппы склонны к получению данных дноуглубительные работы</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Is there a plausible biological rationale?</h4>
<p>Механизм должен быть ясным и независимым от данных</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Is the effect consistent across related outcomes?</h4>
<p>Если появляется вред для смертности, существует ли аналогичный вред для ИМ, инсульта?</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Is there independent replication?</h4>
<p>Подтвержден ли эффект подгруппы в других исследованиях?</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">ICEMAN Applied to ACCORD</h2>
<table class="results-table animate delay-1">
<thead>
<tr><th>Criterion</th><th>Assessment</th><th>Score</th></tr>
</thead>
<tbody>
<tr>
<td>Pre-specified?</td>
<td>Да — предшествующие сердечно-сосудистые заболевания были в протокол</td>
<td style="color: #22c55e;">✓</td>
</tr>
<tr>
<td>Biological rationale?</td>
<td>Yes—hypoglycemia more dangerous with CVD</td>
<td style="color: #22c55e;">✓</td>
</tr>
<tr>
<td>Consistent outcomes?</td>
<td>Yes—CV mortality and all-cause mortality aligned</td>
<td style="color: #22c55e;">✓</td>
</tr>
<tr>
<td>Independent replication?</td>
<td>Partially—ADVANCE, VADT showed similar patterns</td>
<td style="color: #f59e0b;">~</td>
</tr>
</tbody>
</table>
<div class="focus-box animate delay-2 mt-2">
<p class="main">ICEMAN Rating: High Credibility</p>
<p class="sub">The differential harm in high-risk patients appears genuine.</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Клинические последствия</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.1rem;">
<strong>Для пациентов без сердечно-сосудистых заболеваний:</strong> Moderate glucose control (HbA1c ~7%) remains the goal.
                    Intensive control may reduce microvascular complications.
                  </p>
</div>
<div class="card animate delay-2">
<p class="card-text" style="font-size: 1.1rem;">
<strong>Для пациентов с установленными сердечно-сосудистыми заболеваниями:</strong> Avoid intensive targets.
                    Hypoglycemia is dangerous for damaged hearts.
                  </p>
</div>
<div class="card animate delay-3">
<p class="card-text" style="font-size: 1.1rem;">
<strong>Для пожилых пациентов:</strong> Relaxed targets. Quality of life matters.
                    Tight control causes falls, confusion, and excess mortality.
                  </p>
</div>
<p class="footnote animate delay-4" style="font-size: 1rem; font-style: italic;">
                  "One size fits all" treatment is not patient-centered medicine.
                </p>
</div>
</div>
<!-- Meta-Regression -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">Meta-Regression: Explaining Heterogeneity</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  When heterogeneity is high, meta-regression can identify study-level covariates that explain variation.
                </p>
<div class="card animate delay-2" style="margin-bottom: 1rem;">
<div class="card-label">THE QUESTION</div>
<p class="card-text">Меняется ли систематически величина эффекта в зависимости от исследования характеристики?</p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value" style="font-size: 1.1rem;">Covariates</div>
<div class="stat-label">Year, dose, duration, baseline risk, study quality</div>
</div>
<div class="stat-box">
<div class="stat-value" style="font-size: 1.1rem;">Output</div>
<div class="stat-label">Regression coefficient (slope), R², residual heterogeneity</div>
</div>
</div>
<div class="focus-box animate delay-4">
<p class="main" style="color: var(--red);">Caution</p>
<p class="sub">Мета-регрессия требует ≥10 исследований на каждую ковариату. Поскольку исследований немного, они носят лишь исследовательский характер. Экологическая ошибка: ассоциации на уровне исследования могут быть неприменимы к отдельным людям.</p>
</div>
<p class="footnote animate delay-5" style="margin-top: 1rem;">
<strong>Example:</strong> In ACCORD, meta-regression might test if treatment effect varies by baseline HbA1c, showing harm concentrated in patients with very high levels.
                </p>
</div>
</div>
 ИСТОРИЯ: Революция SPRINT в области артериального давления 
<div class="slide dark" data-index="13b">
<div class="story-box animate">
<p class="story-opener">What number saves lives? Who decides?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    На протяжении десятилетий целью было: снизить кровяное давление до <span class="data-highlight">&lt;140 mmHg systolic</span>.
                    Then came <span class="data-highlight">SPRINT (2015)</span>: <span class="data-highlight">9,361 high-risk patients</span>
                    randomized to intensive (&lt;120) vs standard (&lt;140) targets.
                    Intensive treatment reduced <span class="data-highlight">CV events by 25%</span> and
                    <span class="data-highlight">death by 27%</span>.
                    Trial stopped early for benefit. Guidelines changed worldwide.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Before SPRINT: The Guidelines Committee</div>
<div class="decision-scenario">
                    В 2014 году вы устанавливаете рекомендации по артериальному давлению. В течение многих лет цель составляла &lt;140. Стоит ли ждать более убедительных доказательств?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Maintain Status Quo</div>
<div class="path-choice">Keep &lt;140 target (established practice, minimal controversy)</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Guidelines unchanged. Physicians continue treating to &lt;140.</div>
<div class="path-outcome">OUTCOME: Miss opportunity to prevent deaths</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Fund the Definitive Trial</div>
<div class="path-choice">Дождитесь результатов SPRINT, прежде чем обновлять цели</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">SPRINT demonstrates benefit. Update target to &lt;120 for high-risk patients.</div>
<div class="path-outcome">OUTCOME: Estimated 100,000+ lives saved globally</div>
</div>
</div>
</div>
<div class="story-timeline">
<div class="timeline-point">JNC 7 (2003): &lt;140</div>
<div class="timeline-point critical">Years of uncertainty</div>
<div class="timeline-point resolution">SPRINT (2015): &lt;120 для групп высокого риска</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    "Стандарт медицинской помощи" не установлен. Ситуация меняется, когда испытания ставят под сомнение предположения. В течение десятилетия пациенты, возможно, получали недостаточное лечение, потому что никто не проверял очевидный вопрос.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="14">
<div class="content">
<h2 class="title navy animate">Module 8 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q8-1">
<h4>1. Почему исследование ACCORD было остановлено досрочно?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 0, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
<span>A.</span> Intensive control showed clear cardiovascular benefit
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 1, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
<span>B.</span> Intensive control increased mortality
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 2, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
<span>C.</span> Набор участников был слишком медленным
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 3, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
<span>D.</span> Budget ran out
                      </div>
</div>
<div id="q8-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q8-2" style="margin-top: 1.5rem;">
<h4>2. What does a prediction interval tell us that a confidence interval doesn't?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 0, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>A.</span> The true effect is more precisely estimated
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 1, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>B.</span> Размер выборки адекватен
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 2, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>C.</span> Диапазон эффектов, которые мы ожидаем в новом исследовании
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 3, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>D.</span> Математическая формула используется
                      </div>
</div>
<div id="q8-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q8-3" style="margin-top: 1.5rem;">
<h4>3. According to ICEMAN, which factor is MOST important for subgroup credibility?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 0, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>A.</span> Предварительная спецификация гипотезы подгруппы
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 1, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>B.</span> Large sample size in the subgroup
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 2, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>C.</span> Statistically significant p-value
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 3, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>D.</span> Multiple outcomes showing same direction
                      </div>
</div>
<div id="q8-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="15">
<p class="closing-line animate">Если исследования расходятся во мнениях,</p>
<p class="closing-line animate delay-1">выслушайте несогласие.</p>
<p class="closing-line gold animate delay-2">Гетерогенность — это сообщение, а не шум.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="16">
<p class="refrain animate">Отсутствие доказательств не является доказательством отсутствия.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 9: Скрытые исследования</p>
</div>
</div>
 Модуль 9: Скрытые исследования (ребоксетин) 
<div class="module-slides" data-module="9">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Отсутствие доказательств не является доказательством отсутствия.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Reboxetine: 2010</p>
<p class="title gold animate delay-1 text-center">74%, которые так и не увидели света.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 9: Скрытые исследования</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Interpret funnel plots for asymmetry detection</li>
<li>Примените тест Эггера и другие статистические тесты на предмет предвзятости публикации.</li>
<li>Внедрить метод обрезки и заполнения для корректировки смещения</li>
<li>Critically appraise the limitations of publication bias tests</li>
<li>Применяйте принцип: «Отсутствие доказательств не является доказательством отсутствия»</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Year: 1997</h2>
<p class="direct-address animate delay-1">
                  "A new hope for depression patients who cannot tolerate SSRIs..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    Ребоксетин (Эдронакс) был новым антидепрессантом — селективным ингибитором обратного захвата норадреналина (NRI). В отличие от СИОЗС, он воздействовал на другую систему нейромедиаторов. Для пациентов, которые потерпели неудачу или не могли переносить флуоксетин или сертралин, был предложен новый механизм.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">1997</div>
<div class="stat-label">EU approval</div>
</div>
<div class="stat-box">
<div class="stat-value">50+</div>
<div class="stat-label">Countries approved</div>
</div>
<div class="stat-box">
<div class="stat-value">Millions</div>
<div class="stat-label">Prescriptions written</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Опубликованные доказательства</h2>
<p class="animate delay-1" style="font-style: italic;">What doctors could find in medical journals:</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>Comparison</th><th>Published Trials</th><th>Published Result</th></tr>
</thead>
<tbody>
<tr>
<td>Reboxetine vs Placebo</td>
<td>3 trials (n=507)</td>
<td style="color: #22c55e;">Significantly better (SMD = 0.56)</td>
</tr>
<tr>
<td>Reboxetine vs SSRIs</td>
<td>4 trials (n=628)</td>
<td style="color: #22c55e;">Equivalent or better</td>
</tr>
</tbody>
</table>
<div class="focus-box animate delay-3 mt-2">
<p class="main">Опубликованная литература рассказала ясную историю:</p>
<p class="sub">Reboxetine works. Patients benefit. Prescribe with confidence.</p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="rhetorical animate" style="font-size: 2rem;">
                А как насчет испытаний, которые вы не могли видеть?
              </p>
<p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                In 2010, German researchers at IQWiG made a request to the European Medicines Agency...
              </p>
<p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                They demanded access to <strong>all</strong> данные испытаний – опубликованные и неопубликованные.
              </p>
<p class="title gold animate delay-3" style="font-size: 2rem; margin-top: 1.5rem;">
                What they found changed everything.
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Полная картина</h2>
<p class="animate delay-1" style="color: #C53030; font-weight: bold; font-style: italic;">Eyding et al., BMJ 2010</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>Comparison</th><th>Published Only</th><th>ALL DATA</th></tr>
</thead>
<tbody>
<tr>
<td><strong>Reboxetine vs Placebo</strong></td>
<td style="color: #22c55e;">SMD 0.56 (benefit)</td>
<td style="color: #C53030;"><strong>SMD 0.10 (no benefit)</strong></td>
</tr>
<tr>
<td>Patients in analysis</td>
<td>507 (14%)</td>
<td><strong>2,731 (100%)</strong></td>
</tr>
<tr>
<td><strong>Reboxetine vs SSRIs</strong></td>
<td style="color: #22c55e;">Equivalent</td>
<td style="color: #C53030;"><strong>Низкий (1,23 руб. за вред)</strong></td>
</tr>
<tr>
<td>Patients in analysis</td>
<td>628 (26%)</td>
<td><strong>2,411 (100%)</strong></td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">74% данных пациентов никогда не публиковались</div>
<div class="label">Скрытые испытания не показали никакой пользы и больше вреда</div>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Investigation Exercise: The File Drawer</h3>
</div>
<p class="direct-address">
                  Вы являетесь систематическим обозревателем в 2008 году. Вы ищете в PubMed, Embase и Кокрейновской библиотеке все исследования ребоксетина. Вы найдете 7 опубликованных исследований, показавших пользу.
                </p>
<p class="rhetorical" style="margin: 1.5rem 0;">
                  Можно ли доверять этим доказательствам?
                </p>
<div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
<button class="reveal-btn" onclick="revealAnswer('rebox-funnel')">Generate Funnel Plot →</button>
</div>
<div class="hidden-reveal" id="rebox-funnel">
<div id="reboxetine-funnel" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<script>
                    // This will be called when revealed
                    setTimeout(() => {
                      if (document.getElementById('rebox-funnel').classList.contains('hidden-reveal') === false) {
                        drawReboxetineFunnel();
                      }
                    }, 100);
                  </script>
<button class="reveal-btn" onclick="drawReboxetineFunnel()" style="margin-top: 0.5rem;">Draw Funnel →</button>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">⚠️Воронка кардинально асимметрична!</p>
<p class="sub">Все опубликованные исследования группируются на одной стороне. Где нулевые и отрицательные испытания?</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">Инструментарий по предвзятости публикаций</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Funnel Plot</h4>
<p>Plot effect size vs. standard error. A symmetric funnel suggests no bias; asymmetry raises alarms.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Egger's Regression Test</h4>
<p>Regress effect/SE on 1/SE. A non-zero intercept (P &lt; 0.10) suggests small-study effects. Note: inflated false-positive rate with binary outcomes; use Peters' test instead.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Peters' Test</h4>
<p>For binary outcomes, regresses log OR on inverse of total sample size. Less prone to false positives.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Trim-and-Fill</h4>
<p>Учитывает «недостающие» исследования, чтобы сделать воронку симметричной, а затем пересчитывает совокупный эффект.</p>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="8">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>Интерактивный режим: анализ обрезки и заполнения</h3>
</div>
<p class="direct-address">
                  Давайте применим обрезку и заполнение к данным по ребоксетину и посмотрим, какой будет скорректированная оценка...
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">Published Only</h4>
<p>7 trials</p>
<p style="font-size: 1.2rem; font-weight: bold; color: #22c55e;">SMD = 0.56</p>
<p style="font-size: 0.9rem;">Significant benefit</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">Trim-and-Fill</h4>
<p>7 + 5 imputed = 12 trials</p>
<p style="font-size: 1.2rem; font-weight: bold; color: #f59e0b;">SMD = 0.23</p>
<p style="font-size: 0.9rem;">Reduced, still nominally significant</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem; border-color: #C53030;">
<p class="main" style="color: #C53030;">But even trim-and-fill underestimated the problem!</p>
<p class="sub">Истинный эффект для всех данных составил SMD = 0,10 (по существу нулевой).<br/>Trim-and-fill is conservative—it doesn't fully correct for selective publication.</p>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">The Best Defense: Trial Registries</h2>
<p class="animate delay-1">Методы обнаружения предвзятости публикаций несовершенны. Реальное решение <strong>prospective registration</strong>.</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">ClinicalTrials.gov</div>
<div class="stat-label">US registry (2000)</div>
</div>
<div class="stat-box">
<div class="stat-value">WHO ICTRP</div>
<div class="stat-label">Global portal</div>
</div>
<div class="stat-box">
<div class="stat-value">PROSPERO</div>
<div class="stat-label">Review registration</div>
</div>
</div>
<div class="card animate delay-3">
<p class="card-text">
                    При поиске испытаний всегда проверяйте реестры. Сравните количество <strong>registered</strong> испытания на количество <strong>published</strong>. Разрыв — ваш предупреждающий сигнал.
                  </p>
</div>
<p class="footnote animate delay-4">
                  Since 2005, ICMJE requires trial registration as a condition of publication.
                </p>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Кампания AllTrials</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.2rem; text-align: center;">
<strong>"All trials registered. All results reported."</strong>
</p>
</div>
<p class="animate delay-2" style="margin-top: 1rem;">
                  Скандал с ребоксетином, наряду с аналогичными случаями с другими препаратами, стал катализатором глобального движения:
                </p>
<div class="lesson-item animate delay-3">
<div class="lesson-number">✓</div>
<div class="lesson-content">
<h4>2013: Политика EMA в отношении клинических данных</h4>
<p>European Medicines Agency commits to publishing clinical study reports</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">✓</div>
<div class="lesson-content">
<h4>2016: FDA Amendments Act enforcement</h4>
<p>Mandatory results reporting on ClinicalTrials.gov within 12 months</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">✓</div>
<div class="lesson-content">
<h4>AllTrials Coalition</h4>
<p>Over 90,000 supporters, 700+ organizations demanding transparency</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Последствия ребоксетина</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number" style="background: #C53030;">!</div>
<p>Germany's IQWiG recommended against reboxetine for depression</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number" style="background: #C53030;">!</div>
<p>Британский NICE понизил рейтинг до «не рекомендуется».</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number" style="background: #C53030;">!</div>
<p>FDA отклонило ребоксетин в 2001 году (у них был доступ к неопубликованным данным).</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">Более десяти лет пациенты получали препарат не лучше, чем плацебо.</p>
<p class="sub">Потому что были опубликованы только положительные испытания.</p>
</div>
</div>
</div>
 ИСТОРИЯ: Исследование пароксетина 329 Обман 
<div class="slide dark" data-index="11b">
<div class="story-box animate">
<p class="story-opener">Что, если опубликованное заключение противоречит фактическим данным?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    В исследовании 329 компании GlaxoSmithKline пароксетин был протестирован у <span class="data-highlight">adolescent depression</span>. В опубликованной статье (2001) сделан вывод, что пароксетин <span class="data-highlight">"generally well tolerated and effective."</span>
                    Фактические данные: пароксетин <span class="data-highlight">failed on all 8 pre-specified outcomes</span>.
                    When re-analyzed (RIAT 2015), suicidal/self-harm events: <span class="data-highlight">23 в группе пароксетина против 5 в группе плацебо</span>. Опубликованная статья переопределила результаты post-hoc, чтобы оценить производственную значимость. В 2015 году повторный анализ RIAT (Восстановление невидимых и прерванных исследований) с использованием <span class="data-highlight">оригинального отчета о клиническом исследовании</span>
                    пришел к выводу: пароксетин был <span class="data-highlight">neither safe nor effective</span> for adolescents.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Загадкой врача: 2003</div>
<div class="decision-scenario">
                    Вы детский психиатр. Исследование 329 — единственное крупное исследование — показало, что пароксетин эффективен у подростков. Но FDA не одобрило его для подростков. Родитель просит вас прописать его. Что вы делаете?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">ПУТЬ A: Доверять публикации</div>
<div class="path-choice">A peer-reviewed JAACAP paper says it works. Prescribe off-label.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Millions of prescriptions worldwide. Suicidal events in adolescents.</div>
<div class="path-outcome">OUTCOME: FDA issues black box warning for SSRIs in youth (2004)</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Check the Trial Registry</div>
<div class="path-choice">Поиск исходных конечных точек на сайте ClinicalTrials.gov. Обратите внимание, что опубликованные результаты не соответствуют зарегистрированному протоколу.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Красный флаг: обнаружено переключение результатов. Вы отказываетесь от приема препарата. Пациент в большей безопасности.</div>
<div class="path-outcome">OUTCOME: Publication bias identified before harm</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Предвзятость публикаций связана не только с отсутствием исследований. Речь идет об отсутствии истины в опубликованных исследованиях. Переключение результатов, фиктивное написание и выборочная отчетность могут превратить неудачное испытание в маркетинговый инструмент. Всегда сравнивайте опубликованные результаты с протоколами реестра исследований.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Module 9 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q9-1">
<h4>1. Какой процент данных испытаний ребоксетина был скрыт из опубликованной литературы?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 0, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>A.</span> 25%
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 1, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>B.</span> 50%
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 2, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>C.</span> 74%
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 3, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>D.</span> 90%
                      </div>
</div>
<div id="q9-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q9-2" style="margin-top: 1.5rem;">
<h4>2. Why can trim-and-fill underestimate the correction needed?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 0, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>A.</span> It assumes effects are normally distributed
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 1, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>B.</span> Он учитывает только исследования для достижения симметрии, что может не полностью отражать реальность
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 2, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>C.</span> Требуется не менее 20 исследований
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 3, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>D.</span> Это работает только с очень крупными исследованиями
                      </div>
</div>
<div id="q9-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q9-3" style="margin-top: 1.5rem;">
<h4>3. What is the best prospective defense against publication bias?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 0, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>A.</span> Funnel plots in all meta-analyses
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 1, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>B.</span> Egger's test before pooling
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 2, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>C.</span> Prospective trial registration
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 3, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>D.</span> More medical journals
                      </div>
</div>
<div id="q9-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="13">
<p class="closing-line animate">То, что вы не можете см.</p>
<p class="closing-line animate delay-1">may be more important than what you can.</p>
<p class="closing-line gold animate delay-2">Отсутствие доказательств не является доказательством отсутствия.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="14">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 10: Уверенность</p>
</div>
</div>
 Модуль 10: Уверенность (ранний поверхностно-активный агент) 
<div class="module-slides" data-module="10">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Early Surfactant: 2012</p>
<p class="title gold animate delay-1 text-center">Когда появляются доказательства высокого качества.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 10: Уверенность</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Примените полную структуру GRADE для оценки достоверности доказательства</li>
<li>Evaluate all five downgrade factors (RoB, inconsistency, indirectness, imprecision, publication bias)</li>
<li>Identify when to upgrade for large effect, dose-response, or confounding</li>
<li>Construct Summary of Findings tables with absolute effect estimates</li>
<li>Применяйте принцип: «Уверенность необходимо заслужить, а не предполагать»</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Year: 1990s</h2>
<p class="direct-address animate delay-1">
                  "A revolution in neonatal care..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    Респираторный дистресс-синдром (РДС) был основной причиной смерти недоношенных детей. Разработка экзогенного <strong>surfactant</strong>— вещества, которое удерживает альвеолы от коллапса, — стала одним из величайших достижений в неонатальной медицине.
                  </p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">Встал вопрос: когда нам следует вводить сурфактант?</p>
<p class="sub">Prophylactically (to all high-risk infants) or selectively (only after RDS develops)?</p>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Оригинальный Кокрейновский обзор (2003)</h2>
<p class="animate delay-1" style="font-style: italic;">Multiple RCTs conducted before the era of routine CPAP</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>Outcome</th><th>Prophylactic vs Selective</th><th>Certainty</th></tr>
</thead>
<tbody>
<tr>
<td>Neonatal mortality</td>
<td style="color: #22c55e;">RR 0.73 (favors prophylactic)</td>
<td>High</td>
</tr>
<tr>
<td>BPD or death</td>
<td style="color: #22c55e;">RR 0.84 (favors prophylactic)</td>
<td>High</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">Recommendation: Give surfactant prophylactically</div>
<div class="label">Guidelines worldwide adopted this approach</div>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="rhetorical animate" style="font-size: 2rem;">
                Но мир ухода за новорожденными менялся...
              </p>
<p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                A new technology emerged: <strong>Continuous Positive Airway Pressure (CPAP)</strong>
</p>
<p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                Non-invasive support that could help preterm lungs without intubation.
              </p>
<p class="title gold animate delay-3" style="font-size: 1.5rem; margin-top: 1.5rem;">
                Применимы ли по-прежнему старые доказательства?
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Кокрейновское обновление 2012 года</h2>
<p class="animate delay-1" style="color: #C53030; font-weight: bold;">New trials conducted in the CPAP era</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>Outcome</th><th>Old Trials</th><th>New Trials</th></tr>
</thead>
<tbody>
<tr>
<td>BPD or death</td>
<td style="color: #22c55e;">RR 0.84 (favors prophylactic)</td>
<td style="color: #C53030;">RR 1.12 (favors selective)</td>
</tr>
<tr>
<td>Потребность в механических вентиляция</td>
<td style="color: #22c55e;">Нижняя с профилактической</td>
<td style="color: #C53030;">Высшая с профилактической!</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">Complete Reversal</div>
<div class="label">In the CPAP era, prophylactic surfactant causes more harm</div>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Investigation: Why Did Evidence Evolve?</h3>
</div>
<p class="direct-address">
                  Вы неонатолог. Коллега спрашивает: «Как рандомизированные исследования могут противоречить друг другу?»
                </p>
<p class="rhetorical" style="margin: 1rem 0;">
                  Были ли первоначальные данные ошибочными?
                </p>
<button class="reveal-btn" onclick="revealAnswer('surfactant-explain')">Понять эволюцию →</button>
<div class="hidden-reveal" id="surfactant-explain">
<div class="lesson-item" style="margin-top: 1rem;">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Indirectness Changed</h4>
<p>Old trials: No CPAP available. New trials: CPAP standard of care.</p>
</div>
</div>
<div class="lesson-item">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Улучшенный компаратор</h4>
<p>Selective surfactant + CPAP is better than prophylactic intubation.</p>
</div>
</div>
<div class="lesson-item">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Context Matters</h4>
<p>Данные одной эпохи могут не применяться к другой.</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">This is why GRADE assesses Indirectness!</p>
<p class="sub">High-quality evidence can become inapplicable when context changes.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">GRADE Framework</h2>
<p class="animate delay-1" style="margin-bottom: 1rem; font-style: italic;">
                  Grading of Recommendations, Assessment, Development and Evaluations
                </p>
<p class="animate delay-2">GRADE отвечает на вопрос: <strong>Насколько мы уверены в этой оценке?</strong></p>
<div class="animate delay-3" style="max-width: 700px;">
<div class="card" style="background: rgba(34,197,94,0.15); border-left: 4px solid #22c55e;">
<p class="card-text"><strong>⊕⊕⊕⊕ HIGH:</strong> Very confident. True effect is close to the estimate.</p>
</div>
<div class="card" style="background: rgba(59,130,246,0.15); border-left: 4px solid #3b82f6; margin-top: 0.5rem;">
<p class="card-text"><strong>⊕⊕⊕◯ MODERATE:</strong> Moderately confident. True effect likely close, but may differ substantially.</p>
</div>
<div class="card" style="background: rgba(245,158,11,0.15); border-left: 4px solid #f59e0b; margin-top: 0.5rem;">
<p class="card-text"><strong>⊕⊕◯◯ LOW:</strong> Limited confidence. True effect may differ substantially.</p>
</div>
<div class="card" style="background: rgba(197,48,48,0.15); border-left: 4px solid #C53030; margin-top: 0.5rem;">
<p class="card-text"><strong>⊕◯◯◯ VERY LOW:</strong> Very little confidence. True effect likely substantially different.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">GRADE: Factors That Downgrade Certainty</h2>
<p class="animate delay-1">Доказательства РКИ начинаются с ВЫСОКОГО уровня. Его можно понизить по следующим причинам:</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #C53030;">1</div>
<div class="lesson-content">
<h4>Risk of Bias</h4>
<p>Flawed randomization, lack of blinding, incomplete follow-up, selective reporting</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #C53030;">2</div>
<div class="lesson-content">
<h4>Inconsistency</h4>
<p>Unexplained heterogeneity across studies (large I², non-overlapping CIs)</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #C53030;">3</div>
<div class="lesson-content">
<h4>Indirectness</h4>
<p>Различия в популяции, вмешательстве, сравнительном анализаторе или исходах вопроса</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number" style="background: #C53030;">4</div>
<div class="lesson-content">
<h4>Imprecision</h4>
<p>Wide confidence intervals, small sample size, few events</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">ОЦЕНКА: Пятый фактор</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #C53030;">5</div>
<div class="lesson-content">
<h4>Publication Bias</h4>
<p>Asymmetric funnel plot, missing registered trials, sponsor influence</p>
</div>
</div>
<div class="focus-box animate delay-2 mt-2">
<p class="main">Each factor can downgrade by one or two levels</p>
<p class="sub">High → Moderate → Low → Very Low</p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem;">
<p class="card-text">
<strong>Example:</strong> Метаанализ РКИ (начинается ВЫСОКИМ) с высоким риском систематической ошибки (↓1) и серьезной косвенностью (↓1) будет оценен <strong>LOW</strong>.
                  </p>
</div>
</div>
</div>
<div class="slide dark" data-index="10">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>Interactive: Apply GRADE to Surfactant</h3>
</div>
<p class="direct-address">
                  Давайте оценим достоверность доказательств в пользу профилактического применения сурфактанта с использованием старых и новых исследований.
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">OLD TRIALS (Pre-CPAP)</h4>
<p><strong>Starting:</strong> HIGH (RCTs)</p>
<p><strong>Risk of Bias:</strong> Low (−0)</p>
<p><strong>Inconsistency:</strong> None (−0)</p>
<p><strong>Indirectness:</strong> Serious (−1)</p>
<p style="font-size: 0.85rem; color: #f59e0b;">Different standard of care today</p>
<p><strong>Final:</strong> ⊕⊕⊕◯ MODERATE</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">NEW TRIALS (CPAP Era)</h4>
<p><strong>Starting:</strong> HIGH (RCTs)</p>
<p><strong>Risk of Bias:</strong> Low (−0)</p>
<p><strong>Inconsistency:</strong> None (−0)</p>
<p><strong>Indirectness:</strong> None (−0)</p>
<p style="font-size: 0.85rem; color: #22c55e;">Matches current practice</p>
<p><strong>Final:</strong> ⊕⊕⊕⊕ HIGH</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">GRADE: Factors That Upgrade Certainty</h2>
<p class="animate delay-1">Наблюдательные данные начинаются с НИЗКОГО уровня. Его можно обновить для:</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #22c55e;">+1</div>
<div class="lesson-content">
<h4>Large Magnitude of Effect</h4>
<p>RR &gt;2 или &lt;0,5 без каких-либо правдоподобных искажений</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #22c55e;">+1</div>
<div class="lesson-content">
<h4>Dose-Response Gradient</h4>
<p>Higher exposure = larger effect in a consistent pattern</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #22c55e;">+1</div>
<div class="lesson-content">
<h4>Residual Confounding</h4>
<p>All plausible confounders would reduce the effect (strengthens causal inference)</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Communicating Certainty</h2>
<p class="animate delay-1">GRADE requires transparent language about confidence:</p>
<div class="card animate delay-2">
<p class="card-text"><strong>HIGH:</strong> "Prophylactic surfactant <em>reduces</em> mortality..."</p>
</div>
<div class="card animate delay-3">
<p class="card-text"><strong>MODERATE:</strong> "Prophylactic surfactant <em>probably reduces</em> mortality..."</p>
</div>
<div class="card animate delay-4">
<p class="card-text"><strong>LOW:</strong> "Prophylactic surfactant <em>may reduce</em> mortality..."</p>
</div>
<div class="card animate delay-5">
<p class="card-text"><strong>VERY LOW:</strong> "We are <em>uncertain whether</em> prophylactic surfactant reduces mortality..."</p>
</div>
<p class="footnote animate delay-6">
                  Этот язык позволяет врачам понять силу доказательств.
                </p>
</div>
</div>
 ИСТОРИЯ: Кислородный парадокс недоношенного ребенка 
<div class="slide dark" data-index="12b">
<div class="story-box animate">
<p class="story-opener">Can too much of a lifesaver become a killer?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
<span class="data-highlight">1940s-50s:</span> High oxygen concentrations saved premature babies from respiratory failure.
                    Then came an <span class="data-highlight">epidemic of blindness</span>—retrolental fibroplasia (now called ROP).
                    Doctors <span class="data-highlight">reduced oxygen dramatically</span>. Blindness dropped.
                    But then: <span class="data-highlight">increased deaths and brain damage</span> от гипоксия. Требуемый оптимальный уровень кислорода <span class="data-highlight">decades of trials</span> to find.
                    Recent SUPPORT/BOOST II trials finally defined the therapeutic window: SpO2 <span class="data-highlight">91-95%</span>.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Дилемма неонатолога: 1955</div>
<div class="decision-scenario">
                    Вы неонатолог. Недоношенные дети, получающие повышенное содержание кислорода, слепнут. Что вы делаете?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Dramatic Reduction</div>
<div class="path-choice">Drastically reduce oxygen to prevent blindness</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Blindness rates drop. But some babies die or suffer brain damage from hypoxia.</div>
<div class="path-outcome">OUTCOME: Trading one harm for another</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">ПУТЬ B: Систематическое исследование</div>
<div class="path-choice">Тщательно титровать кислород, изучать зависимость «доза-реакция»</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Takes decades but eventually identifies the optimal range.</div>
<div class="path-outcome">OUTCOME: Optimize both survival and vision</div>
</div>
</div>
</div>
<div class="story-timeline">
<div class="timeline-point">1940s: High O2 saves lives</div>
<div class="timeline-point critical">1950s: Blindness epidemic</div>
<div class="timeline-point critical">1960-70-е годы: Смертельные случаи из-за низкого уровня O2</div>
<div class="timeline-point resolution">2010s: SUPPORT/BOOST define optimal range</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Каждое вмешательство имеет терапевтический эффект окно. Чтобы найти его, нужны измерения, а не предположения. Маятник раскачивался 60 лет, прежде чем доказательства определили баланс.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">Module 10 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q10-1">
<h4>1. Почему рекомендации по использованию поверхностно-активных веществ изменились в период с 2003 по 2012 год?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 0, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>A.</span> Первоначальные исследования были сфальсифицированы
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 1, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>B.</span> CPAP changed the comparator (indirectness)
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 2, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>C.</span> Not enough patients in original trials
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 3, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>D.</span> Результат оценивался по-разному
                      </div>
</div>
<div id="q10-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q10-2" style="margin-top: 1.5rem;">
<h4>2. Что из перечисленного НЕ является фактором понижения ОЦЕНКИ?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 0, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>A.</span> Risk of bias
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 1, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>B.</span> Imprecision
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 2, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>C.</span> Publication bias
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 3, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>D.</span> Large magnitude of effect
                      </div>
</div>
<div id="q10-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q10-3" style="margin-top: 1.5rem;">
<h4>3. Какой язык следует использовать для доказательств НИЗКОЙ достоверности?</h4>
<div class="quiz-options">
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 0, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>A.</span> "Вмешательство снижает..."
                      </div>
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 1, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>B.</span> "Вмешательство, вероятно, снижает..."
                      </div>
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 2, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>C.</span> "Вмешательство может снизить..."
                      </div>
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 3, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>D.</span> "Мы не уверены ли..."
                      </div>
</div>
<div id="q10-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="14">
<p class="closing-line animate">Количества недостаточно.</p>
<p class="closing-line animate delay-1">Вы должны сообщить, насколько вы уверены.</p>
<p class="closing-line gold animate delay-2">Certainty must be earned, not assumed.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="15">
<p class="refrain animate">Методы защищают пациентов от нашего доверия.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 11: The Living Review</p>
</div>
</div>
 Модуль 11: The Living Review (COVID-19) 
<div class="module-slides" data-module="11">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Методы защищают пациентов от нашего доверия.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">COVID-19 Hydroxychloroquine: 2020</p>
<p class="title gold animate delay-1 text-center">Когда срочность соответствует доказательствам.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 11: The Living Review</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Применить последовательный анализ испытаний, чтобы определить, когда доказательств достаточно</li>
<li>Разработать и поддерживать живой систематический обзор</li>
<li>Establish update triggers and futility/harm boundaries</li>
<li>Manage multiplicity and alpha-spending in sequential analyses</li>
<li>Explain how rapid evidence synthesis evolved during COVID-19</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">March 2020: A World in Crisis</h2>
<p class="direct-address animate delay-1">
                  "Вирус распространяется быстрее, чем наши понимание..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    COVID-19 убивал тысячи людей. Отделения интенсивной терапии были переполнены. Не было ни вакцины, ни лечения. Затем проблеск надежды: <strong>hydroxychloroquine (HCQ)</strong>—an old malaria drug—showed
                    antiviral activity in lab studies.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">March 20</div>
<div class="stat-label">Исследование Готре (Франция)</div>
</div>
<div class="stat-box">
<div class="stat-value">36 pts</div>
<div class="stat-label">Non-randomized</div>
</div>
<div class="stat-box">
<div class="stat-value">Viral</div>
<div class="stat-label">Clearance improved</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Спешка усыновить</h2>
<p class="animate delay-1" style="font-style: italic;">Через несколько недель после исследования Готре:</p>
<div class="wrong-item animate delay-2">
<div class="wrong-number" style="background: #f59e0b;">!</div>
<p><strong>March 28:</strong> FDA issues Emergency Use Authorization for HCQ</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number" style="background: #f59e0b;">!</div>
<p><strong>April 4:</strong> India bans HCQ export (hoarding fears)</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number" style="background: #f59e0b;">!</div>
<p><strong>Global:</strong> Shortages affect lupus and rheumatoid arthritis patients</p>
</div>
<div class="focus-box animate delay-5 mt-2" style="border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">Millions received HCQ based on a 36-patient observational study</p>
<p class="sub">What could go wrong?</p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Расследование: Готре Исследование</h3>
</div>
<p class="direct-address">
                  Вы являетесь экспертом по доказательной медицине и попросили оценить исследование французского HCQ. Изучите конструкцию...
                </p>
<button class="reveal-btn" onclick="revealAnswer('hcq-flaws')">Определите недостатки →</button>
<div class="hidden-reveal" id="hcq-flaws">
<table class="data-table-investigation" style="margin-top: 1rem;">
<thead><tr><th>Issue</th><th>Impact</th></tr></thead>
<tbody>
<tr><td><strong>Non-randomized</strong></td><td>Selection bias—who got HCQ?</td></tr>
<tr><td><strong>6 patients excluded</strong></td><td>3 went to ICU, 1 died, 1 withdrew, 1 had nausea</td></tr>
<tr><td><strong>Surrogate outcome</strong></td><td>Viral load, not clinical outcomes</td></tr>
<tr><td><strong>Контроль из другой больницы</strong></td><td>Different care, different testing</td></tr>
<tr><td><strong>No blinding</strong></td><td>Expectation bias in lab testing</td></tr>
</tbody>
</table>
<div class="focus-box" style="margin-top: 1rem; border-color: #C53030;">
<p class="main" style="color: #C53030;">Это исследование будет иметь ВЫСОКИЙ риск систематической ошибки по RoB 2.0</p>
<p class="sub">GRADE certainty: VERY LOW. Yet it changed global policy.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Why Observational COVID Studies Misled</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #C53030;">1</div>
<div class="lesson-content">
<h4>Immortal Time Bias</h4>
<p>Patients must survive long enough to receive treatment. Survivors are compared to non-survivors.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #C53030;">2</div>
<div class="lesson-content">
<h4>Confounding by Indication</h4>
<p>Sicker patients may get different treatments. Healthier patients received HCQ early.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #C53030;">3</div>
<div class="lesson-content">
<h4>Healthy User Effect</h4>
<p>Patients who seek treatment tend to be healthier overall.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #C53030;">4</div>
<div class="lesson-content">
<h4>Outcome Reporting</h4>
<p>Исследования с положительными результатами публикуются быстрее.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">Июнь 2020 г.: Отчет о РКИ</h2>
<p class="animate delay-1" style="font-style: italic;">Large, rigorous trials completed at remarkable speed</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>Trial</th><th>N</th><th>Result</th></tr>
</thead>
<tbody>
<tr>
<td>RECOVERY (UK)</td>
<td>4,716</td>
<td style="color: #C53030;">No benefit on mortality (RR 1.09)</td>
</tr>
<tr>
<td>WHO SOLIDARITY</td>
<td>954</td>
<td style="color: #C53030;">No benefit (RR 1.19)</td>
</tr>
<tr>
<td>ORCHID (US)</td>
<td>479</td>
<td style="color: #C53030;">Остановлен бесполезность</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">HCQ provided no benefit—and may have caused harm</div>
<div class="label">June 15, 2020: FDA revokes Emergency Use Authorization</div>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>Хронология: наблюдения и данные РКИ</h3>
</div>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">March-May 2020</h4>
<p><strong>Observational:</strong> ~20 studies</p>
<p style="color: #22c55e;">Suggest benefit</p>
<p style="font-size: 0.85rem;">Pooled OR ~0.65</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">June-July 2020</h4>
<p><strong>RCTs:</strong> RECOVERY, SOLIDARITY</p>
<p style="color: #C53030;">Show no benefit/harm</p>
<p style="font-size: 0.85rem;">Pooled RR ~1.10</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem;">
<p class="main">От «многообещающего» до «неэффективного» за 3 месяца</p>
<p class="sub">Вот почему нам нужна рандомизация — и живые обзоры для отслеживания развивающихся доказательств.</p>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Living Systematic Reviews</h2>
<p class="animate delay-1">Новый подход для быстрого развития доказательства:</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #22c55e;">1</div>
<div class="lesson-content">
<h4>Continuous Surveillance</h4>
<p>Ищите в литературе еженедельно или даже ежедневно новые доказательства</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #22c55e;">2</div>
<div class="lesson-content">
<h4>Cumulative Meta-Analysis</h4>
<p>Update pooled estimates as each new trial reports</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #22c55e;">3</div>
<div class="lesson-content">
<h4>Последовательный анализ испытаний (TSA)</h4>
<p>Determine when sufficient information has accumulated to conclude</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number" style="background: #22c55e;">4</div>
<div class="lesson-content">
<h4>Transparent Versioning</h4>
<p>Track every change, maintain full audit trail</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Последовательный анализ испытаний (TSA)</h2>
<p class="animate delay-1" style="font-style: italic;">When have we learned enough?</p>
<div class="card animate delay-2">
<p class="card-text">
                    TSA применяет останавливающие границы к метаанализу — аналогично промежуточному анализу в одном исследовании. Это объясняет <strong>required information size (RIS)</strong> needed to detect or exclude
                    a clinically meaningful effect.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">RIS</div>
<div class="stat-label">Required sample size</div>
</div>
<div class="stat-box">
<div class="stat-value">α-spending</div>
<div class="stat-label">Controls type I error</div>
</div>
<div class="stat-box">
<div class="stat-value">Boundaries</div>
<div class="stat-label">Benefit / Harm / Futility</div>
</div>
</div>
<p class="footnote animate delay-4">
                  Для HCQ в условиях COVID TSA показало, что граница бесполезности была пересечена к июню 2020 года.
                </p>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Уроки саги о HCQ</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.1rem;">
<strong>1. Observational studies can mislead spectacularly</strong> , когда предвзятость преобладает. Даже многие исследования, указывающие в одном и том же направлении, могут быть ошибочными.
                  </p>
</div>
<div class="card animate delay-2">
<p class="card-text" style="font-size: 1.1rem;">
<strong>2. RCTs can be conducted quickly</strong> when the will exists.
                    RECOVERY enrolled 5,000+ patients in weeks.
                  </p>
</div>
<div class="card animate delay-3">
<p class="card-text" style="font-size: 1.1rem;">
<strong>3. Живые отзывы очень важны</strong> for evolving topics.
                    Fixed-point-in-time reviews become obsolete instantly.
                  </p>
</div>
<div class="card animate delay-4">
<p class="card-text" style="font-size: 1.1rem;">
<strong>4. Political pressure doesn't change biology.</strong>
                    Тщательные методы защищают пациентов даже в стрессовых ситуациях.
                  </p>
</div>
</div>
</div>
 ИСТОРИЯ: Революция LEAP в отношении аллергии на арахис 
<div class="slide dark" data-index="10b">
<div class="story-box animate">
<p class="story-opener">Что, если профилактика ЯВЛЯЕТСЯ причиной?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    For decades, pediatric guidelines recommended: <span class="data-highlight">avoid peanuts in infancy</span> to prevent allergy.
                    Meanwhile, peanut allergy rates <span class="data-highlight">tripled</span> с 1997 по 2008 год. Тогда пришел <span class="data-highlight">LEAP (2015)</span>: 640 high-risk infants randomized to
                    early peanut introduction vs. avoidance.
                    Result: Early introduction <span class="data-highlight">reduced peanut allergy by 81%</span> (1,9% против 13,7%). Стратегия профилактики стала причиной эпидемии.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Перекресток аллергологов: 2010</div>
<div class="decision-scenario">
                    Вы детский аллерголог. Аллергия на арахис растет, несмотря на рекомендации по предотвращению его употребления. Вы подвергаете сомнению догму?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Follow Guidelines</div>
<div class="path-choice">Continue recommending peanut avoidance in high-risk infants</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Guidelines are "evidence-based." Safe to follow consensus.</div>
<div class="path-outcome">OUTCOME: Peanut allergies continue to rise</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">ПУТЬ Б: Ставьте под сомнение догму</div>
<div class="path-choice">Design a trial to test if early introduction might be protective</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">LEAP trial reveals the truth. Guidelines reverse worldwide.</div>
<div class="path-outcome">OUTCOME: Prevent an epidemic</div>
</div>
</div>
</div>
<div class="story-timeline">
<div class="timeline-point">2000: AAP recommends avoidance</div>
<div class="timeline-point critical">2008: Allergy rates triple</div>
<div class="timeline-point resolution">2015: LEAP переворачивает доказательства</div>
<div class="timeline-point resolution">2017: Guidelines flip to early introduction</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Для принципа «прежде всего не навреди» требуются доказательства. Предположения, даже сделанные из лучших побуждений, могут нанести масштабный вред. Иммунная система нуждалась в воздействии, чтобы развить толерантность — избегание вызывало сенсибилизацию.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 11 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q11-1">
<h4>1. В чем заключался основной недостаток исследования гидроксихлорохина Готре?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 0, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>A.</span> Too few patients
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 1, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>B.</span> No blinding
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 2, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>C.</span> Excluding patients who deteriorated
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 3, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>D.</span> Too short follow-up
                      </div>
</div>
<div id="q11-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q11-2" style="margin-top: 1.5rem;">
<h4>2. What does Trial Sequential Analysis help determine?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 0, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>A.</span> Which studies have high risk of bias
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 1, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>B.</span> When enough evidence has accumulated
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 2, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>C.</span> Степень гетерогенности
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 3, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>D.</span> Which treatment is best
                      </div>
</div>
<div id="q11-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q11-3" style="margin-top: 1.5rem;">
<h4>3. Почему наблюдательные исследования COVID показали пользу HCQ, а РКИ — нет?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 0, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>A.</span> RCTs enrolled sicker patients
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 1, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>B.</span> RCTs used different outcomes
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 2, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>C.</span> Смещение в обсервационных исследованиях
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 3, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>D.</span> Обсервационные исследования имели лучшие данные
                      </div>
</div>
<div id="q11-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="12">
<p class="closing-line animate">Speed cannot replace rigor.</p>
<p class="closing-line animate delay-1">But rigor can be fast.</p>
<p class="closing-line gold animate delay-2">Living reviews balance both.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 12: Расширенные методы</p>
</div>
</div>
 Модуль 12: Расширенные методы 
<div class="module-slides" data-module="12">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Advanced Methods</p>
<p class="title gold animate delay-1 text-center">Beyond pairwise meta-analysis.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Модуль 12: Расширенные методы</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Interpret network meta-analysis geometry and SUCRA rankings</li>
<li>Apply bivariate models for diagnostic test accuracy meta-analysis</li>
<li>Conduct dose-response meta-analysis with flexible splines</li>
<li>Understand when individual patient data (IPD) meta-analysis is needed</li>
<li>Определите предположения и ограничения каждого из них расширенный метод</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Когда пар недостаточно</h2>
<p class="direct-address animate delay-1">
                  "Иногда вопрос более сложен, чем вопрос A или B..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    Методы, которые вы изучили, составляют основу. Но клиническая реальность часто требует большего:
                    <strong>Which of 10 antidepressants is best?</strong> <strong>What's the optimal dose of statin?</strong>
<strong>Does this test accurately diagnose early cancer?</strong>
</p>
</div>
<p class="footnote animate delay-3">
                  В этом модуле представлены четыре продвинутых метода, каждый из которых отвечает на разные сложные вопросы.
                </p>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Network Meta-Analysis (NMA)</h2>
<p class="animate delay-1" style="font-style: italic;">When you have many treatments but few head-to-head trials</p>
<div class="card animate delay-2">
<p class="card-text">
                    NMA combines <strong>direct evidence</strong> (A vs B) with <strong>indirect evidence</strong>
                    (A vs C, B vs C → inferred A vs B) to compare multiple treatments simultaneously.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">SUCRA</div>
<div class="stat-label">Ranking probabilities, not effect size</div>
</div>
<div class="stat-box">
<div class="stat-value">Consistency</div>
<div class="stat-label">Direct = Indirect?</div>
</div>
<div class="stat-box">
<div class="stat-value">Networks</div>
<div class="stat-label">Visualize evidence</div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>NMA Example: Antidepressants</h3>
</div>
<p class="direct-address">
                  The landmark Cipriani 2018 NMA compared 21 antidepressants using 522 trials.
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">The Challenge</h4>
<p>21 drugs, but not every pair tested head-to-head</p>
<p style="font-size: 0.85rem;">Many vs. placebo, few vs. each other</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">The Solution</h4>
<p>NMA объединяет прямые и косвенные доказательства по всей сети.</p>
<p style="font-size: 0.85rem;">Оценивает все 21 по эффективности и приемлемости</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem;">
<p class="main">Результат: одни лекарства получили более высокий рейтинг по эффективности, другие по приемлемости.</p>
<p class="sub">Ни один препарат не является универсально «лучшим»; интерпретируйте рейтинги с достоверными интервалами, транзитивностью и клиническими компромиссами.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">NMA: Critical Assumptions</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #f59e0b;">1</div>
<div class="lesson-content">
<h4>Transitivity</h4>
<p>Effect modifiers should be similarly distributed across comparisons; otherwise indirect comparisons may be biased</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #f59e0b;">2</div>
<div class="lesson-content">
<h4>Consistency</h4>
<p>Прямые и косвенные доказательства согласуются (проверяемые)</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #f59e0b;">3</div>
<div class="lesson-content">
<h4>Connected Network</h4>
<p>All treatments linked through at least one common comparator</p>
</div>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">When assumptions fail, NMA can mislead</p>
<p class="sub">Всегда оценивайте транзитивность и проверяйте ее на наличие несоответствие.</p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">Dose-Response Meta-Analysis</h2>
<p class="animate delay-1" style="font-style: italic;">Нахождение оптимальной дозы</p>
<div class="card animate delay-2">
<p class="card-text">
                    Uses the <strong>Greenland-Longnecker method</strong> с ограниченными кубическими сплайнами для моделирования нелинейных взаимосвязей между дозой и эффектом.
                  </p>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Non-linear patterns</h4>
<p>J-shaped (alcohol &amp; mortality), U-shaped (vitamin D), threshold (aspirin)</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Clinical relevance</h4>
<p>Найдите дозу с наилучшим балансом пользы и вреда, а не просто «чем больше, тем лучше».</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">Индивидуальные данные пациента (IPD)</h2>
<p class="animate delay-1" style="font-style: italic;">Золотой стандарт анализа подгрупп</p>
<div class="card animate delay-2">
<p class="card-text">
                    Instead of published summary data, obtain <strong>необработанные данные на уровне пациента</strong> от испытателей. Обеспечивает точный анализ подгрупп, моделирование времени до события и стандартизированные определения.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">One-Stage</div>
<div class="stat-label">Single hierarchical model (not mega-trial)</div>
</div>
<div class="stat-box">
<div class="stat-value">Two-Stage</div>
<div class="stat-label">Analyze, then pool</div>
</div>
<div class="stat-box">
<div class="stat-value">80%+ target</div>
<div class="stat-label">Цель доступности данных</div>
</div>
</div>
<p class="footnote animate delay-4">
                  Совместная группа исследователей раннего рака молочной железы стала пионером IPD MA в 1980-х годах.
                </p>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Diagnostic Test Accuracy (DTA)</h2>
<p class="animate delay-1" style="font-style: italic;">Когда «вмешательство» — это испытание</p>
<div class="card animate delay-2">
<p class="card-text">
                    DTA meta-analysis synthesizes <strong>sensitivity</strong> (истинно положительный показатель) и
                    <strong>specificity</strong> (true negative rate)—two correlated outcomes requiring
                    bivariate models.
                  </p>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Bivariate/HSROC Model</h4>
<p>Учитывает корреляцию между чувствительностью и специфичностью.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>SROC Curve</h4>
<p>Сводная кривая ROC с достоверностью 95 % и прогнозируемыми областями</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>QUADAS-2</h4>
<p>Quality Assessment of Diagnostic Accuracy Studies</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Выбор правильного метода</h2>
<table class="results-table animate delay-1">
<thead>
<tr><th>Question</th><th>Method</th></tr>
</thead>
<tbody>
<tr><td>Does A beat B?</td><td><strong>Pairwise MA</strong></td></tr>
<tr><td>Which of many treatments is best?</td><td><strong>Network MA (NMA)</strong></td></tr>
<tr><td>Какова оптимальная доза?</td><td><strong>Dose-Response MA</strong></td></tr>
<tr><td>Who benefits most? (subgroups)</td><td><strong>IPD MA</strong></td></tr>
<tr><td>Насколько точен этот тест?</td><td><strong>DTA MA</strong></td></tr>
<tr><td>Как эффект развивается с течением времени?</td><td><strong>Survival/Time-to-Event MA</strong></td></tr>
</tbody>
</table>
<p class="footnote animate delay-2">Метод должен соответствовать вопросу. Никогда не задавайте вопрос неправильным методом.</p>
</div>
</div>
 ИСТОРИЯ: Стероиды в саге о сепсисе 
<div class="slide dark" data-index="9b">
<div class="story-box animate">
<p class="story-opener">Three large trials. Three different answers. What do you believe?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
<span class="data-highlight">CORTICUS (2008):</span> 499 patients. Hydrocortisone in septic shock. <span class="data-highlight">No mortality benefit</span>.
                    <span class="data-highlight">ADRENAL (2018):</span> 3,658 patients. Hydrocortisone. <span class="data-highlight">No mortality benefit</span>.
                    <span class="data-highlight">APROCCHSS (2018):</span> 1,241 patients. Hydrocortisone + fludrocortisone. <span class="data-highlight">Mortality reduced</span> (43% vs 49.1%, p=0.03).
                    Same class of intervention. Different protocols. Different results.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Задача автора рекомендаций</div>
<div class="decision-scenario">
                    Вы пишете рекомендации по сепсису. Три крупных исследования не пришли к единому мнению. Как вы рекомендуете?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Simple Average</div>
<div class="path-choice">Pool all three trials. Overall effect uncertain. Conclude "evidence unclear."</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Guidelines say steroids are optional. No strong recommendation.</div>
<div class="path-outcome">OUTCOME: Clinicians left without clear guidance</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Investigate Heterogeneity</div>
<div class="path-choice">Analyze why APROCCHSS differed (fludrocortisone, longer duration, different population)</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Определите, чем эффективный протокол отличается от неэффективного.</div>
<div class="path-outcome">OUTCOME: Recommend the specific effective protocol</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Противоречивые испытания не являются неудачами. Это карты того, где лечение работает, а где нет. Различия между исследованиями — дозы, продолжительность, сопутствующие вмешательства, популяция — являются ключом к пониманию.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Module 12 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q12-1">
<h4>1. В чем ключевое преимущество сетевого метаанализа перед парным?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 0, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>A.</span> Не требует извлечения данных
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 1, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>B.</span> It compares treatments not directly tested against each other
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 2, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>C.</span> Это устраняет необходимость в оценке риска предвзятости.
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 3, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>D.</span> It produces better forest plots
                      </div>
</div>
<div id="q12-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q12-2" style="margin-top: 1.5rem;">
<h4>2. Why does DTA meta-analysis require bivariate models?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 0, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>A.</span> To handle more than two studies
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 1, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>B.</span> Чтобы скорректировать предвзятость публикации
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 2, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>C.</span> Чувствительность и специфичность коррелируют
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 3, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>D.</span> To generate forest plots
                      </div>
</div>
<div id="q12-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q12-3" style="margin-top: 1.5rem;">
<h4>3. What does the "consistency" assumption in NMA require?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 0, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>A.</span> All studies must be high quality
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 1, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>B.</span> Прямые и косвенные доказательства должны согласовываться
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 2, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>C.</span> Sample sizes must be similar
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 3, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>D.</span> No missing studies
                      </div>
</div>
<div id="q12-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Экосистема курса</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Этот курс охватывает весь рабочий процесс систематического обзора. Для более глубокого погружения изучите сопутствующие курсы:
                </p>
<div class="animate delay-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; max-width: 700px; font-size: 0.85rem;">
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>DTA Course</strong><br/>Bivariate/HSROC, SROC curves, QUADAS-2</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>Risk of Bias Mastery</strong><br/>RoB 2, ROBINS-I/E, domain-level assessment</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>GRADE Certainty</strong><br/>Full SoF tables, GRADE-CERQual</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>IPD Meta-Analysis</strong><br/>One-stage/two-stage, mixed-effects models</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>Publication Bias Detective</strong><br/>Copas, PET-PEESE, p-curve, selection models</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>Umbrella Reviews</strong><br/>AMSTAR 2, ROBIS, overlap correction</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>Prognostic Reviews</strong><br/>CHARMS, PROBAST, c-statistic pooling</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>Living Reviews + Rapid Reviews</strong><br/>TSA, update triggers, abbreviated methods</div>
</div>
</div>
</div>
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 12 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «Метод должен соответствовать вопросу. Продвинутые методы отвечают на сложные вопросы, но основы никогда не меняются».
                </p>
<p class="animate delay-3" style="font-size: 1rem; margin-top: 1.5rem; opacity: 0.8;">
                  Вы освоили основной рабочий процесс. Следующие десять модулей исследуют новые горизонты: байесовский вывод, сетевой метаанализ, индивидуальные данные пациентов, моделирование зависимости «доза-реакция», надежность и хрупкость, справедливость, синтез с помощью искусственного интеллекта, качественные доказательства, многомерные методы и воспроизводимость.
                </p>
</div>
</div>
<div class="slide black" data-index="12">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 13: Байесовский поворот</p>
</div>
</div>
 ========================================================= МОДУЛЬ 13: БАЙЕСОВСКИЙ ПОВОРОТ (испытание платформы STAMPEDE) ========================================================= 
<div class="module-slides" data-module="13">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 13: Байесовский поворот</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 13: Байесовский поворот</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Объясните разницу между частотным и байесовским выводами.</li>
<li>Interpret prior distributions, likelihoods, and posterior distributions</li>
<li>Distinguish credible intervals from confidence intervals</li>
<li>Understand when Bayesian meta-analysis offers advantages</li>
<li>Recognize how prior choice affects conclusions</li>
</ul>
</div>
</div>
</div>
 Начало истории: STAMPEDE 
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">In 2005, a trial began</p>
<p class="title gold animate delay-1 text-center">that would never truly end.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                В исследовании STAMPEDE по лечению рака простаты использовалась многоэтапная платформа (MAMS). Оружие могло быть добавлено или сброшено по мере накопления доказательств. Хотя статистика была частой, адаптивная философия воплощала байесовский дух: обновление решений по мере накопления данных.
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Частотное мировоззрение</h2>
<div class="card animate delay-1">
<p class="card-text">
                    In frequentist statistics, probability means <strong>long-run frequency</strong>. 95% ДИ НЕ означает «вероятность 95%, что истинный эффект находится внутри». Это значит: если бы мы повторяли исследование бесконечно, 95% интервалов содержали бы истину.
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">p-value</div>
<div class="stat-label">P(данные | H₀), а не P(H₀ | данные)</div>
</div>
<div class="stat-box">
<div class="stat-value">95% CI</div>
<div class="stat-label">Покрытие собственности, а не убеждений</div>
</div>
<div class="stat-box">
<div class="stat-value">Fixed</div>
<div class="stat-label">Истинный параметр фиксирован</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Байесовское мировоззрение</h2>
<div class="card animate delay-1">
<p class="card-text">
                    In Bayesian statistics, probability represents <strong>degree of belief</strong>.
                    We start with a <strong>prior</strong> (во что мы верим до данных), обновить с помощью
                    <strong>likelihood</strong> (о чем нам говорят данные) и получить <strong>posterior</strong> (updated belief).
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Prior × Likelihood = Posterior</h4>
<p>Теорема Байеса: P(θ|данные) ∝ P(данные|θ) × P(θ)</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Credible Intervals</h4>
<p>95%-ный доверительный интервал является вероятностно интерпретируемым, зависящим от указанной модели и предшествующего уровня.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="5" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Choosing Priors</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Non-informative (Vague)</h4>
<p>Нормальный (0, 10000) или равномерный. Позволяет данным доминировать. Имитирует результаты часто встречающихся пользователей.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Weakly Informative</h4>
<p>Normal(0, 1) for log-OR. Regularizes extreme estimates while remaining flexible.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Informative</h4>
<p>Based on previous evidence. Powerful but controversial. Must be pre-specified.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Half-Cauchy for τ</h4>
<p>Recommended for heterogeneity. Half-Cauchy(0, 0.5) allows large τ but concentrates near zero.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">MCMC Sampling</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Most Bayesian models cannot be solved analytically. We use
                    <strong>Markov Chain Monte Carlo</strong> (MCMC), чтобы взять образцы сзади. Инструменты: JAGS, Stan, brms (R), PyMC (Python).
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">Chains</div>
<div class="stat-label">Multiple independent chains (typically 4)</div>
</div>
<div class="stat-box">
<div class="stat-value">R̂</div>
<div class="stat-label">Convergence: R̂ &lt; 1.01 (strict; older texts use &lt; 1.1)</div>
</div>
<div class="stat-box">
<div class="stat-value">ESS</div>
<div class="stat-label">Bulk-ESS &gt; 400 за средства; Tail-ESS &gt; 400 для CI</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Bayesian Model Averaging</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Instead of choosing between fixed-effect and random-effects models,
                    <strong>Bayesian model averaging</strong> (BMA) взвешивает каждую модель по ее апостериорной вероятности. Это объясняет неопределенность модели в окончательной оценке.
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">BF</div>
<div class="lesson-content">
<h4>Bayes Factors</h4>
<p>BF₁₀ &gt; 10 = убедительное доказательство H₁. BF₁₀ &lt; 1/10 = убедительное доказательство H₀.</p>
</div>
</div>
</div>
</div>
 Заполнитель интерактивного инструмента 
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Interactive: Posterior Visualizer</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Отрегулируйте предыдущую силу, чтобы увидеть, как она влияет на заднюю часть. Посмотрите, как новые данные превосходят предыдущие.
                </p>
<div class="animate delay-2" id="bayesianPosteriorTool" style="min-height: 300px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
<div style="margin-bottom: 1rem;">
<label style="font-weight:600;">Prior Strength: <span id="priorStrengthLabel">Vague</span></label><br/>
<input id="priorStrengthSlider" max="100" min="0" oninput="updateBayesianPosterior()" style="width:100%;" type="range" value="10"/>
</div>
<div style="margin-bottom: 1rem;">
<label style="font-weight:600;">Prior Mean (log-OR): <span id="priorMeanLabel">0.00</span></label><br/>
<input id="priorMeanSlider" max="200" min="-200" oninput="updateBayesianPosterior()" style="width:100%;" type="range" value="0"/>
</div>
<div id="bayesianPlotArea" style="width:100%; min-height:220px;"></div>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="9">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">История STAMPEDE</h3>
<p style="margin-bottom: 0.75rem;">
                    STAMPEDE была запущена в 2005 году с участием пяти исследовательских групп, сравнивающих методы лечения распространенного рака простаты. К 2016 году к нему был добавлен абиратерон, что позволило снизить смертность на 37% (ОР 0,63, 95% ДИ 0,52–0,76).
                  </p>
<p style="margin-bottom: 0.75rem;">
                    Дизайн платформы воплощает в себе байесовское адаптивное мышление: промежуточные анализы определяют выбор препаратов, новые препараты могут вводиться по мере появления методов лечения, а бесполезные препараты рано прекращаются, что спасает пациентов от неэффективных методов лечения.
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    В исследование STAMPEDE вошли более 10 000 пациентов из более чем 100 центров и фундаментально изменились методы лечения рака простаты. Байесовский подход позволяет накапливать доказательства и принимать решения в режиме реального времени.
                  </p>
</div>
</div>
</div>
<!-- Decision tree -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Decision Tree: When to Go Bayesian?</h2>
<div class="decision-tree animate delay-1">
<div class="decision-tree-header">Frequentist vs Bayesian Meta-Analysis</div>
<div class="decision-scenario">
                    Выбирайте байесовский метод, когда: (1) у вас есть достоверная априорная информация, (2) вам нужны вероятностные утверждения («эффект вероятности 80% &gt; 0»), (3) мало исследований делают частотные свойства ненадежными или (4) вы хотите провести усреднение модели.
                  </div>
<div class="decision-options">
<div class="decision-option correct">
<div class="decision-label">Bayesian with weakly informative prior</div>
<div class="decision-detail">A common practical default. Regularizes extreme estimates without forcing strong prior conclusions.</div>
</div>
<div class="decision-option">
<div class="decision-label">Байесовский с информативным априором</div>
<div class="decision-detail">Только тогда, когда предварительные доказательства убедительны и заранее определены. Необходимо провести анализ чувствительности.</div>
</div>
<div class="decision-option">
<div class="decision-label">Stay frequentist</div>
<div class="decision-detail">Simpler, well-understood. Preferred when k is large and no prior information.</div>
</div>
</div>
</div>
</div>
</div>
<!-- Callback -->
<div class="slide dark" data-index="11">
<div class="content" style="text-align: center;">
<p class="animate" style="font-size: 1.1rem; opacity: 0.7;">Remember Module 1?</p>
<p class="title gold animate delay-1">CAST Through a Bayesian Lens</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="max-width: 600px; font-size: 1.05rem;">
                  Если бы байесовский анализ CAST использовал информативную априорную информацию из фундаментальной науки (антиаритмические средства подавляют ЖЭ), апостериорная часть все равно сильно сместилась бы в сторону вреда. При наличии достаточного количества данных даже сильный априор уступает вероятности. Урок: байесовские методы не защищают от плохих априорных значений, но они делают предположения. <em>transparent</em>.
                </p>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Module 13 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> What does a 95% Bayesian credible interval mean?</p>
<div class="quiz-options" id="m13-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 0, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
<span>A.</span> 95% of repeated experiments would produce intervals containing the true value
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 1, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
<span>B.</span> С вероятностью 95% истинный параметр находится в этом интервале.
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 2, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
<span>C.</span> The interval has a 95% chance of being correct
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 3, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
<span>D.</span> 95% будущих данных попадут в этот диапазон.
                    </div>
</div>
<div id="m13-q1-feedback" style="display: none;"></div>
</div>
<div class="quiz-box animate delay-2">
<p class="quiz-question"><strong>Q2.</strong> Каков рекомендуемый априорный уровень гетерогенности между исследованиями (τ)?</p>
<div class="quiz-options" id="m13-q2">
<div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 0, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
<span>A.</span> Uniform(0, 100)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 1, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
<span>B.</span> Normal(0, 1)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 2, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
<span>C.</span> Half-Cauchy(0, 0.5)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 3, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
<span>D.</span> Fixed at 0.5
                    </div>
</div>
<div id="m13-q2-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing ceremony -->
<div class="slide dark" data-index="13">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 13 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «Байесовский поворот — это не математика. Речь идет о честности — сделать наши предположения видимыми».
                </p>
</div>
</div>
<!-- Transition -->
<div class="slide black" data-index="14">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 14: Сеть</p>
</div>
</div>
 ========================================================== МОДУЛЬ 14: СЕТЬ (Чиприани 2018 — 21 антидепрессант) ========================================================= 
<div class="module-slides" data-module="14">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Методы защищают пациентов от нашего доверия.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 14: Сеть</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 14: Сеть</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Explain why pairwise comparisons are insufficient when many treatments exist</li>
<li>Interpret network geometry (nodes, edges, thickness)</li>
<li>Понимать транзитивность, последовательность и роль косвенных доказательств.</li>
<li>Interpret SUCRA rankings and league tables</li>
<li>Recognize when NMA assumptions are violated</li>
</ul>
</div>
</div>
</div>
<!-- Story: Cipriani 2018 -->
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">A clinician faces a patient</p>
<p class="title gold animate delay-1 text-center">с депрессией. Какой препарат?</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                Существует 21 обычно назначаемый антидепрессант. В большинстве параллельных исследований сравниваются только 2 или 3. Cipriani et al. (2018, Lancet) объединили в единую сеть 522 исследования и 116 477 пациентов.
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Логика сетевого метаанализа</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Direct Evidence</h4>
<p>Trials directly comparing A vs B give the most reliable estimate.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Indirect Evidence</h4>
<p>Если существуют A vs C и B vs C, мы можем сделать вывод A vs B. Это «транзитивное» предположение.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Mixed Evidence</h4>
<p>NMA combines both, weighted by precision, to rank all treatments simultaneously.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Interactive: Network Graph</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Каждый узел – это лечение. Толщина края представляет собой количество исследований, сравнивающих эти два метода лечения.
                </p>
<div class="animate delay-2" id="nmaNetworkTool" style="min-height: 350px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
<div id="nmaNetworkArea" style="width:100%; min-height:320px;"></div>
</div>
</div>
</div>
<div class="slide light" data-index="5" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Transitivity &amp; Consistency</h2>
<div class="card animate delay-1">
<p class="card-text">
<strong>Transitivity</strong>: Косвенная оценка (через общий компаратор) должна приближаться к прямой оценке. Для этого необходимо, чтобы модификаторы эффектов были одинаково распределены по сравнениям.
                  </p>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text">
<strong>Consistency</strong>: Статистический тест, сравнивающий прямые и косвенные доказательства. Глобальные (взаимодействие схемы лечения) и локальные (разделение узлов) тесты помогают выявить петли несоответствия.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">SUCRA &amp; P-scores</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">SUCRA</div>
<div class="stat-label">Поверхность под накопительным рейтингом. Более высокие значения указывают на лучшую вероятность ранжирования, а не на гарантированное превосходство.</div>
</div>
<div class="stat-box">
<div class="stat-value">P-score</div>
<div class="stat-label">Частотный аналог ранжирования вероятностных сводок. Интерпретируйте с учетом величины эффекта и неопределенности.</div>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text">
<strong>Caution:</strong> Ranking is seductive but misleading when differences between treatments are small
                    or uncertain. Always report credible/confidence intervals alongside ranks.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="7" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Component NMA</h2>
<div class="card animate delay-1">
<p class="card-text">
                    When interventions are complex (e.g., behavioral + pharmacological), <strong>component NMA</strong>
                    decomposes multi-component treatments to estimate the individual contribution of each component.
                    Uses additive models: effect(A+B) = effect(A) + effect(B) + interaction.
                  </p>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Сеть Cipriani</h3>
<p style="margin-bottom: 0.75rem;">
                    Анализ журнала Lancet 2018 года показал, что все 21 антидепрессант были более эффективными, чем плацебо. Амитриптилин, миртазапин и венлафаксин заняли первое место по эффективности. Агомелатин, флуоксетин и эсциталопрам заняли самые высокие места по приемлемости (наименьшее количество выбывших из исследования).
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    Ни один препарат не «выиграл» по всем исходам. Сеть выявила компромиссы, невидимые при парном анализе.
                  </p>
</div>
</div>
</div>
<!-- Decision tree -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Decision Tree: Is NMA Appropriate?</h2>
<div class="decision-tree animate delay-1">
<div class="decision-tree-header">NMA Feasibility Check</div>
<div class="decision-scenario">
                    У вас есть 15 РКИ, в которых сравниваются 6 различных статинов. Некоторые пары имеют прямые доказательства, другие — нет.
                  </div>
<div class="decision-options">
<div class="decision-option correct">
<div class="decision-label">Check transitivity, then fit NMA</div>
<div class="decision-detail">Убедитесь, что популяции пациентов и дизайн исследований достаточно схожи при сравнении.</div>
</div>
<div class="decision-option">
<div class="decision-label">Игнорируйте косвенные доказательства</div>
<div class="decision-detail">Теряет статистическую достоверность и оставляет пробелы в доказательной базе.</div>
</div>
<div class="decision-option">
<div class="decision-label">Pool all into one pairwise comparison</div>
<div class="decision-detail">Нарушает структуру доказательства. Статины — это разные препараты.</div>
</div>
</div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Module 14 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> Какое предположение должно соблюдаться, чтобы косвенные доказательства были действительными в NMA?</p>
<div class="quiz-options" id="m14-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 0, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I², not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
<span>A.</span> Transitivity — effect modifiers are balanced across comparisons
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 1, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I², not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
<span>B.</span> Homogeneity — I² must be below 25%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 2, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I², not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
<span>C.</span> All studies must have similar sample sizes
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 3, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I², not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
<span>D.</span> Все исследования должны быть двойными слепыми
                    </div>
</div>
<div id="m14-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="11">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 14 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «Сеть видит то, чего не могут парные сравнения: всю картину выбора лечения».
                </p>
</div>
</div>
<div class="slide black" data-index="12">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 15: Индивидуальность</p>
</div>
</div>
 ======================================================== МОДУЛЬ 15: ИНДИВИДУАЛЬНОСТЬ (EBTCCG — метаанализ IPD) ======================================================== 
<div class="module-slides" data-module="15">
<div class="slide dark active" data-index="0">
<p class="refrain animate">What was hidden in plain sight?</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 15: Индивидуальность</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 15: Индивидуальность</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Explain why aggregate data can mask treatment–covariate interactions</li>
<li>Distinguish one-stage from two-stage IPD models</li>
<li>Recognize ecological bias in aggregate meta-analysis</li>
<li>Understand the practical challenges of IPD collection</li>
<li>Interpret treatment–covariate interaction plots</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">For decades, breast cancer trials</p>
<p class="title gold animate delay-1 text-center">опубликованные сводки. Не пациенты.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                Совместная группа исследователей раннего рака молочной железы (EBTCTCG) собрала индивидуальные записи более чем 100 000 женщин из сотен исследований. Их мета-анализ IPD показал, что польза тамоксифена во многом зависит от статуса рецепторов эстрогена – чего-то невидимого в совокупных данных.
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Что скрывают сводки</h2>
<p class="direct-address animate delay-1">В каждом опубликованном исследовании тамоксифена сообщалось об общем результате. Согласно результатам сотен исследований, тамоксифен показал скромную пользу. Но «скромная польза» была средним показателем, за которым скрывалась глубокая истина.</p>
<div class="investigation-box animate delay-2">
<h4>Скрытое разделение на подгруппы</h4>
<div class="stats-grid" style="margin-top: 1rem;">
<div class="stat-box" style="border-left: 4px solid #22c55e;">
<div class="stat-value" style="color: #22c55e;">RR 0.59</div>
<div class="stat-label">ER-positive subgroup: 41% reduction in recurrence</div>
</div>
<div class="stat-box" style="border-left: 4px solid #ef4444;">
<div class="stat-value" style="color: #ef4444;">RR 0.97</div>
<div class="stat-label">ER-negative subgroup: essentially no benefit at all</div>
</div>
</div>
<p style="margin-top: 1rem; font-style: italic;">Общий совокупный эффект — смешение реагирующих и неотзывчивых пациентов — был статистической фикцией. «Скромное» среднее значение, которое преувеличивает пользу для одной группы и подразумевает выгоду там, где ее не было для другой.</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Агрегированные и индивидуальные данные пациентов</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">AD</div>
<div class="stat-label">Aggregate: published effect + CI only</div>
</div>
<div class="stat-box">
<div class="stat-value">IPD</div>
<div class="stat-label">Individual: raw patient-level records</div>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text">
                    IPD позволяет: (1) последовательно определять исходы, (2) анализ подгрупп по характеристикам пациентов, (3) моделирование времени до события, (4) проверку экологической предвзятости. Это <strong>gold standard</strong>
                    for exploring treatment effect modification.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="5" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">One-Stage vs Two-Stage IPD</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Two-Stage</h4>
<p>Analyze each study separately, then combine estimates (like standard MA). Simple but loses information.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>One-Stage</h4>
<p>Подбор одной модели со смешанными эффектами ко всем данным пациента одновременно. Более мощный для взаимодействий и редких событий.</p>
</div>
</div>
<div class="card animate delay-3" style="margin-top: 1rem;">
<p class="card-text">
<strong>Key:</strong> Оба должны учитывать кластеризацию исследований. Никогда не объединяйте IPD, как если бы они были получены из одного мегаиспытания — это вносит путаницу (парадокс Симпсона).
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="6" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Ecological Bias</h2>
<div class="card animate delay-1">
<p class="card-text">
                    A meta-regression using study-level mean age might show older patients benefit more.
                    But this could be <strong>ecological bias</strong>— связь на уровне исследования не отражает истину на уровне пациента. Только IPD может разделять <em>within-study</em> from <em>between-study</em> effects.
                  </p>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<div class="content" style="max-width: 700px;">
<h2 class="title cream animate text-center">Когда целое зависит от своих частей</h2>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2" style="font-size: 1.05rem; text-align: center; max-width: 650px; margin-top: 1rem;">
                  Парадокс Симпсона: тенденция, которая появляется в совокупных данных, меняется на противоположную, когда данные группируются по мешающей переменной.
                </p>
<div class="investigation-box animate delay-3" style="margin-top: 1.5rem;">
<h4>Парадокс в Практикуйте</h4>
<p style="margin-top: 0.75rem;">A mega-trial analysis found Treatment X beneficial <em>overall</em>. But <strong>в каждом исследовании</strong>, это было вредно. Как? Различия в исходном риске между исследованиями создали иллюзию — более больные группы населения получали больше лечения, что привело к завышению совокупной пользы.</p>
<p style="margin-top: 0.75rem;">Cates (2002, <em>BMJ</em>) показало, что объединение результатов исследований без учета кластеризации может обратить вспять очевидное направление эффекта.</p>
<p style="margin-top: 0.75rem; font-weight: 600; color: var(--gold);">Вот почему одноэтапные модели ИПЗ включают исследование в качестве переменной кластеризации — чтобы предотвратить маскировку результатов между исследованиями под эффект лечения.</p>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Наследие EBCTCG</h3>
<p style="margin-bottom: 0.75rem;">
                    Мета-анализ IPD EBCTCG определил лечение рака молочной железы на 40 лет. Их анализ 2005 года по сравнению с отсутствием лечения тамоксифеном показал явную пользу при ER-положительных опухолях (ОР 0,59), но не приносил пользы при ER-негативных опухолях (ОР 0,97).
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    Без ИПЗ общий совокупный эффект был бы объединен в обеих группах, уменьшая пользу и потенциально лишая ER-позитивных пациентов величины их выигрыша.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Decision Tree: When Is IPD Worth Pursuing?</h2>
<div class="decision-tree animate delay-1">
<div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    Do you suspect treatment–covariate interactions?
                  </div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
<div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
<strong>Yes →</strong>
<p style="margin-top: 0.5rem; font-size: 0.95rem;">Можете ли вы получить ИПЗ в &gt;80% исследований?</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.75rem;">
<div style="background: rgba(34,197,94,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: #22c55e;">Yes →</strong> One-stage IPD meta-analysis with interaction terms
                        </div>
<div style="background: rgba(212,175,55,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: var(--gold);">No →</strong> Двухэтапный: запрос доступного IPD + агрегат для остального
                        </div>
</div>
</div>
<div style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
<strong>No →</strong>
<p style="margin-top: 0.5rem; font-size: 0.95rem;">Is ecological bias a concern?</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.75rem;">
<div style="background: rgba(212,175,55,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: var(--gold);">Yes →</strong> IPD preferred even without interactions
                        </div>
<div style="background: rgba(239,68,68,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: #ef4444;">No →</strong> Aggregate data meta-analysis may suffice
                        </div>
</div>
</div>
</div>
<p class="footnote animate delay-2" style="margin-top: 1rem; font-size: 0.85rem; font-style: italic;">EBCTCG собрал данные сотен исследований за 40 лет. Большинство метаанализов ИПЗ включают 5–20 исследований. Решение зависит от вопроса, а не от амбиций.</p>
</div>
</div>
</div>
<div class="slide light" data-index="10" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Узор повторяется</h2>
<p class="direct-address animate delay-1">Помните Модуль 3? ЗГТ оказалась полезной в обсервационных исследованиях, но вредной в РКИ. Произошло то же самое совокупное маскирование: общая польза скрывала вред подгруппы.</p>
<div class="card animate delay-2">
<p class="card-text">
                    Анализ IPD Инициативы по здоровью женщин позже показал, что <strong>timing mattered</strong>— у женщин, начавших ЗГТ в течение 10 лет после менопаузы, были другие результаты, чем у женщин, начавших позже. «Гипотеза времени» была невидима в опубликованных сводных сводках.
                  </p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; border-left: 4px solid var(--gold);">
<p class="card-text">
<strong>Урок повторяется:</strong> совокупные данные могут скрыть важные взаимодействия между лечением и ковариантами. Будь то статус ER при раке молочной железы или время начала ЗГТ, данные на индивидуальном уровне показывают то, что скрывают сводные данные.
                  </p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 15 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> В чем основное преимущество IPD перед метаанализом агрегированных данных?</p>
<div class="quiz-options" id="m15-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 0, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
<span>A.</span> Он всегда включает в себя дополнительные исследования
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 1, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
<span>B.</span> Это дешевле и быстрее
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 2, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
<span>C.</span> It can explore treatment–covariate interactions without ecological bias
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 3, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
<span>D.</span> Это устраняет необходимость в моделях случайных эффектов.
                    </div>
</div>
<div id="m15-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 15 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «За каждой объединенной оценкой стоят люди, чьи истории не может рассказать совокупность».
                </p>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">Гетерогенность — это сообщение, а не шум.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 16: Доза</p>
</div>
</div>
 ========================================================= МОДУЛЬ 16: ДОЗА (J-кривая алкоголя / Stockwell 2016) ========================================================= 
<div class="module-slides" data-module="16">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Гетерогенность — это сообщение, а не шум.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 16: Доза</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 16: Доза</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Explain why simple pairwise comparisons miss dose–response relationships</li>
<li>Distinguish linear, quadratic, and spline dose–response models</li>
<li>Interpret restricted cubic splines with knots</li>
<li>Identify threshold effects and J/U-shaped curves</li>
<li>Understand model comparison with AIC/BIC</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">На протяжении десятилетий умеренное употребление алкоголя</p>
<p class="title gold animate delay-1 text-center">казалось, защищал сердце.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                «J-образная кривая» показала, что у непьющих смертность от сердечно-сосудистых заболеваний выше, чем у умеренно пьющих. Но Стоквелл и др. (2016) продемонстрировали, что J-кривая является результатом ошибочной классификации бывших алкоголиков (бросивших курить из-за болезни) как «трезвенников».
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">A Scientific Consensus Built on Sand</h2>
<p class="direct-address animate delay-1">К 2010 году более 100 обсервационных исследований подтвердили J-кривую. Медицинские учебники учили этому. Об этом рассказали кардиологи. Лоббисты винодельческой отрасли финансировали конференции, посвященные этому вопросу.</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">100+</div>
<div class="stat-label">Наблюдательные исследования, подтверждающие J-кривую</div>
</div>
<div class="stat-box">
<div class="stat-value">15–25%</div>
<div class="stat-label">Lower cardiovascular mortality in moderate drinkers vs abstainers</div>
</div>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; border-left: 4px solid var(--red);">
<p class="card-text">
                    Доказательства казались неопровержимыми. Но что, если группа сравнения — «трезвенники» — была заражена?
                  </p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<div class="content" style="max-width: 700px;">
<h2 class="title cream animate text-center">Больной, бросивший курить</h2>
<p class="title gold animate delay-1 text-center" style="font-size: 1.2rem;">A Hidden Confounder</p>
<div class="gold-line animate delay-2"></div>
<div class="investigation-box animate delay-3" style="margin-top: 1.5rem;">
<h4>The Problem</h4>
<p style="margin-top: 0.75rem;">People who stop drinking often do so <strong>because they are already ill</strong>— заболевания печени, лекарственное взаимодействие, диагностика рака. В большинстве исследований эти «бывшие пьющие» были классифицированы как «трезвенники».</p>
<p style="margin-top: 0.75rem;"><strong>The Effect:</strong> The reference group (abstainers) appeared <em>less healthy</em>— не потому, что воздержание было вредно, а потому, что к нему присоединились больные люди.</p>
</div>
<div class="card animate delay-4" style="margin-top: 1rem; background: rgba(212,175,55,0.15); border-left: 4px solid var(--gold);">
<p class="card-text" style="color: var(--cream);">
                    When Stockwell et al. (2016, <em>J Stud Alcohol Drugs</em>) removed former drinkers and applied appropriate study-quality corrections: <strong>J-кривая исчезла</strong>. Защитный эффект был фантомным.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Dose–Response Meta-Analysis</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Standard meta-analysis asks: "Does treatment X work?" Dose–response meta-analysis asks:
                    "<strong>At what dose</strong> действует ли лечение Х лучше всего?» Он моделирует взаимосвязь между уровнем дозы и результатом в ходе нескольких исследований.
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">Linear</div>
<div class="stat-label">Simplest: log(RR) = β × dose</div>
</div>
<div class="stat-box">
<div class="stat-value">Spline</div>
<div class="stat-label">Flexible: piecewise polynomials with knots</div>
</div>
<div class="stat-box">
<div class="stat-value">Fractional</div>
<div class="stat-label">Polynomial: dose^p1 + dose^p2</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Restricted Cubic Splines</h2>
<div class="card animate delay-1">
<p class="card-text">
                    RCS place <strong>knots</strong> в заранее заданных точках дозы и подгонять гладкие полиномы между ними. Обычно 3–5 узлов в квантилях распределения дозы. Линейные заграничные узлы. Тесты на нелинейность сравнивают сплайновую модель с более простой линейной моделью.
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">AIC</div>
<div class="lesson-content">
<h4>Model Comparison</h4>
<p>AIC/BIC сравнивает линейную и сплайновую посадку. Ниже = лучше. Также проверьте отклонение от линейности (значение p для сплайновых условий).</p>
</div>
</div>
</div>
</div>
<!-- Interactive tool -->
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">Interactive: Dose–Response Builder</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Сравните линейную, квадратичную и сплайновую аппроксимацию. Посмотрите, как меняется форма модели при различных предположениях.
                </p>
<div class="animate delay-2" id="doseResponseTool" style="min-height: 300px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
<div style="display:flex; gap:1rem; margin-bottom:1rem; flex-wrap:wrap;">
<button class="btn" id="doseBtn-linear" onclick="setDoseModel('linear')">Linear</button>
<button class="btn" id="doseBtn-quadratic" onclick="setDoseModel('quadratic')">Quadratic</button>
<button class="btn primary" id="doseBtn-spline" onclick="setDoseModel('spline')">Spline (3 knots)</button>
</div>
<div id="doseResponsePlotArea" style="width:100%; min-height:240px;"></div>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Разоблачение J-кривой алкоголя</h3>
<p style="margin-bottom: 0.75rem;">
                    Повторный анализ Стоквелла в 2016 году показал, что, когда бывших пьющих правильно исключили из референтной группы «трезвенников», защитный эффект умеренного употребления алкоголя исчез. J-кривая была обусловлена ​​предвзятостью в отношении тех, кто бросил курить по болезни.
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    Метаанализ «доза-реакция» выявил истину: форма кривой во многом зависит от того, как вы определяете «нулевую дозу». Неправильная ссылочная категория создала фантомную выгоду.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">When Curves Shape Policy</h2>
<p class="direct-address animate delay-1">The phantom J-curve influenced alcohol guidelines worldwide:</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #1a3a5c; color: white;">UK</div>
<div class="lesson-content">
<h4>NHS Guidance (until 2016)</h4>
<p>В официальном руководстве говорится: «Умеренное употребление алкоголя может защитить сердце». После поправки Стоквелла Великобритания пересмотрела лимиты до 14 единиц в неделю для <strong>all</strong> пьющие (ранее 21 у мужчин). Ни одна сумма не была объявлена ​​«безопасной».</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #3b4d8c; color: white;">US</div>
<div class="lesson-content">
<h4>Dietary Guidelines Advisory Committee</h4>
<p>Исследования J-кривой проводились в течение 2015 года. Комитет 2020 года рекомендовал снизить пределы до 1 напитка в день для мужчин, признавая предвзятость референтной группы.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #2d6a4f; color: white;">AU</div>
<div class="lesson-content">
<h4>Australian Guidelines</h4>
<p>Safe drinking limits were delayed by industry-funded J-curve research promoting “cardioprotective” moderate intake.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Decision Tree: Is Dose-Response Analysis Appropriate?</h2>
<div class="decision-tree animate delay-1">
<div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    Есть ли у вас ≥3 уровней воздействия (а не только воздействие или отсутствие воздействия)?
                  </div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
<div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
<strong>Yes →</strong>
<p style="margin-top: 0.5rem; font-size: 0.95rem;">Является ли эта связь вероятно нелинейной?</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.75rem;">
<div style="background: rgba(34,197,94,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: #22c55e;">Yes →</strong> Restricted cubic splines (3–5 knots). Compare AIC with linear model.
                        </div>
<div style="background: rgba(212,175,55,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: var(--gold);">No →</strong> Linear dose-response meta-regression may suffice
                        </div>
</div>
</div>
<div style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
<strong>No →</strong>
<p style="margin-top: 0.5rem; font-size: 0.95rem;">Standard pairwise meta-analysis (no dose-response possible with only two levels)</p>
</div>
</div>
<div style="background: rgba(197,48,48,0.15); padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid var(--red);">
<strong style="color: #f87171;">Warning:</strong> Всегда проверяйте: чистая ли ваша референтная категория? Урок J-кривой: загрязненная референтная группа создает фантомную нелинейность.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 16 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> What makes restricted cubic splines useful in dose–response meta-analysis?</p>
<div class="quiz-options" id="m16-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 0, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
<span>A.</span> They always produce a straight line
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 1, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
<span>B.</span> They flexibly capture non-linear dose–response curves
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 2, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
<span>C.</span> Они сокращают количество необходимых исследований
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 3, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
<span>D.</span> They simplify the model to fewer parameters
                    </div>
</div>
<div id="m16-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 16 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «Доза создает яд. А форма кривой показывает, настоящий ли яд».
                </p>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">Отсутствие доказательств не является доказательством отсутствия.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 17: Хрупкость</p>
</div>
</div>
 ========================================================== МОДУЛЬ 17: ХРУПКОСТЬ (Осельтамивир / Джефферсон 2014) ========================================================= 
<div class="module-slides" data-module="17">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Отсутствие доказательств не является доказательством отсутствия.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 17: Хрупкость</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 17: Хрупкость</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Рассчитать и интерпретировать индекс хрупкости</li>
<li>Используйте графики GOSH для выявления влиятельных исследований и эффектов подмножества.</li>
<li>Interpret contour-enhanced funnel plots</li>
<li>Применить модели выбора Copas и PET-PEESE для предотвращения предвзятости публикаций.</li>
<li>Understand how sensitivity analyses strengthen meta-analytic conclusions</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">Governments stockpiled billions</p>
<p class="title gold animate delay-1 text-center">на основе доказательств, которые они не могли видеть.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                После H1N1 правительства потратили миллиарды на запасы осельтамивира (Тамифлю). Команда Кокрейна (Джефферсон и др., 2014) годами боролась за доступ к неопубликованным данным. Когда они наконец это сделали, доказательства предотвращения осложнений испарились.
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Индекс хрупкости</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Индекс хрупкости спрашивает: <strong>"How many patients would need to change outcome
                    to flip a statistically significant result to non-significant?"</strong>
                    Он итеративно добавляет события (преобразует не-события в события) в группу с меньшим количеством событий до тех пор, пока p &gt; 0,05.
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">FI = 1</div>
<div class="stat-label">Extremely fragile. One patient flip changes conclusion.</div>
</div>
<div class="stat-box">
<div class="stat-value">FI &gt; 8</div>
<div class="stat-label">Reasonably robust. Less sensitive to individual outcomes.</div>
</div>
</div>
</div>
</div>
<!-- Interactive tools -->
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Interactive: Fragility Calculator</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Enter a 2×2 table to calculate the fragility index. Watch events shift until significance flips.
                </p>
<div class="animate delay-2" id="fragilityTool" style="min-height: 200px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
<div style="display:grid; grid-template-columns: auto 1fr 1fr; gap:0.5rem; max-width:350px; margin-bottom:1rem;">
<div></div>
<div style="font-weight:600; text-align:center;">Events</div>
<div style="font-weight:600; text-align:center;">Total N</div>
<div style="font-weight:600;">Treatment</div>
<input id="fi-eventsTx" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;" type="number" value="15"/>
<input id="fi-nTx" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;" type="number" value="100"/>
<div style="font-weight:600;">Control</div>
<input id="fi-eventsCtrl" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;" type="number" value="30"/>
<input id="fi-nCtrl" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;" type="number" value="100"/>
</div>
<button class="btn primary" onclick="calculateFragilityIndex()">Calculate Fragility Index</button>
<div id="fragilityResult" style="margin-top:1rem; padding:1rem; background:rgba(212,175,55,0.1); border-radius:6px; display:none;"></div>
</div>
</div>
</div>
<div class="slide light" data-index="5" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">GOSH Plots</h2>
<div class="card animate delay-1">
<p class="card-text">
<strong>Графический обзор неоднородности исследования</strong> (GOSH) адаптирует модели метаанализа ко всем возможным подмножествам исследований. Каждая точка отображает объединенный эффект в зависимости от I² для одного подмножества. Кластеры предполагают отдельные подгруппы; Облака-выбросы предполагают одно исследование, определяющее гетерогенность.
                  </p>
</div>
<p class="footnote animate delay-2">Для k исследований имеется 2<sup>k</sup>−1 subsets. For k &gt; 15, random sampling is used.</p>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Contour-Enhanced Funnel Plots</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Standard funnel plots show effect size vs standard error. <strong>Contour-enhanced</strong> версии добавляют заштрихованные области для p &lt;0,01, p &lt;0,05 и p &lt;0,10. Если отсутствующие исследования попадают в незначительные регионы, вероятна предвзятость публикации. Если они попадают в значительные регионы, асимметрию могут объяснить другие причины (например, качество исследования).
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="7" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Copas Selection &amp; PET-PEESE</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Copas Selection Model</h4>
<p>Моделирует вероятность публикации исследования в зависимости от его SE и размера эффекта. Совместно оценивается истинный эффект и механизм отбора.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>PET-PEESE</h4>
<p>Precision-Effect Test (PET): regress effects on SE. If intercept = 0, no true effect. PEESE uses SE² for better performance when a true effect exists.</p>
</div>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Сага об Осельтамивире</h3>
<p style="margin-bottom: 0.75rem;">
                    Оригинальный метаанализ, финансируемый компанией «Рош» (Kaiser 2003), показал, что осельтамивир снижает осложнения гриппа на 67%. Но 8 из 10 исследований так и не были опубликованы. После того, как Кокрейн получил отчеты о клинических исследованиях, польза от осложнений упала до незначительных 11%.
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    Хрупкость была не просто статистической, она была информационной. В самой доказательной базе отсутствовала большая часть данных.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Дерево решений: интерпретация результатов нестабильности</h2>
<div class="decision-tree animate delay-1">
<div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    Вы рассчитали индекс хрупкости. Что означает число?
                  </div>
<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.75rem;">
<div style="background: rgba(239,68,68,0.15); padding: 1rem; border-radius: 8px; border-top: 4px solid #ef4444;">
<strong style="color: #f87171; font-size: 1.1rem;">FI ≤ 3</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;"><strong>Highly fragile.</strong> Несколько различных событий изменили бы этот вывод. Интерпретируйте с особой осторожностью.</p>
</div>
<div style="background: rgba(212,175,55,0.15); padding: 1rem; border-radius: 8px; border-top: 4px solid var(--gold);">
<strong style="color: var(--gold); font-size: 1.1rem;">FI 4–8</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;"><strong>Moderately fragile.</strong> Чувствителен к небольшим возмущениям. Существуют ли неопубликованные исследования, которые могли бы изменить ситуацию?</p>
</div>
<div style="background: rgba(34,197,94,0.15); padding: 1rem; border-radius: 8px; border-top: 4px solid #22c55e;">
<strong style="color: #22c55e; font-size: 1.1rem;">FI &gt; 8</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;"><strong>Relatively robust.</strong> But remember: fragility is only one dimension. Publication bias can undermine even robust results.</p>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem; background: rgba(0,0,0,0.05);">
<p class="card-text" style="font-size: 0.9rem;">
                      Walsh et al. (2014, <em>J Clin Epidemiol</em>) обнаружили, что в 399 РКИ, опубликованных в ведущих журналах, средний индекс хрупкости составлял всего 8. Более 25% имели FI ≤ 3. Знаменательные исследования, влияющие на клиническую практику, часто висели на волоске статистики.
                    </p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="10" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Beyond the Index: Structural Fragility</h2>
<p class="direct-address animate delay-1">Раскрыта сага об осельтамивире <strong>three types of fragility</strong>— а Индекс хрупкости учитывает только первое.</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #ef4444;">1</div>
<div class="lesson-content">
<h4>Statistical Fragility (FI)</h4>
<p>Сколько событий меняют значение p? Именно это и измеряет Индекс хрупкости. Он количественно определяет чувствительность к результатам лечения отдельных пациентов.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: var(--gold); color: var(--navy);">2</div>
<div class="lesson-content">
<h4>Informational Fragility</h4>
<p>Какая часть доказательств скрыта? Восемь из десяти исследований осельтамивира компании «Рош» остались неопубликованными. Доказательная база была структурно неполной.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #3b82f6;">3</div>
<div class="lesson-content">
<h4>Analytical Fragility</h4>
<p>Сколько степеней свободы исследователя могло бы изменить вывод? Различные определения результатов, группы анализа или статистические методы.</p>
</div>
</div>
<div class="card animate delay-5" style="margin-top: 1rem; border-left: 4px solid var(--gold);">
<p class="card-text">
<strong>Обратный звонок к модулю 10 (пароксетин):</strong> Повторный анализ с другими определениями исходов полностью изменил этот вывод. Это была аналитическая хрупкость: FI никогда не рассчитывался, потому что сама конечная точка была спорной. Полная оценка надежности исследует все три измерения.
                  </p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 17 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> В исследовании приняли участие 200 пациентов в каждой группе, 12 событий в группе лечения и 25 в группе контроля (p=0,03). Индекс хрупкости равен 3. Что это значит?</p>
<div class="quiz-options" id="m17-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 0, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
<span>A.</span> Размер эффекта равен ровно 3
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 1, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
<span>B.</span> Changing just 3 patient outcomes would flip the result to non-significant
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 2, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
<span>C.</span> Результат очень надежен благодаря 3 подтверждающим исследованиям.
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 3, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
<span>D.</span> Для исследования необходимо минимум 3 пациента.
                    </div>
</div>
<div id="m17-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 17 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «Число, которое выдержит любую попытку его сломать, — это число, которому стоит доверять».
                </p>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 18: Капитал</p>
</div>
</div>
 ==================================================================== МОДУЛЬ 18: АКЦИОНЕР (ИСКЛЮЧЕНИЯ СПРИНТ / ПРОГРЕСС-Плюс) ========================================================= 
<div class="module-slides" data-module="18">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 18: Капитал</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 18: Капитал</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Identify how trial exclusion criteria create evidence gaps</li>
<li>Применить систему ПРОГРЕСС-Плюс для оценки равенства доказательств</li>
<li>Use PRISMA-Equity reporting guidelines</li>
<li>Understand transportability: when trial findings fail in practice</li>
<li>Design equity-sensitive search and synthesis strategies</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">SPRINT proved tight blood pressure control</p>
<p class="title gold animate delay-1 text-center">saves lives. But whose lives?</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                В знаковое исследование SPRINT были исключены пациенты с диабетом, перенесенным инсультом и сердечной недостаточностью. Более 75% пациентов с гипертонической болезнью в США не прошли бы квалификацию. Доказательства были убедительными, но применимость была узкой.
              </p>
</div>
 Слайд A: Недостающее большинство 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Исследование, в котором исключено большинство пациентов</h2>
<div class="card animate delay-1">
<p class="card-text">
                    В исследовании SPRINT приняли участие 9361 пациент и было доказано, что интенсивный контроль артериального давления (целевой показатель &lt;120 мм рт.ст.) снижает сердечно-сосудистые события на 25% (ОР 0,75, 95% ДИ 0,64–0,89). Но критерии включения говорили о другом.
                  </p>
</div>
<div class="card animate delay-2" style="margin-top: 1rem; background: rgba(197,48,48,0.08); border-left: 3px solid var(--red);">
<p class="card-text"><strong>Кого исключили:</strong></p>
<ul style="margin-top: 0.5rem; padding-left: 1.25rem; line-height: 1.8;">
<li><strong>Diabetes</strong> — 35% взрослых в США страдают гипертонией</li>
<li><strong>Prior stroke</strong> — 8% гипертоников</li>
<li><strong>Symptomatic heart failure</strong> — 6% of hypertensive adults</li>
<li><strong>Expected survival &lt;3 years</strong> — самые слабые пациенты</li>
<li><strong>Nursing home residents</strong> — excluded entirely</li>
<li><strong>GFR &lt;20 mL/min</strong> — advanced kidney disease</li>
</ul>
</div>
<p class="footnote animate delay-3" style="margin-top: 1rem; font-weight: 600;">
                  Результат: более 75% взрослых в США, страдающих гипертонией, НЕ прошли бы квалификацию. Доказательства были убедительными. Но для кого?
                </p>
</div>
</div>
 Слайд B: География доказательств 
<div class="slide dark" data-index="4">
<div class="content" style="max-width: 750px;">
<h2 class="title cream animate" style="text-align: center;">Откуда берутся доказательства</h2>
<div class="gold-line animate delay-1"></div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;">
<div class="animate delay-2" style="background: rgba(212,175,55,0.1); padding: 1.25rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
<p style="font-size: 2rem; font-weight: 700; color: var(--gold);">78%</p>
<p style="font-size: 0.95rem; margin-top: 0.5rem;">of cardiovascular mega-trial participants came from high-income countries (2000–2020).</p>
</div>
<div class="animate delay-3" style="background: rgba(212,175,55,0.1); padding: 1.25rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
<p style="font-size: 2rem; font-weight: 700; color: var(--gold);">6%</p>
<p style="font-size: 0.95rem; margin-top: 0.5rem;">from sub-Saharan Africa — where cardiovascular disease is rising fastest.</p>
</div>
</div>
<div class="animate delay-4" style="margin-top: 1.5rem; background: rgba(255,255,255,0.05); padding: 1.25rem; border-radius: 8px;">
<p style="font-size: 1rem; line-height: 1.7;">
                    Испытания полипилл: 4 из 5 были проведены в группах населения со средним ИМТ &lt;25. Средний индекс массы тела в США составляет 30. Метаболизм лекарств, характер сопутствующих заболеваний, доступ к здравоохранению и генетические вариации различаются в разных популяциях. <strong>Efficacy in one population does not guarantee
                    effectiveness in another.</strong>
</p>
</div>
<p class="footnote animate delay-4" style="margin-top: 1rem; opacity: 0.7; font-size: 0.85rem;">
                  Ссылка: Международные исследования и пробел ПРОГРЕСС-Плюс.
                </p>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">PROGRESS-Plus Framework</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box"><div class="stat-value">P</div><div class="stat-label">Place of residence</div></div>
<div class="stat-box"><div class="stat-value">R</div><div class="stat-label">Race / ethnicity</div></div>
<div class="stat-box"><div class="stat-value">O</div><div class="stat-label">Occupation</div></div>
<div class="stat-box"><div class="stat-value">G</div><div class="stat-label">Gender / sex</div></div>
<div class="stat-box"><div class="stat-value">R</div><div class="stat-label">Religion</div></div>
<div class="stat-box"><div class="stat-value">E</div><div class="stat-label">Education</div></div>
<div class="stat-box"><div class="stat-value">S</div><div class="stat-label">SES (socioeconomic)</div></div>
<div class="stat-box"><div class="stat-value">S</div><div class="stat-label">Social capital</div></div>
</div>
<p class="footnote animate delay-2"><strong>Plus:</strong> Age, disability, sexual orientation, other vulnerable groups.</p>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">PRISMA-Equity &amp; Transportability</h2>
<div class="card animate delay-1">
<p class="card-text">
<strong>PRISMA-Equity</strong> расширяет PRISMA, требуя отчетность о том, как справедливость учитывалась в обзоре: характеристики населения, анализ подгрупп по неблагоприятным условиям и оценка применимости к группам населения, недостаточно обслуживаемым.
                  </p>
</div>
<div class="card animate delay-2" style="margin-top:1rem;">
<p class="card-text">
<strong>Transportability</strong>: Эффективность испытаний не равна эффективности в реальной жизни. Существуют методы повторного взвешивания данных испытаний, чтобы они соответствовали распределению целевой группы населения.
                  </p>
</div>
</div>
</div>
 Слайд C: Вопрос транспортабельности 
<div class="slide light" data-index="7" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">From Trial to Real World: Transportability</h2>
<div class="card animate delay-1">
<p class="card-text">
<strong>Transportability</strong> = Могут ли результаты исследования группы X быть применены к целевой группе Y? Это не философский вопрос — у него есть формальные методы.
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Inverse Probability of Participation Weighting (IPPW)</h4>
<p>Re-weights trial participants so they resemble the target population on key covariates.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Generalizability Index</h4>
<p>Количественно определяет, насколько пробная выборка похожа на целевую совокупность по наблюдаемым характеристикам.</p>
</div>
</div>
<div class="card animate delay-4" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
<p class="card-text">
<strong>Stuart et al. (2015, <em>Stat Med</em>):</strong> Когда результаты SPRINT были повторно взвешены, чтобы соответствовать населению США с гипертонической болезнью, предполагаемая польза была снижена — HR 0,82 (по сравнению с 0,75 в исследовании). Лечение все еще работает. Но масштабы меняются, когда меняется численность населения.
                  </p>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">СПРИНТ и недостающее большинство</h3>
<p style="margin-bottom: 0.75rem;">
                    SPRINT представляло собой хорошо спланированное исследование с участием 9361 пациента. Его открытие (HR 0,75 для интенсивного и стандартного контроля АД) изменило рекомендации во всем мире. Но последующий анализ показал, что польза была самой сильной в подгруппе, наиболее похожей на исследуемую популяцию, и неопределенна для исключенных групп.
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    Справедливость в синтезе доказательств означает вопрос не просто «Работает ли это?» но «Для кого это работает?»
                  </p>
</div>
</div>
</div>
<!-- Slide D: Decision Tree -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Схема принятия решений: оценка справедливости для вашего обзора</h2>
<div class="decision-tree animate delay-1" style="font-size: 0.95rem; line-height: 1.7;">
<div class="card" style="background: var(--navy); color: var(--cream); padding: 1rem; border-radius: 8px;">
<p><strong>ROOT:</strong> Получены ли данные вашего обзора из групп населения, схожих с вашей целевой аудиторией?</p>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
<div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--green);">
<p><strong>YES</strong> → Good. But check: Are subgroups (age, sex, ethnicity, SES) reported separately?</p>
<ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
<li><strong>Yes:</strong> Use subgroup effects for population-specific recommendations</li>
<li><strong>No:</strong> Flag as limitation — equity gap in reporting</li>
</ul>
</div>
<div style="background: rgba(197,48,48,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--red);">
<p><strong>NO</strong> → Does PROGRESS-Plus analysis reveal differential effects?</p>
<ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
<li><strong>Yes:</strong> Population-specific recommendations needed. Consider transportability re-weighting.</li>
<li><strong>No:</strong> Cautious generalization with explicit equity statement in discussion</li>
</ul>
</div>
</div>
</div>
</div>
</div>
 Слайд E: Обратный вызов к модулю 3 
<div class="slide dark" data-index="10" data-tier="mastery">
<span class="tier-badge mastery" style="position:absolute; top:1.5rem; right:1.5rem;">Methodologist</span>
<div class="content" style="max-width: 700px;">
<h2 class="title cream animate" style="text-align: center;">Callback: The HRT Lesson Revisited</h2>
<div class="gold-line animate delay-1"></div>
<div class="card animate delay-2" style="background: rgba(212,175,55,0.1); border: 1px solid rgba(212,175,55,0.3); margin-top: 1.5rem;">
<p class="card-text" style="color: var(--cream);">
                    Помните Модуль 3? История HRT показала, что <strong>healthy-user bias</strong> сделало вредное лечение полезным. У SPRINT может быть противоположная проблема — эффект «здорового добровольца» может привести к появлению эффективного лечения. <em>more</em> effective than
                    it would be in the real world.
                  </p>
</div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; margin-top: 1.5rem; font-style: italic; opacity: 0.9;">
                  Каждый метаанализ должен задавать вопрос: кто был включен? Кого исключили? И имеет ли это значение?
                </p>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 18 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> What does the PROGRESS-Plus framework help reviewers assess?</p>
<div class="quiz-options" id="m18-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 0, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
<span>A.</span> Statistical heterogeneity
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 1, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
<span>B.</span> Equity and applicability across disadvantaged populations
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 2, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
<span>C.</span> Внутренняя валидность включенных исследований
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 3, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
<span>D.</span> Общая достоверность доказательств
                    </div>
</div>
<div id="m18-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 18 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «Доказательства, исключающие уязвимых, не могут претендовать на то, чтобы служить им».
                </p>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 19: Машина</p>
</div>
</div>
 ========================================================== МОДУЛЬ 19: МАШИНА (Кокрейновский скрининг на COVID) ========================================================= 
<div class="module-slides" data-module="19">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Количество без происхождения не является числом.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 19: Машина</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 19: Машина</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Describe how AI/ML is used in systematic review screening</li>
<li>Explain active learning and human-in-the-loop workflows</li>
<li>Assess automation validation: recall, workload savings, and risk</li>
<li>Признайте ограничения и предвзятости алгоритмического скрининга</li>
<li>Применять основы для ответственного использования ИИ при синтезе доказательств</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">When COVID-19 hit,</p>
<p class="title gold animate delay-1 text-center">papers arrived faster than humans could read.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                К 2021 году существовало более 300 000 статей о COVID. Кокрейн использовал классификаторы машинного обучения для сортировки исследований и их быстрых обзоров, что позволило сократить рабочую нагрузку по скринингу до 70% при сохранении запоминаемости &gt;95%.
              </p>
</div>
<!-- The Flood -->
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Flood</h2>
<div class="card animate delay-1">
<p>By April 2020, <strong>4,000 COVID preprints appeared every week</strong>.</p>
<p style="margin-top: 0.5rem;">PubMed indexed <strong>500 new COVID articles per day</strong>.</p>
<p style="margin-top: 0.5rem;">Cochrane's screening queue hit <strong>10,000 unreviewed titles</strong>.</p>
</div>
<div class="investigation-box animate delay-2" style="margin-top: 1rem;">
<div class="investigation-header"><span class="icon">🔍</span> Математика невозможности</div>
<div class="investigation-content">
<p>A pair of reviewers screens ~200 titles per day.</p>
<p><strong>At 500 new articles/day, they fell further behind with every hour.</strong></p>
<p style="margin-top: 0.5rem; font-style: italic;">Живой обзор умирал, не успев жить.</p>
</div>
</div>
</div>
</div>
 Первые попытки 
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Первые попытки</h2>
<p class="direct-address animate delay-1">Идея не была новой. Коэн и др. (2006, JAMIA) впервые показали, что машинное обучение может снизить нагрузку на проверку на 50 % — при этом потеря памяти составляет менее 5 %.</p>
<div class="lesson-item animate delay-2">
<div class="lesson-icon">📅</div>
<div class="lesson-text"><strong>2006:</strong> Cohen et al. — SVM classifiers for drug class reviews. Proof of concept.</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-icon">📅</div>
<div class="lesson-text"><strong>2016:</strong> RobotReviewer (Marshall et al., JMLR) — ML for risk of bias assessment. Inter-rater reliability comparable to human reviewers.</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-icon">📅</div>
<div class="lesson-text"><strong>2021:</strong> ASReview (van de Schoot et al., Nature Machine Intelligence) — active learning that simulated 95% workload reduction.</div>
</div>
<p class="animate delay-3" style="margin-top: 1rem; font-style: italic; color: var(--gold);">Но симуляция – это не реальность. COVID станет первым настоящим масштабным испытанием.</p>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">AI in Systematic Reviews</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Screening Prioritization</h4>
<p>Active learning ranks citations by relevance. Reviewers screen the most likely relevant first.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Помощь в извлечении данных</h4>
<p>НЛП извлекает элементы, исходы и результаты PICO. Всегда требует человеческой проверки.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Risk of Bias Assessment</h4>
<p>ML classifiers predict RoB domains. Experimental—human judgment remains gold standard.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Validating Automation</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">Recall</div>
<div class="stat-label">&gt;95% required. Missing 1 study can change conclusions.</div>
</div>
<div class="stat-box">
<div class="stat-value">WSS@95%</div>
<div class="stat-label">Work Saved over Sampling at 95% recall.</div>
</div>
<div class="stat-box">
<div class="stat-value">Stopping</div>
<div class="stat-label">When to stop screening? Consecutive irrelevant threshold.</div>
</div>
</div>
<div class="card animate delay-2" style="margin-top:1rem;">
<p class="card-text">
<strong>Основное напряжение:</strong> Автоматизация экономит время, но создает новый источник ошибок. Всегда сообщайте об инструменте, версии, данных обучения и критериях остановки.
                  </p>
</div>
</div>
</div>
 Кризис валидации 
<div class="slide dark" data-index="7">
<div class="content" style="max-width: 700px;">
<div class="investigation-box animate">
<div class="investigation-header"><span class="icon">🔍</span> Парадокс валидации</div>
<div class="investigation-content">
<p>Чтобы узнать, пропустила ли машина соответствующее исследование, <strong>you need a human to screen everything</strong>.</p>
<p style="margin-top: 0.5rem;">But if humans screen everything, <strong>зачем использовать машину?</strong></p>
<p style="margin-top: 1rem;">The solution: <strong>prospective holdout validation</strong>.</p>
<ul style="margin-top: 0.5rem;">
<li>Random 10% sample screened by both human and machine</li>
<li>Сравните: машина пропустила то, что нашел человек?</li>
<li>If recall drops below 95%, retrain and expand human screening</li>
</ul>
<p style="margin-top: 1rem; font-style: italic;">Доверяй, но проверяй. Машина заслужила свою роль, а не наследовала ее.</p>
</div>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Cochrane's COVID Response</h3>
<p style="margin-bottom: 0.75rem;">
                    Кокрейн создал Регистр исследований COVID-19, используя классификаторы машинного обучения, обученные на миллионах записей. Система достигла чувствительности 99%, сократив при этом ручной скрининг с недель до дней.
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    Но машина была инструментом, а не заменой. Каждое включенное исследование по-прежнему проверялось рецензентами. Урок: ИИ дополняет рецензента, а не заменяет его.
                  </p>
</div>
</div>
</div>
 Исследование, которое почти не было найдено 
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Исследование, которое почти не было найдено</h2>
<div class="story-box animate delay-1">
<p>В июне 2020 года исследование RECOVERY опубликовало результаты по дексаметазону:<strong>the first treatment proven to reduce COVID mortality</strong> (28-day mortality: 22.9% vs 25.7%, RR 0.83).</p>
<p style="margin-top: 0.5rem;">Препринт появился на medRxiv с нестандартным названием. Подобные сценарии повторялись неоднократно во время пандемии: классификаторы ОД, обученные на существующей терминологии, низко оценивали незнакомые концепции.</p>
<p style="margin-top: 0.5rem;">В нескольких живых обзорах рецензенты, просматривающие помеченные названия, узнавали ключевые названия лекарств и расширяли исследования, которые классификаторы лишили приоритета.</p>
<p style="margin-top: 1rem; font-weight: 600; color: var(--gold);">Без этих людей важные результаты лечения могли бы подождать несколько недель, прежде чем они попадут в живой обзор.</p>
<p style="margin-top: 0.5rem; font-style: italic;">Машина читает быстрее. Человек читает глубже. Ни того, ни другого недостаточно.</p>
</div>
</div>
</div>
<!-- Decision Tree: When Should You Use AI? -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Decision Tree: When Should You Use AI?</h2>
<div class="decision-tree animate delay-1">
<div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    В вашем обзоре будет представлено более 5000 наименований?
                  </div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
<div class="decision-option" style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
<strong>Yes → Consider AI-assisted screening</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;">Active learning prioritization. Dual-screen random 10% holdout. Stop when 3 consecutive batches yield 0 relevant studies.</p>
<p style="margin-top: 0.5rem; font-size: 0.85rem; font-style: italic;">Report: classifier type, training data, recall on holdout, stopping rule.</p>
</div>
<div class="decision-option" style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
<strong>No → Manual screening is feasible</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;">For &lt;5,000 titles, dual human screening remains gold standard. AI adds complexity without proportionate benefit.</p>
</div>
</div>
<div class="decision-node animate delay-2" style="background: rgba(212,175,55,0.15); padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid var(--gold);">
<strong>Это живой или быстрый обзор?</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;">If yes → AI is especially valuable. Continuous classifier retraining on new evidence. But: <strong>никогда не позволяйте машине принимать окончательное решение о включении.</strong></p>
</div>
</div>
</div>
</div>
 Узор повторяется 
<div class="slide light" data-index="11" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Узор повторяется</h2>
<p class="direct-address animate delay-1">Помните Модуль 6? Полдерманс сфабриковал данные DECREASE, которые послужили основой для рекомендаций по периоперационному назначению бета-блокаторов в течение десятилетия.</p>
<div class="card animate delay-2">
<p>AI can now detect statistical anomalies automatically:</p>
<ul style="margin-top: 0.5rem;">
<li><strong>GRIM test:</strong> Соответствуют ли сообщаемые средние значения целочисленным размерам выборки?</li>
<li><strong>SPRITE:</strong> Можно ли восстановить представленную сводную статистику на основе правдоподобных индивидуальных данных?</li>
<li><strong>Statcheck:</strong> Do reported p-values match the test statistics?</li>
</ul>
<p style="margin-top: 1rem;">Эти инструменты обнаружили аномалии в <strong>hundreds of published papers</strong>—faster than any human auditor.</p>
<p style="margin-top: 0.5rem; font-style: italic; color: var(--gold);">Но машина зависает. Человеческие судьи. Решение об отказе остается глубоко человеческим.</p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Module 19 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> Каков минимально допустимый отзыв для скрининга с помощью ИИ в систематических обзорах?</p>
<div class="quiz-options" id="m19-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 0, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
<span>A.</span> 80%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 1, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
<span>B.</span> 90%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 2, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
<span>C.</span> &gt;95%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 3, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
<span>D.</span> 100%
                    </div>
</div>
<div id="m19-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="13">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 19 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «Машина читает быстрее. Человек читает глубже. Вместе они читают правду».
                </p>
</div>
</div>
<div class="slide black" data-index="14">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 20: Качественный</p>
</div>
</div>
 ========================================================= МОДУЛЬ 20: КАЧЕСТВЕННЫЙ (Борен 2015 — уход за беременными) ========================================================= 
<div class="module-slides" data-module="20">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Методы защищают пациентов от нашего доверия.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 20: Качественный</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 20: Качественный</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Explain why some questions require qualitative evidence synthesis</li>
<li>Describe meta-ethnography (Noblit &amp; Hare) and thematic synthesis</li>
<li>Apply the CERQual framework to assess confidence in qualitative findings</li>
<li>Understand mixed-methods synthesis approaches</li>
<li>Recognize when qualitative evidence changes practice</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">ВОЗ задала вопрос</p>
<p class="title gold animate delay-1 text-center">ни одно РКИ не смогло ответить.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                Почему женщины во всем мире испытывают неуважение и насилие во время родов? Борен и др. (2015) объединили 65 качественных исследований из 34 стран в структуру семи областей плохого обращения.
              </p>
</div>
 Слайд A: Вопрос, выходящий за рамки рандомизации 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Вопрос за пределами рандомизации</h2>
<div class="card animate delay-1" style="background: rgba(197,48,48,0.06); border-left: 3px solid var(--red);">
<p class="card-text">
                    В 2014 году ВОЗ созвала комиссию для решения глобального кризиса: женщины подвергались физическому насилию, словесным унижениям и лишению медицинской помощи во время родов. Это не было редким событием — сообщения поступали из <strong>34 countries</strong>.
                  </p>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text">
                    They needed to understand <strong>WHY</strong>. What drives disrespect and abuse in maternity care?
                  </p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
<p class="card-text">
                    Ни одно РКИ не смогло ответить на этот вопрос. Вы не можете рандомизировать женщин на жестокий и уважительный уход. Вы не можете ослепить акушерок. Вы не можете измерить «достоинство» по шкале Лайкерта.
                    <strong>Доказательства должны были быть качественными.</strong>
</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Meta-Ethnography</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Developed by Noblit &amp; Hare (1988), meta-ethnography <strong>translates</strong>
                    концепции в исследованиях, а не агрегирование цифр. Он создает новые структуры интерпретации (конструкты третьего порядка) на основе данных первого порядка (цитаты участников) и второго порядка (интерпретации автора).
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">Reciprocal</div>
<div class="stat-label">Исследования подтверждают друг друга</div>
</div>
<div class="stat-box">
<div class="stat-value">Refutational</div>
<div class="stat-label">Исследования противоречат друг другу</div>
</div>
<div class="stat-box">
<div class="stat-value">Line of<br/>argument</div>
<div class="stat-label">Исследования создают новую теорию</div>
</div>
</div>
</div>
</div>
<!-- Slide B: Bohren's Seven Domains -->
<div class="slide dark" data-index="5">
<div class="content" style="max-width: 750px;">
<h2 class="title cream animate" style="text-align: center;">What Bohren Found: A Taxonomy of Mistreatment</h2>
<div class="gold-line animate delay-1"></div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 1.5rem;">
<div class="animate delay-2" style="background: rgba(197,48,48,0.15); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">1. Physical abuse</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Hitting, pinching, slapping during labor</p>
</div>
<div class="animate delay-2" style="background: rgba(197,48,48,0.15); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">2. Sexual abuse</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Inappropriate touching, non-consensual procedures</p>
</div>
<div class="animate delay-3" style="background: rgba(197,48,48,0.12); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">3. Verbal abuse</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Shouting, threats, judgmental comments</p>
</div>
<div class="animate delay-3" style="background: rgba(197,48,48,0.12); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">4. Stigma &amp; discrimination</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Based on HIV status, ethnicity, age, poverty</p>
</div>
<div class="animate delay-4" style="background: rgba(197,48,48,0.09); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">5. Professional standards failure</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Neglect, lack of informed consent</p>
</div>
<div class="animate delay-4" style="background: rgba(197,48,48,0.09); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">6. Poor rapport</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Poor communication, dismissiveness</p>
</div>
</div>
<div class="animate delay-4" style="background: rgba(197,48,48,0.06); padding: 0.75rem 1rem; border-radius: 6px; margin-top: 0.75rem; text-align: center;">
<strong style="color: var(--gold);">7. Health system conditions</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Overcrowding, understaffing, lack of supplies</p>
</div>
<p class="animate delay-4" style="font-size: 1rem; text-align: center; margin-top: 1.25rem; font-style: italic; opacity: 0.9;">
                  65 исследований. 34 страны. Одни и те же закономерности повторяются в разных языках, культурах и системах. Это был не анекдот. Это были синтезированные доказательства.
                </p>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">CERQual: уверенность в качественных доказательствах</h2>
<div class="card animate delay-1">
<p class="card-text">
                    CERQual assesses confidence in qualitative review findings across four components:
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content"><h4>Methodological Limitations</h4><p>Качество сопутствующих исследований.</p></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content"><h4>Coherence</h4><p>Насколько хорошо данные подтверждают этот вывод.</p></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">3</div>
<div class="lesson-content"><h4>Adequacy</h4><p>Богатство данных (а не только количество исследований).</p></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content"><h4>Relevance</h4><p>Применимость к контексту контрольного вопроса.</p></div>
</div>
</div>
</div>
 Слайд C: От доказательств к действию 
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">When Qualitative Evidence Changes Practice</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Bohren's synthesis informed the WHO's <strong>2018 Recommendations on Intrapartum Care
                    for a Positive Childbirth Experience</strong>. Specific changes grounded in qualitative evidence:
                  </p>
</div>
<div class="stats-grid animate delay-2" style="margin-top: 1rem;">
<div class="stat-box" style="text-align: left; padding: 1rem;">
<div class="stat-value" style="font-size: 1.2rem;">Rec. 15</div>
<div class="stat-label">Companionship during labor</div>
</div>
<div class="stat-box" style="text-align: left; padding: 1rem;">
<div class="stat-value" style="font-size: 1.2rem;">Rec. 1</div>
<div class="stat-label">Respectful maternity care</div>
</div>
<div class="stat-box" style="text-align: left; padding: 1rem;">
<div class="stat-value" style="font-size: 1.2rem;">Rec. 3</div>
<div class="stat-label">Effective communication</div>
</div>
<div class="stat-box" style="text-align: left; padding: 1rem;">
<div class="stat-value" style="font-size: 1.2rem;">Rec. 12</div>
<div class="stat-label">Emotional support</div>
</div>
</div>
<p class="footnote animate delay-3" style="margin-top: 1rem; font-weight: 600;">
                  Эти рекомендации, основанные на качественных данных, в настоящее время являются руководством по охране материнства в 194 государствах-членах ВОЗ. Ни один лесной участок не смог бы их произвести. Никакая статистика I² не могла бы их выявить.
                </p>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Bohren's Framework of Mistreatment</h3>
<p style="margin-bottom: 0.75rem;">
                    Качественный синтез 2015 года выявил семь областей: физическое насилие, сексуальное насилие, словесное оскорбление, стигма и дискриминация, несоблюдение профессиональных стандартов, плохое взаимопонимание и состояние системы здравоохранения. Эта система легла в основу рекомендаций ВОЗ по уходу во время родов (2018 г.).
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    Никакое значение p не могло бы отразить ощущения от пощечины во время родов. Качественный синтез озвучил то, чего не могли дать цифры.
                  </p>
</div>
</div>
</div>
<!-- Slide D: Decision Tree -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Decision Tree: When Is Qualitative Synthesis Appropriate?</h2>
<div class="decision-tree animate delay-1" style="font-size: 0.95rem; line-height: 1.7;">
<div class="card" style="background: var(--navy); color: var(--cream); padding: 1rem; border-radius: 8px;">
<p><strong>ROOT:</strong> Вопрос вашего исследования касается опыта, восприятия, барьеров или помощников?</p>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
<div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--green);">
<p><strong>YES</strong> → Ваш вопрос о том, КАК или ПОЧЕМУ, а не только о том, ЛИ?</p>
<ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
<li><strong>Yes:</strong> Qualitative evidence synthesis (meta-ethnography, thematic synthesis, or framework synthesis)</li>
<li><strong>No:</strong> Рассмотрите смешанные методы: количественные для эффекта + качественные для механизма.</li>
</ul>
</div>
<div style="background: rgba(212,175,55,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--gold);">
<p><strong>NO</strong> → Ваш вопрос об эффективности/эффективности?</p>
<ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
<li><strong>Yes:</strong> Quantitative meta-analysis</li>
<li><strong>But:</strong> Дополнить качественным обзором препятствий на пути реализации (оценка CERQual)</li>
</ul>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
<p class="card-text" style="font-style: italic;">
<strong>Key insight:</strong> Самые сильные систематические обзоры отвечают на оба вопроса: работает ли это? (количественное) И Почему это работает или не работает? (качественный)
                    </p>
</div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Module 20 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> What distinguishes meta-ethnography from quantitative meta-analysis?</p>
<div class="quiz-options" id="m20-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 0, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
<span>A.</span> Он включает только 3–5 исследований.
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 1, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
<span>B.</span> It translates concepts across studies rather than pooling numbers
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 2, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
<span>C.</span> It does not require a systematic search
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 3, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
<span>D.</span> It is less rigorous than quantitative synthesis
                    </div>
</div>
<div id="m20-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="11">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 20 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «Не все, что имеет значение, можно посчитать. Не все, что имеет значение, имеет значение».
                </p>
</div>
</div>
<div class="slide black" data-index="12">
<p class="refrain animate">Гетерогенность — это сообщение, а не шум.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 21: Многовариантность</p>
</div>
</div>
 ========================================================== МОДУЛЬ 21: МНОГОВАРИАТНЫЙ (Коррелированные исходы / RVE) ========================================================= 
<div class="module-slides" data-module="21">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Гетерогенность — это сообщение, а не шум.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 21: Многовариантность</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 21: Многовариантность</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Распознавать, когда результаты в исследовании коррелируют</li>
<li>Explain multivariate random-effects models</li>
<li>Apply robust variance estimation (RVE) for dependent effect sizes</li>
<li>Понимание трехуровневых моделей для вложенных данных</li>
<li>Choose between multivariate approaches based on data structure</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">Cardiovascular trials report</p>
<p class="title gold animate delay-1 text-center">смертность, ИМ, инсульт и многое другое.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                Эти результаты коррелируют между пациентами. У умершего пациента не может быть конечной точки ИМ. Стандартный метаанализ рассматривает каждый результат независимо, игнорируя зависимость и потенциально двойной учет доказательств.
              </p>
</div>
 Слайд А: Ложь об удобстве 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Предположение, которое никто не подвергает сомнению</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Откройте любой стандартный учебник по метаанализу. Модели предполагают, что каждое исследование вносит свой вклад
                    <strong>one independent effect size</strong>. But reality is different.
                  </p>
</div>
<div class="card animate delay-2" style="margin-top: 1rem; background: rgba(197,48,48,0.06); border-left: 3px solid var(--red);">
<p class="card-text">
                    В одном сердечно-сосудистом исследовании сообщается о смертности, инфаркте миокарда, инсульте и реваскуляризации. В одном психотерапевтическом исследовании сообщается о депрессии, тревоге и качестве жизни через 3, 6 и 12 месяцев.
                  </p>
</div>
<div class="stats-grid animate delay-3" style="margin-top: 1rem;">
<div class="stat-box">
<div class="stat-value">30 trials</div>
<div class="stat-label">× 4 outcomes</div>
</div>
<div class="stat-box">
<div class="stat-value">= 120</div>
<div class="stat-label">effect sizes</div>
</div>
</div>
<div class="card animate delay-4" style="margin-top: 1rem;">
<p class="card-text">
                    Most analysts either: <strong>(a)</strong> treat all 120 as independent (inflating precision
                    by a factor of √4), or <strong>(b)</strong> выберите один результат и отбросьте остальные.
                    <strong>Оба подхода неверны.</strong>
</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Проблема зависимости</h2>
<div class="card animate delay-1">
<p class="card-text">
                    In standard pairwise meta-analysis, each study contributes <em>one</em> effect size.
                    But many studies report multiple outcomes, subgroups, timepoints, or arms—creating
                    <strong>dependent</strong> размеры эффекта. Игнорирование этого повышает точность и искажает выводы.
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">RVE</div>
<div class="stat-label">Robust Variance Estimation. Sandwich estimator handles unknown correlation.</div>
</div>
<div class="stat-box">
<div class="stat-value">3-Level</div>
<div class="stat-label">Study → Outcome nesting modeled explicitly.</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="5" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Robust Variance Estimation</h2>
<div class="card animate delay-1">
<p class="card-text">
                    RVE (Hedges, Tipton &amp; Johnson, 2010) uses a <strong>sandwich-type</strong> оценщик, который обеспечивает действительные стандартные ошибки независимо от истинной корреляции между зависимыми эффектами. Нет необходимости знать или оценивать корреляцию внутри исследования. Лучше всего для ≥20 исследований.
                  </p>
</div>
<div class="card animate delay-2" style="margin-top:1rem;">
<p class="card-text">
<strong>Small-sample correction:</strong> Типтон и Пустейовский (2015) разработали поправки для малой выборки (CR2) для RVE, используя степени свободы Саттертуэйта, когда количество кластеров мало.
                  </p>
</div>
</div>
</div>
 Слайд B: Математическая истина 
<div class="slide dark" data-index="6" data-tier="methods">
<span class="tier-badge methods" style="position:absolute; top:1.5rem; right:1.5rem;">Researcher</span>
<div class="content" style="max-width: 700px;">
<h2 class="title cream animate" style="text-align: center;">What Dependence Does to Your Confidence Intervals</h2>
<div class="gold-line animate delay-1"></div>
<div class="animate delay-2" style="margin-top: 1.5rem; background: rgba(212,175,55,0.1); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
<p style="font-size: 1rem; margin-bottom: 0.75rem;">
                    Если 4 исхода одного и того же исследования имеют корреляцию внутри исследования ρ = 0,5:
                  </p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
<div style="background: rgba(197,48,48,0.2); padding: 1rem; border-radius: 6px; text-align: center;">
<p style="font-size: 0.85rem; opacity: 0.8;">Treating as independent</p>
<p style="font-size: 1.5rem; font-weight: 700; color: var(--red); margin-top: 0.25rem;">CI width = X</p>
</div>
<div style="background: rgba(34,197,94,0.2); padding: 1rem; border-radius: 6px; text-align: center;">
<p style="font-size: 0.85rem; opacity: 0.8;">Учет зависимости</p>
<p style="font-size: 1.5rem; font-weight: 700; color: var(--green); margin-top: 0.25rem;">CI width = 1.58X</p>
</div>
</div>
<p style="font-size: 1rem; margin-top: 1rem; text-align: center;">
                    Ваш доверительный интервал должен быть <strong>58% wider</strong>. Каждый метаанализ, который игнорировал это, публиковал ложно точные результаты.
                  </p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border: 1px solid rgba(212,175,55,0.2);">
<p class="card-text" style="color: var(--cream);">
<strong>RVE</strong> (Hedges, Tipton &amp; Johnson, 2010): Uses a “sandwich”
                    variance estimator that produces correct standard errors <em>without</em> needing to know
                    the exact within-study correlation.
                  </p>
</div>
</div>
</div>
<!-- Slide C: The Three Levels (expanded) -->
<div class="slide light" data-index="7" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Three-Level Models: Making Structure Explicit</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Level 1: Sampling Variance</h4>
<p>Measurement error within each effect size estimate.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Level 2: Within-Study Variance</h4>
<p>Результаты и сроки варьируются в пределах одного исследования.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Level 3: Between-Study Variance</h4>
<p>Исследования отличаются друг от друга популяциями, условиями и методами.</p>
</div>
</div>
<div class="card animate delay-4" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
<p class="card-text">
<strong>Example:</strong> В метаанализе психотерапии депрессии (k = 50 исследований, 180 размеров эффекта) <strong>35%</strong> дисперсия была внутри исследования (разные результаты) и <strong>65%</strong> было между исследованиями (различные методы лечения, группы населения). Это разложение показывает, насколько неоднородна <em>within</em> vs <em>between</em> studies.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="8" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Three-Level Models: Formal Framework</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Когда эффекты являются вложенными (например, множественные результаты в рамках исследований или исследования в исследовательских группах), <strong>three-level model</strong> дисперсия разделяется на: (1) выборочную дисперсию (уровень 1), (2) дисперсию внутри исследования (уровень 2) и (3) дисперсию между исследованиями (уровень 3). Это поддерживает правильный вывод, одновременно заимствуя силу на разных уровнях.
                  </p>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="9">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Сердечно-сосудистая проблема</h3>
<p style="margin-bottom: 0.75rem;">
                    Метаанализ статинов может включать 30 исследований, в каждом из которых сообщается о смертности, ИМ, инсульте и реваскуляризации. Это 120 размеров эффекта из 30 кластеров. Если рассматривать их как 120 независимых оценок, точность увеличивается на коэффициент, связанный с корреляцией внутри исследования.
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    RVE or multivariate models handle this correctly—producing wider, honest confidence intervals.
                  </p>
</div>
</div>
</div>
<!-- Slide D: Decision Tree -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Decision Tree: Which Approach for Dependent Effect Sizes?</h2>
<div class="decision-tree animate delay-1" style="font-size: 0.95rem; line-height: 1.7;">
<div class="card" style="background: var(--navy); color: var(--cream); padding: 1rem; border-radius: 8px;">
<p><strong>ROOT:</strong> Имеет ли ваш метаанализ несколько эффектов на одно исследование?</p>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
<div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--green);">
<p><strong>YES</strong> → Знаете ли вы (или можете оценить) корреляции внутри исследования?</p>
<ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
<li><strong>Yes:</strong> Multivariate random-effects model (most efficient)</li>
<li><strong>No:</strong> RVE with small-sample correction (robust to unknown correlations)</li>
</ul>
</div>
<div style="background: rgba(212,175,55,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--gold);">
<p><strong>NO</strong> → Standard univariate random-effects model</p>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text"><strong>Sub-question:</strong> Являются ли ваши множественные эффекты результатом разных результатов, моментов времени или подгрупп?</p>
<ul style="margin-top: 0.5rem; padding-left: 1.25rem; line-height: 1.8; font-size: 0.9rem;">
<li><strong>Different outcomes</strong> → Three-level model or RVE with clustering</li>
<li><strong>Different timepoints</strong> → Network of timepoints with temporal correlation</li>
<li><strong>Different subgroups</strong> → Consider if subgroups are meaningful or should be averaged</li>
</ul>
</div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 21 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> What problem does Robust Variance Estimation (RVE) solve?</p>
<div class="quiz-options" id="m21-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 0, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I² and tau².', 'Small study effects use regression-based methods.'])">
<span>A.</span> Publication bias
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 1, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I² and tau².', 'Small study effects use regression-based methods.'])">
<span>B.</span> Зависимость между несколькими величинами эффекта в одном исследовании
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 2, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I² and tau².', 'Small study effects use regression-based methods.'])">
<span>C.</span> Between-study heterogeneity
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 3, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I² and tau².', 'Small study effects use regression-based methods.'])">
<span>D.</span> Small-study effects
                    </div>
</div>
<div id="m21-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 21 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «Когда результаты запутаны, притворяться, что они независимы, — это удобная ложь».
                </p>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">Количество без происхождения не является числом.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 22: Доказательство</p>
</div>
</div>
 ========================================================== МОДУЛЬ 22: ДОКАЗАТЕЛЬСТВО (ошибка Excel Рейнхарта-Рогоффа) ========================================================= 
<div class="module-slides" data-module="22">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Количество без происхождения не является числом.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 22: Доказательство</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 22: Доказательство</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Understand how computational errors propagate through policy</li>
<li>Дать определение воспроизводимости и отличить ее от воспроизводимости.</li>
<li>Применяйте хеширование доказательств и числа, подтверждающие доказательства.</li>
<li>Use reproducibility checklists for meta-analysis</li>
<li>Признать роль предварительной регистрации и открытых данных</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">A graduate student opened a spreadsheet</p>
<p class="title gold animate delay-1 text-center">и обнаружил, что эра жесткой экономии была построена на ошибке.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                В 2010 году Рейнхарт и Рогофф заявили, что страны с соотношением долга к ВВП &gt;90% имели отрицательный рост. Это повлияло на политику жесткой экономии по всей Европе. В 2013 году Томас Херндон обнаружил ошибку Excel, из-за которой из среднего показателя были исключены 5 стран. Скорректированный результат: скромный положительный рост, а не крах.
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Reproducibility vs Replicability</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">Reproducible</div>
<div class="stat-label">Same data + same code = same result</div>
</div>
<div class="stat-box">
<div class="stat-value">Replicable</div>
<div class="stat-label">Новые данные + те же методы = стабильный результат</div>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text">
                    Reproducibility is the <strong>minimum standard</strong>. Если другие не могут воспроизвести вашу объединенную оценку на основе предоставленных вами данных, анализ не может быть проверен. Мета-анализы должны делиться: извлеченными данными, сценариями анализа, версиями программного обеспечения и случайными исходными данными.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="4" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Proof-Carrying Numbers</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Every number in a meta-analysis should carry its <strong>provenance</strong>: откуда он взялся, как был преобразован и какой код его создал.
                    <strong>Evidence hashing</strong> creates a cryptographic fingerprint of inputs
                    so any change (accidental or deliberate) is detectable.
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">SHA</div>
<div class="lesson-content">
<h4>Input Hash</h4>
<p>Хеш извлеченных данных SHA-256. Если одна ячейка изменится, хэш изменится. Цепочка происхождения: данные → код → результат → хеш.</p>
</div>
</div>
</div>
</div>
<!-- Interactive tool -->
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Interactive: Reproducibility Checklist</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Отметьте галочкой каждый пункт, чтобы оценить воспроизводимость метаанализа. Какова оценка вашего обзора?
                </p>
<div class="animate delay-2" id="reproducibilityTool" style="background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
<div id="reproChecklist"></div>
<div id="reproScore" style="margin-top:1rem; padding:0.75rem; background:rgba(212,175,55,0.1); border-radius:6px;"></div>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="6">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Ошибка Excel, изменившая экономику</h3>
<p style="margin-bottom: 0.75rem;">
                    «Рост во время долга» Рейнхарта-Рогоффа цитировался в выступлениях Конгресса, отчетах Европейской комиссии и аналитических записках МВФ. Ошибка Excel (строки 30–34 были исключены из формулы СРЗНАЧ) означала, что пять стран — Австралия, Австрия, Бельгия, Канада и Дания — просто отсутствовали.
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    Скорректированное среднее значение изменилось с -0,1% до +2,2%. Политика жесткой экономии затронула миллионы людей. Воспроизводимость — это не академический перфекционизм, это гарантия от катастрофы.
                  </p>
</div>
</div>
</div>
<!-- Callback -->
<div class="slide dark" data-index="7">
<div class="content" style="text-align: center;">
<p class="animate" style="font-size: 1.1rem; opacity: 0.7;">Remember Module 5?</p>
<p class="title gold animate delay-1">DECREASE Through the Lens of Reproducibility</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="max-width: 600px; font-size: 1.05rem;">
                  Исследования DECREASE, проведенные Доном Полдермансом, были отозваны из-за сфабрикованных данных. Если бы существовали подтверждающие числа — хешированные входные данные, цепочки происхождения, проверенные вычисления — фальсификацию можно было бы обнаружить. <em>before</em> доказательства вошли в метаанализ и изменили хирургические рекомендации.
                </p>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Module 22 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> В чем заключалась ошибка Рейнхарта-Рогоффа?</p>
<div class="quiz-options" id="m22-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 0, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
<span>A.</span> They used too small a sample
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 1, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
<span>B.</span> An Excel formula excluded 5 countries, reversing the conclusion
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 2, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
<span>C.</span> They studied the wrong time period
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 3, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
<span>D.</span> They used the wrong statistical test
                    </div>
</div>
<div id="m22-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="9">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 22 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  «Число без происхождения — это не число. Анализ без воспроизводимости не является доказательством».
                </p>
</div>
</div>
<div class="slide black" data-index="10">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 23: Ваш первый мета-спринт</p>
</div>
</div>
 Модуль 23: Capstone – ваш первый мета-спринт 
<div class="module-slides" data-module="23">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 23: Ваш первый мета-спринт</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Модуль 23: Ваш первый мета-спринт</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Понять рабочий процесс 40-дневной систематической проверки</li>
<li>Map the Seven Principles to real practice phases</li>
<li>Recognize Definition-of-Done (DoD) gates as quality checkpoints</li>
<li>Appreciate why structure prevents the failures you've studied</li>
<li>Graduate ready to conduct (not just understand) meta-analysis</li>
</ul>
</div>
</div>
</div>
 Путешествие завершено 
<div class="slide dark" data-index="2">
<p class="title cream animate">Вы выучили истории.</p>
<p class="title gold animate delay-1">Теперь вы должны пройти этот путь.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                Каждое изменение доказательств, которое вы изучали, произошло потому, что команды <em>knew</em> методы, но не <em>follow</em> them systematically.
              </p>
</div>
 Структура МЕТА-СПРИНТ 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Структура МЕТА-СПРИНТ</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  40-дневный структурированный рабочий процесс с 5 фазовыми воротами. Каждый шлюз представляет собой контрольную точку определения готовности (DoD), которая не позволяет вам двигаться вперед до тех пор, пока не будет гарантировано качество.
                </p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">40</div>
<div class="stat-label">Days to Completion</div>
</div>
<div class="stat-box">
<div class="stat-value">5</div>
<div class="stat-label">DoD Phase Gates</div>
</div>
<div class="stat-box">
<div class="stat-value">Day 34</div>
<div class="stat-label">Hard Freeze</div>
</div>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; background: rgba(212,175,55,0.1); border: 1px solid var(--gold);">
<p class="card-text" style="font-size: 0.9rem;">
<strong style="color: var(--gold);">Why 40 days?</strong> Достаточно длинный для строгости и достаточно короткий, чтобы предотвратить расползание прицела. Сердечные сигналы росиглитазона были скрыты на долгие годы, потому что не было крайнего срока, требующего прозрачности.
                  </p>
</div>
</div>
</div>
 Пять ворот 
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Пять фазовых врат</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #7C3AED;">A</div>
<div class="lesson-content">
<h4>DoD-A: Protocol Lock (Days 1-3)</h4>
<p>PICOS defined, timepoint rules set, model choices pre-specified. <em>No moving target.</em></p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #2563EB;">B</div>
<div class="lesson-content">
<h4>DoD-B: Search Lock (Days 6-10)</h4>
<p>All databases searched, grey literature checked, PRESS validated. <em>No hidden studies.</em></p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #D97706;">C</div>
<div class="lesson-content">
<h4>DoD-C: Extraction Lock (Days 10-28)</h4>
<p>Dual extraction, provenance linked, RoB assessed. <em>No fabricated numbers.</em></p>
</div>
</div>
</div>
</div>
<!-- Gates continued -->
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">The Five Phase Gates (continued)</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #059669;">D</div>
<div class="lesson-content">
<h4>DoD-D: Блокировка анализа (дни 21–33)</h4>
<p>Forest plots generated, sensitivity analyses run, heterogeneity explored. <em>No cherry-picking.</em></p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #DC2626;">E</div>
<div class="lesson-content">
<h4>DoD-E: Submission Lock (Days 33-40)</h4>
<p>GRADE certainty rated, clinical summary written, manuscript finalized. <em>No overconfidence.</em></p>
</div>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; background: rgba(220,38,38,0.1); border: 1px solid #DC2626;">
<p class="card-text" style="font-size: 0.9rem;">
<strong style="color: #DC2626;">Day 34 Freeze:</strong> Никакие новые исследования не могут быть добавлены после 34-го дня. Это предотвращает «расползание масштабов применения оружия», которое преследовало метаанализы метаанализа хирургии позвоночника BMP, где промышленность продолжала «находить» благоприятные исследования.
                  </p>
</div>
</div>
</div>
<!-- Seven Principles Mapped to Practice -->
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">Семь принципов на практике</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Every principle you learned maps to a specific phase gate:
                </p>
<div class="animate delay-2" style="display: grid; gap: 0.5rem; font-size: 0.85rem;">
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(124,58,237,0.1); border-radius: 6px;">
<span style="color: #7C3AED; font-weight: 700; min-width: 40px;">DoD-A</span>
<span>"<em>Не каждый сигнал является правдой</em>" — Предварительно укажите, что считать доказательством</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(37,99,235,0.1); border-radius: 6px;">
<span style="color: #2563EB; font-weight: 700; min-width: 40px;">DoD-B</span>
<span>"<em>What was hidden in plain sight?</em>" — Search comprehensively</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(217,119,6,0.1); border-radius: 6px;">
<span style="color: #D97706; font-weight: 700; min-width: 40px;">DoD-C</span>
<span>"<em>Число без происхождения — не число.</em>" — Свяжите каждую точку данных</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(5,150,105,0.1); border-radius: 6px;">
<span style="color: #059669; font-weight: 700; min-width: 40px;">DoD-D</span>
<span>"<em>Гетерогенность — это сообщение, а не шум</em>" — Investigate, don't ignore</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(220,38,38,0.1); border-radius: 6px;">
<span style="color: #DC2626; font-weight: 700; min-width: 40px;">DoD-E</span>
<span>"<em>Certainty must be earned, not assumed</em>" — GRADE everything</span>
</div>
</div>
</div>
</div>
<!-- Red-Team Adversarial QA -->
<div class="slide dark" data-index="7">
<p class="title cream animate">Принцип красной команды</p>
<p class="title gold animate delay-1">Ваша собственная команда пытается разрушить вашу работу.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1rem; text-align: center; max-width: 650px;">
                Каждый день два сменяющихся члена команды тратят 12 минут на проверку качества данных в качестве противников. Именно так мошенничество Болдта было обнаружено – не путем дружеской проверки, а путем скептической проверки, которая выявила невозможные показатели набора персонала.
              </p>
</div>
<!-- CondGO Emergency Protocol -->
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">CondGO: When Things Go Wrong</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  What happens when you discover a critical problem mid-sprint?
                </p>
<div class="card animate delay-2" style="background: rgba(217,119,6,0.1); border: 1px solid #D97706;">
<h4 style="color: #D97706;">CondGO = Conditional Go</h4>
<p class="card-text" style="font-size: 0.9rem;">
                    A bounded rescue protocol. You have exactly <strong>72 hours</strong> устранить проблему, используя только разрешенные действия. Если вы не можете это исправить, вы должны остановить проверку.
                  </p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem;">
<p class="card-text" style="font-size: 0.85rem; font-style: italic;">
                    📖 <strong>Урок Авандии:</strong> GSK увидела сердечно-сосудистые сигналы в 2000 году, но не установила крайних сроков. Они «смотрели и ждали» 7 лет. Десятки тысяч пострадали. CondGO существует потому, что фраза «в конце концов мы с этим разберемся» убивает людей.
                  </p>
</div>
</div>
</div>
<!-- Your Graduation -->
<div class="slide dark" data-index="9">
<p class="title cream animate">Вы начали этот курс с историй.</p>
<p class="title gold animate delay-1">Вы заканчиваете его готовым к практике.</p>
<div class="gold-line animate delay-2"></div>
<div class="animate delay-3" style="text-align: center; max-width: 600px;">
<p style="font-size: 1rem; margin-bottom: 1rem;">
                  Рабочий процесс МЕТА-СПРИНТ объединяет все, чему вы научились, и структурирует это в 40-дневную систему, которая предотвращает неудачи, которые вы изучили.
                </p>
<p style="font-size: 0.9rem; opacity: 0.9;">
                  Когда вы будете готовы провести настоящий систематический обзор, откройте приложение МЕТА-СПРИНТ. Истории, которые вы узнали здесь, будут вашим руководством — они будут напоминать вам на каждом этапе.
                </p>
</div>
</div>
 ИСТОРИЯ: Сотрудничество CTT — когда методы экономят миллионы 
<div class="slide dark" data-index="9b">
<div class="story-box animate">
<p class="story-opener">What does it look like when every principle is followed?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    Сотрудничество специалистов по лечению холестерина (CTT) является золотым стандартом метаанализа. Они получили <span class="data-highlight">индивидуальные данные пациентов от более чем 170 000 участников</span>
                    across <span class="data-highlight">26 statin trials</span>.
                    Pre-specified protocol. IPD from all major trials. Standardized outcomes.
                    Result: statins reduce <span class="data-highlight">major vascular events by 21% per mmol/L LDL reduction</span>
                    (RR 0.79, 95% CI 0.77-0.81), regardless of baseline risk.
                    This finding, replicated across <span class="data-highlight">5 метаанализов за 15 лет</span>,
                    has prevented an estimated <span class="data-highlight">millions of heart attacks and strokes worldwide</span>.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Применение семи принципов</div>
<div class="decision-scenario">
                    История СТТ показывает, что происходит, когда соблюдаются все принципы этого курса. Рассмотрим альтернативу:
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">ПУТЬ А: Без принципов</div>
<div class="path-choice">No protocol. Published data only. No RoB. No heterogeneity investigation. No GRADE.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Conflicting small trials. Statin controversy persists. Millions untreated.</div>
<div class="path-outcome">OUTCOME: Preventable cardiovascular deaths continue</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">ПУТЬ Б: Путь СТТ</div>
<div class="path-choice">Предварительно зарегистрированный протокол. IPD из всех испытаний. Стандартизированные результаты. Прозрачные методы. Сорт Высокая уверенность.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Окончательный ответ. Глобальные рекомендации меняются. Статины назначают тем, кому это полезно.</div>
<div class="path-outcome">OUTCOME: Millions of lives saved by rigorous evidence synthesis</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    Каждый принцип в этом курсе существует потому, что его отсутствие причинило вред. Сотрудничество CTT доказывает, что когда методы строгие, когда данные имеют происхождение, когда оценивается предвзятость и достигается уверенность, метаанализ становится самым мощным инструментом в медицине. Теперь вы несете эти принципы. Используйте их.
                  </div>
</div>
</div>
</div>
<!-- Capstone Quiz -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Capstone Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q13-1">
<h4>1. Какова цель «жесткой заморозки» Дня 34 в МЕТА-СПРИНТ?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 0, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">А. Предоставить время для экспертной оценки</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 1, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">B. Чтобы предотвратить манипулирование результатами поздно добавленных исследований.</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 2, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">C. To speed up publication</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 3, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">D. Координировать сроки выполнения журнала</div>
</div>
<div class="quiz-feedback" id="q13-1-feedback"></div>
</div>
<div class="quiz-question" id="q13-2" style="margin-top: 1.5rem;">
<h4>2. The CondGO protocol gives teams how long to fix critical problems?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 0, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">A. 24 hours</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 1, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">B. 48 hours</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 2, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">C. 72 hours</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 3, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">D. 1 week</div>
</div>
<div class="quiz-feedback" id="q13-2-feedback"></div>
</div>
<div class="quiz-question" id="q13-3" style="margin-top: 1.5rem;">
<h4>3. Red-team adversarial QA caught Joachim Boldt's fraud by noticing:</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 0, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">A. Impossible patient recruitment rates</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 1, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">B. p-hacking in statistical tests</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 2, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">C. Inconsistent effect sizes</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 3, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">D. Whistleblower testimony</div>
</div>
<div class="quiz-feedback" id="q13-3-feedback"></div>
</div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide black" data-index="11">
<div class="animate" style="text-align: center;">
<p class="refrain">Истории, которые вы узнали, не являются историей.</p>
<p style="font-size: 1.2rem; margin-top: 1rem; color: var(--gold);">Это предупреждения, которые охраняют вашу будущую работу.</p>
<div class="gold-line" style="margin: 1.5rem auto;"></div>
<p style="font-size: 1rem; margin-top: 1.5rem; opacity: 0.9;">
                  Когда вы проводите свой первый метаанализ,<br/>
                  remember CAST before you trust a signal,<br/>
                  remember Poldermans before you skip provenance,<br/>
                  помните о ребоксетине, прежде чем игнорировать воронку.
                </p>
<p style="font-size: 0.9rem; margin-top: 1.5rem; font-style: italic; opacity: 0.8;">
                  Теперь вы готовы. Следуйте структуре. Идите со смирением. Следуйте семи принципам.
                </p>
</div>
</div>
<div class="slide black" data-index="12">
<p class="refrain animate">Не каждый сигнал является правдой.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Модуль 24: Заключительный экзамен</p>
</div>
</div>
<!-- Module 24: Final Exam (Summative Assessment) -->
<div class="module-slides" data-module="24">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Final Examination</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Final Exam: Part 1 of 2</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1.5rem;">
                  Проверьте свое владение принципами метаанализа. Каждый вопрос затрагивает основную концепцию курса.
                </p>
<!-- Q1: PICO -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q1.</strong> Исследователь хочет изучить «влияние физических упражнений на здоровье». В чем ОСНОВНАЯ проблема этого исследовательского вопроса?</p>
<div class="quiz-options" id="final-q1">
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 0, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>A.</span> It lacks randomization
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 1, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>B.</span> Sample size is too small
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 2, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>C.</span> It is not answerable—lacks specific PICO elements
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 3, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>D.</span> It lacks ethical approval
                    </div>
</div>
<div id="final-q1-feedback" style="display: none;"></div>
</div>
<!-- Q2: Publication Bias -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q2.</strong> Воронкообразный график показывает выраженную асимметрию с отсутствующими исследованиями в нижней левой области. О чем это говорит?</p>
<div class="quiz-options" id="final-q2">
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 0, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>A.</span> Large studies have more precise estimates
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 1, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>B.</span> Небольшие отрицательные исследования, вероятно, неопубликованы
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 2, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>C.</span> The true effect is stronger than estimated
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 3, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>D.</span> Random sampling error
                    </div>
</div>
<div id="final-q2-feedback" style="display: none;"></div>
</div>
<!-- Q3: Heterogeneity -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q3.</strong> Метаанализ сообщает, что I² = 85% и τ² = 0,42. Какова САМАЯ подходящая интерпретация?</p>
<div class="quiz-options" id="final-q3">
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 0, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>A.</span> There is an 85% chance of a true effect
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 1, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>B.</span> The effect size is very large
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 2, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>C.</span> Substantial between-study variance exists; investigate sources
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 3, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>D.</span> Результаты клинически важны
                    </div>
</div>
<div id="final-q3-feedback" style="display: none;"></div>
</div>
<!-- Q4: GRADE -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q4.</strong> В GRADE какова начальная достоверность совокупности доказательств рандомизированных контролируемых исследований?</p>
<div class="quiz-options" id="final-q4">
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 0, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>A.</span> High
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 1, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>B.</span> Moderate
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 2, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>C.</span> Low
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 3, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>D.</span> Very low
                    </div>
</div>
<div id="final-q4-feedback" style="display: none;"></div>
</div>
<!-- Q5: Risk of Bias -->
<div class="quiz-box animate delay-2">
<p class="quiz-question"><strong>Q5.</strong> In RoB 2.0, which domain assesses whether outcome assessors knew the treatment allocation?</p>
<div class="quiz-options" id="final-q5">
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 0, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>A.</span> D1: Randomization process
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 1, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>B.</span> D2: Отклонения от намеченных вмешательств
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 2, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>C.</span> D3: Отсутствующий результат данные
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 3, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>D.</span> D4: Измерение результата
                    </div>
</div>
<div id="final-q5-feedback" style="display: none;"></div>
</div>
</div>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Final Exam: Part 2 of 2</h2>
<!-- Q6: Evidence Reversal -->
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q6.</strong> Исследование CAST показало, что антиаритмические препараты повышают смертность, несмотря на подавление аритмий. Это пример:</p>
<div class="quiz-options" id="final-q6">
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 0, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>A.</span> Random sampling error
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 1, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>B.</span> Surrogate outcome failure
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 2, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>C.</span> Confounding by indication
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 3, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>D.</span> Reverse causation
                    </div>
</div>
<div id="final-q6-feedback" style="display: none;"></div>
</div>
<!-- Q7: Fixed vs Random Effects -->
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q7.</strong> When should a random-effects model be preferred over a fixed-effect model?</p>
<div class="quiz-options" id="final-q7">
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 0, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>A.</span> When sample sizes are large
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 1, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>B.</span> Когда исходы бинарные
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 2, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>C.</span> When between-study heterogeneity is expected
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 3, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>D.</span> When publication bias is suspected
                    </div>
</div>
<div id="final-q7-feedback" style="display: none;"></div>
</div>
<!-- Q8: ICEMAN -->
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q8.</strong> According to ICEMAN criteria, which makes a subgroup analysis MORE credible?</p>
<div class="quiz-options" id="final-q8">
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 0, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>A.</span> Hypothesis specified a priori
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 1, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>B.</span> Large number of subgroups tested
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 2, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>C.</span> No biological rationale
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 3, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>D.</span> Inconsistent effects across trials within subgroup
                    </div>
</div>
<div id="final-q8-feedback" style="display: none;"></div>
</div>
<!-- Q9: Network Meta-Analysis -->
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q9.</strong> What assumption must be checked in network meta-analysis to ensure valid indirect comparisons?</p>
<div class="quiz-options" id="final-q9">
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 0, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>A.</span> All studies have equal sample sizes
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 1, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>B.</span> Все исследования измеряют один и тот же исход
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 2, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>C.</span> Transitivity (consistency of effect modifiers)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 3, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>D.</span> Double-blinding in all trials
                    </div>
</div>
<div id="final-q9-feedback" style="display: none;"></div>
</div>
<!-- Q10: TSA -->
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q10.</strong> В последовательном анализе испытаний (TSA), что означает пересечение границы бесполезности?</p>
<div class="quiz-options" id="final-q10">
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 0, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>A.</span> Возможность лечения вред
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 1, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>B.</span> Дальнейшие исследования вряд ли покажут значимый эффект
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 2, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>C.</span> Доказательства убедительны в пользу пользы
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 3, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>D.</span> Метаанализ недостаточен
                    </div>
</div>
<div id="final-q10-feedback" style="display: none;"></div>
</div>
<div class="animate delay-2" style="margin-top: 2rem; padding: 1.5rem; background: rgba(212,175,55,0.1); border-radius: 8px; border-left: 4px solid var(--gold);">
<p style="font-weight: 600; color: var(--navy);">Part 1 Complete — continue to Part 2 (Advanced Modules)</p>
</div>
</div>
</div>
 Часть 2: Вопросы для расширенного модуля (Q11-Q25) 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Final Exam: Part 2 of 2 (Advanced)</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1.5rem;">
                  Questions 11–25 cover Modules 13–22 (Bayesian, NMA, IPD, Dose-Response, Fragility, Equity, AI, Qualitative, Multivariate, Reproducibility).
                </p>
<!-- Q11: Bayesian -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q11.</strong> Что происходит в байесовском метаанализе, если во многих исследованиях вы используете расплывчатое априорное значение?</p>
<div class="quiz-options" id="final-q11">
<div class="quiz-option" onclick="checkQuizAnswer('final-q11', 0, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
<span>A.</span> Апостериорное значение близко соответствует частотному результату
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q11', 1, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
<span>B.</span> Априорное значение доминирует над апостериорным
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q11', 2, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
<span>C.</span> The credible interval becomes infinitely wide
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q11', 3, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
<span>D.</span> Модель не может сходятся
                    </div>
</div>
<div id="final-q11-feedback" style="display: none;"></div>
</div>
<!-- Q12: NMA -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q12.</strong> Почему в антидепрессанте NMA Чиприани ни один препарат не был объявлен «победителем»?</p>
<div class="quiz-options" id="final-q12">
<div class="quiz-option" onclick="checkQuizAnswer('final-q12', 0, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
<span>A.</span> Слишком мало исследований
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q12', 1, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
<span>B.</span> Different drugs ranked best on different outcomes
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q12', 2, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
<span>C.</span> Непрямых доказательств не было
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q12', 3, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
<span>D.</span> SUCRA не может быть рассчитанный
                    </div>
</div>
<div id="final-q12-feedback" style="display: none;"></div>
</div>
<!-- Q13: IPD -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q13.</strong> Почему никогда не следует объединять IPD, как если бы это было одно мегаисследование?</p>
<div class="quiz-options" id="final-q13">
<div class="quiz-option" onclick="checkQuizAnswer('final-q13', 0, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
<span>A.</span> IPD always has fewer studies than aggregate
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q13', 1, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
<span>B.</span> Оно игнорирует кластеризацию исследований и вносит искажения
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q13', 2, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
<span>C.</span> Он не может обрабатывать данные о времени до события
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q13', 3, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
<span>D.</span> Binary outcomes cannot be pooled
                    </div>
</div>
<div id="final-q13-feedback" style="display: none;"></div>
</div>
<!-- Q14: Dose-response -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q14.</strong> What caused the alcohol "J-curve" to disappear in Stockwell's reanalysis?</p>
<div class="quiz-options" id="final-q14">
<div class="quiz-option" onclick="checkQuizAnswer('final-q14', 0, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
<span>A.</span> Были добавлены новые исследования, которые не показали отсутствия польза
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q14', 1, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
<span>B.</span> Бывшие пьющие были корректно исключены из референтной группы трезвенников
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q14', 2, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
<span>C.</span> Размер выборки был увеличен
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q14', 3, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
<span>D.</span> Лучшая корректировка для искажающих факторов
                    </div>
</div>
<div id="final-q14-feedback" style="display: none;"></div>
</div>
<!-- Q15: Fragility -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q15.</strong> Что Кокрейн обнаружил в саге об осельтамивире при доступе к неопубликованным клиническим данным отчеты об исследованиях?</p>
<div class="quiz-options" id="final-q15">
<div class="quiz-option" onclick="checkQuizAnswer('final-q15', 0, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
<span>A.</span> Препарат оказался совершенно неэффективен.
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q15', 1, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
<span>B.</span> Эффект оказался сильнее, чем предполагалось изначально
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q15', 2, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
<span>C.</span> Польза от осложнений в значительной степени исчезла
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q15', 3, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
<span>D.</span> Side effects were more common than reported
                    </div>
</div>
<div id="final-q15-feedback" style="display: none;"></div>
</div>
<!-- Q16: Equity -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q16.</strong> Какой процент пациентов с гипертонической болезнью в США НЕ смог бы участвовать в исследовании SPRINT?</p>
<div class="quiz-options" id="final-q16">
<div class="quiz-option" onclick="checkQuizAnswer('final-q16', 0, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
<span>A.</span> About 25%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q16', 1, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
<span>B.</span> About 50%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q16', 2, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
<span>C.</span> Over 75%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q16', 3, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
<span>D.</span> Nearly 100%
                    </div>
</div>
<div id="final-q16-feedback" style="display: none;"></div>
</div>
<!-- Q17: AI -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q17.</strong> Why is AI considered an "augmenter" rather than a "replacer" in systematic reviews?</p>
<div class="quiz-options" id="final-q17">
<div class="quiz-option" onclick="checkQuizAnswer('final-q17', 0, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
<span>A.</span> AI is slower than human reviewers
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q17', 1, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
<span>B.</span> AI has perfect recall
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q17', 2, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
<span>C.</span> AI screens fast but cannot make human-level contextual judgments
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q17', 3, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
<span>D.</span> AI is too expensive for most reviews
                    </div>
</div>
<div id="final-q17-feedback" style="display: none;"></div>
</div>
<!-- Q18: Qualitative -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q18.</strong> What does the "adequacy" component of CERQual assess?</p>
<div class="quiz-options" id="final-q18">
<div class="quiz-option" onclick="checkQuizAnswer('final-q18', 0, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
<span>A.</span> Только количество исследований
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q18', 1, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
<span>B.</span> Богатство и количество данных, подтверждающих этот вывод
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q18', 2, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
<span>C.</span> Согласованность результатов разных исследований
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q18', 3, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
<span>D.</span> Generalizability to other populations
                    </div>
</div>
<div id="final-q18-feedback" style="display: none;"></div>
</div>
<!-- Q19: Multivariate -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q19.</strong> A meta-analysis includes 30 statin trials, each reporting 4 correlated outcomes (120 effect sizes). Which approach is correct?</p>
<div class="quiz-options" id="final-q19">
<div class="quiz-option" onclick="checkQuizAnswer('final-q19', 0, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
<span>A.</span> Treat all 120 as independent effect sizes
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q19', 1, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
<span>B.</span> Use RVE with small-sample correction
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q19', 2, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
<span>C.</span> Pick only one outcome per study
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q19', 3, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
<span>D.</span> Усредните 4 результата в каждом исследовании
                    </div>
</div>
<div id="final-q19-feedback" style="display: none;"></div>
</div>
<!-- Q20: Reproducibility -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q20.</strong> Каким был скорректированный средний темп роста в странах с высоким долгом, согласно ошибке Рейнхарта-Рогоффа?</p>
<div class="quiz-options" id="final-q20">
<div class="quiz-option" onclick="checkQuizAnswer('final-q20', 0, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
<span>A.</span> −0.1% (same as claimed)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q20', 1, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
<span>B.</span> +2.2%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q20', 2, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
<span>C.</span> 0%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q20', 3, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
<span>D.</span> +5%
                    </div>
</div>
<div id="final-q20-feedback" style="display: none;"></div>
</div>
<div class="animate delay-2" style="margin-top: 2rem; padding: 1.5rem; background: rgba(212,175,55,0.1); border-radius: 8px; border-left: 4px solid var(--gold);">
<p style="font-weight: 600; color: var(--navy);">Passing Score: 15/20 across both parts</p>
<p style="margin-top: 0.5rem; color: var(--light-text);">
                    Просмотрите все пропущенные вопросы, вернувшись к соответствующему модулю. Каждый вопрос проверяет основную концепцию.
                  </p>
</div>
</div>
</div>
<div class="slide black" data-index="4">
<div class="animate" style="text-align: center;">
<p class="refrain">Не каждый сигнал является правдой.</p>
<p style="font-size: 1.1rem; margin-top: 1rem;">Методы защищают пациентов от нашего доверия.</p>
<div class="gold-line" style="margin: 1.5rem auto;"></div>
<p style="font-size: 1.5rem; color: var(--gold); margin-top: 1.5rem;">
                  Congratulations
                </p>
<p style="font-size: 1.1rem; margin-top: 1rem;">
                  Вы прошли «Обращение доказательств: курс метаанализа».
                </p>
<p style="font-size: 1rem; margin-top: 1rem; opacity: 0.9;">
                  Пусть ваш синтез направляется истиной, ваше объединение — мудростью,<br/>
                  и ваши выводы по смирению.
                </p>
<div style="margin-top: 2rem; font-size: 0.9rem; opacity: 0.8;">
<p style="margin-bottom: 0.5rem;"><strong>Семь принципов:</strong></p>
<p>«Не каждый сигнал является правдой».</p>
<p>«Методы защищают пациентов от нашего доверия».</p>
<p>"What was hidden in plain sight?"</p>
<p>«Число без происхождения — не число».</p>
<p>«Неоднородность — это сообщение, а не шум».</p>
<p>«Отсутствие доказательств не является доказательством отсутствия».</p>
<p>"Certainty must be earned, not assumed."</p>
</div>
<p style="font-size: 0.9rem; margin-top: 2rem; font-style: italic; opacity: 0.7;">
                  «Наставь нас на прямой путь…»
                </p>
</div>
</div>
</div>
<!-- Slide Navigation - minimal floating arrows -->
<nav class="slide-nav" id="slideNav">
<button class="nav-btn" id="prevBtn" onclick="prevSlide()" title="Previous (←)">←</button>
<div class="nav-center">
<div class="progress" id="progress"></div>
<span class="slide-counter" id="counter">1 / 10</span>
</div>
<button class="nav-btn" id="nextBtn" onclick="nextSlide()" title="Next (→)">→</button>
</nav>
</div>
<!-- Tools Panel -->
<aside class="tools-panel" id="toolsPanel">
<div class="tools-header">
<h3>Interactive Tools</h3>
<button class="btn" onclick="toggleToolsPanel()" style="padding: 0.25rem 0.5rem;">×</button>
</div>
<div class="tools-content">
 Панель данных Live Story 
<div class="story-data-panel" id="storyDataPanel">
<h4><span style="font-size: 1.1rem;">📊</span> Данные живой истории</h4>
<div id="storyDataContent">
<div class="no-story-data">
                  Перейдите к модулю, чтобы просмотреть данные его фактических данных с интерактивным сравнением до и после.
                </div>
</div>
</div>
<!-- Effect Size Calculator -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Effect Size Calculator <span>▼</span>
</div>
<div class="tool-section-body">
<div class="form-group">
<label>Effect Type</label>
<select id="effectType">
<option value="OR">Odds Ratio (OR)</option>
<option value="RR">Risk Ratio (RR)</option>
<option value="RD">Risk Difference (RD)</option>
<option value="SMD">Standardized Mean Difference</option>
<option value="MD">Mean Difference</option>
</select>
</div>
<div id="binaryInputs">
<div class="form-group">
<label>Treatment: Events / Total</label>
<div style="display: flex; gap: 0.5rem;">
<input id="eventsTx" placeholder="Events" style="flex:1" type="number"/>
<input id="nTx" placeholder="Total" style="flex:1" type="number"/>
</div>
</div>
<div class="form-group">
<label>Control: Events / Total</label>
<div style="display: flex; gap: 0.5rem;">
<input id="eventsCtrl" placeholder="Events" style="flex:1" type="number"/>
<input id="nCtrl" placeholder="Total" style="flex:1" type="number"/>
</div>
</div>
</div>
<button class="btn-small primary" onclick="calculateEffectSize()">Calculate</button>
<div class="results-display" id="effectResults" style="display: none;"></div>
</div>
</div>
<!-- Meta-Analysis Calculator -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Meta-Analysis Calculator <span>▼</span>
</div>
<div class="tool-section-body">
<div class="form-group">
<label>Enter Studies (Effect, CI Low, CI High)</label>
<table class="study-table" id="studyTable">
<thead>
<tr>
<th>Study</th>
<th>Effect</th>
<th>CI Lo</th>
<th>CI Hi</th>
<th></th>
</tr>
</thead>
<tbody id="studyTableBody">
<tr>
<td><input type="text" value="Study 1"/></td>
<td><input step="0.01" type="number" value="1.25"/></td>
<td><input step="0.01" type="number" value="0.95"/></td>
<td><input step="0.01" type="number" value="1.64"/></td>
<td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
</tr>
<tr>
<td><input type="text" value="Study 2"/></td>
<td><input step="0.01" type="number" value="1.42"/></td>
<td><input step="0.01" type="number" value="1.10"/></td>
<td><input step="0.01" type="number" value="1.83"/></td>
<td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
</tr>
<tr>
<td><input type="text" value="Study 3"/></td>
<td><input step="0.01" type="number" value="0.98"/></td>
<td><input step="0.01" type="number" value="0.72"/></td>
<td><input step="0.01" type="number" value="1.33"/></td>
<td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
</tr>
</tbody>
</table>
<button class="btn-small" onclick="addStudyRow()">+ Add Study</button>
</div>
<div class="form-group">
<label>Tau² Estimator</label>
<select id="tau2Method">
<option value="DL">DerSimonian-Laird (DL)</option>
<option value="REML">REML</option>
<option value="PM">Paule-Mandel (PM)</option>
<option value="SJ">Sidik-Jonkman (SJ)</option>
<option value="HE">Hedges (HE)</option>
<option value="EB">Empirical Bayes (EB)</option>
<option value="ML">Maximum Likelihood (ML)</option>
<option value="HS">Hunter-Schmidt (HS)</option>
</select>
</div>
<div class="form-group">
<label>
<input checked="" id="useHKSJ" type="checkbox"/> Use HKSJ Adjustment
                  </label>
</div>
<button class="btn-small primary" onclick="runMetaAnalysis()">Run Analysis</button>
<div class="results-display" id="maResults" style="display: none;"></div>
<div class="forest-plot-container" id="forestPlotContainer" style="display: none;"></div>
</div>
</div>
<!-- PICO Builder -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                PICO Builder <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>Population</label>
<input id="picoP" placeholder="например, взрослые с диабетом 2 типа" type="text"/>
</div>
<div class="form-group">
<label>Intervention</label>
<input id="picoI" placeholder="e.g., SGLT2 inhibitors" type="text"/>
</div>
<div class="form-group">
<label>Comparator</label>
<input id="picoC" placeholder="e.g., Placebo or standard care" type="text"/>
</div>
<div class="form-group">
<label>Outcome</label>
<input id="picoO" placeholder="e.g., All-cause mortality" type="text"/>
</div>
<button class="btn-small primary" onclick="generatePICO()">Generate Question</button>
<div id="picoOutput" style="margin-top: 1rem; padding: 0.75rem; background: #f7fafc; border-radius: 4px; display: none;"></div>
</div>
</div>
<!-- Publication Bias Assessment -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Publication Bias <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  Использует данные из калькулятора метаанализа выше.
                </p>
<button class="btn-small primary" onclick="runPublicationBias()">Assess Publication Bias</button>
<div id="pubBiasResults" style="display: none; margin-top: 1rem;">
<div class="results-display" id="eggerResults"></div>
<div class="forest-plot-container" id="funnelPlotContainer" style="margin-top: 0.5rem;"></div>
</div>
</div>
</div>
<!-- Risk of Bias 2.0 -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Risk of Bias 2.0 <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>Study Name</label>
<input id="robStudyName" placeholder="e.g., Smith 2020" type="text"/>
</div>
<div class="rob-domains">
<div class="rob-domain">
<label>D1: Randomization</label>
<select id="robD1" onchange="updateRoBOverall()">
<option value="">Select...</option>
<option value="low">Low risk</option>
<option value="some">Some concerns</option>
<option value="high">High risk</option>
</select>
</div>
<div class="rob-domain">
<label>D2: Отклонения от вмешательства</label>
<select id="robD2" onchange="updateRoBOverall()">
<option value="">Select...</option>
<option value="low">Low risk</option>
<option value="some">Some concerns</option>
<option value="high">High risk</option>
</select>
</div>
<div class="rob-domain">
<label>D3: Отсутствующий результат данные</label>
<select id="robD3" onchange="updateRoBOverall()">
<option value="">Select...</option>
<option value="low">Low risk</option>
<option value="some">Some concerns</option>
<option value="high">High risk</option>
</select>
</div>
<div class="rob-domain">
<label>D4: Outcome measurement</label>
<select id="robD4" onchange="updateRoBOverall()">
<option value="">Select...</option>
<option value="low">Low risk</option>
<option value="some">Some concerns</option>
<option value="high">High risk</option>
</select>
</div>
<div class="rob-domain">
<label>D5: Selection of reported result</label>
<select id="robD5" onchange="updateRoBOverall()">
<option value="">Select...</option>
<option value="low">Low risk</option>
<option value="some">Some concerns</option>
<option value="high">High risk</option>
</select>
</div>
</div>
<div id="robOverall" style="margin-top: 1rem; padding: 0.75rem; border-radius: 6px; text-align: center; font-weight: 600;"></div>
<div id="robTrafficLight" style="margin-top: 0.5rem;"></div>
</div>
</div>
<!-- GRADE Assessment -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                GRADE Certainty <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>Starting certainty</label>
<select id="gradeStart">
<option value="4">High (RCTs)</option>
<option value="2">Low (Observational)</option>
</select>
</div>
<p style="font-size: 0.7rem; font-weight: 600; color: var(--navy); margin: 0.75rem 0 0.25rem;">Downgrade factors:</p>
<div class="grade-factors">
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeRoB" style="width: 100px;">
<option value="0">None</option>
<option value="-1">Serious (-1)</option>
<option value="-2">Very serious (-2)</option>
</select>
                      Risk of Bias
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeInconsistency" style="width: 100px;">
<option value="0">None</option>
<option value="-1">Serious (-1)</option>
<option value="-2">Very serious (-2)</option>
</select>
                      Inconsistency
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeIndirectness" style="width: 100px;">
<option value="0">None</option>
<option value="-1">Serious (-1)</option>
<option value="-2">Very serious (-2)</option>
</select>
                      Indirectness
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeImprecision" style="width: 100px;">
<option value="0">None</option>
<option value="-1">Serious (-1)</option>
<option value="-2">Very serious (-2)</option>
</select>
                      Imprecision
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradePubBias" style="width: 100px;">
<option value="0">None</option>
<option value="-1">Serious (-1)</option>
<option value="-2">Very serious (-2)</option>
</select>
                      Publication Bias
                    </label>
</div>
</div>
<button class="btn-small primary" onclick="calculateGRADE()" style="margin-top: 0.5rem;">Calculate Certainty</button>
<div id="gradeResult" style="margin-top: 1rem;"></div>
</div>
</div>
<!-- I² Interpretation -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Heterogeneity Guide <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>Enter I² value (%)</label>
<input id="i2Input" max="100" min="0" placeholder="e.g., 75" type="number"/>
</div>
<button class="btn-small primary" onclick="interpretI2()">Interpret</button>
<div id="i2Interpretation" style="margin-top: 1rem;"></div>
<div style="margin-top: 1rem; padding: 0.75rem; background: #f7fafc; border-radius: 6px; font-size: 0.75rem;">
<p style="font-weight: 600; margin-bottom: 0.5rem;">Cochrane Guidelines:</p>
<p>0–40 %: может быть неважно.</p>
<p>30-60%: Moderate heterogeneity</p>
<p>50-90%: Substantial heterogeneity</p>
<p>75-100%: Considerable heterogeneity</p>
<p style="margin-top: 0.5rem; font-style: italic; color: var(--light-text);">
                    «Неоднородность — это сообщение, а не шум».
                  </p>
</div>
</div>
</div>
<!-- NNT/NNH Calculator -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                NNT/NNH Calculator <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  Convert effect sizes to Numbers Needed to Treat/Harm
                </p>
<div class="form-group">
<label>Baseline Risk (Control Event Rate)</label>
<input id="nntCER" max="1" min="0" placeholder="e.g., 0.15 for 15%" step="0.01" type="number"/>
</div>
<div class="form-group">
<label>Effect Measure</label>
<select id="nntEffectType">
<option value="RR">Risk Ratio (RR)</option>
<option value="OR">Odds Ratio (OR)</option>
<option value="RD">Risk Difference (RD)</option>
</select>
</div>
<div class="form-group">
<label>Effect Size</label>
<input id="nntEffect" placeholder="e.g., 0.75" step="0.01" type="number"/>
</div>
<div class="form-group">
<label>95% CI Lower</label>
<input id="nntCILo" placeholder="e.g., 0.60" step="0.01" type="number"/>
</div>
<div class="form-group">
<label>95% CI Upper</label>
<input id="nntCIHi" placeholder="e.g., 0.95" step="0.01" type="number"/>
</div>
<button class="btn-small primary" onclick="calculateNNT()">Calculate NNT/NNH</button>
<div class="results-display" id="nntResults" style="display: none;"></div>
</div>
</div>
<!-- Leave-One-Out Sensitivity -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Leave-One-Out Analysis <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  Тестирует влияние каждого исследования на объединенный результат. Использует данные из калькулятора метаанализа.
                </p>
<button class="btn-small primary" onclick="runLeaveOneOut()">Запустите анализ чувствительности</button>
<div id="looResults" style="display: none; margin-top: 1rem;">
<div class="results-display" id="looSummary"></div>
<div class="forest-plot-container" id="looPlotContainer" style="margin-top: 0.5rem;"></div>
</div>
</div>
</div>
<!-- Trim-and-Fill -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Trim-and-Fill <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  Вменяет недостающие исследования для исправления асимметрии воронкообразной диаграммы. Использует данные из калькулятора метаанализа.
                </p>
<div class="form-group">
<label>Estimator</label>
<select id="trimFillEstimator">
<option value="L0">L0 (Linear)</option>
<option selected="" value="R0">R0 (Rank-based)</option>
</select>
</div>
<div class="form-group">
<label>Side</label>
<select id="trimFillSide">
<option value="right">Right (suppress positive)</option>
<option selected="" value="left">Left (suppress negative)</option>
</select>
</div>
<button class="btn-small primary" onclick="runTrimAndFill()">Run Trim-and-Fill</button>
<div id="trimFillResults" style="display: none; margin-top: 1rem;">
<div class="results-display" id="trimFillSummary"></div>
<div class="forest-plot-container" id="trimFillPlotContainer" style="margin-top: 0.5rem;"></div>
</div>
</div>
</div>
<!-- Key References -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Key References <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.7rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--navy);">Дела об отмене доказательств:</p>
<ul style="font-size: 0.7rem; color: var(--light-text); margin-left: 1rem; line-height: 1.6;">
<li><strong>CAST:</strong> Echt DS et al. NEJM 1991;324:781-788</li>
<li><strong>HRT/WHI:</strong> Rossouw JE et al. JAMA 2002;288:321-333</li>
<li><strong>Rosiglitazone:</strong> Nissen SE, Wolski K. NEJM 2007;356:2457-2471</li>
<li><strong>Vioxx:</strong> Bombardier C et al. NEJM 2000;343:1520-1528</li>
<li><strong>DECREASE Fraud:</strong> Erasmus MC Investigation 2012</li>
<li><strong>BART:</strong> Fergusson DA et al. NEJM 2008;358:2319-2331</li>
<li><strong>ISIS-4:</strong> ISIS-4 Collaborative Group. Lancet 1995;345:669-685</li>
<li><strong>ACCORD:</strong> Исследовательская группа АККОРД. НЭМ 2008;358:2545-2559</li>
<li><strong>Reboxetine:</strong> Eyding D et al. BMJ 2010;341:c4737</li>
</ul>
<p style="font-size: 0.7rem; font-weight: 600; margin: 0.75rem 0 0.5rem; color: var(--navy);">Methods References:</p>
<ul style="font-size: 0.7rem; color: var(--light-text); margin-left: 1rem; line-height: 1.6;">
<li><strong>GRADE:</strong> Guyatt GH et al. BMJ 2008;336:924-926</li>
<li><strong>RoB 2.0:</strong> Sterne JAC et al. BMJ 2019;366:l4898</li>
<li><strong>ROBINS-I:</strong> Sterne JA et al. BMJ 2016;355:i4919</li>
<li><strong>ICEMAN:</strong> Schandelmaier S et al. CMAJ 2020;192:E901-E906</li>
<li><strong>HKSJ:</strong> Hartung J, Knapp G. Stat Med 2001;20:3875-3889</li>
<li><strong>PRISMA:</strong> Page MJ et al. BMJ 2021;372:n71</li>
<li><strong>TSA:</strong> Wetterslev J et al. BMC Med Res Methodol 2008;8:39</li>
</ul>
</div>
</div>
</div>
</aside>
</div>
</main>
</div>
<script>
    // ============================================================
    // CONSTANTS
    // ============================================================
    const Z_95 = 1.96;
    const Z_95_CI_DIVISOR = 2 * Z_95;

    // ============================================================
    // LIVE STORY DATA SYSTEM
    // ============================================================

    const storyData = {
      1: { // CAST
        title: 'CAST Trial: Antiarrhythmics',
        subtitle: 'Do drugs that suppress PVCs save lives?',
        before: {
          label: 'Before CAST (1989)',
          studies: [
            { name: 'Obs Study 1', effect: 0.45, lo: 0.28, hi: 0.72, n: 450 },
            { name: 'Obs Study 2', effect: 0.52, lo: 0.35, hi: 0.77, n: 380 },
            { name: 'Obs Study 3', effect: 0.38, lo: 0.22, hi: 0.65, n: 290 },
            { name: 'Surrogate', effect: 0.42, lo: 0.31, hi: 0.57, n: 1200 },
          ],
          pooled: { effect: 0.44, lo: 0.35, hi: 0.55 },
          metrics: { or: '0.44', nnt: '12', conclusion: 'Benefit' },
          insight: 'Observational data + biological plausibility suggested antiarrhythmics save lives by suppressing PVCs.'
        },
        after: {
          label: 'After CAST (1991)',
          studies: [
            { name: 'CAST-Encainide', effect: 2.38, lo: 1.59, hi: 3.57, n: 730 },
            { name: 'CAST-Flecainide', effect: 2.64, lo: 1.60, hi: 4.36, n: 641 },
          ],
          pooled: { effect: 2.50, lo: 1.80, hi: 3.47 },
          metrics: { or: '2.50', nnh: '17', conclusion: 'Harm' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Antiarrhythmics INCREASED mortality by 150%. An estimated 50,000+ deaths per year were caused by these drugs.'
        }
      },
      2: { // HRT
        title: 'HRT & Heart Disease',
        subtitle: 'Does hormone replacement protect the heart?',
        before: {
          label: 'Before WHI (2002)',
          studies: [
            { name: "Nurses' Health", effect: 0.50, lo: 0.40, hi: 0.63, n: 48470 },
            { name: 'Framingham', effect: 0.55, lo: 0.35, hi: 0.86, n: 1234 },
            { name: 'Meta 1998', effect: 0.65, lo: 0.52, hi: 0.81, n: 22000 },
          ],
          pooled: { effect: 0.56, lo: 0.47, hi: 0.67 },
          metrics: { rr: '0.56', nnt: '32', conclusion: 'Benefit' },
          insight: 'Более 30 обсервационных исследований показали снижение частоты ИБС на ~44%. ЗГТ была рекомендована для кардиопротекции.'
        },
        after: {
          label: 'After WHI (2002)',
          studies: [
            { name: 'WHI E+P', effect: 1.29, lo: 1.02, hi: 1.63, n: 16608 },
            { name: 'WHI E-only', effect: 0.91, lo: 0.75, hi: 1.12, n: 10739 },
          ],
          pooled: { effect: 1.13, lo: 0.95, hi: 1.34 },
          metrics: { rr: '1.13', nnh: '∞', conclusion: 'No Benefit/Harm' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Healthy user bias explained the observational findings. Women who took HRT were healthier at baseline.'
        }
      },
      3: { // Rosiglitazone
        title: 'Rosiglitazone (Avandia)',
        subtitle: 'Что было скрыто в неопубликованных испытаниях?',
        before: {
          label: 'Published Only',
          studies: [
            { name: 'ADOPT', effect: 1.08, lo: 0.75, hi: 1.56, n: 4360 },
            { name: 'DREAM', effect: 1.20, lo: 0.83, hi: 1.74, n: 5269 },
            { name: 'Published pool', effect: 1.14, lo: 0.90, hi: 1.45, n: 15000 },
          ],
          pooled: { effect: 1.14, lo: 0.92, hi: 1.41 },
          metrics: { or: '1.14', pvalue: '0.23', conclusion: 'NS' },
          insight: 'Опубликованные исследования показали незначительную тенденцию. FDA и врачи были успокоены.'
        },
        after: {
          label: 'Все данные (Ниссен, 2007 г.)',
          studies: [
            { name: 'ADOPT', effect: 1.25, lo: 0.78, hi: 2.01, n: 4360 },
            { name: 'DREAM', effect: 1.36, lo: 0.68, hi: 2.71, n: 5269 },
            { name: '42 unpublished', effect: 1.45, lo: 1.10, hi: 1.91, n: 22000 },
          ],
          pooled: { effect: 1.43, lo: 1.03, hi: 1.98 },
          metrics: { or: '1.43', pvalue: '0.03', conclusion: 'HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Including unpublished trials revealed 43% increased MI risk. ~83,000 excess heart attacks estimated.'
        }
      },
      6: { // Aprotinin
        title: 'Aprotinin (Trasylol)',
        subtitle: 'Упустили ли наблюдательные исследования вред?',
        before: {
          label: 'Observational Studies',
          studies: [
            { name: 'Mangano 2006', effect: 0.80, lo: 0.64, hi: 1.00, n: 4374 },
            { name: 'Karkouti 2006', effect: 0.85, lo: 0.68, hi: 1.06, n: 10870 },
            { name: 'Obs Meta', effect: 0.82, lo: 0.70, hi: 0.96, n: 30000 },
          ],
          pooled: { effect: 0.82, lo: 0.71, hi: 0.95 },
          metrics: { rr: '0.82', nnt: '50', conclusion: 'Benefit' },
          insight: 'Наблюдательные исследования показали снижение смертности на 18%. Апротинин широко использовался в кардиохирургии.'
        },
        after: {
          label: 'BART Trial (RCT)',
          studies: [
            { name: 'BART', effect: 1.53, lo: 1.10, hi: 2.15, n: 2331 },
          ],
          pooled: { effect: 1.53, lo: 1.10, hi: 2.15 },
          metrics: { rr: '1.53', nnh: '53', conclusion: 'HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> The RCT showed 53% INCREASED mortality. Confounding by indication: sickest patients got the drug.'
        }
      },
      7: { // Magnesium
        title: 'IV Magnesium in MI',
        subtitle: 'Small trials vs mega-trial',
        before: {
          label: 'Small Trials Meta (1991)',
          studies: [
            { name: 'Morton 1984', effect: 0.10, lo: 0.01, hi: 0.87, n: 40 },
            { name: 'Rasmussen 1986', effect: 0.35, lo: 0.13, hi: 0.94, n: 273 },
            { name: 'Shechter 1990', effect: 0.27, lo: 0.08, hi: 0.95, n: 103 },
            { name: 'LIMIT-2', effect: 0.74, lo: 0.57, hi: 0.97, n: 2316 },
          ],
          pooled: { effect: 0.44, lo: 0.27, hi: 0.71 },
          metrics: { or: '0.44', nnt: '25', conclusion: 'Benefit' },
          insight: 'Meta-analysis of 7 small trials showed 56% mortality reduction. Magnesium seemed like a miracle.'
        },
        after: {
          label: 'With ISIS-4 (1995)',
          studies: [
            { name: 'Small trials', effect: 0.44, lo: 0.27, hi: 0.71, n: 2774 },
            { name: 'ISIS-4', effect: 1.06, lo: 0.99, hi: 1.13, n: 58050 },
          ],
          pooled: { effect: 1.02, lo: 0.95, hi: 1.09 },
          metrics: { or: '1.02', nnt: '∞', conclusion: 'No Effect' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> ISIS-4 (58,050 patients) found NO benefit. Small-study effects and publication bias likely contributed to the earlier positive meta-analysis.'
        }
      },
      9: { // Reboxetine
        title: 'Reboxetine',
        subtitle: 'Сколько данных было скрыто?',
        before: {
          label: 'Published Only',
          studies: [
            { name: 'Pub Trial 1', effect: 0.62, lo: 0.35, hi: 1.10, n: 254 },
            { name: 'Pub Trial 2', effect: 0.48, lo: 0.22, hi: 1.05, n: 187 },
            { name: 'Pub Trial 3', effect: 0.55, lo: 0.28, hi: 1.08, n: 203 },
          ],
          pooled: { effect: 0.56, lo: 0.39, hi: 0.80 },
          metrics: { smd: '0.56', pvalue: '<0.001', conclusion: 'Benefit' },
          insight: 'Опубликованные исследования показали значительное преимущество по сравнению с плацебо. Ребоксетин был одобрен и поступил в продажу.'
        },
        after: {
          label: 'Все данные (EMA 2010)',
          studies: [
            { name: 'Published (26%)', effect: 0.56, lo: 0.39, hi: 0.80, n: 644 },
            { name: 'Unpublished (74%)', effect: 0.98, lo: 0.81, hi: 1.19, n: 1802 },
          ],
          pooled: { effect: 0.85, lo: 0.72, hi: 1.00 },
          metrics: { smd: '0.10', pvalue: '0.43', conclusion: 'No Effect' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> 74% of patient data was unpublished! True effect was essentially null. The drug was no better than placebo.'
        }
      },
      4: { // Vioxx
        title: 'Vioxx (Rofecoxib)',
        subtitle: 'О чем сообщалось выборочно?',
        before: {
          label: 'VIGOR Published (2000)',
          studies: [
            { name: 'VIGOR (GI)', effect: 0.46, lo: 0.33, hi: 0.64, n: 8076 },
          ],
          pooled: { effect: 0.46, lo: 0.33, hi: 0.64 },
          metrics: { rr: '0.46', nnt: '41', conclusion: 'GI Benefit' },
          insight: 'В публикации VIGOR подчеркивается снижение на 54% осложнений со стороны желудочно-кишечного тракта. Сердечно-сосудистые события были преуменьшены.'
        },
        after: {
          label: 'Обнародованы полные данные резюме',
          studies: [
            { name: 'VIGOR (CV)', effect: 4.25, lo: 1.39, hi: 17.37, n: 8076 },
            { name: 'APPROVe', effect: 1.92, lo: 1.19, hi: 3.11, n: 2586 },
          ],
          pooled: { effect: 2.24, lo: 1.24, hi: 4.02 },
          metrics: { rr: '2.24', nnh: '73', conclusion: 'CV HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Full data showed 4-fold increased MI risk. ~88,000 excess heart attacks. Withdrawn 2004.'
        }
      },
      5: { // DECREASE
        title: 'DECREASE Trials (Fraud)',
        subtitle: 'What happens when data is fabricated?',
        before: {
          label: 'Before Fraud Exposed',
          studies: [
            { name: 'DECREASE-I', effect: 0.09, lo: 0.02, hi: 0.37, n: 112 },
            { name: 'DECREASE-IV', effect: 0.65, lo: 0.24, hi: 1.74, n: 1066 },
            { name: 'Other trials', effect: 0.78, lo: 0.58, hi: 1.05, n: 3500 },
          ],
          pooled: { effect: 0.56, lo: 0.35, hi: 0.89 },
          metrics: { or: '0.56', nnt: '15', conclusion: 'Benefit' },
          insight: 'Meta-analysis including DECREASE showed 44% mortality reduction. Beta-blockers were mandated in guidelines.'
        },
        after: {
          label: 'Исключение мошеннических данных',
          studies: [
            { name: 'POISE', effect: 1.33, lo: 1.03, hi: 1.74, n: 8351 },
            { name: 'DIPOM', effect: 1.11, lo: 0.66, hi: 1.87, n: 921 },
            { name: 'MaVS', effect: 0.92, lo: 0.46, hi: 1.84, n: 496 },
          ],
          pooled: { effect: 1.27, lo: 1.01, hi: 1.60 },
          metrics: { or: '1.27', nnh: '67', conclusion: 'HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Without fabricated DECREASE data, beta-blockers INCREASED mortality by 27%. ~10,000 excess deaths in Europe from flawed guidelines.'
        }
      },
      8: { // ACCORD
        title: 'ACCORD Trial',
        subtitle: 'Когда среднее скрывает правду',
        before: {
          label: 'Before ACCORD (2008)',
          studies: [
            { name: 'DCCT (Type 1)', effect: 0.42, lo: 0.23, hi: 0.75, n: 1441 },
            { name: 'UKPDS', effect: 0.84, lo: 0.71, hi: 0.99, n: 3867 },
            { name: 'Obs studies', effect: 0.70, lo: 0.60, hi: 0.82, n: 50000 },
          ],
          pooled: { effect: 0.72, lo: 0.62, hi: 0.84 },
          metrics: { hr: '0.72', nnt: '20', conclusion: 'Benefit' },
          insight: 'Previous trials showed intensive glucose control reduced microvascular complications. Assumed benefit for macrovascular too.'
        },
        after: {
          label: 'ACCORD Results',
          studies: [
            { name: 'ACCORD', effect: 1.22, lo: 1.01, hi: 1.46, n: 10251 },
            { name: 'ADVANCE', effect: 0.93, lo: 0.83, hi: 1.06, n: 11140 },
            { name: 'VADT', effect: 1.07, lo: 0.81, hi: 1.42, n: 1791 },
          ],
          pooled: { effect: 1.04, lo: 0.91, hi: 1.19 },
          metrics: { hr: '1.22*', nnh: '95', conclusion: 'Harm in ACCORD' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> ACCORD stopped early - intensive control INCREASED mortality by 22%. Heterogeneity mattered: harm concentrated in older patients with CVD.'
        }
      },
      10: { // Surfactant
        title: 'Early Surfactant in Preterm',
        subtitle: 'When practice context changes',
        before: {
          label: 'Early Trials (1990s)',
          studies: [
            { name: 'Kendig 1991', effect: 0.55, lo: 0.35, hi: 0.86, n: 479 },
            { name: 'OSECT 1992', effect: 0.61, lo: 0.41, hi: 0.91, n: 338 },
            { name: 'Egberts 1993', effect: 0.58, lo: 0.37, hi: 0.91, n: 324 },
          ],
          pooled: { effect: 0.58, lo: 0.45, hi: 0.75 },
          metrics: { rr: '0.58', nnt: '9', conclusion: 'Benefit' },
          insight: 'Early surfactant (prophylactic) showed 42% reduced mortality/BPD compared to rescue surfactant. Became standard.'
        },
        after: {
          label: 'Современные исследования с CPAP',
          studies: [
            { name: 'COIN 2008', effect: 1.05, lo: 0.78, hi: 1.41, n: 610 },
            { name: 'SUPPORT 2010', effect: 0.91, lo: 0.68, hi: 1.21, n: 1316 },
            { name: 'VON 2011', effect: 0.94, lo: 0.71, hi: 1.25, n: 648 },
          ],
          pooled: { effect: 0.96, lo: 0.82, hi: 1.13 },
          metrics: { rr: '0.96', nnt: '∞', conclusion: 'No Benefit' },
          insight: '<strong>EVIDENCE EVOLUTION:</strong> Modern CPAP changed the context. Early surfactant no longer superior to CPAP + selective surfactant. Practices must evolve with evidence.'
        }
      },
      11: { // HCQ COVID
        title: 'COVID-19 Hydroxychloroquine',
        subtitle: 'Раннее обещание против строгих доказательств',
        before: {
          label: 'Ранние исследования (март-май 2020 г.)',
          studies: [
            { name: 'Gautret', effect: 0.15, lo: 0.03, hi: 0.75, n: 36 },
            { name: 'Chen J', effect: 0.65, lo: 0.25, hi: 1.69, n: 62 },
            { name: 'Million', effect: 0.22, lo: 0.11, hi: 0.44, n: 1061 },
          ],
          pooled: { effect: 0.28, lo: 0.15, hi: 0.52 },
          metrics: { or: '0.28', pvalue: '<0.001', conclusion: 'Benefit' },
          insight: 'Early small/observational studies suggested massive benefit. Emergency authorizations followed.'
        },
        after: {
          label: 'RCTs (RECOVERY, WHO)',
          studies: [
            { name: 'RECOVERY', effect: 1.09, lo: 0.97, hi: 1.23, n: 4716 },
            { name: 'WHO Solidarity', effect: 1.19, lo: 0.89, hi: 1.59, n: 954 },
            { name: 'RCT Meta', effect: 1.11, lo: 1.00, hi: 1.22, n: 8000 },
          ],
          pooled: { effect: 1.11, lo: 1.00, hi: 1.22 },
          metrics: { or: '1.11', pvalue: '0.05', conclusion: 'No Benefit/Harm' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Large RCTs showed NO benefit and possible harm. Authorizations revoked. Rigorous trials take time but give truth.'
        }
      }
    };

    let currentStoryView = 'before';
    let storyPlotType = 'forest';
    let storyPredictions = {}; // Track predictions per module
    let showingPrediction = false;

    function setStoryPlotType(type) {
      storyPlotType = type;
      const story = storyData[currentModule];
      if (story) renderStoryContent(story);
    }

    function hasPredicted(moduleId) {
      return storyPredictions[moduleId] !== undefined;
    }

    function makePrediction(moduleId, prediction) {
      const story = storyData[moduleId];
      if (!story) return;

      // Determine the actual answer
      const afterEffect = story.after.pooled.effect;
      let actual;
      if (afterEffect < 0.9) actual = 'benefit';
      else if (afterEffect > 1.1) actual = 'harm';
      else actual = 'neutral';

      // Store prediction and result
      storyPredictions[moduleId] = {
        prediction: prediction,
        actual: actual,
        correct: prediction === actual
      };

      // Update progress
      saveProgress();

      // Now show the actual results
      showingPrediction = false;
      renderStoryContent(story);
    }

    function updateStoryPanel(moduleId) {
      const panel = document.getElementById('storyDataPanel');
      const content = document.getElementById('storyDataContent');
      const story = storyData[moduleId];

      panel.classList.add('updating');
      setTimeout(() => panel.classList.remove('updating'), 500);

      if (!story) {
        content.innerHTML = `
          <div class="no-story-data">
            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">📚</p>
            <p>Module ${moduleId}: ${modules[moduleId]?.title || 'Unknown'}</p>
            <p style="margin-top: 0.5rem; opacity: 0.7;">This module focuses on methods rather than a specific evidence reversal story.</p>
          </div>
        `;
        return;
      }

      currentStoryView = 'before';
      renderStoryContent(story);
    }

    function renderStoryContent(story) {
      const content = document.getElementById('storyDataContent');
      const moduleId = currentModule;
      const data = currentStoryView === 'before' ? story.before : story.after;
      const predicted = hasPredicted(moduleId);
      const predictionResult = storyPredictions[moduleId];

      // If viewing "After" and haven't predicted yet, show prediction interface
      if (currentStoryView === 'after' && !predicted && showingPrediction) {
        content.innerHTML = `
          <div style="margin-bottom: 0.75rem;">
            <div style="font-size: 1rem; font-weight: 600; color: white;">${story.title}</div>
            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">${story.subtitle}</div>
          </div>

          <div class="story-toggle">
            <button class="" onclick="toggleStoryView('before')">
              ${story.before.label}
            </button>
            <button class="active" onclick="toggleStoryView('after')">
              ${story.after.label}
            </button>
          </div>

          <div class="predict-first-panel">
            <div class="predict-icon">🤔</div>
            <h4>Predict First!</h4>
            <p>Based on ${story.before.label}, the evidence suggested <strong>${story.before.metrics.conclusion.toLowerCase()}</strong>.</p>
            <p style="margin-top: 0.5rem;">What do you think the rigorous evidence showed?</p>

            <div class="predict-buttons">
              <button class="predict-btn benefit" onclick="makePrediction(${moduleId}, 'benefit')">
                <span class="predict-icon-small">✓</span>
                Treatment Helps
              </button>
              <button class="predict-btn neutral" onclick="makePrediction(${moduleId}, 'neutral')">
                <span class="predict-icon-small">—</span>
                No Effect
              </button>
              <button class="predict-btn harm" onclick="makePrediction(${moduleId}, 'harm')">
                <span class="predict-icon-small">✗</span>
                Treatment Harms
              </button>
            </div>

            <p style="font-size: 0.7rem; opacity: 0.6; margin-top: 0.75rem;">Making a prediction improves learning retention by 40%</p>
          </div>
        `;
        return;
      }

      // Prediction feedback (shown after predicting)
      let predictionFeedback = '';
      if (currentStoryView === 'after' && predicted) {
        const wasCorrect = predictionResult.correct;
        predictionFeedback = `
          <div class="prediction-feedback ${wasCorrect ? 'correct' : 'incorrect'}">
            <span class="feedback-icon">${wasCorrect ? '✓' : '✗'}</span>
            <span>${wasCorrect ? 'Correct! You predicted this evidence reversal.' : 'Not quite - this is why we need rigorous evidence!'}</span>
          </div>
        `;
      }

      content.innerHTML = `
        <div style="margin-bottom: 0.75rem;">
          <div style="font-size: 1rem; font-weight: 600; color: white;">${story.title}</div>
          <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">${story.subtitle}</div>
        </div>

        <div class="story-toggle">
          <button class="${currentStoryView === 'before' ? 'active' : ''}" onclick="toggleStoryView('before')">
            ${story.before.label}
          </button>
          <button class="${currentStoryView === 'after' ? 'active' : ''}" onclick="toggleStoryView('after')">
            ${story.after.label}
          </button>
        </div>

        ${predictionFeedback}

        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
          <button class="btn-small ${storyPlotType === 'forest' ? 'primary' : ''}" onclick="setStoryPlotType('forest')" style="flex:1; font-size: 0.7rem;">Forest Plot</button>
          <button class="btn-small ${storyPlotType === 'funnel' ? 'primary' : ''}" onclick="setStoryPlotType('funnel')" style="flex:1; font-size: 0.7rem;">Funnel Plot</button>
        </div>

        <div class="story-viz" id="storyForestPlot"></div>

        <div class="story-metrics">
          <div class="story-metric ${getMetricHighlight(data.metrics.conclusion)}">
            <div class="value">${Object.values(data.metrics)[0]}</div>
            <div class="label">${Object.keys(data.metrics)[0].toUpperCase()}</div>
          </div>
          <div class="story-metric ${getMetricHighlight(data.metrics.conclusion)}">
            <div class="value">${data.metrics.conclusion}</div>
            <div class="label">Conclusion</div>
          </div>
        </div>

        <div class="story-insight">${data.insight}</div>

        <button class="btn-small primary" style="width: 100%; margin-top: 0.75rem;" onclick="loadStoryIntoCalculator()">
          Load Data into Calculator →
        </button>
      `;

      // Draw the appropriate plot
      if (storyPlotType === 'funnel') {
        drawStoryFunnelPlot(data.studies, data.pooled, currentStoryView === 'after');
      } else {
        drawStoryForestPlot(data.studies, data.pooled, currentStoryView === 'after');
      }
    }

    function getMetricHighlight(conclusion) {
      if (conclusion.includes('Harm') || conclusion === 'HARM') return 'highlight-bad';
      if (conclusion.includes('Benefit')) return 'highlight-good';
      return '';
    }

    function toggleStoryView(view) {
      const moduleId = currentModule;
      const story = storyData[moduleId];
      if (!story) return;

      currentStoryView = view;

      // If switching to "after" and haven't predicted yet, show prediction interface
      if (view === 'after' && !hasPredicted(moduleId)) {
        showingPrediction = true;
      } else {
        showingPrediction = false;
      }

      renderStoryContent(story);
    }

    function drawStoryForestPlot(studies, pooled, isAfter) {
      const container = document.getElementById('storyForestPlot');
      if (!container) return;

      const width = 320;
      const height = studies.length * 32 + 60;
      const margin = { left: 100, right: 30, top: 15, bottom: 30 };
      const plotWidth = width - margin.left - margin.right;

      // Find data range
      const allEffects = [...studies.map(s => [s.lo, s.hi]).flat(), pooled.lo, pooled.hi];
      let minE = Math.min(...allEffects, 0.1);
      let maxE = Math.max(...allEffects, 3);

      // Log scale
      const logMin = Math.log(Math.max(0.05, minE * 0.8));
      const logMax = Math.log(maxE * 1.2);
      const xScale = (v) => margin.left + ((Math.log(v) - logMin) / (logMax - logMin)) * plotWidth;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="width: 100%; height: auto; font-family: sans-serif;" role="img" aria-label="Forest plot showing effect sizes for ${studies.length} studies">`;

      // Add pattern definitions for color-blind accessibility
      svg += `<defs>
        <pattern id="harmPattern" patternUnits="userSpaceOnUse" width="4" height="4">
          <path d="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2" stroke="#ef4444" stroke-width="1"/>
        </pattern>
        <pattern id="benefitPattern" patternUnits="userSpaceOnUse" width="4" height="4">
          <circle cx="2" cy="2" r="1" fill="#22c55e"/>
        </pattern>
      </defs>`;

      // Grid lines
      [0.1, 0.25, 0.5, 1, 2, 4].forEach(tick => {
        if (tick >= minE * 0.8 && tick <= maxE * 1.2) {
          const x = xScale(tick);
          svg += `<line x1="${x}" y1="${margin.top}" x2="${x}" y2="${height - margin.bottom}" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>`;
          svg += `<text x="${x}" y="${height - margin.bottom + 12}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.5)">${tick}</text>`;
        }
      });

      // Null line at 1
      const nullX = xScale(1);
      svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${height - margin.bottom}" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>`;

      // Studies - COLOR-BLIND SAFE: use different shapes + colors
      studies.forEach((study, i) => {
        const y = margin.top + 15 + i * 32;
        const x = xScale(Math.max(0.05, Math.min(10, study.effect)));
        const xLo = xScale(Math.max(0.05, study.lo));
        const xHi = xScale(Math.min(10, study.hi));

        // Color-blind safe: green (#22c55e) for benefit, red (#ef4444) for harm, gray for neutral
        const isBenefit = study.effect < 1;
        const isHarm = study.effect > 1.1;
        const color = isBenefit ? '#22c55e' : (isHarm ? '#ef4444' : '#94a3b8');

        // Study name
        svg += `<text x="${margin.left - 5}" y="${y + 4}" text-anchor="end" font-size="9" fill="white">${study.name}</text>`;

        // CI line - use dashed for harm, solid for benefit (color-blind safe)
        const dashArray = isHarm ? 'stroke-dasharray="3,2"' : '';
        svg += `<line x1="${xLo}" y1="${y}" x2="${xHi}" y2="${y}" stroke="${color}" stroke-width="2" ${dashArray}/>`;

        // Effect marker - SHAPES differ: square for benefit, circle for harm, diamond for neutral
        const size = Math.min(10, Math.max(5, study.n ? Math.sqrt(study.n) / 10 : 6));
        if (isBenefit) {
          // Square with fill for benefit
          svg += `<rect x="${x - size/2}" y="${y - size/2}" width="${size}" height="${size}" fill="${color}" rx="1"/>`;
        } else if (isHarm) {
          // Circle for harm
          svg += `<circle cx="${x}" cy="${y}" r="${size/2}" fill="${color}"/>`;
        } else {
          // Diamond for neutral
          svg += `<polygon points="${x},${y-size/2} ${x+size/2},${y} ${x},${y+size/2} ${x-size/2},${y}" fill="${color}"/>`;
        }
      });

      // Pooled diamond
      const poolY = height - margin.bottom - 10;
      const poolX = xScale(Math.max(0.05, Math.min(10, pooled.effect)));
      const poolXLo = xScale(Math.max(0.05, pooled.lo));
      const poolXHi = xScale(Math.min(10, pooled.hi));
      const isPooledHarm = pooled.effect > 1;
      const diamondColor = isAfter ? (isPooledHarm ? '#ef4444' : '#22c55e') : '#D4AF37';

      svg += `<polygon points="${poolXLo},${poolY} ${poolX},${poolY - 6} ${poolXHi},${poolY} ${poolX},${poolY + 6}" fill="${diamondColor}" stroke="white" stroke-width="1"/>`;
      svg += `<text x="${margin.left - 5}" y="${poolY + 3}" text-anchor="end" font-size="9" font-weight="bold" fill="${diamondColor}">Pooled</text>`;

      // Labels with symbols for color-blind users
      svg += `<text x="${xScale(0.3)}" y="${height - 3}" text-anchor="middle" font-size="7" fill="rgba(255,255,255,0.6)">■ Favors Treatment</text>`;
      svg += `<text x="${xScale(2.5)}" y="${height - 3}" text-anchor="middle" font-size="7" fill="rgba(255,255,255,0.6)">● Favors Control</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    function drawStoryFunnelPlot(studies, pooled, isAfter) {
      const container = document.getElementById('storyForestPlot');
      if (!container) return;

      const width = 320;
      const height = 200;
      const margin = { left: 40, right: 20, top: 20, bottom: 35 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Calculate SE from CI
      const studiesWithSE = studies.map(s => ({
        ...s,
        se: (Math.log(s.hi) - Math.log(s.lo)) / 3.92
      }));

      const maxSE = Math.max(...studiesWithSE.map(s => s.se)) * 1.2;
      const logPooled = Math.log(pooled.effect);

      // Scale functions
      const logEffects = studiesWithSE.map(s => Math.log(s.effect));
      const minLog = Math.min(...logEffects, logPooled) - 0.5;
      const maxLog = Math.max(...logEffects, logPooled) + 0.5;

      const xScale = (logE) => margin.left + ((logE - minLog) / (maxLog - minLog)) * plotWidth;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="width: 100%; height: auto; font-family: sans-serif;">`;

      // Funnel shape
      const funnelLeft = xScale(logPooled - 1.96 * maxSE);
      const funnelRight = xScale(logPooled + 1.96 * maxSE);
      const funnelTop = xScale(logPooled);

      svg += `<polygon points="${funnelTop},${margin.top} ${funnelLeft},${margin.top + plotHeight} ${funnelRight},${margin.top + plotHeight}"
               fill="rgba(255,255,255,0.1)" stroke="rgba(255,255,255,0.3)" stroke-dasharray="3"/>`;

      // Vertical line at pooled effect
      svg += `<line x1="${xScale(logPooled)}" y1="${margin.top}" x2="${xScale(logPooled)}" y2="${margin.top + plotHeight}"
               stroke="${isAfter ? '#ef4444' : '#D4AF37'}" stroke-width="2"/>`;

      // Null line at log(1) = 0
      const nullX = xScale(0);
      if (nullX > margin.left && nullX < width - margin.right) {
        svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${margin.top + plotHeight}"
                 stroke="rgba(255,255,255,0.4)" stroke-width="1" stroke-dasharray="4"/>`;
      }

      // Study points
      studiesWithSE.forEach(study => {
        const x = xScale(Math.log(study.effect));
        const y = yScale(study.se);
        const color = study.effect < 1 ? '#22c55e' : '#ef4444';

        svg += `<circle cx="${x}" cy="${y}" r="6" fill="${color}" stroke="white" stroke-width="1"/>`;
      });

      // X-axis label
      svg += `<text x="${width/2}" y="${height - 5}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.6)">Effect Size (log scale)</text>`;

      // Y-axis label
      svg += `<text x="12" y="${height/2}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.6)" transform="rotate(-90, 12, ${height/2})">Standard Error</text>`;

      // Show asymmetry indicator if appropriate
      if (isAfter) {
        svg += `<text x="${width - 10}" y="${margin.top + 15}" text-anchor="end" font-size="8" fill="#ef4444">⚠ Asymmetry</text>`;
      }

      svg += '</svg>';
      container.innerHTML = svg;
    }

    // ============================================================
    // INTERACTIVE TOOLS FOR NEW MODULES (13-22)
    // ============================================================

    // --- Tool 1: Bayesian Posterior Visualizer (Module 13) ---
    function updateBayesianPosterior() {
      const strengthVal = parseInt(document.getElementById('priorStrengthSlider').value);
      const meanVal = parseInt(document.getElementById('priorMeanSlider').value) / 100;
      const priorSD = Math.max(0.1, 10 - strengthVal * 0.098);
      const labels = ['Vague', 'Vague', 'Weak', 'Weak', 'Moderate', 'Moderate', 'Informative', 'Informative', 'Strong', 'Strong', 'Very Strong'];
      document.getElementById('priorStrengthLabel').textContent = labels[Math.min(10, Math.floor(strengthVal / 10))];
      document.getElementById('priorMeanLabel').textContent = meanVal.toFixed(2);

      // Data likelihood: centered at observed log-OR = -0.47 (STAMPEDE HR 0.63), SE = 0.10
      const dataM = -0.47, dataSE = 0.10;
      const dataPrec = 1 / (dataSE * dataSE);
      const priorPrec = 1 / (priorSD * priorSD);
      const postPrec = dataPrec + priorPrec;
      const postM = (dataM * dataPrec + meanVal * priorPrec) / postPrec;
      const postSD = Math.sqrt(1 / postPrec);

      const w = 500, h = 220, pad = 40;
      const xMin = -2, xMax = 2, steps = 200;
      function gauss(x, m, s) { return Math.exp(-0.5 * ((x - m) / s) ** 2) / (s * Math.sqrt(2 * Math.PI)); }
      function pathData(m, s, color) {
        let pts = [];
        for (let i = 0; i <= steps; i++) {
          const x = xMin + (xMax - xMin) * i / steps;
          const px = pad + (x - xMin) / (xMax - xMin) * (w - 2 * pad);
          const py = h - pad - gauss(x, m, s) / gauss(m, m, s) * (h - 2 * pad);
          pts.push(`${i === 0 ? 'M' : 'L'}${px.toFixed(1)},${py.toFixed(1)}`);
        }
        return `<path d="${pts.join(' ')}" fill="none" stroke="${color}" stroke-width="2.5"/>`;
      }

      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      svg += `<line x1="${pad}" y1="${h-pad}" x2="${w-pad}" y2="${h-pad}" stroke="#ccc"/>`;
      // Zero line
      const zx = pad + (0 - xMin) / (xMax - xMin) * (w - 2 * pad);
      svg += `<line x1="${zx}" y1="${pad}" x2="${zx}" y2="${h-pad}" stroke="#aaa" stroke-dasharray="4"/>`;
      svg += `<text x="${zx}" y="${h-pad+15}" text-anchor="middle" font-size="10" fill="#666">0</text>`;
      // Labels
      svg += `<text x="${pad}" y="${h-pad+15}" text-anchor="middle" font-size="10" fill="#666">${xMin}</text>`;
      svg += `<text x="${w-pad}" y="${h-pad+15}" text-anchor="middle" font-size="10" fill="#666">${xMax}</text>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">log-OR</text>`;
      // Curves
      svg += pathData(meanVal, priorSD, '#3b82f6');
      svg += pathData(dataM, dataSE, '#22c55e');
      svg += pathData(postM, postSD, '#D4AF37');
      // Legend
      svg += `<circle cx="${pad+10}" cy="15" r="5" fill="#3b82f6"/><text x="${pad+20}" y="19" font-size="10" fill="#333">Prior</text>`;
      svg += `<circle cx="${pad+70}" cy="15" r="5" fill="#22c55e"/><text x="${pad+80}" y="19" font-size="10" fill="#333">Likelihood</text>`;
      svg += `<circle cx="${pad+160}" cy="15" r="5" fill="#D4AF37"/><text x="${pad+170}" y="19" font-size="10" fill="#333">Posterior</text>`;
      // Posterior summary
      svg += `<text x="${w-pad}" y="35" text-anchor="end" font-size="10" fill="#333">Posterior: ${postM.toFixed(2)} [${(postM-1.96*postSD).toFixed(2)}, ${(postM+1.96*postSD).toFixed(2)}]</text>`;
      svg += '</svg>';
      document.getElementById('bayesianPlotArea').innerHTML = svg;
    }

    // --- Tool 2: NMA Network Graph (Module 14) ---
    function drawNMANetwork() {
      const area = document.getElementById('nmaNetworkArea');
      if (!area) return;
      // Simplified antidepressant network (12 key drugs)
      const drugs = [
        { name: 'Placebo', x: 250, y: 160 },
        { name: 'Fluoxetine', x: 120, y: 60 }, { name: 'Sertraline', x: 180, y: 40 },
        { name: 'Paroxetine', x: 310, y: 40 }, { name: 'Citalopram', x: 380, y: 60 },
        { name: 'Escitalopram', x: 420, y: 130 }, { name: 'Venlafaxine', x: 400, y: 220 },
        { name: 'Duloxetine', x: 330, y: 270 }, { name: 'Mirtazapine', x: 220, y: 280 },
        { name: 'Amitriptyline', x: 130, y: 260 }, { name: 'Bupropion', x: 70, y: 200 },
        { name: 'Agomelatine', x: 80, y: 130 }
      ];
      // Edges: [from, to, nStudies]
      const edges = [
        [0,1,35],[0,2,15],[0,3,22],[0,4,12],[0,5,18],[0,6,20],[0,7,10],[0,8,14],[0,9,8],
        [1,2,5],[1,3,8],[1,6,12],[1,8,4],[2,3,3],[2,6,6],[3,6,7],[4,5,6],
        [5,6,8],[6,7,5],[6,8,6],[8,9,3],[1,10,4],[0,10,7],[0,11,9],[5,11,3]
      ];
      const w = 500, h = 320;
      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Edges
      edges.forEach(([a, b, n]) => {
        const d1 = drugs[a], d2 = drugs[b];
        const thick = Math.max(1, Math.min(6, n / 5));
        svg += `<line x1="${d1.x}" y1="${d1.y}" x2="${d2.x}" y2="${d2.y}" stroke="rgba(212,175,55,0.4)" stroke-width="${thick}"/>`;
      });
      // Nodes
      drugs.forEach((d, i) => {
        const r = i === 0 ? 18 : 12;
        const fill = i === 0 ? '#1E2761' : '#D4AF37';
        svg += `<circle cx="${d.x}" cy="${d.y}" r="${r}" fill="${fill}" stroke="white" stroke-width="1.5"/>`;
        svg += `<text x="${d.x}" y="${d.y + r + 12}" text-anchor="middle" font-size="8" fill="#333" font-weight="600">${d.name}</text>`;
      });
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 3: GOSH Plot Generator (Module 17) ---
    // xoshiro128** PRNG for deterministic sampling
    function xoshiro128ss(seed) {
      let s = [seed, seed ^ 0x9E3779B9, seed ^ 0x6A09E667, seed ^ 0xBB67AE85];
      function rotl(x, k) { return ((x << k) | (x >>> (32 - k))) >>> 0; }
      function next() {
        const result = (rotl((s[1] * 5) >>> 0, 7) * 9) >>> 0;
        const t = (s[1] << 9) >>> 0;
        s[2] ^= s[0]; s[3] ^= s[1]; s[1] ^= s[2]; s[0] ^= s[3];
        s[2] ^= t; s[3] = rotl(s[3], 11);
        return result / 4294967296;
      }
      return next;
    }

    function generateGOSHPlot() {
      const area = document.getElementById('goshPlotArea');
      if (!area) return;
      // Example 8-study data (log-OR and SE)
      const studies = [
        { y: -0.5, se: 0.2 }, { y: -0.3, se: 0.15 }, { y: -0.1, se: 0.25 },
        { y: -0.4, se: 0.18 }, { y: 0.6, se: 0.3 }, { y: -0.35, se: 0.12 },
        { y: -0.2, se: 0.22 }, { y: -0.45, se: 0.16 }
      ];
      const k = studies.length;
      const rng = xoshiro128ss(42);
      const nSubsets = Math.min(2000, Math.pow(2, k) - 1);
      const points = [];

      for (let s = 0; s < nSubsets; s++) {
        // Random subset (at least 2 studies)
        let mask;
        do {
          mask = Math.floor(rng() * (Math.pow(2, k) - 1)) + 1;
        } while (mask.toString(2).split('').filter(c => c === '1').length < 2);

        const sub = studies.filter((_, i) => mask & (1 << i));
        // Fixed-effect pooled estimate + I²
        const wSum = sub.reduce((a, s) => a + 1 / (s.se * s.se), 0);
        const pooled = sub.reduce((a, s) => a + s.y / (s.se * s.se), 0) / wSum;
        const Q = sub.reduce((a, s) => a + (s.y - pooled) ** 2 / (s.se * s.se), 0);
        const df = sub.length - 1;
        const I2 = Math.max(0, (Q - df) / Q * 100);
        points.push({ effect: pooled, I2 });
      }

      const w = 500, h = 280, pad = 50;
      const xMin = -1.2, xMax = 1.2, yMin = 0, yMax = 100;
      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Axes
      svg += `<line x1="${pad}" y1="${h-pad}" x2="${w-pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<line x1="${pad}" y1="${pad}" x2="${pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">Pooled Effect (log-OR)</text>`;
      svg += `<text x="12" y="${h/2}" text-anchor="middle" font-size="11" fill="#666" transform="rotate(-90,12,${h/2})">I² (%)</text>`;
      // Points
      points.forEach(p => {
        const px = pad + (p.effect - xMin) / (xMax - xMin) * (w - 2 * pad);
        const py = h - pad - (p.I2 - yMin) / (yMax - yMin) * (h - 2 * pad);
        svg += `<circle cx="${px.toFixed(1)}" cy="${py.toFixed(1)}" r="2" fill="rgba(212,175,55,0.4)"/>`;
      });
      // Tick labels
      [-1, -0.5, 0, 0.5, 1].forEach(v => {
        const x = pad + (v - xMin) / (xMax - xMin) * (w - 2 * pad);
        svg += `<text x="${x}" y="${h-pad+15}" text-anchor="middle" font-size="9" fill="#999">${v}</text>`;
      });
      [0, 25, 50, 75, 100].forEach(v => {
        const y = h - pad - v / 100 * (h - 2 * pad);
        svg += `<text x="${pad-5}" y="${y+3}" text-anchor="end" font-size="9" fill="#999">${v}</text>`;
      });
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 4: Contour-Enhanced Funnel Plot (Module 17) ---
    function generateContourFunnel() {
      const area = document.getElementById('contourFunnelArea');
      if (!area) return;
      // Reuse magnesium-like data
      const studies = [
        {y: -0.5, se: 0.20}, {y: -0.3, se: 0.15}, {y: -0.1, se: 0.25},
        {y: -0.4, se: 0.18}, {y: 0.6, se: 0.30}, {y: -0.35, se: 0.12},
        {y: -0.2, se: 0.22}, {y: -0.45, se: 0.16}, {y: -0.15, se: 0.28},
        {y: -0.55, se: 0.10}
      ];
      const w = 460, h = 300, pad = 50;
      const pooled = -0.28;
      const maxSE = 0.35;
      const xMin = -1.5, xMax = 1.0;
      function px(v) { return pad + (v - xMin) / (xMax - xMin) * (w - 2 * pad); }
      function py(se) { return pad + se / maxSE * (h - 2 * pad); }

      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Contour regions (p-value regions)
      // Draw widest region first (p<0.10) so narrower regions layer on top
      const zVals = [1.645, 1.96, 2.576]; // p<0.10, p<0.05, p<0.01
      const colors = ['rgba(212,175,55,0.15)', 'rgba(59,130,246,0.15)', 'rgba(34,197,94,0.15)'];
      const labels = ['p<0.10', 'p<0.05', 'p<0.01'];
      for (let z = 0; z < zVals.length; z++) {
        // Left contour: effect = -z*SE (significant negative)
        let pts = `${px(0)},${py(0)}`;
        for (let se = 0; se <= maxSE; se += 0.01) {
          pts += ` ${px(-zVals[z] * se)},${py(se)}`;
        }
        pts += ` ${px(xMin)},${py(maxSE)} ${px(xMin)},${py(0)}`;
        svg += `<polygon points="${pts}" fill="${colors[z]}"/>`;
        // Right contour
        pts = `${px(0)},${py(0)}`;
        for (let se = 0; se <= maxSE; se += 0.01) {
          pts += ` ${px(zVals[z] * se)},${py(se)}`;
        }
        pts += ` ${px(xMax)},${py(maxSE)} ${px(xMax)},${py(0)}`;
        svg += `<polygon points="${pts}" fill="${colors[z]}"/>`;
      }
      // Pooled line
      svg += `<line x1="${px(pooled)}" y1="${py(0)}" x2="${px(pooled)}" y2="${py(maxSE)}" stroke="#D4AF37" stroke-width="2"/>`;
      // Null line
      svg += `<line x1="${px(0)}" y1="${py(0)}" x2="${px(0)}" y2="${py(maxSE)}" stroke="#999" stroke-dasharray="4"/>`;
      // Studies
      studies.forEach(s => {
        svg += `<circle cx="${px(s.y)}" cy="${py(s.se)}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>`;
      });
      // Legend
      svg += `<text x="${w-pad}" y="15" text-anchor="end" font-size="9" fill="#22c55e">p&lt;0.01</text>`;
      svg += `<text x="${w-pad}" y="28" text-anchor="end" font-size="9" fill="#3b82f6">p&lt;0.05</text>`;
      svg += `<text x="${w-pad}" y="41" text-anchor="end" font-size="9" fill="#D4AF37">p&lt;0.10</text>`;
      // Axes
      svg += `<line x1="${pad}" y1="${py(0)}" x2="${w-pad}" y2="${py(0)}" stroke="#999"/>`;
      svg += `<line x1="${pad}" y1="${py(0)}" x2="${pad}" y2="${py(maxSE)}" stroke="#999"/>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">Effect Size</text>`;
      svg += `<text x="12" y="${h/2}" text-anchor="middle" font-size="11" fill="#666" transform="rotate(-90,12,${h/2})">Std Error</text>`;
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 5: Fragility Index Calculator (Module 17) ---
    function calculateFragilityIndex() {
      let eTx = parseInt(document.getElementById('fi-eventsTx').value) || 0;
      let nTx = parseInt(document.getElementById('fi-nTx').value) || 0;
      let eCtrl = parseInt(document.getElementById('fi-eventsCtrl').value) || 0;
      let nCtrl = parseInt(document.getElementById('fi-nCtrl').value) || 0;
      if (nTx <= 0 || nCtrl <= 0 || eTx < 0 || eCtrl < 0) {
        document.getElementById('fragilityResult').innerHTML = '<p style="color:#C53030;">Please enter valid positive numbers.</p>';
        document.getElementById('fragilityResult').style.display = 'block';
        return;
      }
      // Fisher's exact test approximation using chi-squared
      function pValue(a, b, c, d) {
        const n = a + b + c + d;
        const e = (a * d - b * c);
        const chi2 = n * e * e / ((a + b) * (c + d) * (a + c) * (b + d));
        // Approximate p from chi2 with 1 df using normal
        const z = Math.sqrt(chi2);
        return 2 * (1 - normalCDF(z));
      }
      function normalCDF(x) {
        const t = 1 / (1 + 0.2316419 * Math.abs(x));
        const d = 0.3989422804 * Math.exp(-x * x / 2);
        const p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
        return x > 0 ? 1 - p : p;
      }
      let fi = 0;
      let a = eTx, b = nTx - eTx, c = eCtrl, d = nCtrl - eCtrl;
      let p = pValue(a, b, c, d);
      if (p >= 0.05) {
        document.getElementById('fragilityResult').innerHTML = '<p>Result is already non-significant (p = ' + p.toFixed(4) + '). Fragility index = 0.</p>';
        document.getElementById('fragilityResult').style.display = 'block';
        return;
      }
      // Iteratively add events to treatment arm (convert non-events to events)
      while (p < 0.05 && fi < 500 && a < nTx) {
        a++;
        b = nTx - a;
        p = pValue(a, b, c, d);
        fi++;
      }
      const res = document.getElementById('fragilityResult');
      res.innerHTML = `
        <p style="font-weight:600; font-size:1.2rem; color:var(--navy);">Fragility Index = ${fi}</p>
        <p style="margin-top:0.5rem;">Changing <strong>${fi}</strong> event${fi !== 1 ? 's' : ''} flips p from significant to ${p.toFixed(4)}.</p>
        <p style="margin-top:0.5rem; color:${fi <= 3 ? '#C53030' : fi <= 8 ? '#D4AF37' : '#22c55e'}; font-weight:600;">
          ${fi <= 3 ? 'Very fragile result' : fi <= 8 ? 'Moderately fragile' : 'Reasonably robust'}
        </p>
      `;
      res.style.display = 'block';
    }

    // --- Tool 6: Dose-Response Curve Builder (Module 16) ---
    let currentDoseModel = 'spline';
    function setDoseModel(model) {
      currentDoseModel = model;
      ['linear', 'quadratic', 'spline'].forEach(m => {
        const btn = document.getElementById('doseBtn-' + m);
        if (btn) { btn.classList.toggle('primary', m === model); }
      });
      drawDoseResponse();
    }
    function drawDoseResponse() {
      const area = document.getElementById('doseResponsePlotArea');
      if (!area) return;
      // Simulated dose-response data (drinks/week vs log-RR)
      const data = [
        {dose: 0, rr: 0, lo: 0, hi: 0},
        {dose: 3, rr: -0.05, lo: -0.15, hi: 0.05},
        {dose: 7, rr: 0.02, lo: -0.08, hi: 0.12},
        {dose: 14, rr: 0.15, lo: 0.03, hi: 0.27},
        {dose: 21, rr: 0.35, lo: 0.18, hi: 0.52},
        {dose: 28, rr: 0.55, lo: 0.30, hi: 0.80}
      ];
      const w = 480, h = 240, pad = 50;
      const maxDose = 30, yMin = -0.3, yMax = 0.9;
      function px(d) { return pad + d / maxDose * (w - 2 * pad); }
      function py(v) { return h - pad - (v - yMin) / (yMax - yMin) * (h - 2 * pad); }

      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Reference line at 0
      svg += `<line x1="${pad}" y1="${py(0)}" x2="${w-pad}" y2="${py(0)}" stroke="#aaa" stroke-dasharray="4"/>`;
      // CI shading
      let ciPath = `M${px(data[0].dose)},${py(data[0].hi)}`;
      data.forEach(d => { ciPath += ` L${px(d.dose)},${py(d.hi)}`; });
      for (let i = data.length - 1; i >= 0; i--) { ciPath += ` L${px(data[i].dose)},${py(data[i].lo)}`; }
      ciPath += 'Z';
      svg += `<path d="${ciPath}" fill="rgba(212,175,55,0.15)"/>`;

      // Model curve
      let curvePts = [];
      for (let d = 0; d <= maxDose; d += 0.5) {
        let val;
        if (currentDoseModel === 'linear') {
          val = 0.019 * d;
        } else if (currentDoseModel === 'quadratic') {
          val = -0.005 * d + 0.0009 * d * d;
        } else { // spline
          // Simulate a J-curve effect
          if (d <= 5) val = -0.01 * d;
          else if (d <= 15) val = -0.05 + 0.02 * (d - 5);
          else val = 0.15 + 0.025 * (d - 15);
        }
        curvePts.push(`${px(d).toFixed(1)},${py(val).toFixed(1)}`);
      }
      svg += `<polyline points="${curvePts.join(' ')}" fill="none" stroke="#D4AF37" stroke-width="2.5"/>`;

      // Data points
      data.forEach(d => {
        svg += `<circle cx="${px(d.dose)}" cy="${py(d.rr)}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>`;
        svg += `<line x1="${px(d.dose)}" y1="${py(d.lo)}" x2="${px(d.dose)}" y2="${py(d.hi)}" stroke="#1E2761" stroke-width="1"/>`;
      });
      // Axes + labels
      svg += `<line x1="${pad}" y1="${h-pad}" x2="${w-pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<line x1="${pad}" y1="${pad}" x2="${pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">Dose (drinks/week)</text>`;
      svg += `<text x="12" y="${h/2}" text-anchor="middle" font-size="11" fill="#666" transform="rotate(-90,12,${h/2})">log-RR</text>`;
      svg += `<text x="${w-pad}" y="20" text-anchor="end" font-size="11" fill="#D4AF37" font-weight="600">${currentDoseModel.charAt(0).toUpperCase() + currentDoseModel.slice(1)} model</text>`;
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 7: CERQual Assessment Tool (Module 20) ---
    function initCERQualTool() {
      const container = document.getElementById('cerqualTool');
      if (!container) return;
      const components = [
        { id: 'meth', label: 'Methodological Limitations', desc: 'Extent of problems with design/conduct of contributing studies' },
        { id: 'cohe', label: 'Coherence', desc: 'How clearly and consistently the data supports the finding' },
        { id: 'adeq', label: 'Adequacy', desc: 'Degree of richness and quantity of data supporting the finding' },
        { id: 'relv', label: 'Relevance', desc: 'Extent to which the contributing studies apply to the review context' }
      ];
      const levels = ['No concerns', 'Minor concerns', 'Moderate concerns', 'Serious concerns'];
      let html = '';
      components.forEach(c => {
        html += `<div style="margin-bottom:0.75rem; padding:0.75rem; background:white; border-radius:6px; border:1px solid #e2e8f0;">
          <div style="font-weight:600; margin-bottom:0.25rem;">${c.label}</div>
          <div style="font-size:0.8rem; color:#718096; margin-bottom:0.5rem;">${c.desc}</div>
          <select id="cerqual-${c.id}" onchange="updateCERQual()" style="width:100%; padding:0.3rem; border:1px solid #ccc; border-radius:4px;">
            ${levels.map((l, i) => `<option value="${i}">${l}</option>`).join('')}
          </select>
        </div>`;
      });
      html += '<div id="cerqualResult" style="margin-top:0.75rem; padding:0.75rem; background:rgba(212,175,55,0.1); border-radius:6px;"></div>';
      container.innerHTML = html;
      updateCERQual();
    }
    function updateCERQual() {
      const ids = ['meth', 'cohe', 'adeq', 'relv'];
      const total = ids.reduce((s, id) => s + parseInt(document.getElementById('cerqual-' + id)?.value || 0), 0);
      const levels = ['High', 'Moderate', 'Low', 'Very Low'];
      const colors = ['#22c55e', '#D4AF37', '#f59e0b', '#C53030'];
      const idx = Math.min(3, Math.floor(total / 2));
      const res = document.getElementById('cerqualResult');
      if (res) res.innerHTML = `<p style="font-weight:600; color:${colors[idx]}; font-size:1.1rem;">Overall Confidence: ${levels[idx]}</p>
        <p style="font-size:0.85rem; margin-top:0.25rem;">Total concern score: ${total}/12</p>`;
    }

    // --- Tool 8: Reproducibility Checklist (Module 22) ---
    function initReproChecklist() {
      const container = document.getElementById('reproChecklist');
      if (!container) return;
      const items = [
        'Search strategy fully reported and reproducible',
        'Extracted data table available (supplementary or repository)',
        'Analysis code/script shared (R, Python, or equivalent)',
        'Software version and packages documented',
        'Random seed specified for stochastic analyses',
        'Sensitivity analyses pre-specified in protocol',
        'PRISMA checklist completed and submitted',
        'Data available in machine-readable format (CSV/JSON)'
      ];
      container.innerHTML = items.map((item, i) =>
        `<label style="display:flex; align-items:center; gap:0.5rem; padding:0.5rem 0; border-bottom:1px solid #e2e8f0; cursor:pointer;">
          <input type="checkbox" id="repro-${i}" onchange="updateReproScore()" style="width:18px;height:18px;accent-color:#D4AF37;">
          <span style="font-size:0.9rem;">${item}</span>
        </label>`
      ).join('');
      updateReproScore();
    }
    function updateReproScore() {
      const total = 8;
      let checked = 0;
      for (let i = 0; i < total; i++) {
        if (document.getElementById('repro-' + i)?.checked) checked++;
      }
      const pct = Math.round(checked / total * 100);
      const color = pct >= 75 ? '#22c55e' : pct >= 50 ? '#D4AF37' : '#C53030';
      const label = pct >= 75 ? 'Good' : pct >= 50 ? 'Fair' : 'Poor';
      const res = document.getElementById('reproScore');
      if (res) {
        res.innerHTML = `
          <div style="background:#e2e8f0; border-radius:4px; height:12px; margin-bottom:0.5rem;">
            <div style="background:${color}; height:100%; border-radius:4px; width:${pct}%; transition:width 0.3s;"></div>
          </div>
          <p style="font-weight:600; color:${color};">${label} Reproducibility (${checked}/${total} = ${pct}%)</p>
        `;
      }
    }

    // Initialize tools when modules are first visited
    function initAdvancedTools() {
      // Run once on first visit to these modules
      if (document.getElementById('bayesianPlotArea') && !document.getElementById('bayesianPlotArea').innerHTML) {
        updateBayesianPosterior();
      }
      if (document.getElementById('nmaNetworkArea') && !document.getElementById('nmaNetworkArea').innerHTML) {
        drawNMANetwork();
      }
      if (document.getElementById('doseResponsePlotArea') && !document.getElementById('doseResponsePlotArea').innerHTML) {
        drawDoseResponse();
      }
      if (document.getElementById('reproChecklist') && !document.getElementById('reproChecklist').innerHTML) {
        initReproChecklist();
      }
    }

    // Hook into goToModule to init tools
    const _origGoToModuleForTools = typeof goToModule === 'function' ? goToModule : null;

    function openToolsWithStory() {
      // Open tools panel
      const panel = document.getElementById('toolsPanel');
      panel.classList.add('open');

      // Scroll to story data section
      const storyPanel = document.getElementById('storyDataPanel');
      if (storyPanel) {
        storyPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        storyPanel.classList.add('updating');
        setTimeout(() => storyPanel.classList.remove('updating'), 500);
      }

      // Hide the indicator button since they found it
      document.getElementById('storyIndicatorBtn').classList.remove('pulse');
    }

    function loadStoryIntoCalculator() {
      const story = storyData[currentModule];
      if (!story) {
        alert('No story data available for this module.');
        return;
      }

      const data = currentStoryView === 'before' ? story.before : story.after;
      const tbody = document.getElementById('studyTableBody');

      // Clear existing rows
      tbody.innerHTML = '';

      // Add story studies
      data.studies.forEach(study => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input type="text" value="${study.name}"></td>
          <td><input type="number" step="0.01" value="${study.effect.toFixed(2)}"></td>
          <td><input type="number" step="0.01" value="${study.lo.toFixed(2)}"></td>
          <td><input type="number" step="0.01" value="${study.hi.toFixed(2)}"></td>
          <td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
        `;
        tbody.appendChild(row);
      });

      // Auto-run the analysis
      runMetaAnalysis();

      // Show notification
      const panel = document.getElementById('storyDataPanel');
      panel.classList.add('updating');
      setTimeout(() => panel.classList.remove('updating'), 500);
    }

    // ============================================================
    // STATISTICAL FUNCTIONS
    // ============================================================

    function normalCDF(x) {
      const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741;
      const a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911;
      const sign = x < 0 ? -1 : 1;
      x = Math.abs(x) / Math.sqrt(2);
      const t = 1 / (1 + p * x);
      const y = 1 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
      return 0.5 * (1 + sign * y);
    }

    function tCDF(t, df) {
      if (df <= 0) return 0.5;
      const x = df / (df + t * t);
      const half = 0.5 * incompleteBeta(x, df / 2, 0.5);
      return t >= 0 ? 1 - half : half;
    }

    function incompleteBeta(x, a, b) {
      if (x === 0) return 0;
      if (x === 1) return 1;
      const bt = Math.exp(
        logGamma(a + b) - logGamma(a) - logGamma(b) +
        a * Math.log(x) + b * Math.log(1 - x)
      );
      if (x < (a + 1) / (a + b + 2)) {
        return bt * betaCF(x, a, b) / a;
      }
      return 1 - bt * betaCF(1 - x, b, a) / b;
    }

    function betaCF(x, a, b) {
      const maxIter = 200, eps = 1e-10;
      const qab = a + b, qap = a + 1, qam = a - 1;
      let c = 1, d = 1 - qab * x / qap;
      if (Math.abs(d) < 1e-30) d = 1e-30;
      d = 1 / d;
      let h = d;
      for (let m = 1; m <= maxIter; m++) {
        const m2 = 2 * m;
        let aa = m * (b - m) * x / ((qam + m2) * (a + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < 1e-30) d = 1e-30;
        c = 1 + aa / c;
        if (Math.abs(c) < 1e-30) c = 1e-30;
        d = 1 / d;
        h *= d * c;
        aa = -(a + m) * (qab + m) * x / ((a + m2) * (qap + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < 1e-30) d = 1e-30;
        c = 1 + aa / c;
        if (Math.abs(c) < 1e-30) c = 1e-30;
        d = 1 / d;
        const del = d * c;
        h *= del;
        if (Math.abs(del - 1) < eps) break;
      }
      return h;
    }

    function logGamma(x) {
      const c = [76.18009172947146, -86.50532032941677, 24.01409824083091,
        -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5];
      let y = x, tmp = x + 5.5;
      tmp -= (x + 0.5) * Math.log(tmp);
      let ser = 1.000000000190015;
      for (let j = 0; j < 6; j++) ser += c[j] / ++y;
      return -tmp + Math.log(2.5066282746310005 * ser / x);
    }

    function tQuantile(p, df) {
      if (p <= 0) return -Infinity;
      if (p >= 1) return Infinity;
      if (df <= 0) return NaN;
      let lo = -10, hi = 10;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (tCDF(mid, df) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    function normalQuantile(p) {
      if (p <= 0) return -Infinity;
      if (p >= 1) return Infinity;
      let lo = -10, hi = 10;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (normalCDF(mid) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    function chiSquareCDF(x, df) {
      if (x <= 0) return 0;
      return regularizedGammaP(df / 2, x / 2);
    }

    function regularizedGammaP(a, x) {
      if (x < 0 || a <= 0) return NaN;
      if (x === 0) return 0;
      if (x < a + 1) {
        let sum = 1 / a, term = sum;
        for (let n = 1; n < 100; n++) {
          term *= x / (a + n);
          sum += term;
          if (Math.abs(term) < 1e-10) break;
        }
        return sum * Math.exp(-x + a * Math.log(x) - logGamma(a));
      } else {
        let b = x + 1 - a, c = 1 / 1e-30, d = 1 / b, h = d;
        for (let i = 1; i < 100; i++) {
          const an = -i * (i - a);
          b += 2;
          d = an * d + b;
          if (Math.abs(d) < 1e-30) d = 1e-30;
          c = b + an / c;
          if (Math.abs(c) < 1e-30) c = 1e-30;
          d = 1 / d;
          const del = d * c;
          h *= del;
          if (Math.abs(del - 1) < 1e-10) break;
        }
        return 1 - Math.exp(-x + a * Math.log(x) - logGamma(a)) * h;
      }
    }

    function chiSquareQuantile(p, df) {
      if (p <= 0) return 0;
      if (p >= 1) return Infinity;
      let lo = 0, hi = df * 5 + 50;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (chiSquareCDF(mid, df) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    // ============================================================
    // TAU² ESTIMATORS
    // ============================================================

    function calculateTau2DL(effects, ses) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      const weights = variances.map(v => 1 / v);
      const totalWeight = weights.reduce((a, b) => a + b, 0);
      const meanEffect = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / totalWeight;
      const q = effects.reduce((sum, e, i) => sum + weights[i] * (e - meanEffect) ** 2, 0);
      const c = totalWeight - weights.reduce((sum, w) => sum + w * w, 0) / totalWeight;
      return c > 0 ? Math.max(0, (q - (k - 1)) / c) : 0;
    }

    function calculateTau2REML(effects, ses, maxIter = 100, tol = 1e-6) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < maxIter; iter++) {
        const w = variances.map(v => 1 / (v + tau2));
        const sumW = w.reduce((a, b) => a + b, 0);
        const sumW2 = w.reduce((sum, wi) => sum + wi * wi, 0);
        const mu = effects.reduce((sum, e, i) => sum + e * w[i], 0) / sumW;
        const score = -0.5 * sumW + 0.5 * sumW2 / sumW + 0.5 * effects.reduce((sum, e, i) => sum + w[i] * w[i] * (e - mu) ** 2, 0);
        const info = 0.5 * (sumW2 - w.reduce((sum, wi) => sum + wi * wi * wi, 0) * 2 / sumW + sumW2 * sumW2 / (sumW * sumW));
        const delta = info > 0 ? score / info : 0;
        const newTau2 = Math.max(0, tau2 + delta);
        if (Math.abs(newTau2 - tau2) < tol) return newTau2;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2PM(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      let tau2 = 0.1;
      for (let iter = 0; iter < 100; iter++) {
        const weights = variances.map(v => 1 / (v + tau2));
        const sumW = weights.reduce((a, b) => a + b, 0);
        const meanEffect = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
        const Q = effects.reduce((sum, e, i) => sum + weights[i] * (e - meanEffect) ** 2, 0);
        if (Math.abs(Q - (n - 1)) < 0.0001) break;
        const dQ = -effects.reduce((sum, e, i) => sum + weights[i] * weights[i] * (e - meanEffect) ** 2, 0);
        tau2 = Math.max(0, tau2 - (Q - (n - 1)) / dQ);
      }
      return tau2;
    }

    function calculateTau2SJ(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / n;
      let tau2 = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / (n - 1);
      const weights = variances.map(v => 1 / (v + tau2));
      const sumW = weights.reduce((a, b) => a + b, 0);
      const pooled = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
      tau2 = effects.reduce((sum, e, i) => sum + (e - pooled) ** 2 / (variances[i] + tau2), 0) / (n - 1);
      return Math.max(0, tau2);
    }

    function calculateTau2HE(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / n;
      const S2 = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / (n - 1);
      const avgVar = variances.reduce((a, b) => a + b, 0) / n;
      return Math.max(0, S2 - avgVar);
    }

    function calculateTau2EB(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < 20; iter++) {
        const weights = variances.map(v => 1 / (v + tau2));
        const sumW = weights.reduce((a, b) => a + b, 0);
        const mean = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
        const Q = effects.reduce((sum, e, i) => sum + weights[i] * (e - mean) ** 2, 0);
        const C = sumW - weights.reduce((sum, w) => sum + w * w, 0) / sumW;
        const newTau2 = Math.max(0, (Q - (n - 1)) / C);
        if (Math.abs(newTau2 - tau2) < 1e-8) break;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2ML(effects, ses, maxIter = 100, tol = 1e-6) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < maxIter; iter++) {
        const w = variances.map(v => 1 / (v + tau2));
        const sumW = w.reduce((a, b) => a + b, 0);
        const mu = effects.reduce((sum, e, i) => sum + e * w[i], 0) / sumW;
        const score = 0.5 * effects.reduce((sum, e, i) => sum + w[i] * w[i] * (e - mu) ** 2, 0) -
                      0.5 * w.reduce((sum, wi) => sum + wi, 0);
        const sumW2 = w.reduce((sum, wi) => sum + wi * wi, 0);
        const info = 0.5 * sumW2;
        const delta = info > 0 ? score / info : 0;
        const newTau2 = Math.max(0, tau2 + delta);
        if (Math.abs(newTau2 - tau2) < tol) return newTau2;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2HS(effects, ses) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / k;
      const totalVariance = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / k;
      const avgSamplingVar = variances.reduce((a, b) => a + b, 0) / k;
      return Math.max(0, totalVariance - avgSamplingVar);
    }

    // ============================================================
    // MAIN META-ANALYSIS
    // ============================================================

    function calculateMetaAnalysis(studies, options = {}) {
      const settings = { tau2Estimator: 'DL', useHKSJ: true, confidenceLevel: 0.95, ...options };
      const k = studies.length;
      if (k === 0) return { error: 'No studies provided' };

      const isRatio = studies[0].isRatioMeasure !== false;
      const transformedEffects = studies.map(s => isRatio ? Math.log(s.effect) : s.effect);
      const ses = studies.map(s => {
        if (isRatio) return (Math.log(s.ciHi) - Math.log(s.ciLo)) / Z_95_CI_DIVISOR;
        return (s.ciHi - s.ciLo) / Z_95_CI_DIVISOR;
      });

      const fixedWeights = ses.map(se => 1 / (se * se));
      const totalFixedWeight = fixedWeights.reduce((a, b) => a + b, 0);
      const fixedEffect = transformedEffects.reduce((sum, e, i) => sum + e * fixedWeights[i], 0) / totalFixedWeight;
      const q = transformedEffects.reduce((sum, e, i) => sum + fixedWeights[i] * Math.pow(e - fixedEffect, 2), 0);
      const df = k - 1;
      const qPValue = df > 0 ? 1 - chiSquareCDF(q, df) : 1;
      const i2 = q > df ? Math.max(0, ((q - df) / q) * 100) : 0;
      const h2 = df > 0 ? q / df : 1;

      let tau2, tau2Method;
      const estimator = settings.tau2Estimator || 'DL';
      switch (estimator) {
        case 'REML': tau2 = calculateTau2REML(transformedEffects, ses); tau2Method = 'REML'; break;
        case 'PM': tau2 = calculateTau2PM(transformedEffects, ses); tau2Method = 'PM'; break;
        case 'SJ': tau2 = calculateTau2SJ(transformedEffects, ses); tau2Method = 'SJ'; break;
        case 'HE': tau2 = calculateTau2HE(transformedEffects, ses); tau2Method = 'HE'; break;
        case 'EB': tau2 = calculateTau2EB(transformedEffects, ses); tau2Method = 'EB'; break;
        case 'ML': tau2 = calculateTau2ML(transformedEffects, ses); tau2Method = 'ML'; break;
        case 'HS': tau2 = calculateTau2HS(transformedEffects, ses); tau2Method = 'HS'; break;
        default: tau2 = calculateTau2DL(transformedEffects, ses); tau2Method = 'DL';
      }

      const randomWeights = ses.map(se => 1 / (se * se + tau2));
      const totalRandomWeight = randomWeights.reduce((a, b) => a + b, 0);
      const normalizedWeights = randomWeights.map(w => w / totalRandomWeight);
      const randomEffect = transformedEffects.reduce((sum, e, i) => sum + e * randomWeights[i], 0) / totalRandomWeight;
      let randomSE = Math.sqrt(1 / totalRandomWeight);

      let useHKSJ = settings.useHKSJ && k >= 2;
      let hksjAdjustment = null;
      if (useHKSJ) {
        const qStar = transformedEffects.reduce((sum, e, i) => sum + randomWeights[i] * Math.pow(e - randomEffect, 2), 0);
        const hksjMultiplier = df > 0 ? qStar / df : 1;
        hksjAdjustment = { multiplier: hksjMultiplier, adjustedSE: randomSE * Math.sqrt(Math.max(1, hksjMultiplier)) };
      }

      let pooledCiLo, pooledCiHi, pValue, testMethod;
      if (useHKSJ && hksjAdjustment) {
        const tCrit = tQuantile(1 - (1 - settings.confidenceLevel) / 2, df);
        const effectSE = hksjAdjustment.adjustedSE;
        pooledCiLo = isRatio ? Math.exp(randomEffect - tCrit * effectSE) : randomEffect - tCrit * effectSE;
        pooledCiHi = isRatio ? Math.exp(randomEffect + tCrit * effectSE) : randomEffect + tCrit * effectSE;
        const tStat = randomEffect / effectSE;
        pValue = 2 * (1 - tCDF(Math.abs(tStat), df));
        testMethod = 'HKSJ (t-distribution)';
      } else {
        const zCrit = normalQuantile(1 - (1 - settings.confidenceLevel) / 2);
        pooledCiLo = isRatio ? Math.exp(randomEffect - zCrit * randomSE) : randomEffect - zCrit * randomSE;
        pooledCiHi = isRatio ? Math.exp(randomEffect + zCrit * randomSE) : randomEffect + zCrit * randomSE;
        const z = randomEffect / randomSE;
        pValue = 2 * (1 - normalCDF(Math.abs(z)));
        testMethod = 'Wald (z-distribution)';
      }

      const pooledEffect = isRatio ? Math.exp(randomEffect) : randomEffect;

      const predictionInterval = tau2 > 0 && k >= 3 ? {
        lo: isRatio ? Math.exp(randomEffect - tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)) : randomEffect - tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2),
        hi: isRatio ? Math.exp(randomEffect + tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)) : randomEffect + tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)
      } : null;

      return {
        pooledEffect, pooledCiLo, pooledCiHi, pValue,
        i2, h2, q, qPValue, tau2, tau2Method,
        k, weights: normalizedWeights, isRatio,
        testMethod, hksjAdjustment, predictionInterval,
        transformedEffects, ses, confidenceLevel: settings.confidenceLevel,
        fixedEffect: isRatio ? Math.exp(fixedEffect) : fixedEffect,
        fixedSE: Math.sqrt(1 / totalFixedWeight)
      };
    }

    // ============================================================
    // FOREST PLOT
    // ============================================================

    function generateForestPlotHTML(studies, meta) {
      const allEffects = [...studies.map(s => s.effect), meta.pooledEffect];
      const allLo = [...studies.map(s => s.ciLo), meta.pooledCiLo];
      const allHi = [...studies.map(s => s.ciHi), meta.pooledCiHi];

      const minEffect = Math.min(...allLo, 0.5);
      const maxEffect = Math.max(...allHi, 2.0);
      const range = maxEffect - minEffect;

      const scale = (val) => ((val - minEffect) / range) * 350 + 50;
      const height = (studies.length + 2) * 28 + 40;

      return `
        <svg viewBox="0 0 550 ${height}" style="width: 100%; height: ${height}px; font-family: 'Source Sans Pro', sans-serif;">
          <line x1="${scale(1)}" y1="15" x2="${scale(1)}" y2="${height - 25}" stroke="#ddd" stroke-width="1.5" stroke-dasharray="4" />
          <line x1="50" y1="${height - 25}" x2="400" y2="${height - 25}" stroke="#333" />
          <text x="${scale(0.5)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">0.5</text>
          <text x="${scale(1)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">1.0</text>
          <text x="${scale(1.5)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">1.5</text>
          <text x="${scale(2)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">2.0</text>
          ${studies.map((s, i) => {
            const y = 25 + i * 28;
            const size = Math.max(4, Math.sqrt(meta.weights[i]) * 12);
            return `
              <text x="5" y="${y + 4}" font-size="9" fill="#333">${_escHtml(s.label || 'Study ' + (i+1))}</text>
              <line x1="${scale(s.ciLo)}" y1="${y}" x2="${scale(s.ciHi)}" y2="${y}" stroke="#1E2761" stroke-width="1.5" />
              <rect x="${scale(s.effect) - size/2}" y="${y - size/2}" width="${size}" height="${size}" fill="#1E2761" />
              <text x="420" y="${y + 4}" font-size="8" fill="#333">${s.effect.toFixed(2)} [${s.ciLo.toFixed(2)}, ${s.ciHi.toFixed(2)}]</text>
            `;
          }).join('')}
          <polygon points="
            ${scale(meta.pooledEffect)},${25 + studies.length * 28 - 7}
            ${scale(meta.pooledCiLo)},${25 + studies.length * 28}
            ${scale(meta.pooledEffect)},${25 + studies.length * 28 + 7}
            ${scale(meta.pooledCiHi)},${25 + studies.length * 28}
          " fill="#D4AF37" />
          <text x="5" y="${25 + studies.length * 28 + 4}" font-size="9" font-weight="bold" fill="#333">Pooled</text>
          <text x="420" y="${25 + studies.length * 28 + 4}" font-size="8" font-weight="bold" fill="#333">${meta.pooledEffect.toFixed(2)} [${meta.pooledCiLo.toFixed(2)}, ${meta.pooledCiHi.toFixed(2)}]</text>
          <text x="${scale(0.7)}" y="${height - 2}" font-size="8" fill="#22c55e">Favors Treatment</text>
          <text x="${scale(1.3)}" y="${height - 2}" font-size="8" fill="#C53030">Favors Control</text>
        </svg>
      `;
    }

    // ============================================================
    // MODULE NAVIGATION
    // ============================================================

    const modules = [
      { id: 0, title: 'The Opening', subtitle: 'Why meta-analysis exists', slides: 12 },
      { id: 1, title: 'The Question', subtitle: 'CAST: PICO framework', slides: 20 },
      { id: 2, title: 'The Protocol', subtitle: 'HRT: Pre-specification', slides: 14 },
      { id: 3, title: 'The Search', subtitle: 'Rosiglitazone: Grey literature', slides: 17 },
      { id: 4, title: 'The Screening', subtitle: 'Vioxx: PRISMA', slides: 18 },
      { id: 5, title: 'The Extraction', subtitle: 'DECREASE: Provenance', slides: 18 },
      { id: 6, title: 'The Bias', subtitle: 'Aprotinin: RoB 2.0 + ROBINS-I', slides: 13 },
      { id: 7, title: 'The Synthesis', subtitle: 'Magnesium: Forest plots', slides: 19 },
      { id: 8, title: 'The Heterogeneity', subtitle: 'ACCORD: I², ICEMAN & Meta-regression', slides: 19 },
      { id: 9, title: 'The Hidden Studies', subtitle: 'Reboxetine: Funnel plots', slides: 17 },
      { id: 10, title: 'The Certainty', subtitle: 'Surfactant: GRADE', slides: 18 },
      { id: 11, title: 'The Living Review', subtitle: 'COVID-19: TSA', slides: 16 },
      { id: 12, title: 'Advanced Methods', subtitle: 'NMA, DTA, Dose-response', slides: 16 },
      { id: 13, title: 'The Bayesian Turn', subtitle: 'STAMPEDE: Priors & posteriors', slides: 16 },
      { id: 14, title: 'The Network', subtitle: 'Cipriani 2018: NMA & SUCRA', slides: 16 },
      { id: 15, title: 'The Individual', subtitle: 'EBCTCG: IPD meta-analysis', slides: 14 },
      { id: 16, title: 'The Dose', subtitle: 'Alcohol J-curve: Dose-response', slides: 14 },
      { id: 17, title: 'The Fragility', subtitle: 'Oseltamivir: Robustness', slides: 14 },
      { id: 18, title: 'The Equity', subtitle: 'SPRINT: PROGRESS-Plus', slides: 14 },
      { id: 19, title: 'The Machine', subtitle: 'Cochrane COVID: AI screening', slides: 15 },
      { id: 20, title: 'The Qualitative', subtitle: 'Bohren 2015: Meta-ethnography', slides: 13 },
      { id: 21, title: 'The Multivariate', subtitle: 'Correlated outcomes: RVE', slides: 14 },
      { id: 22, title: 'The Proof', subtitle: 'Reinhart-Rogoff: Reproducibility', slides: 16 },
      { id: 23, title: 'Capstone', subtitle: 'Your First Meta-Sprint', slides: 14 },
      { id: 24, title: 'Final Exam', subtitle: 'Summative assessment', slides: 5 }
    ];

    let currentModule = 0;
    let currentSlide = 0;
    let currentTier = 'foundation'; // foundation | researcher | methodologist

    function setTier(tier) {
      currentTier = tier;
      document.body.classList.remove('tier-foundation', 'tier-researcher', 'tier-methodologist');
      if (tier !== 'foundation') document.body.classList.add('tier-' + tier);
      document.querySelectorAll('.tier-btn').forEach(btn => {
        const isCurrent = btn.dataset.tier === tier;
        btn.classList.toggle('active', isCurrent);
        btn.setAttribute('aria-checked', isCurrent);
      });
      // Recalculate slide count for current module (tier-hidden slides don't count)
      updateSlideNavForTier();
      try { localStorage.setItem('synthesis_course_tier', tier); } catch(e) {}
    }

    function updateSlideNavForTier() {
      // After tier change, if current slide is now hidden, jump to nearest visible slide
      const container = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      if (!container) return;
      const allSlides = container.querySelectorAll('.slide');
      const activeSlide = allSlides[currentSlide];
      if (activeSlide && getComputedStyle(activeSlide).display === 'none') {
        // Find previous visible slide
        for (let i = currentSlide - 1; i >= 0; i--) {
          if (getComputedStyle(allSlides[i]).display !== 'none') {
            goToSlide(i);
            return;
          }
        }
        goToSlide(0);
      }
      updateCounter();
    }

    function getVisibleSlideCount() {
      const container = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      if (!container) return 0;
      let count = 0;
      container.querySelectorAll('.slide').forEach(s => {
        if (getComputedStyle(s).display !== 'none') count++;
      });
      return count;
    }

    function initModuleList() {
      const list = document.getElementById('moduleList');
      list.innerHTML = modules.map(m => `
        <div class="module-item ${m.id === currentModule ? 'active' : ''}" data-module="${m.id}" onclick="goToModule(${m.id})">
          <div class="module-number">${m.id}</div>
          <div class="module-info">
            <div class="module-title">${m.title}</div>
            <div class="module-subtitle">${m.subtitle}</div>
          </div>
        </div>
      `).join('');
    }

    function goToModule(moduleId) {
      // Hide current module
      document.querySelectorAll('.module-slides').forEach(m => m.classList.remove('active'));
      document.querySelectorAll('.module-item').forEach(m => m.classList.remove('active'));

      // Show new module
      currentModule = moduleId;
      currentSlide = 0;
      const moduleEl = document.querySelector(`.module-slides[data-module="${moduleId}"]`);
      if (moduleEl) {
        moduleEl.classList.add('active');
        updateSlideDisplay(moduleEl);
      }
      document.querySelector(`.module-item[data-module="${moduleId}"]`).classList.add('active');

      // Update header
      document.getElementById('currentModuleNum').textContent = moduleId;
      document.getElementById('currentModuleName').textContent = modules[moduleId].title;

      // Update live story data panel
      updateStoryPanel(moduleId);

      // Initialize advanced interactive tools (modules 13-22)
      setTimeout(initAdvancedTools, 100);

      // Show/hide story indicator button
      const storyBtn = document.getElementById('storyIndicatorBtn');
      if (storyData[moduleId]) {
        storyBtn.classList.add('visible');
      } else {
        storyBtn.classList.remove('visible');
      }

      updateProgress();
    }

    function updateSlideDisplay(moduleEl) {
      const slides = moduleEl.querySelectorAll('.slide');
      slides.forEach((s, i) => s.classList.toggle('active', i === currentSlide));

      // Build visible-only progress dots (skip tier-hidden slides)
      const progress = document.getElementById('progress');
      let dots = '';
      let visibleIndex = 0;
      let currentVisibleIndex = 0;
      let visibleTotal = 0;
      for (let i = 0; i < slides.length; i++) {
        if (getComputedStyle(slides[i]).display === 'none') continue;
        if (i === currentSlide) currentVisibleIndex = visibleIndex;
        dots += `<div class="progress-dot ${i === currentSlide ? 'active' : ''}" onclick="goToSlide(${i})" role="button" tabindex="0" aria-label="Go to slide ${visibleIndex + 1}"></div>`;
        visibleIndex++;
        visibleTotal++;
      }
      progress.innerHTML = dots;

      // Update counter with visible-only count
      document.getElementById('counter').textContent = `${currentVisibleIndex + 1} / ${visibleTotal}`;

      // Update buttons — check if there's a visible next/prev
      const hasVisiblePrev = (() => { for (let i = currentSlide - 1; i >= 0; i--) { if (getComputedStyle(slides[i]).display !== 'none') return true; } return false; })();
      const hasVisibleNext = (() => { for (let i = currentSlide + 1; i < slides.length; i++) { if (getComputedStyle(slides[i]).display !== 'none') return true; } return false; })();
      document.getElementById('prevBtn').disabled = !hasVisiblePrev;
      document.getElementById('nextBtn').disabled = !hasVisibleNext;

      // Announce slide change to screen readers
      const announcer = document.getElementById('slideAnnouncer');
      if (announcer) {
        announcer.textContent = `Slide ${currentVisibleIndex + 1} of ${visibleTotal}`;
      }
    }

    function updateCounter() {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      if (moduleEl) updateSlideDisplay(moduleEl);
    }

    function goToSlide(index) {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      if (index >= 0 && index < slides.length) {
        currentSlide = index;
        updateSlideDisplay(moduleEl);
      }
    }

    function nextSlide() {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      // Skip tier-hidden slides
      for (let i = currentSlide + 1; i < slides.length; i++) {
        if (getComputedStyle(slides[i]).display !== 'none') {
          currentSlide = i;
          updateSlideDisplay(moduleEl);
          return;
        }
      }
    }

    function prevSlide() {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      for (let i = currentSlide - 1; i >= 0; i--) {
        if (getComputedStyle(slides[i]).display !== 'none') {
          currentSlide = i;
          updateSlideDisplay(moduleEl);
          return;
        }
      }
    }

    function nextModule() {
      if (currentModule < modules.length - 1) {
        goToModule(currentModule + 1);
      }
    }

    function updateProgress() {
      const percent = Math.round((currentModule / (modules.length - 1)) * 100);
      document.getElementById('progressPercent').textContent = percent + '%';
    }

    // ============================================================
    // TOOLS PANEL
    // ============================================================

    function toggleToolsPanel() {
      const panel = document.getElementById('toolsPanel');
      const contentBody = document.querySelector('.content-body');
      panel.classList.toggle('visible');
      contentBody.classList.toggle('tools-open');
    }

    function toggleSection(header) {
      const body = header.nextElementSibling;
      body.style.display = body.style.display === 'none' ? 'block' : 'none';
      header.querySelector('span').textContent = body.style.display === 'none' ? '▼' : '▲';
    }

    // ============================================================
    // EFFECT SIZE CALCULATOR
    // ============================================================

    function calculateEffectSize() {
      const type = document.getElementById('effectType').value;
      const eventsTx = parseFloat(document.getElementById('eventsTx').value);
      const nTx = parseFloat(document.getElementById('nTx').value);
      const eventsCtrl = parseFloat(document.getElementById('eventsCtrl').value);
      const nCtrl = parseFloat(document.getElementById('nCtrl').value);

      if (isNaN(eventsTx) || isNaN(nTx) || isNaN(eventsCtrl) || isNaN(nCtrl)) {
        alert('Please enter all values');
        return;
      }

      let effect, se, ciLo, ciHi;
      const cc = 0.5; // continuity correction

      if (type === 'OR') {
        const a = eventsTx + cc, b = nTx - eventsTx + cc;
        const c = eventsCtrl + cc, d = nCtrl - eventsCtrl + cc;
        const or = (a * d) / (b * c);
        se = Math.sqrt(1/a + 1/b + 1/c + 1/d);
        effect = or;
        ciLo = Math.exp(Math.log(or) - 1.96 * se);
        ciHi = Math.exp(Math.log(or) + 1.96 * se);
      } else if (type === 'RR') {
        const p1 = (eventsTx + cc) / (nTx + 2*cc);
        const p2 = (eventsCtrl + cc) / (nCtrl + 2*cc);
        const rr = p1 / p2;
        se = Math.sqrt((1 - p1) / (eventsTx + cc) + (1 - p2) / (eventsCtrl + cc));
        effect = rr;
        ciLo = Math.exp(Math.log(rr) - 1.96 * se);
        ciHi = Math.exp(Math.log(rr) + 1.96 * se);
      } else if (type === 'RD') {
        const p1 = eventsTx / nTx, p2 = eventsCtrl / nCtrl;
        effect = p1 - p2;
        se = Math.sqrt(p1 * (1 - p1) / nTx + p2 * (1 - p2) / nCtrl);
        ciLo = effect - 1.96 * se;
        ciHi = effect + 1.96 * se;
      }

      const resultsDiv = document.getElementById('effectResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Effect (${type}):</span><span class="value">${effect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">[${ciLo.toFixed(3)}, ${ciHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">SE${type === 'RD' ? '' : ' (log)'}:</span><span class="value">${se.toFixed(4)}</span></div>
      `;
    }

    // ============================================================
    // META-ANALYSIS CALCULATOR UI
    // ============================================================

    function addStudyRow() {
      const tbody = document.getElementById('studyTableBody');
      const rowCount = tbody.rows.length + 1;
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input type="text" value="Study ${rowCount}"></td>
        <td><input type="number" step="0.01" value="1.00"></td>
        <td><input type="number" step="0.01" value="0.80"></td>
        <td><input type="number" step="0.01" value="1.25"></td>
        <td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
      `;
      tbody.appendChild(row);
    }

    function removeStudyRow(btn) {
      const row = btn.closest('tr');
      row.remove();
    }

    function runMetaAnalysis() {
      const rows = document.getElementById('studyTableBody').rows;
      const studies = [];

      for (const row of rows) {
        const inputs = row.querySelectorAll('input');
        const label = inputs[0].value;
        const effect = parseFloat(inputs[1].value);
        const ciLo = parseFloat(inputs[2].value);
        const ciHi = parseFloat(inputs[3].value);

        if (!isNaN(effect) && !isNaN(ciLo) && !isNaN(ciHi)) {
          studies.push({ label, effect, ciLo, ciHi, isRatioMeasure: true });
        }
      }

      if (studies.length < 2) {
        alert('Need at least 2 studies');
        return;
      }

      const tau2Method = document.getElementById('tau2Method').value;
      const useHKSJ = document.getElementById('useHKSJ').checked;

      const result = calculateMetaAnalysis(studies, { tau2Estimator: tau2Method, useHKSJ });

      // Save for publication bias tools
      lastMetaStudies = studies;
      lastMetaResult = result;

      if (result.error) {
        alert(result.error);
        return;
      }

      // Display results
      const resultsDiv = document.getElementById('maResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Pooled Effect:</span><span class="value">${result.pooledEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">[${result.pooledCiLo.toFixed(3)}, ${result.pooledCiHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">p-value:</span><span class="value">${result.pValue < 0.001 ? '< 0.001' : result.pValue.toFixed(4)}</span></div>
        <div class="result-row"><span class="label">I²:</span><span class="value">${result.i2.toFixed(1)}%</span></div>
        <div class="result-row"><span class="label">τ² (${result.tau2Method}):</span><span class="value">${result.tau2.toFixed(4)}</span></div>
        <div class="result-row"><span class="label">Q (p-value):</span><span class="value">${result.q.toFixed(2)} (${result.qPValue.toFixed(4)})</span></div>
        <div class="result-row"><span class="label">Test method:</span><span class="value">${result.testMethod}</span></div>
        ${result.predictionInterval ? `<div class="result-row"><span class="label">95% PI:</span><span class="value">[${result.predictionInterval.lo.toFixed(3)}, ${result.predictionInterval.hi.toFixed(3)}]</span></div>` : ''}
      `;

      // Generate forest plot
      const plotContainer = document.getElementById('forestPlotContainer');
      plotContainer.style.display = 'block';
      plotContainer.innerHTML = generateForestPlotHTML(studies, result);
    }

    // ============================================================
    // PICO BUILDER
    // ============================================================

    function _escHtml(s) {
      const d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }

    function generatePICO() {
      const p = _escHtml(document.getElementById('picoP').value);
      const i = _escHtml(document.getElementById('picoI').value);
      const c = _escHtml(document.getElementById('picoC').value);
      const o = _escHtml(document.getElementById('picoO').value);

      if (!p || !i || !o) {
        alert('Please fill Population, Intervention, and Outcome');
        return;
      }

      const question = `In ${p}, does ${i} compared to ${c || 'standard care'} improve ${o}?`;

      const output = document.getElementById('picoOutput');
      output.style.display = 'block';
      output.innerHTML = `
        <strong>Research Question:</strong><br>
        <em>${question}</em>
      `;
    }

    // ============================================================
    // KEYBOARD NAVIGATION — see enhanced handler below (near toggleKeyboardHelp)
    // ============================================================

    // ============================================================
    // PUBLICATION BIAS
    // ============================================================

    let lastMetaStudies = null;
    let lastMetaResult = null;

    // runMetaAnalysis now saves lastMetaStudies/lastMetaResult directly (merged from override)

    function calculateEggersTest(effects, ses) {
      const n = effects.length;
      if (n < 3) return { intercept: NaN, pValue: NaN, significant: false };
      const precision = ses.map(se => 1 / se);
      const standardizedEffects = effects.map((e, i) => e / ses[i]);
      const meanX = precision.reduce((a, b) => a + b, 0) / n;
      const meanY = standardizedEffects.reduce((a, b) => a + b, 0) / n;
      let ssXY = 0, ssXX = 0;
      for (let i = 0; i < n; i++) {
        ssXY += (precision[i] - meanX) * (standardizedEffects[i] - meanY);
        ssXX += (precision[i] - meanX) ** 2;
      }
      const slope = ssXX > 0 ? ssXY / ssXX : 0;
      const intercept = meanY - slope * meanX;
      let ssResid = 0;
      for (let i = 0; i < n; i++) {
        const predicted = intercept + slope * precision[i];
        ssResid += (standardizedEffects[i] - predicted) ** 2;
      }
      const residSE = Math.sqrt(ssResid / (n - 2));
      const interceptSE = residSE * Math.sqrt(1/n + meanX * meanX / ssXX);
      const tStat = intercept / interceptSE;
      const pValue = 2 * (1 - tCDF(Math.abs(tStat), n - 2));
      return { intercept, slope, tStat, pValue, significant: pValue < 0.1 };
    }

    function calculateBeggsTest(effects, ses) {
      const n = effects.length;
      if (n < 3) return { tau: NaN, pValue: NaN };
      const indices = effects.map((_, i) => i);
      const variances = ses.map(se => se * se);
      indices.sort((a, b) => variances[a] - variances[b]);
      const sortedEffects = indices.map(i => effects[i]);
      let concordant = 0, discordant = 0;
      for (let i = 0; i < n - 1; i++) {
        for (let j = i + 1; j < n; j++) {
          if (sortedEffects[j] > sortedEffects[i]) concordant++;
          else if (sortedEffects[j] < sortedEffects[i]) discordant++;
        }
      }
      const tau = (concordant - discordant) / (n * (n - 1) / 2);
      const se = Math.sqrt((2 * (2 * n + 5)) / (9 * n * (n - 1)));
      const z = tau / se;
      const pValue = 2 * (1 - normalCDF(Math.abs(z)));
      return { tau, z, pValue, significant: pValue < 0.1 };
    }

    function generateFunnelPlotHTML(effects, ses, pooledEffect) {
      const minEffect = Math.min(...effects) - 0.5;
      const maxEffect = Math.max(...effects) + 0.5;
      const maxSE = Math.max(...ses);
      const range = maxEffect - minEffect;

      const scaleX = (val) => ((val - minEffect) / range) * 300 + 25;
      const scaleY = (se) => (se / maxSE) * 180 + 20;

      const pooledX = scaleX(pooledEffect);

      return `
        <svg viewBox="0 0 350 220" style="width: 100%; height: 220px; font-family: 'Source Sans Pro', sans-serif;">
          <!-- Funnel shape -->
          <polygon points="${pooledX},20 ${scaleX(pooledEffect - 1.96 * maxSE)},200 ${scaleX(pooledEffect + 1.96 * maxSE)},200"
                   fill="rgba(30,39,97,0.1)" stroke="none"/>

          <!-- Axes -->
          <line x1="25" y1="200" x2="325" y2="200" stroke="#333" />
          <line x1="25" y1="20" x2="25" y2="200" stroke="#333" />

          <!-- Pooled effect line -->
          <line x1="${pooledX}" y1="20" x2="${pooledX}" y2="200" stroke="#D4AF37" stroke-width="2" stroke-dasharray="4" />

          <!-- Points -->
          ${effects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(ses[i])}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>
          `).join('')}

          <!-- Labels -->
          <text x="175" y="218" font-size="10" text-anchor="middle" fill="#666">Effect Size (log scale)</text>
          <text x="12" y="110" font-size="10" text-anchor="middle" fill="#666" transform="rotate(-90, 12, 110)">Standard Error</text>
          <text x="${pooledX}" y="15" font-size="8" text-anchor="middle" fill="#D4AF37">Pooled</text>
        </svg>
      `;
    }

    function runPublicationBias() {
      if (!lastMetaResult || !lastMetaStudies || lastMetaStudies.length < 3) {
        alert('Run meta-analysis first with at least 3 studies');
        return;
      }

      const effects = lastMetaResult.transformedEffects;
      const ses = lastMetaResult.ses;

      const egger = calculateEggersTest(effects, ses);
      const begg = calculateBeggsTest(effects, ses);

      document.getElementById('pubBiasResults').style.display = 'block';
      document.getElementById('eggerResults').innerHTML = `
        <div class="result-row"><span class="label">Egger's intercept:</span><span class="value">${egger.intercept.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Egger's p-value:</span><span class="value ${egger.significant ? 'red' : ''}">${egger.pValue.toFixed(4)} ${egger.significant ? '(Significant)' : ''}</span></div>
        <div class="result-row"><span class="label">Begg's tau:</span><span class="value">${begg.tau.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Begg's p-value:</span><span class="value ${begg.significant ? 'red' : ''}">${begg.pValue.toFixed(4)} ${begg.significant ? '(Significant)' : ''}</span></div>
        <div class="result-row"><span class="label">Interpretation:</span><span class="value">${egger.significant || begg.significant ? 'Possible small-study effects (publication bias is one explanation)' : 'No strong statistical evidence of asymmetry'}</span></div>
      `;

      const pooledLog = Math.log(lastMetaResult.pooledEffect);
      document.getElementById('funnelPlotContainer').innerHTML = generateFunnelPlotHTML(effects, ses, pooledLog);
    }

    // ============================================================
    // RISK OF BIAS 2.0
    // ============================================================

    function updateRoBOverall() {
      const domains = ['robD1', 'robD2', 'robD3', 'robD4', 'robD5'];
      const values = domains.map(id => document.getElementById(id).value);

      if (values.some(v => !v)) {
        document.getElementById('robOverall').innerHTML = '<span style="color: var(--light-text);">Complete all domains</span>';
        document.getElementById('robTrafficLight').innerHTML = '';
        return;
      }

      let overall;
      if (values.includes('high')) {
        overall = 'high';
      } else if (values.includes('some')) {
        overall = 'some';
      } else {
        overall = 'low';
      }

      const colors = { low: '#22c55e', some: '#f59e0b', high: '#C53030' };
      const labels = { low: 'Low Risk of Bias', some: 'Some Concerns', high: 'High Risk of Bias' };

      document.getElementById('robOverall').innerHTML = `
        <span style="color: ${colors[overall]};">${labels[overall]}</span>
      `;
      document.getElementById('robOverall').style.background = overall === 'low' ? 'rgba(34,197,94,0.1)' :
                                                                overall === 'some' ? 'rgba(245,158,11,0.1)' : 'rgba(197,48,48,0.1)';

      // Traffic light
      document.getElementById('robTrafficLight').innerHTML = `
        <div style="display: flex; gap: 0.25rem; justify-content: center; margin-top: 0.5rem;">
          ${domains.map((id, i) => {
            const val = values[i];
            return `<div style="width: 20px; height: 20px; border-radius: 50%; background: ${colors[val]};" title="D${i+1}: ${val}"></div>`;
          }).join('')}
        </div>
      `;
    }

    // ============================================================
    // GRADE ASSESSMENT
    // ============================================================

    function calculateGRADE() {
      const start = parseInt(document.getElementById('gradeStart').value);
      const rob = parseInt(document.getElementById('gradeRoB').value);
      const inconsistency = parseInt(document.getElementById('gradeInconsistency').value);
      const indirectness = parseInt(document.getElementById('gradeIndirectness').value);
      const imprecision = parseInt(document.getElementById('gradeImprecision').value);
      const pubBias = parseInt(document.getElementById('gradePubBias').value);

      const total = start + rob + inconsistency + indirectness + imprecision + pubBias;
      const finalScore = Math.max(1, Math.min(4, total));

      const levels = {
        4: { label: 'HIGH', color: '#22c55e', symbol: '⊕⊕⊕⊕', desc: 'Very confident the true effect is close to the estimate' },
        3: { label: 'MODERATE', color: '#3b82f6', symbol: '⊕⊕⊕○', desc: 'Moderately confident; true effect likely close to estimate' },
        2: { label: 'LOW', color: '#f59e0b', symbol: '⊕⊕○○', desc: 'Limited confidence; true effect may be substantially different' },
        1: { label: 'VERY LOW', color: '#C53030', symbol: '⊕○○○', desc: 'Very little confidence in the effect estimate' }
      };

      const level = levels[finalScore];

      document.getElementById('gradeResult').innerHTML = `
        <div style="text-align: center; padding: 1rem; background: rgba(${finalScore === 4 ? '34,197,94' : finalScore === 3 ? '59,130,246' : finalScore === 2 ? '245,158,11' : '197,48,48'},0.1); border-radius: 8px;">
          <div style="font-size: 1.5rem; letter-spacing: 0.2rem; color: ${level.color};">${level.symbol}</div>
          <div style="font-size: 1.1rem; font-weight: 700; color: ${level.color}; margin: 0.5rem 0;">${level.label}</div>
          <div style="font-size: 0.75rem; color: var(--light-text);">${level.desc}</div>
        </div>
        <div style="margin-top: 0.75rem; font-size: 0.75rem; color: var(--light-text);">
          Starting: ${start === 4 ? 'High (RCTs)' : 'Low (Observational)'}<br>
          Downgrades: ${Math.abs(rob + inconsistency + indirectness + imprecision + pubBias)} levels
        </div>
      `;
    }

    // ============================================================
    // HETEROGENEITY INTERPRETATION
    // ============================================================

    function interpretI2() {
      const i2 = parseFloat(document.getElementById('i2Input').value);

      if (isNaN(i2) || i2 < 0 || i2 > 100) {
        alert('Enter a valid I² value between 0 and 100');
        return;
      }

      let interpretation, color, recommendation;

      if (i2 <= 25) {
        interpretation = 'Low heterogeneity';
        color = '#22c55e';
        recommendation = 'Fixed-effect model may be appropriate. Results are consistent across studies.';
      } else if (i2 <= 50) {
        interpretation = 'Moderate heterogeneity';
        color = '#3b82f6';
        recommendation = 'Consider random-effects model. Investigate potential sources of variation.';
      } else if (i2 <= 75) {
        interpretation = 'Substantial heterogeneity';
        color = '#f59e0b';
        recommendation = 'Use random-effects model. Subgroup analysis or meta-regression recommended. Consider whether pooling is appropriate.';
      } else {
        interpretation = 'Considerable heterogeneity';
        color = '#C53030';
        recommendation = 'Pooling may be inappropriate. Focus on understanding sources of heterogeneity before synthesizing. Report prediction interval.';
      }

      document.getElementById('i2Interpretation').innerHTML = `
        <div style="padding: 0.75rem; background: rgba(${i2 <= 25 ? '34,197,94' : i2 <= 50 ? '59,130,246' : i2 <= 75 ? '245,158,11' : '197,48,48'},0.1); border-radius: 6px; border-left: 3px solid ${color};">
          <div style="font-weight: 700; color: ${color}; margin-bottom: 0.25rem;">I² = ${i2}%: ${interpretation}</div>
          <div style="font-size: 0.8rem; color: var(--text);">${recommendation}</div>
        </div>
      `;
    }

    // ============================================================
    // NNT/NNH CALCULATOR
    // ============================================================

    function calculateNNT() {
      const cer = parseFloat(document.getElementById('nntCER').value);
      const effectType = document.getElementById('nntEffectType').value;
      const effect = parseFloat(document.getElementById('nntEffect').value);
      const ciLo = parseFloat(document.getElementById('nntCILo').value);
      const ciHi = parseFloat(document.getElementById('nntCIHi').value);

      if (isNaN(cer) || isNaN(effect) || cer <= 0 || cer >= 1) {
        alert('Enter valid baseline risk (0 < CER < 1) and effect size');
        return;
      }

      let arr, arrLo, arrHi; // Absolute Risk Reduction

      if (effectType === 'RD') {
        arr = -effect; // RD is already absolute
        arrLo = -ciHi;
        arrHi = -ciLo;
      } else if (effectType === 'RR') {
        const eer = cer * effect;
        const eerLo = cer * ciLo;
        const eerHi = cer * ciHi;
        arr = cer - eer;
        arrLo = cer - eerHi;
        arrHi = cer - eerLo;
      } else { // OR
        const eer = (cer * effect) / (1 - cer + cer * effect);
        const eerLo = (cer * ciLo) / (1 - cer + cer * ciLo);
        const eerHi = (cer * ciHi) / (1 - cer + cer * ciHi);
        arr = cer - eer;
        arrLo = cer - eerHi;
        arrHi = cer - eerLo;
      }

      const nnt = arr !== 0 ? 1 / arr : Infinity;
      const nntLo = arrHi !== 0 ? 1 / arrHi : Infinity;
      const nntHi = arrLo !== 0 ? 1 / arrLo : Infinity;
      const ciCrossesNull = arrLo * arrHi < 0;

      const isBenefit = arr > 0;
      const label = isBenefit ? 'NNT (Benefit)' : 'NNH (Harm)';
      const color = isBenefit ? 'var(--green)' : 'var(--red)';

      let nntCiText;
      if (ciCrossesNull) {
        // Altman (1998) convention: NNTB X to ∞ to NNTH Y
        const nntB = arrHi > 0 ? Math.abs(1 / arrHi).toFixed(1) : Math.abs(1 / arrLo).toFixed(1);
        const nntH = arrLo < 0 ? Math.abs(1 / arrLo).toFixed(1) : Math.abs(1 / arrHi).toFixed(1);
        nntCiText = `NNTB ${nntB} to \u221E to NNTH ${nntH}`;
      } else {
        nntCiText = `[${Math.abs(nntLo).toFixed(1)}, ${Math.abs(nntHi).toFixed(1)}]`;
      }

      const resultsDiv = document.getElementById('nntResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Baseline Risk (CER):</span><span class="value">${(cer * 100).toFixed(1)}%</span></div>
        <div class="result-row"><span class="label">Absolute Risk Reduction:</span><span class="value">${(arr * 100).toFixed(2)}%</span></div>
        <div class="result-row"><span class="label" style="color: ${color}; font-weight: 700;">${label}:</span><span class="value" style="color: ${color}; font-weight: 700;">${Math.abs(nnt).toFixed(1)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">${nntCiText}</span></div>
        ${ciCrossesNull ? '<div style="margin-top: 0.5rem; padding: 0.4rem; background: rgba(234,179,8,0.15); border-radius: 4px; font-size: 0.7rem; color: var(--text);">CI crosses the null \u2014 effect may be beneficial or harmful</div>' : ''}
        <div style="margin-top: 0.75rem; padding: 0.5rem; background: rgba(${isBenefit ? '34,197,94' : '197,48,48'},0.1); border-radius: 4px; font-size: 0.75rem;">
          ${isBenefit
            ? `Treat <strong>${Math.ceil(Math.abs(nnt))}</strong> patients to prevent 1 event`
            : `Treat <strong>${Math.ceil(Math.abs(nnt))}</strong> patients before causing 1 harm`}
        </div>
      `;
    }

    // ============================================================
    // LEAVE-ONE-OUT SENSITIVITY ANALYSIS
    // ============================================================

    function runLeaveOneOut() {
      if (!lastMetaStudies || lastMetaStudies.length < 3) {
        alert('Run meta-analysis first with at least 3 studies');
        return;
      }

      const tau2Method = document.getElementById('tau2Method').value;
      const useHKSJ = document.getElementById('useHKSJ').checked;
      const results = [];

      // Run meta-analysis leaving out each study
      for (let i = 0; i < lastMetaStudies.length; i++) {
        const subset = lastMetaStudies.filter((_, idx) => idx !== i);
        const ma = calculateMetaAnalysis(subset, { tau2Estimator: tau2Method, useHKSJ });
        results.push({
          omitted: lastMetaStudies[i].label,
          effect: ma.pooledEffect,
          ciLo: ma.pooledCiLo,
          ciHi: ma.pooledCiHi,
          i2: ma.i2,
          pValue: ma.pValue
        });
      }

      // Find most influential study
      const originalEffect = lastMetaResult.pooledEffect;
      let maxChange = 0;
      let mostInfluential = '';
      results.forEach(r => {
        const change = (lastMetaResult.isRatio !== false && r.effect > 0 && originalEffect > 0)
          ? Math.abs(Math.log(r.effect) - Math.log(originalEffect))
          : Math.abs(r.effect - originalEffect);
        if (change > maxChange) {
          maxChange = change;
          mostInfluential = r.omitted;
        }
      });

      // Check if any exclusion changes significance
      const originalSig = lastMetaResult.pValue < 0.05;
      const sensitivityIssue = results.some(r => (r.pValue < 0.05) !== originalSig);

      document.getElementById('looResults').style.display = 'block';
      document.getElementById('looSummary').innerHTML = `
        <div class="result-row"><span class="label">Original pooled effect:</span><span class="value">${originalEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Most influential study:</span><span class="value">${_escHtml(mostInfluential)}</span></div>
        <div class="result-row"><span class="label">Sensitivity concern:</span><span class="value ${sensitivityIssue ? 'red' : ''}">${sensitivityIssue ? 'Yes - significance changes' : 'No - results robust'}</span></div>
        <div style="margin-top: 0.5rem; font-size: 0.7rem; color: var(--light-text);">
          ${results.map(r => `Omit ${_escHtml(r.omitted)}: ${r.effect.toFixed(3)} [${r.ciLo.toFixed(3)}, ${r.ciHi.toFixed(3)}] I²=${r.i2.toFixed(0)}%`).join('<br>')}
        </div>
      `;

      // Generate LOO forest plot
      document.getElementById('looPlotContainer').innerHTML = generateLOOPlotHTML(results, lastMetaResult);
    }

    function generateLOOPlotHTML(looResults, originalMeta) {
      const allEffects = [...looResults.map(r => r.effect), originalMeta.pooledEffect];
      const allLo = [...looResults.map(r => r.ciLo), originalMeta.pooledCiLo];
      const allHi = [...looResults.map(r => r.ciHi), originalMeta.pooledCiHi];

      const minEffect = Math.min(...allLo, 0.5);
      const maxEffect = Math.max(...allHi, 2.0);
      const range = maxEffect - minEffect;

      const scale = (val) => ((val - minEffect) / range) * 280 + 80;
      const height = (looResults.length + 2) * 22 + 30;

      return `
        <svg viewBox="0 0 500 ${height}" style="width: 100%; height: ${height}px; font-family: 'Source Sans Pro', sans-serif;">
          <line x1="${scale(1)}" y1="10" x2="${scale(1)}" y2="${height - 20}" stroke="#ddd" stroke-width="1" stroke-dasharray="3" />
          <text x="40" y="15" font-size="8" fill="#666" font-weight="600">Omitting:</text>
          ${looResults.map((r, i) => {
            const y = 25 + i * 22;
            return `
              <text x="5" y="${y + 3}" font-size="8" fill="#333">${_escHtml(r.omitted)}</text>
              <line x1="${scale(r.ciLo)}" y1="${y}" x2="${scale(r.ciHi)}" y2="${y}" stroke="#1E2761" stroke-width="1" />
              <circle cx="${scale(r.effect)}" cy="${y}" r="4" fill="#1E2761" />
              <text x="380" y="${y + 3}" font-size="7" fill="#333">${r.effect.toFixed(2)} [${r.ciLo.toFixed(2)}, ${r.ciHi.toFixed(2)}]</text>
            `;
          }).join('')}
          <line x1="${scale(originalMeta.pooledCiLo)}" y1="${height - 25}" x2="${scale(originalMeta.pooledCiHi)}" y2="${height - 25}" stroke="#D4AF37" stroke-width="2" />
          <polygon points="${scale(originalMeta.pooledEffect)},${height - 30} ${scale(originalMeta.pooledEffect) - 5},${height - 25} ${scale(originalMeta.pooledEffect)},${height - 20} ${scale(originalMeta.pooledEffect) + 5},${height - 25}" fill="#D4AF37" />
          <text x="5" y="${height - 22}" font-size="8" font-weight="bold" fill="#D4AF37">All studies</text>
          <text x="380" y="${height - 22}" font-size="7" font-weight="bold" fill="#333">${originalMeta.pooledEffect.toFixed(2)} [${originalMeta.pooledCiLo.toFixed(2)}, ${originalMeta.pooledCiHi.toFixed(2)}]</text>
        </svg>
      `;
    }

    // ============================================================
    // TRIM-AND-FILL
    // ============================================================

    function runTrimAndFill() {
      if (!lastMetaResult || !lastMetaStudies || lastMetaStudies.length < 3) {
        alert('Run meta-analysis first with at least 3 studies');
        return;
      }

      const estimator = document.getElementById('trimFillEstimator').value;
      const side = document.getElementById('trimFillSide').value;

      const effects = [...lastMetaResult.transformedEffects];
      const ses = [...lastMetaResult.ses];
      const k = effects.length;

      // Get initial pooled estimate
      const weights = ses.map(se => 1 / (se * se));
      const sumW = weights.reduce((a, b) => a + b, 0);
      let theta = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;

      // Calculate ranks of |yi - theta| for each study
      const deviations = effects.map((e, i) => ({
        idx: i,
        dev: e - theta,
        absDev: Math.abs(e - theta),
        se: ses[i]
      }));

      // Sort by absolute deviation
      deviations.sort((a, b) => a.absDev - b.absDev);
      const ranks = deviations.map((d, i) => ({ ...d, rank: i + 1 }));

      // Count studies on the specified side
      let n0;
      if (estimator === 'L0') {
        // Linear estimator
        const T = ranks.reduce((sum, r) => {
          const onSide = (side === 'right' && r.dev > 0) || (side === 'left' && r.dev < 0);
          return sum + (onSide ? r.rank : 0);
        }, 0);
        n0 = Math.max(0, Math.round((4 * T - k * (k + 1)) / (2 * k - 1)));
      } else {
        // R0 rank-based estimator
        const gamma = ranks.reduce((sum, r) => {
          const onSide = (side === 'right' && r.dev > 0) || (side === 'left' && r.dev < 0);
          return sum + (onSide ? 1 : 0);
        }, 0);
        n0 = Math.max(0, Math.round((4 * gamma - k + 1) / 3));
      }

      const nFilled = Math.round(n0);

      // Impute missing studies by reflecting the most extreme ones
      const sortedBySide = [...ranks].sort((a, b) => {
        if (side === 'right') return b.dev - a.dev;
        return a.dev - b.dev;
      });

      const imputedEffects = [...effects];
      const imputedSEs = [...ses];
      const imputedLabels = lastMetaStudies.map(s => s.label);

      for (let i = 0; i < nFilled && i < sortedBySide.length; i++) {
        const study = sortedBySide[i];
        const mirroredEffect = 2 * theta - study.dev - theta; // = -study.dev relative to theta
        imputedEffects.push(2 * theta - effects[study.idx]);
        imputedSEs.push(ses[study.idx]);
        imputedLabels.push(`[Imputed ${i + 1}]`);
      }

      // Recalculate pooled effect with imputed studies
      const newWeights = imputedSEs.map(se => 1 / (se * se));
      const newSumW = newWeights.reduce((a, b) => a + b, 0);
      const adjustedTheta = imputedEffects.reduce((sum, e, i) => sum + e * newWeights[i], 0) / newSumW;
      const adjustedSE = Math.sqrt(1 / newSumW);

      const isRatio = lastMetaResult.isRatio;
      const tfZCrit = normalQuantile(1 - (1 - (lastMetaResult.confidenceLevel || 0.95)) / 2);
      const adjustedEffect = isRatio ? Math.exp(adjustedTheta) : adjustedTheta;
      const adjustedCILo = isRatio ? Math.exp(adjustedTheta - tfZCrit * adjustedSE) : adjustedTheta - tfZCrit * adjustedSE;
      const adjustedCIHi = isRatio ? Math.exp(adjustedTheta + tfZCrit * adjustedSE) : adjustedTheta + tfZCrit * adjustedSE;

      const originalEffect = lastMetaResult.pooledEffect;
      const changePercent = ((adjustedEffect - originalEffect) / originalEffect * 100).toFixed(1);

      document.getElementById('trimFillResults').style.display = 'block';
      document.getElementById('trimFillSummary').innerHTML = `
        <div class="result-row"><span class="label">Studies imputed:</span><span class="value">${nFilled}</span></div>
        <div class="result-row"><span class="label">Original effect:</span><span class="value">${originalEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Adjusted effect:</span><span class="value ${nFilled > 0 ? 'red' : ''}">${adjustedEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Adjusted ${Math.round((lastMetaResult.confidenceLevel || 0.95) * 100)}% CI:</span><span class="value">[${adjustedCILo.toFixed(3)}, ${adjustedCIHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">Change:</span><span class="value">${changePercent}%</span></div>
        ${nFilled > 0 ? `
          <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(197,48,48,0.1); border-radius: 4px; font-size: 0.75rem;">
            <strong>Caution:</strong> ${nFilled} potentially missing studies imputed.
            Treat this as sensitivity analysis, not correction; assumptions may not hold under severe asymmetry.
          </div>
        ` : `
          <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(34,197,94,0.1); border-radius: 4px; font-size: 0.75rem;">
            No missing studies detected on the ${side} side.
          </div>
        `}
      `;

      // Generate filled funnel plot
      document.getElementById('trimFillPlotContainer').innerHTML = generateFilledFunnelHTML(
        lastMetaResult.transformedEffects,
        lastMetaResult.ses,
        imputedEffects.slice(k),
        imputedSEs.slice(k),
        adjustedTheta,
        Math.log(originalEffect)
      );
    }

    function generateFilledFunnelHTML(origEffects, origSEs, impEffects, impSEs, adjustedTheta, originalTheta) {
      const allEffects = [...origEffects, ...impEffects];
      const allSEs = [...origSEs, ...impSEs];

      const minEffect = Math.min(...allEffects) - 0.5;
      const maxEffect = Math.max(...allEffects) + 0.5;
      const maxSE = Math.max(...allSEs);
      const range = maxEffect - minEffect;

      const scaleX = (val) => ((val - minEffect) / range) * 280 + 35;
      const scaleY = (se) => (se / maxSE) * 160 + 20;

      return `
        <svg viewBox="0 0 350 200" style="width: 100%; height: 200px; font-family: 'Source Sans Pro', sans-serif;">
          <!-- Original funnel -->
          <polygon points="${scaleX(originalTheta)},20 ${scaleX(originalTheta - 1.96 * maxSE)},180 ${scaleX(originalTheta + 1.96 * maxSE)},180"
                   fill="rgba(30,39,97,0.05)" stroke="rgba(30,39,97,0.3)" stroke-dasharray="3"/>
          <!-- Adjusted funnel -->
          <polygon points="${scaleX(adjustedTheta)},20 ${scaleX(adjustedTheta - 1.96 * maxSE)},180 ${scaleX(adjustedTheta + 1.96 * maxSE)},180"
                   fill="rgba(212,175,55,0.1)" stroke="#D4AF37"/>

          <!-- Original effect line -->
          <line x1="${scaleX(originalTheta)}" y1="20" x2="${scaleX(originalTheta)}" y2="180" stroke="#1E2761" stroke-width="1" stroke-dasharray="4" />
          <!-- Adjusted effect line -->
          <line x1="${scaleX(adjustedTheta)}" y1="20" x2="${scaleX(adjustedTheta)}" y2="180" stroke="#D4AF37" stroke-width="2" />

          <!-- Original studies -->
          ${origEffects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(origSEs[i])}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>
          `).join('')}

          <!-- Imputed studies -->
          ${impEffects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(impSEs[i])}" r="5" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="2"/>
          `).join('')}

          <!-- Legend -->
          <circle cx="280" cy="15" r="4" fill="#1E2761"/>
          <text x="290" y="18" font-size="7" fill="#666">Original</text>
          <circle cx="280" cy="28" r="4" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="2"/>
          <text x="290" y="31" font-size="7" fill="#666">Imputed</text>

          <text x="175" y="198" font-size="9" text-anchor="middle" fill="#666">Effect Size (log scale)</text>
        </svg>
      `;
    }

    // ============================================================
    // GAMIFICATION & PROGRESS SYSTEM
    // ============================================================

    const STORAGE_KEY = 'evidence_reversal_course_progress';

    // Seven Principles for tracking
    const sevenPrinciples = [
      "Not every signal is truth.",
      "Methods protect patients from our confidence.",
      "What was hidden in plain sight?",
      "The number without provenance is not a number.",
      "Heterogeneity is a message, not noise.",
      "Absence of evidence is not evidence of absence.",
      "Certainty must be earned, not assumed."
    ];

    // Badge definitions
    const badges = [
      { id: 'first_module', icon: '🎯', name: 'First Steps', desc: 'Complete your first module' },
      { id: 'predictor', icon: '🔮', name: 'Predictor', desc: 'Make your first prediction' },
      { id: 'correct_prediction', icon: '✨', name: 'Sharp Mind', desc: 'Predict correctly' },
      { id: 'five_modules', icon: '📚', name: 'Scholar', desc: 'Complete 5 modules' },
      { id: 'all_predictions', icon: '🎱', name: 'Oracle', desc: 'Make all predictions' },
      { id: 'streak_3', icon: '🔥', name: 'On Fire', desc: '3-day streak' },
      { id: 'quiz_master', icon: '🏆', name: 'Quiz Master', desc: 'Complete 5 quizzes' },
      { id: 'ready_practice', icon: '🚀', name: 'Ready for Practice', desc: 'Complete the Capstone module' },
      { id: 'completionist', icon: '👑', name: 'Completionist', desc: 'Finish all modules' }
    ];

    // Level definitions
    const levels = [
      { name: 'Novice', minPoints: 0 },
      { name: 'Apprentice', minPoints: 200 },
      { name: 'Practitioner', minPoints: 500 },
      { name: 'Expert', minPoints: 1000 },
      { name: 'Master', minPoints: 2000 }
    ];

    // Gamification state
    let gameState = {
      points: 0,
      earnedBadges: [],
      streak: 0,
      lastVisitDate: null,
      principlesMastered: [],
      quizzesCompleted: 0
    };

    function getLevel(points) {
      for (let i = levels.length - 1; i >= 0; i--) {
        if (points >= levels[i].minPoints) return { level: i + 1, name: levels[i].name };
      }
      return { level: 1, name: 'Novice' };
    }

    function awardPoints(amount, reason) {
      gameState.points += amount;
      updateSidebarPoints();
      saveProgress();
    }

    function earnBadge(badgeId) {
      if (!gameState.earnedBadges.includes(badgeId)) {
        gameState.earnedBadges.push(badgeId);
        saveProgress();
      }
    }

    function checkBadges() {
      const completedModules = document.querySelectorAll('.module-item.completed').length;
      const predictionCount = Object.keys(storyPredictions).length;
      const correctPredictions = Object.values(storyPredictions).filter(p => p.correct).length;

      if (completedModules >= 1) earnBadge('first_module');
      if (completedModules >= 5) earnBadge('five_modules');
      if (completedModules >= 23) earnBadge('ready_practice');
      if (completedModules >= 15) earnBadge('completionist');
      if (predictionCount >= 1) earnBadge('predictor');
      if (correctPredictions >= 1) earnBadge('correct_prediction');
      if (predictionCount >= 11) earnBadge('all_predictions');
      if (gameState.streak >= 3) earnBadge('streak_3');
      if (gameState.quizzesCompleted >= 5) earnBadge('quiz_master');
    }

    function updateStreak() {
      const today = new Date().toDateString();
      if (gameState.lastVisitDate) {
        const lastVisit = new Date(gameState.lastVisitDate).toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        if (lastVisit === today) { /* Same day */ }
        else if (lastVisit === yesterday) { gameState.streak++; awardPoints(10, 'Daily streak'); }
        else { gameState.streak = 1; }
      } else { gameState.streak = 1; }
      gameState.lastVisitDate = new Date().toISOString();
    }

    function saveProgress() {
      const completedModules = [];
      document.querySelectorAll('.module-item.completed').forEach(el => {
        completedModules.push(parseInt(el.dataset.module));
      });

      const progress = {
        currentModule, currentSlide, completedModules,
        lastVisit: new Date().toISOString(),
        gameState: gameState,
        predictions: storyPredictions,
        spacedRepetition: spacedRepetitionState,
        scenarioState: scenarioState,
        calibrationState: calibrationState
      };

      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        updateSidebarPoints();
      } catch (e) { console.log('Could not save progress'); }
    }

    function loadProgress() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          const progress = JSON.parse(saved);
          // Migrate old module IDs: 13→23, 14→24 (one-time)
          if (!progress._migrated25) {
            const remap = {13: 23, 14: 24};
            progress.completedModules = progress.completedModules.map(id => remap[id] || id);
            if (remap[progress.currentModule]) progress.currentModule = remap[progress.currentModule];
            progress._migrated25 = true;
            try { localStorage.setItem(STORAGE_KEY, JSON.stringify(progress)); } catch(e) {}
          }
          progress.completedModules.forEach(moduleId => {
            const el = document.querySelector(`.module-item[data-module="${moduleId}"]`);
            if (el) el.classList.add('completed');
          });
          if (progress.gameState) gameState = progress.gameState;
          if (progress.predictions) Object.assign(storyPredictions, progress.predictions);
          if (progress.spacedRepetition) {
            spacedRepetitionState = progress.spacedRepetition;
          }
          if (progress.scenarioState) {
            scenarioState = progress.scenarioState;
          }
          if (progress.calibrationState) {
            calibrationState = progress.calibrationState;
          }
          updateStreak();
          updateSidebarPoints();
          if (progress.currentModule !== undefined) {
            return { module: progress.currentModule, slide: progress.currentSlide || 0 };
          }
        }
      } catch (e) { console.log('Could not load progress'); }
      return null;
    }

    function resetProgress() {
      if (confirm('Reset all progress including points and badges?')) {
        try {
          localStorage.removeItem(STORAGE_KEY);
          document.querySelectorAll('.module-item.completed').forEach(el => el.classList.remove('completed'));
          gameState = { points: 0, earnedBadges: [], streak: 0, lastVisitDate: null, principlesMastered: [], quizzesCompleted: 0 };
          storyPredictions = {};
          spacedRepetitionState = { principles: {}, lastDailyReview: null, dailyReviewsCompleted: 0 };
          scenarioState = { completed: {}, scores: {} };
          calibrationState = { predictions: [], totalPredictions: 0, calibrationScore: null };
          updateSidebarPoints();
          updateReviewButtonStatus();
          goToModule(0);
          alert('Progress reset successfully.');
        } catch (e) { console.log('Could not reset progress'); }
      }
    }

    function markModuleComplete(moduleId) {
      const el = document.querySelector(`.module-item[data-module="${moduleId}"]`);
      if (el && !el.classList.contains('completed')) {
        el.classList.add('completed');
        awardPoints(100, 'Module completed');
        checkBadges();
      }
      saveProgress();
    }

    function updateSidebarPoints() {
      const el = document.getElementById('sidebarPoints');
      if (el) el.textContent = gameState.points + ' pts';
    }

    // ============================================================
    // PROGRESS DASHBOARD
    // ============================================================

    function openDashboard() {
      updateDashboardDisplay();
      document.getElementById('progressDashboard').classList.add('open');
    }

    function closeDashboard() {
      document.getElementById('progressDashboard').classList.remove('open');
    }

    function updateDashboardDisplay() {
      const levelInfo = getLevel(gameState.points);
      document.getElementById('levelBadge').textContent = `Level ${levelInfo.level}: ${levelInfo.name}`;
      document.getElementById('totalPoints').textContent = gameState.points;

      const completedModules = document.querySelectorAll('.module-item.completed').length;
      document.getElementById('modulesCompleted').textContent = `${completedModules}/${modules.length}`;

      const predictionCount = Object.keys(storyPredictions).length;
      const correctPredictions = Object.values(storyPredictions).filter(p => p.correct).length;
      document.getElementById('predictionsCorrect').textContent = `${correctPredictions}/${predictionCount}`;
      document.getElementById('quizzesCompleted').textContent = gameState.quizzesCompleted;

      const principlesHtml = sevenPrinciples.map((p, i) => {
        const mastered = gameState.principlesMastered.includes(i);
        return `<div class="principle-item">
          <div class="principle-num ${mastered ? 'mastered' : ''}">${i + 1}</div>
          <div class="principle-text">"${p}"</div>
          <span>${mastered ? '✓' : ''}</span>
        </div>`;
      }).join('');
      document.getElementById('principlesList').innerHTML = principlesHtml;

      const badgesHtml = badges.map(b => {
        const earned = gameState.earnedBadges.includes(b.id);
        return `<div class="badge ${earned ? 'earned' : ''}" title="${b.name}: ${b.desc}">
          ${b.icon}<div class="badge-tooltip">${b.name}</div>
        </div>`;
      }).join('');
      document.getElementById('badgesGrid').innerHTML = badgesHtml;

      document.getElementById('streakCount').textContent = `${gameState.streak} day${gameState.streak !== 1 ? 's' : ''}`;
      document.getElementById('streakFlame').textContent = gameState.streak >= 3 ? '🔥' : '💨';
    }

    // ============================================================
    // SPACED REPETITION ENGINE
    // ============================================================

    // Questions for each principle (used in daily review)
    const principleQuestions = [
      { // Principle 1: "Not every signal is truth."
        principle: 0,
        question: "When a drug shows benefits in observational studies, what should you remember?",
        options: [
          "The benefit is probably real and should guide treatment",
          "Not every signal is truth - RCTs are needed to confirm",
          "Observational studies are always biased and useless",
          "We should immediately conduct a meta-analysis"
        ],
        correct: 1,
        explanation: "Observational signals can be confounded. CAST showed that antiarrhythmics, which appeared beneficial, actually tripled mortality in RCTs."
      },
      { // Principle 2: "Methods protect patients from our confidence."
        principle: 1,
        question: "Why do we pre-register protocols before conducting a meta-analysis?",
        options: [
          "To impress journal editors",
          "Methods protect patients from our confidence",
          "It's required by law in most countries",
          "To speed up the publication process"
        ],
        correct: 1,
        explanation: "Pre-registration prevents us from unconsciously biasing results toward what we expect. HRT observational studies were affected by healthy user bias."
      },
      { // Principle 3: "What was hidden in plain sight?"
        principle: 2,
        question: "When evaluating publication bias, what question should guide your thinking?",
        options: [
          "Are the authors reputable?",
          "Is the journal high impact?",
          "What was hidden in plain sight?",
          "How many studies were included?"
        ],
        correct: 2,
        explanation: "Rosiglitazone's cardiac risks were buried in unpublished FDA data. Always search beyond published literature for the complete picture."
      },
      { // Principle 4: "The number without provenance is not a number."
        principle: 3,
        question: "What makes an effect size trustworthy in meta-analysis?",
        options: [
          "Its statistical significance (p < 0.05)",
          "Clear provenance - knowing exactly where it came from",
          "Publication in a high-impact journal",
          "Agreement with biological plausibility"
        ],
        correct: 1,
        explanation: "DECREASE trials showed fabricated data. Without verifiable provenance (raw data, audit trail), numbers cannot be trusted."
      },
      { // Principle 5: "Heterogeneity is a message, not noise."
        principle: 4,
        question: "When you see high heterogeneity (I² = 80%) in a meta-analysis, what should you think?",
        options: [
          "The meta-analysis has failed and should be abandoned",
          "Use a random-effects model and ignore it",
          "Heterogeneity is a message - investigate its sources",
          "Average the results anyway, that's what meta-analysis does"
        ],
        correct: 2,
        explanation: "ACCORD showed that intensive glucose control had different effects in different patient subgroups. High I² signals important effect modification."
      },
      { // Principle 6: "Absence of evidence is not evidence of absence."
        principle: 5,
        question: "A meta-analysis of 3 small trials shows no significant effect (p = 0.15). What does this mean?",
        options: [
          "The treatment definitely doesn't work",
          "Absence of evidence is not evidence of absence",
          "We need exactly 5 more trials to be sure",
          "The treatment is harmful"
        ],
        correct: 1,
        explanation: "Small studies may lack power to detect real effects. Early surfactant trials initially showed 'no effect' due to small samples, but larger studies proved benefit."
      },
      { // Principle 7: "Certainty must be earned, not assumed."
        principle: 6,
        question: "What does the GRADE framework help us assess?",
        options: [
          "Whether a treatment is cost-effective",
          "How certain we can be in the evidence",
          "Whether authors have conflicts of interest",
          "The optimal sample size for future trials"
        ],
        correct: 1,
        explanation: "GRADE reminds us that certainty must be earned through high-quality evidence, not assumed from statistical significance alone."
      }
    ];

    // Extended question bank for variety
    const extendedQuestions = [
      { principle: 0, question: "The CAST trial showed antiarrhythmics increased mortality by:", options: ["50%", "100%", "200-300%", "400%"], correct: 2, explanation: "Encainide, flecainide, and moricizine roughly tripled mortality compared to placebo." },
      { principle: 1, question: "HRT appeared beneficial in observational studies due to:", options: ["Confounding by indication", "Healthy user bias", "Publication bias", "Data fabrication"], correct: 1, explanation: "Women who chose HRT were healthier at baseline (healthy user bias), creating an apparent benefit." },
      { principle: 2, question: "What percentage of negative trials often go unpublished?", options: ["10-20%", "30-40%", "40-50%", "60-80%"], correct: 2, explanation: "Studies estimate 40-50% of trials with negative results remain unpublished, distorting the evidence base." },
      { principle: 3, question: "The DECREASE trials fraud was detected through:", options: ["Peer review", "Statistical impossibilities", "Journal retraction", "Patient complaints"], correct: 1, explanation: "Patterns in the data were statistically impossible - too perfect, revealing fabrication." },
      { principle: 4, question: "What I² value suggests substantial heterogeneity?", options: [">25%", ">50%", ">75%", ">90%"], correct: 1, explanation: "I² > 50% suggests substantial heterogeneity; > 75% is considerable. Always investigate sources." },
      { principle: 5, question: "A funnel plot shows asymmetry. This suggests:", options: ["Perfect methodology", "Large sample sizes", "Possible small-study effects (publication bias is one explanation)", "High certainty"], correct: 2, explanation: "Funnel plot asymmetry can indicate small-study effects; publication bias is one explanation, but not the only one." },
      { principle: 6, question: "In GRADE, what can LOWER certainty in RCT evidence?", options: ["Large effect size", "Risk of bias", "Dose-response gradient", "Biological plausibility"], correct: 1, explanation: "Risk of bias, imprecision, inconsistency, indirectness, and publication bias can lower certainty from 'high' to lower levels." }
    ];

    // SM-2 inspired spaced repetition state
    let spacedRepetitionState = {
      principles: {}, // { 0: { lastReview: Date, interval: days, easeFactor: 2.5, repetitions: 0, nextReview: Date } }
      lastDailyReview: null,
      dailyReviewsCompleted: 0
    };

    // Initialize spaced repetition for all principles
    function initSpacedRepetition() {
      for (let i = 0; i < 7; i++) {
        if (!spacedRepetitionState.principles[i]) {
          spacedRepetitionState.principles[i] = {
            lastReview: null,
            interval: 1,
            easeFactor: 2.5,
            repetitions: 0,
            nextReview: new Date().toISOString()
          };
        }
      }
    }

    // SM-2 algorithm: update interval based on performance
    function updateSpacedRepetition(principleIndex, quality) {
      // quality: 0-5 (0-2 = fail, 3-5 = pass)
      const p = spacedRepetitionState.principles[principleIndex];
      if (!p) return;

      if (quality >= 3) {
        // Correct answer
        if (p.repetitions === 0) {
          p.interval = 1;
        } else if (p.repetitions === 1) {
          p.interval = 6;
        } else {
          p.interval = Math.round(p.interval * p.easeFactor);
        }
        p.repetitions++;
        p.easeFactor = Math.max(1.3, p.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02)));

        // Mark as mastered after 3 successful reviews
        if (p.repetitions >= 3 && !gameState.principlesMastered.includes(principleIndex)) {
          gameState.principlesMastered.push(principleIndex);
          awardPoints(50, 'Principle mastered');
          earnBadge('principle_master');
        }
      } else {
        // Incorrect answer - reset
        p.repetitions = 0;
        p.interval = 1;
      }

      p.lastReview = new Date().toISOString();
      p.nextReview = new Date(Date.now() + p.interval * 24 * 60 * 60 * 1000).toISOString();
      saveProgress();
    }

    // Get principles due for review (sorted by urgency)
    function getPrinciplesDueForReview() {
      const now = new Date();
      const due = [];

      for (let i = 0; i < 7; i++) {
        const p = spacedRepetitionState.principles[i];
        if (!p) continue;

        const nextReview = p.nextReview ? new Date(p.nextReview) : new Date(0);
        if (nextReview <= now) {
          due.push({
            index: i,
            overdueDays: Math.floor((now - nextReview) / (24 * 60 * 60 * 1000)),
            repetitions: p.repetitions
          });
        }
      }

      // Sort: most overdue first, then least practiced
      due.sort((a, b) => {
        if (b.overdueDays !== a.overdueDays) return b.overdueDays - a.overdueDays;
        return a.repetitions - b.repetitions;
      });

      return due;
    }

    // ============================================================
    // DAILY REVIEW SYSTEM
    // ============================================================

    let reviewState = {
      active: false,
      questions: [],
      currentIndex: 0,
      answers: [],
      timerInterval: null,
      timeRemaining: 120 // 2 minutes in seconds
    };

    function shouldShowDailyReview() {
      if (!spacedRepetitionState.lastDailyReview) return true;

      const lastReview = new Date(spacedRepetitionState.lastDailyReview);
      const today = new Date();

      // Check if it's a new day
      return lastReview.toDateString() !== today.toDateString();
    }

    function openDailyReview() {
      initSpacedRepetition();

      // Get principles due for review
      const duePrinciples = getPrinciplesDueForReview();

      // Select up to 5 questions (mix of due principles and random for variety)
      let selectedQuestions = [];

      // First, add questions for due principles
      duePrinciples.slice(0, 3).forEach(dp => {
        const available = [principleQuestions[dp.index], ...extendedQuestions.filter(q => q.principle === dp.index)];
        const randomQ = available[Math.floor(Math.random() * available.length)];
        if (randomQ && !selectedQuestions.find(q => q.question === randomQ.question)) {
          selectedQuestions.push({ ...randomQ });
        }
      });

      // Fill remaining with random questions
      const allQuestions = [...principleQuestions, ...extendedQuestions];
      while (selectedQuestions.length < 5) {
        const randomQ = allQuestions[Math.floor(Math.random() * allQuestions.length)];
        if (!selectedQuestions.find(q => q.question === randomQ.question)) {
          selectedQuestions.push({ ...randomQ });
        }
      }

      // Shuffle
      selectedQuestions.sort(() => Math.random() - 0.5);

      // Initialize review state
      reviewState = {
        active: true,
        questions: selectedQuestions.slice(0, 5),
        currentIndex: 0,
        answers: [],
        timerInterval: null,
        timeRemaining: 120
      };

      // Show modal
      document.getElementById('dailyReviewModal').classList.add('open');

      // Render progress dots
      renderReviewProgress();

      // Render first question
      renderReviewQuestion();

      // Start timer
      startReviewTimer();
    }

    function closeDailyReview() {
      reviewState.active = false;
      if (reviewState.timerInterval) {
        clearInterval(reviewState.timerInterval);
      }
      document.getElementById('dailyReviewModal').classList.remove('open');
    }

    function skipDailyReview() {
      spacedRepetitionState.lastDailyReview = new Date().toISOString();
      saveProgress();
      closeDailyReview();
      updateReviewButtonStatus();
    }

    function startReviewTimer() {
      const timerEl = document.getElementById('reviewTimer');

      reviewState.timerInterval = setInterval(() => {
        reviewState.timeRemaining--;

        const mins = Math.floor(reviewState.timeRemaining / 60);
        const secs = reviewState.timeRemaining % 60;
        timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;

        if (reviewState.timeRemaining <= 0) {
          clearInterval(reviewState.timerInterval);
          finishDailyReview();
        }
      }, 1000);
    }

    function renderReviewProgress() {
      const container = document.getElementById('reviewProgress');
      container.innerHTML = reviewState.questions.map((_, i) => {
        let cls = 'progress-dot';
        if (i < reviewState.currentIndex) cls += ' completed';
        if (i === reviewState.currentIndex) cls += ' current';
        return `<div class="${cls}"></div>`;
      }).join('');
    }

    function renderReviewQuestion() {
      if (reviewState.currentIndex >= reviewState.questions.length) {
        finishDailyReview();
        return;
      }

      const q = reviewState.questions[reviewState.currentIndex];
      const container = document.getElementById('reviewCardContainer');

      container.innerHTML = `
        <div class="review-card">
          <div class="review-principle-num">${q.principle + 1}</div>
          <div class="review-principle-text">"${sevenPrinciples[q.principle]}"</div>
          <div class="review-question">${q.question}</div>
          <div class="review-options">
            ${q.options.map((opt, i) => `
              <button class="review-option" onclick="selectReviewAnswer(${i})">${opt}</button>
            `).join('')}
          </div>
          <div id="reviewFeedback"></div>
        </div>
      `;

      document.getElementById('reviewNextBtn').disabled = true;
    }

    function selectReviewAnswer(answerIndex) {
      const q = reviewState.questions[reviewState.currentIndex];
      const isCorrect = answerIndex === q.correct;

      // Store answer
      reviewState.answers.push({
        principle: q.principle,
        correct: isCorrect,
        selected: answerIndex
      });

      // Update spaced repetition
      updateSpacedRepetition(q.principle, isCorrect ? 4 : 1);

      // Award points
      if (isCorrect) {
        awardPoints(15, 'Ежедневный обзор верен');
      }

      // Visual feedback
      const options = document.querySelectorAll('.review-option');
      options.forEach((opt, i) => {
        opt.disabled = true;
        opt.style.cursor = 'default';
        if (i === q.correct) {
          opt.classList.add('correct');
        }
        if (i === answerIndex && !isCorrect) {
          opt.classList.add('incorrect');
        }
        if (i === answerIndex) {
          opt.classList.add('selected');
        }
      });

      // Show feedback
      const feedbackEl = document.getElementById('reviewFeedback');
      feedbackEl.innerHTML = `
        <div class="review-feedback ${isCorrect ? 'correct' : 'incorrect'}">
          ${isCorrect ? '✓ Correct!' : '✗ Not quite.'} ${q.explanation}
        </div>
      `;

      // Enable next button
      document.getElementById('reviewNextBtn').disabled = false;
    }

    function nextReviewQuestion() {
      reviewState.currentIndex++;
      renderReviewProgress();
      renderReviewQuestion();
    }

    function finishDailyReview() {
      if (reviewState.timerInterval) {
        clearInterval(reviewState.timerInterval);
      }

      const correctCount = reviewState.answers.filter(a => a.correct).length;
      const totalCount = reviewState.answers.length;
      const score = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;

      // Update state
      spacedRepetitionState.lastDailyReview = new Date().toISOString();
      spacedRepetitionState.dailyReviewsCompleted++;
      gameState.quizzesCompleted++;
      saveProgress();
      checkBadges();

      // Award bonus for perfect score
      if (correctCount === totalCount && totalCount > 0) {
        awardPoints(25, 'Идеальный ежедневный обзор');
        earnBadge('perfect_review');
      }

      // Show summary
      const container = document.getElementById('reviewCardContainer');
      container.innerHTML = `
        <div class="review-summary">
          <div class="summary-score">${score}%</div>
          <div class="summary-text">Daily Review Complete!</div>

          <div class="summary-breakdown">
            <div class="summary-stat">
              <div class="summary-stat-value correct-val">${correctCount}</div>
              <div class="summary-stat-label">Correct</div>
            </div>
            <div class="summary-stat">
              <div class="summary-stat-value incorrect-val">${totalCount - correctCount}</div>
              <div class="summary-stat-label">To Review</div>
            </div>
          </div>

          ${gameState.streak >= 2 ? `
            <div class="review-streak-bonus">
              <span class="flame">🔥</span>
              <span class="text">${gameState.streak} day learning streak!</span>
            </div>
          ` : ''}
        </div>
      `;

      // Update actions
      document.getElementById('reviewActions').innerHTML = `
        <button class="review-btn next" onclick="closeDailyReview()">Continue Learning</button>
      `;

      updateReviewButtonStatus();
    }

    function updateReviewButtonStatus() {
      const btn = document.getElementById('dailyReviewBtn');
      const status = document.getElementById('reviewStatus');

      if (!btn || !status) return;

      if (shouldShowDailyReview()) {
        btn.classList.add('pending');
        status.textContent = 'Due!';
      } else {
        btn.classList.remove('pending');
        status.textContent = '✓ Done';
      }
    }

    // Add badge for spaced repetition mastery
    if (!badges.find(b => b.id === 'principle_master')) {
      badges.push({ id: 'principle_master', icon: '🎓', name: 'Principle Master', desc: 'Master a principle through spaced repetition' });
    }
    if (!badges.find(b => b.id === 'perfect_review')) {
      badges.push({ id: 'perfect_review', icon: '💯', name: 'Perfect Review', desc: 'Получите 100 % за ежедневный обзор' });
    }
    if (!badges.find(b => b.id === 'daily_dedication')) {
      badges.push({ id: 'daily_dedication', icon: '📅', name: 'Daily Dedication', desc: 'Завершите 7 ежедневных обзоров' });
    }
    if (!badges.find(b => b.id === 'scenario_solver')) {
      badges.push({ id: 'scenario_solver', icon: '🧩', name: 'Scenario Solver', desc: 'Завершите 5 сценариев ветвления.' });
    }
    if (!badges.find(b => b.id === 'well_calibrated')) {
      badges.push({ id: 'well_calibrated', icon: '🎯', name: 'Well Calibrated', desc: 'Achieve 80%+ calibration accuracy' });
    }

    // ============================================================
    // BRANCHING SCENARIOS SYSTEM
    // ============================================================

    // Scenarios based on Evidence Reversal stories - decisions with consequences
    const branchingScenarios = [
      {
        id: 'cast_scenario',
        module: 1,
        title: 'Антиаритмическое решение',
        situation: "Вы состоите в больничном формулярном комитете в 1988 году. Кардиолог представляет данные, показывающие, что энкаинид подавляет ЖЭ на 80% у пациентов после ИМ. Он хочет, чтобы его добавили в справочник для повседневного использования.",
        question: "Что вы порекомендуете?",
        choices: [
          { id: 'a', text: "Approve it - PVC suppression is a validated surrogate for mortality", consequence: 'bad', result: "Исследование CAST (1989) показало, что эти препараты утроили смертность, несмотря на подавление ЖЭ. Более 50 000 пациентов умерли от лекарств, которые «подействовали» на суррогатную мать." },
          { id: 'b', text: "Request RCT evidence on hard outcomes (death, cardiac arrest) before approval", consequence: 'good', result: "Правильный! Суррогатные конечные точки могут ввести в заблуждение. Взаимосвязь между подавлением ЖЭ и выживанием так и не была доказана и оказалась противоположной ожидаемой." },
          { id: 'c', text: "Approve for low-risk patients only", consequence: 'bad', result: "Все еще неправильно. Без данных о смертности вы не можете знать, какие пациенты могут пострадать. CAST показал вред во всех подгруппах." }
        ],
        correct: 'b',
        principle: 0,
        lesson: "Not every signal is truth. Surrogates must be validated against hard outcomes before driving treatment decisions."
      },
      {
        id: 'hrt_scenario',
        module: 2,
        title: 'Рекомендация HRT',
        situation: "1998 год. Женщина в постменопаузе спрашивает о заместительной гормональной терапии. У вас есть более 30 обсервационных исследований, показывающих снижение сердечно-сосудистых заболеваний на 40-50%. Крупных РКИ пока не существует.",
        question: "Что ты ей скажешь?",
        choices: [
          { id: 'a', text: "Настоятельно рекомендуйте ЗГТ – данные наблюдений неопровержимы.", consequence: 'bad', result: "Исследование WHI (2002 г.) показало ПОВЫШЕНИЕ сердечно-сосудистых заболеваний при ЗГТ (ОР 1,29). Наблюдательная польза была сведена на нет предвзятостью здоровых пользователей: женщины, выбравшие ЗГТ, были более здоровыми на исходном уровне." },
          { id: 'b', text: "Объясните неопределенность: данные наблюдений могут быть ошибочными, дождитесь результатов РКИ.", consequence: 'good', result: "Правильный! Вы правильно выразили неуверенность. WHI доказал, что сигнал наблюдений вводил в заблуждение из-за путаницы." },
          { id: 'c', text: "Рекомендовать ЗГТ, но только для женщин с факторами риска", consequence: 'bad', result: "Still problematic. Targeting 'high-risk' women doesn't fix confounding - it may concentrate harm." }
        ],
        correct: 'b',
        principle: 1,
        lesson: "Методы защищают пациентов от нашего доверия. Наблюдательные ассоциации не являются причинным доказательством."
      },
      {
        id: 'rosi_scenario',
        module: 3,
        title: 'Скрытые испытания',
        situation: "Вы проводите метаанализ росиглитазона при диабете в 2006 году. Вы нашли 12 опубликованных исследований. Коллега упоминает, что у FDA могут быть неопубликованные данные.",
        question: "What do you do?",
        choices: [
          { id: 'a', text: "Продолжайте использовать только опубликованные исследования – неопубликованные данные слишком сложно получить.", consequence: 'bad', result: "Метаанализ Ниссен 2007 года обнаружил неопубликованные исследования GSK. Их включение выявило увеличение риска ИМ на 43% (OR 1,43), чего нельзя было увидеть только в опубликованных данных." },
          { id: 'b', text: "File FOIA requests, search ClinicalTrials.gov, contact the manufacturer", consequence: 'good', result: "Верно! Поиск серой литературы имеет важное значение. Сердечный сигнал росиглитазона в течение многих лет был скрыт в неопубликованных нормативных материалах." },
          { id: 'c', text: "Add a sensitivity analysis assuming unpublished trials exist", consequence: 'neutral', result: "Лучше, чем ничего, но недостаточно. Вы не можете смоделировать то, что не пытались найти. Требуется активный поиск." }
        ],
        correct: 'b',
        principle: 2,
        lesson: "What was hidden in plain sight? Comprehensive searching beyond published literature is methodologically required."
      },
      {
        id: 'decrease_scenario',
        module: 5,
        title: 'Подозрительная закономерность',
        situation: "You're verifying extracted data for a meta-analysis. One prominent researcher's trials show remarkably consistent effects (I² = 0%) while other trials show high heterogeneity. His event rates are unusually balanced.",
        question: "What do you do?",
        choices: [
          { id: 'a', text: "Примите данные — низкая гетерогенность — это хорошо, и он уважаемый исследователь", consequence: 'bad', result: "Испытания Дона Полдерманса DECREASE позже оказались сфабрикованными. «Идеальная» согласованность была тревожным сигналом: реальные данные сложнее. Его мошенничество в течение многих лет влияло на рекомендации." },
          { id: 'b', text: "Request source documents and verify numbers against original publications", consequence: 'good', result: "Correct! Provenance verification caught the fraud. When investigators traced his numbers to source, patients didn't exist. 800,000 may have been harmed by guidelines built on his fabrications." },
          { id: 'c', text: "Провести анализ чувствительности, исключая его исследования", consequence: 'neutral', result: "Полезно, но недостаточно. Сначала вам следует проверить — если есть подозрение на мошенничество, исключение должно быть обосновано доказательствами, а не подозрениями." }
        ],
        correct: 'b',
        principle: 3,
        lesson: "Номер без происхождения не является числом. Каждая точка данных требует проверки своего источника."
      },
      {
        id: 'heterogeneity_scenario',
        module: 8,
        title: 'The I² Dilemma',
        situation: "Your meta-analysis of intensive glucose control shows a pooled HR of 0.91 (95% CI 0.84-0.99) for cardiovascular events, but I² = 78%. The ACCORD trial shows harm (HR 1.22) while others show benefit.",
        question: "Как вы сообщите об этом?",
        choices: [
          { id: 'a', text: "Сообщите объединенную оценку — она статистически значима и способствует лечению", consequence: 'bad', result: "Опасно! Высокая неоднородность означает, что объединенная оценка не отражает реальности. ACCORD показал, что интенсивный контроль ПОВЫШАЛ смертность у некоторых пациентов. Указание только среднего значения скрывает опасные для жизни эффекты подгруппы." },
          { id: 'b', text: "Investigate heterogeneity sources, report subgroup differences prominently", consequence: 'good', result: "Верно! ACCORD обнаружил, что интенсивный контроль наносит вред пациентам с длительным течением диабета и сердечно-сосудистыми заболеваниями. За «средней» пользой скрывается смертельный вред в конкретных подгруппах." },
          { id: 'c', text: "Use random effects and report wider confidence intervals", consequence: 'neutral', result: "Технически верно, но не соответствует сути. Случайные эффекты объясняют гетерогенность статистически, но не объясняют ее клинически. Сигнал о вреде ACCORD требует исследования, а не статистического сглаживания." }
        ],
        correct: 'b',
        principle: 4,
        lesson: "Неоднородность — это сообщение, а не шум. Высокий I² требует исследования, а не просто статистической корректировки."
      },
      {
        id: 'orbita_scenario',
        module: 4,
        title: 'Вопрос о фиктивной хирургии',
        situation: "It's 2015. You're designing a trial of PCI for stable angina. Previous unblinded trials show symptom improvement. A statistician suggests using a sham procedure (catheterization without stenting) as control.",
        question: "Каков ваш ответ?",
        choices: [
          { id: 'a', text: "Reject sham control - it's unethical to do an invasive procedure without benefit", consequence: 'bad', result: "В исследовании ORBITA (2017) использовался имитационный контроль и не было обнаружено НИКАКОЙ разницы во времени тренировки (16,6 с, 95% ДИ от -8,9 до 42.0). Без обмана эффект плацебо от PCI был бы ошибочно принят за эффект лечения." },
          { id: 'b', text: "Support sham control - without blinding, we can't distinguish placebo from treatment effect", consequence: 'good', result: "Верно! ORBITA произвела революцию в кардиологии, показав, что большая часть преимуществ ЧКВ при стабильной стенокардии связана с эффектом плацебо. Чтобы выявить это, необходим был ложный контроль." },
          { id: 'c', text: "Use objective endpoints like MI or death instead of symptoms", consequence: 'neutral', result: "Это важно, но COURAGE уже не показал никакого снижения смертности. Вопрос заключался в том, было ли улучшение симптомов реальным, и только мнимый контроль мог ответить на этот вопрос." }
        ],
        correct: 'b',
        principle: 1,
        lesson: "Методы защищают пациентов от нашего доверия. Ложный контроль показывает то, что не могут выявить неслепые испытания."
      },
      {
        id: 'prowess_scenario',
        module: 6,
        title: 'Единичное положительное исследование',
        situation: "It's 2002. The PROWESS trial shows activated protein C reduces sepsis mortality (RR 0.81, p=0.005). The manufacturer seeks FDA approval. You're on the advisory committee.",
        question: "Что вы порекомендуете?",
        choices: [
          { id: 'a', text: "Одобрить немедленно — исследование большое и статистически значимое", consequence: 'bad', result: "PROWESS-SHOCK (2012) не обнаружило НИКАКОГО преимущества (ОР 1,09, 95% ДИ) 0,92-1,28) и вред кровотечениям. Препарат был отменен после 10 лет применения. Одиночные испытания, какими бы впечатляющими они ни были, требуют повторения." },
          { id: 'b', text: "Require confirmatory trial before broad approval", consequence: 'good', result: "Верно! Репликация необходима. Вероятно, результат PROWESS был ложноположительным или на него повлияли проблемы с проведением испытаний. Подтверждающее исследование предотвратило бы годы ненадлежащего использования." },
          { id: 'c', text: "Утвердить с учетом постмаркетингового наблюдения", consequence: 'neutral', result: "Недостаточно. Постмаркетинговый надзор редко обеспечивает качество доказательств, необходимое для отмены одобрения. Требовалось надлежащее подтверждающее исследование." }
        ],
        correct: 'b',
        principle: 5,
        lesson: "Отсутствие доказательств повторения не является доказательством эффективности. Единичные испытания не являются венцом терапии."
      },
      {
        id: 'egdt_scenario',
        module: 7,
        title: 'Веховая репликация',
        situation: "Исследование Rivers EGDT (2001) продемонстрировало резкое снижение смертности при сепсисе. К 2014 году три крупных повторных испытания (ProCESS, ARISE, ProMISe) не показали никаких преимуществ. Как вы это интерпретируете?",
        question: "Каков ваш вывод?",
        choices: [
          { id: 'a', text: "Rivers was wrong - EGDT doesn't work", consequence: 'neutral', result: "Частично верно, но не хватает нюансов. Риверс не обязательно был «неправым» — контекст изменился. Обычный уход в 2014 году был намного лучше, чем в 2001 году. Группы сравнения сильно различались." },
          { id: 'b', text: "Usual care improved so much that EGDT's advantage disappeared", consequence: 'good', result: "Верно! Это «вековая тенденция»: контрольная группа в 2014 году получала помощь, основанную на принципах EGDT. Эффект вмешательства был ослаблен улучшением стандартной практики." },
          { id: 'c', text: "Испытания по репликации проводились в разных популяциях", consequence: 'neutral', result: "Верно, но неполно. Популяционные различия (внешняя валидность) не полностью объясняют, почему EGDT потерпел неудачу во многих странах. Ключевым фактором является долговременная тенденция качества обычной медицинской помощи." }
        ],
        correct: 'b',
        principle: 5,
        lesson: "Context matters. Treatments that worked against outdated usual care may show no benefit when standards improve."
      },
      {
        id: 'grade_scenario',
        module: 10,
        title: 'Рейтинг достоверности',
        situation: "Вы оцениваете достоверность доказательств в пользу интенсивного контроля АД. У вас есть РКИ, показавшие пользу (SPRINT), но они исключили диабетиков и использовали автоматизированное офисное измерение артериального давления. В вашу популяцию входят диабетики, и они используют АД вручную.",
        question: "Как вы оцениваете достоверность для вашей рекомендуемой популяции?",
        choices: [
          { id: 'a', text: "High certainty - SPRINT was a well-conducted RCT", consequence: 'bad', result: "Неправильно! GRADE требует рейтинга для ВАШЕГО населения. Результаты SPRINT не применимы напрямую к диабетикам (исключено) или клиникам, использующим ручное измерение АД (которое выше примерно на 10 мм рт. ст.). Это КОСВЕННОСТЬ." },
          { id: 'b', text: "Понижение версии из-за косвенности - совокупность и измерения различаются", consequence: 'good', result: "Правильно! SPRINT исключил диабетиков (ACCORD показал вред диабетикам!) и использовал автоматическое измерение АД (более низкие показания, чем ручное). Применение целевых показателей SPRINT с ручным АД приведет к чрезмерному лечению пациентов." },
          { id: 'c', text: "Moderate certainty - some uncertainty but RCTs are gold standard", consequence: 'neutral', result: "Недостаточно конкретно. Вам необходимо определить, ПОЧЕМУ вы понижаете версию. Косвенность в популяции (за исключением диабетиков) и вмешательстве (метод измерения АД) требует явного признания." }
        ],
        correct: 'b',
        principle: 6,
        lesson: "Уверенность должна быть получена для ВАШЕЙ популяции. Прямые доказательства превосходят косвенные, независимо от дизайна исследования."
      },
      {
        id: 'funnel_scenario',
        module: 9,
        title: 'Асимметричная воронка',
        situation: "Your funnel plot for a surgical intervention shows marked asymmetry - small studies cluster on the positive side, large studies near the null. Egger's test p=0.02.",
        question: "Как действовать?",
        choices: [
          { id: 'a', text: "Apply trim-and-fill to adjust the pooled estimate", consequence: 'neutral', result: "Обрезка и заполнение — это анализ чувствительности, а не исправление. Предполагается, что асимметрия является чистой предвзятостью публикации, но эффекты небольших исследований также могут быть связаны с отбором пациентов, верностью вмешательства или истинной гетерогенностью." },
          { id: 'b', text: "Сообщайте об асимметрии, исследуйте причины и представляйте данные с небольшими исследованиями или без них", consequence: 'good', result: "Correct! Funnel asymmetry has multiple causes: publication bias, true heterogeneity, or different patient populations in small vs large studies. Transparent reporting of all possibilities is essential." },
          { id: 'c', text: "Exclude small studies as they're likely biased", consequence: 'bad', result: "Произвольное исключение создает свою собственную предвзятость. Небольшие исследования могут представлять разные группы населения, где лечение действительно работает лучше. Ответом является расследование, а не исключение." }
        ],
        correct: 'b',
        principle: 2,
        lesson: "Что было скрыто на виду? Асимметрия воронки выявляет проблемы, но не указывает причину. Требуется расследование."
      }
    ];

    // Track scenario completions
    let scenarioState = {
      completed: {},
      confidenceRatings: []
    };

    function renderScenario(scenarioId, containerId) {
      const scenario = branchingScenarios.find(s => s.id === scenarioId);
      if (!scenario) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      const isCompleted = scenarioState.completed[scenarioId];

      container.innerHTML = `
        <div class="scenario-panel" id="scenario-${scenarioId}">
          <div class="scenario-header">
            <span class="scenario-icon">🔀</span>
            <span class="scenario-title">${scenario.title}</span>
          </div>
          <div class="scenario-situation">${scenario.situation}</div>
          <div class="scenario-question">${scenario.question}</div>
          <div class="scenario-choices">
            ${scenario.choices.map(c => `
              <div class="scenario-choice ${isCompleted ? 'answered' : ''} ${isCompleted && c.id === scenario.correct ? 'correct' : ''} ${isCompleted && scenarioState.completed[scenarioId] === c.id && c.id !== scenario.correct ? 'incorrect' : ''}"
                   onclick="${isCompleted ? '' : `selectScenarioChoice('${scenarioId}', '${c.id}')`}">
                <span class="choice-letter">${c.id.toUpperCase()}</span>
                <span class="choice-text">${c.text}</span>
              </div>
            `).join('')}
          </div>
          <div class="scenario-consequence ${isCompleted ? 'visible' : ''} ${isCompleted ? scenario.choices.find(c => c.id === scenarioState.completed[scenarioId])?.consequence || '' : ''}" id="consequence-${scenarioId}">
            ${isCompleted ? renderConsequence(scenario, scenarioState.completed[scenarioId]) : ''}
          </div>
        </div>
      `;
    }

    function renderConsequence(scenario, choiceId) {
      const choice = scenario.choices.find(c => c.id === choiceId);
      const isCorrect = choiceId === scenario.correct;
      return `
        <div class="consequence-title">
          ${isCorrect ? '✓ Good decision!' : '✗ Problematic decision'}
        </div>
        <div class="consequence-text">${choice.result}</div>
        <div class="consequence-lesson"><strong>Principle ${scenario.principle + 1}:</strong> ${scenario.lesson}</div>
      `;
    }

    function selectScenarioChoice(scenarioId, choiceId) {
      const scenario = branchingScenarios.find(s => s.id === scenarioId);
      if (!scenario || scenarioState.completed[scenarioId]) return;

      scenarioState.completed[scenarioId] = choiceId;

      // Award points
      if (choiceId === scenario.correct) {
        awardPoints(30, 'Correct scenario decision');
      } else {
        awardPoints(10, 'Scenario attempted');
      }

      // Check for badge
      const completedCount = Object.keys(scenarioState.completed).length;
      if (completedCount >= 5) {
        earnBadge('scenario_solver');
      }

      saveProgress();

      // Re-render with answer shown
      const container = document.getElementById(`scenario-${scenarioId}`)?.parentElement;
      if (container) {
        renderScenario(scenarioId, container.id);
      }
    }

    // ============================================================
    // CONFIDENCE CALIBRATION SYSTEM
    // ============================================================

    let calibrationState = {
      predictions: [], // { confidence: 0-100, correct: boolean }
      totalPredictions: 0,
      calibrationScore: null
    };

    function addConfidenceToPredict(containerId) {
      const container = document.getElementById(containerId);
      if (!container) return;

      const existingSection = container.querySelector('.confidence-section');
      if (existingSection) return;

      const section = document.createElement('div');
      section.className = 'confidence-section';
      section.innerHTML = `
        <div class="confidence-label">How confident are you in your prediction?</div>
        <div class="confidence-slider-container">
          <input type="range" class="confidence-slider" min="0" max="100" value="50"
                 oninput="updateConfidenceDisplay(this)">
          <span class="confidence-value">50%</span>
        </div>
        <div class="confidence-labels">
          <span>Guessing</span>
          <span>Very sure</span>
        </div>
      `;
      container.appendChild(section);
    }

    function updateConfidenceDisplay(slider) {
      const value = slider.value;
      slider.nextElementSibling.textContent = value + '%';
    }

    function recordConfidence(confidence, wasCorrect) {
      calibrationState.predictions.push({ confidence, correct: wasCorrect });
      calibrationState.totalPredictions++;
      calculateCalibrationScore();
      saveProgress();
    }

    function calculateCalibrationScore() {
      if (calibrationState.predictions.length < 5) {
        calibrationState.calibrationScore = null;
        return;
      }

      // Group predictions by confidence bands
      const bands = { low: [], mid: [], high: [] };
      calibrationState.predictions.forEach(p => {
        if (p.confidence < 40) bands.low.push(p);
        else if (p.confidence < 70) bands.mid.push(p);
        else bands.high.push(p);
      });

      // Calculate accuracy per band
      const bandAccuracy = {};
      Object.keys(bands).forEach(band => {
        if (bands[band].length > 0) {
          const correct = bands[band].filter(p => p.correct).length;
          bandAccuracy[band] = correct / bands[band].length;
        }
      });

      // Perfect calibration: high confidence = high accuracy, low confidence = low accuracy
      // Score: 100 - average absolute deviation from expected
      let totalDeviation = 0;
      let count = 0;

      if (bands.high.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.high || 0) - 0.85) * 100;
        count++;
      }
      if (bands.mid.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.mid || 0) - 0.55) * 100;
        count++;
      }
      if (bands.low.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.low || 0) - 0.25) * 100;
        count++;
      }

      calibrationState.calibrationScore = count > 0 ? Math.max(0, 100 - (totalDeviation / count)) : null;

      // Award badge for good calibration
      if (calibrationState.calibrationScore >= 80) {
        earnBadge('well_calibrated');
      }
    }

    // ============================================================
    // ENHANCED ANALOGY SYSTEM
    // ============================================================

    const conceptAnalogies = {
      'heterogeneity': {
        icon: '🎻',
        title: 'Orchestra Tuning',
        concept: 'I² (Heterogeneity)',
        text: "Как при настройке оркестра - некоторые отклонения являются нормальными и ожидаемыми. Но если скрипки играют в разных тональностях, что-то не так. Высокий I² означает, что ваша учеба не играет той же самой мелодии."
      },
      'publication_bias': {
        icon: '🧦',
        title: 'Missing Socks',
        concept: 'Publication Bias',
        text: "Как носки в стирке - вы ЗНАЕТЕ, что пары ушли, но выходят только положительные результаты. Недостающие отрицательные испытания подобны исчезнувшим одиночным носкам. Асимметричный воронкообразный график показывает разрыв."
      },
      'forest_plot': {
        icon: '⚖️',
        title: 'Jury of Studies',
        concept: 'Forest Plot',
        text: "Каждое исследование представляет собой присяжных, выносящих вердикт. Некоторые из них более надежны (узкий ДИ), некоторые менее. Ромб — это консенсус присяжных, но если присяжные категорически не согласны (неоднородность), стоит ли доверять среднему вердикту?"
      },
      'funnel_plot': {
        icon: '🔦',
        title: 'Flashlight Beam',
        concept: 'Funnel Plot',
        text: "Фонарик должен светить равномерно во всех направлениях. Асимметричный воронкообразный график похож на фонарик, у которого что-то блокирует одну сторону — вы не видите полной картины. Небольшие исследования с одной стороны подозрительно отсутствуют."
      },
      'grade': {
        icon: '🪜',
        title: 'Ladder of Confidence',
        concept: 'GRADE Certainty',
        text: "Each rung must be earned, not assumed. You start at the top (RCT) or bottom (observational) and can only move with evidence. Risk of bias pushes you down; large effects can pull you up. No shortcuts."
      },
      'tau_squared': {
        icon: '📻',
        title: 'Background Static',
        concept: 'τ² (Between-study variance)',
        text: "Например, помехи на радиостанции – сколько шума в сигнале? Низкое τ² означает чистый прием (согласны исследования). Высокое τ² означает вмешательство из неизвестных источников — различных групп населения, вмешательств или результатов."
      },
      'random_effects': {
        icon: '🎼',
        title: 'Different Orchestras',
        concept: 'Random Effects Model',
        text: "Fixed effects: same orchestra playing multiple times. Random effects: different orchestras playing the same piece. Each adds their interpretation. We want the average of all possible orchestras, not just this one."
      },
      'prediction_interval': {
        icon: '🎯',
        title: 'Where Will the Arrow Land?',
        concept: 'Prediction Interval',
        text: "CI сообщает вам, где находится ИСТИННОЕ среднее значение. Интервал прогнозирования показывает, где, скорее всего, окажется исследование NEXT. Если ваш PI перейдет черту отсутствия эффекта, новое исследование может изменить этот вывод."
      },
      'surrogate': {
        icon: '🗺️',
        title: 'Map vs Territory',
        concept: 'Surrogate Endpoints',
        text: "A map (surrogate) represents the territory (clinical outcome). But a map can be wrong. PVC suppression was the map; mortality was the territory. CAST proved the map led off a cliff."
      },
      'confounding': {
        icon: '☂️',
        title: 'Umbrella & Rain',
        concept: 'Confounding',
        text: "Продажи зонтиков предсказывают дождь. Но покупка зонтов не вызывает дождя. Фактор (прогноз погоды) влияет на оба. Пользователи ЗГТ не были более здоровыми ИЗ-ЗА ЗГТ - они были более здоровыми женщинами, которые ВЫБИРАЛИ ЗГТ."
      }
    };

    function getAnalogy(conceptKey) {
      return conceptAnalogies[conceptKey] || null;
    }

    function renderAnalogy(conceptKey, containerId) {
      const analogy = getAnalogy(conceptKey);
      if (!analogy) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="analogy-card">
          <div class="analogy-header">
            <span class="analogy-icon">${analogy.icon}</span>
            <span class="analogy-title">${analogy.title}</span>
            <span class="analogy-concept">${analogy.concept}</span>
          </div>
          <div class="analogy-text">"${analogy.text}"</div>
        </div>
      `;
    }

    // ============================================================
    // MISCONCEPTION CHALLENGES (from Evidence Reversal 40)
    // ============================================================

    const misconceptions = [
      // Original 10 - Evidence Reversals
      { id: 1, statement: "If arrhythmias fall, survival must rise.", truth: false, story: "CAST", explanation: "Encainide/flecainide suppressed PVCs but tripled mortality. Surrogates can deceive." },
      { id: 2, statement: "Observational prevention equals causal prevention.", truth: false, story: "WHI/HRT", explanation: "Healthy user bias made HRT look protective. RCTs showed harm." },
      { id: 3, statement: "Surgery proves itself without sham control.", truth: false, story: "Moseley", explanation: "Arthroscopic knee surgery was no better than sham. Placebo effect is powerful." },
      { id: 4, statement: "If the artery is open, outcomes must improve.", truth: false, story: "COURAGE", explanation: "PCI for stable CAD didn't reduce death/MI vs medical therapy alone." },
      { id: 5, statement: "Lower glucose always means better outcomes.", truth: false, story: "NICE-SUGAR", explanation: "Intensive glucose control increased mortality in ICU patients." },
      { id: 6, statement: "A positive early signal is enough for adoption.", truth: false, story: "PROWESS-SHOCK", explanation: "Activated protein C looked promising until definitive trial showed no benefit." },
      { id: 7, statement: "If a mechanism is plausible, outcomes follow.", truth: false, story: "MAGIC", explanation: "Magnesium had sound antiarrhythmic theory but no mortality benefit in large trials." },
      { id: 8, statement: "More measurements mean more survival.", truth: false, story: "ESCAPE", explanation: "Pulmonary artery catheters provided data but no outcome improvement in heart failure." },
      { id: 9, statement: "Device enthusiasm replaces randomized proof.", truth: false, story: "CORAL", explanation: "Renal artery stenting had no benefit despite strong mechanistic rationale." },
      { id: 10, statement: "Guidelines equal proof.", truth: false, story: "IABP-SHOCK", explanation: "Intra-aortic balloon pump was Class I recommended but showed no benefit in RCT." },
      // More Evidence Reversals
      { id: 11, statement: "Raising HDL with drugs guarantees fewer heart attacks.", truth: false, story: "AIM-HIGH", explanation: "Ниацин повышал уровень ЛПВП, но не уменьшал сердечно-сосудистые события. ЛПВП были маркером, а не поддающейся изменению причиной." },
      { id: 12, statement: "If it worked in one landmark trial, it works everywhere.", truth: false, story: "ProCESS/ARISE/ProMISe", explanation: "Rivers' EGDT worked in 2001 but three replication trials failed. Usual care had improved, diluting the effect." },
      { id: 13, statement: "Antioxidants prevent cancer in smokers.", truth: false, story: "ATBC/CARET", explanation: "Beta-carotene INCREASED lung cancer in smokers (RR 1.16-1.28). Mechanism doesn't guarantee benefit." },
      { id: 14, statement: "More screening always saves more lives.", truth: false, story: "PLCO", explanation: "PSA screening found more cancers but didn't reduce mortality - it found cancers that would never kill." },
      { id: 15, statement: "Normalizing hemoglobin improves kidney patient outcomes.", truth: false, story: "CHOIR/TREAT", explanation: "Более высокий уровень гемоглобина увеличивает риск инсульта и смертности. Цель стала врагом." },
      { id: 16, statement: "Новые устройства безопаснее, потому что они новые.", truth: false, story: "SAMMPRIS", explanation: "Intracranial stents tripled 30-day stroke/death vs medical therapy (14.7% vs 5.8%)." },
      { id: 17, statement: "If homocysteine drops, cardiovascular risk drops.", truth: false, story: "NORVIT", explanation: "B vitamins lowered homocysteine but didn't reduce events. Biomarker fallacy." },
      { id: 18, statement: "Routine oxygen helps heart attack patients.", truth: false, story: "DETO2X-AMI", explanation: "Oxygen in non-hypoxic MI patients showed no mortality benefit. A century of practice, no evidence." },
      { id: 19, statement: "Early aggressive feeding speeds ICU recovery.", truth: false, story: "EPaNIC", explanation: "Late parenteral nutrition led to FASTER discharge than early feeding. Timing matters." },
      { id: 20, statement: "Removing thrombus during PCI must improve outcomes.", truth: false, story: "TASTE", explanation: "Thrombus aspiration added procedural time but no mortality benefit. Logical doesn't mean proven." },
      // Cochrane Methods Misconceptions
      { id: 21, statement: "Низкий I² означает, что исследования достаточно согласуются для объединения.", truth: false, story: "Methods", explanation: "I² может быть низким с клинически важными различиями. Интервалы прогнозирования показывают истинное распространение эффектов." },
      { id: 22, statement: "Statistically significant means clinically important.", truth: false, story: "Methods", explanation: "Large trials can detect tiny, meaningless effects. Effect SIZE and CI width matter more than p-values." },
      { id: 23, statement: "РКИ всегда являются доказательствами с высокой степенью достоверности.", truth: false, story: "GRADE", explanation: "РКИ начинаются с высокого уровня, но их класс понижается из-за предвзятости, неточности, непрямоты, непоследовательности или предвзятости публикации." },
      { id: 24, statement: "Funnel plot asymmetry proves publication bias.", truth: false, story: "Methods", explanation: "Asymmetry has many causes: true heterogeneity, small-study effects, different populations. Investigation needed." },
      { id: 25, statement: "Random effects models fix heterogeneity.", truth: false, story: "Methods", explanation: "Random effects account for heterogeneity statistically but don't explain it. Clinical investigation is still required." }
    ];

    function renderMisconceptionChallenge(misconceptionId, containerId) {
      const m = misconceptions.find(x => x.id === misconceptionId);
      if (!m) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="misconception-challenge" id="misconception-${m.id}">
          <div class="misconception-header">
            <span>🤔</span>
            <span>Common Belief Challenge</span>
          </div>
          <div class="misconception-statement">"${m.statement}"</div>
          <div class="misconception-buttons">
            <button class="misconception-btn true-btn" onclick="answerMisconception(${m.id}, true)">TRUE</button>
            <button class="misconception-btn false-btn" onclick="answerMisconception(${m.id}, false)">FALSE</button>
          </div>
          <div class="misconception-result" id="misconception-result-${m.id}"></div>
        </div>
      `;
    }

    function answerMisconception(id, answer) {
      const m = misconceptions.find(x => x.id === id);
      if (!m) return;

      const isCorrect = answer === m.truth;
      const trueBtn = document.querySelector(`#misconception-${id} .true-btn`);
      const falseBtn = document.querySelector(`#misconception-${id} .false-btn`);
      const resultDiv = document.getElementById(`misconception-result-${id}`);

      // Disable buttons
      trueBtn.disabled = true;
      falseBtn.disabled = true;

      // Show correct/incorrect
      if (m.truth) {
        trueBtn.classList.add('correct');
        if (!answer) falseBtn.classList.add('wrong');
      } else {
        falseBtn.classList.add('correct');
        if (answer) trueBtn.classList.add('wrong');
      }

      // Show result
      resultDiv.className = `misconception-result visible ${isCorrect ? 'correct' : 'incorrect'}`;
      resultDiv.innerHTML = `
        <strong>${isCorrect ? '✓ Correct!' : '✗ Not quite.'}</strong>
        This belief is <strong>${m.truth ? 'TRUE' : 'FALSE'}</strong>.
        <br><br>
        <strong>${m.story}:</strong> ${m.explanation}
      `;

      // Award points
      if (isCorrect) {
        awardPoints(20, 'Misconception challenge correct');
      }
      saveProgress();
    }

    // ============================================================
    // PRACTICE PROBLEMS (Addressing Cochrane Gaps)
    // ============================================================

    const practiceProblems = [
      // GRADE Problems
      {
        id: 'grade_1',
        category: 'GRADE',
        title: 'Rating Certainty: SPRINT Trial',
        scenario: 'You\'re creating a guideline for hypertension. The SPRINT trial (RCT, n=9,361) shows intensive BP control reduces CV events (HR 0.75, 95% CI 0.64-0.89). However: (1) Trial excluded diabetics, (2) Used automated office BP (reads ~10 mmHg lower than manual), (3) Composite endpoint included heart failure.',
        question: 'Какой рейтинг достоверности GRADE подходит для популяции ВАШЕЙ клиники, которая включает в себя диабетик и использует ручное АД?',
        options: [
          { id: 'a', text: 'High - SPRINT was a large, well-conducted RCT', correct: false },
          { id: 'b', text: 'Moderate - Downgrade one level for indirectness (population differs)', correct: true },
          { id: 'c', text: 'Низкий - понижение на два уровня из-за непрямоты и неточности', correct: false },
          { id: 'd', text: 'Very Low - Multiple serious concerns', correct: false }
        ],
        explanation: 'Downgrade ONE level for serious indirectness: (1) Population excludes diabetics (ACCORD showed HARM in diabetics with intensive control), (2) BP measurement method differs (applying SPRINT targets with manual BP would overtreate). The trial quality was good, but the results don\'t directly apply to your population.',
        principle: 6
      },
      {
        id: 'grade_2',
        category: 'GRADE',
        title: 'When Observational Beats RCT',
        scenario: 'For a rare adverse effect (hepatotoxicity with a new drug), you have: (1) RCTs showing 0/2,000 events in treatment vs 0/2,000 in control, (2) Large pharmacovigilance database showing 45 cases in 500,000 users (9/100,000).',
        question: 'Что обеспечивает более высокую достоверность этого сигнала безопасности?',
        options: [
          { id: 'a', text: 'РКИ - это золотой стандарт', correct: false },
          { id: 'b', text: 'Данные наблюдений - они имеют способность обнаруживать редкие события', correct: true },
          { id: 'c', text: 'Ни то, то необходимо больше данных РКИ', correct: false },
          { id: 'd', text: 'Combine them in a meta-analysis', correct: false }
        ],
        explanation: 'RCTs are underpowered for rare events. With 2,000 patients, you\'d need a risk >1/500 to detect one event. The observational data, despite confounding risks, provides the only evidence of a real signal. GRADE can rate UP observational data when effect is large or there\'s dose-response.',
        principle: 5
      },
      // Prediction Interval Problems
      {
        id: 'pi_1',
        category: 'Prediction Intervals',
        title: 'Beyond I-squared',
        scenario: 'A meta-analysis of 8 trials shows: Pooled RR = 0.80 (95% CI 0.72-0.89), I² = 65%, τ² = 0.04. The 95% prediction interval is 0.55-1.16.',
        question: 'If you run a new trial in a similar population, what range of effects is plausible?',
        options: [
          { id: 'a', text: '0,72-0,89 (доверительный интервал)', correct: false },
          { id: 'b', text: '0,55-1,16 (интервал прогнозирования)', correct: true },
          { id: 'c', text: 'Около 0,80 (точка оценка)', correct: false },
          { id: 'd', text: 'Невозможно спрогнозировать на основе этих данных', correct: false }
        ],
        explanation: 'The PREDICTION INTERVAL (0.55-1.16) shows the range of true effects in different settings. It INCLUDES 1.0, meaning a new trial might show HARM even though the pooled estimate shows benefit. I² tells you heterogeneity exists; prediction intervals tell you what it means for the next patient/setting.',
        principle: 4
      },
      {
        id: 'pi_2',
        category: 'Prediction Intervals',
        title: 'Clinical Interpretation',
        scenario: 'You\'re advising a colleague about implementing an intervention. The meta-analysis shows: RR = 0.70 (95% CI 0.60-0.82), I² = 45% (moderate), 95% prediction interval = 0.50-0.98.',
        question: 'Что вы скажете своему коллеге?',
        options: [
          { id: 'a', text: 'Strong evidence of benefit - implement confidently', correct: false },
          { id: 'b', text: 'Likely beneficial but effect size may vary substantially by setting', correct: true },
          { id: 'c', text: 'Too much heterogeneity to draw conclusions', correct: false },
          { id: 'd', text: 'Wait for more trials to reduce uncertainty', correct: false }
        ],
        explanation: 'Интервал прогнозирования (0,50–0,98) остается ниже 1,0, что позволяет предположить, что выгода вероятна в большинстве настроек, хотя ее величина варьируется (снижение на 30–50%). Это БОЛЕЕ информативно, чем просто сообщение об «умеренной неоднородности». Лечение, вероятно, помогает, но насколько это зависит от местных факторов.',
        principle: 4
      },
      // Risk of Bias Problems
      {
        id: 'rob_1',
        category: 'Risk of Bias',
        title: 'Retrospective Red Flags',
        scenario: 'Reviewing a trial of a surgical intervention: (1) Patients knew their allocation, (2) Surgeons obviously couldn\'t be blinded, (3) Primary outcome was "patient-reported pain at 6 months", (4) 15% lost to follow-up, similar between groups.',
        question: 'What is the MAIN risk of bias concern?',
        options: [
          { id: 'a', text: 'Selection bias - randomization might have been subverted', correct: false },
          { id: 'b', text: 'Performance bias - surgeons weren\'t blinded', correct: false },
          { id: 'c', text: 'Detection bias - patients knew allocation and reported subjective outcome', correct: true },
          { id: 'd', text: 'Attrition bias - 15% lost to follow-up', correct: false }
        ],
        explanation: 'With UNBLINDED patients reporting SUBJECTIVE outcomes, detection bias is critical. Patients who know they got the "real" surgery often report more improvement (placebo effect). This is exactly why ORBITA used sham surgery - to separate placebo from true treatment effect. The 15% attrition, balanced between groups, is less concerning.',
        principle: 1
      },
      {
        id: 'rob_2',
        category: 'Risk of Bias',
        title: 'Сигналы УМЕНЬШЕНИЯ',
        scenario: 'Reviewing trials by a prolific researcher, you notice: (1) Event rates perfectly balanced between groups, (2) I² = 0% when his trials pooled alone (but 70% when combined with others), (3) Effects consistently larger than other researchers\' trials, (4) Unable to verify source data.',
        question: 'Что делать?',
        options: [
          { id: 'a', text: 'Include the trials - low heterogeneity is desirable', correct: false },
          { id: 'b', text: 'Conduct sensitivity analysis excluding his trials', correct: false },
          { id: 'c', text: 'Request source data verification before inclusion', correct: true },
          { id: 'd', text: 'Report concerns but include anyway', correct: false }
        ],
        explanation: 'These are classic fabrication signals (from the DECREASE fraud case). "Perfect" data is a red flag - real biological data is messy. The ONLY acceptable path is source data verification. Don Poldermans\' fraud influenced guidelines for years; 800,000 patients may have been harmed. Numbers without provenance are not numbers.',
        principle: 3
      },
      // Publication Bias Problems
      {
        id: 'pb_1',
        category: 'Publication Bias',
        title: 'Asymmetric Funnel',
        scenario: 'Your funnel plot shows: Large trials cluster around RR=1.0, small trials cluster around RR=0.6 (all on the "benefit" side). Egger\'s test p=0.01.',
        question: 'What\'s the most likely explanation?',
        options: [
          { id: 'a', text: 'Publication bias - small negative trials weren\'t published', correct: false },
          { id: 'b', text: 'Small-study effects - could be publication bias OR true heterogeneity', correct: true },
          { id: 'c', text: 'The small trials found the true effect; large trials are diluted', correct: false },
          { id: 'd', text: 'Random variation - asymmetry is expected', correct: false }
        ],
        explanation: 'Funnel asymmetry has MULTIPLE causes: (1) Publication bias, (2) True heterogeneity (small trials in different populations), (3) Methodological differences (small trials less rigorous), (4) Chance. You cannot conclude "publication bias" from asymmetry alone. Investigation of WHY is required.',
        principle: 2
      },
      {
        id: 'pb_2',
        category: 'Publication Bias',
        title: 'Недостающие исследования',
        scenario: 'You\'re meta-analyzing an antidepressant. ClinicalTrials.gov shows 12 registered trials; you found 8 publications. The 4 missing trials were completed 3+ years ago.',
        question: 'What do you do?',
        options: [
          { id: 'a', text: 'Продолжить 8 опубликованных исследований - это стандарт практика', correct: false },
          { id: 'b', text: 'Свяжитесь со спонсорами/авторами и подайте запросы FOIA на неопубликованные данные', correct: true },
          { id: 'c', text: 'Обратите внимание на ограничение в разделе обсуждения', correct: false },
          { id: 'd', text: 'Используйте обрезку и заполните, чтобы скорректировать недостающие исследования', correct: false }
        ],
        explanation: 'FDA обнаружило, что 94% опубликованных исследований испытания антидепрессантов были положительными по сравнению с 51% исследований ВСЕХ, представленных в FDA. Вы ДОЛЖНЫ попытаться получить недостающие данные – это необязательно. «Отметить ограничение» и не попытаться его исправить — методологическая халатность.',
        principle: 2
      }
    ];

    function renderPracticeProblem(problemId, containerId) {
      const problem = practiceProblems.find(p => p.id === problemId);
      if (!problem) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="practice-problem" id="problem-${problem.id}">
          <div class="practice-header">
            <span class="practice-category">${problem.category}</span>
            <span class="practice-title">${problem.title}</span>
          </div>
          <div class="practice-scenario">${problem.scenario}</div>
          <div class="practice-question"><strong>${problem.question}</strong></div>
          <div class="practice-options">
            ${problem.options.map(opt => `
              <button class="practice-option" onclick="answerPracticeProblem('${problem.id}', '${opt.id}')">
                <span class="option-letter">${opt.id.toUpperCase()}</span>
                <span class="option-text">${opt.text}</span>
              </button>
            `).join('')}
          </div>
          <div class="practice-feedback" id="feedback-${problem.id}"></div>
        </div>
      `;
    }

    function answerPracticeProblem(problemId, answerId) {
      const problem = practiceProblems.find(p => p.id === problemId);
      if (!problem) return;

      const selectedOption = problem.options.find(o => o.id === answerId);
      const correctOption = problem.options.find(o => o.correct);
      const isCorrect = selectedOption.correct;

      // Disable all buttons and show correct/incorrect
      const buttons = document.querySelectorAll(`#problem-${problemId} .practice-option`);
      buttons.forEach(btn => {
        btn.disabled = true;
        const letter = btn.querySelector('.option-letter').textContent.toLowerCase();
        if (letter === correctOption.id) {
          btn.classList.add('correct');
        } else if (letter === answerId) {
          btn.classList.add('incorrect');
        }
      });

      // Show feedback
      const feedbackDiv = document.getElementById(`feedback-${problemId}`);
      feedbackDiv.className = `practice-feedback visible ${isCorrect ? 'correct' : 'incorrect'}`;
      feedbackDiv.innerHTML = `
        <strong>${isCorrect ? '✓ Correct!' : '✗ Not quite.'}</strong>
        <p>${problem.explanation}</p>
        <p class="principle-link"><em>Principle ${problem.principle + 1}: ${sevenPrinciples[problem.principle]?.text || ''}</em></p>
      `;

      // Award points
      if (isCorrect) {
        awardPoints(25, 'Practice problem correct');
      } else {
        awardPoints(5, 'Practice problem attempted');
      }
      saveProgress();
    }

    // ============================================================
    // INVESTIGATION EXERCISES
    // ============================================================

    function revealAnswer(elementId) {
      const el = document.getElementById(elementId);
      if (el) {
        el.classList.add('visible');
        // Scroll into view
        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function generateMiniForest(containerId, studies, pooled, showAfter = false) {
      const container = document.getElementById(containerId);
      if (!container) return;

      const minE = Math.min(...studies.map(s => s.lo), pooled.lo, 0.3);
      const maxE = Math.max(...studies.map(s => s.hi), pooled.hi, 3);
      const range = maxE - minE;
      const scale = (v) => ((v - minE) / range) * 240 + 30;
      const height = (studies.length + 1) * 24 + 30;

      container.innerHTML = `
        <svg viewBox="0 0 320 ${height}" style="width: 100%; height: ${height}px; font-family: sans-serif;">
          <line x1="${scale(1)}" y1="5" x2="${scale(1)}" y2="${height - 15}" stroke="#999" stroke-width="1" stroke-dasharray="3"/>
          ${studies.map((s, i) => {
            const y = 18 + i * 24;
            const color = showAfter && s.excluded ? '#ccc' : '#1E2761';
            return `
              <text x="2" y="${y + 3}" font-size="9" fill="${color}" ${s.excluded ? 'text-decoration="line-through"' : ''}>${s.name}</text>
              <line x1="${scale(s.lo)}" y1="${y}" x2="${scale(s.hi)}" y2="${y}" stroke="${color}" stroke-width="1.5"/>
              <rect x="${scale(s.effect) - 4}" y="${y - 4}" width="8" height="8" fill="${color}"/>
              <text x="280" y="${y + 3}" font-size="8" fill="${color}">${s.effect.toFixed(2)}</text>
            `;
          }).join('')}
          <polygon points="${scale(pooled.effect)},${height - 20} ${scale(pooled.lo)},${height - 13} ${scale(pooled.effect)},${height - 6} ${scale(pooled.hi)},${height - 13}" fill="${showAfter ? '#C53030' : '#D4AF37'}"/>
          <text x="2" y="${height - 10}" font-size="9" font-weight="bold" fill="${showAfter ? '#C53030' : '#1E2761'}">Pooled</text>
          <text x="280" y="${height - 10}" font-size="8" font-weight="bold">${pooled.effect.toFixed(2)}</text>
          <text x="${scale(0.5)}" y="${height}" font-size="7" fill="#666">Favors Tx</text>
          <text x="${scale(2)}" y="${height}" font-size="7" fill="#666">Favors Ctrl</text>
        </svg>
      `;
    }

    // CAST Investigation Data
    const castStudiesPublished = [
      { name: 'Obs Study 1', effect: 0.45, lo: 0.28, hi: 0.72 },
      { name: 'Obs Study 2', effect: 0.52, lo: 0.35, hi: 0.77 },
      { name: 'Obs Study 3', effect: 0.38, lo: 0.22, hi: 0.65 },
    ];
    const castPooledBefore = { effect: 0.45, lo: 0.33, hi: 0.61 };
    const castPooledAfter = { effect: 2.50, lo: 1.60, hi: 4.50 };

    // Rosiglitazone data (real from Nissen 2007)
    const rosiStudies = [
      { name: 'ADOPT', effect: 1.25, lo: 0.78, hi: 2.01 },
      { name: 'DREAM', effect: 1.36, lo: 0.68, hi: 2.71 },
      { name: 'Trial 49653/020', effect: 1.81, lo: 0.59, hi: 5.55 },
      { name: 'Trial 49653/024', effect: 2.67, lo: 0.50, hi: 14.3 },
      { name: 'Trial 49653/093', effect: 1.50, lo: 0.25, hi: 8.98 },
    ];
    const rosiPooled = { effect: 1.43, lo: 1.03, hi: 1.98 };

    // DECREASE data (before/after fraud removal)
    const decreaseStudies = [
      { name: 'DECREASE-I', effect: 0.09, lo: 0.02, hi: 0.37, excluded: true },
      { name: 'DECREASE-IV', effect: 0.65, lo: 0.24, hi: 1.74, excluded: true },
      { name: 'POISE', effect: 1.33, lo: 1.03, hi: 1.74 },
      { name: 'DIPOM', effect: 1.11, lo: 0.66, hi: 1.87 },
      { name: 'MaVS', effect: 0.92, lo: 0.46, hi: 1.84 },
    ];
    const decreasePooledBefore = { effect: 0.56, lo: 0.35, hi: 0.89 };
    const decreasePooledAfter = { effect: 1.27, lo: 1.01, hi: 1.60 };

    // Magnesium ISIS-4 data
    const magnesiumSmallTrials = [
      { name: 'Rasmussen', effect: 0.23, lo: 0.05, hi: 1.01 },
      { name: 'Smith', effect: 0.31, lo: 0.09, hi: 1.10 },
      { name: 'Ceremuzynski', effect: 0.48, lo: 0.17, hi: 1.34 },
      { name: 'Schechter 1', effect: 0.52, lo: 0.20, hi: 1.35 },
      { name: 'Schechter 2', effect: 0.35, lo: 0.13, hi: 0.94 },
    ];
    const magPooledSmall = { effect: 0.44, lo: 0.27, hi: 0.71 };
    const isis4Result = { effect: 1.06, lo: 0.99, hi: 1.13 };

    // Complete magnesium trial data with sample sizes for visualization
    const magnesiumTrialsComplete = [
      { name: 'Morton 1984', n: 40, effect: 0.10, lo: 0.01, hi: 0.87, se: 0.55 },
      { name: 'Rasmussen 1986', n: 273, effect: 0.35, lo: 0.13, hi: 0.94, se: 0.25 },
      { name: 'Smith 1986', n: 400, effect: 0.48, lo: 0.21, hi: 1.09, se: 0.21 },
      { name: 'Abraham 1987', n: 94, effect: 0.87, lo: 0.33, hi: 2.30, se: 0.35 },
      { name: 'Shechter 1990', n: 103, effect: 0.27, lo: 0.08, hi: 0.95, se: 0.42 },
      { name: 'Ceremuzynski 1989', n: 48, effect: 0.22, lo: 0.03, hi: 1.50, se: 0.68 },
      { name: 'LIMIT-2', n: 2316, effect: 0.74, lo: 0.57, hi: 0.97, se: 0.09 },
    ];
    const isis4Complete = { name: 'ISIS-4', n: 58050, effect: 1.06, lo: 0.99, hi: 1.13, se: 0.025 };

    function drawMagnesiumForest(mode) {
      const containerId = mode === 'small' ? 'magnesium-forest-small' : 'magnesium-forest-full';
      const container = document.getElementById(containerId);
      if (!container) return;

      let trials = [...magnesiumTrialsComplete];
      let pooled = { effect: 0.44, lo: 0.27, hi: 0.71, label: 'Pooled (small trials)' };

      if (mode === 'full') {
        trials.push(isis4Complete);
        pooled = { effect: 1.02, lo: 0.95, hi: 1.09, label: 'Pooled (all trials)' };
      }

      const width = 800;
      const height = trials.length * 35 + 100;
      const margin = { left: 150, right: 50, top: 30, bottom: 50 };
      const plotWidth = width - margin.left - margin.right;

      // Log scale for OR
      const minLog = Math.log(0.05);
      const maxLog = Math.log(3);
      const xScale = (logVal) => margin.left + ((logVal - minLog) / (maxLog - minLog)) * plotWidth;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="max-width: 100%; height: auto;">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Forest Plot: Magnesium in MI${mode === 'full' ? ' (with ISIS-4)' : ' (small trials only)'}
      </text>`;

      // Grid lines and axis
      const ticks = [0.1, 0.25, 0.5, 1.0, 2.0];
      ticks.forEach(tick => {
        const x = xScale(Math.log(tick));
        svg += `<line x1="${x}" y1="${margin.top}" x2="${x}" y2="${height - margin.bottom}" stroke="#e2e8f0" stroke-width="1"/>`;
        svg += `<text x="${x}" y="${height - margin.bottom + 15}" text-anchor="middle" font-size="11" fill="#64748b">${tick}</text>`;
      });

      // Null line
      const nullX = xScale(0);
      svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="2"/>`;

      // Studies
      trials.forEach((trial, i) => {
        const y = margin.top + 20 + i * 35;
        const x = xScale(Math.log(trial.effect));
        const xLo = xScale(Math.log(Math.max(0.05, trial.lo)));
        const xHi = xScale(Math.log(Math.min(3, trial.hi)));

        // Weight based on sample size
        const weight = Math.sqrt(trial.n) / Math.sqrt(isis4Complete.n) * 10;
        const boxSize = Math.max(4, Math.min(12, weight + 4));

        const color = trial.name === 'ISIS-4' ? '#C53030' : (trial.effect < 1 ? '#22c55e' : '#64748b');

        // Label
        svg += `<text x="${margin.left - 10}" y="${y + 4}" text-anchor="end" font-size="11" fill="#1a365d">${trial.name} (n=${trial.n.toLocaleString()})</text>`;

        // CI line
        svg += `<line x1="${xLo}" y1="${y}" x2="${xHi}" y2="${y}" stroke="${color}" stroke-width="2"/>`;

        // Effect point
        svg += `<rect x="${x - boxSize/2}" y="${y - boxSize/2}" width="${boxSize}" height="${boxSize}" fill="${color}"/>`;

        // CI caps
        svg += `<line x1="${xLo}" y1="${y - 4}" x2="${xLo}" y2="${y + 4}" stroke="${color}" stroke-width="1"/>`;
        svg += `<line x1="${xHi}" y1="${y - 4}" x2="${xHi}" y2="${y + 4}" stroke="${color}" stroke-width="1"/>`;
      });

      // Pooled diamond
      const poolY = height - margin.bottom - 20;
      const poolX = xScale(Math.log(pooled.effect));
      const poolXLo = xScale(Math.log(pooled.lo));
      const poolXHi = xScale(Math.log(pooled.hi));
      const diamondColor = pooled.effect < 1 ? '#22c55e' : '#C53030';

      svg += `<polygon points="${poolXLo},${poolY} ${poolX},${poolY - 8} ${poolXHi},${poolY} ${poolX},${poolY + 8}" fill="${diamondColor}" stroke="${diamondColor}"/>`;
      svg += `<text x="${margin.left - 10}" y="${poolY + 4}" text-anchor="end" font-size="11" font-weight="bold" fill="#1a365d">${pooled.label}</text>`;

      // Axis label
      svg += `<text x="${width/2}" y="${height - 5}" text-anchor="middle" font-size="12" fill="#1a365d">Odds Ratio (log scale)</text>`;

      // Favors labels
      svg += `<text x="${xScale(Math.log(0.2))}" y="${height - margin.bottom + 30}" text-anchor="middle" font-size="10" fill="#22c55e">← Favors Magnesium</text>`;
      svg += `<text x="${xScale(Math.log(2))}" y="${height - margin.bottom + 30}" text-anchor="middle" font-size="10" fill="#C53030">Favors Placebo →</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    function drawMagnesiumFunnel(mode) {
      const container = document.getElementById('magnesium-funnel-small');
      if (!container) return;

      const trials = magnesiumTrialsComplete;
      const width = 600;
      const height = 400;
      const margin = { left: 80, right: 40, top: 40, bottom: 60 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Pooled effect (log scale)
      const pooledLog = Math.log(0.44);

      // X axis: log(OR)
      const minLogOR = -2.5;
      const maxLogOR = 1;
      const xScale = (logOR) => margin.left + ((logOR - minLogOR) / (maxLogOR - minLogOR)) * plotWidth;

      // Y axis: SE (inverted - high precision at top)
      const maxSE = 0.75;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="max-width: 100%; height: auto;">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Funnel Plot: Magnesium in MI (small trials)
      </text>`;

      // Funnel shape (95% CI bounds)
      const funnelPoints = [];
      for (let se = 0; se <= maxSE; se += 0.01) {
        const ciWidth = 1.96 * se;
        const xLeft = xScale(pooledLog - ciWidth);
        const xRight = xScale(pooledLog + ciWidth);
        const y = yScale(se);
        funnelPoints.push({ xLeft, xRight, y });
      }

      // Draw funnel
      let leftPath = `M ${xScale(pooledLog)} ${yScale(0)}`;
      let rightPath = `M ${xScale(pooledLog)} ${yScale(0)}`;
      funnelPoints.forEach(p => {
        leftPath += ` L ${p.xLeft} ${p.y}`;
        rightPath += ` L ${p.xRight} ${p.y}`;
      });
      svg += `<path d="${leftPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;
      svg += `<path d="${rightPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;

      // Vertical line at pooled effect
      svg += `<line x1="${xScale(pooledLog)}" y1="${margin.top}" x2="${xScale(pooledLog)}" y2="${height - margin.bottom}" stroke="#22c55e" stroke-width="2" stroke-dasharray="4"/>`;

      // Null line at OR = 1
      svg += `<line x1="${xScale(0)}" y1="${margin.top}" x2="${xScale(0)}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="2"/>`;

      // Plot studies
      trials.forEach(trial => {
        const x = xScale(Math.log(trial.effect));
        const y = yScale(trial.se);
        const color = trial.effect < 1 ? '#22c55e' : '#64748b';
        svg += `<circle cx="${x}" cy="${y}" r="6" fill="${color}" stroke="#fff" stroke-width="1"/>`;
        svg += `<text x="${x + 8}" y="${y + 3}" font-size="9" fill="#1a365d">${trial.name}</text>`;
      });

      // Axes
      svg += `<line x1="${margin.left}" y1="${height - margin.bottom}" x2="${width - margin.right}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;
      svg += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;

      // X axis ticks
      [-2, -1, 0, 0.5].forEach(logOR => {
        const x = xScale(logOR);
        const or = Math.exp(logOR).toFixed(2);
        svg += `<line x1="${x}" y1="${height - margin.bottom}" x2="${x}" y2="${height - margin.bottom + 5}" stroke="#1a365d"/>`;
        svg += `<text x="${x}" y="${height - margin.bottom + 18}" text-anchor="middle" font-size="10" fill="#1a365d">${or}</text>`;
      });

      // Y axis ticks
      [0, 0.25, 0.5, 0.75].forEach(se => {
        const y = yScale(se);
        svg += `<line x1="${margin.left - 5}" y1="${y}" x2="${margin.left}" y2="${y}" stroke="#1a365d"/>`;
        svg += `<text x="${margin.left - 10}" y="${y + 3}" text-anchor="end" font-size="10" fill="#1a365d">${se.toFixed(2)}</text>`;
      });

      // Axis labels
      svg += `<text x="${width/2}" y="${height - 10}" text-anchor="middle" font-size="12" fill="#1a365d">Odds Ratio</text>`;
      svg += `<text x="15" y="${height/2}" text-anchor="middle" transform="rotate(-90, 15, ${height/2})" font-size="12" fill="#1a365d">Standard Error</text>`;

      // Annotations
      svg += `<text x="${xScale(-1.5)}" y="${height - margin.bottom + 40}" text-anchor="middle" font-size="10" fill="#f59e0b" font-weight="bold">
        ⚠️ Asymmetric: Small trials cluster left
      </text>`;

      svg += '</svg>';
      container.innerHTML = svg;

      // Show interpretation
      document.getElementById('mag-funnel-interpretation').style.display = 'block';
    }

    // Reboxetine funnel plot data (published trials only - showing bias)
    function drawReboxetineFunnel() {
      const container = document.getElementById('reboxetine-funnel');
      if (!container) return;

      // Published trials (all showing benefit - biased)
      const publishedTrials = [
        { name: 'Trial 1', smd: 0.72, se: 0.18 },
        { name: 'Trial 2', smd: 0.58, se: 0.22 },
        { name: 'Trial 3', smd: 0.45, se: 0.20 },
        { name: 'Trial 4', smd: 0.61, se: 0.25 },
        { name: 'Trial 5', smd: 0.52, se: 0.19 },
        { name: 'Trial 6', smd: 0.68, se: 0.28 },
        { name: 'Trial 7', smd: 0.41, se: 0.16 },
      ];

      // Where the missing trials likely were (shown as ghost points)
      const missingTrials = [
        { name: 'Hidden 1', smd: -0.12, se: 0.22 },
        { name: 'Hidden 2', smd: 0.05, se: 0.19 },
        { name: 'Hidden 3', smd: -0.08, se: 0.25 },
        { name: 'Hidden 4', smd: 0.11, se: 0.20 },
        { name: 'Hidden 5', smd: -0.15, se: 0.28 },
      ];

      const width = 600;
      const height = 400;
      const margin = { left: 80, right: 40, top: 40, bottom: 60 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Pooled effect (published)
      const pooledSMD = 0.56;

      // X axis: SMD
      const minSMD = -0.5;
      const maxSMD = 1.0;
      const xScale = (smd) => margin.left + ((smd - minSMD) / (maxSMD - minSMD)) * plotWidth;

      // Y axis: SE (inverted)
      const maxSE = 0.35;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="max-width: 100%; height: auto;">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Funnel Plot: Reboxetine vs Placebo (Published Only)
      </text>`;

      // Funnel shape
      const funnelPoints = [];
      for (let se = 0.01; se <= maxSE; se += 0.01) {
        const ciWidth = 1.96 * se;
        const xLeft = xScale(pooledSMD - ciWidth);
        const xRight = xScale(pooledSMD + ciWidth);
        const y = yScale(se);
        funnelPoints.push({ xLeft, xRight, y });
      }

      let leftPath = `M ${xScale(pooledSMD)} ${yScale(0.01)}`;
      let rightPath = `M ${xScale(pooledSMD)} ${yScale(0.01)}`;
      funnelPoints.forEach(p => {
        leftPath += ` L ${p.xLeft} ${p.y}`;
        rightPath += ` L ${p.xRight} ${p.y}`;
      });
      svg += `<path d="${leftPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;
      svg += `<path d="${rightPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;

      // Pooled effect line
      svg += `<line x1="${xScale(pooledSMD)}" y1="${margin.top}" x2="${xScale(pooledSMD)}" y2="${height - margin.bottom}" stroke="#22c55e" stroke-width="2" stroke-dasharray="4"/>`;

      // Null line at SMD = 0
      svg += `<line x1="${xScale(0)}" y1="${margin.top}" x2="${xScale(0)}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="2"/>`;

      // Plot missing trials (ghost points)
      missingTrials.forEach(trial => {
        const x = xScale(trial.smd);
        const y = yScale(trial.se);
        svg += `<circle cx="${x}" cy="${y}" r="8" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="3"/>`;
      });

      // Plot published trials
      publishedTrials.forEach(trial => {
        const x = xScale(trial.smd);
        const y = yScale(trial.se);
        svg += `<circle cx="${x}" cy="${y}" r="6" fill="#22c55e" stroke="#fff" stroke-width="1"/>`;
      });

      // Axes
      svg += `<line x1="${margin.left}" y1="${height - margin.bottom}" x2="${width - margin.right}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;
      svg += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;

      // X axis ticks
      [-0.4, -0.2, 0, 0.2, 0.4, 0.6, 0.8].forEach(smd => {
        const x = xScale(smd);
        svg += `<line x1="${x}" y1="${height - margin.bottom}" x2="${x}" y2="${height - margin.bottom + 5}" stroke="#1a365d"/>`;
        svg += `<text x="${x}" y="${height - margin.bottom + 18}" text-anchor="middle" font-size="10" fill="#1a365d">${smd.toFixed(1)}</text>`;
      });

      // Y axis ticks
      [0.05, 0.15, 0.25, 0.35].forEach(se => {
        const y = yScale(se);
        svg += `<line x1="${margin.left - 5}" y1="${y}" x2="${margin.left}" y2="${y}" stroke="#1a365d"/>`;
        svg += `<text x="${margin.left - 10}" y="${y + 3}" text-anchor="end" font-size="10" fill="#1a365d">${se.toFixed(2)}</text>`;
      });

      // Axis labels
      svg += `<text x="${width/2}" y="${height - 10}" text-anchor="middle" font-size="12" fill="#1a365d">Standardized Mean Difference</text>`;
      svg += `<text x="15" y="${height/2}" text-anchor="middle" transform="rotate(-90, 15, ${height/2})" font-size="12" fill="#1a365d">Standard Error</text>`;

      // Legend
      svg += `<circle cx="${width - 120}" cy="${margin.top + 10}" r="5" fill="#22c55e"/>`;
      svg += `<text x="${width - 110}" y="${margin.top + 14}" font-size="10" fill="#1a365d">Published</text>`;
      svg += `<circle cx="${width - 120}" cy="${margin.top + 28}" r="6" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="3"/>`;
      svg += `<text x="${width - 110}" y="${margin.top + 32}" font-size="10" fill="#C53030">Missing?</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    // ============================================================
    // ACCESSIBILITY & UI HELPERS
    // ============================================================

    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('open');
      var btn = document.querySelector('.sidebar-toggle, .hamburger, .mobile-menu-btn'); if (btn) btn.setAttribute('aria-expanded', btn.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
    }

    function toggleGlossary() {
      const panel = document.getElementById('glossaryPanel');
      panel.classList.toggle('open');
      if (panel.classList.contains('open')) {
        document.getElementById('glossarySearch').focus();
      }
    }

    function filterGlossary() {
      const query = document.getElementById('glossarySearch').value.toLowerCase();
      const terms = document.querySelectorAll('.glossary-term');
      terms.forEach(term => {
        const text = term.textContent.toLowerCase();
        term.style.display = text.includes(query) ? 'block' : 'none';
      });
    }

    function toggleKeyboardHelp() {
      const help = document.getElementById('keyboardHelp');
      help.classList.toggle('open');
    }

    // Enhanced keyboard navigation
    document.addEventListener('keydown', (e) => {
      // Don't trigger shortcuts when typing in inputs
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
        if (e.key === 'Escape') {
          e.target.blur();
        }
        return;
      }

      switch(e.key) {
        case 'ArrowRight':
        case ' ':
          if (!e.shiftKey) {
            e.preventDefault();
            nextSlide();
          }
          break;
        case 'ArrowLeft':
        case 'Backspace':
          e.preventDefault();
          prevSlide();
          break;
        case 'ArrowDown':
        case 'n':
        case 'N':
          if (currentModule < modules.length - 1) {
            e.preventDefault();
            goToModule(currentModule + 1);
          }
          break;
        case 'ArrowUp':
        case 'p':
        case 'P':
          if (currentModule > 0) {
            e.preventDefault();
            goToModule(currentModule - 1);
          }
          break;
        case 't':
        case 'T':
          e.preventDefault();
          toggleToolsPanel();
          break;
        case 'g':
        case 'G':
          e.preventDefault();
          toggleGlossary();
          break;
        case '?':
          e.preventDefault();
          toggleKeyboardHelp();
          break;
        case 'Escape':
          document.getElementById('glossaryPanel').classList.remove('open');
          document.getElementById('keyboardHelp').classList.remove('open');
          document.querySelector('.sidebar').classList.remove('open');
          document.getElementById('sidebarOverlay').classList.remove('open');
          break;
      }
    });

    // ============================================================
    // QUIZ SYSTEM
    // ============================================================

    function checkQuizAnswer(questionId, selectedIdx, correctIdx, explanations) {
      const options = document.querySelectorAll(`#${questionId} .quiz-option`);
      options.forEach((opt, i) => {
        opt.classList.remove('selected');
        opt.onclick = null; // Disable further clicks
        if (i === correctIdx) {
          opt.classList.add('correct');
        } else if (i === selectedIdx && selectedIdx !== correctIdx) {
          opt.classList.add('incorrect');
        }
      });

      // Show explanation
      const feedbackEl = document.getElementById(`${questionId}-feedback`);
      if (feedbackEl) {
        const isCorrect = selectedIdx === correctIdx;
        feedbackEl.style.display = 'block';
        feedbackEl.innerHTML = `
          <div style="padding: 0.75rem; margin-top: 0.5rem; border-radius: 6px; background: ${isCorrect ? 'rgba(34,197,94,0.1)' : 'rgba(197,48,48,0.1)'}; border-left: 3px solid ${isCorrect ? 'var(--green)' : 'var(--red)'};">
            <strong>${isCorrect ? 'Correct!' : 'Not quite.'}</strong> ${explanations[correctIdx]}
          </div>
        `;
      }
    }

    // ============================================================
    // INITIALIZE
    // ============================================================

    document.addEventListener('DOMContentLoaded', () => {
      initModuleList();

      // Restore saved tier
      try {
        const savedTier = localStorage.getItem('synthesis_course_tier');
        if (savedTier && ['foundation','researcher','methodologist'].includes(savedTier)) {
          setTier(savedTier);
        }
      } catch(e) {}

      // Load saved progress
      const savedProgress = loadProgress();
      if (savedProgress) {
        goToModule(savedProgress.module);
        if (savedProgress.slide > 0) {
          setTimeout(() => goToSlide(savedProgress.slide), 100);
        }
      } else {
        goToModule(0);
      }

      // Initialize spaced repetition
      initSpacedRepetition();
      updateReviewButtonStatus();

      // Check for daily review badge
      if (spacedRepetitionState.dailyReviewsCompleted >= 7) {
        earnBadge('daily_dedication');
      }

      // Show daily review prompt if due (with slight delay for UX)
      if (shouldShowDailyReview()) {
        setTimeout(() => {
          // Only auto-prompt if they've completed at least one module
          const completedModules = document.querySelectorAll('.module-item.completed').length;
          if (completedModules >= 1) {
            openDailyReview();
          }
        }, 2000);
      }

      // Auto-save on navigation
      const originalGoToModule = goToModule;
      goToModule = function(moduleId) {
        // Mark previous module as complete if we're progressing
        if (moduleId > currentModule) {
          markModuleComplete(currentModule);
        }
        originalGoToModule(moduleId);
        saveProgress();
      };

      const originalGoToSlide = goToSlide;
      goToSlide = function(index) {
        originalGoToSlide(index);
        saveProgress();
      };
    });
  </script>
</body>
</html>
