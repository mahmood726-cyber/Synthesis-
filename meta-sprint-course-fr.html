<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>META-SPRINT¬†:¬†40 jours pour obtenir des preuves fiables</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&amp;family=Source+Sans+Pro:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
<style>
    :root {
      --navy: #1E2761;
      --deep-navy: #141B3D;
      --gold: #D4AF37;
      --cream: #FAF8F5;
      --light-cream: #FFFFFF;
      --text: #2D3748;
      --light-text: #718096;
      --red: #C53030;
      --green: #22c55e;
      --teal: #0f766e;
      --purple: #7c3aed;
      --orange: #f59e0b;
      --transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      height: 100%;
      font-family: 'Source Sans Pro', sans-serif;
      background: var(--deep-navy);
      color: var(--cream);
    }

    .course-container { display: flex; height: 100vh; overflow: hidden; }

    /* ====== SIDEBAR ====== */
    .sidebar {
      width: 300px;
      background: linear-gradient(180deg, var(--deep-navy) 0%, #0a0f1a 100%);
      border-right: 1px solid rgba(212,175,55,0.2);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .sidebar-header {
      padding: 1.25rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
      text-align: center;
    }
    .sidebar-header h1 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--gold);
    }
    .sidebar-header p {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    /* Gamification Stats Panel */
    .stats-panel {
      padding: 1rem;
      background: rgba(212,175,55,0.1);
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }
    .level-display {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .level-badge {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--gold), #f0c040);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 2px 8px rgba(212,175,55,0.4);
    }
    .level-info { flex: 1; }
    .level-title { font-weight: 700; font-size: 0.9rem; color: var(--gold); }
    .level-subtitle { font-size: 0.7rem; color: rgba(255,255,255,0.6); }
    .xp-bar {
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 0.5rem;
    }
    .xp-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--gold), var(--orange));
      border-radius: 4px;
      transition: width 0.5s ease;
    }
    .xp-text {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.5);
      text-align: right;
      margin-top: 0.25rem;
    }
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-top: 0.75rem;
    }
    .quick-stat {
      background: rgba(0,0,0,0.2);
      padding: 0.5rem;
      border-radius: 6px;
      text-align: center;
    }
    .quick-stat-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--gold);
    }
    .quick-stat-label {
      font-size: 0.6rem;
      color: rgba(255,255,255,0.5);
    }

    .module-list { flex: 1; overflow-y: auto; padding: 0.5rem 0; }
    .module-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.6rem 1rem;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }
    .module-item:hover { background: rgba(212,175,55,0.1); }
    .module-item.active { background: rgba(212,175,55,0.15); border-left-color: var(--gold); }
    .module-item.completed .module-number { background: var(--green); color: white; }
    .module-item.locked { opacity: 0.5; cursor: not-allowed; }
    .module-number {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
      flex-shrink: 0;
    }
    .module-item.active .module-number { background: var(--gold); color: var(--navy); }
    .module-info { flex: 1; min-width: 0; }
    .module-title { font-size: 0.8rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .module-subtitle { font-size: 0.65rem; color: rgba(255,255,255,0.5); }
    .module-xp { font-size: 0.6rem; color: var(--gold); }

    /* Badges Panel */
    .badges-panel {
      padding: 1rem;
      border-top: 1px solid rgba(212,175,55,0.2);
    }
    .badges-title { font-size: 0.75rem; font-weight: 600; color: var(--gold); margin-bottom: 0.5rem; }
    .badges-grid { display: flex; flex-wrap: wrap; gap: 0.35rem; }
    .badge-item {
      width: 32px;
      height: 32px;
      min-width: 44px;
      min-height: 44px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-family: inherit;
      color: inherit;
      padding: 0;
      opacity: 0.3;
      transition: all 0.3s;
      cursor: help;
      position: relative;
    }
    .badge-item.earned { opacity: 1; background: rgba(212,175,55,0.2); border-color: var(--gold); }
    .badge-item:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--navy);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.6rem;
      white-space: nowrap;
      z-index: 100;
    }

    /* ====== MAIN CONTENT ====== */
    .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .content-header {
      padding: 0.75rem 1.5rem;
      background: rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(212,175,55,0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .breadcrumb { font-size: 0.85rem; color: rgba(255,255,255,0.6); }
    .breadcrumb span { color: var(--gold); }
    .header-actions { display: flex; gap: 0.5rem; align-items: center; }
    .streak-display {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      background: rgba(239,68,68,0.2);
      border: 1px solid rgba(239,68,68,0.4);
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
    }
    .streak-display.active { background: rgba(249,115,22,0.2); border-color: var(--orange); }
    .streak-flame { font-size: 1rem; }
    .streak-count { font-weight: 700; color: var(--orange); }

    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn:hover { background: rgba(212,175,55,0.2); border-color: var(--gold); }
    .btn.primary { background: var(--gold); color: var(--navy); border-color: var(--gold); font-weight: 600; }

    .content-body { flex: 1; overflow: hidden; display: flex; }

    /* ====== SLIDES ====== */
    .slides-container { flex: 1; position: relative; overflow: hidden; touch-action: pan-y pinch-zoom; }
    .module-slides { display: none; width: 100%; height: 100%; }
    .module-slides.active { display: block; }

    .slide {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 2rem 2rem 4rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition), visibility var(--transition);
      overflow-y: auto;
    }
    .slide.active { opacity: 1; visibility: visible; }
    .slide.dark { background: var(--deep-navy); }
    .slide.light { background: var(--cream); color: var(--text); }
    .slide.black { background: #000; }
    .slide.red-bg { background: linear-gradient(135deg, #7f1d1d, #450a0a); }
    .slide.green-bg { background: linear-gradient(135deg, #14532d, #052e16); }
    .slide.purple-bg { background: linear-gradient(135deg, #4c1d95, #2e1065); }

    .serif { font-family: 'Cormorant Garamond', Georgia, serif; }
    .title {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.8rem, 4vw, 3rem);
      font-weight: 700;
      margin-bottom: 1rem;
      line-height: 1.2;
      text-align: center;
    }
    .title.gold { color: var(--gold); }
    .title.navy { color: var(--navy); }
    .subtitle {
      font-size: clamp(0.9rem, 2vw, 1.3rem);
      color: rgba(255,255,255,0.7);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .slide.light .subtitle { color: var(--light-text); }

    .big-number {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(4rem, 12vw, 8rem);
      font-weight: 700;
      line-height: 1;
    }
    .big-number.gold { color: var(--gold); }
    .big-number.red { color: var(--red); }

    .refrain {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.3rem, 3vw, 2rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      max-width: 700px;
    }

    .content { display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 850px; }

    /* Cards */
    .card {
      background: var(--light-cream);
      border: 1px solid var(--gold);
      padding: 1.25rem 1.5rem;
      margin: 0.5rem 0;
      max-width: 750px;
      width: 100%;
      border-radius: 8px;
    }
    .card.navy-bg { background: var(--navy); color: var(--cream); }
    .card.red-border { border: 2px solid var(--red); }
    .card.green-border { border: 2px solid var(--green); }
    .card-label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.05em;
      margin-bottom: 0.4rem;
      text-transform: uppercase;
    }
    .card-text { font-size: 0.95rem; line-height: 1.6; }
    .card.navy-bg .card-text { color: var(--cream); }

    /* Story box */
    .story-box {
      background: linear-gradient(135deg, rgba(197,48,48,0.15), rgba(30,39,97,0.2));
      border-left: 4px solid var(--red);
      padding: 1.25rem;
      margin: 0.75rem 0;
      max-width: 750px;
      width: 100%;
      border-radius: 0 8px 8px 0;
    }
    .story-box.success { background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(30,39,97,0.2)); border-left-color: var(--green); }
    .story-box.warning { background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(30,39,97,0.2)); border-left-color: var(--orange); }
    .story-label {
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      color: var(--red);
      margin-bottom: 0.4rem;
      text-transform: uppercase;
    }
    .story-box.success .story-label { color: var(--green); }
    .story-box.warning .story-label { color: var(--orange); }
    .story-text { font-size: 0.95rem; line-height: 1.6; }

    /* Epic Story Box */
    .story-box.epic {
      background: linear-gradient(135deg, rgba(20,27,61,0.95), rgba(0,0,0,0.9));
      border-left: 4px solid var(--gold);
      border-top: 1px solid rgba(212,175,55,0.3);
      border-right: 1px solid rgba(212,175,55,0.2);
      border-bottom: 1px solid rgba(212,175,55,0.2);
      padding: 1.5rem;
      position: relative;
    }
    .story-box.epic::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--gold), transparent);
    }
    .story-box.epic .story-label { color: var(--gold); font-size: 0.65rem; letter-spacing: 0.15em; }
    .story-box.epic .story-text { font-family: 'Cormorant Garamond', Georgia, serif; font-size: 1.05rem; line-height: 1.7; }
    .story-box.epic .story-moral {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(212,175,55,0.2);
      font-style: italic;
      color: var(--gold);
      font-size: 0.95rem;
    }

    /* Stats */
    .stats-grid {
      display: flex;
      gap: 0.75rem;
      margin: 1rem 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    .stat-box {
      background: var(--navy);
      color: var(--cream);
      padding: 1rem 1.25rem;
      text-align: center;
      min-width: 120px;
      border-radius: 8px;
    }
    .stat-box.light { background: var(--light-cream); color: var(--navy); border: 1px solid var(--gold); }
    .stat-value {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(1.3rem, 2.5vw, 2rem);
      font-weight: 700;
    }
    .stat-value.gold { color: var(--gold); }
    .stat-value.red { color: var(--red); }
    .stat-label { font-size: 0.75rem; opacity: 0.8; margin-top: 0.2rem; }

    /* Timeline */
    .timeline { display: flex; flex-direction: column; gap: 0.4rem; width: 100%; max-width: 650px; }
    .timeline-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.6rem 0.75rem;
      background: rgba(255,255,255,0.05);
      border-radius: 6px;
      border-left: 4px solid var(--gold);
    }
    .timeline-item.phase-a { border-left-color: var(--purple); }
    .timeline-item.phase-b { border-left-color: #3b82f6; }
    .timeline-item.phase-c { border-left-color: var(--orange); }
    .timeline-item.phase-d { border-left-color: var(--green); }
    .timeline-item.phase-e { border-left-color: var(--red); }
    .timeline-days { font-weight: 700; font-size: 0.8rem; min-width: 70px; color: var(--gold); }
    .timeline-content { flex: 1; }
    .timeline-title { font-weight: 600; font-size: 0.9rem; }
    .timeline-desc { font-size: 0.75rem; opacity: 0.7; }

    /* Checklist */
    .checklist { display: flex; flex-direction: column; gap: 0.4rem; width: 100%; max-width: 650px; }
    .checklist-item {
      display: flex;
      align-items: flex-start;
      gap: 0.6rem;
      padding: 0.6rem 0.75rem;
      background: rgba(255,255,255,0.05);
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .check-icon {
      width: 22px;
      height: 22px;
      background: var(--gold);
      color: var(--navy);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.75rem;
      flex-shrink: 0;
    }
    .checklist-text { font-size: 0.9rem; line-height: 1.4; }

    /* Lessons */
    .lesson-item { display: flex; align-items: flex-start; gap: 0.75rem; margin: 0.5rem 0; max-width: 700px; }
    .lesson-number {
      background: var(--gold);
      color: var(--navy);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.85rem;
      flex-shrink: 0;
    }
    .lesson-content h4 { font-size: 1rem; font-weight: 700; margin-bottom: 0.2rem; }
    .lesson-content p { font-size: 0.85rem; opacity: 0.8; }

    /* ====== DECISION TREE ====== */
    .decision-tree {
      width: 100%;
      max-width: 700px;
      background: linear-gradient(135deg, rgba(124,58,237,0.15), rgba(30,39,97,0.25));
      border: 2px solid var(--purple);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 0.75rem 0;
    }
    .decision-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    .decision-icon {
      width: 40px;
      height: 40px;
      background: var(--purple);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }
    .decision-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.2rem;
      font-weight: 700;
    }
    .decision-xp {
      margin-left: auto;
      background: rgba(212,175,55,0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      color: var(--gold);
      font-weight: 600;
    }
    .decision-scenario {
      background: rgba(0,0,0,0.2);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .decision-question {
      font-weight: 600;
      color: var(--gold);
      margin-bottom: 0.75rem;
      font-size: 1rem;
    }
    .decision-options { display: flex; flex-direction: column; gap: 0.5rem; }
    .decision-option {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.15);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .decision-option:hover { background: rgba(124,58,237,0.2); border-color: var(--purple); }
    .decision-option.selected { background: rgba(124,58,237,0.3); border-color: var(--purple); }
    .decision-option.correct { background: rgba(34,197,94,0.2); border-color: var(--green); }
    .decision-option.incorrect { background: rgba(239,68,68,0.15); border-color: var(--red); }
    .decision-option.disabled { pointer-events: none; opacity: 0.7; }
    .option-letter {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.8rem;
      flex-shrink: 0;
    }
    .decision-option.correct .option-letter { background: var(--green); color: white; }
    .decision-option.incorrect .option-letter { background: var(--red); color: white; }
    .option-text { font-size: 0.9rem; }
    .decision-feedback {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      display: none;
    }
    .decision-feedback.show { display: block; }
    .decision-feedback.correct { background: rgba(34,197,94,0.2); border: 1px solid var(--green); }
    .decision-feedback.incorrect { background: rgba(239,68,68,0.15); border: 1px solid var(--red); }
    .feedback-title { font-weight: 700; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
    .feedback-text { font-size: 0.9rem; line-height: 1.5; }

    /* ====== PREDICTION ====== */
    .prediction-panel {
      width: 100%;
      max-width: 700px;
      background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(30,39,97,0.25));
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 0.75rem 0;
      text-align: center;
    }
    .prediction-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
    .prediction-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.3rem;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }
    .prediction-subtitle { font-size: 0.9rem; opacity: 0.8; margin-bottom: 1rem; }
    .prediction-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .predict-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      border: 2px solid;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(0,0,0,0.2);
    }
    .predict-btn.benefit { border-color: var(--green); color: var(--green); }
    .predict-btn.benefit:hover { background: rgba(34,197,94,0.2); }
    .predict-btn.neutral { border-color: var(--light-text); color: var(--light-text); }
    .predict-btn.neutral:hover { background: rgba(148,163,184,0.2); }
    .predict-btn.harm { border-color: var(--red); color: var(--red); }
    .predict-btn.harm:hover { background: rgba(239,68,68,0.2); }
    .predict-btn.selected { transform: scale(1.02); box-shadow: 0 0 15px rgba(255,255,255,0.1); }
    .prediction-result {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      display: none;
    }
    .prediction-result.show { display: block; }
    .prediction-result.correct { background: rgba(34,197,94,0.2); border: 1px solid var(--green); }
    .prediction-result.incorrect { background: rgba(239,68,68,0.15); border: 1px solid var(--red); }

    /* ====== QUIZ ====== */
    .quiz-container { width: 100%; max-width: 650px; }
    .quiz-question {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.2rem;
      margin-bottom: 1.25rem;
      text-align: center;
    }
    .quiz-options { display: flex; flex-direction: column; gap: 0.5rem; }
    .quiz-option {
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      font-size: 0.9rem;
    }
    .quiz-option:hover { background: rgba(212,175,55,0.15); border-color: var(--gold); }
    .quiz-option.correct { background: rgba(34,197,94,0.2); border-color: var(--green); }
    .quiz-option.incorrect { background: rgba(239,68,68,0.15); border-color: var(--red); }
    .quiz-option.disabled { pointer-events: none; }
    .quiz-feedback {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      display: none;
      font-size: 0.9rem;
    }
    .quiz-feedback.show { display: block; }
    .quiz-feedback.correct { background: rgba(34,197,94,0.2); border: 1px solid var(--green); }
    .quiz-feedback.incorrect { background: rgba(239,68,68,0.15); border: 1px solid var(--red); }

    /* Crisis box */
    .crisis-box {
      background: linear-gradient(135deg, rgba(124,58,237,0.2), rgba(30,39,97,0.3));
      border: 2px solid var(--purple);
      border-radius: 12px;
      padding: 1.25rem;
      margin: 0.75rem 0;
      max-width: 750px;
      width: 100%;
    }
    .crisis-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
    .crisis-number {
      width: 36px;
      height: 36px;
      background: var(--purple);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.1rem;
    }
    .crisis-title { font-family: 'Cormorant Garamond', serif; font-size: 1.15rem; font-weight: 700; }
    .crisis-day { font-size: 0.75rem; color: var(--purple); }

    /* Animation */
    .slide.active .animate { animation: fadeUp 0.5s ease-out forwards; }
    .slide.active .animate.delay-1 { animation-delay: 0.1s; }
    .slide.active .animate.delay-2 { animation-delay: 0.2s; }
    .slide.active .animate.delay-3 { animation-delay: 0.3s; }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate { opacity: 0; }

    /* XP Popup */
    .xp-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: linear-gradient(135deg, var(--gold), #f0c040);
      color: var(--navy);
      padding: 1.5rem 2.5rem;
      border-radius: 12px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 2rem;
      font-weight: 700;
      z-index: 1000;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      transition: transform 0.3s ease;
    }
    .xp-popup.show { transform: translate(-50%, -50%) scale(1); }
    .xp-popup .xp-amount { font-size: 3rem; display: block; }

    /* Badge Earned Modal */
    .badge-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
    }
    .badge-modal.show { display: flex; }
    .badge-modal-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 2px solid var(--gold);
      border-radius: 16px;
      padding: 2rem;
      text-align: center;
      max-width: 350px;
    }
    .badge-modal-icon { font-size: 4rem; margin-bottom: 1rem; }
    .badge-modal-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.5rem;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }
    .badge-modal-desc { font-size: 0.9rem; opacity: 0.8; margin-bottom: 1rem; }
    .badge-modal-close {
      padding: 0.5rem 1.5rem;
      background: var(--gold);
      color: var(--navy);
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }

    /* Confetti - respects reduced motion */
    .confetti-container {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 999;
      overflow: hidden;
    }
    .confetti {
      position: absolute;
      width: 10px; height: 10px;
      opacity: 0;
      animation: confetti-fall 3s ease-out forwards;
    }
    @keyframes confetti-fall {
      0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      .confetti { display: none; }
    }

    /* Combo Counter */
    .combo-display {
      position: fixed;
      top: 80px;
      right: 20px;
      background: linear-gradient(135deg, var(--orange), #ef4444);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.9rem;
      z-index: 500;
      transform: scale(0);
      transition: transform 0.3s ease;
      box-shadow: 0 4px 15px rgba(239,68,68,0.4);
    }
    .combo-display.show { transform: scale(1); }
    .combo-display.big { transform: scale(1.2); }

    /* Key Takeaway Card */
    .takeaway-card {
      background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(30,39,97,0.2));
      border: 1px solid var(--green);
      border-radius: 8px;
      padding: 1rem 1.25rem;
      margin: 0.75rem 0;
      max-width: 700px;
      width: 100%;
    }
    .takeaway-card .takeaway-icon {
      display: inline-block;
      background: var(--green);
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      text-align: center;
      line-height: 24px;
      font-size: 0.8rem;
      margin-right: 0.5rem;
    }
    .takeaway-card .takeaway-label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--green);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.35rem;
    }
    .takeaway-card .takeaway-text {
      font-size: 0.9rem;
      line-height: 1.5;
      font-style: italic;
    }

    /* Module Time Estimate */
    .module-time {
      font-size: 0.55rem;
      color: rgba(255,255,255,0.4);
      display: flex;
      align-items: center;
      gap: 0.25rem;
      margin-top: 0.15rem;
    }

    /* Enhanced Focus States for Keyboard Navigation */
    .decision-option:focus-visible,
    .quiz-option:focus-visible,
    .predict-btn:focus-visible {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }
    .nav-btn:focus-visible,
    .btn:focus-visible {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }

    /* Progress within module */
    .slide-progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--gold), var(--orange));
      transition: width 0.3s ease;
      z-index: 50;
    }

    /* Citation Link Style */
    .citation-link {
      font-size: 0.7rem;
      color: var(--gold);
      opacity: 0.7;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      margin-top: 0.5rem;
    }
    .citation-link:hover { opacity: 1; text-decoration: underline; }

    /* Mobile Sidebar Toggle */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -300px;
        top: 0;
        bottom: 0;
        z-index: 1000;
        transition: left 0.3s ease;
      }
      .sidebar.open { left: 0; }
      .sidebar-toggle {
        display: flex;
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 1001;
        width: 40px;
        height: 40px;
        background: var(--gold);
        color: var(--navy);
        border: none;
        border-radius: 8px;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        cursor: pointer;
      }
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
      }
      .sidebar-overlay.show { display: block; }
    }
    @media (min-width: 769px) {
      .sidebar-toggle { display: none; }
      .sidebar-overlay { display: none !important; }
    }

    /* Nav */
    .slide-nav {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      padding: 0.75rem 1rem 1.25rem;
      z-index: 100;
      pointer-events: none;
    }
    .nav-btn {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 1.1rem;
      cursor: pointer;
      opacity: 0.6;
      transition: all 0.2s;
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      pointer-events: auto;
    }
    .nav-btn:hover { opacity: 1; background: rgba(0,0,0,0.7); border-color: var(--gold); }
    .nav-btn:disabled { opacity: 0.2; cursor: not-allowed; }
    .nav-center { display: flex; flex-direction: column; align-items: center; gap: 0.2rem; pointer-events: auto; }
    .slide-counter { font-size: 0.7rem; opacity: 0.5; }
    .progress-dots { display: flex; gap: 3px; flex-wrap: wrap; max-width: 220px; }
    .progress-dot {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
    }
    .progress-dot::after {
      content: '';
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--text-muted, rgba(255,255,255,0.25));
      transition: all 0.2s ease;
    }
    .progress-dot.active::after,
    .progress-dot.completed::after {
      background: var(--gold);
      width: 14px;
      height: 14px;
    }

    /* Course Progress Bar */
    .course-progress {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
      background: rgba(0,0,0,0.2);
    }
    .course-progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
      margin-bottom: 0.35rem;
    }
    .course-progress-bar {
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      overflow: hidden;
    }
    .course-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--green), #22d3ee);
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    /* Learning Objectives */
    .objectives-box {
      background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(30,39,97,0.25));
      border: 2px solid #3b82f6;
      border-radius: 12px;
      padding: 1.25rem;
      margin: 0.75rem 0;
      max-width: 700px;
      width: 100%;
    }
    .objectives-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .objectives-icon {
      width: 36px;
      height: 36px;
      background: #3b82f6;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }
    .objectives-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: #60a5fa;
    }
    .objectives-list {
      list-style: none;
      padding: 0;
    }
    .objectives-list li {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.4rem 0;
      font-size: 0.9rem;
    }
    .objectives-list li::before {
      content: '‚óã';
      color: #3b82f6;
      font-weight: bold;
    }
    .objectives-list li.completed::before {
      content: '‚óè';
      color: var(--green);
    }

    /* Module Summary */
    .summary-box {
      background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(30,39,97,0.25));
      border: 2px solid var(--green);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 0.75rem 0;
      max-width: 700px;
      width: 100%;
      text-align: center;
    }
    .summary-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
    .summary-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.4rem;
      color: var(--green);
      margin-bottom: 0.5rem;
    }
    .summary-stats {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin: 1rem 0;
    }
    .summary-stat {
      text-align: center;
    }
    .summary-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
    }
    .summary-stat-label {
      font-size: 0.75rem;
      opacity: 0.7;
    }
    .summary-next {
      margin-top: 1rem;
      padding: 0.75rem 1.5rem;
      background: var(--green);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .summary-next:hover { transform: scale(1.05); }

    /* Badge Progress Tooltip */
    .badge-progress {
      font-size: 0.55rem;
      color: rgba(255,255,255,0.4);
      position: absolute;
      bottom: -2px;
      right: -2px;
      background: var(--deep-navy);
      padding: 0 3px;
      border-radius: 3px;
    }
    .badge-item { position: relative; }

    /* Glossary Panel */
    .glossary-toggle {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      width: 50px;
      height: 50px;
      background: var(--gold);
      color: var(--navy);
      border: none;
      border-radius: 50%;
      font-size: 1.3rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      z-index: 500;
      transition: all 0.2s;
    }
    .glossary-toggle:hover { transform: scale(1.1); }
    .glossary-panel {
      position: fixed;
      bottom: 0;
      right: 0;
      width: 350px;
      max-height: 70vh;
      background: var(--deep-navy);
      border: 1px solid var(--gold);
      border-radius: 12px 0 0 0;
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: 501;
      display: flex;
      flex-direction: column;
    }
    .glossary-panel.open { transform: translateY(0); }
    .glossary-header {
      padding: 1rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .glossary-header h3 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      margin: 0;
    }
    .glossary-close {
      background: none;
      border: none;
      color: var(--cream);
      font-size: 1.2rem;
      cursor: pointer;
    }
    .glossary-content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }
    .glossary-item {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .glossary-term {
      font-weight: 700;
      color: var(--gold);
      font-size: 0.9rem;
    }
    .glossary-def {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.8);
      margin-top: 0.25rem;
    }

    /* Streak Warning */
    .streak-warning {
      background: rgba(239,68,68,0.2);
      border: 1px solid var(--red);
      color: var(--red);
      animation: pulse-warning 2s infinite;
    }
    @keyframes pulse-warning {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Perfect Module Bonus */
    .perfect-bonus {
      background: linear-gradient(135deg, var(--gold), #fbbf24);
      color: var(--navy);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
      animation: shine 2s infinite;
    }
    @keyframes shine {
      0%, 100% { box-shadow: 0 0 10px rgba(212,175,55,0.5); }
      50% { box-shadow: 0 0 20px rgba(212,175,55,0.8); }
    }

    /* Focus States for Accessibility */
    .decision-option:focus,
    .quiz-option:focus,
    .predict-btn:focus,
    .btn:focus,
    .nav-btn:focus {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }

    /* Print Stylesheet */
    @media print {
      .sidebar, .slide-nav, .stats-panel, .badges-panel, .glossary-toggle, .glossary-panel, .header-actions { display: none !important; }
      .main-content { width: 100%; }
      .slide { position: relative !important; page-break-inside: avoid; padding: 1rem; }
      .slide.active, .slide { opacity: 1 !important; visibility: visible !important; display: block !important; }
      .module-slides { display: block !important; }
    }

    /* Responsive */
    @media (max-width: 900px) {
      .sidebar { width: 70px; }
      .sidebar-header h1, .sidebar-header p, .module-title, .module-subtitle, .module-xp,
      .stats-panel, .badges-panel, .course-progress { display: none; }
      .module-item { padding: 0.6rem; justify-content: center; }
      .glossary-panel { width: 100%; border-radius: 12px 12px 0 0; }
      .progress-dot { width: 44px; height: 44px; }
      .progress-dot::after { width: 8px; height: 8px; }
      .progress-dot.active::after,
      .progress-dot.completed::after { width: 10px; height: 10px; }
    }

    /* Touch feedback */
    @media (hover: none) {
      .decision-option:active { background: rgba(124,58,237,0.3); }
      .quiz-option:active { background: rgba(212,175,55,0.2); }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      .confetti { display: none; }
    }

    /* Skip to content link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--gold);
      color: var(--navy);
      padding: 0.5rem 1rem;
      z-index: 10000;
      font-weight: 600;
      text-decoration: none;
      border-radius: 0 0 8px 0;
    }
    .skip-link:focus {
      top: 0;
    }

    /* Course completion modal */
    .completion-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.95);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1002;
    }
    .completion-modal.show { display: flex; }
    .completion-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 3px solid var(--gold);
      border-radius: 20px;
      padding: 2.5rem;
      text-align: center;
      max-width: 450px;
      animation: completion-pop 0.5s ease;
    }
    @keyframes completion-pop {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    .completion-trophy { font-size: 5rem; margin-bottom: 1rem; }
    .completion-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 2rem;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }
    .completion-subtitle { font-size: 1rem; opacity: 0.8; margin-bottom: 1.5rem; }
    .completion-stats {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .completion-stat { text-align: center; }
    .completion-stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--gold);
    }
    .completion-stat-label { font-size: 0.75rem; opacity: 0.7; }
    .completion-close {
      padding: 0.75rem 2rem;
      background: var(--gold);
      color: var(--navy);
      border: none;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
    }

    /* Review mistakes button */
    .review-mistakes-btn {
      position: fixed;
      bottom: 1.5rem;
      left: 1.5rem;
      padding: 0.6rem 1rem;
      background: rgba(239,68,68,0.2);
      border: 1px solid var(--red);
      color: var(--red);
      border-radius: 8px;
      font-size: 0.8rem;
      cursor: pointer;
      z-index: 500;
      display: none;
    }
    .review-mistakes-btn.show { display: block; }
    .review-mistakes-btn:hover { background: rgba(239,68,68,0.3); }

    /* Review panel */
    .review-panel {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      z-index: 1003;
      overflow-y: auto;
      padding: 2rem;
    }
    .review-panel.show { display: block; }
    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    .review-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.5rem;
      color: var(--red);
    }
    .review-close {
      background: none;
      border: 1px solid var(--cream);
      color: var(--cream);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
    }
    .review-item {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(239,68,68,0.3);
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1rem;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    .review-module { font-size: 0.75rem; color: var(--gold); margin-bottom: 0.5rem; }
    .review-question { font-weight: 600; margin-bottom: 0.75rem; }
    .review-your-answer { color: var(--red); font-size: 0.9rem; margin-bottom: 0.5rem; }
    .review-correct-answer { color: var(--green); font-size: 0.9rem; margin-bottom: 0.75rem; }
    .review-explanation { font-size: 0.85rem; opacity: 0.8; padding: 0.75rem; background: rgba(0,0,0,0.2); border-radius: 6px; }
  </style>
</head>
<body>
<a class="skip-link" href="#main-content">Skip to content</a>
<div class="course-container">
<!-- SIDEBAR -->
<nav aria-label="Navigation dans les cours" class="sidebar">
<div class="sidebar-header">
<a href="index.html" onmouseout="this.style.color='rgba(212,175,55,0.7)'" onmouseover="this.style.color='#D4AF37'" style="display:block;font-size:0.7rem;color:rgba(212,175,55,0.7);text-decoration:none;margin-bottom:0.5rem;">‚Üê Course Library</a>
<h1>META-SPRINT</h1>
<p>40 jours pour obtenir des preuves fiables</p>
</div>
<!-- Course Progress -->
<div class="course-progress">
<div class="course-progress-label">
<span>Course Progress</span>
<span id="courseProgressPct">0%</span>
</div>
<div class="course-progress-bar">
<div class="course-progress-fill" id="courseProgressFill" style="width: 0%"></div>
</div>
</div>
<!-- Gamification Stats -->
<div class="stats-panel">
<div class="level-display">
<div aria-label="Level icon" class="level-badge" id="levelIcon" role="img">üìä</div>
<div class="level-info">
<div class="level-title" id="levelTitle">Novice Analyst</div>
<div class="level-subtitle">Level <span id="levelNum">1</span></div>
</div>
</div>
<div aria-label="XP progress" class="xp-bar" role="progressbar">
<div class="xp-fill" id="xpFill" style="width: 0%"></div>
</div>
<div class="xp-text"><span id="xpCurrent">0</span> / <span id="xpNeeded">100</span> XP</div>
<div class="quick-stats">
<div class="quick-stat">
<div class="quick-stat-value" id="correctCount">0</div>
<div class="quick-stat-label">Correct</div>
</div>
<div class="quick-stat">
<div class="quick-stat-value" id="decisionCount">0</div>
<div class="quick-stat-label">Decisions</div>
</div>
<div class="quick-stat">
<div class="quick-stat-value" id="predictCount">0</div>
<div class="quick-stat-label">Predictions</div>
</div>
</div>
</div>
<div class="module-list" id="moduleList" role="list"></div>
<!-- Badges -->
<div class="badges-panel">
<div class="badges-title">Achievements</div>
<div class="badges-grid" id="badgesGrid"></div>
</div>
</nav>
<!-- MAIN -->
<div class="main-content">
<div class="content-header">
<div class="breadcrumb">META-SPRINT / <span id="currentModule">Introduction</span></div>
<div class="header-actions">
<div class="streak-display" id="streakDisplay">
<span class="streak-flame">üî•</span>
<span class="streak-count" id="streakCount">0</span>
<span style="font-size:0.7rem;opacity:0.7">streak</span>
</div>
<button class="btn" onclick="resetProgress()">Reset</button>
<button class="btn primary" onclick="nextSlide()">Continue ‚Üí</button>
</div>
</div>
<div class="content-body">
<div class="slides-container" id="main-content"></div>
</div>
</div>
</div>
<!-- XP Popup -->
<div class="xp-popup" id="xpPopup">
<span class="xp-amount" id="xpAmount">+25</span>
    XP
  </div>
<!-- Badge Modal -->
<div aria-labelledby="badgeModalTitle" aria-modal="true" class="badge-modal" id="badgeModal" role="dialog">
<div class="badge-modal-content">
<div class="badge-modal-icon" id="badgeModalIcon">üèÜ</div>
<div class="badge-modal-title" id="badgeModalTitle">Badge Earned!</div>
<div class="badge-modal-desc" id="badgeModalDesc">Vous avez d√©bloqu√© un nouveau succ√®s</div>
<button class="badge-modal-close" onclick="closeBadgeModal()">Awesome!</button>
</div>
</div>
<!-- Confetti Container -->
<div class="confetti-container" id="confettiContainer"></div>
<!-- Combo Counter -->
<div class="combo-display" id="comboDisplay">üî• <span id="comboCount">0</span>x Combo!</div>
<!-- Mobile Sidebar Toggle -->
<button aria-expanded="false" aria-label="Toggle menu" class="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</button>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
<!-- Glossary Toggle -->
<button aria-label="Open glossary" class="glossary-toggle" onclick="toggleGlossary()" title="Quick Reference">üìñ</button>
<!-- Glossary Panel -->
<div aria-label="Glossary" class="glossary-panel" id="glossaryPanel" role="dialog">
<div class="glossary-header">
<h3>Quick Reference</h3>
<button aria-label="Close glossary" class="glossary-close" onclick="toggleGlossary()">√ó</button>
</div>
<div class="glossary-content">
<div class="glossary-item">
<div class="glossary-term">DoD (Definition of Done)</div>
<div class="glossary-def">Binary gate checklist. All items must pass before proceeding to next phase.</div>
</div>
<div class="glossary-item">
<div class="glossary-term">PICOS</div>
<div class="glossary-def">Population, intervention, comparateur, r√©sultats, conception de l'√©tude - cadre pour les questions de recherche.</div>
</div>
<div class="glossary-item">
<div class="glossary-term">Provenance</div>
<div class="glossary-def">La piste d'audit montrant exactement d'o√π vient un nombre (par exemple, "Tableau 2, p.1234").</div>
</div>
<div class="glossary-item">
<div class="glossary-term">Red-Team</div>
<div class="glossary-def">Daily adversarial checking by 2 rotating members to catch errors in extraction.</div>
</div>
<div class="glossary-item">
<div class="glossary-term">CondGO</div>
<div class="glossary-def">Emergency protocol: 72 hours to fix a failed DoD gate or terminate with documented reasons.</div>
</div>
<div class="glossary-item">
<div class="glossary-term">Surrogate Outcome</div>
<div class="glossary-def">A measurable marker (e.g., cholesterol) used as proxy for patient-important outcomes (e.g., death).</div>
</div>
<div class="glossary-item">
<div class="glossary-term">FREEZE (Day 34)</div>
<div class="glossary-def">Verrouillage de la port√©e - aucune nouvelle √©tude ne peut √™tre ajout√©e apr√®s ce point.</div>
</div>
<div class="glossary-item">
<div class="glossary-term">I¬≤ (I-squared)</div>
<div class="glossary-def">Heterogeneity statistic. Low &lt;30%, Moderate 30-60%, High &gt;60%.</div>
</div>
<div class="glossary-item">
<div class="glossary-term">Analysis Capsule</div>
<div class="glossary-def">Package complet reproductible¬†: code, donn√©es, instructions. N'importe qui peut se pr√©senter et obtenir des r√©sultats identiques.</div>
</div>
<div class="glossary-item">
<div class="glossary-term">Consult Pack</div>
<div class="glossary-def">Document structur√© avec des options, des preuves et des compromis pour la prise de d√©cision en √©quipe.</div>
</div>
<div class="glossary-item">
<div class="glossary-term">PROSPERO</div>
<div class="glossary-def">Registre international des protocoles d'examen syst√©matique. Horodatage de vos m√©thodes pr√©d√©finies.</div>
</div>
<div class="glossary-item">
<div class="glossary-term">PRISMA</div>
<div class="glossary-def">Directive de cr√©ation de rapports pour les examens syst√©matiques. Comprend l'organigramme montrant la s√©lection des √©tudes.</div>
</div>
</div>
</div>
 Modal d'ach√®vement du cours 
<div aria-label="Cours termin√©" class="completion-modal" id="completionModal" role="dialog">
<div class="completion-content">
<div class="completion-trophy">üèÜ</div>
<div class="completion-title">Course Complete!</div>
<div class="completion-subtitle">You've mastered the META-SPRINT methodology</div>
<div class="completion-stats">
<div class="completion-stat">
<div class="completion-stat-value" id="finalXP">0</div>
<div class="completion-stat-label">Total XP</div>
</div>
<div class="completion-stat">
<div class="completion-stat-value" id="finalCorrect">0</div>
<div class="completion-stat-label">Correct Answers</div>
</div>
<div class="completion-stat">
<div class="completion-stat-value" id="finalBadges">0</div>
<div class="completion-stat-label">Badges Earned</div>
</div>
</div>
<p style="font-size:0.9rem;opacity:0.7;margin-bottom:1rem">Allez de l'avant et produisez des preuves fiables¬†!</p>
<div class="completion-actions" style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
<button class="btn primary" onclick="downloadCertificate()">Download Certificate</button>
<button class="completion-close" onclick="closeCompletionModal()">Continue</button>
</div>
</div>
</div>
 Bouton de r√©vision des erreurs 
<button aria-label="R√©viser les r√©ponses incorrectes" class="review-mistakes-btn" id="reviewMistakesBtn" onclick="showReviewPanel()">
    üìù Review Mistakes
  </button>
<!-- Review Panel -->
<div aria-label="R√©viser les r√©ponses incorrectes" class="review-panel" id="reviewPanel" role="dialog">
<div class="review-header">
<div class="review-title">üìù R√©visez vos erreurs</div>
<button class="review-close" onclick="closeReviewPanel()">Close</button>
</div>
<div id="reviewContent"></div>
</div>
<script>
// ===== GAMIFICATION STATE =====
const DEFAULT_STATE = {
  xp: 0,
  level: 1,
  streak: 0,
  lastActive: null,
  correctAnswers: 0,
  decisionsCompleted: 0,
  predictionsCorrect: 0,
  predictionsTotal: 0,
  badges: [],
  completedModules: [],
  perfectModules: [],
  answeredQuestions: {},
  consecutiveCorrect: 0
};

// Safe localStorage with fallback
function safeGetStorage(key, fallback) {
  try {
    const item = localStorage.getItem(key);
    return item ? JSON.parse(item) : fallback;
  } catch (e) {
    console.warn('localStorage unavailable, using session storage');
    return fallback;
  }
}

function safeSetStorage(key, value) {
  try {
    localStorage.setItem(key, JSON.stringify(value));
  } catch (e) {
    console.warn('Could not save to localStorage');
  }
}

// Migration from old storage key to versioned key
(function migrateStorage() {
  try {
    const oldData = localStorage.getItem('metasprintGame');
    if (oldData && !localStorage.getItem('metasprintGame_v1')) {
      localStorage.setItem('metasprintGame_v1', oldData);
      localStorage.removeItem('metasprintGame');
    }
  } catch (e) {}
})();

let gameState = safeGetStorage('metasprintGame_v1', DEFAULT_STATE);

const LEVELS = [
  { level: 1, title: "Novice Analyst", icon: "üìä", xp: 0 },
  { level: 2, title: "Protocol Apprentice", icon: "üìã", xp: 100 },
  { level: 3, title: "Search Specialist", icon: "üîç", xp: 250 },
  { level: 4, title: "Extraction Expert", icon: "üìù", xp: 450 },
  { level: 5, title: "Analysis Adept", icon: "üìà", xp: 700 },
  { level: 6, title: "Quality Guardian", icon: "üõ°Ô∏è", xp: 1000 },
  { level: 7, title: "Evidence Master", icon: "üèÜ", xp: 1400 },
  { level: 8, title: "Meta-Analysis Sage", icon: "üëë", xp: 1900 }
];

const BADGES = [
  { id: "first_blood", icon: "üéØ", name: "First Blood", desc: "R√©pondez correctement √† votre premi√®re question" },
  { id: "perfect_5", icon: "‚≠ê", name: "Five Star", desc: "Get 5 correct answers in a row" },
  { id: "decision_maker", icon: "‚öñÔ∏è", name: "Decision Maker", desc: "Compl√©ter 10 arbres de d√©cision" },
  { id: "oracle", icon: "üîÆ", name: "The Oracle", desc: "Predict 5 outcomes correctly" },
  { id: "protocol_pro", icon: "üìã", name: "Protocol Pro", desc: "Terminer le module Phase A" },
  { id: "search_savant", icon: "üîç", name: "Search Savant", desc: "Terminer le module Phase B" },
  { id: "data_detective", icon: "üïµÔ∏è", name: "Data Detective", desc: "Terminer le module Phase C" },
  { id: "stats_wizard", icon: "üßô", name: "Stats Wizard", desc: "Terminer la phase D module" },
  { id: "finisher", icon: "üèÅ", name: "Finisher", desc: "Terminer l'int√©gralit√© du cours" },
  { id: "streak_3", icon: "üî•", name: "On Fire", desc: "Maintain a 3-day streak" },
  { id: "streak_7", icon: "üí´", name: "Weekly Warrior", desc: "Maintain a 7-day streak" },
  { id: "colchicine_hero", icon: "üíä", name: "Colchicine Hero", desc: "Terminer l'√©tude de cas" }
];

// ===== MODULES DATA =====
const MODULES = [
  {
    id: 1, title: "Why META-SPRINT?", subtitle: "Le co√ªt des mauvaises preuves", xp: 150,
    slides: [
      { type: "title", theme: "dark", content: { title: "Why META-SPRINT?", subtitle: "Le co√ªt d'une erreur" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Understand why bad evidence causes real harm",
          "Apprendre de la trag√©die CAST et de Poldermans fraude",
          "Recognize surrogate outcome traps",
          "Understand what provenance verification means"
        ],
        tip: "Ce module ouvre la voie √† tout ce qui suit."
      }},
      { type: "prediction", theme: "dark", content: {
        icon: "üîÆ", title: "Faites votre pr√©diction",
        subtitle: "Dans les ann√©es 1980, des m√©dicaments ont √©t√© d√©velopp√©s pour supprimer les battements cardiaques irr√©guliers (PVC) apr√®s une crise cardiaque. Les m√©dicaments ont r√©ussi √† corriger les lectures de l'ECG. Selon vous, qu'est-il arriv√© aux taux de mortalit√©¬†?",
        options: [
          { id: "benefit", label: "üíö Deaths decreased", text: "Les m√©dicaments ont sauv√© des vies" },
          { id: "neutral", label: "‚ö™ No change", text: "Les d√©c√®s sont rest√©s les m√™mes" },
          { id: "harm", label: "‚ù§Ô∏è Deaths increased", text: "Les m√©dicaments ont caus√© des dommages" }
        ],
        answer: "harm",
        xp: 30
      }},
      { type: "story", theme: "red-bg", content: {
        label: "La trag√©die CAST", title: "50,000 Deaths",
        text: "The drugs that 'fixed' the ECG <strong>tripled</strong> death rates. 50,000 Americans died from drugs that made their monitors look better.",
        followup: "Suppressing PVCs was a surrogate outcome‚Äîit looked like benefit but masked real harm."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìä", title: "Sc√©nario¬†: l'impressionnant Chiffres",
        xp: 25,
        scenario: "Un nouveau m√©dicament contre le diab√®te montre qu'il r√©duit l'HbA1c (marqueur de la glyc√©mie) de 40¬†% de plus que le traitement standard. Le fabricant souhaite acc√©l√©rer l'approbation sur la base de ces ¬´¬†donn√©es d'efficacit√© impressionnantes¬†¬ª.",
        question: "What should regulators demand?",
        options: [
          { letter: "A", text: "Approve it‚Äî40% better HbA1c is significant", correct: false },
          { letter: "B", text: "Require trials showing reduced heart attacks, strokes, or death", correct: true },
          { letter: "C", text: "Approuver avec une surveillance post-commercialisation", correct: false },
          { letter: "D", text: "Request larger HbA1c trials for confirmation", correct: false }
        ],
        feedback: {
          correct: "Correct! HbA1c is a surrogate like PVCs. The CAST tragedy taught us: surrogates can improve while patients die. Demand patient-important outcomes.",
          incorrect: "HbA1c is a surrogate marker. CAST showed us that 'fixing' lab values can mask fatal harm. Always demand patient-important outcomes: death, heart attack, stroke."
        }
      }},
      { type: "stats", theme: "dark", content: {
        title: "L'ampleur des √©checs en mati√®re de preuves",
        stats: [
          { value: "50,000", label: "CAST drug deaths" },
          { value: "800,000", label: "Poldermans fraud deaths" },
          { value: "70%", label: "Studies unreproducible" }
        ],
        caption: "Ce ne sont pas des catastrophes rares. Ce sont les r√©sultats pr√©visibles de processus interrompus."
      }},
      { type: "story", theme: "dark", content: {
        label: "Le bilan Vioxx", title: "The Memo They Tried to Hide",
        text: "In 1996, Merck scientists discovered their painkiller Vioxx caused heart attacks. They wrote internal memos. They calculated the excess deaths. They did <strong>nothing</strong>. For eight years, doctors prescribed Vioxx while Merck executives debated how to spin the data.",
        followup: "When the truth emerged in 2004: 88,000 Americans had suffered heart attacks. 38,000 died. One internal email read: 'The cardiovascular events are clearly there.' They knew. They waited. People died."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìß", title: "Sc√©nario¬†: le signal interne",
        xp: 25,
        scenario: "Vous √™tes chercheur dans une soci√©t√© pharmaceutique. Votre analyse montre que votre m√©dicament √† succ√®s augmente les √©v√©nements cardiaques de 31 %. Votre responsable sugg√®re d'\"attendre plus de donn√©es\" et d'\"explorer des interpr√©tations alternatives\" avant de passer au niveau sup√©rieur.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Attendez plus de donn√©es comme sugg√©r√©", correct: false },
          { letter: "B", text: "Signalez imm√©diatement les r√©sultats au comit√© de s√©curit√©", correct: true },
          { letter: "C", text: "Run alternative analyses to see if the signal disappears", correct: false },
          { letter: "D", text: "Document your concerns in an email but take no action", correct: false }
        ],
        feedback: {
          correct: "Correct! The Vioxx lesson: 'waiting for more data' while people die is a decision that kills. Safety signals require immediate escalation.",
          incorrect: "Chaque jour de retard comporte un d√©compte des victimes. Les m√©mos internes de Vioxx ont montr√© qu'ils le savaient, mais ¬´ attendre plus de donn√©es ¬ª a tu√© 38 000 personnes. Signalez imm√©diatement les signaux de s√©curit√©."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "La tromperie du Tamiflu", title: "473 millions de livres sterling pour des donn√©es cach√©es",
        text: "In 2009, governments stockpiled Tamiflu for pandemic flu. The UK spent ¬£473 million. The evidence? Manufacturer-funded trials showing 'reduced complications.' The catch? Roche refused to release the full trial data for <strong>five years</strong>.",
        followup: "When researchers finally obtained the raw data, they found: No evidence Tamiflu reduced hospitalizations. No evidence it prevented complications. Half a billion pounds spent on a promise that couldn't be verified."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "‚ö†Ô∏è", title: "Sc√©nario¬†: les donn√©es de Polderman",
        xp: 25,
        scenario: "Vous examinez une m√©ta-analyse et remarquez qu'un chercheur a contribu√© √† 15 des 40 √©tudes incluses. Ses donn√©es montrent des r√©sultats nettement meilleurs que d‚Äôautres. Personne n'a v√©rifi√© l'existence de ses donn√©es brutes.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Inclure toutes les √©tudes¬†: elles ont pass√© l'examen par les pairs", correct: false },
          { letter: "B", text: "Demander une v√©rification de la provenance de ses √©tudes", correct: true },
          { letter: "C", text: "Exclude his studies without explanation", correct: false },
          { letter: "D", text: "Faites la moyenne de ses r√©sultats avec d'autres pour r√©duire l'impact", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! La v√©rification de la provenance demande¬†: ¬´¬†Puis-je retracer ce num√©ro jusqu'√† sa source¬†?¬†¬ª La fraude de Poldermans a tu√© 800¬†000 personnes parce que personne n'a pos√© cette question.",
          incorrect: "Not quite. Peer review doesn't verify raw data exists. You need provenance‚Äîthe trail from number to source document."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "La tromperie de Theranos", title: "One Drop of Blood, Billions in Lies",
        text: "In 2003, a 19-year-old Stanford dropout named <strong>Elizabeth Holmes</strong> made a promise that captivated the world: revolutionary blood tests from a single drop. No more needles. No more vials. Investors poured in $700 million. Walgreens signed a deal to put Theranos machines in 8,200 stores. Holmes graced magazine covers. Her company was valued at $9 billion.",
        followup: "The technology never worked. Not once. Theranos ran patient samples on competitors' machines, then hid the results. When the lies unraveled in 2015, the damage was done: <strong>thousands of patients received incorrect diagnoses</strong>. Cancer missed. HIV false positives. Treatment decisions based on fabricated data. Holmes is now serving 11 years in federal prison. The lesson: extraordinary claims without verifiable evidence aren't innovation‚Äîthey're fraud."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "ü©∏", title: "Sc√©nario¬†: la technologie r√©volutionnaire",
        xp: 25,
        scenario: "Une startup affirme que son IA peut d√©tecter 50 cancers √† partir d'une seule prise de sang avec une pr√©cision de 99¬†%. Ils ont r√©colt√© 500 millions de dollars. Les mentions de c√©l√©brit√©s abondent. Mais ils refusent de publier leurs donn√©es de validation, invoquant des ¬´ secrets commerciaux ¬ª. Un syst√®me hospitalier souhaite le d√©ployer imm√©diatement.",
        question: "What should the hospital demand before deployment?",
        options: [
          { letter: "A", text: "Faites confiance √† l'approbation de la FDA et d√©ployez", correct: false },
          { letter: "B", text: "Require independent validation on their own patient population", correct: true },
          { letter: "C", text: "Commencez par un petit projet pilote bas√© sur les donn√©es de l'entreprise", correct: false },
          { letter: "D", text: "Attendez les publications √©valu√©es par les pairs", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Theranos a obtenu l'approbation de la FDA pour un test tout en mentant sur des dizaines d'autres. La validation ind√©pendante sur VOS patients n‚Äôest pas n√©gociable. Les secrets commerciaux qui cachent les donn√©es de validation sont des signaux d'alarme.",
          incorrect: "Theranos fooled Walgreens, investors, and patients. The lesson: no independent validation, no deployment. 'Trust us' is not evidence."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "La catastrophe de l'OxyContin", title: "La pilule qui a d√©clench√© une √©pid√©mie",
        text: "In 1996, Purdue Pharma launched OxyContin with a bold claim: their new opioid was <strong>'less than 1% addictive.'</strong> They cited a brief letter to the editor in a 1980 New England Journal of Medicine‚Äîfive sentences about hospital patients, not outpatient prescriptions. Sales reps repeated the claim 500,000 times to doctors. Purdue spent $200 million marketing it as safe.",
        followup: "The Sackler family knew. Internal documents showed they tracked addiction reports. They knew their 12-hour pill was wearing off early, driving patients to take more. They did the math: more pills, more profit. By 2021: <strong>500,000 Americans dead from opioid overdoses</strong>. Purdue pleaded guilty to federal charges‚Äîtwice. The Sacklers paid $6 billion but admitted no personal wrongdoing. One misrepresented paragraph. Half a million graves."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üíä", title: "Sc√©nario¬†: La chasse aux citations",
        xp: 25,
        scenario: "Un repr√©sentant pharmaceutique affirme que son nouvel analg√©sique pr√©sente \"un risque de d√©pendance minime, prouv√© dans la litt√©rature. Ils vous remettent une r√©f√©rence. Vous d√©couvrez qu'il s'agit d'une lettre de 5¬†phrases adress√©e √† l'√©diteur datant de 1980 et qui √©tudie les patients hospitalis√©s, et non la population ambulatoire que vous traitez.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "It's in NEJM, so it's credible enough", correct: false },
          { letter: "B", text: "Demand RCTs with addiction as a pre-specified outcome in relevant populations", correct: true },
          { letter: "C", text: "Prescribe cautiously and monitor patients yourself", correct: false },
          { letter: "D", text: "Wait for colleagues to report problems first", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! La trag√©die de l'OxyContin a commenc√© avec une lettre de 5 phrases pr√©sent√©e √† tort comme preuve. Les lettres ne sont pas des preuves. Exigez de v√©ritables essais avec des r√©sultats pertinents dans les populations concern√©es.",
          incorrect: "Purdue a construit un empire sur une lettre de 5 phrases. ¬´ C'est publi√© ¬ª ne veut pas dire ¬´ c'est une preuve ¬ª. La population, la conception et les r√©sultats doivent correspondre √† votre question clinique."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "Le scandale Surgisphere", title: "La base de donn√©es qui n'a jamais exist√©",
        text: "In May 2020, the world was desperate for COVID-19 answers. Then <strong>The Lancet</strong> published a bombshell: hydroxychloroquine increased deaths in COVID patients. The study claimed data from 96,000 patients across 671 hospitals on six continents. The WHO halted trials. Countries banned the drug. The paper had one problem: <strong>the data was fabricated</strong>.",
        followup: "Surgisphere, a tiny company with 11 employees, claimed to have a global hospital database larger than any healthcare system on Earth. One employee was a science fiction author. Another was an adult content model. When journalists asked for verification, the company couldn't produce a single hospital contract. Both The Lancet and NEJM retracted their Surgisphere papers within weeks. During a pandemic, fabricated data hijacked global health policy. The peer reviewers never asked: 'Can we see proof this database exists?'"
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üè•", title: "Scenario: The Impossibly Large Dataset",
        xp: 25,
        scenario: "Un article pr√©tend analyser 200 000 patients de 1 500 h√¥pitaux dans 47 pays, collect√©s par une entreprise dont vous n'avez jamais entendu parler et qui compte 6 employ√©s. Les r√©sultats modifieraient les directives de traitement. Les pairs √©valuateurs l'ont approuv√©.",
        question: "Avant de citer cela dans votre revue syst√©matique, que devez-vous v√©rifier¬†?",
        options: [
          { letter: "A", text: "S'il s'agit d'une revue de premier plan, l'√©valuation par les pairs √©tait suffisante", correct: false },
          { letter: "B", text: "Contactez la soci√©t√© de donn√©es et demandez la documentation des partenariats hospitaliers", correct: true },
          { letter: "C", text: "Check if other researchers have cited it positively", correct: false },
          { letter: "D", text: "Recherchez les anomalies statistiques dans la tableaux publi√©s", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Surgisphere a tromp√© The Lancet et NEJM pendant une pand√©mie. La v√©rification de la provenance ‚Äì ¬´ prouver que ces donn√©es existent ¬ª ‚Äì l'aurait d√©tect√©. Les revues prestigieuses ne sont pas de provenance.",
          incorrect: "Le Lancet et le NEJM ont √©t√© tromp√©s. L'examen par les pairs ne v√©rifie pas l'existence des bases de donn√©es. Avant de vous fier √† des donn√©es extraordinaires, v√©rifiez que la source peut prouver qu'elles sont r√©elles."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "Le d√©sastre de Fen-Phen", title: "Les pilules amaigrissantes qui ont d√©truit des c≈ìurs",
        text: "In 1992, a researcher combined two FDA-approved drugs‚Äîfenfluramine and phentermine‚Äîfor weight loss. The combination was never tested together. The results seemed miraculous: patients lost weight effortlessly. Doctors prescribed it to <strong>6 million Americans</strong>. Weight loss clinics sprouted everywhere. Women's magazines celebrated the breakthrough.",
        followup: "Then the Mayo Clinic noticed something terrifying. Young, healthy women were developing a rare heart valve disease. One cardiologist saw 24 cases in a single year‚Äîhe'd seen only a handful in his entire career. The FDA investigated: <strong>30% of fen-phen users had abnormal heart valves</strong>. The combination was destroying hearts. By the time it was pulled in 1997, the damage was catastrophic. American Home Products paid $13 billion in settlements. The lesson: combining 'safe' drugs without testing the combination is not science‚Äîit's an uncontrolled experiment on patients."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üíî", title: "Sc√©nario¬†: la combinaison hors AMM",
        xp: 25,
        scenario: "Un coll√®gue vous montre des r√©sultats de perte de poids impressionnants de combiner deux m√©dicaments approuv√©s d'une mani√®re qui n'a jamais √©t√© test√©e lors d'essais. \"Ils sont tous deux approuv√©s par la FDA, la combinaison doit donc √™tre s√ªre.\" Ils souhaitent publier une s√©rie de cas et recommander le protocole.",
        question: "Quel est le d√©faut critique de ce raisonnement¬†?",
        options: [
          { letter: "A", text: "Les s√©ries de cas sont trop petites pour √™tre publi√©es", correct: false },
          { letter: "B", text: "Drug interactions can create harms not present in either drug alone", correct: true },
          { letter: "C", text: "Off-label use requires special FDA permission", correct: false },
          { letter: "D", text: "Weight loss drugs are too controversial", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Fen-phen a combin√© deux m√©dicaments ¬´ s√ªrs ¬ª en une combinaison destructrice du c≈ìur. Les interactions m√©dicamenteuses ne sont pas pr√©visibles √† partir des profils individuels. Les combinaisons non test√©es n√©cessitent leurs propres essais.",
          incorrect: "La fenfluramine √©tait ¬´ s√ªre ¬ª. La Phentermine √©tait ¬´ s√ªre ¬ª. Ensemble, ils ont d√©truit les valvules cardiaques chez 30 % des utilisateurs. Les combinaisons ont besoin de leurs propres preuves¬†: les hypoth√®ses tuent."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "La trag√©die du DES", title: "Le m√©dicament qui a hant√© trois g√©n√©rations",
        text: "In 1938, scientists synthesized DES‚Äîa synthetic estrogen. By 1941, doctors were prescribing it to pregnant women to prevent miscarriages. It seemed logical: estrogen supports pregnancy. <strong>5 million American women</strong> took it between 1940 and 1971. Nobody ran a controlled trial. Nobody tracked the babies.",
        followup: "In 1971, a physician noticed something impossible: <strong>young women in their teens and twenties were developing a rare vaginal cancer</strong> that typically struck women over 50. He traced it back: their mothers had all taken DES during pregnancy. The drug hadn't caused immediate harm‚Äîit had planted a time bomb in the womb. DES daughters had higher rates of infertility, miscarriage, and cancer. DES granddaughters‚Äîthe third generation‚Äîshowed elevated cancer risks too. One untested assumption. Three generations of harm. The first controlled trial of DES, run in 1953, showed it <strong>didn't even prevent miscarriages</strong>‚Äîthe original indication was worthless."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "ü§∞", title: "Sc√©nario¬†: le traitement logique",
        xp: 25,
        scenario: "Un traitement biologiquement plausible pour les complications de la grossesse est utilis√© depuis 15 ans. sans pr√©judice imm√©diat √©vident. Il n‚Äôexiste aucun essai contr√¥l√©. Un coll√®gue d√©clare¬†: \"Nous l'avons utilis√© sur des milliers de patients. Si cela causait des probl√®mes, nous le saurions d√©j√†.\"",
        question: "What critical assumption does this reasoning miss?",
        options: [
          { letter: "A", text: "15 years isn't long enough to judge safety", correct: false },
          { letter: "B", text: "Pregnancy exposures can cause harms that only appear decades later in offspring", correct: true },
          { letter: "C", text: "Observational experience is never valid", correct: false },
          { letter: "D", text: "Colleagues might be hiding adverse events", correct: false }
        ],
        feedback: {
          correct: "Correct! DES taught us the cruelest lesson: pregnancy exposures can cause cancers that appear 20-30 years later in children and grandchildren. 'No immediate harm' is not 'no harm.'",
          incorrect: "DES a sembl√© s√ªr pendant 30¬†ans, jusqu'√† ce que leurs filles commencent √† d√©velopper un cancer √† l'adolescence. Certains pr√©judices mettent des d√©cennies √† se manifester. Le suivi √† long terme de la prog√©niture est essentiel en cas d'exposition pendant la grossesse."
        }
      }},
      { type: "refrain", theme: "black", content: { text: "Les mauvaises preuves tuent. META-SPRINT existe pour produire des preuves auxquelles vous pouvez faire confiance." }},
      { type: "quiz", theme: "dark", content: {
        question: "Why did the CAST drugs increase deaths despite 'working' on ECGs?",
        options: [
          { text: "Les lectures ECG ont √©t√© mesur√©es de mani√®re incorrecte", correct: false },
          { text: "La suppression des PVC √©tait un substitut et non un v√©ritable r√©sultat", correct: true },
          { text: "La taille des √©chantillons √©tait trop petite", correct: false },
          { text: "Les m√©dicaments √©taient contamin√©s", correct: false }
        ],
        xp: 20,
        feedback: {
          correct: "Exactly. PVC suppression was a surrogate outcome‚Äîit looked like benefit but masked real harm.",
          incorrect: "Les m√©dicaments ont fonctionn√© exactement comme pr√©vu sur les ECG. Le probl√®me √©tait que les ECG ¬´ r√©par√©s ¬ª ne signifiaient pas sauver des vies."
        }
      }}
    ]
  },
  {
    id: 2, title: "Le cadre de 40 jours", subtitle: "Five phases, five gates", xp: 120,
    slides: [
      { type: "title", theme: "dark", content: { title: "40 Days, 5 Gates", subtitle: "Un sprint structur√© vers des preuves fiables" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Learn the five phases of META-SPRINT",
          "Understand Definition of Done (DoD) gates",
          "Conna√Ætre la structure de l'√©quipe et le temps consacr√© au quotidien"
        ],
        tip: "The framework overview - you'll learn each phase in detail later."
      }},
      { type: "timeline", theme: "dark", content: {
        title: "Les cinq phases",
        items: [
          { days: "Days 1-3", title: "Phase A: Protocol", desc: "Verrouillez votre question et vos m√©thodes", phase: "a" },
          { days: "Days 4-10", title: "Phase B: Search", desc: "Rechercher et filtrer la litt√©rature", phase: "b" },
          { days: "Days 11-28", title: "Phase C: Extraction", desc: "Extraire des donn√©es avec v√©rification", phase: "c" },
          { days: "Days 29-33", title: "Phase D: Analysis", desc: "Ex√©cuter et v√©rifier l'analyse", phase: "d" },
          { days: "Days 34-40", title: "Phase E: Submit", desc: "Write, audit, submit", phase: "e" }
        ]
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üö™", title: "Scenario: The 'Almost Done' Gate",
        xp: 25,
        scenario: "C'est le jour 3. Votre √©quipe a compl√©t√© 7 des 8 √©l√©ments de la liste de contr√¥le du DoD-A. L'√©l√©ment manquant : l'enregistrement du protocole sur PROSPERO est ¬´ en attente d'examen ¬ª (prend g√©n√©ralement 24 √† 48 heures).",
        question: "Devriez-vous r√©ussir le DoD-A ?",
        options: [
          { letter: "A", text: "Yes‚Äî7/8 is close enough, proceed to search", correct: false },
          { letter: "B", text: "No‚Äîwait for registration before passing gate", correct: true },
          { letter: "C", text: "Oui, inscrivez-vous plus tard et antidatez le protocole", correct: false },
          { letter: "D", text: "Skip registration‚Äîit's just bureaucracy", correct: false }
        ],
        feedback: {
          correct: "Correct! Gates are binary: pass or fail. 'Almost done' with protocol isn't done. Incomplete PICOS led to 50,000 CAST deaths.",
          incorrect: "Les portes sont binaires. Pas de cr√©dit partiel. L'inscription horodatage vos promesses. Sans cela, vous ne pouvez pas prouver que vous n'avez pas modifi√© les r√©sultats apr√®s avoir consult√© les donn√©es."
        }
      }},
      { type: "concept", theme: "dark", content: {
        title: "Definition of Done (DoD)",
        subtitle: "Binary gates: Pass or Fail",
        text: "Chaque phase se termine par une porte du DoD, une liste de contr√¥le qui doit √™tre compl√©t√©e √† 100 %. Pas de cr√©dit partiel. Non, ¬´ presque termin√© ¬ª.",
        highlight: "The CAST lesson: 'Almost done' with protocol isn't done."
      }},
      { type: "story", theme: "red-bg", content: {
        label: "Les lignes directrices qui ont tu√©", title: "800 000 d√©c√®s dus √† un seul fraudeur",
        text: "Pendant des ann√©es, les directives cliniques ont recommand√© la prise de b√™tabloquants avant une intervention chirurgicale pour pr√©venir les crises cardiaques. La preuve ? En grande partie de Don Poldermans, le chercheur qui a contribu√© √† la m√©ta-analyse avec 15 √©tudes. Ses donn√©es ont montr√© des avantages consid√©rables. Ses donn√©es ont √©t√© fabriqu√©es.",
        followup: "When the fraud was discovered and his studies removed, the math changed. Beta-blockers didn't prevent heart attacks during surgery‚Äîthey caused them. Researchers calculated: following guidelines based on Poldermans' fraud may have killed <strong>800,000 patients</strong> over a decade. One man's lies. Global guidelines. Mass harm."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìã", title: "Sc√©nario¬†:¬†le contributeur dominant",
        xp: 25,
        scenario: "Vous mettez √† jour une directive clinique. Votre revue syst√©matique comprend 40 √©tudes. Un chercheur en a contribu√© 15, et ses √©tudes montrent des effets consid√©rablement plus importants que ceux de tous les autres. Son travail n‚Äôa jamais √©t√© reproduit de mani√®re ind√©pendante.",
        question: "What should the guideline committee do?",
        options: [
          { letter: "A", text: "Inclure toutes les √©tudes¬†: l'examen par les pairs garantit la qualit√©", correct: false },
          { letter: "B", text: "Ex√©cuter une analyse de sensibilit√© avec et sans ses √©tudes", correct: true },
          { letter: "C", text: "Exclude his studies as obvious outliers", correct: false },
          { letter: "D", text: "Weight his studies lower due to 'heterogeneity'", correct: false }
        ],
        feedback: {
          correct: "Correct! Sensitivity analysis would have shown Poldermans' outsized influence. When one researcher dominates a field, verify their work independently before basing guidelines on it.",
          incorrect: "The Poldermans lesson: one dominant contributor can corrupt an entire field. Sensitivity analysis (with/without their studies) reveals dangerous dependencies."
        }
      }},
      { type: "stats", theme: "light", content: {
        title: "Les num√©ros META-SPRINT",
        stats: [
          { value: "40", label: "Days total" },
          { value: "5", label: "Quality gates" },
          { value: "12", label: "Team members" },
          { value: "2h", label: "Max daily work" }
        ]
      }},
      { type: "quiz", theme: "dark", content: {
        question: "What happens if a DoD gate fails?",
        options: [
          { text: "Vous pouvez quand m√™me proc√©der avec un avertissement", correct: false },
          { text: "You must fix all items before proceeding", correct: true },
          { text: "You skip to the next phase and return later", correct: false },
          { text: "Le projet est automatiquement annul√©", correct: false }
        ],
        xp: 15,
        feedback: {
          correct: "Right! Gates are non-negotiable. All items must pass before moving forward.",
          incorrect: "Les portes sont binaires : vous ne pouvez pas continuer tant que tous les √©l√©ments ne sont pas termin√©s. Cela emp√™che les erreurs de s‚Äôaggraver."
        }
      }}
    ]
  },
  {
    id: 3, title: "Phase A: Protocol", subtitle: "Jours 1 √† 3¬†: Verrouillez vos promesses", xp: 180,
    slides: [
      { type: "title", theme: "purple-bg", content: { title: "Phase A: Protocol", subtitle: "Jours 1 √† 3¬†: verrouillez vos promesses avant de voir les donn√©es" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Understand why protocol registration prevents outcome switching",
          "Learn to write unambiguous PICOS criteria",
          "Master the DoD-A checklist requirements",
          "Recognize the danger of surrogate outcomes"
        ],
        tip: "Terminez tous les sc√©narios de d√©cision pour gagner le badge Protocol Pro¬†!"
      }},
      { type: "story", theme: "dark", content: {
        label: "L‚Äô√©pid√©mie de changement de r√©sultat", title: "31% of Trials Cheat",
        text: "Une √©tude PLOS a r√©v√©l√© que 31 % des essais ont modifi√© leurs principaux crit√®res de jugement entre l'enregistrement et la publication, toujours dans le sens d'une meilleure apparence des r√©sultats."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üîÑ", title: "Sc√©nario¬†: Le commutateur tentant",
        xp: 25,
        scenario: "Votre protocole de m√©ta-analyse a sp√©cifi√© la ¬´ mortalit√© toutes causes confondues ¬ª comme r√©sultat principal. Apr√®s extraction, seules 4 √©tudes font √©tat de mortalit√©, mais 12 rapportent des ¬´¬†√©v√©nements cardiovasculaires¬†¬ª. Votre conseiller sugg√®re de changer de crit√®re de jugement principal ¬´ puisque les donn√©es le soutiennent mieux ¬ª.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Switch to cardiovascular events‚Äîmore data is better", correct: false },
          { letter: "B", text: "Keep mortality as primary, add CV events as secondary", correct: true },
          { letter: "C", text: "Report both as co-primary outcomes", correct: false },
          { letter: "D", text: "R√©viser le protocole et se r√©inscrire avant de continuer", correct: false }
        ],
        feedback: {
          correct: "Correct! Le protocole vous prot√®ge de vous-m√™me. 31¬†% des essais changent de r√©sultat¬†: c'est ainsi que les essais n√©gatifs deviennent ¬´ positifs ¬ª. Conservez votre primaire d'origine.",
          incorrect: "Changer de r√©sultat apr√®s avoir consult√© les donn√©es est exactement la mani√®re dont 31¬†% des essais trichent. Votre protocole est votre promesse. Les √©v√©nements CV peuvent √™tre une analyse secondaire."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "Le HRT Inversion", title: "Two Million Women",
        text: "Pendant quarante ans, les m√©decins ont prescrit un traitement hormonal substitutif pour pr√©venir les maladies cardiaques chez les femmes m√©nopaus√©es. Des √©tudes observationnelles ont montr√© 50 % de crises cardiaques en moins. Cela semblait √©vident. C'√©tait faux.",
        followup: "In 2002, the Women's Health Initiative RCT was stopped early. HRT <strong>increased</strong> heart attacks by 29%. Increased strokes by 41%. Increased breast cancer by 26%. Two million women had been taking a drug that harmed them, prescribed based on evidence that looked good but wasn't."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üî¨", title: "Sc√©nario¬†: La tentation observationnelle",
        xp: 25,
        scenario: "Vous r√©digez un protocole pour une revue syst√©matique d'une nouvelle intervention. 50 √©tudes observationnelles montrent un b√©n√©fice consid√©rable. Seuls trois petits ECR existent avec des r√©sultats mitig√©s. Votre √©quipe sugg√®re de se concentrer uniquement sur les √©tudes observationnelles ¬´ o√π les donn√©es sont plus solides ¬ª.",
        question: "Comment structurer le protocole¬†?",
        options: [
          { letter: "A", text: "Include only observational studies‚Äîlarger sample sizes", correct: false },
          { letter: "B", text: "Analyze RCTs and observational separately, RCTs primary", correct: true },
          { letter: "C", text: "Regrouper les ECR et les √©tudes observationnelles", correct: false },
          { letter: "D", text: "Exclure enti√®rement les √©tudes observationnelles", correct: false }
        ],
        feedback: {
          correct: "Correct! HRT observational studies showed 50% benefit; the RCT showed 29% harm. Confounding bias in observational studies can create illusions. RCTs must be primary.",
          incorrect: "The HRT reversal: observational studies said 'benefit,' the RCT said 'harm.' Healthy women chose HRT‚Äîconfounding created an illusion. RCTs break confounding."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "L'histoire de l'√©tude 329", title: "Ghostwritten Lies",
        text: "In 2001, SmithKline Beecham published Study 329: paroxetine was 'safe and effective' for adolescent depression. Doctors prescribed it to millions of teenagers. But the published paper was ghostwritten. The actual data showed something else entirely.",
        followup: "The raw data: paroxetine was <strong>no better than placebo</strong> for depression. Worse: it increased suicidal thinking in adolescents by 200%. The ghostwriters had cherry-picked outcomes, hidden adverse events, and turned failure into success. It took 14 years to get the truth published."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìã", title: "Sc√©nario¬†: Le dilemme du point temporel",
        xp: 30,
        scenario: "You're writing the protocol for a colchicine meta-analysis. Trials report MACE at 30 days, 90 days, 1 year, and 3 years. Two team members disagree: one wants 'longest follow-up,' another wants 'fixed 1-year for all.'",
        question: "Quelle est la meilleure approche¬†?",
        options: [
          { letter: "A", text: "Use longest follow-up per trial (maximizes data)", correct: false },
          { letter: "B", text: "Use fixed 1-year for all (cleaner comparison)", correct: false },
          { letter: "C", text: "Write a specific rule: 'Longest ‚â•1 year, else longest available'", correct: true },
          { letter: "D", text: "D√©cidez plus tard quand vous verrez quelles donn√©es existent", correct: false }
        ],
        feedback: {
          correct: "Excellent¬†! Une r√®gle sp√©cifique et pr√©d√©finie √©vite toute ambigu√Øt√©. L'option C √©quilibre la maximisation des donn√©es avec l'interpr√©tabilit√©.",
          incorrect: "Both A and B have merit, but they're still ambiguous. A specific rule like 'longest ‚â•1 year where available, else longest available' prevents disagreement during extraction."
        }
      }},
      { type: "checklist", theme: "dark", content: {
        title: "DoD-A Checklist",
        items: [
          "PICOS + inclusion/exclusion defined",
          "Primary outcome specified",
          "Timepoint rule documented",
          "Model choice (fixed/random)",
          "Sensitivity set defined",
          "Secondary outcomes labelled exploratory",
          "Protocol registered (PROSPERO/protocols.io)",
          "Signed by Integrator + non-integrator"
        ]
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üî¨", title: "Sc√©nario¬†: Le pi√®ge de substitution",
        xp: 25,
        scenario: "Votre conseiller clinique sugg√®re d'utiliser la ¬´¬†r√©duction du cholest√©rol¬†¬ª comme crit√®re de jugement principal, car davantage d'essais en font √©tat. Mais votre question initiale concernait la ¬´ mort cardiovasculaire ¬ª.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Switch to cholesterol‚Äîmore data is better", correct: false },
          { letter: "B", text: "Keep cardiovascular death as primary", correct: true },
          { letter: "C", text: "Use both as co-primary outcomes", correct: false },
          { letter: "D", text: "Add cholesterol as exploratory sensitivity", correct: false }
        ],
        feedback: {
          correct: "Correct! The CAST tragedy taught us: surrogate outcomes (like cholesterol) can mask real harm. Keep patient-important outcomes primary.",
          incorrect: "Cholesterol is a surrogate‚Äîit can improve while patients die (as in CAST). The Vioxx lesson: stick to patient-important outcomes."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "Le scandale Macchiarini", title: "The Surgeon Who Implanted Death",
        text: "Paolo Macchiarini was called a miracle worker. The Italian surgeon claimed he could grow synthetic tracheas and implant them in dying patients. <strong>The Lancet</strong> published his 'breakthroughs.' The Karolinska Institute‚Äîhome of the Nobel Prize‚Äîhired him. Patients flew from around the world seeking his revolutionary procedure.",
        followup: "One by one, his patients died. Of the eight who received his synthetic tracheas, <strong>seven died</strong>‚Äîmost within two years, suffocating as the plastic scaffolds disintegrated inside their throats. Karolinska's own doctors raised alarms. They were ignored. When a documentary exposed the truth, investigators found: falsified ethics approvals, fabricated patient outcomes, and co-authors who had never seen the data. The prestigious institute that awards the Nobel Prize had harbored a fraud who killed patients for fame. The Lancet retracted multiple papers. Macchiarini was convicted of assault. The lesson: prestige protects nothing. Only verification protects patients."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üèõÔ∏è", title: "Sc√©nario¬†: l'innovateur prestigieux",
        xp: 25,
        scenario: "Un chirurgien c√©l√®bre d'une institution de renomm√©e mondiale publie des r√©sultats r√©volutionnaires dans des revues de premier plan. Sa technique pourrait en sauver des milliers. Les coll√®gues juniors expriment leurs inqui√©tudes quant aux r√©sultats pour les patients, mais les hauts dirigeants les rejettent comme de la jalousie. Une √©quipe de documentaire demande des interviews.",
        question: "Que doit faire l'institution¬†?",
        options: [
          { letter: "A", text: "Protect the surgeon's reputation‚Äîbad press harms everyone", correct: false },
          { letter: "B", text: "Immediately audit all patient outcomes with independent reviewers", correct: true },
          { letter: "C", text: "Wait for peer-reviewed rebuttals before acting", correct: false },
          { letter: "D", text: "Let the surgeon respond to critics in his own publications", correct: false }
        ],
        feedback: {
          correct: "C'est exact¬†! Le plus grand √©chec de Karolinska a √©t√© d'ignorer les avertissements internes visant √† prot√©ger son prestige. Les audits ind√©pendants des r√©sultats, et non la gestion de la r√©putation, prot√®gent les patients. Les coll√®gues juniors voient souvent ce que les dirigeants ne voient pas.",
          incorrect: "L'Institut Karolinska a choisi la r√©putation plut√¥t que les patients. Sept personnes sont mortes. Lorsque des initi√©s font part de leurs inqui√©tudes, effectuez imm√©diatement un audit. Le prestige n'est pas une preuve de s√©curit√©."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "La fraude Hwang Woo-suk", title: "The Pride of a Nation, Built on Lies",
        text: "In 2004, South Korean scientist <strong>Hwang Woo-suk</strong> announced he had cloned human embryos and created patient-specific stem cells‚Äîa breakthrough that could cure Parkinson's, diabetes, and paralysis. He was a national hero. The government issued postage stamps in his honor. Schools taught his achievements. His papers in <strong>Science</strong> were celebrated as Nobel-worthy.",
        followup: "A junior researcher noticed the photos looked wrong. The same cells appeared in multiple images, supposedly from different experiments. When Science investigated, the fa√ßade crumbled: the breakthrough data was fabricated. Hwang had pressured junior researchers‚Äîmostly women‚Äîto donate eggs under ethically questionable conditions. He had fabricated results to meet impossible expectations. The 'cloned' stem cells never existed. South Korea's national pride evaporated overnight. Hwang was convicted of embezzlement and bioethics violations. He had spent $40 million in government funds on research that produced nothing but lies."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üî¨", title: "Sc√©nario¬†: la priorit√© nationale",
        xp: 25,
        scenario: "Le principal scientifique de votre pays revendique une avanc√©e r√©volutionnaire. Le gouvernement finance une expansion massive. Les concurrents internationaux se battent pour r√©pliquer. Un jeune membre du laboratoire vous dit discr√®tement que les donn√©es d'image semblent manipul√©es, mais craint des repr√©sailles s'il s'exprime.",
        question: "What is the correct first step?",
        options: [
          { letter: "A", text: "Prot√©gez l'identit√© du lanceur d'alerte tout en demandant une analyse d'image ind√©pendante", correct: true },
          { letter: "B", text: "Confrontez directement le scientifique principal avec les pr√©occupations", correct: false },
          { letter: "C", text: "Wait for international labs to attempt replication", correct: false },
          { letter: "D", text: "Report to government funders immediately", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! L‚Äôanalyse d‚Äôimages r√©alis√©e par des analystes ind√©pendants ‚Äì sans exposer le lanceur d‚Äôalerte ‚Äì est la voie la plus s√ªre. La fraude de Hwang a √©t√© d√©tect√©e par analyse d'image. Les jeunes chercheurs qui s'expriment ont besoin de protection.",
          incorrect: "La confrontation directe met en danger les lanceurs d'alerte et permet la destruction des preuves. La fraude de Hwang a √©t√© d√©tect√©e par l'analyse d'images montrant des cellules dupliqu√©es. Examen m√©dico-l√©gal ind√©pendant, puis escalade."
        }
      }},
      { type: "concept", theme: "light", content: {
        title: "La r√®gle des deux signatures",
        subtitle: "Why two people must sign",
        text: "The Poldermans fraud succeeded because one researcher controlled everything. Single points of authority enable fraud.",
        highlight: "Two signatures means two people verified."
      }},
      { type: "quiz", theme: "dark", content: {
        question: "Why must the protocol be registered BEFORE DoD-A passes?",
        options: [
          { text: "It's a journal requirement only", correct: false },
          { text: "Elle horodate vos promesses avant de voir les donn√©es", correct: true },
          { text: "Cela donne √† l'examen un aspect plus professionnel", correct: false },
          { text: "It's optional for non-Cochrane reviews", correct: false }
        ],
        xp: 20,
        feedback: {
          correct: "Exactement¬†! L'inscription cr√©e un horodatage. Sans cela, vous ne pouvez pas prouver que vous n'avez pas modifi√© les r√©sultats apr√®s avoir vu ce qui a fonctionn√©.",
          incorrect: "L'enregistrement horodatage vos m√©thodes pr√©d√©finies. 31¬†% des essais modifient les r√©sultats¬†: l'inscription prouve que ce n'est pas le cas."
        }
      }}
    ]
  },
  {
    id: 4, title: "Phase B: Search", subtitle: "Days 4-10: Document everything", xp: 150,
    slides: [
      { type: "title", theme: "dark", content: { title: "Phase B: Search & Screen", subtitle: "Days 4-10: Systematic, documented, reproducible" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Understand why search strings must be saved verbatim",
          "Learn calibration requirements for dual screening",
          "Master PRISMA reporting requirements",
          "Know when exclusion reasons are required"
        ],
        tip: "Compl√©tez ce module pour obtenir le badge Search Savant¬†!"
      }},
      { type: "story", theme: "dark", content: {
        label: "La r√©tractation Cochrane", title: "Every Character Matters",
        text: "Une revue Cochrane a √©t√© retir√©e lorsque les auditeurs n'ont pas pu reproduire la recherche. ¬´¬†Nous avons utilis√© PubMed¬†¬ª n'est pas une m√©thode."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üíæ", title: "Sc√©nario¬†: La recherche reconstruite",
        xp: 25,
        scenario: "You're at Day 8. A team member admits they didn't save the exact search string from last week‚Äîbut they 'remember most of it' and have reconstructed it. The search yielded 2,400 results then; the reconstructed search yields 2,380.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Accept it‚Äî20 missing records won't matter", correct: false },
          { letter: "B", text: "R√©ex√©cutez et documentez la nouvelle recherche comme √©tant la recherche officielle", correct: true },
          { letter: "C", text: "Utilisez la recherche reconstruite et notez-la dans les limitations", correct: false },
          { letter: "D", text: "Contact the database to get search history", correct: false }
        ],
        feedback: {
          correct: "Correct! Une recherche qui ne peut √™tre reproduite ne constitue pas une preuve. Documentez la nouvelle recherche comme officielle, notez l'√©cart et proc√©dez avec des m√©thodes transparentes.",
          incorrect: "The Cochrane retraction: 'We used PubMed' isn't a method. You need the exact string, exact date, exact filters. Start fresh with documented methods."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "Les essais enterr√©s", title: "O√π sont pass√©es 74 √©tudes¬†?",
        text: "En 2008, les chercheurs ont recherch√© tous les essais enregistr√©s sur les antid√©presseurs. Ils ont trouv√© 74 essais. Ensuite, ils ont recherch√© des publications. Seulement 38 avaient √©t√© publi√©s. Les 36 autres ? Enterr√©. Cach√©. Fini.",
        followup: "Every single buried trial showed negative results. Every published trial showed positive results. The published literature told doctors: 'Antidepressants work 94% of the time.' The truth: they worked 51% of the time. Half the evidence had simply vanished."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üîé", title: "Sc√©nario¬†: les enregistrements manquants",
        xp: 25,
        scenario: "Votre recherche dans la litt√©rature publi√©e r√©v√®le 12 essais sur un nouveau m√©dicament, tous positifs. Vous consultez les registres d'essais et trouvez 8 essais suppl√©mentaires enregistr√©s qui n'ont jamais √©t√© publi√©s. La soci√©t√© affirme que les essais non publi√©s pr√©sentaient des ¬´¬†probl√®mes de qualit√© des donn√©es¬†¬ª.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Incluez uniquement les 12 essais publi√©s¬†: ils contiennent des donn√©es utilisables", correct: false },
          { letter: "B", text: "Demandez des donn√©es non publi√©es aux contacts du registre et √† la FDA", correct: true },
          { letter: "C", text: "Note the 8 missing trials as a limitation", correct: false },
          { letter: "D", text: "Excluez le m√©dicament de votre examen en raison de biais. pr√©occupations", correct: false }
        ],
        feedback: {
          correct: "Correct! The buried trials lesson: 48% of antidepressant data was hidden. Request unpublished data from registries, FDA, authors. Half the truth is a lie.",
          incorrect: "36 of 74 antidepressant trials were buried‚Äîall negative. Published-only evidence showed 94% efficacy; true efficacy was 51%. Always hunt for unpublished data."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "Le scandale de la r√©box√©tine", title: "Le m√©dicament qui n'a jamais fonctionn√©",
        text: "Reboxetine was approved in Europe for depression. Published trials showed it worked. Doctors prescribed it. Then researchers obtained the unpublished data. <strong>74% of the patient data had never been published.</strong>",
        followup: "Les donn√©es cach√©es ont montr√©¬†: la r√©box√©tine n'√©tait pas meilleure que le placebo. C'√©tait pire que les autres antid√©presseurs. Cela avait plus d‚Äôeffets secondaires. Les patients ont souffert pendant des ann√©es avec un m√©dicament que les r√©gulateurs ont approuv√© sur la base de preuves tri√©es sur le volet."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üîç", title: "Sc√©nario¬†: Le d√©saccord de s√©lection",
        xp: 25,
        scenario: "Vos deux √©valuateurs ont examin√© ind√©pendamment 50 titres/r√©sum√©s pour l'√©talonnage. Ils n‚Äô√©taient d‚Äôaccord que sur 28 points (56% d‚Äôaccord). L'objectif est ‚â•80¬†%.",
        question: "What should happen next?",
        options: [
          { letter: "A", text: "Proceed anyway‚Äî56% is acceptable for complex topics", correct: false },
          { letter: "B", text: "Discuss disagreements, revise criteria, re-calibrate on new 25", correct: true },
          { letter: "C", text: "Have a third person break all ties", correct: false },
          { letter: "D", text: "Switch to single-screener with random verification", correct: false }
        ],
        feedback: {
          correct: "Bien¬†! Un faible accord signifie que vos crit√®res sont ambigus. Discutez, r√©visez, r√©p√©tez jusqu'√† ce que vous atteigniez ‚â•80¬†%.",
          incorrect: "56¬†% d'accord signifie que vos crit√®res sont ambigus. Vous effectuez essentiellement un d√©pistage au hasard. Discutez, r√©visez, recalibrez."
        }
      }},
      { type: "checklist", theme: "dark", content: {
        title: "DoD-B Checklist",
        items: [
          "Search strings saved verbatim",
          "Search dates + limits recorded",
          "M√©thode de d√©duplication enregistr√©e",
          "Screening calibration (‚â•80%)",
          "PRISMA counts live",
          "Screening log exportable"
        ]
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìä", title: "Sc√©nario¬†: Le puzzle PRISMA",
        xp: 25,
        scenario: "Your PRISMA shows: Identified: 2,400 | After dedup: 1,800 | Screened: 1,800 | Full-text: 150 | Included: 45. A peer reviewer asks: 'What happened to the 1,650 excluded at screening?'",
        question: "Quelle est la bonne r√©ponse¬†?",
        options: [
          { letter: "A", text: "'They didn't meet criteria'‚Äîno need for details", correct: false },
          { letter: "B", text: "Provide counts by exclusion reason", correct: false },
          { letter: "C", text: "Explain that screening exclusions don't need reasons", correct: true },
          { letter: "D", text: "Go back and document each exclusion reason", correct: false }
        ],
        feedback: {
          correct: "Correct! Title/abstract screening exclusions don't require individual reasons (too many). Full-text exclusions DO need documented reasons.",
          incorrect: "Screening exclusions (title/abstract) don't require individual reasons‚Äîthere are too many. But FULL-TEXT exclusions must have documented reasons."
        }
      }},
      { type: "stats", theme: "dark", content: {
        title: "PRISMA Requirements",
        stats: [
          { value: "100%", label: "Numbers add up" },
          { value: "Every", label: "Full-text exclusion documented" },
          { value: "Zero", label: "Black boxes" }
        ]
      }},
      { type: "story", theme: "dark", content: {
        label: "Les disparus La moiti√©", title: "√âtudes secr√®tes de Neurontin",
        text: "Pfizer a fait la promotion de Neurontin pour le trouble bipolaire, les migraines et la douleur, des utilisations jamais approuv√©es par la FDA. Des documents internes ont r√©v√©l√© qu'ils avaient command√© des √©tudes. Lorsque les r√©sultats √©taient n√©gatifs, les √©tudes disparaissaient tout simplement.",
        followup: "La litt√©rature publi√©e montrait que Neurontin fonctionnait pour des utilisations non conformes. Des documents non publi√©s ont montr√© que ce n‚Äô√©tait pas le cas. Les m√©decins n‚Äôont vu que la moiti√© des preuves et ont tir√© une conclusion √©vidente ‚Äì fausse. Pfizer a pay√© 430 millions de dollars d'amende. Mais les patients qui ont re√ßu un traitement inefficace ? Ils ont pay√© plus."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìÅ", title: "Sc√©nario¬†: l'offre de l'entreprise",
        xp: 25,
        scenario: "Une soci√©t√© pharmaceutique propose de partager sa \"base de donn√©es interne compl√®te\" pour votre examen syst√©matique. Ils promettent toutes les donn√©es des essais, mais seulement si vous signez un accord de confidentialit√© vous emp√™chant de publier des r√©sultats d'essais individuels sans leur approbation.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Acceptez¬†: l'obtention des donn√©es est ce qui compte", correct: false },
          { letter: "B", text: "Acceptez mais notez la restriction dans vos m√©thodes", correct: false },
          { letter: "C", text: "Refusez et demandez des donn√©es via les canaux officiels √† la place", correct: true },
          { letter: "D", text: "Acceptez cet examen, luttez pour la transparence plus tard", correct: false }
        ],
        feedback: {
          correct: "Correct! Neurontin's lesson: companies hide what they don't want seen. Confidentiality agreements can be weaponized. Request data through FDA, EMA, or AllTrials instead.",
          incorrect: "Scandale Neurontin¬†: des entreprises ont supprim√© les essais n√©gatifs. Les accords de confidentialit√© leur donnent un droit de veto sur ce que vous signalez. Maintenez votre ind√©pendance."
        }
      }},
      { type: "quiz", theme: "dark", content: {
        question: "Why must search dates be recorded?",
        options: [
          { text: "Pour les archives du journal", correct: false },
          { text: "Les bases de donn√©es sont mises √† jour quotidiennement¬†: votre date est votre horodatage", correct: true },
          { text: "To calculate how long the search took", correct: false },
          { text: "It's optional metadata", correct: false }
        ],
        xp: 15,
        feedback: {
          correct: "Exactement¬†! Une recherche lundi trouve des √©tudes diff√©rentes de celles de mardi. Vos dates d√©finissent l'univers dans lequel vous avez recherch√©.",
          incorrect: "Les bases de donn√©es sont mises √† jour en permanence. Votre date de recherche est l'horodatage de l'univers de litt√©rature dans lequel vous avez recherch√©."
        }
      }}
    ]
  },
  {
    id: 5, title: "Phase C: Extraction", subtitle: "Days 11-28: Provenance for every number", xp: 200,
    slides: [
      { type: "title", theme: "dark", content: { title: "Phase C: Extraction", subtitle: "Days 11-28: Every number needs a source" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Understand what provenance means and why it matters",
          "Learn the Red-Team daily checking system",
          "Handle conflicting numbers with pre-specified rules",
          "Recognize the COLCOT near-disaster pattern"
        ],
        tip: "L'√©tude de cas COLCOT montre comment un bras √©chang√© a presque invers√© les conclusions."
      }},
      { type: "prediction", theme: "dark", content: {
        icon: "üîÆ", title: "L'essai COLCOT",
        subtitle: "The largest trial (n=4,745) in a colchicine meta-analysis. The extractor pulls data from Figure 3 showing colchicine vs placebo events. Quick forest plot shows colchicine INCREASES events, while all other trials show benefit. What happened?",
        options: [
          { id: "benefit", label: "üìä Statistical fluke", text: "Random variation‚Äîinclude as-is" },
          { id: "neutral", label: "‚ùì Erreur de saisie de donn√©es", text: "Wrong numbers typed" },
          { id: "harm", label: "üîÑ Arms swapped", text: "Intervention/control mixed up" }
        ],
        answer: "harm",
        xp: 30
      }},
      { type: "story", theme: "red-bg", content: {
        label: "La quasi-catastrophe COLCOT", title: "One Swapped Arm",
        text: "The extractor assumed left bar = intervention. It was right = intervention. One error in one critical field would have reversed the entire conclusion.",
        followup: "Le contr√¥le quotidien de l'√©quipe rouge l'a d√©tect√©. C'est pourquoi des √©tudes influentes sont v√©rifi√©es."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üî¥", title: "Scenario: Red-Team Finds an Error",
        xp: 30,
        scenario: "La v√©rificatrice de l'√©quipe rouge, Fatima, d√©couvre que les bras COLCOT ont √©t√© √©chang√©s. Il s'agit de l'essai le plus important (40 % du poids total). L'extracteur d√©fend : 'Le chiffre √©tait ambigu.'",
        question: "What should happen?",
        options: [
          { letter: "A", text: "Correction avec la provenance du tableau 2, correction du journal", correct: true },
          { letter: "B", text: "Exclude COLCOT‚Äîtoo risky to include", correct: false },
          { letter: "C", text: "Expand audit to ALL studies immediately", correct: false },
          { letter: "D", text: "Ask the original authors to clarify", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Corrigez avec la provenance (le tableau 2 confirme l'attribution), enregistrez la correction. Une erreur unique avec une cause claire ne n√©cessite pas d'audit √©tendu.",
          incorrect: "N'excluez pas de bonnes donn√©es ni un audit trop √©tendu pour une seule erreur avec une cause claire. Corrigez la provenance, enregistrez-la et informez l'extracteur."
        }
      }},
      { type: "concept", theme: "dark", content: {
        title: "Le syst√®me Red-Team",
        subtitle: "Daily adversarial checking",
        text: "Chaque jour √† partir du jour 11, 2 membres de l'√©quipe en rotation passent 12 √† 15 minutes √† v√©rifier les √©tudes s√©lectionn√©es automatiquement.",
        highlight: "La d√©tection Boldt¬†: sa fraude (plus de 90¬†√©tudes) a √©t√© d√©tect√©e lorsqu'une √©quipe rouge l'a remarqu√©e. taux de recrutement impossibles."
      }},
      { type: "story", theme: "red-bg", content: {
        label: "Le d√©sastre Boldt", title: "Quatre-vingt-dix √©tudes de mensonges",
        text: "Joachim Boldt √©tait le chercheur le plus prolifique en anesth√©sie. Il a publi√© plus de 90 √©tudes sur les fluides collo√Ødaux. Son travail a fa√ßonn√© les lignes directrices cliniques dans le monde entier. Puis quelqu'un a remarqu√©¬†: un h√¥pital pr√©tendait recruter 800¬†patients dans des conditions qui n'affectaient que 200¬†patients par an.",
        followup: "Investigation revealed: No ethics approval existed. Patient records couldn't be found. Co-authors had never seen the data. <strong>Ninety studies</strong> were retracted‚Äîthe largest fraud in medical history. Clinical guidelines had to be rewritten. The question that would have stopped him? 'Can you show me the source documents?'"
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üî¢", title: "Sc√©nario¬†: les chiffres impossibles",
        xp: 25,
        scenario: "Lors de l'extraction, vous remarquez qu'une √©tude a recrut√© 450¬†patients atteints d'une maladie rare dans un seul h√¥pital en 18¬†mois. L'√©pid√©miologie publi√©e sugg√®re que l'h√¥pital voit environ 50 de ces patients par an.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Inclure l'√©tude ‚Äì le succ√®s du recrutement varie", correct: false },
          { letter: "B", text: "Drapeau pour v√©rification¬†: v√©rifier l'approbation √©thique et les dossiers des patients", correct: true },
          { letter: "C", text: "Exclude as a statistical outlier", correct: false },
          { letter: "D", text: "Envoyez un e-mail aux auteurs pour clarifier les m√©thodes de recrutement", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Boldt a √©t√© arr√™t√© parce que les taux de recrutement √©taient impossibles. Lorsque les chiffres n'ont pas de sens, v√©rifiez que les documents sources existent avant d'inclure l'√©tude.",
          incorrect: "C'est ainsi que Boldt a √©t√© captur√©¬†: 800¬†patients souffrant de maladies affectant 200¬†/an. Les nombres impossibles signalent une fraude potentielle. V√©rifiez l'approbation √©thique et l'existence de donn√©es brutes."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "La fraude de Wakefield", title: "12 Children, 12 Million Harmed",
        text: "En 1998, Andrew Wakefield a publi√© une √©tude portant sur 12 enfants liant le vaccin ROR √† l'autisme. Les taux de vaccination ont chut√©. Les √©pid√©mies de rougeole sont revenues. Des enfants sont morts d'une maladie √©vitable.",
        followup: "It took 12 years to prove the fraud. Wakefield had been paid ¬£435,643 by lawyers to produce evidence for lawsuits. He had manipulated data. He had undisclosed conflicts. But for a decade, his 12-patient study outweighed millions of patients in honest research. One fraudulent paper. Thousands of preventable infections."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìù", title: "Sc√©nario¬†: la provenance manquante",
        xp: 25,
        scenario: "An extractor recorded 'events: 45/230' for a study but didn't note the source (table/figure/page). When you check the PDF, you find events reported in Table 2 (45/230), Figure 1 (42/228), and text (43/225).",
        question: "Quelle est la bonne action¬†?",
        options: [
          { letter: "A", text: "Use any number‚Äîthey're close enough", correct: false },
          { letter: "B", text: "Use the most conservative estimate (42/228)", correct: false },
          { letter: "C", text: "Contactez les auteurs pour clarifier", correct: false },
          { letter: "D", text: "Apply pre-specified hierarchy (e.g., Table > Figure > Text)", correct: true }
        ],
        feedback: {
          correct: "Correct¬†! Votre protocole doit sp√©cifier une hi√©rarchie pour les nombres conflictuels. Appliquez-le de mani√®re coh√©rente et documentez la source.",
          incorrect: "Vous avez besoin d'une r√®gle pr√©d√©finie pour cette situation. ¬´¬†Le plus conservateur¬†¬ª est une r√®gle, mais elle devrait figurer dans votre protocole. Sans provenance, vous ne pouvez rien v√©rifier."
        }
      }},
      { type: "checklist", theme: "dark", content: {
        title: "DoD-C Checklist",
        items: [
          "Extraction template frozen",
          "RoB tool + decision rules written",
          "Critical fields verified by second person",
          "Overlap rules applied",
          "Arbitration process operating"
        ]
      }},
      { type: "story", theme: "red-bg", content: {
        label: "La fraude √† l'anesth√©sie Reuben", title: "The Most Prolific Faker in Medicine",
        text: "Scott Reuben was anesthesiology's rising star. Between 1996 and 2008, he published prolifically on postoperative pain management. His studies shaped how surgeons treated patients after operations. Drug companies funded his research. <strong>Pfizer paid him consulting fees</strong> while he published studies showing their drugs worked brilliantly.",
        followup: "In 2009, an anonymous tip led to investigation. Reuben hadn't just manipulated data‚Äî<strong>he had never enrolled a single patient</strong>. Studies claiming to follow hundreds of patients were pure invention. He fabricated everything: consent forms, patient records, outcomes. Twenty-one papers were retracted. Clinical guidelines based on his 'research' had to be rewritten. The patients who received treatment recommendations based on his fabrications? They were experiments in a trial that never happened, with no informed consent, following protocols invented by a liar."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üë§", title: "Sc√©nario¬†: le chercheur prolifique",
        xp: 25,
        scenario: "Vous remarquez qu'un chercheur a publi√© 15 essais dans votre domaine en 3 ans, soit plus que ce que n'importe quel d√©partement pourrait raisonnablement r√©aliser. Tous montrent des r√©sultats positifs pour les m√©dicaments fabriqu√©s par ses bailleurs de fonds. Aucun autre centre n'a reproduit ses d√©couvertes. Son √©tablissement n'a jamais audit√© ses donn√©es.",
        question: "Que devez-vous faire avant d'inclure ses √©tudes dans votre √©valuation¬†?",
        options: [
          { letter: "A", text: "Include them‚Äîthey're peer-reviewed and published", correct: false },
          { letter: "B", text: "Request verification of ethics approval and patient enrollment records", correct: true },
          { letter: "C", text: "Ex√©cuter une analyse de sensibilit√© avec et sans ses √©tudes", correct: false },
          { letter: "D", text: "Weight his studies lower due to potential bias", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Reuben a publi√© 21 essais fabriqu√©s sur 12 ans. Personne ne v√©rifiait si les patients existaient. Demandez la documentation du comit√© d'√©thique et la v√©rification de l'inscription¬†: les fabricants ne peuvent pas les produire.",
          incorrect: "Scott Reuben a invent√© 21 √©tudes avec des patients imaginaires. L'examen par les pairs ne l'a pas d√©tect√©. L'analyse de sensibilit√© ne d√©tecte pas la fabrication. V√©rifiez que les patients existaient."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "La tromperie VIGOR", title: "The Three Heart Attacks They Hid",
        text: "Merck knew Vioxx caused heart attacks. Their own trial‚ÄîVIGOR‚Äîshowed it clearly. But the published paper in the <strong>New England Journal of Medicine</strong> had a secret: Merck scientists had chosen a data cutoff date that excluded <strong>three additional heart attacks</strong> that occurred in the Vioxx group.",
        followup: "Those three heart attacks mattered. Including them would have changed the safety signal from 'possibly concerning' to 'clearly dangerous.' Instead, the published paper suggested the increased heart attacks might be because the comparison drug (naproxen) was protective‚Äînot because Vioxx was deadly. The NEJM editors only learned of the missing data years later. They published an 'expression of concern,' calling it 'inaccurate and incomplete.' By then, tens of thousands had suffered heart attacks. The data cutoff wasn't a scientific decision. It was a marketing decision disguised as methodology."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìÖ", title: "Sc√©nario¬†: le seuil strat√©gique",
        xp: 25,
        scenario: "Vous extrayez des donn√©es et remarquez que la date limite des donn√©es d'un essai √©tait de 2 semaines avant la date de fin indiqu√©e de l'√©tude. Les m√©thodes n'expliquent pas pourquoi. Les √©v√©nements survenant apr√®s la date limite ne sont pas signal√©s. Le moment co√Øncide id√©alement avec le moment o√π les signaux de s√©curit√© seraient devenus statistiquement significatifs.",
        question: "Que devez-vous documenter et demander¬†?",
        options: [
          { letter: "A", text: "Utilisez les donn√©es publi√©es¬†: les auteurs ont choisi leur seuil", correct: false },
          { letter: "B", text: "Note unexplained cutoff in Risk of Bias; request complete data from authors/FDA", correct: true },
          { letter: "C", text: "Exclure l'√©tude en raison de rapports incomplets", correct: false },
          { letter: "D", text: "Impute likely events based on trends before cutoff", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Le seuil VIGOR cachait trois crises cardiaques qui ont tout chang√©. Documentez les seuils inexpliqu√©s comme pr√©sentant un risque √©lev√© de biais et recherchez activement des donn√©es compl√®tes aupr√®s des registres ou de la FDA.",
          incorrect: "Le seuil VIGOR de Merck n'√©tait pas une m√©thodologie, mais une dissimulation. Les seuils inexpliqu√©s sont des signaux d‚Äôalarme. Documentez le risque et obtenez des donn√©es compl√®tes via les canaux officiels."
        }
      }},
      { type: "quiz", theme: "dark", content: {
        question: "What is 'provenance' in META-SPRINT?",
        options: [
          { text: "Le pays o√π une √©tude a √©t√© men√©e", correct: false },
          { text: "A citation showing where a number came from", correct: true },
          { text: "La source de financement d'un essai", correct: false },
          { text: "La date de publication d'une √©tude", correct: false }
        ],
        xp: 20,
        feedback: {
          correct: "Right! Provenance like 'Table 2, p.1234' creates an audit trail. No provenance = no trust.",
          incorrect: "Provenance means the exact source: 'Table 2, p.1234.' It's your evidence trail for every extracted number."
        }
      }},
      { type: "summary", theme: "green-bg", content: {
        summary: "You've mastered extraction fundamentals: provenance, Red-Team checking, and handling conflicting data. Next: making your analysis reproducible."
      }}
    ]
  },
  {
    id: 6, title: "Phase D: Analysis", subtitle: "Jours 29 √† 33¬†: reproductible r√©sultats", xp: 180,
    slides: [
      { type: "title", theme: "green-bg", content: { title: "Phase D: Analysis", subtitle: "Days 29-33: If you can't reproduce it, neither can anyone else" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Understand rerun equivalence tolerances",
          "Apprendre √† g√©rer les √©carts d'analyse",
          "Know how to document influential studies",
          "Ma√Ætriser le concept des capsules d'analyse"
        ],
        tip: "La reproductibilit√© n'est pas n√©gociable. Compl√©tez ceci pour obtenir le badge Stats Wizard¬†!"
      }},
      { type: "stats", theme: "dark", content: {
        title: "La crise de reproductibilit√©",
        stats: [
          { value: "70%", label: "Failed to reproduce others" },
          { value: "50%", label: "Failed to reproduce self" }
        ],
        caption: "Nature (2016): Most researchers can't reproduce published findings."
      }},
      { type: "story", theme: "red-bg", content: {
        label: "Le test d'Amgen", title: "47 of 53 Failed",
        text: "En 2012, les scientifiques d'Amgen ont tent√© de reproduire 53 √©tudes ¬´ historiques ¬ª sur le cancer, des articles qui ont fa√ßonn√© la recherche sur le cancer, lanc√© des essais cliniques et consomm√© des milliards de dollars en financement. Ils ont travaill√© directement avec les auteurs originaux. Ils ont utilis√© les m√™mes m√©thodes.",
        followup: "Result: <strong>47 of 53 studies could not be reproduced.</strong> 89% failure rate. Years of research built on foundations that didn't exist. Clinical trials started based on findings that weren't real. The cancer research community had been chasing phantoms."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üî¨", title: "Sc√©nario¬†: The Landmark Paper",
        xp: 25,
        scenario: "Une √©tude pr√©clinique ¬´ historique ¬ª r√©alis√©e par une revue de premier plan constitue la base d'un nouveau traitement. Trois tentatives de r√©plication par des laboratoires ind√©pendants ont √©chou√©. Les auteurs originaux affirment que les r√©plicateurs ¬´ manquaient d‚Äôexpertise technique ¬ª. Personne n'a vu les donn√©es brutes originales.",
        question: "Comment les lignes directrices devraient-elles traiter ces preuves¬†?",
        options: [
          { letter: "A", text: "Trust the original‚Äîit's in a top journal", correct: false },
          { letter: "B", text: "Downgrade certainty until reproducibility is demonstrated", correct: true },
          { letter: "C", text: "Weight original and replications equally", correct: false },
          { letter: "D", text: "Wait for a fourth replication attempt", correct: false }
        ],
        feedback: {
          correct: "Correct! The Amgen lesson: 89% of landmark cancer studies couldn't be reproduced. If it can't be replicated, it's not evidence‚Äîit's a hypothesis.",
          incorrect: "47 des 53 √©tudes marquantes n'ont pas r√©ussi √† se reproduire. Le prestige d‚Äôun journal n‚Äôest pas synonyme de v√©rit√©. Les r√©sultats non reproductibles ne devraient jamais constituer la base des directives de traitement."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "Le scandale Duke", title: "Le g√©nie qui n'a jamais exist√©",
        text: "Anil Potti de l'Universit√© Duke a d√©velopp√© un test g√©nomique pour personnaliser le traitement du cancer. Ses articles ont √©t√© publi√©s dans des revues de premier plan. Les essais cliniques ont recrut√© des patients. Il a √©t√© c√©l√©br√© comme un visionnaire.",
        followup: "Then two statisticians noticed: the data was impossible. Gene signatures were backwards. Spreadsheets had been manipulated. Potti had invented his credentials. Over 100 cancer patients had been enrolled in trials based on fraudulent science. Some received treatments that harmed them based on data that never existed."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üîÑ", title: "Sc√©nario¬†:¬†l'inad√©quation de la r√©ex√©cution",
        xp: 30,
        scenario: "Audit 2: Two analysts independently rerun the analysis. Analyst A: I¬≤=34.2%. Analyst B: I¬≤=31.8%. The tolerance is 1%. Difference: 2.4%.",
        question: "What should happen?",
        options: [
          { letter: "A", text: "Faites la moyenne des r√©sultats¬†: les deux sont raisonnables", correct: false },
          { letter: "B", text: "Use the more conservative estimate", correct: false },
          { letter: "C", text: "Line-by-line comparison to find the discrepancy", correct: true },
          { letter: "D", text: "Trigger CondGO (emergency mode)", correct: false }
        ],
        feedback: {
          correct: "Correct! Line-by-line comparison found one SE rounded to 2 decimals instead of 4. Fix the source, rerun, verify match.",
          incorrect: "Ne faites pas de moyenne et n'acceptez pas d'inad√©quation. Trouvez la source de la divergence. Dans ce cas¬†: un SE a √©t√© mal arrondi."
        }
      }},
      { type: "concept", theme: "dark", content: {
        title: "Rerun Equivalence Tolerances",
        subtitle: "Two runs must match exactly",
        checkpoints: [
          { day: "Study count", event: "Exactly identical" },
          { day: "Effect sizes", event: "‚â§0.001 (log scale)" },
          { day: "Pooled effect", event: "‚â§0.001" },
          { day: "I¬≤ heterogeneity", event: "Within 1%" }
        ]
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìà", title: "Sc√©nario¬†: L'√©tude influente",
        xp: 25,
        scenario: "L'analyse sans exception montre que la suppression de l'essai COLCOT modifie le RR group√© de 0,65 (significatif) √† 0,78 (toujours significatif). COLCOT contribue √† hauteur de 40 % du poids.",
        question: "Que devez-vous documenter¬†?",
        options: [
          { letter: "A", text: "Nothing‚Äîresult is still significant", correct: false },
          { letter: "B", text: "Document that COLCOT is influential but robust", correct: true },
          { letter: "C", text: "Exclude COLCOT as an outlier", correct: false },
          { letter: "D", text: "Downgrade certainty to VERY LOW", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Documentez les √©tudes influentes et notez que les conclusions sont solides. N'excluez pas les bonnes donn√©es simplement parce qu'elles sont influentes.",
          incorrect: "Vous devez documenter les √©tudes influentes. Ici, la suppression de COLCOT change l‚Äôampleur mais pas la direction ‚Äì c‚Äôest une conclusion solide. N'excluez pas les bonnes donn√©es."
        }
      }},
      { type: "checklist", theme: "dark", content: {
        title: "DoD-D Checklist",
        items: [
          "Capsule runs end-to-end",
          "Forest + heterogeneity outputs",
          "Sensitivity set executed",
          "√âtudes influentes document√©es",
          "Audit 2 completed",
          "Rerun equivalence satisfied"
        ]
      }},
      { type: "story", theme: "red-bg", content: {
        label: "La dissimulation du BMP-2", title: "Paid Authors, Hidden Harms",
        text: "Medtronic a pay√© 210 millions de dollars aux chirurgiens qui ont r√©dig√© des articles sur leur produit pour la croissance osseuse, le BMP-2. Tous les articles publi√©s ont d√©clar√© que c'√©tait s√ªr et efficace. Chaque article a √©t√© r√©dig√© par des auteurs ayant des liens financiers non divulgu√©s. Aucun n'a signal√© les √©v√©nements ind√©sirables dont Medtronic √©tait au courant.",
        followup: "When independent researchers obtained FDA adverse event reports, they found: <strong>10-50x higher complication rates</strong> than published papers claimed. Cancers. Sterility. Chronic pain. The published literature was a marketing document. The real evidence was in FDA files no one had read."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üí∞", title: "Sc√©nario¬†: les honoraires de consultation",
        xp: 25,
        scenario: "You're extracting data from 15 studies on a medical device. You notice all 15 lead authors have received consulting fees from the manufacturer. The amounts range from $50,000 to $500,000 per author. All 15 studies show benefit; no harms are reported.",
        question: "Que devez-vous documenter dans votre examen¬†?",
        options: [
          { letter: "A", text: "Nothing‚Äîdisclosed conflicts aren't bias", correct: false },
          { letter: "B", text: "Document conflicts and check FDA adverse event database", correct: true },
          { letter: "C", text: "Exclude all studies due to conflict of interest", correct: false },
          { letter: "D", text: "Run sensitivity analysis by funding source", correct: false }
        ],
        feedback: {
          correct: "Correct! BMP-2 lesson: all published papers hid harms that FDA reports revealed. Always cross-check industry-funded device/drug studies against regulatory databases.",
          incorrect: "The BMP-2 cover-up: $210M paid to authors who reported no harms; FDA data showed 10-50x higher complication rates. Industry conflicts require regulatory cross-checking."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "Le d√©sastre de la hanche m√©tal sur m√©tal", title: "Les articulations qui ont empoisonn√© les patients",
        text: "In the 2000s, device manufacturers promised a revolution: metal-on-metal hip implants that would last forever. DePuy's ASR hip was the flagship. <strong>93,000 patients</strong> worldwide received them. The company cited laboratory testing showing excellent wear characteristics. Surgeons believed the marketing.",
        followup: "Inside patients' bodies, reality was different. The metal surfaces ground against each other, releasing cobalt and chromium ions into tissues. Patients developed <strong>metallosis</strong>‚Äîmetal poisoning causing tissue death, bone destruction, and chronic pain. Some developed neurological symptoms as cobalt reached their brains. The failure rate reached <strong>40% at 5 years</strong>‚Äîcatastrophic for a device meant to last decades. DePuy had internal data showing problems but kept selling. When the hip was finally recalled in 2010, Johnson & Johnson paid $2.5 billion in settlements. The laboratory tests that 'proved' safety had never predicted what happens inside a living, moving human body."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "ü¶¥", title: "Sc√©nario¬†: preuves en laboratoire",
        xp: 25,
        scenario: "Un nouvel implant chirurgical montre d'excellents r√©sultats lors de tests d'usure en laboratoire et d'√©tudes sur des animaux. Le fabricant souhaite √©viter les essais humains √† grande √©chelle et commercialiser directement son produit avec une surveillance post-commercialisation. \"Les tests sur banc prouvent que cela fonctionne\", affirment-ils.",
        question: "Quel est le d√©faut critique de ce raisonnement¬†?",
        options: [
          { letter: "A", text: "Animal studies should be longer before human use", correct: false },
          { letter: "B", text: "Laboratory conditions cannot replicate the biological environment inside patients", correct: true },
          { letter: "C", text: "Post-marketing surveillance is sufficient for rare harms", correct: false },
          { letter: "D", text: "Les tests sur banc ne sont valables que pour les m√©dicaments, pas pour les appareils", correct: false }
        ],
        feedback: {
          correct: "C'est exact¬†! Les hanches m√©tal sur m√©tal ont r√©ussi tous les tests de laboratoire, puis ont empoisonn√© les patients avec des ions m√©talliques qu'aucun simulateur n'avait pr√©dit. Le corps n'est pas un laboratoire. Les essais sur des humains en conditions r√©elles sont irrempla√ßables.",
          incorrect: "Les tests en laboratoire de DePuy ont montr√© que la hanche durerait √©ternellement. Chez les patients, il d√©truisait les tissus et lib√©rait des ions m√©talliques. Conditions de laboratoire ‚â† r√©alit√© biologique. Des essais humains √† grande √©chelle avec un long suivi sont essentiels."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "Le d√©sastre d'Essure", title: "La contraception permanente qui a d√©truit des vies",
        text: "Bayer's Essure promised women permanent contraception without surgery‚Äîtiny metal coils inserted through the cervix that would block the fallopian tubes. The <strong>FDA approved it based on 2 years of data from 518 women</strong>. What could go wrong with a simple, non-surgical procedure?",
        followup: "Thousands of women reported devices migrating through their bodies, perforating organs, causing chronic pain, autoimmune reactions, and‚Äîdevastatingly‚Äî<strong>unintended pregnancies, including ectopic pregnancies that can be fatal</strong>. Women needed hysterectomies to remove devices they'd been told were 'permanent solutions.' A Facebook group for Essure victims grew to over 30,000 members. The FDA eventually added a black box warning, then restricted sales. Bayer stopped selling it in 2018. The lesson: 2 years of follow-up in 518 women was never enough to detect rare complications from a permanent implant. Approval timelines should match device permanence."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "‚ö†Ô∏è", title: "Sc√©nario¬†: le dispositif permanent",
        xp: 25,
        scenario: "Un dispositif implantable permanent demande l'approbation de la FDA sur la base de 3 ans suivi chez 600 patients. Le dispositif est destin√© √† rester chez les patients √† vie. Aucun √©v√©nement ind√©sirable grave n‚Äôa encore √©t√© signal√©. L'entreprise affirme que cela prouve la s√©curit√© √† long terme.",
        question: "What should regulators require before approval?",
        options: [
          { letter: "A", text: "Post-marketing surveillance with mandatory reporting", correct: false },
          { letter: "B", text: "Follow-up duration proportional to intended implant life; registry with long-term tracking", correct: true },
          { letter: "C", text: "Approval is appropriate‚Äî3 years is standard for devices", correct: false },
          { letter: "D", text: "Additional laboratory durability testing", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Essure a √©t√© approuv√© sur la base de donn√©es sur 2 ans pour un dispositif permanent. Des complications sont apparues au fil des ann√©es. Les implants permanents n√©cessitent un suivi proportionnel √† leur permanence et des registres obligatoires √† long terme.",
          incorrect: "Les donn√©es d'Essure sur 2 ans ont manqu√© des complications qui ont d√©truit la sant√© des femmes. Un dispositif permanent n√©cessite un suivi proportionnellement long. La surveillance post-commercialisation d√©tecte les probl√®mes trop tard."
        }
      }},
      { type: "quiz", theme: "dark", content: {
        question: "Qu'est-ce qu'une ¬´ capsule d'analyse ¬ª¬†?",
        options: [
          { text: "A summary of key findings", correct: false },
          { text: "Code + donn√©es + instructions que tout le monde peut ex√©cuter", correct: true },
          { text: "La sortie de la parcelle foresti√®re", correct: false },
          { text: "A donn√©es compress√©es fichier", correct: false }
        ],
        xp: 20,
        feedback: {
          correct: "Exactement¬†! Une capsule est tout ce dont vous avez besoin pour reproduire votre analyse. Code, donn√©es, environnement¬†: le tout versionn√©.",
          incorrect: "A capsule is a complete reproducible package: code, data, instructions. Anyone can run it and get identical results."
        }
      }}
    ]
  },
  {
    id: 7, title: "Phase E & CondGO", subtitle: "Days 34-40: Ship or emergency", xp: 180,
    slides: [
      { type: "title", theme: "red-bg", content: { title: "Phase E: Submission", subtitle: "Jours 34 √† 40¬†: Le FREEZE et CondGO" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Comprendre le FREEZE et pourquoi il est essentiel",
          "Learn when CondGO is triggered",
          "Know the three CondGO exit options",
          "Master the DoD-E final checklist"
        ],
        tip: "Le protocole d'urgence qui emp√™che ¬´¬†nous nous en occuperons plus tard¬†¬ª catastrophes."
      }},
      { type: "concept", theme: "dark", content: {
        title: "Le FREEZE (jour 34)",
        subtitle: "Aucune nouvelle √©tude apr√®s ce point",
        text: "Scope is locked. Only corrections to existing data allowed.",
        highlight: "Le scandale BMP¬†: l'industrie a continu√© √† ¬´¬†trouver¬†¬ª de nouvelles √©tudes qui favorisaient son produit. Le gel emp√™che la d√©rive de la port√©e des armes."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìö", title: "Scenario: New Study After Freeze",
        xp: 25,
        scenario: "Nous sommes le jour 36. Un coll√®gue vous envoie un ECR r√©cemment publi√© qui correspond parfaitement √† vos crit√®res. Il s'agit d'un essai de grande envergure et de haute qualit√©.",
        question: "What do you do?",
        options: [
          { letter: "A", text: "Add it‚Äîquality evidence shouldn't be excluded", correct: false },
          { letter: "B", text: "Note it as a limitation, don't add", correct: true },
          { letter: "C", text: "Add it but run sensitivity with/without", correct: false },
          { letter: "D", text: "Request deadline extension to include it", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Apr√®s le gel, notez les nouvelles √©tudes comme limites. Leur ajout ouvre la porte √† une inclusion s√©lective.",
          incorrect: "Geler signifie geler. Ajouter ¬´ juste cette seule bonne √©tude ¬ª est exactement la fa√ßon dont la d√©rive de la port√©e corrompt les avis. √Ä noter comme limitation."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "La chronologie d'Avandia", title: "Seven Years of Silence",
        text: "GSK a d√©tect√© des signaux cardiovasculaires en 2000. Ils ont choisi de ¬´¬†regarder et d'attendre¬†¬ª sans date limite. Sept ans plus tard, la m√©ta-analyse de Nissen a r√©v√©l√© les m√©faits.",
        followup: "CondGO exists because 'we'll deal with it eventually' kills people."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "‚è∞", title: "Sc√©nario¬†: The Indefinite Review",
        xp: 25,
        scenario: "Votre revue syst√©matique a r√©v√©l√© un signal de s√©curit√© potentiel¬†: le m√©dicament X pr√©sente une augmentation de 28¬†% des √©v√©nements cardiaques par rapport au placebo. Votre superviseur sugg√®re de ¬´ conserver les r√©sultats en interne jusqu'√† ce que nous collections plus de donn√©es ¬ª sans calendrier pr√©cis.",
        question: "Sur quoi devriez-vous insister¬†?",
        options: [
          { letter: "A", text: "Agree‚Äîpremature publication could cause panic", correct: false },
          { letter: "B", text: "Set a fixed deadline: publish or escalate within 30 days", correct: true },
          { letter: "C", text: "Partagez d'abord avec le fabricant du m√©dicament pour obtenir sa contribution", correct: false },
          { letter: "D", text: "Run additional analyses to confirm the signal", correct: false }
        ],
        feedback: {
          correct: "Correct! The Avandia lesson: 'watch and wait with no deadline' killed 83,000 people. CondGO principle: safety signals need hard deadlines, not open-ended deliberation.",
          incorrect: "GSK 'watched and waited' on Avandia for seven years. 83,000 heart attacks later, we learned: indefinite timelines kill. Set hard deadlines for safety decisions."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "L'histoire compl√®te d'Avandia", title: "La feuille de calcul qu'ils Enterr√©",
        text: "En 1999, la propre analyse de GlaxoSmithKline a montr√© qu'Avandia augmentait les crises cardiaques de 31¬†%. Un statisticien d'entreprise a cr√©√© une feuille de calcul. Les dirigeants l‚Äôont vu. Ils ont calcul√© la responsabilit√©. Ils ont continu√© √† vendre.",
        followup: "For seven years, Avandia remained a blockbuster drug. $3 billion per year in sales. The spreadsheet stayed hidden. When Steven Nissen published his meta-analysis in 2007, the world learned what GSK had known since 1999: Avandia caused an estimated <strong>83,000 heart attacks</strong>. The delay wasn't oversight‚Äîit was a decision."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìà", title: "Sc√©nario¬†: La d√©cision commerciale",
        xp: 25,
        scenario: "Votre analyse montre qu'un m√©dicament augmente les √©v√©nements ind√©sirables de 25¬†%. Le m√©dicament g√©n√®re 2 milliards de dollars de revenus annuels. Le service juridique estime que d‚Äô√©ventuelles poursuites pourraient co√ªter 500 millions de dollars. Un cadre sup√©rieur sugg√®re que ¬´¬†les math√©matiques favorisent la poursuite des ventes¬†¬ª.",
        question: "Quelle est la r√©ponse √©thique¬†?",
        options: [
          { letter: "A", text: "Il s'agit d'une d√©cision commerciale, et non scientifique", correct: false },
          { letter: "B", text: "Report the finding to regulators immediately", correct: true },
          { letter: "C", text: "Seek independent confirmation before acting", correct: false },
          { letter: "D", text: "Ajoutez des avertissements sur l'√©tiquette et poursuivez les ventes", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Le tableur Avandia a r√©v√©l√© des dommages en 1999. GSK a fait le ¬´ calcul ¬ª et a continu√© √† vendre. La r√©ponse √©thique n'est jamais une question de revenus, mais plut√¥t de s√©curit√© des patients.",
          incorrect: "GSK calculated liability vs. revenue and chose sales. 83,000 heart attacks later: the 'business decision' was mass harm. Safety findings require immediate regulatory disclosure."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "La le√ßon sur la thalidomide", title: "10,000 Children",
        text: "En 1957, une entreprise allemande a commercialis√© la thalidomide comme somnif√®re sans danger pour les femmes enceintes. ¬´ Aucune preuve de pr√©judice ¬ª, ont-ils d√©clar√©. Ils n'avaient pas cherch√© le mal. Ils n'avaient pas exig√© de preuves. Ils l'avaient suppos√©.",
        followup: "Within four years: 10,000 children born with severe limb deformities. Many more died before birth. One woman, Frances Kelsey at the FDA, had demanded proper evidence before approving it in America. She was called 'bureaucratic.' Her skepticism saved thousands of American children. Evidence isn't bureaucracy. Evidence is protection."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üö®", title: "Scenario: CondGO Trigger",
        xp: 30,
        scenario: "Day 33. DoD-D fails: Audit 2 found that reruns don't match within tolerance, and you can't identify the source of discrepancy after 4 hours.",
        question: "What happens now?",
        options: [
          { letter: "A", text: "Prolonger le d√©lai d'une semaine", correct: false },
          { letter: "B", text: "Trigger CondGO: 72 hours to fix or decide", correct: true },
          { letter: "C", text: "Soumettre quand m√™me avec une note de divergence", correct: false },
          { letter: "D", text: "Abandonner le projet", correct: false }
        ],
        feedback: {
          correct: "Correct! CondGO gives exactly 72 hours to fix using allowed actions, or make a termination decision.",
          incorrect: "CondGO is triggered. 72 hours, bounded actions only. No extensions. Fix it or face the decision to stop."
        }
      }},
      { type: "concept", theme: "dark", content: {
        title: "CondGO Rules",
        subtitle: "72 hours, bounded actions",
        allowed: ["Correct extraction errors", "Fix conversions", "Resolve overlaps", "Repair audit pack"],
        forbidden: ["New outcomes", "Post-hoc subgroups", "Nouvelles √©tudes apr√®s gel"]
      }},
      { type: "checklist", theme: "dark", content: {
        title: "DoD-E Checklist",
        items: [
          "PRISMA liste de contr√¥le termin√©e",
          "Toutes les annexes termin√©es",
          "Two reruns equivalent",
          "Clinical Summary included",
          "Journal des √©carts termin√©",
          "GRADE assessment done",
          "Audit-Grade Index: 9/9"
        ]
      }},
      { type: "quiz", theme: "dark", content: {
        question: "Quelles sont les options de sortie CondGO¬†?",
        options: [
          { text: "Continue, Pause, or Restart", correct: false },
          { text: "Pass, Submit minimal, or Terminate", correct: true },
          { text: "Extend 24h, 48h, or 72h", correct: false },
          { text: "Il n'y a pas de sortie, vous devez le r√©parer", correct: false }
        ],
        xp: 20,
        feedback: {
          correct: "Right! PASS (fixed), Submit minimal version, or Terminate with Failure Log. No middle ground.",
          incorrect: "CondGO has exactly three exits: fix it (PASS), submit minimal version, or terminate and archive with Failure Log."
        }
      }}
    ]
  },
  {
    id: 8, title: "Cas¬†: Revue Colchicine", subtitle: "4 crises, 0 failures", xp: 250,
    slides: [
      { type: "title", theme: "purple-bg", content: { title: "La Revue Colchicine", subtitle: "Un sprint de 40 jours avec 4 crises et 0 √©chec" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "See META-SPRINT in action through a real case",
          "Learn how each crisis was resolved",
          "Understand why the system worked",
          "Apply lessons to your own reviews"
        ],
        tip: "Cette √©tude de cas relie tout. Gagnez le badge Colchicine Hero¬†!"
      }},
      { type: "stats", theme: "dark", content: {
        title: "The Question",
        subtitle: "Does colchicine reduce cardiac events after heart attack?",
        stats: [
          { value: "8", label: "RCTs" },
          { value: "11,774", label: "Patients" },
          { value: "40", label: "Days" },
          { value: "4", label: "Crises" }
        ]
      }},
      { type: "decision", theme: "dark", content: {
        icon: "1Ô∏è‚É£", title: "Crise 1¬†: Le dilemme du point temporel",
        xp: 25,
        scenario: "Day 2. Trials report MACE at 30 days, 90 days, 1 year, 3 years. Protocol says 'longest follow-up' but reviewers disagree on interpretation.",
        question: "Comment r√©soudriez-vous cela¬†?",
        options: [
          { letter: "A", text: "Vote on which interpretation to use", correct: false },
          { letter: "B", text: "Pr√©parez un pack de consultation avec des options et des compromis", correct: true },
          { letter: "C", text: "Let the Integrator decide alone", correct: false },
          { letter: "D", text: "Use both interpretations as sensitivity", correct: false }
        ],
        feedback: {
          correct: "Correct! The Consult Pack forces structured thinking. They chose: 'Longest ‚â•1 year, else longest available.'",
          incorrect: "Un pack de consultation a √©t√© pr√©par√© avec des preuves et des options. 15 minutes de discussion structur√©e ont emp√™ch√© des heures de retravail."
        }
      }},
      { type: "decision", theme: "red-bg", content: {
        icon: "2Ô∏è‚É£", title: "Crise 2¬†: les bras √©chang√©s",
        xp: 30,
        scenario: "Day 14. Red-team pulls COLCOT (n=4,745). Forest plot shows colchicine INCREASES events‚Äîopposite of all other trials. Investigation reveals: Figure 3 bars were unlabeled, extractor assumed wrong direction.",
        question: "Qu'est-ce qui a sauv√© cette r√©vision¬†?",
        options: [
          { letter: "A", text: "L'intuition de l'int√©grateur", correct: false },
          { letter: "B", text: "Le quotidien de l'√©quipe rouge micro-v√©rification", correct: true },
          { letter: "C", text: "Revue par les pairs avant publication", correct: false },
          { letter: "D", text: "Statistical outlier detection", correct: false }
        ],
        feedback: {
          correct: "Exactement¬†! Le syst√®me Red-Team a d√©tect√© ce que l'examen collaboratif aurait manqu√©. Les √©tudes influentes font l'objet d'une v√©rification contradictoire.",
          incorrect: "La v√©rification quotidienne de l'√©quipe rouge l'a d√©tect√©. Fatima a remarqu√© que la direction de COLCOT √©tait oppos√©e ‚Äì impossible si le m√©dicament agissait r√©ellement diff√©remment dans un essai."
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "3Ô∏è‚É£", title: "Crise 3¬†: l'id√©e post-hoc",
        xp: 25,
        scenario: "Day 22. Clinical advisor suggests: 'Three trials used 0.5mg, five used 1mg. Shouldn't you analyze by dose?' He's probably right scientifically.",
        question: "Quelle est la bonne r√©ponse¬†?",
        options: [
          { letter: "A", text: "Change primary analysis to split by dose", correct: false },
          { letter: "B", text: "Ignore the suggestion‚Äîtoo late to change", correct: false },
          { letter: "C", text: "Add as exploratory sensitivity, label post-hoc", correct: true },
          { letter: "D", text: "Retournez en arri√®re et ajoutez une dose au protocole", correct: false }
        ],
        feedback: {
          correct: "Perfect! Good ideas after Day 3 go in sensitivity, clearly labelled post-hoc. Primary analysis stays protected.",
          incorrect: "Le protocole vous prot√®ge de vous-m√™me. Ajoutez-la comme analyse de SENSIBILIT√â, √©tiquetez-la ¬´¬†exploratoire, post-hoc¬†¬ª."
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "4Ô∏è‚É£", title: "Crise 4¬†:¬†l'inad√©quation de la r√©ex√©cution",
        xp: 25,
        scenario: "Day 31. Audit 2 reruns: Analyst A gets I¬≤=34.2%, Analyst B gets I¬≤=31.8%. Tolerance is 1%. Difference: 2.4%.",
        question: "Quelle √©tait la cause profonde¬†?",
        options: [
          { letter: "A", text: "Different software versions", correct: false },
          { letter: "B", text: "One SE rounded to 2 decimals instead of 4", correct: true },
          { letter: "C", text: "Different random seeds", correct: false },
          { letter: "D", text: "Fyme de frappe dans l'inclusion de l'√©tude", correct: false }
        ],
        feedback: {
          correct: "Right! Line-by-line found Nidorf 2020 SE: 0.0847 vs 0.08. A 0.0047 difference created 2.4% I¬≤ change.",
          incorrect: "Line-by-line comparison found one SE was rounded to 2 decimals (0.08) instead of 4 (0.0847). 'Close enough' isn't."
        }
      }},
      { type: "stats", theme: "green-bg", content: {
        title: "The Result",
        stats: [
          { value: "RR 0.65", label: "95% CI: 0.49‚Äì0.88" },
          { value: "I¬≤ 34%", label: "Low-moderate" },
          { value: "9/9", label: "Audit-Grade" }
        ],
        caption: "Colchicine reduces major cardiac events by ~35%. The system caught all 4 crises."
      }},
      { type: "lesson", theme: "dark", content: {
        title: "Pourquoi le syst√®me A fonctionn√©",
        lessons: [
          { title: "Crisis 1 ‚Üí Consult Pack", desc: "Structured discussion prevented rework" },
          { title: "Crisis 2 ‚Üí Red-Team", desc: "Adversarial checking caught the swap" },
          { title: "Crisis 3 ‚Üí Deviation Log", desc: "Good ideas captured safely" },
          { title: "Crisis 4 ‚Üí Rerun Tolerance", desc: "Precision requirements caught silent errors" }
        ]
      }},
      { type: "story", theme: "dark", content: {
        label: "L'essai VIGOR", title: "Les crises cardiaques manquantes",
        text: "In 2000, Merck published the VIGOR trial for Vioxx. The paper showed a 4-fold increase in heart attacks compared to naproxen. But here's what they didn't tell you: three more heart attacks occurred <strong>after the data cutoff</strong>. Merck scientists knew about them. They didn't include them.",
        followup: "Why did it matter? Including those three heart attacks would have changed the risk ratio from concerning to alarming. Instead, the published paper suggested the difference might be because naproxen protected hearts‚Äînot because Vioxx damaged them. The data cutoff date was a decision. That decision cost lives."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "‚úÇÔ∏è", title: "Sc√©nario¬†:¬†le seuil pratique",
        xp: 25,
        scenario: "Vous extrayez les donn√©es d'un essai. Le protocole pr√©cisait un suivi jusqu'√† 12 mois. L'article publi√© rapporte uniquement des donn√©es sur 6 mois. Une note de bas de page indique que ¬´ des √©v√©nements suppl√©mentaires se sont produits apr√®s 6 mois mais n'ont pas √©t√© inclus dans l'analyse principale ¬ª.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Utilisez les donn√©es sur 6 mois telles que publi√©es", correct: false },
          { letter: "B", text: "Contactez les auteurs pour obtenir des donn√©es de suivi compl√®tes", correct: true },
          { letter: "C", text: "Exclure l'√©tude en raison de rapports s√©lectifs", correct: false },
          { letter: "D", text: "Notez le divergence dans votre √©valuation du risque de biais", correct: false }
        ],
        feedback: {
          correct: "Correct! The VIGOR lesson: data cutoffs can hide safety signals. Three missing heart attacks changed Vioxx from 'concerning' to 'alarming.' Always seek complete data.",
          incorrect: "L'essai VIGOR a exclu les crises cardiaques post-coupure qui auraient modifi√© les conclusions. Des coupures pratiques peuvent masquer les signaux de s√©curit√© critiques. Obtenez des donn√©es compl√®tes."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "La trag√©die du test hormonal", title: "Primodos et les enfants qu'il a endommag√©s",
        text: "In the 1960s and 70s, doctors prescribed <strong>Primodos</strong>‚Äîa high-dose hormone pill‚Äîas a pregnancy test. Take two pills; if you bleed, you're not pregnant. Simple. Convenient. Millions of women used it. <strong>No one ran trials to check if it harmed unborn babies.</strong>",
        followup: "Then the birth defects appeared. Cleft palates. Heart malformations. Limb abnormalities. Women who had taken Primodos and were actually pregnant‚Äîthe test had failed‚Äîgave birth to damaged children. Decades later, researchers analyzed the data: exposure to Primodos was associated with a <strong>40% increase in congenital abnormalities</strong>. The manufacturer had received reports of problems for years. They kept selling. An official UK review in 2017 found 'clear evidence' of an association. The lesson: 'it seems to work' is not evidence. 'It seems safe' is not safety data. Pregnancy exposures demand the highest burden of proof."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üß™", title: "Sc√©nario¬†: le test pratique",
        xp: 25,
        scenario: "Un nouveau test de grossesse √† domicile utilise un nouveau produit chimique qui fournit des r√©sultats en quelques secondes plut√¥t qu'en quelques minutes. Il a √©t√© utilis√© par des millions de personnes sans aucun pr√©judice grave apparent. Cependant, certaines femmes effectuent des tests suffisamment t√¥t pour que le produit chimique puisse affecter le d√©veloppement des embryons chez celles qui sont r√©ellement enceintes.",
        question: "What evidence should exist before widespread marketing?",
        options: [
          { letter: "A", text: "Absence of reported harms is sufficient for a diagnostic test", correct: false },
          { letter: "B", text: "Long-term follow-up of pregnancy outcomes in exposed women vs. controls", correct: true },
          { letter: "C", text: "Les √©tudes de t√©ratologie animale sont suffisantes pour de courtes expositions", correct: false },
          { letter: "D", text: "Post-marketing surveillance will detect any problems", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Les dommages caus√©s par Primodos n'ont pas √©t√© d√©tect√©s pendant des d√©cennies parce que personne n'a suivi les issues de grossesse. Toute exposition au cours d'une grossesse potentielle n√©cessite un suivi syst√©matique des r√©sultats, et non une surveillance passive.",
          incorrect: "Primodos a fait du mal aux b√©b√©s pendant des ann√©es alors que ¬´ personne ne le remarquait ¬ª. Les expositions pendant la grossesse n√©cessitent un suivi proactif des r√©sultats. La surveillance post-commercialisation √©choue pour les malformations cong√©nitales¬†; le lien est difficile √† prouver plus tard."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "La catastrophe de Baycol", title: "La statine qui a dissous les muscles",
        text: "In 1997, Bayer launched cerivastatin (Baycol) to compete in the lucrative statin market. It was the most potent statin ever‚Äîlowering cholesterol more effectively than competitors. Bayer pushed aggressive dosing. They promoted combining it with gemfibrozil for even greater cholesterol reduction. Sales reached $500 million annually.",
        followup: "Patients started dying. Their muscles were dissolving‚Äîa condition called <strong>rhabdomyolysis</strong>. Breakdown products overwhelmed kidneys. By the time Bayer withdrew Baycol in 2001, at least <strong>100 patients had died and over 1,500 were hospitalized</strong>. Internal documents revealed Bayer knew the risk was higher than competitors. They knew the gemfibrozil combination was especially dangerous. They kept promoting both. The 'most effective' statin became the deadliest. More aggressive isn't always better‚Äîsometimes it's fatal."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìà", title: "Sc√©nario¬†: l'approche agressive",
        xp: 25,
        scenario: "Un nouveau m√©dicament montre des effets plus puissants que les traitements existants √† des doses plus √©lev√©es. Le fabricant souhaite commercialiser en standard la dose efficace la plus √©lev√©e. Les concurrents utilisent des doses plus faibles avec de bons profils de s√©curit√©. Certains premiers rapports mentionnent des √©v√©nements ind√©sirables graves li√©s aux muscles.",
        question: "What should guide dosing recommendations?",
        options: [
          { letter: "A", text: "Maximum efficacy should be the goal‚Äîthat's why patients take medication", correct: false },
          { letter: "B", text: "Lowest effective dose with systematic safety monitoring; investigate all serious events", correct: true },
          { letter: "C", text: "Match competitor dosing for market positioning", correct: false },
          { letter: "D", text: "Let prescribers choose based on patient cholesterol levels", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Le dosage agressif de Baycol a tu√© des patients. Les √©v√©nements musculaires √©taient des signaux d‚Äôalarme. La dose efficace la plus s√ªre ‚Äì et non la plus puissante ‚Äì devrait √™tre la norme. Les premiers √©v√©nements graves n√©cessitent une enqu√™te, pas un licenciement.",
          incorrect: "Baycol √©tait la statine ¬´ la plus puissante ¬ª et la plus mortelle. Plus n‚Äôest pas mieux lorsque la marge entre efficacit√© et toxicit√© se r√©tr√©cit. Les √©v√©nements ind√©sirables graves pr√©coces sont des signaux, pas du bruit."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "Les quasi-accidents", title: "What If We Hadn't Checked?",
        text: "In the colchicine review, COLCOT contributed 40% of the total weight. If the swapped arms had gone undetected, the meta-analysis would have concluded: <strong>'Colchicine appears to INCREASE cardiac events.'</strong> The opposite of reality.",
        followup: "Les m√©decins ont peut-√™tre refus√© un traitement efficace. Les patients qui auraient pu √™tre aid√©s auraient √©t√© refus√©s. Une erreur d‚Äôextraction, non d√©tect√©e, aurait pu bouleverser la pratique clinique. Le contr√¥le de l'√©quipe rouge a dur√© 15 minutes. Le co√ªt de le manquer ? Incalculable."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "‚öñÔ∏è", title: "Sc√©nario¬†: La question des 15 minutes",
        xp: 25,
        scenario: "Votre √©quipe est en retard. Le plus grand essai (45¬†% du poids total) n'a pas √©t√© v√©rifi√© par Red-Team. Quelqu'un sugg√®re de l'ignorer ¬´¬†car l'extraction a √©t√© effectu√©e par notre personne la plus exp√©riment√©e¬†¬ª.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Skip it‚Äîexperience reduces error rates", correct: false },
          { letter: "B", text: "Verify it‚Äîinfluential studies always get checked", correct: true },
          { letter: "C", text: "Spot-check one data point instead of full verification", correct: false },
          { letter: "D", text: "Trust but add a note about limited verification time", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Le quasi-accident de la colchicine¬†: 15 minutes de v√©rification par l'√©quipe rouge ont d√©tect√© une erreur qui aurait renvers√© les conclusions. L'exp√©rience n'√©limine pas les erreurs, mais la v√©rification le fait.",
          incorrect: "L'erreur COLCOT a √©t√© commise par un extracteur exp√©riment√©. Le contr√¥le de l'√©quipe rouge a dur√© 15 minutes. Ignorer la v√©rification des √©tudes influentes risque d'entra√Æner des erreurs catastrophiques."
        }
      }}
    ]
  },
  {
    id: 9, title: "Final Assessment", subtitle: "Prouvez votre ma√Ætrise", xp: 300,
    slides: [
      { type: "title", theme: "dark", content: { title: "Final Assessment", subtitle: "Apply everything you've learned" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Apply META-SPRINT principles to complex scenarios",
          "Demonstrate understanding of protocol integrity",
          "Handle crisis situations correctly",
          "Uphold ethical reporting standards"
        ],
        tip: "Trois sc√©narios difficiles. R√©pondez correctement √† toutes les questions pour obtenir le bonus de module parfait¬†!"
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üéØ", title: "Final Scenario 1: The Protocol Pressure",
        xp: 40,
        scenario: "Votre superviseur souhaite commencer la s√©lection demain. Le protocole est r√©dig√© mais pas encore enregistr√© sur PROSPERO (prend 24-48h). ¬´¬†Commencez¬†: nous pourrons vous inscrire plus tard.¬†¬ª",
        question: "What do you do?",
        options: [
          { letter: "A", text: "Start screening‚Äîregistration is just paperwork", correct: false },
          { letter: "B", text: "Attendez l'inscription avant toute collecte de donn√©es.", correct: true },
          { letter: "C", text: "Start screening but don't record results yet", correct: false },
          { letter: "D", text: "Submit to a faster registry service", correct: false }
        ],
        feedback: {
          correct: "Correct! L‚Äôinscription horodate vos promesses. Commencer avant l'inscription permet de changer de r√©sultat¬†: le probl√®me des 31¬†%.",
          incorrect: "L'inscription doit avoir lieu AVANT toute collecte de donn√©es. Cela √©vite le probl√®me de changement de r√©sultat de 31¬†%."
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üî•", title: "Sc√©nario final 2¬†: La crise",
        xp: 40,
        scenario: "Day 33. Your rerun shows RR=0.72. Collaborator's shows RR=0.68. Both significant but outside tolerance. You have 6 hours until DoD-D deadline.",
        question: "Quelle est votre premi√®re action¬†?",
        options: [
          { letter: "A", text: "Faites une moyenne de 0,70 et continuez", correct: false },
          { letter: "B", text: "Line-by-line input comparison", correct: true },
          { letter: "C", text: "Trigger CondGO immediately", correct: false },
          { letter: "D", text: "Ask both analysts to re-run again", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! La comparaison ligne par ligne permet de trouver la source de l'√©cart. En 6 heures, vous pourriez le r√©parer sans avoir besoin de CondGO.",
          incorrect: "First: find the source of discrepancy. Line-by-line comparison. Most mismatches have fixable causes."
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "‚öñÔ∏è", title: "Final Scenario 3: The Ethical Edge",
        xp: 40,
        scenario: "Votre m√©ta-analyse montre que le m√©dicament X est nocif (RR 1,35, IC 1,10-1,65). La soci√©t√© pharmaceutique qui a financ√© votre √©valuation vous demande de la ¬´ recadrer ¬ª comme √©tant ¬´ sans b√©n√©fice significatif ¬ª.",
        question: "Comment r√©agissez-vous¬†?",
        options: [
          { letter: "A", text: "They're technically correct‚Äîreframe as requested", correct: false },
          { letter: "B", text: "Report the finding accurately: harm detected", correct: true },
          { letter: "C", text: "Compromise: say 'insufficient evidence of benefit'", correct: false },
          { letter: "D", text: "Add sensitivity analyses until harm disappears", correct: false }
        ],
        feedback: {
          correct: "Correct! RR 1.35 with CI excluding 1.0 is harm. Report it accurately. The Avandia story: suppressing harm signals kills patients.",
          incorrect: "RR 1.35 (CI 1.10-1.65) = statistically significant HARM. Report it accurately. The Avandia scandal: silence killed tens of thousands."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "Le co√ªt de l'attente", title: "What Silence Buys",
        text: "Between 2000 and 2004, while Merck debated what to do about Vioxx, <strong>25,000 people died</strong> from heart attacks caused by a drug they trusted. Between 1999 and 2007, while GSK buried the Avandia spreadsheet, <strong>83,000 people suffered heart attacks</strong> from a diabetes drug that was supposed to help them.",
        followup: "Ce n'√©taient pas des accidents. Ils n'√©taient pas inconnaissables. Ils √©taient le r√©sultat pr√©visible de syst√®mes sans d√©lais, de preuves sans v√©rification et de personnes qui ont d√©cid√© qu'¬´ attendre et voir ¬ª √©tait plus s√ªr que ¬´ arr√™ter et v√©rifier ¬ª. Chaque jour de retard comportait un d√©compte de victimes."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üìÖ", title: "Sc√©nario¬†: le d√©lai confortable",
        xp: 30,
        scenario: "Votre examen syst√©matique a r√©v√©l√© des preuves claires de pr√©judices. Votre institution souhaite ¬´ attendre les commentaires des pairs ¬ª avant de faire des d√©clarations publiques. Le processus d'√©valuation par les pairs prend g√©n√©ralement de 6 √† 12¬†mois.",
        question: "Que devez-vous faire¬†?",
        options: [
          { letter: "A", text: "Attendez l'√©valuation par les pairs¬†: le processus appropri√© est important", correct: false },
          { letter: "B", text: "Post a preprint immediately while pursuing publication", correct: true },
          { letter: "C", text: "Share findings privately with key opinion leaders", correct: false },
          { letter: "D", text: "Accelerate peer review by submitting to multiple journals", correct: false }
        ],
        feedback: {
          correct: "Correct! Vioxx: 4 years of 'waiting' = 25,000 deaths. Avandia: 7 years = 83,000 heart attacks. When evidence shows harm, delay is not neutral‚Äîit's harmful. Preprint immediately.",
          incorrect: "Vioxx and Avandia: 'waiting' killed over 100,000 people combined. When evidence shows harm, every day of delay has a body count. Preprint findings immediately."
        }
      }},
      { type: "story", theme: "green-bg", content: {
        label: "L'autre voie", title: "Frances Kelsey's 19 Months",
        text: "In 1960, the FDA received an application to approve thalidomide in America. One reviewer‚ÄîFrances Kelsey‚Äîrefused to approve it. The manufacturer pressured her. Her colleagues questioned her. She held firm for <strong>19 months</strong>, demanding evidence of safety.",
        followup: "While she waited, 10,000 children were born with deformities in countries that had approved the drug. American children were spared‚Äînot by luck, but by one person who demanded proof before action. Kelsey proved that asking for evidence isn't obstruction. It's protection. META-SPRINT exists to make that protection systematic."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üõ°Ô∏è", title: "Sc√©nario¬†: la pression pour approuver",
        xp: 30,
        scenario: "Vous examinez un nouveau traitement. Le fabricant affirme que vos ¬´ demandes excessives de preuves ¬ª retardent l‚Äôacc√®s √† un m√©dicament potentiellement salvateur. Vos coll√®gues sugg√®rent que vous √™tes ¬´ trop prudent ¬ª. Les avocats du secteur font allusion √† des poursuites judiciaires pour ¬´¬†obstruction¬†¬ª.",
        question: "What should guide your decision?",
        options: [
          { letter: "A", text: "Speed up approval‚Äîpatients are waiting", correct: false },
          { letter: "B", text: "Maintain evidence standards regardless of pressure", correct: true },
          { letter: "C", text: "Compromis avec approbation conditionnelle", correct: false },
          { letter: "D", text: "Escalate to supervisors to share responsibility", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Frances Kelsey a √©t√© qualifi√©e de ¬´ bureaucratique ¬ª pendant 19 mois alors que 10 000 enfants dans d'autres pays ont √©t√© bless√©s. Elle a sauv√© des milliers d'enfants am√©ricains. Les normes de preuve sauvent des vies.",
          incorrect: "Kelsey a subi des pressions pendant 19 mois pour approuver la thalidomide. Son ¬´ obstruction ¬ª a sauv√© des milliers d‚Äôenfants. La pression et l‚Äôurgence ne sont pas des preuves. Les normes prot√®gent les patients."
        }
      }},
      { type: "story", theme: "red-bg", content: {
        label: "Le d√©sastre de Rezulin", title: "Le m√©dicament contre le diab√®te qui a d√©truit le foie",
        text: "In 1997, Warner-Lambert launched troglitazone (Rezulin) as a revolutionary diabetes treatment. The FDA approved it despite a medical officer's objections about liver toxicity signals. <strong>Within months, reports of liver failure poured in.</strong> The UK banned it in December 1997. Japan banned it in 2000.",
        followup: "The FDA kept Rezulin on the American market until March 2000‚Äî<strong>three years after the UK acted</strong>. During those three years, at least 90 Americans died of liver failure from a drug banned elsewhere. FDA's own scientists had warned of the danger. They were overruled. When Rezulin was finally withdrawn, internal documents revealed Warner-Lambert had hidden early liver toxicity data and downplayed risks. The gap between the UK ban and US withdrawal: three years. The cost: dozens of preventable deaths. Different regulators, same data, vastly different responses."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üåç", title: "Sc√©nario¬†: divergence r√©glementaire",
        xp: 30,
        scenario: "Un m√©dicament que vous examinez dans une m√©ta-analyse a √©t√© retir√© en Europe pour des raisons de s√©curit√© il y a 2 ans mais reste disponible dans votre pays. Les r√©gulateurs locaux citent ¬´ des preuves insuffisantes de dommages caus√©s √† notre population ¬ª. Les essais europ√©ens ont montr√© des signaux clairs de toxicit√© h√©patique.",
        question: "Comment cela devrait-il affecter votre revue syst√©matique¬†?",
        options: [
          { letter: "A", text: "Utilisez uniquement les donn√©es de votre pays¬†‚Äì les d√©cisions r√©glementaires varient", correct: false },
          { letter: "B", text: "Incluez toutes les donn√©es et signalez de mani√®re visible les divergences r√©glementaires dans les discussions", correct: true },
          { letter: "C", text: "Exclude the drug entirely due to safety concerns", correct: false },
          { letter: "D", text: "Trust your local regulators' interpretation", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Rezulin a tu√© des Am√©ricains pendant 3 ans apr√®s l'action du Royaume-Uni. Votre examen doit inclure toutes les donn√©es de s√©curit√© et mettre en √©vidence les divergences r√©glementaires. Les lecteurs ont besoin d'informations compl√®tes, non filtr√©es par les fronti√®res g√©ographiques.",
          incorrect: "Rezulin was banned in UK in 1997; Americans died until 2000. Regulatory decisions aren't evidence‚Äîthey're interpretations. Include all data and report divergences so readers can judge."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "Le scandale Ketek", title: "The Antibiotic Built on Fabricated Trials",
        text: "In 2004, the FDA approved telithromycin (Ketek) for respiratory infections. The approval relied heavily on a large trial‚ÄîStudy 3014‚Äîconducted by Dr. Anne Kirkman-Campbell. She enrolled <strong>407 patients in just 9 months</strong> from a solo practice. Impossible numbers, but the FDA didn't question them.",
        followup: "Dr. Kirkman-Campbell was later convicted of fraud. She had <strong>fabricated patient enrollment entirely</strong>‚Äîsome 'patients' were relatives who never had infections. But her fake data had already supported FDA approval. When real-world use began, Ketek caused liver failures, some fatal. An FDA reviewer had flagged Study 3014's impossible enrollment before approval‚Äîshe was overruled. The drug that was approved based partly on invented patients went on to harm real ones. The question no one asked: 'How can one doctor enroll 400 patients in conditions that would take a large hospital years?'"
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üî¢", title: "Sc√©nario¬†: le super-enr√¥leur",
        xp: 30,
        scenario: "Un essai clinique pivot comprend les donn√©es d'un praticien individuel qui a recrut√© 350 patients en 6 mois, soit plus que les 10 sites suivants r√©unis. Les rapports de surveillance du site sont marqu√©s ¬´ satisfaisants ¬ª. L'essai montre une forte efficacit√©.",
        question: "What verification should occur before regulatory decisions?",
        options: [
          { letter: "A", text: "La surveillance du site a r√©ussi, les donn√©es sont donc v√©rifi√©es", correct: false },
          { letter: "B", text: "Audit source documents: patient records, consent forms, medical histories", correct: true },
          { letter: "C", text: "Ex√©cutez l'analyse avec et sans les donn√©es de ce site", correct: false },
          { letter: "D", text: "Contactez l'investigateur pour obtenir une explication du taux d'inscription √©lev√©", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Kirkman-Campbell a r√©ussi la surveillance du site tout en fabriquant 407 patients. La v√©rification des documents sources ‚Äì les dossiers r√©els des patients ‚Äì l‚Äôaurait attrap√©e. Les donn√©es d'inscription autod√©clar√©es et le suivi ¬´ satisfaisant ¬ª ne veulent rien dire.",
          incorrect: "Dr. Kirkman-Campbell's site passed monitoring. Her patients didn't exist. Source document audits‚Äînot self-reports‚Äîcatch fabrication. Impossible enrollment rates demand verification of original records."
        }
      }},
      { type: "story", theme: "dark", content: {
        label: "The Promise", title: "Ce que cr√©ent des preuves dignes de confiance",
        text: "In 1987, the ISIS-2 trial showed aspirin reduces death after heart attack by 23%. The evidence was solid. The methods were transparent. The data was verifiable. Since then, aspirin after heart attack has saved an estimated <strong>100,000 lives per year</strong>.",
        followup: "That's what honest evidence creates: treatments that work, given to people who need them, saving lives that would otherwise be lost. Every protocol you register, every number you verify, every gate you pass‚Äîyou're building the foundation for the next ISIS-2. The next treatment that actually works. The next million lives saved."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "üåü", title: "Sc√©nario¬†: votre premier examen",
        xp: 30,
        scenario: "Vous √™tes sur le point de commencer votre premier examen syst√©matique. Un coll√®gue exp√©riment√© donne un conseil : ¬´ Ne vous inqui√©tez pas trop de tous ces protocoles et listes de contr√¥le. Faites simplement du bon travail et les preuves parleront d'elles-m√™mes.",
        question: "Comment devez-vous r√©agir¬†?",
        options: [
          { letter: "A", text: "Follow their advice‚Äîexperience beats process", correct: false },
          { letter: "B", text: "Follow META-SPRINT rigorously‚Äîsystems prevent disasters", correct: true },
          { letter: "C", text: "Adaptez le processus √† votre situation sp√©cifique", correct: false },
          { letter: "D", text: "Utilisez une version all√©g√©e pour votre premier examen, puis am√©liorez", correct: false }
        ],
        feedback: {
          correct: "Correct¬†! Les bonnes intentions n‚Äôemp√™chent pas les erreurs. Les preuves de l'aspirine d'ISIS-2 ont sauv√© 100 000 vies par an parce qu'elles √©taient rigoureuses. La fraude de Poldermans a tu√© 800 000 personnes parce que personne n'a v√©rifi√©. Les syst√®mes, et non les intentions, prot√®gent les patients.",
          incorrect: "Le ¬´ bon travail ¬ª sans syst√®mes a conduit √† Poldermans, CAST, Vioxx, Avandia. ISIS-2 a sauv√© des millions de personnes gr√¢ce √† des m√©thodes rigoureuses. La diff√©rence entre 100¬†000 sauv√©s et 800¬†000 tu√©s est une v√©rification syst√©matique."
        }
      }},
      { type: "stats", theme: "green-bg", content: {
        title: "Course Complete!",
        stats: [
          { value: "5", label: "Phases mastered" },
          { value: "5", label: "Gates understood" },
          { value: "8", label: "Modules completed" },
          { value: "‚àû", label: "Patients protected" }
        ],
        caption: "Vous comprenez maintenant comment produire des preuves qui sauvent des vies."
      }},
      { type: "refrain", theme: "black", content: { text: "Allez instaurer la confiance. 40 jours. 5 portes. Des preuves qui comptent." }}
    ]
  }
];

// ===== NAVIGATION STATE =====
let currentModule = 0;
let currentSlide = 0;
let consecutiveCorrect = gameState.consecutiveCorrect || 0;

// ===== SAVE/LOAD =====
function saveGame() {
  safeSetStorage('metasprintGame_v1', gameState);
}

function resetProgress() {
  if (confirm('Reset all progress and achievements?')) {
    gameState = { ...DEFAULT_STATE, answeredQuestions: {}, badges: [], completedModules: [], perfectModules: [], consecutiveCorrect: 0 };
    consecutiveCorrect = 0;
    saveGame();
    currentModule = 0;
    currentSlide = 0;
    renderAll();
  }
}

// ===== GLOSSARY =====
function toggleGlossary() {
  document.getElementById('glossaryPanel').classList.toggle('open');
}

// ===== COURSE PROGRESS =====
function updateCourseProgress() {
  const totalModules = MODULES.length;
  const completedCount = gameState.completedModules.length;
  const pct = Math.round((completedCount / totalModules) * 100);
  const fillEl = document.getElementById('courseProgressFill');
  const pctEl = document.getElementById('courseProgressPct');
  if (fillEl) fillEl.style.width = pct + '%';
  if (pctEl) pctEl.textContent = pct + '%';
}

// ===== MODULE QUESTION TRACKING =====
function getModuleQuestionIds(moduleIndex) {
  const mod = MODULES[moduleIndex];
  const ids = [];
  mod.slides.forEach((slide, si) => {
    if (slide.type === 'decision') ids.push(`dec_${moduleIndex}_${si}`);
    if (slide.type === 'quiz') ids.push(`quiz_${moduleIndex}_${si}`);
    if (slide.type === 'prediction') ids.push(`pred_${moduleIndex}_${si}`);
  });
  return ids;
}

function checkPerfectModule(moduleIndex) {
  const mod = MODULES[moduleIndex];
  const questionIds = getModuleQuestionIds(moduleIndex);
  if (questionIds.length === 0) return false;

  let allCorrect = true;
  questionIds.forEach(id => {
    const answer = gameState.answeredQuestions[id];
    if (answer === undefined || answer === null) { allCorrect = false; return; }

    // Find the slide and check if answer was correct
    const parts = id.split('_');
    const slideIndex = parseInt(parts[2]);
    const slide = mod.slides[slideIndex];

    if (slide.type === 'decision') {
      const correctOpt = slide.content.options.find(o => o.correct);
      if (answer !== correctOpt?.letter) allCorrect = false;
    } else if (slide.type === 'quiz') {
      const correctIdx = slide.content.options.findIndex(o => o.correct);
      if (answer !== correctIdx) allCorrect = false;
    } else if (slide.type === 'prediction') {
      if (answer !== slide.content.answer) allCorrect = false;
    }
  });

  return allCorrect;
}

// ===== XP & LEVELING =====
function addXP(amount) {
  gameState.xp += amount;
  checkLevelUp();
  saveGame();
  updateStatsDisplay();
  showXPPopup(amount);
}

function checkLevelUp() {
  for (let i = LEVELS.length - 1; i >= 0; i--) {
    if (gameState.xp >= LEVELS[i].xp && gameState.level < LEVELS[i].level) {
      gameState.level = LEVELS[i].level;
      showLevelUp(LEVELS[i]);
      break;
    }
  }
}

function showXPPopup(amount) {
  const popup = document.getElementById('xpPopup');
  document.getElementById('xpAmount').textContent = `+${amount}`;
  popup.classList.add('show');
  setTimeout(() => popup.classList.remove('show'), 1500);
}

function showLevelUp(levelData) {
  triggerConfetti();
  showBadgeModal({ icon: levelData.icon, name: `Level ${levelData.level}`, desc: levelData.title });
}

// ===== BADGES =====
function awardBadge(badgeId) {
  if (gameState.badges.includes(badgeId)) return;
  gameState.badges.push(badgeId);
  saveGame();
  const badge = BADGES.find(b => b.id === badgeId);
  if (badge) showBadgeModal(badge);
  updateBadges();
}

function awardBadgeIfNew(id, icon, name, desc) {
  if (gameState.badges.includes(id)) return;
  gameState.badges.push(id);
  saveGame();
  showBadgeModal({ icon, name, desc });
  updateBadges();
}

function showBadgeModal(badge) {
  const modal = document.getElementById('badgeModal');
  // Remove any existing focus trap handler before adding a new one
  if (modal._focusTrapHandler) {
    modal.removeEventListener('keydown', modal._focusTrapHandler);
  }
  document.getElementById('badgeModalIcon').textContent = badge.icon;
  document.getElementById('badgeModalTitle').textContent = badge.name;
  document.getElementById('badgeModalDesc').textContent = badge.desc;
  modal.classList.add('show');
  triggerConfetti();

  // Focus trap for accessibility
  const focusableElements = modal.querySelectorAll('button, [tabindex]:not([tabindex="-1"])');
  if (focusableElements.length > 0) {
    focusableElements[0].focus();
  }
  const trapHandler = function(e) {
    if (e.key === 'Escape') {
      closeBadgeModal();
      return;
    }
    if (e.key === 'Tab') {
      const firstFocusable = focusableElements[0];
      const lastFocusable = focusableElements[focusableElements.length - 1];
      if (e.shiftKey && document.activeElement === firstFocusable) {
        e.preventDefault();
        lastFocusable.focus();
      } else if (!e.shiftKey && document.activeElement === lastFocusable) {
        e.preventDefault();
        firstFocusable.focus();
      }
    }
  };
  modal._focusTrapHandler = trapHandler;
  modal.addEventListener('keydown', trapHandler);
}

function closeBadgeModal() {
  const modal = document.getElementById('badgeModal');
  if (modal._focusTrapHandler) {
    modal.removeEventListener('keydown', modal._focusTrapHandler);
    delete modal._focusTrapHandler;
  }
  modal.classList.remove('show');
}

// ===== STREAK =====
function updateStreak() {
  const today = new Date().toDateString();
  if (gameState.lastActive !== today) {
    const yesterday = new Date(Date.now() - 86400000).toDateString();
    if (gameState.lastActive === yesterday) {
      gameState.streak++;
      if (gameState.streak >= 3) awardBadge('streak_3');
      if (gameState.streak >= 7) awardBadge('streak_7');
    } else if (gameState.lastActive) {
      gameState.streak = 1;
    } else {
      gameState.streak = 1;
    }
    gameState.lastActive = today;
    saveGame();
  }
}

// ===== CONFETTI =====
function triggerConfetti() {
  // Respect reduced motion preference
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

  const container = document.getElementById('confettiContainer');
  const colors = ['#D4AF37', '#22c55e', '#3b82f6', '#f59e0b', '#ef4444', '#7c3aed'];
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDelay = Math.random() * 0.5 + 's';
    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
    container.appendChild(confetti);
    setTimeout(() => confetti.remove(), 3500);
  }
}

// ===== COMBO COUNTER =====
function updateComboDisplay() {
  const comboEl = document.getElementById('comboDisplay');
  const countEl = document.getElementById('comboCount');

  if (consecutiveCorrect >= 2) {
    countEl.textContent = consecutiveCorrect;
    comboEl.classList.add('show');

    // Animate for big combos
    if (consecutiveCorrect >= 5) {
      comboEl.classList.add('big');
      setTimeout(() => comboEl.classList.remove('big'), 300);
    }
  } else {
    comboEl.classList.remove('show');
  }
}

// ===== MOBILE SIDEBAR =====
function toggleSidebar() {
  const sidebar = document.querySelector('.sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  sidebar.classList.toggle('open');
  overlay.classList.toggle('show');
  var btn = document.querySelector('.sidebar-toggle, .hamburger, .mobile-menu-btn'); if (btn) btn.setAttribute('aria-expanded', btn.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
}

// ===== RENDER =====
function renderAll() {
  updateStreak();
  renderSidebar();
  renderSlides();
  updateStatsDisplay();
  updateBadges();
  updateCourseProgress();
}

function updateStatsDisplay() {
  const levelData = LEVELS.find(l => l.level === gameState.level) || LEVELS[0];
  const nextLevel = LEVELS.find(l => l.level === gameState.level + 1);

  document.getElementById('levelIcon').textContent = levelData.icon;
  document.getElementById('levelTitle').textContent = levelData.title;
  document.getElementById('levelNum').textContent = gameState.level;

  const currentXP = gameState.xp - levelData.xp;
  const neededXP = nextLevel ? (nextLevel.xp - levelData.xp) : 500;
  const pct = Math.min(100, (currentXP / neededXP) * 100);

  document.getElementById('xpFill').style.width = pct + '%';
  document.getElementById('xpCurrent').textContent = currentXP;
  document.getElementById('xpNeeded').textContent = neededXP;

  document.getElementById('correctCount').textContent = gameState.correctAnswers;
  document.getElementById('decisionCount').textContent = gameState.decisionsCompleted;
  document.getElementById('predictCount').textContent = gameState.predictionsCorrect;
  document.getElementById('streakCount').textContent = gameState.streak;

  const streakEl = document.getElementById('streakDisplay');
  streakEl.classList.toggle('active', gameState.streak > 0);
}

function updateBadges() {
  const grid = document.getElementById('badgesGrid');
  grid.innerHTML = BADGES.map(b => {
    const earned = gameState.badges.includes(b.id);
    let progress = '';

    // Show progress for certain badges
    if (!earned) {
      if (b.id === 'oracle') progress = `${gameState.predictionsCorrect}/5`;
      if (b.id === 'decision_maker') progress = `${gameState.decisionsCompleted}/10`;
      if (b.id === 'streak_3') progress = `${Math.min(gameState.streak, 3)}/3`;
      if (b.id === 'streak_7') progress = `${Math.min(gameState.streak, 7)}/7`;
      if (b.id === 'finisher') progress = `${gameState.completedModules.length}/${MODULES.length}`;
    }

    return `
      <button class="badge-item ${earned ? 'earned' : ''}" data-tooltip="${b.name}: ${b.desc}" aria-label="${b.name}: ${b.desc}${earned ? ' (Earned)' : ''}">
        ${b.icon}
        ${progress && !earned ? `<span class="badge-progress">${progress}</span>` : ''}
      </button>
    `;
  }).join('');
}

function renderSidebar() {
  const list = document.getElementById('moduleList');
  list.innerHTML = MODULES.map((mod, i) => {
    const completed = gameState.completedModules.includes(mod.id);
    const locked = i > 0 && !gameState.completedModules.includes(MODULES[i-1].id);
    // Estimate ~1.5 min per slide
    const estMins = Math.round(mod.slides.length * 1.5);
    return `
      <div class="module-item ${i === currentModule ? 'active' : ''} ${completed ? 'completed' : ''} ${locked ? 'locked' : ''}"
           onclick="${locked ? '' : `goToModule(${i})`}"
           role="button"
           tabindex="${locked ? -1 : 0}"
           aria-label="${mod.title}${completed ? ' (completed)' : ''}${locked ? ' (locked)' : ''}">
        <div class="module-number">${completed ? '‚úì' : (locked ? 'üîí' : mod.id)}</div>
        <div class="module-info">
          <div class="module-title">${mod.title}</div>
          <div class="module-subtitle">${mod.subtitle}</div>
          <div class="module-xp">+${mod.xp} XP</div>
          <div class="module-time">‚è±Ô∏è ~${estMins} min</div>
        </div>
      </div>
    `;
  }).join('');
}

function renderSlides() {
  const container = document.getElementById('main-content');
  container.innerHTML = MODULES.map((mod, mi) => {
    const progressPct = ((currentSlide + 1) / mod.slides.length) * 100;
    return `
    <div class="module-slides ${mi === currentModule ? 'active' : ''}" data-module="${mi}">
      <div class="slide-progress-bar" style="width: ${mi === currentModule ? progressPct : 0}%"></div>
      ${mod.slides.map((slide, si) => renderSlide(slide, si, mi)).join('')}
      <div class="slide-nav">
        <button class="nav-btn" onclick="prevSlide()" aria-label="Previous slide" ${currentSlide === 0 ? 'disabled' : ''}>‚Üê</button>
        <div class="nav-center">
          <div class="slide-counter">${currentSlide + 1} / ${mod.slides.length}</div>
          <div class="progress-dots">
            ${mod.slides.map((_, i) => `<button class="progress-dot ${i === currentSlide ? 'active' : ''}" type="button" onclick="goToSlide(${i})" aria-label="Go to slide ${i + 1}" ${i === currentSlide ? 'aria-current="true"' : ''}></button>`).join('')}
          </div>
        </div>
        <button class="nav-btn" onclick="nextSlide()" aria-label="Next slide">‚Üí</button>
      </div>
    </div>
  `;
  }).join('');
  document.getElementById('currentModule').textContent = MODULES[currentModule].title;
  updateSlideVisibility();
}

function renderSlide(slide, index, moduleIndex) {
  const theme = slide.theme || 'dark';
  let html = `<div class="slide ${theme} ${index === currentSlide ? 'active' : ''}" data-slide="${index}">`;

  switch(slide.type) {
    case 'title':
      html += `<div class="content"><h1 class="title gold animate">${slide.content.title}</h1><p class="subtitle animate delay-1">${slide.content.subtitle}</p></div>`;
      break;

    case 'objectives':
      html += `<div class="content">
        <div class="objectives-box animate">
          <div class="objectives-header">
            <div class="objectives-icon">üéØ</div>
            <div class="objectives-title">Learning Objectives</div>
          </div>
          <ul class="objectives-list">
            ${slide.content.objectives.map(obj => `<li>${obj}</li>`).join('')}
          </ul>
        </div>
        ${slide.content.tip ? `<p class="subtitle animate delay-1" style="font-size:0.85rem;max-width:600px">${slide.content.tip}</p>` : ''}
      </div>`;
      break;

    case 'summary':
      const modXP = MODULES[moduleIndex]?.xp || 0;
      const isPerfect = checkPerfectModule(moduleIndex);
      html += `<div class="content">
        <div class="summary-box animate">
          <div class="summary-icon">üéâ</div>
          <div class="summary-title">Module Complete!</div>
          <div class="summary-stats">
            <div class="summary-stat">
              <div class="summary-stat-value">+${modXP}</div>
              <div class="summary-stat-label">XP Earned</div>
            </div>
            <div class="summary-stat">
              <div class="summary-stat-value">${gameState.correctAnswers}</div>
              <div class="summary-stat-label">Total Correct</div>
            </div>
          </div>
          ${isPerfect ? `<div class="perfect-bonus animate delay-1">‚≠ê PERFECT MODULE +${Math.round(modXP * 0.5)} XP ‚≠ê</div>` : ''}
          <p class="subtitle" style="margin-top:1rem;font-size:0.85rem">${slide.content.summary || 'Excellent travail¬†! Passez au module suivant.'}</p>
          <button class="summary-next animate delay-2" onclick="nextSlide()">Continue to Next Module ‚Üí</button>
        </div>
      </div>`;
      break;

    case 'story':
      html += `<div class="content">
        <article class="story-box ${slide.content.success ? 'success' : ''} animate" role="article" aria-label="Case study: ${slide.content.label}">
          <div class="story-label">${slide.content.label}</div>
          ${slide.content.title ? `<h2 class="title gold" style="font-size:1.8rem;margin-bottom:0.75rem">${slide.content.title}</h2>` : ''}
          <p class="story-text">${slide.content.text}</p>
          ${slide.content.followup ? `<p class="story-text" style="margin-top:0.75rem;font-style:italic;opacity:0.9">${slide.content.followup}</p>` : ''}
        </article>
      </div>`;
      break;

    case 'stats':
      html += `<div class="content">
        ${slide.content.title ? `<h2 class="title gold animate">${slide.content.title}</h2>` : ''}
        ${slide.content.subtitle ? `<p class="subtitle animate delay-1">${slide.content.subtitle}</p>` : ''}
        <div class="stats-grid animate delay-2">
          ${slide.content.stats.map(s => `<div class="stat-box"><div class="stat-value gold">${s.value}</div><div class="stat-label">${s.label}</div></div>`).join('')}
        </div>
        ${slide.content.caption ? `<p class="subtitle animate delay-3" style="font-size:0.85rem;margin-top:0.75rem">${slide.content.caption}</p>` : ''}
      </div>`;
      break;

    case 'refrain':
      html += `<div class="content" style="justify-content:center;height:100%"><p class="refrain animate">"${slide.content.text}"</p></div>`;
      break;

    case 'lesson':
      html += `<div class="content">
        <h2 class="title ${theme === 'light' ? 'navy' : 'gold'} animate">${slide.content.title}</h2>
        <div class="animate delay-1">
          ${slide.content.lessons.map((l, i) => `
            <div class="lesson-item">
              <div class="lesson-number">${i + 1}</div>
              <div class="lesson-content"><h4>${l.title}</h4><p>${l.desc}</p></div>
            </div>
          `).join('')}
        </div>
      </div>`;
      break;

    case 'timeline':
      html += `<div class="content">
        <h2 class="title gold animate">${slide.content.title}</h2>
        <div class="timeline animate delay-1">
          ${slide.content.items.map(item => `
            <div class="timeline-item phase-${item.phase || ''}">
              <div class="timeline-days">${item.days}</div>
              <div class="timeline-content">
                <div class="timeline-title">${item.title}</div>
                <div class="timeline-desc">${item.desc}</div>
              </div>
            </div>
          `).join('')}
        </div>
      </div>`;
      break;

    case 'checklist':
      html += `<div class="content">
        <h2 class="title gold animate">${slide.content.title}</h2>
        <div class="checklist animate delay-1">
          ${slide.content.items.map(item => `
            <div class="checklist-item">
              <div class="check-icon">‚úì</div>
              <div class="checklist-text">${item}</div>
            </div>
          `).join('')}
        </div>
      </div>`;
      break;

    case 'concept':
      html += `<div class="content">
        <h2 class="title ${theme === 'light' ? 'navy' : 'gold'} animate">${slide.content.title}</h2>
        ${slide.content.subtitle ? `<p class="subtitle animate delay-1">${slide.content.subtitle}</p>` : ''}
        ${slide.content.text ? `<div class="card ${theme === 'light' ? '' : 'navy-bg'} animate delay-2"><p class="card-text">${slide.content.text}</p></div>` : ''}
        ${slide.content.highlight ? `<div class="story-box warning animate delay-3"><div class="story-label">Key Insight</div><p class="story-text">${slide.content.highlight}</p></div>` : ''}
        ${slide.content.checkpoints ? `
          <div class="timeline animate delay-2" style="margin-top:0.75rem">
            ${slide.content.checkpoints.map(cp => `
              <div class="timeline-item"><div class="timeline-days">${cp.day}</div><div class="timeline-content"><div class="timeline-title">${cp.event}</div></div></div>
            `).join('')}
          </div>
        ` : ''}
        ${slide.content.allowed ? `
          <div class="card green-border animate delay-2" style="margin-top:0.75rem">
            <div class="card-label" style="color:var(--green)">‚úì Allowed</div>
            <ul style="margin-left:1.25rem;font-size:0.9rem">${slide.content.allowed.map(a => `<li>${a}</li>`).join('')}</ul>
          </div>
          <div class="card red-border animate delay-3">
            <div class="card-label" style="color:var(--red)">‚úó Forbidden</div>
            <ul style="margin-left:1.25rem;font-size:0.9rem">${slide.content.forbidden.map(f => `<li>${f}</li>`).join('')}</ul>
          </div>
        ` : ''}
      </div>`;
      break;

    case 'takeaway':
      html += `<div class="content">
        <div class="takeaway-card animate">
          <div class="takeaway-label"><span class="takeaway-icon">üí°</span>Key Takeaway</div>
          <p class="takeaway-text">${slide.content.text}</p>
        </div>
      </div>`;
      break;

    case 'prediction':
      const pid = `pred_${moduleIndex}_${index}`;
      const answered = gameState.answeredQuestions[pid];
      html += `<div class="content">
        <div class="prediction-panel animate" id="${pid}_panel">
          <div class="prediction-icon">${slide.content.icon}</div>
          <div class="prediction-title">${slide.content.title}</div>
          <p class="prediction-subtitle">${slide.content.subtitle}</p>
          <div class="prediction-buttons" id="${pid}_buttons">
            ${slide.content.options.map(opt => `
              <button class="predict-btn ${opt.id === 'benefit' ? 'benefit' : opt.id === 'harm' ? 'harm' : 'neutral'} ${answered === opt.id ? 'selected' : ''}"
                      onclick="makePrediction('${pid}', '${opt.id}', '${slide.content.answer}', ${slide.content.xp})"
                      ${answered ? 'disabled' : ''}>
                ${opt.label}<br><small>${opt.text}</small>
              </button>
            `).join('')}
          </div>
          <div class="prediction-result ${answered ? 'show' : ''} ${answered === slide.content.answer ? 'correct' : 'incorrect'}" id="${pid}_result">
            ${answered === slide.content.answer ? '‚úì Votre intuition √©tait bonne¬†!' : answered ? '‚úó Les donn√©es vous ont surpris¬†: bon √† savoir¬†!' : ''}
          </div>
        </div>
      </div>`;
      break;

    case 'decision':
      const did = `dec_${moduleIndex}_${index}`;
      const decAnswered = gameState.answeredQuestions[did];
      html += `<div class="content">
        <div class="decision-tree animate">
          <div class="decision-header">
            <div class="decision-icon">${slide.content.icon}</div>
            <div><div class="decision-title">${slide.content.title}</div></div>
            <div class="decision-xp">+${slide.content.xp} XP</div>
          </div>
          <div class="decision-scenario">${slide.content.scenario}</div>
          <div class="decision-question">${slide.content.question}</div>
          <div class="decision-options" id="${did}_options">
            ${slide.content.options.map((opt, oi) => `
              <div class="decision-option ${decAnswered === opt.letter ? (opt.correct ? 'correct' : 'incorrect') : ''} ${decAnswered && opt.correct ? 'correct' : ''} ${decAnswered ? 'disabled' : ''}"
                   onclick="makeDecision('${did}', '${opt.letter}', ${opt.correct}, ${slide.content.xp})"
                   tabindex="${decAnswered ? -1 : 0}"
                   role="button"
                   aria-label="Option ${opt.letter}: ${opt.text}"
                   onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();makeDecision('${did}', '${opt.letter}', ${opt.correct}, ${slide.content.xp});}">
                <div class="option-letter">${opt.letter}</div>
                <div class="option-text">${opt.text}</div>
              </div>
            `).join('')}
          </div>
          <div class="decision-feedback ${decAnswered ? 'show' : ''} ${decAnswered && slide.content.options.find(o => o.letter === decAnswered)?.correct ? 'correct' : 'incorrect'}" id="${did}_feedback">
            <div class="feedback-title">${decAnswered && slide.content.options.find(o => o.letter === decAnswered)?.correct ? '‚úì Correct!' : '‚úó Not quite'}</div>
            <div class="feedback-text">${decAnswered && slide.content.options.find(o => o.letter === decAnswered)?.correct ? slide.content.feedback.correct : slide.content.feedback.incorrect}</div>
          </div>
        </div>
      </div>`;
      break;

    case 'quiz':
      const qid = `quiz_${moduleIndex}_${index}`;
      const qAnswered = gameState.answeredQuestions[qid];
      html += `<div class="content">
        <div class="quiz-container animate">
          <p class="quiz-question">${slide.content.question}</p>
          <div class="quiz-options" id="${qid}_options">
            ${slide.content.options.map((opt, i) => `
              <div class="quiz-option ${qAnswered === i ? (opt.correct ? 'correct' : 'incorrect') : ''} ${qAnswered !== undefined && opt.correct ? 'correct' : ''} ${qAnswered !== undefined ? 'disabled' : ''}"
                   onclick="answerQuiz('${qid}', ${i}, ${opt.correct}, ${slide.content.xp || 20})">
                ${opt.text}
              </div>
            `).join('')}
          </div>
          <div class="quiz-feedback ${qAnswered !== undefined ? 'show' : ''} ${qAnswered !== undefined && slide.content.options[qAnswered]?.correct ? 'correct' : 'incorrect'}" id="${qid}_feedback">
            ${qAnswered !== undefined ? (slide.content.options[qAnswered]?.correct ? slide.content.feedback.correct : slide.content.feedback.incorrect) : ''}
          </div>
        </div>
      </div>`;
      break;
  }

  html += '</div>';
  return html;
}

function updateSlideVisibility() {
  const moduleSlides = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
  if (!moduleSlides) return;
  moduleSlides.querySelectorAll('.slide').forEach((slide, i) => slide.classList.toggle('active', i === currentSlide));
  const counter = moduleSlides.querySelector('.slide-counter');
  if (counter) counter.textContent = `${currentSlide + 1} / ${MODULES[currentModule].slides.length}`;
  moduleSlides.querySelectorAll('.progress-dot').forEach((dot, i) => dot.classList.toggle('active', i === currentSlide));
  const prevBtn = moduleSlides.querySelector('.nav-btn:first-child');
  if (prevBtn) prevBtn.disabled = currentSlide === 0;
}

// ===== INTERACTIONS =====
function makePrediction(pid, choice, answer, xp) {
  if (gameState.answeredQuestions[pid]) return;
  gameState.answeredQuestions[pid] = choice;
  gameState.predictionsTotal++;

  const correct = choice === answer;
  if (correct) {
    gameState.predictionsCorrect++;
    addXP(xp);
    if (gameState.predictionsCorrect >= 5) awardBadge('oracle');
  }
  saveGame();
  renderSlides();
}

function makeDecision(did, choice, correct, xp) {
  if (gameState.answeredQuestions[did]) return;
  gameState.answeredQuestions[did] = choice;
  gameState.decisionsCompleted++;

  if (correct) {
    gameState.correctAnswers++;
    consecutiveCorrect++;
    addXP(xp);
    if (gameState.correctAnswers === 1) awardBadge('first_blood');
    if (consecutiveCorrect >= 5) awardBadge('perfect_5');
    if (gameState.decisionsCompleted >= 10) awardBadge('decision_maker');
  } else {
    consecutiveCorrect = 0;
  }
  gameState.consecutiveCorrect = consecutiveCorrect;
  saveGame();
  renderSlides();
  updateReviewButton();
  updateComboDisplay();
}

function answerQuiz(qid, choice, correct, xp) {
  if (gameState.answeredQuestions[qid] !== undefined) return;
  gameState.answeredQuestions[qid] = choice;

  if (correct) {
    gameState.correctAnswers++;
    consecutiveCorrect++;
    addXP(xp);
    if (gameState.correctAnswers === 1) awardBadge('first_blood');
    if (consecutiveCorrect >= 5) awardBadge('perfect_5');
  } else {
    consecutiveCorrect = 0;
  }
  gameState.consecutiveCorrect = consecutiveCorrect;
  saveGame();
  renderSlides();
  updateReviewButton();
  updateComboDisplay();
}

// ===== NAVIGATION =====
function goToModule(index) {
  if (index > 0 && !gameState.completedModules.includes(MODULES[index-1].id)) return;
  currentModule = index;
  currentSlide = 0;
  renderSlides();
  renderSidebar();
}

function goToSlide(index) {
  currentSlide = index;
  updateSlideVisibility();
}

function nextSlide() {
  const mod = MODULES[currentModule];
  if (currentSlide < mod.slides.length - 1) {
    currentSlide++;
    updateSlideVisibility();
  } else {
    completeModule();
  }
}

function prevSlide() {
  if (currentSlide > 0) {
    currentSlide--;
    updateSlideVisibility();
  }
}

function completeModule() {
  const mod = MODULES[currentModule];
  if (!gameState.completedModules.includes(mod.id)) {
    gameState.completedModules.push(mod.id);
    addXP(mod.xp);

    // Check for perfect module (all questions correct)
    if (checkPerfectModule(currentModule) && !gameState.perfectModules.includes(mod.id)) {
      gameState.perfectModules.push(mod.id);
      const bonusXP = Math.round(mod.xp * 0.5);
      addXP(bonusXP);
      showPerfectBonus(bonusXP);
    }

    // Check for module-specific badges
    if (mod.id === 3) awardBadge('protocol_pro');
    if (mod.id === 4) awardBadge('search_savant');
    if (mod.id === 5) awardBadge('data_detective');
    if (mod.id === 6) awardBadge('stats_wizard');
    if (mod.id === 8) awardBadge('colchicine_hero');
    if (gameState.completedModules.length === MODULES.length) {
      awardBadge('finisher');
      setTimeout(showCompletionModal, 500);
    }

    saveGame();
    triggerConfetti();
    updateCourseProgress();
  }

  if (currentModule < MODULES.length - 1) {
    goToModule(currentModule + 1);
  }
}

function showPerfectBonus(xp) {
  const popup = document.getElementById('xpPopup');
  document.getElementById('xpAmount').innerHTML = `+${xp}<br><small style="font-size:0.8rem">PERFECT!</small>`;
  popup.classList.add('show');
  setTimeout(() => {
    popup.classList.remove('show');
    document.getElementById('xpAmount').textContent = '+0';
  }, 2000);
}

// ===== CERTIFICATE DOWNLOAD =====
function downloadCertificate() {
  const courseName = 'META-SPRINT¬†:¬†40 jours pour obtenir des preuves fiables';
  const completionDate = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  const level = LEVELS[gameState.level - 1] || LEVELS[0];
  const badgeCount = gameState.badges.length;
  const totalXP = gameState.xp;

  const certHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Certificate of Completion - ${courseName}</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Source+Sans+Pro:wght@400;600&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Source Sans Pro', sans-serif; background: #f5f5f5; padding: 20px; }
    .certificate {
      max-width: 800px; margin: 0 auto; background: linear-gradient(135deg, #1E2761 0%, #141B3D 100%);
      border: 8px solid #D4AF37; border-radius: 12px; padding: 60px 50px; text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .cert-header { font-family: 'Cormorant Garamond', serif; color: #D4AF37; font-size: 1rem; letter-spacing: 0.3em; text-transform: uppercase; margin-bottom: 10px; }
    .cert-title { font-family: 'Cormorant Garamond', serif; color: #FAF8F5; font-size: 3rem; font-weight: 700; margin-bottom: 30px; }
    .cert-subtitle { color: rgba(255,255,255,0.8); font-size: 1.1rem; margin-bottom: 40px; }
    .cert-course { font-family: 'Cormorant Garamond', serif; color: #D4AF37; font-size: 2rem; font-weight: 600; margin-bottom: 15px; padding: 20px; border-top: 1px solid rgba(212,175,55,0.3); border-bottom: 1px solid rgba(212,175,55,0.3); }
    .cert-stats { display: flex; justify-content: center; gap: 40px; margin: 30px 0; }
    .cert-stat { text-align: center; }
    .cert-stat-value { font-family: 'Cormorant Garamond', serif; font-size: 2rem; color: #D4AF37; font-weight: 700; }
    .cert-stat-label { font-size: 0.8rem; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 0.1em; }
    .cert-date { color: rgba(255,255,255,0.7); font-size: 0.95rem; margin-top: 40px; }
    .cert-footer { margin-top: 40px; padding-top: 30px; border-top: 1px solid rgba(212,175,55,0.2); }
    .cert-issuer { color: rgba(255,255,255,0.5); font-size: 0.85rem; }
    .cert-badge { display: inline-block; margin-top: 15px; padding: 8px 20px; background: rgba(212,175,55,0.2); border: 1px solid rgba(212,175,55,0.4); border-radius: 20px; color: #D4AF37; font-size: 0.9rem; }
    @media print {
      body { background: white; padding: 0; }
      .certificate { box-shadow: none; }
    }
  </style>
</head>
<body>
  <div class="certificate">
    <div class="cert-header">Synthesis Course Collection</div>
    <div class="cert-title">Certificate of Completion</div>
    <div class="cert-subtitle">This certifies successful completion of</div>
    <div class="cert-course">${courseName}</div>
    <div class="cert-stats">
      <div class="cert-stat">
        <div class="cert-stat-value">${totalXP.toLocaleString()}</div>
        <div class="cert-stat-label">Total XP Earned</div>
      </div>
      <div class="cert-stat">
        <div class="cert-stat-value">${badgeCount}</div>
        <div class="cert-stat-label">Badges Earned</div>
      </div>
      <div class="cert-stat">
        <div class="cert-stat-value">${level.title}</div>
        <div class="cert-stat-label">Final Level</div>
      </div>
    </div>
    <div class="cert-date">Completed on ${completionDate}</div>
    <div class="cert-footer">
      <div class="cert-issuer">Synthesis Course Collection ‚Äî Evidence Synthesis & Meta-Analysis Training</div>
      <div class="cert-badge">Verified Completion</div>
    </div>
  </div>
  <script>window.onload = () => window.print();<\/script>
</body>
</html>`;

  const blob = new Blob([certHTML], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Certificate-META-SPRINT-Course.html';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// ===== KEYBOARD =====
document.addEventListener('keydown', (e) => {
  // Close modals with Escape
  if (e.key === 'Escape') {
    closeBadgeModal();
    document.getElementById('glossaryPanel').classList.remove('open');
    document.getElementById('completionModal').classList.remove('show');
    document.getElementById('reviewPanel').classList.remove('show');
    // Close mobile sidebar
    document.querySelector('.sidebar').classList.remove('open');
    document.getElementById('sidebarOverlay').classList.remove('show');
    return;
  }
  // Keyboard support for interactive elements (check first to avoid intercepting their keys)
  if ((e.target.classList.contains('module-item') || e.target.classList.contains('decision-option') || e.target.classList.contains('quiz-option')) && (e.key === 'Enter' || e.key === ' ')) {
    e.preventDefault();
    e.target.click();
    return;
  }
  // Don't navigate if review panel is open
  if (document.getElementById('reviewPanel').classList.contains('show')) return;
  // Navigation
  if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
  else if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
});

// ===== TOUCH/SWIPE =====
let touchStartX = 0;
let touchEndX = 0;

document.addEventListener('touchstart', (e) => {
  touchStartX = e.changedTouches[0].screenX;
}, { passive: true });

document.addEventListener('touchend', (e) => {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipe();
}, { passive: true });

function handleSwipe() {
  const swipeThreshold = 50;
  const diff = touchStartX - touchEndX;
  if (Math.abs(diff) < swipeThreshold) return;

  if (diff > 0) {
    // Swipe left = next; guard against swiping past last slide of completed module
    const mod = MODULES[currentModule];
    if (currentSlide >= mod.slides.length - 1 && gameState.completedModules.includes(mod.id)) return;
    nextSlide();
  } else {
    // Swipe right = prev
    prevSlide();
  }
}

// ===== STREAK WARNING =====
function checkStreakWarning() {
  const today = new Date().toDateString();
  const streakEl = document.getElementById('streakDisplay');
  if (gameState.lastActive && gameState.lastActive !== today && gameState.streak > 0) {
    // User has a streak but hasn't engaged today
    const lastDate = new Date(gameState.lastActive);
    const now = new Date();
    const hoursSince = (now - lastDate) / (1000 * 60 * 60);
    if (hoursSince > 20 && hoursSince < 48) {
      // Streak at risk!
      streakEl.classList.add('streak-warning');
      streakEl.title = 'Terminez une le√ßon aujourd\'hui pour maintenir votre s√©quence¬†!';
    }
  }
}

// ===== COMPLETION MODAL =====
function showCompletionModal() {
  document.getElementById('finalXP').textContent = gameState.xp;
  document.getElementById('finalCorrect').textContent = gameState.correctAnswers;
  document.getElementById('finalBadges').textContent = gameState.badges.length;
  document.getElementById('completionModal').classList.add('show');
  triggerConfetti();
  setTimeout(triggerConfetti, 500);
  setTimeout(triggerConfetti, 1000);
}

function closeCompletionModal() {
  document.getElementById('completionModal').classList.remove('show');
}

// ===== REVIEW MISTAKES =====
function updateReviewButton() {
  const mistakes = getIncorrectAnswers();
  const btn = document.getElementById('reviewMistakesBtn');
  if (mistakes.length > 0) {
    btn.classList.add('show');
    btn.textContent = `üìù Review ${mistakes.length} Mistake${mistakes.length > 1 ? 's' : ''}`;
  } else {
    btn.classList.remove('show');
  }
}

function getIncorrectAnswers() {
  const mistakes = [];
  MODULES.forEach((mod, mi) => {
    mod.slides.forEach((slide, si) => {
      if (slide.type === 'decision') {
        const did = `dec_${mi}_${si}`;
        const answer = gameState.answeredQuestions[did];
        if (answer) {
          const correct = slide.content.options.find(o => o.correct);
          const chosen = slide.content.options.find(o => o.letter === answer);
          if (chosen && !chosen.correct) {
            mistakes.push({
              module: mod.title,
              question: slide.content.question,
              scenario: slide.content.scenario,
              yourAnswer: chosen.text,
              correctAnswer: correct.text,
              explanation: slide.content.feedback.correct
            });
          }
        }
      }
      if (slide.type === 'quiz') {
        const qid = `quiz_${mi}_${si}`;
        const answer = gameState.answeredQuestions[qid];
        if (answer !== undefined) {
          const chosen = slide.content.options[answer];
          if (chosen && !chosen.correct) {
            const correct = slide.content.options.find(o => o.correct);
            mistakes.push({
              module: mod.title,
              question: slide.content.question,
              scenario: null,
              yourAnswer: chosen.text,
              correctAnswer: correct.text,
              explanation: slide.content.feedback.correct
            });
          }
        }
      }
    });
  });
  return mistakes;
}

function showReviewPanel() {
  const mistakes = getIncorrectAnswers();
  const content = document.getElementById('reviewContent');

  if (mistakes.length === 0) {
    content.innerHTML = '<p style="text-align:center;opacity:0.7;padding:2rem">No mistakes to review. Great job!</p>';
  } else {
    content.innerHTML = mistakes.map(m => `
      <div class="review-item">
        <div class="review-module">${m.module}</div>
        ${m.scenario ? `<div class="review-question" style="font-size:0.85rem;opacity:0.8;margin-bottom:0.5rem">${m.scenario}</div>` : ''}
        <div class="review-question">${m.question}</div>
        <div class="review-your-answer">‚ùå Your answer: ${m.yourAnswer}</div>
        <div class="review-correct-answer">‚úì Correct: ${m.correctAnswer}</div>
        <div class="review-explanation">${m.explanation}</div>
      </div>
    `).join('');
  }

  document.getElementById('reviewPanel').classList.add('show');
}

function closeReviewPanel() {
  document.getElementById('reviewPanel').classList.remove('show');
}

// ===== INIT =====
renderAll();
checkStreakWarning();
updateReviewButton();
</script>
</body>
</html>
