<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>عكس الأدلة: دورة التحليل التلوي</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&amp;family=Source+Sans+Pro:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
<style>
    :root {
      --navy: #1E2761;
      --deep-navy: #141B3D;
      --gold: #D4AF37;
      --cream: #FAF8F5;
      --light-cream: #FFFFFF;
      --text: #2D3748;
      --light-text: #718096;
      --red: #C53030;
      --green: #22c55e;
      --transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
      font-family: 'Source Sans Pro', sans-serif;
      background: var(--deep-navy);
      color: var(--cream);
    }

    /* ====== COURSE SHELL ====== */
    .course-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* ====== SIDEBAR NAV ====== */
    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, var(--deep-navy) 0%, #0a0f1a 100%);
      border-left: 1px solid rgba(212,175,55,0.2);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .sidebar-header h1 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.25rem;
    }

    .sidebar-header p {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
    }

    .module-list {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
    }

    .module-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      border-right: 3px solid transparent;
    }

    .module-item:hover {
      background: rgba(212,175,55,0.1);
    }

    .module-item.active {
      background: rgba(212,175,55,0.15);
      border-right-color: var(--gold);
    }

    .module-item.completed .module-number {
      background: var(--green);
      color: white;
    }

    .module-number {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .module-item.active .module-number {
      background: var(--gold);
      color: var(--navy);
    }

    .module-info {
      flex: 1;
      min-width: 0;
    }

    .module-title {
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .module-subtitle {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.7); /* Increased for WCAG AA contrast */
    }

    .sidebar-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(212,175,55,0.2);
      font-size: 0.75rem;
      color: rgba(255,255,255,0.4);
    }

    /* ====== MAIN CONTENT ====== */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .content-header {
      padding: 1rem 2rem;
      background: rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(212,175,55,0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .breadcrumb {
      font-size: 0.85rem;
      color: rgba(255,255,255,0.6);
    }

    .breadcrumb span {
      color: var(--gold);
    }

    .header-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      background: rgba(212,175,55,0.2);
      border-color: var(--gold);
    }

    .btn.primary {
      background: var(--gold);
      color: var(--navy);
      border-color: var(--gold);
      font-weight: 600;
    }

    .content-body {
      flex: 1;
      overflow: hidden;
      display: flex;
    }

    /* ====== SLIDES AREA ====== */
    .slides-container {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .module-slides {
      display: none;
      width: 100%;
      height: 100%;
    }

    .module-slides.active {
      display: block;
    }

    .slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start; /* Changed from center - prevents content clipping */
      align-items: center;
      padding: 2rem 2rem 4rem 2rem; /* Fixed padding instead of viewport units */
      padding-top: 3rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition), visibility var(--transition);
      overflow-y: auto; /* Allow scrolling if content is tall */
      overflow-x: hidden;
    }

    /* Center content vertically only when there's enough space */
    .slide .content,
    .slide .refrain,
    .slide .title {
      margin-top: auto;
      margin-bottom: auto;
    }

    /* Ensure content doesn't overflow horizontally */
    .slide > * {
      max-width: 100%;
      word-wrap: break-word;
    }

    .slide.active {
      opacity: 1;
      visibility: visible;
    }

    .slide.dark { background: var(--deep-navy); color: var(--cream); }
    .slide.light { background: var(--cream); color: var(--text); }
    .slide.black { background: #000; color: var(--cream); }

    /* Typography */
    .serif { font-family: 'Cormorant Garamond', Georgia, serif; }

    .title {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 700;
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .title.navy { color: var(--navy); }
    .title.gold { color: var(--gold); }
    .title.cream { color: var(--cream); }

    .subtitle {
      font-size: clamp(1rem, 2vw, 1.5rem);
      color: var(--light-text);
      margin-bottom: 2rem;
    }

    .slide.dark .subtitle { color: rgba(255,255,255,0.7); }

    .big-number {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(4rem, 15vw, 10rem);
      font-weight: 700;
      line-height: 1;
    }

    .big-number.navy { color: var(--navy); }
    .big-number.gold { color: var(--gold); }

    .refrain {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      max-width: 800px;
    }

    /* Cards */
    .card {
      background: var(--light-cream);
      border: 1px solid var(--gold);
      padding: 1.5rem 2rem;
      margin: 0.75rem 0;
      max-width: 800px;
      width: 100%;
    }

    .card.navy-bg {
      background: var(--navy);
      color: var(--cream);
    }

    .card.red-border { border: 2px solid var(--red); }

    .card-label {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .card-text {
      font-size: clamp(0.9rem, 1.8vw, 1.1rem);
    }

    .card.navy-bg .card-text { color: var(--cream); }

    /* Stats grid */
    .stats-grid {
      display: flex;
      gap: 1rem;
      margin: 1.5rem 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .stat-box {
      background: var(--navy);
      color: var(--cream);
      padding: 1rem 1.5rem;
      text-align: center;
      min-width: 140px;
    }

    .stat-value {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 700;
    }

    .stat-label {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-top: 0.25rem;
    }

    /* Design grid */
    .design-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      max-width: 900px;
      width: 100%;
    }

    @media (max-width: 768px) {
      .design-grid { grid-template-columns: repeat(2, 1fr); }
    }

    .design-item {
      background: var(--light-cream);
      border-right: 3px solid var(--gold);
      padding: 1rem;
    }

    .design-item-label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }

    .design-item-value {
      font-size: 0.85rem;
      color: var(--text);
      line-height: 1.4;
    }

    /* Results table */
    .results-table {
      width: 100%;
      max-width: 700px;
      border-collapse: collapse;
      margin: 1rem 0;
    }

    .results-table th {
      background: var(--navy);
      color: var(--cream);
      padding: 0.75rem 1rem;
      text-align: right;
      font-weight: 600;
    }

    .results-table th:not(:first-child) { text-align: center; }

    .results-table td {
      padding: 0.6rem 1rem;
      border-bottom: 1px solid #E2E8F0;
    }

    .results-table td:not(:first-child) { text-align: center; }
    .results-table .highlight { color: var(--red); font-weight: 700; }

    /* Result box */
    .result-box {
      background: var(--navy);
      padding: 1rem 2rem;
      text-align: center;
      margin: 1rem 0;
      max-width: 500px;
    }

    .result-box .value {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 700;
      color: var(--gold);
    }

    .result-box .label {
      font-size: 0.9rem;
      color: var(--cream);
      margin-top: 0.25rem;
    }

    /* Lesson items */
    .lesson-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin: 0.75rem 0;
      max-width: 800px;
    }

    .lesson-number {
      background: var(--gold);
      color: var(--navy);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }

    .lesson-content h4 {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .lesson-content p {
      font-size: 0.9rem;
      color: var(--light-text);
    }

    /* Gold line */
    .gold-line {
      width: 150px;
      height: 2px;
      background: var(--gold);
      margin: 1.5rem auto;
    }

    /* Closing lines */
    .closing-line {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.2rem, 2.5vw, 1.75rem);
      margin: 0.5rem 0;
      text-align: center;
    }

    .closing-line.gold { color: var(--gold); font-weight: 700; }
    .closing-line.italic { font-style: italic; opacity: 0.9; }

    /* Focus box */
    .focus-box {
      background: var(--navy);
      padding: 1rem 2rem;
      text-align: center;
      max-width: 600px;
    }

    .focus-box .main {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem;
      font-style: italic;
      color: var(--gold);
    }

    .focus-box .sub {
      font-size: 0.9rem;
      color: var(--cream);
      margin-top: 0.5rem;
    }

    /* Arrow */
    .arrow { color: var(--light-text); font-size: 1.2rem; margin: 0.25rem 0; }
    .footnote { font-size: 0.75rem; color: var(--light-text); font-style: italic; text-align: center; margin-top: 1rem; }
    .red { color: var(--red); }
    .text-center { text-align: center; }
    .mb-1 { margin-bottom: 1rem; }
    .mb-2 { margin-bottom: 2rem; }
    .mt-1 { margin-top: 1rem; }
    .mt-2 { margin-top: 2rem; }

    /* Content wrapper */
    .content {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 1000px;
    }

    /* Animation */
    .slide.active .animate { animation: fadeUp 0.6s ease-out forwards; }
    .slide.active .animate.delay-1 { animation-delay: 0.1s; }
    .slide.active .animate.delay-2 { animation-delay: 0.2s; }
    .slide.active .animate.delay-3 { animation-delay: 0.3s; }
    .slide.active .animate.delay-4 { animation-delay: 0.4s; }
    .slide.active .animate.delay-5 { animation-delay: 0.5s; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate { opacity: 0; }

    /* ====== SLIDE NAV ====== */
    /* Minimal floating arrows - no background strip */
    .slide-nav {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      padding: 1rem 1rem 1.5rem 1rem;
      z-index: 100;
      pointer-events: none; /* Allow clicks through to content */
    }

    .nav-btn {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 1.25rem;
      cursor: pointer;
      opacity: 0.6;
      transition: all 0.2s;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      pointer-events: auto; /* Buttons are clickable */
    }

    .nav-btn:hover {
      opacity: 1;
      background: rgba(0,0,0,0.7);
      border-color: var(--gold);
    }
    .nav-btn:disabled { opacity: 0.2; cursor: not-allowed; }

    /* Center info (counter + progress) - compact */
    .nav-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      pointer-events: auto;
    }

    .slide-counter {
      font-size: 0.75rem;
      opacity: 0.6;
    }

    .progress { display: flex; gap: 4px; }

    .progress-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(255,255,255,0.25);
      cursor: pointer;
      transition: all 0.2s;
    }

    .progress-dot.active {
      background: var(--gold);
      transform: scale(1.3);
    }

    .progress-dot:hover {
      background: rgba(255,255,255,0.5);
    }

    .progress-dot:hover { background: rgba(255,255,255,0.6); }

    .slide-counter {
      color: rgba(255,255,255,0.6);
      font-size: 0.85rem;
      min-width: 50px;
      text-align: center;
    }

    /* ====== TOOLS PANEL ====== */
    .tools-panel {
      width: 380px;
      max-width: 40vw; /* Limit to 40% of viewport so content isn't squeezed too much */
      background: var(--cream);
      border-right: 1px solid rgba(0,0,0,0.1);
      display: none; /* Hidden by default */
      flex-direction: column;
      flex-shrink: 0;
      overflow-y: auto;
    }

    .tools-panel.visible {
      display: flex;
    }

    .tools-panel.collapsed {
      width: 50px;
    }

    /* Adjust slide padding when tools panel is open */
    .content-body.tools-open .slide {
      padding-right: 1.5rem;
      padding-right: 1.5rem;
    }

    .content-body.tools-open .slide .content {
      max-width: 100%;
    }

    .tools-header {
      padding: 1rem;
      background: var(--navy);
      color: var(--cream);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tools-header h3 {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .tools-content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    /* Live Story Data Panel */
    .story-data-panel {
      background: linear-gradient(135deg, #1E2761 0%, #141B3D 100%);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      color: white;
    }

    .story-data-panel h4 {
      color: var(--gold);
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .story-toggle {
      display: flex;
      background: rgba(255,255,255,0.1);
      border-radius: 25px;
      padding: 4px;
      margin-bottom: 1rem;
    }

    .story-toggle button {
      flex: 1;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 20px;
      background: transparent;
      color: rgba(255,255,255,0.7);
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .story-toggle button.active {
      background: var(--gold);
      color: var(--navy);
    }

    .story-toggle button:hover:not(.active) {
      background: rgba(255,255,255,0.15);
      color: white;
    }

    .story-viz {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      min-height: 200px;
      transition: all 0.5s ease;
    }

    .story-viz svg {
      transition: all 0.5s ease;
    }

    .story-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }

    .story-metric {
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .story-metric.highlight-good {
      background: rgba(34, 197, 94, 0.3);
      border: 1px solid rgba(34, 197, 94, 0.5);
    }

    .story-metric.highlight-bad {
      background: rgba(197, 48, 48, 0.3);
      border: 1px solid rgba(197, 48, 48, 0.5);
    }

    .story-metric .value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
    }

    .story-metric .label {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.7);
      margin-top: 0.25rem;
    }

    .story-insight {
      background: rgba(212,175,55,0.2);
      border-right: 3px solid var(--gold);
      padding: 0.75rem;
      border-radius: 0 8px 8px 0;
      margin-top: 0.75rem;
      font-size: 0.75rem;
      line-height: 1.5;
    }

    /* ====== PREDICT FIRST INTERFACE ====== */
    .predict-first-panel {
      background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(30,39,97,0.3));
      border: 1px solid var(--gold);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      margin-top: 0.5rem;
    }

    .predict-first-panel .predict-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .predict-first-panel h4 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .predict-first-panel p {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.9);
      line-height: 1.4;
    }

    .predict-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .predict-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      border: 2px solid;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(0,0,0,0.2);
    }

    .predict-btn.benefit {
      border-color: #22c55e;
      color: #22c55e;
    }

    .predict-btn.benefit:hover {
      background: rgba(34,197,94,0.2);
    }

    .predict-btn.neutral {
      border-color: #94a3b8;
      color: #94a3b8;
    }

    .predict-btn.neutral:hover {
      background: rgba(148,163,184,0.2);
    }

    .predict-btn.harm {
      border-color: #ef4444;
      color: #ef4444;
    }

    .predict-btn.harm:hover {
      background: rgba(239,68,68,0.2);
    }

    .predict-icon-small {
      font-size: 1rem;
    }

    /* Prediction Feedback */
    .prediction-feedback {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .prediction-feedback.correct {
      background: rgba(34,197,94,0.2);
      border: 1px solid #22c55e;
      color: #22c55e;
    }

    .prediction-feedback.incorrect {
      background: rgba(239,68,68,0.15);
      border: 1px solid #ef4444;
      color: #fca5a5;
    }

    .feedback-icon {
      font-size: 1rem;
    }

    /* ====== PROGRESS DASHBOARD ====== */
    .progress-dashboard {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(5px);
      z-index: 2000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .progress-dashboard.open {
      display: flex;
    }

    .dashboard-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 1px solid var(--gold);
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(212,175,55,0.3);
    }

    .dashboard-header h2 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1.3rem;
    }

    .dashboard-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      opacity: 0.7;
    }

    .dashboard-close:hover { opacity: 1; }

    .level-display {
      background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(212,175,55,0.05));
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .level-badge {
      display: inline-block;
      background: var(--gold);
      color: var(--navy);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.8rem;
      margin-bottom: 0.5rem;
    }

    .points-display {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--gold);
    }

    .points-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .stat-card {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--gold);
    }

    .stat-label {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.6);
      margin-top: 0.25rem;
    }

    .principles-section h3, .badges-section h3, .streak-section h3 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .principle-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem;
      background: rgba(255,255,255,0.03);
      border-radius: 6px;
      margin-bottom: 0.35rem;
    }

    .principle-num {
      width: 20px;
      height: 20px;
      background: rgba(212,175,55,0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      color: var(--gold);
      flex-shrink: 0;
    }

    .principle-num.mastered {
      background: var(--gold);
      color: var(--navy);
    }

    .principle-text {
      flex: 1;
      font-size: 0.7rem;
      color: rgba(255,255,255,0.8);
    }

    .badges-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .badge {
      width: 44px;
      height: 44px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      opacity: 0.3;
      position: relative;
    }

    .badge.earned {
      opacity: 1;
      background: rgba(212,175,55,0.2);
      border-color: var(--gold);
    }

    .badge-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--navy);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.6rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .badge:hover .badge-tooltip {
      opacity: 1;
    }

    .streak-display {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
    }

    .streak-flame { font-size: 2rem; }

    .streak-count {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--gold);
    }

    .streak-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
    }

    .dashboard-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.6rem 0.75rem;
      background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.05));
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      color: var(--gold);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 0.5rem;
    }

    .dashboard-btn:hover {
      background: linear-gradient(135deg, rgba(212,175,55,0.25), rgba(212,175,55,0.1));
      border-color: var(--gold);
    }

    /* ====== DAILY REVIEW MODAL ====== */
    .daily-review-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 1rem;
    }

    .daily-review-modal.open {
      display: flex;
    }

    .daily-review-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 2px solid var(--gold);
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .daily-review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(212,175,55,0.3);
    }

    .daily-review-header h2 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1.5rem;
      margin: 0;
    }

    .daily-review-close {
      background: none;
      border: none;
      color: rgba(255,255,255,0.6);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .daily-review-close:hover {
      color: white;
    }

    .review-timer {
      text-align: center;
      margin-bottom: 1rem;
    }

    .timer-display {
      font-size: 2rem;
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
    }

    .timer-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    .review-progress {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      transition: all 0.3s;
    }

    .progress-dot.current {
      background: var(--gold);
      transform: scale(1.2);
    }

    .progress-dot.completed {
      background: #22c55e;
    }

    .review-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(212,175,55,0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .review-principle-num {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(212,175,55,0.2);
      border-radius: 50%;
      color: var(--gold);
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .review-principle-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.25rem;
      color: var(--cream);
      font-style: italic;
      margin-bottom: 1rem;
    }

    .review-question {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
    }

    .review-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .review-option {
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      text-align: right;
      font-size: 0.85rem;
    }

    .review-option:hover {
      background: rgba(212,175,55,0.15);
      border-color: var(--gold);
    }

    .review-option.correct {
      background: rgba(34,197,94,0.2);
      border-color: #22c55e;
    }

    .review-option.incorrect {
      background: rgba(239,68,68,0.2);
      border-color: #ef4444;
    }

    .review-option.selected {
      border-width: 2px;
    }

    .review-feedback {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .review-feedback.correct {
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.3);
      color: #86efac;
    }

    .review-feedback.incorrect {
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.3);
      color: #fca5a5;
    }

    .review-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      margin-top: 1rem;
    }

    .review-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .review-btn.skip {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: rgba(255,255,255,0.6);
    }

    .review-btn.skip:hover {
      border-color: rgba(255,255,255,0.5);
      color: white;
    }

    .review-btn.next {
      background: var(--gold);
      border: none;
      color: var(--navy);
      font-weight: 600;
    }

    .review-btn.next:hover {
      background: #e6c94a;
    }

    .review-summary {
      text-align: center;
    }

    .summary-score {
      font-size: 3rem;
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
    }

    .summary-text {
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
    }

    .summary-breakdown {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin: 1rem 0;
    }

    .summary-stat {
      text-align: center;
    }

    .summary-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .summary-stat-value.correct-val { color: #22c55e; }
    .summary-stat-value.incorrect-val { color: #ef4444; }

    .summary-stat-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    .review-streak-bonus {
      margin-top: 1rem;
      padding: 0.75rem;
      background: rgba(212,175,55,0.15);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .review-streak-bonus .flame { font-size: 1.5rem; }
    .review-streak-bonus .text { color: var(--gold); font-size: 0.9rem; }

    .daily-review-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.5rem 0.75rem;
      background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.05));
      border: 1px solid rgba(34,197,94,0.3);
      border-radius: 6px;
      color: #86efac;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 0.75rem;
    }

    .daily-review-btn:hover {
      background: linear-gradient(135deg, rgba(34,197,94,0.25), rgba(34,197,94,0.1));
      border-color: #22c55e;
    }

    .daily-review-btn.pending {
      animation: gentlePulse 2s infinite;
    }

    @keyframes gentlePulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(34,197,94,0.3); }
      50% { box-shadow: 0 0 0 6px rgba(34,197,94,0); }
    }

    /* ====== BRANCHING SCENARIOS ====== */
    .scenario-panel {
      background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(30,39,97,0.2));
      border: 2px solid rgba(124,58,237,0.4);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .scenario-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .scenario-icon { font-size: 1.5rem; }
    .scenario-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      color: #7C3AED;
      font-weight: 600;
    }

    .scenario-situation {
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--navy);
    }

    .scenario-question {
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--navy);
    }

    .scenario-choices {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .scenario-choice {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.8);
      border: 2px solid rgba(124,58,237,0.2);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .scenario-choice:hover:not(.answered) { background: rgba(124,58,237,0.1); border-color: rgba(124,58,237,0.5); }
    .scenario-choice.selected { border-color: #7C3AED; background: rgba(124,58,237,0.15); }
    .scenario-choice.correct { border-color: #22c55e; background: rgba(34,197,94,0.15); }
    .scenario-choice.incorrect { border-color: #ef4444; background: rgba(239,68,68,0.1); }

    .choice-letter {
      min-width: 24px; height: 24px; border-radius: 50%;
      background: rgba(124,58,237,0.2); color: #7C3AED;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 0.8rem;
    }
    .scenario-choice.correct .choice-letter { background: #22c55e; color: white; }
    .scenario-choice.incorrect .choice-letter { background: #ef4444; color: white; }
    .choice-text { flex: 1; font-size: 0.9rem; color: var(--navy); }

    .scenario-consequence {
      margin-top: 1rem; padding: 1rem; border-radius: 10px; display: none;
    }
    .scenario-consequence.visible { display: block; }
    .scenario-consequence.good { background: rgba(34,197,94,0.15); border: 1px solid rgba(34,197,94,0.3); }
    .scenario-consequence.bad { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); }
    .scenario-consequence.neutral { background: rgba(217,119,6,0.1); border: 1px solid rgba(217,119,6,0.3); }

    .consequence-title { font-weight: 700; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
    .scenario-consequence.good .consequence-title { color: #059669; }
    .scenario-consequence.bad .consequence-title { color: #dc2626; }
    .scenario-consequence.neutral .consequence-title { color: #d97706; }
    .consequence-text { font-size: 0.9rem; line-height: 1.5; }
    .consequence-lesson { margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed currentColor; font-style: italic; opacity: 0.9; }

    /* ====== CONFIDENCE CALIBRATION ====== */
    .confidence-section {
      margin-top: 1rem; padding: 0.75rem;
      background: rgba(212,175,55,0.1); border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);
    }
    .confidence-label { font-size: 0.8rem; color: var(--gold); margin-bottom: 0.5rem; }
    .confidence-slider-container { display: flex; align-items: center; gap: 0.75rem; }
    .confidence-slider {
      flex: 1; -webkit-appearance: none; height: 6px; border-radius: 3px;
      background: linear-gradient(to right, #ef4444, #eab308, #22c55e); outline: none;
    }
    .confidence-slider::-webkit-slider-thumb {
      -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: white; border: 2px solid var(--gold); cursor: pointer;
    }
    .confidence-value { min-width: 45px; font-size: 0.85rem; font-weight: 700; color: var(--gold); }
    .confidence-labels { display: flex; justify-content: space-between; font-size: 0.65rem; color: rgba(255,255,255,0.6); margin-top: 0.25rem; }

    /* ====== ANALOGY SYSTEM ====== */
    .analogy-card {
      background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(30,39,97,0.1));
      border: 1px solid rgba(212,175,55,0.4);
      border-radius: 12px;
      padding: 1rem;
      margin: 1rem 0;
    }
    .analogy-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
    .analogy-icon { font-size: 1.25rem; }
    .analogy-title { font-weight: 600; color: var(--gold); font-size: 0.9rem; }
    .analogy-concept { font-size: 0.75rem; color: rgba(255,255,255,0.6); }
    .analogy-text { font-size: 0.9rem; line-height: 1.5; font-style: italic; }

    /* ====== MISCONCEPTION CHALLENGE ====== */
    .misconception-challenge {
      background: linear-gradient(135deg, rgba(239,68,68,0.08), rgba(30,39,97,0.12));
      border: 2px solid rgba(239,68,68,0.25);
      border-radius: 12px;
      padding: 1.25rem;
      margin: 1rem 0;
    }
    .misconception-header { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: #dc2626; margin-bottom: 0.75rem; }
    .misconception-statement {
      font-size: 1rem; font-style: italic; color: var(--navy);
      margin-bottom: 1rem; padding: 0.75rem; background: rgba(255,255,255,0.85); border-radius: 8px;
    }
    .misconception-buttons { display: flex; gap: 0.75rem; justify-content: center; }
    .misconception-btn {
      padding: 0.6rem 1.5rem; border-radius: 8px; font-weight: 600;
      cursor: pointer; transition: all 0.2s; border: 2px solid;
    }
    .misconception-btn.true-btn { background: rgba(34,197,94,0.1); border-color: #22c55e; color: #059669; }
    .misconception-btn.false-btn { background: rgba(239,68,68,0.1); border-color: #ef4444; color: #dc2626; }
    .misconception-btn:hover { transform: scale(1.05); }
    .misconception-btn.correct { background: #22c55e; color: white; border-color: #22c55e; }
    .misconception-btn.wrong { background: #ef4444; color: white; border-color: #ef4444; }
    .misconception-result { margin-top: 1rem; padding: 0.75rem; border-radius: 8px; display: none; }
    .misconception-result.visible { display: block; }
    .misconception-result.correct { background: rgba(34,197,94,0.15); color: #059669; }
    .misconception-result.incorrect { background: rgba(239,68,68,0.1); color: #dc2626; }

    /* ====== PRACTICE PROBLEMS ====== */
    .practice-problem {
      background: linear-gradient(135deg, rgba(15,91,106,0.08), rgba(30,39,97,0.12));
      border: 2px solid rgba(15,91,106,0.3);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .practice-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .practice-category {
      background: rgba(15,91,106,0.2);
      color: #0f5b6a;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .practice-title {
      font-weight: 700;
      color: var(--navy);
      font-size: 1.1rem;
    }
    .practice-scenario {
      background: rgba(255,255,255,0.9);
      padding: 1rem;
      border-radius: 10px;
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--text);
      margin-bottom: 1rem;
    }
    .practice-question {
      color: var(--navy);
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    .practice-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .practice-option {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.95);
      border: 2px solid rgba(30,39,97,0.15);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: right;
      font-family: inherit;
      font-size: 0.9rem;
    }
    .practice-option:hover:not(:disabled) {
      border-color: var(--navy);
      transform: translateX(-4px);
    }
    .practice-option .option-letter {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--navy);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.8rem;
      flex-shrink: 0;
    }
    .practice-option.correct {
      border-color: #22c55e;
      background: rgba(34,197,94,0.1);
    }
    .practice-option.correct .option-letter {
      background: #22c55e;
    }
    .practice-option.incorrect {
      border-color: #ef4444;
      background: rgba(239,68,68,0.08);
    }
    .practice-option.incorrect .option-letter {
      background: #ef4444;
    }
    .practice-option:disabled {
      cursor: default;
      opacity: 0.8;
    }
    .practice-feedback {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 10px;
      display: none;
      line-height: 1.6;
    }
    .practice-feedback.visible {
      display: block;
    }
    .practice-feedback.correct {
      background: rgba(34,197,94,0.12);
      border: 1px solid rgba(34,197,94,0.3);
      color: #047857;
    }
    .practice-feedback.incorrect {
      background: rgba(239,68,68,0.08);
      border: 1px solid rgba(239,68,68,0.2);
      color: #b91c1c;
    }
    .practice-feedback p {
      margin: 0.5rem 0;
    }
    .practice-feedback .principle-link {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(0,0,0,0.1);
      font-size: 0.85rem;
      color: var(--navy);
    }

    .story-insight strong {
      color: var(--gold);
    }

    .no-story-data {
      text-align: center;
      padding: 2rem 1rem;
      color: rgba(255,255,255,0.5);
      font-size: 0.8rem;
    }

    @keyframes pulseGold {
      0%, 100% { box-shadow: 0 0 0 0 rgba(212,175,55,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(212,175,55,0); }
    }

    .story-data-panel.updating {
      animation: pulseGold 0.5s ease;
    }

    .tool-section {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .tool-section-header {
      padding: 0.75rem 1rem;
      background: #f7fafc;
      border-bottom: 1px solid #e2e8f0;
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--navy);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tool-section-body {
      padding: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(212,175,55,0.2);
    }

    .btn-small {
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #e2e8f0;
      background: white;
      color: var(--text);
    }

    .btn-small.primary {
      background: var(--navy);
      color: white;
      border-color: var(--navy);
    }

    /* Study input table */
    .study-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .study-table th,
    .study-table td {
      padding: 0.4rem;
      border: 1px solid #e2e8f0;
      text-align: center;
    }

    .study-table th {
      background: #f7fafc;
      font-weight: 600;
    }

    .study-table input {
      width: 100%;
      padding: 0.25rem;
      border: 1px solid #e2e8f0;
      border-radius: 2px;
      font-size: 0.75rem;
      text-align: center;
    }

    /* Results display */
    .results-display {
      background: #f7fafc;
      border-radius: 6px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      padding: 0.4rem 0;
      font-size: 0.8rem;
      border-bottom: 1px solid #e2e8f0;
    }

    .result-row:last-child { border-bottom: none; }
    .result-row .label { color: var(--light-text); }
    .result-row .value { font-weight: 600; color: var(--navy); }

    /* Forest plot container */
    .forest-plot-container {
      margin-top: 1rem;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 1rem;
      overflow-x: auto;
    }

    /* Hide tools panel on small screens */
    @media (max-width: 1200px) {
      .tools-panel { display: none; }
      .sidebar { width: 60px; }
      .sidebar .module-info,
      .sidebar .sidebar-header p,
      .sidebar .sidebar-footer { display: none; }
      .sidebar .sidebar-header h1 { font-size: 1rem; }
    }

    /* Leap badge */
    .leap-badge {
      background: var(--red);
      color: white;
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      font-weight: 700;
      position: absolute;
      right: -10px;
      top: 50%;
      transform: translateY(-50%);
    }

    .card-wrapper {
      position: relative;
      max-width: 800px;
      width: 100%;
    }

    /* Wrong items */
    .wrong-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      background: var(--light-cream);
      padding: 1rem;
      margin: 0.5rem 0;
      max-width: 800px;
      width: 100%;
    }

    .wrong-number {
      background: var(--navy);
      color: var(--cream);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    /* Quiz styles */
    .quiz-container {
      max-width: 700px;
      width: 100%;
    }

    .quiz-question {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
    }

    .quiz-question h4 {
      font-size: 1rem;
      color: var(--navy);
      margin-bottom: 1rem;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .quiz-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      /* Accessibility: make focusable for keyboard nav */
      padding: 0.75rem 1rem;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quiz-option:hover {
      background: #f7fafc;
      border-color: var(--gold);
    }

    .quiz-option.selected {
      background: rgba(212,175,55,0.1);
      border-color: var(--gold);
    }

    .quiz-option.correct {
      background: rgba(34,197,94,0.1);
      border-color: var(--green);
    }

    .quiz-option.incorrect {
      background: rgba(197,48,48,0.1);
      border-color: var(--red);
    }

    /* RoB Domain Styles */
    .rob-domains {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .rob-domain {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .rob-domain label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text);
    }

    .rob-domain select {
      padding: 0.4rem;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 0.8rem;
    }

    /* GRADE factor styles */
    .grade-factors .form-group label {
      font-size: 0.75rem;
      color: var(--text);
    }

    .grade-factors select {
      font-size: 0.75rem;
    }

    /* Red text utility */
    .result-row .value.red {
      color: var(--red);
      font-weight: 700;
    }

    /* Interactive Investigation Exercises */
    .investigation-box {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 900px;
      width: 100%;
      margin: 1rem 0;
    }

    .investigation-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      color: var(--gold);
    }

    .investigation-header .icon {
      font-size: 1.5rem;
    }

    .investigation-header h3 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0;
    }

    .investigation-prompt {
      font-style: italic;
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
      font-size: 1.05rem;
      line-height: 1.5;
    }

    .data-table-investigation {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: 0.85rem;
    }

    .data-table-investigation th,
    .data-table-investigation td {
      padding: 0.5rem 0.75rem;
      border: 1px solid rgba(212,175,55,0.3);
      text-align: center;
      color: var(--cream);
    }

    .data-table-investigation th {
      background: rgba(212,175,55,0.2);
      color: var(--gold);
      font-weight: 600;
    }

    .data-table-investigation tr:nth-child(even) {
      background: rgba(255,255,255,0.05);
    }

    .reveal-btn {
      background: var(--gold);
      color: var(--navy);
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
      transition: all 0.2s;
    }

    .reveal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(212,175,55,0.3);
    }

    .hidden-reveal {
      display: none;
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(197,48,48,0.1);
      border-right: 3px solid var(--red);
      color: var(--cream);
    }

    .hidden-reveal.visible {
      display: block;
      animation: fadeUp 0.4s ease-out;
    }

    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 1rem 0;
    }

    .comparison-panel {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .comparison-panel h4 {
      color: var(--gold);
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .comparison-panel.after {
      border-color: var(--red);
    }

    .comparison-panel.after h4 {
      color: var(--red);
    }

    /* Rhetorical question styling */
    .rhetorical {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.3rem, 3vw, 1.8rem);
      font-style: italic;
      color: rgba(255,255,255,0.9);
      text-align: center;
      max-width: 700px;
      margin: 1rem 0;
    }

    /* Direct address styling */
    .direct-address {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.2rem;
      color: var(--gold);
      border-right: 3px solid var(--gold);
      padding-right: 1rem;
      margin: 1rem 0;
      font-style: italic;
    }

    /* Mini forest plot for exercises */
    .mini-forest {
      background: white;
      border-radius: 8px;
      padding: 0.75rem;
      margin-top: 0.5rem;
    }

    /* ============================================================
       ACCESSIBILITY IMPROVEMENTS
       ============================================================ */

    /* Focus states for keyboard navigation */
    *:focus {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }

    *:focus:not(:focus-visible) {
      outline: none;
    }

    *:focus-visible {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }

    .quiz-option:focus-visible,
    .btn:focus-visible,
    .module-item:focus-visible,
    .nav-btn:focus-visible {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }

    /* Skip to content link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--gold);
      color: var(--navy);
      padding: 8px 16px;
      z-index: 1000;
      font-weight: 600;
      text-decoration: none;
      border-radius: 0 0 4px 0;
    }

    .skip-link:focus {
      top: 0;
    }

    /* Screen reader only text */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Improved color contrast for accessibility */
    .light-text-accessible {
      color: #a0aec0; /* Lighter for better contrast on dark */
    }

    /* ============================================================
       MOBILE RESPONSIVE (< 768px)
       ============================================================ */

    .mobile-menu-btn {
      display: none;
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1001;
      background: var(--gold);
      color: var(--navy);
      border: none;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      font-size: 1.2rem;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: block;
      }

      .sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        height: 100vh;
        z-index: 1000;
        transition: left 0.3s ease;
      }

      .sidebar.open {
        left: 0;
      }

      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
      }

      .sidebar-overlay.open {
        display: block;
      }

      .content-header {
        padding-right: 4rem;
      }

      .tools-panel {
        width: 100%;
        right: -100%;
      }

      .tools-panel.open {
        right: 0;
      }

      .slide .content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
    }

    /* ============================================================
       GLOSSARY PANEL
       ============================================================ */

    .glossary-btn {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      background: var(--navy);
      color: var(--gold);
      border: 2px solid var(--gold);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .glossary-btn:hover {
      background: var(--gold);
      color: var(--navy);
    }

    /* Story Data Indicator Button */
    .story-indicator-btn {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background: linear-gradient(135deg, #1E2761 0%, #141B3D 100%);
      color: var(--gold);
      border: 2px solid var(--gold);
      border-radius: 25px;
      padding: 0.5rem 1rem;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      z-index: 100;
      display: none;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .story-indicator-btn.visible {
      display: flex;
    }

    .story-indicator-btn:hover {
      background: var(--gold);
      color: var(--navy);
      transform: translateY(-2px);
    }

    .story-indicator-btn.pulse {
      animation: pulseBtn 2s infinite;
    }

    @keyframes pulseBtn {
      0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 0 0 rgba(212,175,55,0.4); }
      50% { box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 0 8px rgba(212,175,55,0); }
    }

    .story-indicator-dot {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .glossary-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 0;
      background: var(--deep-navy);
      border-top: 2px solid var(--gold);
      z-index: 999;
      overflow: hidden;
      transition: height 0.3s ease;
    }

    .glossary-panel.open {
      height: 50vh;
    }

    .glossary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .glossary-header h3 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
    }

    .glossary-close {
      background: none;
      border: none;
      color: var(--cream);
      font-size: 1.5rem;
      cursor: pointer;
    }

    .glossary-search {
      padding: 0.75rem 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .glossary-search input {
      width: 100%;
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.9rem;
    }

    .glossary-content {
      padding: 1rem 1.5rem;
      overflow-y: auto;
      height: calc(50vh - 120px);
    }

    .glossary-term {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .glossary-term dt {
      color: var(--gold);
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
    }

    .glossary-term dd {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* ============================================================
       KEYBOARD SHORTCUTS HELP
       ============================================================ */

    .keyboard-help {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--deep-navy);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 2rem;
      z-index: 1001;
      display: none;
      min-width: 300px;
      max-width: 90vw;
    }

    .keyboard-help.open {
      display: block;
    }

    .keyboard-help h3 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      margin-bottom: 1rem;
      text-align: center;
    }

    .keyboard-help-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .keyboard-help-key {
      background: rgba(255,255,255,0.1);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.85rem;
    }

    /* ============================================================
       LEARNING OBJECTIVES BOX
       ============================================================ */

    .learning-objectives {
      background: rgba(212,175,55,0.1);
      border: 1px solid var(--gold);
      border-radius: 8px;
      padding: 1rem 1.5rem;
      margin: 1rem 0;
      max-width: 700px;
    }

    .learning-objectives h4 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .learning-objectives ul {
      margin: 0;
      padding-right: 1.25rem;
    }

    .learning-objectives li {
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    /* ============================================================
       DECISION TREE STORIES (Quranic Storytelling)
       ============================================================ */

    .story-box {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid var(--gold);
      border-radius: 16px;
      padding: 2rem;
      max-width: 900px;
      width: 100%;
      margin: 1rem 0;
    }

    .story-opener {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.4rem, 3vw, 2rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      margin-bottom: 1.5rem;
      line-height: 1.4;
    }

    .story-opener::before {
      content: '"';
      font-size: 1.5em;
      opacity: 0.5;
    }

    .story-opener::after {
      content: '"';
      font-size: 1.5em;
      opacity: 0.5;
    }

    .real-data-box {
      background: rgba(255,255,255,0.05);
      border-right: 4px solid #3b82f6;
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      border-radius: 0 8px 8px 0;
    }

    .real-data-box h4 {
      color: #60a5fa;
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .real-data-box h4::before {
      content: '📊';
    }

    .real-data-box p {
      color: var(--cream);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .real-data-box .data-highlight {
      color: var(--gold);
      font-weight: 700;
    }

    .decision-tree {
      background: rgba(212,175,55,0.1);
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .decision-tree-header {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.2rem;
      color: var(--gold);
      margin-bottom: 1rem;
      text-align: center;
      font-weight: 600;
    }

    .decision-scenario {
      background: rgba(0,0,0,0.3);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-style: italic;
      color: rgba(255,255,255,0.9);
      text-align: center;
    }

    .decision-paths {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    @media (max-width: 768px) {
      .decision-paths {
        grid-template-columns: 1fr;
      }
    }

    .decision-path {
      padding: 1.25rem;
      border-radius: 8px;
      position: relative;
    }

    .decision-path.path-a {
      background: rgba(197, 48, 48, 0.15);
      border: 2px solid rgba(197, 48, 48, 0.5);
    }

    .decision-path.path-b {
      background: rgba(34, 197, 94, 0.15);
      border: 2px solid rgba(34, 197, 94, 0.5);
    }

    .path-label {
      font-weight: 700;
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .decision-path.path-a .path-label {
      color: #f87171;
    }

    .decision-path.path-b .path-label {
      color: #4ade80;
    }

    .path-choice {
      font-size: 0.95rem;
      color: var(--cream);
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .path-arrow {
      color: rgba(255,255,255,0.5);
      text-align: center;
      margin: 0.5rem 0;
      font-size: 1.2rem;
    }

    .path-consequence {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      line-height: 1.5;
    }

    .path-outcome {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255,255,255,0.2);
      font-weight: 700;
    }

    .decision-path.path-a .path-outcome {
      color: #f87171;
    }

    .decision-path.path-b .path-outcome {
      color: #4ade80;
    }

    .decision-path:focus {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }

    .story-revelation {
      background: linear-gradient(135deg, rgba(212,175,55,0.3), rgba(212,175,55,0.1));
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 1.5rem;
      text-align: center;
    }

    .revelation-label {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.15em;
      margin-bottom: 0.75rem;
    }

    .revelation-text {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.1rem, 2.5vw, 1.4rem);
      color: var(--cream);
      line-height: 1.5;
      font-weight: 600;
    }

    .story-timeline {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }

    .timeline-point {
      background: rgba(255,255,255,0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      color: rgba(255,255,255,0.8);
    }

    .timeline-point.critical {
      background: rgba(197, 48, 48, 0.3);
      border: 1px solid rgba(197, 48, 48, 0.5);
      color: #fca5a5;
    }

    .timeline-point.resolution {
      background: rgba(34, 197, 94, 0.3);
      border: 1px solid rgba(34, 197, 94, 0.5);
      color: #86efac;
    }

    /* ============================================================
       REDUCED MOTION (Accessibility)
       ============================================================ */

    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }

      .animate {
        animation: none !important;
        opacity: 1 !important;
      }

      .slide {
        transition: none !important;
      }
    }

    /* ============================================================
       PRINT STYLESHEET
       ============================================================ */

    @media print {
      .sidebar,
      .content-header,
      .slide-nav,
      .tools-panel,
      .glossary-btn,
      .glossary-panel,
      .mobile-menu-btn,
      .keyboard-help,
      .btn,
      .nav-btn,
      .reveal-btn {
        display: none !important;
      }

      .course-container {
        display: block;
        height: auto;
      }

      .main-content {
        display: block;
      }

      .content-body {
        display: block;
      }

      .slides-container {
        display: block;
        height: auto;
        overflow: visible;
      }

      .module-slides {
        display: block !important;
      }

      .slide {
        display: block !important;
        page-break-inside: avoid;
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #ccc;
      }

      .slide.dark,
      .slide.black {
        background: white !important;
        color: black !important;
      }

      .slide.dark *,
      .slide.black * {
        color: black !important;
      }

      .refrain,
      .title {
        color: #1E2761 !important;
      }

      .gold-line {
        background: #D4AF37 !important;
      }

      body {
        background: white;
        color: black;
      }
    }
  </style>
</head>
<body>
 انتقل إلى رابط المحتوى لسهولة الوصول 
<a class="skip-link" href="#main-content">انتقل إلى المحتوى</a>
 زر قائمة الهاتف المحمول 
<button aria-expanded="false" aria-label="Toggle navigation menu" class="mobile-menu-btn" onclick="toggleSidebar()">☰</button>
 تراكب الشريط الجانبي المحمول 
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
 زر المسرد 
 مؤشر بيانات القصة 
<button aria-label="عرض بيانات القصة" class="story-indicator-btn pulse" id="storyIndicatorBtn" onclick="openToolsWithStory()">
<span class="story-indicator-dot"></span>
<span>📊 البيانات الحية المتاحة</span>
</button>
<button aria-label="Open glossary" class="glossary-btn" onclick="toggleGlossary()" title="Glossary (press G)">📖</button>
 لوحة المصطلحات 
<div aria-label="Glossary" class="glossary-panel" id="glossaryPanel" role="dialog">
<div class="glossary-header">
<h3>مسرد المصطلحات</h3>
<button aria-label="Close glossary" class="glossary-close" onclick="toggleGlossary()">×</button>
</div>
<div class="glossary-search">
<input aria-label="Search glossary" id="glossarySearch" onkeyup="filterGlossary()" placeholder="Search terms..." type="text"/>
</div>
<div class="glossary-content" id="glossaryContent">
<dl>
<div class="glossary-term" data-term="meta-analysis">
<dt>التحليل التلوي</dt>
<dd>طريقة إحصائية للجمع بين نتائج دراسات مستقلة متعددة تتناول نفس السؤال لإنتاج تقدير مجمع.</dd>
</div>
<div class="glossary-term" data-term="systematic review">
<dt>مراجعة منهجية</dt>
<dd>طريقة إحصائية شاملة مراجعة الأدبيات القابلة للتكرار والتي تستخدم طرقًا واضحة لتحديد واختيار وتقييم وتجميع جميع الدراسات ذات الصلة بسؤال محدد.</dd>
</div>
<div class="glossary-term" data-term="pico">
<dt>PICO</dt>
<dd>إطار صياغة الأسئلة السريرية: السكان، التدخل، المقارنة، النتيجة.</dd>
</div>
<div class="glossary-term" data-term="heterogeneity">
<dt>عدم التجانس</dt>
<dd>التباين في نتائج الدراسة بما يتجاوز ما يمكن توقعه عن طريق الصدفة. يتم القياس بإحصائيات I² وτ² وQ.</dd>
</div>
<div class="glossary-term" data-term="i-squared">
<dt>I² (I-مربع)</dt>
<dd>النسبة المئوية للتباين في تقديرات التأثير الذي يرجع إلى عدم التجانس بدلاً من خطأ أخذ العينات. 0-25%: منخفض، 25-50%: متوسط، 50-75%: كبير، 75-100%: كبير.</dd>
</div>
<div class="glossary-term" data-term="tau-squared">
<dt>τ² (مربع تاو)</dt>
<dd>التباين بين الدراسة في نموذج التأثيرات العشوائية. يقيس الحجم المطلق للتغايرية على مقياس حجم التأثير.</dd>
</div>
<div class="glossary-term" data-term="fixed effect">
<dt>نموذج التأثير الثابت</dt>
<dd>يفترض أن جميع الدراسات تقدر نفس التأثير الحقيقي. دراسات الأوزان بالتباين العكسي (الدقة). تهيمن الدراسات الكبيرة.</dd>
</div>
<div class="glossary-term" data-term="random effects">
<dt>نموذج التأثيرات العشوائية</dt>
<dd>يفترض أن الدراسات تقدر التأثيرات المختلفة ولكن ذات الصلة من التوزيع. يدمج التباين بين الدراسات (τ²) في الأوزان.</dd>
</div>
<div class="glossary-term" data-term="forest plot">
<dt>قطعة أرض الغابات</dt>
<dd>عرض رسومي لأحجام التأثير من الدراسات الفردية والتقدير المجمع، مع فترات الثقة.</dd>
</div>
<div class="glossary-term" data-term="funnel plot">
<dt>مخطط القمع</dt>
<dd>مخطط مبعثر بحجم التأثير مقابل الخطأ القياسي. قد يشير عدم التماثل إلى تحيز النشر أو تأثيرات الدراسة الصغيرة.</dd>
</div>
<div class="glossary-term" data-term="publication bias">
<dt>انحياز النشر</dt>
<dd>ميل الدراسات ذات النتائج الإيجابية/الهامة إلى النشر أكثر من الدراسات الخالية/السلبية.</dd>
</div>
<div class="glossary-term" data-term="egger test">
<dt>اختبار إيجر</dt>
<dd>اختبار الانحدار لعدم تناسق مخطط القمع. تشير P &lt;0.10 إلى تأثيرات محتملة للدراسات الصغيرة أو تحيز النشر.</dd>
</div>
<div class="glossary-term" data-term="trim and fill">
<dt>تقليم وملء</dt>
<dd>طريقة ل تقدير عدد الدراسات المفقودة بسبب تحيز النشر وضبط التأثير المجمع وفقًا لذلك.</dd>
</div>
<div class="glossary-term" data-term="risk of bias">
<dt>خطر التحيز (RoB)</dt>
<dd>تقييم الأخطاء المنهجية في تصميم الدراسة أو إجرائها أو إعداد التقارير التي قد تؤثر على النتائج. RoB 2.0 هي أداة كوكرين للتجارب المعشاة ذات الشواهد.</dd>
</div>
<div class="glossary-term" data-term="robins-i">
<dt>روبنز-آي</dt>
<dd>خطر التحيز في الدراسات غير العشوائية للتدخلات. أداة كوكرين لتقييم التحيز في الدراسات الرصدية.</dd>
</div>
<div class="glossary-term" data-term="grade">
<dt>الدرجة</dt>
<dd>تصنيف التوصيات والتقييم والتطوير والتقييمات. إطار عمل لتقييم يقين الأدلة (مرتفع، متوسط، منخفض، منخفض جدًا).</dd>
</div>
<div class="glossary-term" data-term="prediction interval">
<dt>الفاصل الزمني للتنبؤ</dt>
<dd>نطاق التأثيرات المتوقعة في دراسة جديدة، مع مراعاة عدم التجانس بين الدراسات. فاصل الثقة أوسع من.</dd>
</div>
<div class="glossary-term" data-term="nnt">
<dt>NNT (العدد المطلوب للعلاج)</dt>
<dd>عدد المرضى الذين يحتاجون إلى العلاج لمنع حدوث نتيجة سلبية إضافية واحدة. NNT = 1/ARR.</dd>
</div>
<div class="glossary-term" data-term="nnh">
<dt>NNH (العدد المطلوب للإضرار)</dt>
<dd>عدد المرضى الذين يحتاجون إلى العلاج لمريض إضافي واحد حتى يتعرض للأذى. NNH = 1/ARI.</dd>
</div>
<div class="glossary-term" data-term="hksj">
<dt>تعديل HKSJ</dt>
<dd>تعديل هارتونج-ناب-سيديك-جونكمان. يستخدم توزيع t لفترات الثقة في نماذج التأثيرات العشوائية، مما يوفر تغطية أفضل مع عدد قليل من الدراسات.</dd>
</div>
<div class="glossary-term" data-term="prospero">
<dt>بروسبيرو</dt>
<dd>السجل الدولي المحتمل للمراجعات المنهجية. التسجيل المسبق يمنع التغييرات المنهجية اللاحقة.</dd>
</div>
<div class="glossary-term" data-term="prisma">
<dt>بريسما</dt>
<dd>عناصر التقارير المفضلة للمراجعات المنهجية والتحليلات الوصفية. إرشادات إعداد التقارير مع مخطط التدفق وقائمة المراجعة.</dd>
</div>
<div class="glossary-term" data-term="nma">
<dt>التحليل التلوي للشبكة (NMA)</dt>
<dd>طريقة لمقارنة معالجات متعددة في وقت واحد باستخدام الأدلة المباشرة وغير المباشرة من خلال المقارنات المشتركة.</dd>
</div>
<div class="glossary-term" data-term="sucra">
<dt>سوكرا</dt>
<dd>السطح تحت منحنى التصنيف التراكمي. يصنف العلاجات في NMA من 0% (الأسوأ) إلى 100% (الأفضل).</dd>
</div>
<div class="glossary-term" data-term="ipd">
<dt>التحليل التلوي IPD</dt>
<dd>التحليل التلوي لبيانات المريض الفردية. يستخدم بيانات أولية على مستوى المريض من التجارب بدلاً من الملخصات المنشورة. المعيار الذهبي لتحليل المجموعات الفرعية.</dd>
</div>
<div class="glossary-term" data-term="dta">
<dt>التحليل التلوي DTA</dt>
<dd>التحليل التلوي لدقة الاختبار التشخيصي. تجميع الحساسية والخصوصية باستخدام نماذج ثنائية المتغير.</dd>
</div>
<div class="glossary-term" data-term="sroc">
<dt>منحنى SROC</dt>
<dd>ملخص منحنى خاصية تشغيل جهاز الاستقبال. يستخدم في التحليل التلوي DTA لعرض الحساسية/النوعية المجمعة.</dd>
</div>
<div class="glossary-term" data-term="iceman">
<dt>رجل الجليد</dt>
<dd>أداة لتقييم مصداقية تحليلات تعديل التأثير. يقيم مصداقية تحليل المجموعة الفرعية.</dd>
</div>
<div class="glossary-term" data-term="tsa">
<dt>التحليل التسلسلي التجريبي (TSA)</dt>
<dd>طريقة تطبيق حدود التوقف على التحليل التلوي التراكمي لتحديد وقت تراكم الأدلة الكافية.</dd>
</div>
<div class="glossary-term" data-term="living review">
<dt>المراجعة المنهجية الحية</dt>
<dd>مراجعة يتم تحديثه باستمرار مع ظهور أدلة جديدة، بدلاً من أن يكون منشورًا ثابتًا في وقت محدد.</dd>
</div>
</dl>
</div>
</div>
 مساعدة اختصارات لوحة المفاتيح 
<div aria-label="Keyboard shortcuts" class="keyboard-help" id="keyboardHelp" role="dialog">
<h3>اختصارات لوحة المفاتيح</h3>
<div class="keyboard-help-item">
<span>الشريحة التالية</span>
<span class="keyboard-help-key">→ or Space</span>
</div>
<div class="keyboard-help-item">
<span>الشريحة السابقة</span>
<span class="keyboard-help-key">← or Backspace</span>
</div>
<div class="keyboard-help-item">
<span>الوحدة التالية</span>
<span class="keyboard-help-key">↓ or N</span>
</div>
<div class="keyboard-help-item">
<span>الوحدة السابقة</span>
<span class="keyboard-help-key">↑ or P</span>
</div>
<div class="keyboard-help-item">
<span>تبديل لوحة الأدوات</span>
<span class="keyboard-help-key">T</span>
</div>
<div class="keyboard-help-item">
<span>تبديل المسرد</span>
<span class="keyboard-help-key">G</span>
</div>
<div class="keyboard-help-item">
<span>هذه المساعدة</span>
<span class="keyboard-help-key">?</span>
</div>
<div class="keyboard-help-item">
<span>إغلاق مربعات الحوار</span>
<span class="keyboard-help-key">Esc</span>
</div>
<button class="btn" onclick="toggleKeyboardHelp()" style="margin-top: 1rem; width: 100%;">إغلاق</button>
</div>
<div class="course-container">
 التنقل في الشريط الجانبي 
<nav aria-label="التنقل في الوحدة" class="sidebar" role="navigation">
<div class="sidebar-header">
<a href="index-ar.html" onmouseout="this.style.color='rgba(212,175,55,0.7)'" onmouseover="this.style.color='#D4AF37'" style="display:block;font-size:0.7rem;color:rgba(212,175,55,0.7);text-decoration:none;margin-bottom:0.5rem;">← مكتبة الدورة</a>
<h1>دورة عكس الأدلة</h1>
<p>طرق التحليل التلوي</p>
</div>
<div class="module-list" id="moduleList">
 عناصر الوحدة التي تم إنشاؤها بواسطة JS 
</div>
<div class="sidebar-footer">
<button class="dashboard-btn" onclick="openDashboard()">
<span>📊</span>
<span>لوحة معلومات التقدم</span>
<span id="sidebarPoints" style="margin-right: auto; font-weight: 700;">0 نقاط</span>
</button>
<button class="daily-review-btn" id="dailyReviewBtn" onclick="openDailyReview()">
<span>🧠</span>
<span>المراجعة اليومية</span>
<span id="reviewStatus" style="margin-right: auto;">مستعد</span>
</button>
<p style="text-align: center; margin-bottom: 0.5rem;">التقدم: <span id="progressPercent">0%</span></p>
<button class="btn" onclick="resetProgress()" style="padding: 0.25rem 0.5rem; font-size: 0.7rem; width: 100%;">إعادة ضبط التقدم</button>
</div>
</nav>
 لوحة معلومات التقدم Modal 
<div class="progress-dashboard" id="progressDashboard">
<div class="dashboard-content">
<div class="dashboard-header">
<h2>تقدمك</h2>
<button class="dashboard-close" onclick="closeDashboard()">×</button>
</div>
<div class="level-display">
<div class="level-badge" id="levelBadge">المستوى 1: المبتدئ</div>
<div class="points-display" id="totalPoints">0</div>
<div class="points-label">إجمالي النقاط</div>
</div>
<div class="stats-grid">
<div class="stat-card">
<div class="stat-value" id="modulesCompleted">0/15</div>
<div class="stat-label">الوحدات</div>
</div>
<div class="stat-card">
<div class="stat-value" id="predictionsCorrect">0/0</div>
<div class="stat-label">التنبؤات</div>
</div>
<div class="stat-card">
<div class="stat-value" id="quizzesCompleted">0</div>
<div class="stat-label">مسابقات</div>
</div>
</div>
<div class="principles-section">
<h3>المبادئ السبعة</h3>
<div id="principlesList"></div>
</div>
<div class="badges-section">
<h3>الشارات المكتسبة</h3>
<div class="badges-grid" id="badgesGrid"></div>
</div>
<div class="streak-section">
<h3>خط التعلم</h3>
<div class="streak-display">
<div class="streak-flame" id="streakFlame">🔥</div>
<div class="streak-info">
<div class="streak-count" id="streakCount">0 أيام</div>
<div class="streak-label">استمر في التعلم يوميًا!</div>
</div>
</div>
</div>
</div>
</div>
 المراجعة اليومية Modal 
<div aria-label="المراجعة اليومية" class="daily-review-modal" id="dailyReviewModal" role="dialog">
<div class="daily-review-content">
<div class="daily-review-header">
<h2>📚 المراجعة اليومية</h2>
<button class="daily-review-close" onclick="closeDailyReview()">×</button>
</div>
<div class="review-timer">
<div class="timer-display" id="reviewTimer">2:00</div>
<div class="timer-label">تقوية ذاكرتك</div>
</div>
<div class="review-progress" id="reviewProgress">
 تم إدراج نقاط التقدم بواسطة JS 
</div>
<div id="reviewCardContainer">
 مراجعة البطاقات التي تم إدراجها بواسطة JS 
</div>
<div class="review-actions" id="reviewActions">
<button class="review-btn skip" onclick="skipDailyReview()">التخطي اليوم</button>
<button class="review-btn next" disabled="" id="reviewNextBtn" onclick="nextReviewQuestion()">يكمل</button>
</div>
</div>
</div>
 المحتوى الرئيسي 
<main class="main-content">
<header class="content-header">
<div class="breadcrumb">
          الوحدة <span id="currentModuleNum">0</span>: <span id="currentModuleName">الافتتاح</span>
</div>
<div class="header-actions">
<button class="btn" onclick="toggleToolsPanel()">الأدوات</button>
<button class="btn primary" onclick="nextModule()">الوحدة التالية</button>
</div>
</header>
<div class="content-body">
 إمكانية الوصول: إعلانات قارئ الشاشة لتغييرات الشرائح 
<div aria-atomic="true" aria-live="polite" class="sr-only" id="slideAnnouncer"></div>
 حاوية الشرائح 
<div aria-label="الدورة التدريبية الشرائح" class="slides-container" id="main-content" role="region">
 الوحدة 0: الافتتاح 
<div class="module-slides active" data-module="0">
<div class="slide dark active" data-index="0">
<p class="refrain animate">ليست كل إشارة الحقيقة.</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">الوحدة 0: الافتتاح</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>تعريف التحليل التلوي وشرح دوره في تركيب الأدلة</li>
<li>تحديد متى لا ينبغي تجميع الدراسات</li>
<li>وصف التسلسل الهرمي للأدلة ومكان المراجعات المنهجية</li>
<li>إدراك أن التحليل التلوي يمكن أن يكون مضللاً عندما يتم إجراؤه بشكل سيئ</li>
<li>تذكر المبادئ السبعة التي ترتكز عليها دورة</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">هذه الدورة موجودة لأن</p>
<p class="title gold animate delay-1 text-center">الطب كان خاطئا.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                ولا مرة واحدة. ليس نادرا. مرارا. بطرق أدت إلى مقتل المرضى الذين كانوا يثقون في صحة الأدلة.
              </p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">ما هو التحليل التلوي؟</h2>
<div class="card animate delay-1">
<p class="card-text text-center">
                    طريقة إحصائية للجمع بين نتائج دراسات مستقلة متعددة تتناول نفس السؤال.
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">1976</div>
<div class="stat-label">المصطلح الذي صاغه جين جلاس</div>
</div>
<div class="stat-box">
<div class="stat-value">~50,000</div>
<div class="stat-label">يُنشر سنويًا</div>
</div>
<div class="stat-box">
<div class="stat-value">#1</div>
<div class="stat-label">التسلسل الهرمي للأدلة</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">لماذا الدراسات المجمعة؟</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>زيادة القوة الإحصائية</h4>
<p>قد تكون الدراسات الفردية أصغر من أن تتمكن من اكتشاف التأثيرات.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>تحسين الدقة</h4>
<p>فترات ثقة أضيق حول تقديرات التأثير.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>حل الخلاف</h4>
<p>عندما تتعارض الدراسات، يمكن للتجميع توضيح الإشارة.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>استكشاف عدم التجانس</h4>
<p>حدد سبب اختلاف التأثيرات عبر المجموعات السكانية أو الإعدادات.</p>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="title cream animate text-center">لكن التحليل التلوي يمكنه ذلك أيضًا</p>
<p class="big-number gold animate delay-1">مضلل</p>
<p class="animate delay-2" style="font-size: 1.1rem; text-align: center; max-width: 600px; margin-top: 1rem;">
                وعندما يتم القيام بذلك بشكل سيء، فإنه يؤدي إلى تضخيم التحيز بدلاً من الحقيقة.
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">عندما لا تجمع</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p>تقيس الدراسات أشياء مختلفة بشكل أساسي (التفاح والبرتقال)</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p>عدم التجانس الشديد الذي لا يمكن تفسيره</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p>دراسة واحدة تهيمن على جميع الدراسات الأخرى (مشكلة الدراسة الضخمة)</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p>تحتوي الدراسات على مخاطر عالية للتحيز لا يمكن تعديلها</p>
</div>
<div class="focus-box animate delay-5 mt-2">
<p class="main">التجميع هو امتياز وليس حق.</p>
<p class="sub">ويجب الدفاع عن قرار الدمج.</p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">التسلسل الهرمي للأدلة</h2>
<div style="max-width: 600px; margin-top: 1.5rem;">
<div class="card animate delay-1" style="background: var(--gold); color: var(--navy);">
<p class="card-text text-center" style="font-weight: 700;">المراجعات المنهجية والتحليلات التلوية للتجارب المعشاة ذات الشواهد</p>
</div>
<div class="card animate delay-2">
<p class="card-text text-center">التجارب المعشاة ذات الشواهد</p>
</div>
<div class="card animate delay-3">
<p class="card-text text-center">دراسات الأتراب</p>
</div>
<div class="card animate delay-4">
<p class="card-text text-center">دراسات الحالات والشواهد</p>
</div>
<div class="card animate delay-5">
<p class="card-text text-center">سلسلة الحالات / رأي الخبراء</p>
</div>
</div>
<p class="footnote animate delay-5">ويعتمد الموقع في التسلسل الهرمي على جودة المنهجية، وليس على نوع الدراسة وحده.</p>
</div>
</div>
<div class="slide dark" data-index="7">
<p class="title cream animate text-center">يتم تدريس هذه الدورة من خلال</p>
<p class="title gold animate delay-1 text-center">عكس الأدلة.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1rem; text-align: center; max-width: 700px;">
                تبدأ كل وحدة بقصة توضح كيف أخطأ الطب في فهم الأمور. ثم نتعلم الطريقة التي كانت ستمنع الضرر.
              </p>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">المبادئ السبعة</h2>
<p class="animate delay-1" style="font-style: italic; margin-bottom: 1.5rem;">
                  ستعود هذه العبارات طوال رحلتك:
                </p>
<div style="text-align: right; max-width: 700px;">
<p class="animate delay-1" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">1.</span> "ليست كل إشارة هي الحقيقة."</p>
<p class="animate delay-2" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">2.</span> "أساليب تحمي المرضى من ثقتنا."</p>
<p class="animate delay-3" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">3.</span> "ما الذي كان مخفيا على مرأى من الجميع؟"</p>
<p class="animate delay-3" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">4.</span> "الرقم بدون مصدر ليس رقمًا."</p>
<p class="animate delay-4" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">5.</span> "التباين هو رسالة، وليس ضجيجا."</p>
<p class="animate delay-4" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">6.</span> "غياب الدليل ليس دليلاً على الغياب"</p>
<p class="animate delay-5" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">7.</span> "اليقين يجب أن يُكتسب، لا أن يُفترض."</p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">الوحدة 0 اختبار</h2>
<div class="quiz-container">
<div class="quiz-question" id="q0-1">
<h4>1. لماذا لا ينبغي عليك في بعض الأحيان تجميع الدراسات في التحليل التلوي؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 0, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>A.</span> التجميع دائمًا أفضل من الدراسات الفردية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 1, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>B.</span> عندما يكون عدم التجانس متطرفًا أو عندما تقيس الدراسات أشياء مختلفة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 2, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>C.</span> التجميع مناسب دائمًا للتجارب المعشاة ذات الشواهد
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 3, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>D.</span> الأساليب الإحصائية تتعامل مع أي موقف
                      </div>
</div>
<div id="q0-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q0-2" style="margin-top: 1.5rem;">
<h4>2. أين تقع المراجعات المنهجية للتجارب المعشاة ذات الشواهد في التسلسل الهرمي للأدلة؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 0, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>A.</span> في الأعلى
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 1, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>B.</span> نفس مستوى المضبوطة الفردية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 2, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>C.</span> أدناه دراسات الأتراب
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 3, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>D.</span> نفس رأي الخبراء
                      </div>
</div>
<div id="q0-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="10">
<p class="refrain animate">ابدأ الرحلة.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 1: السؤال</p>
</div>
 التنقل بين الشرائح الذي تم إنشاؤه بواسطة JS 
</div>
 الوحدة 1: السؤال (CAST) 
<div class="module-slides" data-module="1">
<div class="slide dark active" data-index="0">
<p class="refrain animate">ليست كل إشارة الحقيقة.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">هذه ليست قصة عن الخطأ.</p>
<p class="title gold animate delay-1 text-center">إنها قصة عن اليقين.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة 1: السؤال</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>قم بصياغة سؤال PICO مركّز لإجراء مراجعة منهجية</li>
<li>التمييز بين النتائج البديلة والنتائج المهمة للمريض</li>
<li>اشرح لماذا لا تعتبر المعقولية البيولوجية وحدها دليلا كافيا</li>
<li>وصف تجربة CAST وآثارها على الطب المبني على الأدلة</li>
<li>تطبيق قاعدة: "ليس كل إشارة مضيئة هدى"</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">50,000</p>
<p class="subtitle animate delay-1">الوفيات سنويًا</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">من العلاج الذي يعتقد الجميع أنه نجح.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">هذه هي قصة كيف آمنا، وكيف كنا مخطئين.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">الملاحظة</h2>
<div class="card animate delay-1">
<p class="card-text text-center">كان المرضى الذين يعانون من الـ PVC المتكرر بعد احتشاء عضلة القلب لديهم معدل وفيات أعلى بمقدار 2-5 مرات.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">400,000+</div>
<div class="stat-label">الناجون من احتشاء عضلة القلب/السنة</div>
</div>
<div class="stat-box">
<div class="stat-value">~40%</div>
<div class="stat-label">مع PVCs كبيرة</div>
</div>
<div class="stat-box">
<div class="stat-value">160,000</div>
<div class="stat-label">معرضون لخطر مرتفع</div>
</div>
</div>
<p class="footnote animate delay-3">حاجة سريرية هائلة. هدف واضح.</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">الاستجابة</h2>
<p class="animate delay-1" style="font-size: 1.2rem; text-align: center; margin: 1rem 0;">
                  تم تطوير أدوية مضادة لاضطراب النظم، ووافقت عليها إدارة الغذاء والدواء،<br/>ووصفت لحوالي 200000 مريض سنويًا.
                </p>
<div class="focus-box animate delay-2">
<p class="main">لا يظهر أي شرير في هذه القصة.</p>
<p class="sub">تصرف الجميع بناءً على أفضل الأدلة متاح.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">المنطق الذي أقنع الجميع</h2>
<div class="card animate delay-1">
<div class="card-label">الفرضية 1</div>
<p class="card-text">تتنبأ مضادات اضطراب النظم القلبي بعد احتشاء عضلة القلب بالموت القلبي المفاجئ</p>
</div>
<div class="arrow animate delay-1">↓</div>
<div class="card animate delay-2">
<div class="card-label">الفرضية 2</div>
<p class="card-text">الأدوية المضادة لاضطراب نظم القلب تقمع الـ PVCs</p>
</div>
<div class="arrow animate delay-2">↓</div>
<div class="card animate delay-3">
<div class="card-label">الفرضية 3</div>
<p class="card-text">قمع الـ PVCs يجب أن يمنع الموت المفاجئ</p>
</div>
<div class="arrow animate delay-3">↓</div>
<div class="card navy-bg animate delay-4">
<div class="card-label">خاتمة</div>
<p class="card-text">مضادات اضطراب النظم تنقذ حياة مرضى ما بعد احتشاء عضلة القلب</p>
</div>
<p class="footnote animate delay-5">السلسلة كانت منطقية. بدا أن الاستنتاج لا مفر منه.</p>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">تجربة قمع اضطراب نظم القلب</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1.5rem;">
                  أخيرًا، سأل أحدهم: "هل قمع الـ PVCs ينقذ الأرواح بالفعل؟"
                </p>
<div class="design-grid animate delay-2">
<div class="design-item">
<div class="design-item-label">التصميم</div>
<div class="design-item-value">عشوائية، مزدوجة التعمية، ومضبوطة بالعلاج الوهمي</div>
</div>
<div class="design-item">
<div class="design-item-label">سكان</div>
<div class="design-item-value">مرضى ما بعد MI الذين يعانون من PVC بدون أعراض</div>
</div>
<div class="design-item">
<div class="design-item-label">تدخل</div>
<div class="design-item-value">إنكاينيد، فليكاينيد، أو موريسيزين مقابل الدواء الوهمي</div>
</div>
<div class="design-item">
<div class="design-item-label">تشغيل</div>
<div class="design-item-value">فقط المرضى الذين يعانون من تثبيط PVC بنسبة ≥80% بشكل عشوائي</div>
</div>
<div class="design-item">
<div class="design-item-label">نقطة النهاية الأولية</div>
<div class="design-item-value">الوفاة أو السكتة القلبية مع الإنعاش</div>
</div>
<div class="design-item">
<div class="design-item-label">حجم العينة</div>
<div class="design-item-value">1,498 مريضًا (أذرع إنكايينيد/فليكاينيد)</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">النتائج: أبريل 1989</h2>
<p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">
                  أوقف مجلس مراقبة سلامة البيانات التجربة مبكرًا.
                </p>
<table class="results-table animate delay-2">
<thead>
<tr>
<th>حصيلة</th>
<th>المخدرات (ن = 755)</th>
<th>الدواء الوهمي (ن = 743)</th>
</tr>
</thead>
<tbody>
<tr>
<td>الوفيات الناجمة عن عدم انتظام ضربات القلب</td>
<td class="highlight">33</td>
<td>9</td>
</tr>
<tr>
<td>جميع الوفيات القلبية</td>
<td class="highlight">43</td>
<td>16</td>
</tr>
<tr>
<td>إجمالي الوفيات</td>
<td class="highlight">56</td>
<td>22</td>
</tr>
<tr>
<td><strong>معدل الوفيات</strong></td>
<td class="highlight">7.4%</td>
<td><strong>3.0%</strong></td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">الخطر النسبي للوفاة: 2.5</div>
<div class="label">95% CI: 1.6 - 4.5 | p &lt; 0.001</div>
</div>
<p class="footnote animate delay-4">الأدوية التي كبحت عدم انتظام ضربات القلب بشكل مثالي زادت معدل الوفيات بنسبة 150%.</p>
</div>
</div>
<div class="slide dark" data-index="8">
<div class="content">
<h2 class="title cream animate">التكلفة البشرية</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">قبل CAST، كان حوالي 200.000 أمريكي يتلقون هذه الأدوية سنويًا.</p>
<p class="big-number gold animate delay-2">~9,000</p>
<p class="animate delay-2" style="font-size: 1.25rem;">الوفيات الزائدة سنويا - وربما أكثر</p>
<div class="animate delay-3" style="background: rgba(45,58,95,0.8); padding: 1rem 2rem; text-align: center; margin: 1rem 0;">
<p style="color: var(--cream);">حرب فيتنام: حوالي 6,000 حالة وفاة في الولايات المتحدة سنويًا. • هذه الأدوية: حوالي 9,000+ حالة وفاة سنويًا</p>
</div>
<p class="serif animate delay-4" style="font-style: italic; color: var(--gold); margin-top: 1.5rem; text-align: center;">
                  لكل رقم اسم لن نعرفه أبدًا.
                </p>
</div>
</div>
<div class="slide black" data-index="9">
<p class="serif animate" style="font-size: clamp(2rem, 5vw, 3rem);">انظر مرة أخرى.</p>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">المنطق – إعادة النظر</h2>
<div class="card animate delay-1">
<div class="card-label">الفرضية 1</div>
<p class="card-text">تتنبأ مضادات اضطراب النظم القلبي بعد احتشاء عضلة القلب بالموت القلبي المفاجئ</p>
</div>
<div class="arrow animate delay-1">↓</div>
<div class="card-wrapper animate delay-2">
<div class="card">
<div class="card-label">الفرضية 2</div>
<p class="card-text">الأدوية المضادة لاضطراب نظم القلب تقمع الـ PVCs</p>
</div>
<div class="leap-badge">← القفزة</div>
</div>
<div class="arrow animate delay-2">↓</div>
<div class="card red-border animate delay-3">
<div class="card-label">الفرضية 3</div>
<p class="card-text">قمع الـ PVCs يجب أن يمنع الموت المفاجئ</p>
</div>
<div class="arrow animate delay-3">↓</div>
<div class="card navy-bg animate delay-4">
<div class="card-label">خاتمة</div>
<p class="card-text">مضادات اضطراب النظم تنقذ حياة مرضى ما بعد احتشاء عضلة القلب</p>
</div>
<p class="footnote animate delay-5">لم يكن الافتراض بأن قمع العلامة سيصلح النتيجة أبدًا تم اختباره.</p>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">ما الخطأ الذي حدث: الفخ البديل</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p>كانت PVC علامة على الأنسجة التالفة، وليست سببًا للوفاة</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p>كان للأدوية تأثيرات على عدم انتظام ضربات القلب، مما أدى إلى إيقاعات أكثر فتكًا</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p>تحسنت الأم البديلة بينما ساءت النتيجة - بديل منفصل</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">لم يكذب البديل. لقد طرحنا عليه السؤال الخطأ.</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">إطار عمل بيكو</h2>
<p class="animate delay-1" style="margin-bottom: 1.5rem; font-style: italic;">
                  يحتوي كل سؤال سريري قابل للإجابة على أربعة مكونات:
                </p>
<div class="design-grid" style="grid-template-columns: repeat(2, 1fr);">
<div class="design-item animate delay-1" style="border-left-color: var(--navy);">
<div class="design-item-label" style="color: var(--navy);">ف - السكان</div>
<div class="design-item-value">من هم المرضى؟ ما هي خصائصهم؟</div>
</div>
<div class="design-item animate delay-2" style="border-left-color: var(--green);">
<div class="design-item-label" style="color: var(--green);">أنا - التدخل</div>
<div class="design-item-value">ما هو العلاج أو التعرض الذي يتم تقييمه؟</div>
</div>
<div class="design-item animate delay-3" style="border-left-color: var(--red);">
<div class="design-item-label" style="color: var(--red);">ج - المقارنة</div>
<div class="design-item-value">ما هو البديل؟ الدواء الوهمي؟ الرعاية القياسية؟</div>
</div>
<div class="design-item animate delay-4" style="border-left-color: var(--gold);">
<div class="design-item-label" style="color: var(--gold);">O - النتيجة</div>
<div class="design-item-value">ما الذي يهم المرضى؟ نقاط النهاية الصعبة مقابل البدائل.</div>
</div>
</div>
<div class="result-box animate delay-5" style="margin-top: 1.5rem;">
<div class="label">كاست بيكو</div>
<div class="value" style="font-size: 1rem; line-height: 1.5;">
                    مرضى ما بعد MI الذين يعانون من PVC | مضادات اضطراب النظم | الدواء الوهمي | الوفيات
                  </div>
</div>
</div>
</div>
 تمرين التحقيق CAST 
<div class="slide dark" data-index="13">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>تمرين التحقيق: الأدلة قبل CAST</h3>
</div>
<p class="direct-address">أنت طبيب قلب في عام 1988. لقد نجا مريض من احتشاء عضلة القلب ولكنه يعاني من انقباضات القلب المتكررة. والأدب الرصدي واضح...</p>
<table class="data-table-investigation">
<thead>
<tr><th>دراسة</th><th>المرضى الذين يعانون من PVC</th><th>خطر الوفيات</th></tr>
</thead>
<tbody>
<tr><td>لون (1977)</td><td>مواد PVC عالية الجودة</td><td>أعلى بمقدار 2.4 مرة</td></tr>
<tr><td>أكبر (1984)</td><td>&gt; 10 PVC/ساعة</td><td>أعلى بمقدار 3.1 مرة</td></tr>
<tr><td>مخرجي (1984)</td><td>PVC المعقدة</td><td>أعلى بمقدار 4.8 مرة</td></tr>
</tbody>
</table>
<p class="rhetorical" style="margin-top: 1rem;">الإشارة واضحة. الآلية معقولة. هل ستصف مضادات اضطراب النظم؟</p>
<button class="reveal-btn" onclick="revealAnswer('cast-reveal')">انظر ما كشفه CAST →</button>
<div class="hidden-reveal" id="cast-reveal">
<div class="comparison-grid">
<div class="comparison-panel">
<h4>قبل: المنطق الرصدي</h4>
<p>PVCs → ارتفاع معدل الوفيات</p>
<p>المخدرات قمع PVC</p>
<p><strong>∴ الأدوية يجب أن تقلل من معدل الوفيات</strong></p>
</div>
<div class="comparison-panel after">
<h4>بعد: CAST RCT (1989)</h4>
<p>معدل الوفيات بسبب المخدرات: <strong style="color: var(--red);">7.4%</strong></p>
<p>معدل الوفيات عند العلاج الوهمي: <strong>3.0%</strong></p>
<p><strong style="color: var(--red);">RR = 2.5 (زيادة بنسبة 150% في الوفيات)</strong></p>
</div>
</div>
<p style="margin-top: 1rem; font-style: italic; color: var(--gold);">تحسن البديل. مات المرضى. ولهذا السبب نسأل: "ما هي النتيجة المهمة؟"</p>
</div>
</div>
</div>
<div class="slide light" data-index="14">
<div class="content">
<h2 class="title navy animate">دروس تركيب الأدلة</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>المعقولية البيولوجية ليست دليلاً</h4>
<p>الآلية المنطقية لا تضمن التأثير المتوقع.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>نقاط النهاية البديلة يمكن أن تكون مضللة</h4>
<p>إن تحسين العلامة الحيوية لا يثبت تحسنًا في النتائج.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>فقط التجارب المعشاة تحدد العلاقة السببية</h4>
<p>لا يمكن لبيانات الرصد إثبات تأثيرات التدخل.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>الإجماع ليس دليلاً الأدلة</h4>
<p>200000 وصفة طبية، وموافقة إدارة الغذاء والدواء الأمريكية، والمبادئ التوجيهية كانت كلها خاطئة.</p>
</div>
</div>
<p class="serif animate delay-5" style="font-style: italic; color: var(--gold); margin-top: 1.5rem; text-align: center;">
                  ولهذا السبب نقوم بالتحليل التلوي: لرؤية الحقائق الظاهرة الماضية.
                </p>
</div>
</div>
<div class="slide dark" data-index="14">
<p class="closing-line animate">ما يبدو مؤكدًا قد يكون خاطئًا.</p>
<p class="closing-line animate delay-1">ما يعتقده الجميع قد يكون كاذبا.</p>
<p class="closing-line gold animate delay-2">الطرق موجودة حتى لا يدفع المرضى ثمن ثقتنا.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">ولهذا السبب أنت هنا.</p>
</div>
 اختبار الوحدة 1 
<div class="slide light" data-index="16">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 1</h2>
<div class="quiz-container">
<div class="quiz-question" id="q1-1">
<h4>1. ما هو الخطأ الأساسي في منطق عدم انتظام ضربات القلب؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 0, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>A.</span> لم تكن التجارب عشوائية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 1, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>B.</span> كان من المفترض أن يؤدي علاج البديل (PVCs) إلى تحسين النتائج
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 2, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>C.</span> كان حجم العينة صغيرًا جدًا
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 3, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>D.</span> تم التعجيل بموافقة إدارة الغذاء والدواء
                      </div>
</div>
<div id="q1-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q1-2">
<h4>2. في PICO، ما الذي يرمز إليه الحرف "O" ولماذا يهم؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 0, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>A.</span> الملاحظة - ما يراه الباحثون
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 1, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>B.</span> الهدف - هدف البحث
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 2, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>C.</span> النتيجة - ما يهم المرضى
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 3, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>D.</span> التنظيم - هيكل الدراسة
                      </div>
</div>
<div id="q1-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="17">
<p class="refrain animate">ليست كل إشارة الحقيقة.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">
                الطرق تحمي المرضى من ثقتنا.
              </p>
</div>
</div>
 الوحدة 2: البروتوكول (HRT) 
<div class="module-slides" data-module="2">
<div class="slide dark active" data-index="0">
<p class="refrain animate">ما الذي كان مخفيا على مرأى من الجميع؟</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">هذه قصة حول</p>
<p class="title gold animate delay-1 text-center">الأدلة الرصدية.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة الثانية: البروتوكول</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>اشرح لماذا يمنع التسجيل المسبق للبروتوكول التحيز</li>
<li>تحديد العناصر الأساسية لتسجيل PROSPERO</li>
<li>تمييز تحيز المستخدم الصحي عن تأثيرات العلاج الحقيقية</li>
<li>وصف لماذا بالغت الدراسات الرصدية في تقدير فوائد العلاج التعويضي بالهرمونات</li>
<li>تطبيق المبدأ: "الطرق تحمي المرضى من ثقتنا"</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">30+</p>
<p class="subtitle animate delay-1">الدراسات الرصدية</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">
                جميعها تظهر أن العلاج بالهرمونات البديلة يحمي النساء بعد انقطاع الطمث من أمراض القلب.
              </p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">بدت الأدلة دامغة. بدا الاستنتاج مؤكدًا.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">دراسة صحة الممرضات</h2>
<div class="card animate delay-1">
<p class="card-text text-center">تمت متابعة 122,000 ممرضة لعقود من الزمن. كان لدى مستخدمي العلاج التعويضي بالهرمونات انخفاض في معدل الوفيات القلبية الوعائية بنسبة 40-50٪.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">RR 0.56</div>
<div class="stat-label">وفيات القلب والأوعية الدموية</div>
</div>
<div class="stat-box">
<div class="stat-value">122,000</div>
<div class="stat-label">تمت متابعة النساء</div>
</div>
<div class="stat-box">
<div class="stat-value">20+ سنة</div>
<div class="stat-label">المتابعة</div>
</div>
</div>
<p class="footnote animate delay-3">دراسة تاريخية. منهجية لا تشوبها شائبة. استنتاج خاطئ.</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">التحيز الخفي</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>انحياز المستخدم الصحي:</strong> النساء اللاتي اخترن العلاج التعويضي بالهرمونات كن أكثر صحة وأكثر ثراء وتعليمًا</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>انحياز الامتثال:</strong> النساء اللاتي تناولن العلاج التعويضي بالهرمونات باستمرار اعتنين بأنفسهن بشكل أفضل أيضًا</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>انحياز واصف الوصف:</strong> أعطى الأطباء العلاج التعويضي بالهرمونات لنساء أكثر صحة مع عوامل خطر أقل</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">لم يكن العلاج يحميهن. لقد كانوا محميين بالفعل.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">WHI: النساء مبادرة الصحة</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1.5rem;">
                  أكبر تجربة عشوائية أجريت على العلاج التعويضي بالهرمونات على الإطلاق.
                </p>
<div class="design-grid animate delay-2">
<div class="design-item">
<div class="design-item-label">التصميم</div>
<div class="design-item-value">عشوائية، مزدوجة التعمية، ومضبوطة بالعلاج الوهمي</div>
</div>
<div class="design-item">
<div class="design-item-label">سكان</div>
<div class="design-item-value">النساء بعد انقطاع الطمث الذين تتراوح أعمارهم بين 50-79</div>
</div>
<div class="design-item">
<div class="design-item-label">تدخل</div>
<div class="design-item-value">هرمون الاستروجين + البروجستين مقابل الدواء الوهمي</div>
</div>
<div class="design-item">
<div class="design-item-label">حجم العينة</div>
<div class="design-item-value">16,608 امرأة</div>
</div>
<div class="design-item">
<div class="design-item-label">نقطة النهاية الأولية</div>
<div class="design-item-value">مرض القلب التاجي</div>
</div>
<div class="design-item">
<div class="design-item-label">المدة المخططة</div>
<div class="design-item-value">8.5 سنة</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">النتائج: يوليو 2002</h2>
<p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">
                  توقفت التجربة مبكرًا بعد 5.2 سنة. الضرر أكثر من المنافع.
                </p>
<table class="results-table animate delay-2">
<thead>
<tr>
<th>حصيلة</th>
<th>نسبة الخطر</th>
<th>الاتجاه</th>
</tr>
</thead>
<tbody>
<tr>
<td>مرض القلب التاجي</td>
<td class="highlight">1.29</td>
<td class="highlight">HARM</td>
</tr>
<tr>
<td>السكتة الدماغية</td>
<td class="highlight">1.41</td>
<td class="highlight">HARM</td>
</tr>
<tr>
<td>سرطان الثدي</td>
<td class="highlight">1.26</td>
<td class="highlight">HARM</td>
</tr>
<tr>
<td>الانسداد الرئوي</td>
<td class="highlight">2.13</td>
<td class="highlight">HARM</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">الانعكاس الكامل</div>
<div class="label">30 عامًا من الأدلة الرصدية انقلبت</div>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<p class="title cream animate">الدرس</p>
<p class="big-number gold animate delay-1" style="font-size: clamp(2rem, 8vw, 5rem);">التحديد المسبق</p>
<p class="animate delay-2" style="font-size: 1.1rem; text-align: center; max-width: 600px; margin-top: 1rem;">
                بروتوكول مكتوب قبل بدء البحث يمنع الصيد ويمنع التحيز ويمنع تشويه الإدراك المتأخر.
              </p>
</div>
 القصة: فرضية توقيت الهرمونات 
<div class="slide dark" data-index="7b">
<div class="story-box animate">
<p class="story-opener">ماذا لو نجح العلاج - ولكن فقط بعض؟</p>
<div class="real-data-box">
<h4>البيانات الحقيقية</h4>
<p>
                    الذي أظهر أن العلاج التعويضي بالهرمونات <span class="data-highlight">يزيد من أحداث القلب والأوعية الدموية بشكل عام</span>. لكن التحليلات اللاحقة كشفت عن نمط حرج: النساء اللاتي بدأن العلاج التعويضي بالهرمونات
                    <span class="data-highlight">خلال 10 سنوات من انقطاع الطمث</span> had
                    <span class="data-highlight">قللن من خطر الإصابة بأمراض القلب والأوعية الدموية</span>. النساء اللاتي يبدأن <span class="data-highlight">بعد مرور 20 عامًا على انقطاع الطمث</span> had
                    <span class="data-highlight">زيادة المخاطر</span>. النتيجة الإجمالية الخالية/الضرر أخفت تأثير التوقيت.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">معضلة المحلل</div>
<div class="decision-scenario">
                    أنت تقوم بتحليل مجموعات WHI الفرعية. النتيجة الإجمالية تظهر الضرر. هل تبحث بشكل أعمق؟
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">المسار أ: التقرير بشكل عام فقط</div>
<div class="path-choice">استنتج أن العلاج التعويضي بالهرمونات ضار لجميع النساء بعد انقطاع الطمث</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">رسالة بسيطة. توصي الإرشادات بعدم استخدام العلاج التعويضي بالهرمونات بشكل عام.</div>
<div class="path-outcome">النتيجة: رفض الفوائد المحتملة للنساء الأصغر سنًا بعد انقطاع الطمث</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">المسار ب: مجموعات فرعية محددة مسبقًا للتوقيت</div>
<div class="path-choice">التحليل حسب السنوات منذ انقطاع الطمث (معقول بيولوجيًا)</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">اكتشف "نافذة التوقيت" لبدء العلاج التعويضي بالهرمونات بشكل آمن.</div>
<div class="path-outcome">النتيجة: تمكين التوصيات الشخصية</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">الرؤيا</div>
<div class="revelation-text">
                    يعد تحليل المجموعة الفرعية خطيرًا عند الصيد. إنه ضروري عندما يتنبأ علم الأحياء بتعديل التأثير. كانت فرضية التوقيت معقولة من الناحية البيولوجية، وكان ينبغي تحديدها مسبقًا.
                  </div>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">تسجيل PROSPERO</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>سجل قبل البحث</h4>
<p>PROSPERO: دولي السجل المحتمل للمراجعات المنهجية</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>اقفل قراراتك</h4>
<p>PICO، استراتيجية البحث، النتائج، خطة التحليل - جميعها محددة مسبقًا</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>تعديلات الوثيقة</h4>
<p>مسموح بالتغييرات ولكن يجب أن تكون شفافة ومبررة</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>منع الازدواجية</h4>
<p>تحقق مما إذا كانت مراجعتك موجودة بالفعل من قبل البدء</p>
</div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 2</h2>
<div class="quiz-container">
<div class="quiz-question" id="q2-1">
<h4>1. لماذا أظهرت دراسة صحة الممرضات فائدة من العلاج التعويضي بالهرمونات لم تفعله WHI؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 0, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>A.</span> كان لدى صحة الممرضات عدد قليل جدًا من المرضى
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 1, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>B.</span> تحيز المستخدم الصحي في الدراسات الرصدية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 2, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>C.</span> كانت صحة الممرضات ذات متابعة أقصر
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 3, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>D.</span> تم استخدام تركيبات هرمونية مختلفة
                      </div>
</div>
<div id="q2-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q2-2" style="margin-top: 1.5rem;">
<h4>2. ما هو الغرض الأساسي من تسجيل PROSPERO؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 0, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>A.</span> لتسجيل التجارب السريرية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 1, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>B.</span> لتسريع استكمال المراجعة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 2, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>C.</span> لتحديد الأساليب مسبقًا ومنع التحيز
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 3, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>D.</span> للحصول على تمويل للمراجعات
                      </div>
</div>
<div id="q2-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="10">
<p class="closing-line animate">المواصفات المسبقة ليست بيروقراطية.</p>
<p class="closing-line animate delay-1">إنها حماية.</p>
<p class="closing-line gold animate delay-2">ضد ميلنا للعثور على ما نتوقعه.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">الطرق تحمي المرضى من ثقتنا.</p>
</div>
<div class="slide black" data-index="11">
<p class="refrain animate">ما الذي كان مخفيا على مرأى من الجميع؟</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 3: البحث</p>
</div>
</div>
 الوحدة 3: البحث (روزيجليتازون) 
<div class="module-slides" data-module="3">
<div class="slide dark active" data-index="0">
<p class="refrain animate">ما الذي كان مخفيا على مرأى من الجميع؟</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">هذه قصة حول</p>
<p class="title gold animate delay-1 text-center">ما لم ينشروه.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة 3: البحث</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>قم بتطوير استراتيجية بحث شاملة باستخدام إرشادات PRESS</li>
<li>ابحث في قواعد بيانات متعددة بما في ذلك مصادر الأدبيات الرمادية</li>
<li>تحديد سجلات التجارب وقواعد البيانات التنظيمية (ClinicalTrials.gov، FDA)</li>
<li>اشرح كيف كشفت قضية الروزيجليتازون عن أضرار خفية في القلب والأوعية الدموية</li>
<li>تطبيق المبدأ: "ما الذي كان مخفيًا على مرأى من الجميع؟"</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">$3.2B</p>
<p class="subtitle animate delay-1">المبيعات السنوية في الذروة</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">كان أفانديا (روزيجليتازون) أحد أكثر أدوية مرض السكري مبيعًا في العالم المخدرات.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">تبدو التجارب المنشورة مطمئنة. أما الكتب غير المنشورة فقد روت قصة مختلفة.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">الأدلة المنشورة (ما قبل 2007)</h2>
<div class="card animate delay-1">
<p class="card-text text-center">وأظهرت التجارب المنشورة أن روزيجليتازون خفض بشكل فعال نسبة HbA1c. نادرا ما تم الإبلاغ عن نتائج القلب والأوعية الدموية.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">1999</div>
<div class="stat-label">موافقة ادارة الاغذية والعقاقير</div>
</div>
<div class="stat-box">
<div class="stat-value">6M+</div>
<div class="stat-label">المرضى الذين تم علاجهم</div>
</div>
<div class="stat-box">
<div class="stat-value">~0.7%</div>
<div class="stat-label">تخفيض HbA1c</div>
</div>
</div>
<p class="footnote animate delay-3">بدا البديل جيدًا. ولكن ماذا عن الأحداث القلبية الوعائية الفعلية؟</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">اكتشاف نيسن: مايو 2007</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1rem;">د. حصل ستيفن نيسن على بيانات التجارب غير المنشورة من موقع الويب الخاص بشركة GSK.</p>
<div class="card animate delay-2">
<p class="card-text text-center">لقد طُلب من GSK، بموجب تسوية قانونية، نشر نتائج التجارب السريرية عبر الإنترنت. قام نيسن وولسكي بتحليل 42 تجربة - لم يتم نشر العديد منها مطلقًا في المجلات.</p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">كانت البيانات علنية من الناحية الفنية.</p>
<p class="sub">لم يقم أحد بالبحث عنه بشكل منهجي.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">نتائج التحليل التلوي</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>حصيلة</th>
<th>نسبة الاحتمالات</th>
<th>95% CI</th>
</tr>
</thead>
<tbody>
<tr>
<td>احتشاء عضلة القلب</td>
<td class="highlight">1.43</td>
<td class="highlight">1.03 - 1.98</td>
</tr>
<tr>
<td>وفاة السيرة الذاتية</td>
<td>1.64</td>
<td>0.98 - 2.74</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-2">
<div class="value">43% زيادة في خطر الإصابة بالنوبات القلبية</div>
<div class="label">p = 0.03 لاحتشاء عضلة القلب</div>
</div>
<p class="footnote animate delay-3">نشرت في NEJM. دعت إدارة الغذاء والدواء الأمريكية إلى اجتماع للجنة الاستشارية الطارئة.</p>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="content">
<h2 class="title cream animate">اللجنة الاستشارية لإدارة الغذاء والدواء: يوليو 2007</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">22-1</div>
<div class="stat-label">التصويت: خطر السيرة الذاتية موجود</div>
</div>
<div class="stat-box">
<div class="stat-value">20-3</div>
<div class="stat-label">استمر السوق مع التحذيرات</div>
</div>
</div>
<p class="animate delay-2" style="margin-top: 1.5rem; text-align: center;">تم تقسيم اللجنة. ومنهم من أراد سحبها. وصف البعض التحليل التلوي بأنه معيب.</p>
<p class="animate delay-3" style="margin-top: 1rem; font-size: 1.1rem; text-align: center; color: var(--gold);">ولكن لا يمكن إخفاء الإشارة.</p>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">العواقب</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>تحذير الصندوق الأسود</strong> تمت إضافته لمخاطر قصور القلب (2007)</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>قيود شديدة</strong> بشأن وصف الأدوية في الولايات المتحدة (2010)</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>منشور</strong> من السوق الأوروبية بالكامل (2010)</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>تتطلب إدارة الغذاء والدواء الآن</strong> تجارب نتائج القلب والأوعية الدموية لجميع أدوية مرض السكري</p>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">ما يتطلبه البحث الشامل</h2>
<div class="design-grid animate delay-1">
<div class="design-item">
<div class="design-item-label">منشور</div>
<div class="design-item-value">PubMed, Embase, CENTRAL, Web of Science</div>
</div>
<div class="design-item">
<div class="design-item-label">الأدب الرمادي</div>
<div class="design-item-value">ملخصات المؤتمرات، والرسائل العلمية، والمستندات التنظيمية</div>
</div>
<div class="design-item">
<div class="design-item-label">سجلات التجارب</div>
<div class="design-item-value">ClinicalTrials.gov, WHO ICTRP، EU CTR</div>
</div>
<div class="design-item">
<div class="design-item-label">التنظيمية</div>
<div class="design-item-value">التقديمات المقدمة من إدارة الغذاء والدواء الأمريكية (FDA)، وEMA، ووزارة الصحة الكندية</div>
</div>
<div class="design-item">
<div class="design-item-label">بيانات الشركة</div>
<div class="design-item-value">سجلات التجارب السريرية GSK، وPfizer، وRoche</div>
</div>
<div class="design-item">
<div class="design-item-label">البحث اليدوي</div>
<div class="design-item-value">قوائم المراجع، ومؤلفو الاتصال، والخبراء</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">قائمة مراجعة الصحافة</h2>
<p class="animate delay-1" style="font-style: italic; margin-bottom: 1rem;">مراجعة النظراء لاستراتيجيات البحث الإلكتروني</p>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>ترجمة البحث سؤال</h4>
<p>هل يعكس البحث عناصر PICO؟</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>عوامل التشغيل المنطقية والقرب</h4>
<p>هل لا يتم استخدام AND وOR بشكل صحيح؟</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>عناوين الموضوع</h4>
<p>هل مصطلحات MeSH/Emtree مناسبة و انفجرت؟</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>الكلمات النصية</h4>
<p>المرادفات، المتغيرات الإملائية، الاقتطاع؟</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">قائمة PRESS المرجعية (تابع)</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">5</div>
<div class="lesson-content">
<h4>التهجئة وبناء الجملة وأرقام الأسطر</h4>
<p>هل هناك أخطاء من شأنها أن تسبب فشل الاسترداد؟</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">6</div>
<div class="lesson-content">
<h4>الحدود والمرشحات</h4>
<p>هل حدود التاريخ واللغة وتصميم الدراسة مناسبة؟</p>
</div>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">من المرجح أن يؤدي البحث الخاضع لمراجعة النظراء إلى العثور على دراسات رئيسية بنسبة 30%.</p>
<p class="sub">ماكجوان وآخرون، 2016</p>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">ترجمة قاعدة البيانات</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">يجب تعديل نفس البحث لكل منها قاعدة البيانات:</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 700px;">
<div class="card animate delay-2">
<div class="card-label">مجلات</div>
<p class="card-text" style="font-family: monospace; font-size: 0.8rem;">"داء السكري، النوع 2"[MeSH] OR "مرض السكري من النوع 2"[tiab]</p>
</div>
<div class="card animate delay-3">
<div class="card-label">إمباس</div>
<p class="card-text" style="font-family: monospace; font-size: 0.8rem;">'مرض السكري غير المعتمد على الأنسولين'/exp OR 'مرض السكري من النوع 2':ti,ab</p>
</div>
</div>
<p class="footnote animate delay-4">عناوين المواضيع، الحقل العلامات، والمشغلين تختلف بين قواعد البيانات.</p>
</div>
</div>
<div class="slide dark" data-index="12">
<p class="closing-line animate">إذا بحثت شركة Nissen في PubMed فقط،</p>
<p class="closing-line animate delay-1">لكانت الإشارة مخفية.</p>
<p class="closing-line gold animate delay-2">البحث الشامل هو البقاء.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">ما الذي كان مخفيا على مرأى من الجميع؟</p>
</div>
<!-- Quiz -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">الوحدة 3 مسابقة</h2>
<div class="quiz-container">
<div class="quiz-question" id="q3-1">
<h4>1. ما نوع مصدر الأدلة الذي كشف عن إشارة القلب والأوعية الدموية للروزيجليتازون؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 0, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>A.</span> المقالات الصحفية المنشورة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 1, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>B.</span> مكتبة كوكرين
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 2, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>C.</span> سجل التجارب السريرية للشركة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 3, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>D.</span> وثائق موافقة إدارة الغذاء والدواء
                      </div>
</div>
<div id="q3-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q3-2">
<h4>2. ما الذي تعنيه كلمة PRESS؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 0, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>A.</span> مراجعة المنشورات لمعايير البحث عن الأدلة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 1, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>B.</span> مراجعة النظراء لاستراتيجيات البحث الإلكتروني
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 2, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>C.</span> بروتوكول الإبلاغ عن دراسات تركيب الأدلة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 3, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>D.</span> نظام البحث عن الأدلة البحثية الأولية
                      </div>
</div>
<div id="q3-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="14">
<p class="refrain animate">ما الذي كان مخفيا على مرأى من الجميع؟</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 4: الفحص</p>
</div>
</div>
 الوحدة 4: الفحص (Vioxx) 
<div class="module-slides" data-module="4">
<div class="slide dark active" data-index="0">
<p class="refrain animate">الرقم بدون مصدر ليس رقمًا.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">هذه قصة حول</p>
<p class="title gold animate delay-1 text-center">ما اختاروا الإبلاغ عنه.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة 4: الفحص</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>تطبيق مخطط تدفق PRISMA لتوثيق اختيار الدراسة</li>
<li>تنفيذ فحص المراجع المزدوج مع حل النزاعات</li>
<li>تحديد تقارير النتائج الانتقائية ومعالجة البيانات</li>
<li>حساب الموثوقية بين التقييمات (كابا كوهين)</li>
<li>تطبيق المبدأ: "الرقم بدون مصدر ليس رقمًا"</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">88,000</p>
<p class="subtitle animate delay-1">النوبات القلبية المنسوبة إلى Vioxx</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">دواء رائج. إشارة مخفية. كارثة يمكن الوقاية منها.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">بين في عامي 1999 و2004، تناول الملايين هذا المسكن. لم يعد البعض إلى المنزل مطلقًا.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">ظهور Vioxx</h2>
<div class="card animate delay-1">
<p class="card-text text-center">كان Rofecoxib (Vioxx) أحد مضادات الالتهاب غير الستيروئيدية الانتقائية لـ COX-2. تم تسويقه على أنه أكثر أمانًا للمعدة من مسكنات الألم التقليدية.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">1999</div>
<div class="stat-label">موافقة ادارة الاغذية والعقاقير</div>
</div>
<div class="stat-box">
<div class="stat-value">$2.5B</div>
<div class="stat-label">ذروة المبيعات السنوية</div>
</div>
<div class="stat-box">
<div class="stat-value">80M+</div>
<div class="stat-label">الموصوف للمرضى</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">تجربة VIGOR (2000)</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1rem;">أبحاث نتائج الجهاز الهضمي فيوكس</p>
<div class="design-grid animate delay-2">
<div class="design-item">
<div class="design-item-label">التصميم</div>
<div class="design-item-value">عشوائية، مزدوجة التعمية</div>
</div>
<div class="design-item">
<div class="design-item-label">مقارنة</div>
<div class="design-item-value">فيوكس مقابل نابروكسين</div>
</div>
<div class="design-item">
<div class="design-item-label">سكان</div>
<div class="design-item-value">التهاب المفاصل الروماتويدي</div>
</div>
<div class="design-item">
<div class="design-item-label">عينة</div>
<div class="design-item-value">8076 مريضا</div>
</div>
<div class="design-item">
<div class="design-item-label">النتيجة الأولية</div>
<div class="design-item-value">أحداث جي آي</div>
</div>
<div class="design-item">
<div class="design-item-label">تم النشر</div>
<div class="design-item-value">NEJM، نوفمبر 2000</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">ما نشرته VIGOR</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>نتيجة جي آي</th>
<th>فيوكس</th>
<th>نابروكسين</th>
</tr>
</thead>
<tbody>
<tr>
<td>أحداث الجهاز الهضمي المؤكدة</td>
<td style="color: var(--green);">2.1 لكل 100 نقطة سنة</td>
<td>4.5 لكل 100 نقطة سنة</td>
</tr>
<tr>
<td>تخفيض</td>
<td colspan="2" style="color: var(--green); font-weight: 700;">أحداث الجهاز الهضمي أقل بنسبة 54%</td>
</tr>
</tbody>
</table>
<div class="card navy-bg animate delay-2">
<p class="card-text text-center">العنوان: فيوكس أكثر أمانًا لمعدتك!</p>
</div>
<p class="footnote animate delay-3">هذا ما قيل للأطباء. هذا ما يعتقده المرضى.</p>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">ما دفنه VIGOR</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>نتيجة السيرة الذاتية</th>
<th>فيوكس</th>
<th>نابروكسين</th>
</tr>
</thead>
<tbody>
<tr>
<td>احتشاء عضلة القلب</td>
<td class="highlight">20 حدثا</td>
<td>4 أحداث</td>
</tr>
<tr>
<td>المخاطر النسبية</td>
<td class="highlight" colspan="2">أعلى بمقدار 5 مرات في مجموعة Vioxx</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-2">
<div class="value">زيادة بمقدار 5 أضعاف في النوبات القلبية</div>
<div class="label">تم ذكرها باختصار فقط، وتعزى إلى كون النابروكسين "واقي للقلب"</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">التقارير الانتقائية</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>التلاعب بقطع البيانات:</strong> حدثت 3 نوبات قلبية إضافية بعد القطع المستخدم في المنشور</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>يلف:</strong> تم شرح إشارة السيرة الذاتية بعيدًا عن كون النابروكسين واقيًا للقلب (لا يوجد دليل)</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>تبديل النتائج:</strong> كانت أحداث السيرة الذاتية محددة مسبقًا ولكن لم تكن كذلك تم التأكيد على</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>المعرفة الداخلية:</strong> تظهر رسائل البريد الإلكتروني من Merck أنهم كانوا على علم بأمر الإشارة</p>
</div>
</div>
</div>
<div class="slide dark" data-index="8">
<div class="content">
<h2 class="title cream animate">تجربة APPROVe (2004)</h2>
<p class="animate delay-1">تجربة للوقاية من سلائل القولون والمستقيم - توقفت مبكرًا من أجل السلامة.</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">RR 1.92</div>
<div class="stat-label">أحداث السيرة الذاتية مقابل الدواء الوهمي</div>
</div>
<div class="stat-box">
<div class="stat-value">سبتمبر 2004</div>
<div class="stat-label">تم سحب Vioxx</div>
</div>
</div>
<p class="animate delay-3" style="margin-top: 1.5rem; color: var(--gold); font-style: italic; text-align: center;">
                  بعد أربع سنوات من ظهور VIGOR لخطر 5x. أربع سنوات متأخرة جداً.
                </p>
</div>
</div>
 القصة: قرار Vioxx الشجرة 
<div class="slide dark" data-index="8b">
<div class="story-box animate">
<p class="story-opener">هل فكرت فيما يحدث عندما تختبئ الإشارة في الضوضاء؟</p>
<div class="real-data-box">
<h4>البيانات الحقيقية</h4>
<p>
                    تمت الموافقة على Vioxx (rofecoxib) في <span class="data-highlight">1999</span>.
                    By <span class="data-highlight">2004</span>، تشير التقديرات
                    <span class="data-highlight">88.000-140.000 نوبة قلبية زائدة</span> and
                    <span class="data-highlight">30.000-40.000 حالة وفاة</span>. أظهرت تجربة VIGOR الخاصة بشركة Merck <span class="data-highlight">5x خطر على القلب والأوعية الدموية</span> في عام 2000، ولكن تم رفضه باعتباره "تأثير النابروكسين الواقي للقلب".
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">الشوكة في الطريق</div>
<div class="decision-scenario">
                    أنت أحد مراجعي إدارة الغذاء والدواء في عام 2001. تظهر بيانات VIGOR خطر الإصابة بنوبة قلبية 5x مع Vioxx مقابل النابروكسين.
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">المسار أ: قبول الشرح</div>
<div class="path-choice">صدق فرضية ميرك: النابروكسين واقي للقلب</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">لا توجد دراسات سلامة إضافية مطلوبة. يبقى الدواء في السوق بأقصى سرعة.</div>
<div class="path-outcome">النتيجة: أكثر من 40,000 حالة وفاة على مدار 4 سنوات</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">المسار ب: طلب الأدلة</div>
<div class="path-choice">تتطلب تجربة سلامة السيرة الذاتية المخصصة قبل مواصلة التسويق</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">تأخير أو تقييد التسويق حتى يتم التأكد من سلامة القلب والأوعية الدموية.</div>
<div class="path-outcome">النتيجة: تم اكتشاف الإشارة مبكرًا، مما أدى إلى إنقاذ الأرواح</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">الرؤيا</div>
<div class="revelation-text">
                    الإشارة كان هناك في عام 2000. والتفسير الخاطئ أخر العمل لمدة 4 سنوات. فرضية بديلة - تم قبولها بدون دليل - كلفت عشرات الآلاف من الأرواح.
                  </div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">مخطط تدفق بريسما</h2>
<p class="animate delay-1" style="font-style: italic; margin-bottom: 1rem;">يجب أن تكون كل خطوة من خطوات الفحص موثقة وشفافة.</p>
<div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
<div class="stat-box animate delay-1" style="width: 300px;"><div class="stat-value">تعريف</div><div class="stat-label">سجلات من قواعد البيانات + مصادر أخرى</div></div>
<div class="arrow animate delay-1" style="font-size: 1.5rem;">↓</div>
<div class="stat-box animate delay-2" style="width: 300px;"><div class="stat-value">الفحص</div><div class="stat-label">مراجعة العنوان/الملخص (تمت إزالة التكرارات)</div></div>
<div class="arrow animate delay-2" style="font-size: 1.5rem;">↓</div>
<div class="stat-box animate delay-3" style="width: 300px;"><div class="stat-value">الأهلية</div><div class="stat-label">تقييم النص الكامل (مع أسباب الاستبعاد)</div></div>
<div class="arrow animate delay-3" style="font-size: 1.5rem;">↓</div>
<div class="stat-box animate delay-4" style="width: 300px; background: var(--gold); color: var(--navy);"><div class="stat-value">متضمنة</div><div class="stat-label">دراسات في التركيب</div></div>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">الفحص المزدوج: لماذا مراجعان؟</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>يقلل من تحيز الاختيار</h4>
<p>قد يفضل أحد المراجعين دون وعي دراسات معينة</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>يصيد الأخطاء</h4>
<p>الإرهاق وسوء القراءة والأخطاء أمر لا مفر منه</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>القوى معايير صريحة</h4>
<p>تكشف الخلافات الغموض في قواعد الإدماج</p>
</div>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">اتفاق نموذجي: κ = 0.6-0.8</p>
<p class="sub">يتم حل الخلافات عن طريق المناقشة أو المراجع الثالث</p>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">المعايرة: المرحلة التجريبية</h2>
<div class="card animate delay-1">
<p class="card-text text-center">قبل فحص آلاف السجلات، يجب على المراجعين معايرة عينة مكونة من 50 إلى 100 سجل.</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">1</div>
<p>شاشة نفس المجموعة بشكل مستقل</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">2</div>
<p>مقارنة القرارات ومناقشة الخلافات</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">3</div>
<p>تحسين معايير الاشتمال حتى κ &gt; 0.7</p>
</div>
<div class="wrong-item animate delay-5">
<div class="wrong-number">4</div>
<p>توثيق عملية المعايرة وأي قاعدة التغييرات</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">تحديثات بريسما 2020</h2>
<div class="design-grid animate delay-1" style="grid-template-columns: 1fr 1fr;">
<div class="design-item">
<div class="design-item-label">جديد في عام 2020</div>
<div class="design-item-value">تقارير منفصلة عن قاعدة البيانات مقابل عمليات البحث في التسجيل</div>
</div>
<div class="design-item">
<div class="design-item-label">جديد في عام 2020</div>
<div class="design-item-value">يجب الإبلاغ عن أدوات التشغيل الآلي</div>
</div>
<div class="design-item">
<div class="design-item-label">جديد في عام 2020</div>
<div class="design-item-value">تم توثيق البحث عن الاقتباس بشكل منفصل</div>
</div>
<div class="design-item">
<div class="design-item-label">جديد في عام 2020</div>
<div class="design-item-value">أسباب الاستبعاد في النص الكامل إلزامية</div>
</div>
</div>
<p class="footnote animate delay-2">أضاف PRISMA 2020 7 عناصر جديدة لتحسين الشفافية.</p>
</div>
</div>
<div class="slide dark" data-index="13">
<p class="closing-line animate">إذا تم فحص بيانات القلب والأوعية الدموية الخاصة بـ Vioxx من قبل مراجعين مستقلين،</p>
<p class="closing-line animate delay-1">إذا كان مطلوبًا الإبلاغ عن جميع النتائج المحددة مسبقًا،</p>
<p class="closing-line gold animate delay-2">كان من الممكن منع 88000 نوبة قلبية.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">الرقم بدون مصدر ليس رقمًا.</p>
</div>
<!-- Quiz -->
<div class="slide light" data-index="14">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 4</h2>
<div class="quiz-container">
<div class="quiz-question" id="q4-1">
<h4>1. في تجربة VIGOR، ما هو الخطر النسبي لـ MI في مجموعة Vioxx مقارنةً بالنابروكسين؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 0, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>A.</span> أعلى بمقدار 1.5 مرة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 1, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>B.</span> 2x أعلى
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 2, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>C.</span> أعلى بمقدار 5 مرات
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 3, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>D.</span> أعلى بـ 10 مرات
                      </div>
</div>
<div id="q4-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q4-2">
<h4>2. ما أهمية الفحص المزدوج (مراجعان مستقلان)؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 0, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>A.</span> يجعل الفحص أسرع
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 1, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>B.</span> فهو يقلل من التحيز في الاختيار ويكتشف الأخطاء
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 2, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>C.</span> إنه يقلل من عدد الدراسات التي يجب مراجعتها
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 3, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>D.</span> يسمح للمراجعين بتخطي مراجعة النص الكامل
                      </div>
</div>
<div id="q4-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="15">
<p class="refrain animate">الرقم بدون مصدر ليس رقمًا.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 5: الاستخلاص</p>
</div>
</div>
 الوحدة 5: الاستخلاص (DECREASE) 
<div class="module-slides" data-module="5">
<div class="slide dark active" data-index="0">
<p class="refrain animate">الرقم بدون مصدر ليس رقمًا.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">هذه قصة حول</p>
<p class="title gold animate delay-1 text-center">الأرقام التي لم تكن موجودة من قبل.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة 5: الاستخلاص</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>تصميم نموذج موحد لاستخراج البيانات مع حقول المصدر</li>
<li>حساب أحجام التأثير من مختلف الإحصاءات المبلغ عنها (OR، RR، HR، SMD)</li>
<li>تنفيذ الاستخراج المزدوج مع حل التناقض</li>
<li>تحديد العلامات الحمراء لتلفيق البيانات وسوء السلوك</li>
<li>اشرح كيف أثر الاحتيال في DECREASE على الإرشادات السريرية</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">~10,000</p>
<p class="subtitle animate delay-1">الوفيات الزائدة المحتملة في أوروبا</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">من الإرشادات المستندة إلى التجارب السريرية الملفقة البيانات.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">أثرت تجارب DECREASE على الرعاية المحيطة بالجراحة في جميع أنحاء العالم. تم اختراع البيانات.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">دون بولدرمانز: باحث نجم</h2>
<div class="card animate delay-1">
<p class="card-text text-center">أستاذ في مركز إيراسموس الطبي، روتردام. مؤلف أكثر من 500 ورقة. المؤلف الرئيسي للمبادئ التوجيهية ESC بشأن رعاية القلب المحيطة بالجراحة.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">500+</div>
<div class="stat-label">المنشورات</div>
</div>
<div class="stat-box">
<div class="stat-value">ينقص</div>
<div class="stat-label">سلسلة المحاكمة من الأول إلى السادس</div>
</div>
<div class="stat-box">
<div class="stat-value">ESC</div>
<div class="stat-label">كرسي التوجيهي</div>
</div>
</div>
<p class="footnote animate delay-3">مصدر يبدو لا يرقى إليه الشك. حتى ينظر شخص ما إلى البيانات.</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">تجارب DECREASE: المطالبة</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>محاكمة</th>
<th>العثور على</th>
<th>تأثير</th>
</tr>
</thead>
<tbody>
<tr>
<td>انخفاض-I (1999)</td>
<td>انخفاض بنسبة 90% في حالات الوفاة القلبية</td>
<td>المبادئ التوجيهية المتغيرة</td>
</tr>
<tr>
<td>التخفيض الرابع (2009)</td>
<td>حاصرات بيتا آمنة في المخاطر المنخفضة</td>
<td>توصيات موسعة</td>
</tr>
</tbody>
</table>
<div class="focus-box animate delay-2 mt-2">
<p class="main">وكانت أحجام التأثير كبيرة بشكل غير معقول.</p>
<p class="sub">تخفيض 90%؟ لا يوجد شيء تقريبًا في الطب يعمل بشكل جيد.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">التحقيق: 2011</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p>تم التحقيق في Erasmus MC بعد شكاوى المبلغين عن المخالفات</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>بيانات المرضى الملفقة:</strong> المرضى الذين لم يكونوا موجودين أو لم يتم تسجيلهم</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>لا توجد موافقة مستنيرة:</strong> لم يوافق العديد من "المشاركين" أبدًا</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>تم طرد Poldermans:</strong> من Erasmus MC في عام 2011</p>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="content">
<h2 class="title cream animate">سلسلة الضرر</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">عندما تمت إزالة DECREASE من التحليلات الوصفية...</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">المنفعة → الضرر</div>
<div class="stat-label">الاتجاه المعكوس</div>
</div>
<div class="stat-box">
<div class="stat-value">27% ↑</div>
<div class="stat-label">زيادة خطر السكتة الدماغية</div>
</div>
</div>
<p class="animate delay-3" style="margin-top: 1.5rem; color: var(--gold); font-style: italic; text-align: center;">
                  لقد أظهرت تجربة POISE (2008) ضررًا. تم رفضه لأنه يتعارض مع DECREASE.
                </p>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">لماذا لم يتم اكتشاف هذا؟</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>الثقة في السلطة:</strong> كان بولديرمانز مؤلف المبادئ التوجيهية الذي قام بمراجعة الأدلة الخاصة به</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>لا يوجد التحقق من البيانات:</strong> لم يطلب أحد بيانات المريض الفردية</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>مكانة النشر:</strong> منشور في أفضل المجلات، ويفترض أنه صالح</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>قبول التأثيرات غير المعقولة:</strong> يجب أن تثير التخفيضات بنسبة 90% الشكوك</p>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">استخراج البيانات: الدفاع ضد الاحتيال</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>الاستخراج المزدوج</h4>
<p>مستخرجان بشكل مستقل - يكتشفان أخطاء النسخ ويفرضان التدقيق</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>مصدر السجل</h4>
<p>جدول، صفحة، فقرة - كل رقم يمكن تتبعه إلى المصدر</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>التحقق من التسجيل</h4>
<p>ClinicalTrials.gov النتائج مقابل النشر - التناقضات هي علامات حمراء</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>طلب IPD</h4>
<p>تكشف بيانات المريض الفردية ما تخفيه الملخصات الإجمالية</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">حساب حجم التأثير</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">أثناء الاستخراج، يمكنك حساب أحجام التأثير من البيانات المبلغ عنها:</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 700px;">
<div class="card animate delay-2">
<div class="card-label">النتائج الثنائية</div>
<p class="card-text" style="font-size: 0.85rem;">نسبة الأرجحية، نسبة المخاطرة، فرق المخاطرة من جداول 2x2</p>
</div>
<div class="card animate delay-3">
<div class="card-label">نتائج مستمرة</div>
<p class="card-text" style="font-size: 0.85rem;">فرق المتوسط، فرق المتوسط الموحد بين الوسائل وSD</p>
</div>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">استخرج دائمًا من المصدر الأكثر موثوقية.</p>
<p class="sub">تفضل: نتائج ITT &gt; لكل بروتوكول &gt; المجموعات الفرعية</p>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">الأعلام الحمراء أثناء الاستخراج</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">!</div>
<p><strong>أحجام التأثير غير المعقول:</strong> يجب أن تؤدي التخفيضات بنسبة 80-90% إلى التدقيق</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">!</div>
<p><strong>الاختلالات الأساسية:</strong> المجموعات التي "متطابق تمامًا"</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">!</div>
<p><strong>أرقام الجولة:</strong> "بالضبط 50" أو "بالضبط 100" مريض لكل ذراع</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">!</div>
<p><strong>تناقضات التسجيل:</strong> يختلف N المنشور عن N المسجل</p>
</div>
</div>
</div>
<div class="slide dark" data-index="11">
<p class="closing-line animate">كل رقم في تحليلك التلوي</p>
<p class="closing-line animate delay-1">يجب أن يعود إلى مصدر يمكن التحقق منه.</p>
<p class="closing-line gold animate delay-2">الرقم بدون مصدر ليس رقمًا.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">من الممكن أن تؤدي البيانات الاحتيالية إلى الوفاة تمامًا مثل الأدوية الاحتيالية.</p>
</div>
<!-- Quiz -->
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 5</h2>
<div class="quiz-container">
<div class="quiz-question" id="q5-1">
<h4>1. ماذا حدث عندما تمت إزالة بيانات تجربة DECREASE من التحليلات الوصفية لحاصرات بيتا؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 0, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>A.</span> أصبحت الفائدة أكبر
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 1, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>B.</span> لا يوجد تغيير في الاستنتاجات
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 2, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>C.</span> الاتجاه المعاكس لإظهار الضرر المحتمل
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 3, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>D.</span> أصبحت النتائج غير حاسمة
                      </div>
</div>
<div id="q5-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q5-2">
<h4>2. لماذا يجب أن يكون الاستخراج المزدوج ممارسة قياسية؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 0, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>A.</span> يرصد أخطاء النسخ ويفرض التدقيق
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 1, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>B.</span> يجعل الاستخراج أسرع
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 2, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>C.</span> إنها تساعد في العثور على المزيد من الدراسات
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 3, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>D.</span> يقلل من مقدار العمل المطلوب
                      </div>
</div>
<div id="q5-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">الرقم بدون مصدر ليس رقمًا.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 6: التحيز</p>
</div>
</div>
 الوحدة 6: التحيز (Aprotinin/BART) 
<div class="module-slides" data-module="6">
<div class="slide dark active" data-index="0">
<p class="refrain animate">الطرق تحمي المرضى من ثقتنا.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">هذه قصة حول</p>
<p class="title gold animate delay-1 text-center">التحيز الذي لا يمكننا رؤيته.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة 6: التحيز</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>تطبيق خطر التحيز 2.0 (RoB 2) على التجارب العشوائية</li>
<li>تطبيق ROBINS-I على الدراسات غير العشوائية</li>
<li>تقييم جميع مجالات RoB 2 الخمسة (العشوائية، والانحرافات، والبيانات المفقودة، والقياس، والاختيار)</li>
<li>التمييز بين الإرباك من خلال الإشارة من آثار العلاج الحقيقية</li>
<li>اشرح كيف كشف تحليل بارت عن الأضرار الخفية للأبروتينين</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">20+</p>
<p class="subtitle animate delay-1">سنوات في السوق</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">كان الأبروتينين هو المعيار الذهبي لتقليل النزيف الجراحي.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">ثم أجرى أحدهم تجربة معشاة ذات شواهد. الحقيقة كانت مختلفة.</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">التحيز الخفي: الإرباك من خلال الإشارة</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>حصل المرضى المرضى على أبروتينين:</strong> استخدمه الجراحون في الحالات المعقدة عالية الخطورة</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>انحياز الناجين:</strong> لا يمكن للمرضى المتوفين الإبلاغ عن المضاعفات</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>تحيز النشر:</strong> لم يتم نشر الدراسات السلبية</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">لم تتمكن الدراسات الرصدية من فصل تأثير الدواء عن المخاطر الأساسية للمريض.</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">بارت: الحقيقة العشوائية</h2>
<p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">الحفاظ على الدم باستخدام مضادات انحلال الفيبرين في تجربة عشوائية</p>
<table class="results-table animate delay-2">
<thead><tr><th>حصيلة</th><th>أبروتينين</th><th>البدائل</th></tr></thead>
<tbody>
<tr><td>معدل الوفيات لمدة 30 يومًا</td><td class="highlight">6.0%</td><td>3.9%</td></tr>
<tr><td>المخاطر النسبية</td><td class="highlight" colspan="2">1.53 (53% زيادة في الوفيات)</td></tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">إيقاف التجربة مبكرًا بسبب الضرر</div>
<div class="label">تم سحبها من السوق في نوفمبر 2007</div>
</div>
</div>
</div>
 تمرين التحقيق 
<div class="slide dark" data-index="5">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>التحقيق: تقييم التحيز</h3>
</div>
<p class="direct-address">أنت تقوم بمراجعة الدراسات الرصدية. تطبيق خطر التفكير المتحيز:</p>
<table class="data-table-investigation">
<thead><tr><th>سؤال</th><th>رصدي</th><th>بارت (RCT)</th></tr></thead>
<tbody>
<tr><td>تخصيص عشوائي؟</td><td>❌ اختيار الجراح</td><td>✓ نعم</td></tr>
<tr><td>يمكن مقارنة خط الأساس؟</td><td>❌ تعاطي سيكر</td><td>✓ متوازن</td></tr>
<tr><td>المسببة للعمى؟</td><td>❌ التسمية المفتوحة</td><td>✓ مزدوج التعمية</td></tr>
</tbody>
</table>
<button class="reveal-btn" onclick="revealAnswer('bias-reveal')">راجع الرؤية الأساسية →</button>
<div class="hidden-reveal" id="bias-reveal">
<p><strong>الخلط بالإشارة:</strong> أعطى الجراحون أبروتينين للمرضى الأكثر مرضًا. عزت الدراسات الرصدية البقاء على قيد الحياة إلى الدواء، عندما كانت تقيس تحيز البقاء على قيد الحياة.</p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">خطر التحيز 2.0: المجالات الخمسة</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">D1</div>
<div class="lesson-content"><h4>عملية التوزيع العشوائي</h4></div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">D2</div>
<div class="lesson-content"><h4>الانحرافات عن التدخلات المقصودة</h4></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">D3</div>
<div class="lesson-content"><h4>بيانات النتائج المفقودة</h4></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">D4</div>
<div class="lesson-content"><h4>قياس النتيجة</h4></div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">D5</div>
<div class="lesson-content"><h4>اختيار التقارير المبلغ عنها النتيجة</h4></div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">ROBINS-I: للدراسات غير العشوائية</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">عندما لا تكون التجارب المعشاة ذات الشواهد متاحة، استخدم ROBINS-I (خطر التحيز في الدراسات غير العشوائية للتدخلات)</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #7c3aed;">1</div>
<div class="lesson-content"><h4>مربك</h4><p>الاختلافات الأساسية بين المجموعات</p></div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #7c3aed;">2</div>
<div class="lesson-content"><h4>اختيار المشاركين</h4><p>الاستثناءات ذات الصلة للتدخل</p></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #7c3aed;">3</div>
<div class="lesson-content"><h4>تصنيف التدخلات</h4><p>سوء تصنيف حالة التعرض</p></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #7c3aed;">4</div>
<div class="lesson-content"><h4>الانحرافات عن التدخلات المقصودة</h4><p>التدخلات المشتركة، التلوث</p></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #7c3aed;">5</div>
<div class="lesson-content"><h4>البيانات المفقودة</h4><p>الخسارة التفاضلية للمتابعة</p></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #7c3aed;">6</div>
<div class="lesson-content"><h4>قياس النتائج</h4><p>انحياز التأكد</p></div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number" style="background: #7c3aed;">7</div>
<div class="lesson-content"><h4>اختيار النتيجة المبلغ عنها</h4><p>تقارير انتقائية</p></div>
</div>
<p class="footnote animate delay-5" style="margin-top: 1rem;">التقييمات: منخفضة / متوسطة / خطيرة / حرجة / لا توجد معلومات</p>
</div>
</div>
<div class="slide dark" data-index="8">
<p class="closing-line animate">اقترحت الدراسات الرصدية السلامة.</p>
<p class="closing-line animate delay-1">كشفت التجارب المعشاة ذات الشواهد عن زيادة في معدل الوفيات بنسبة 53%.</p>
<p class="closing-line gold animate delay-2">التوزيع العشوائي فقط يمكنه كسر الإرباك.</p>
<div class="gold-line animate delay-3"></div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 6</h2>
<div class="quiz-container">
<div class="quiz-question" id="q6-1">
<h4>1. لماذا أخطأت الدراسات الرصدية ضرر الأبروتينين؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 0, 1, ['Sample size was adequate.', 'Correct! Sicker patients got the drug, masking its harm.', 'Outcomes were measured correctly.', 'Duration was adequate.'])">
<span>A.</span> أحجام العينات صغيرة جدًا
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 1, 1, ['Sample size was adequate.', 'Correct! Sicker patients got the drug, masking its harm.', 'Outcomes were measured correctly.', 'Duration was adequate.'])">
<span>B.</span> مربكة بالإشارة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 2, 1, ['Sample size was adequate.', 'Correct! Sicker patients got the drug, masking its harm.', 'Outcomes were measured correctly.', 'Duration was adequate.'])">
<span>C.</span> تم قياس النتيجة بشكل غير صحيح
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 3, 1, ['Sample size was adequate.', 'Correct! Sicker patients got the drug, masking its harm.', 'Outcomes were measured correctly.', 'Duration was adequate.'])">
<span>D.</span> المتابعة قصيرة جدًا
                      </div>
</div>
<div id="q6-1-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="9">
<p class="refrain animate">الطرق تحمي المرضى من ثقتنا.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة السابعة: التركيب</p>
</div>
</div>
 الوحدة السابعة: التركيب (مغنيسيوم/ISIS-4) 
<div class="module-slides" data-module="7">
<div class="slide dark active" data-index="0">
<p class="refrain animate">التجانس رسالة وليس ضجيج.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">الجدل حول المغنيسيوم: 1991-1995</p>
<p class="title gold animate delay-1 text-center">عندما يؤدي التجميع إلى الضلال.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة السابعة: التركيب</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>احسب أحجام التأثير المجمعة باستخدام نماذج التأثير الثابت والتأثيرات العشوائية</li>
<li>اختر بين مقدرات DerSimonian-Laird وHKSJ بشكل مناسب</li>
<li>تفسير مخططات الغابة بما في ذلك الأوزان وفترات الثقة والماس</li>
<li>اشرح لماذا يمكن لتأثيرات الدراسات الصغيرة أن تضلل التحليلات الوصفية</li>
<li>طبق مبدأ: "التجانس رسالة وليس ضجيج"</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">السنة: 1991</h2>
<p class="direct-address animate delay-1">
                  "أنت تقف على مفترق طرق الأمل و الأدلة..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    تقتل أمراض القلب عددًا أكبر من الأشخاص في جميع أنحاء العالم مقارنة بأي سبب آخر. في عام 1991، ظهر أمل جديد: هل يمكن لشيء بسيط ورخيص مثل
                    <strong>المغنيسيوم الوريدي</strong> أن ينقذ الأرواح بعد احتشاء عضلة القلب؟
                  </p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">كان الأساس المنطقي البيولوجي سليمًا:</p>
<p class="sub">يعمل المغنيسيوم على استقرار أغشية القلب، ويمنع عدم انتظام ضربات القلب، ويوسع الأوعية الدموية للشرايين التاجية.</p>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">الحد-2: تجربة المعالم</h2>
<p class="animate delay-1" style="font-style: italic;">تجربة التدخل الوريدي للمغنيسيوم في ليستر، 1992</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">2,316</div>
<div class="stat-label">المرضى المسجلون</div>
</div>
<div class="stat-box" style="background: rgba(34, 197, 94, 0.2); border-color: #22c55e;">
<div class="stat-value">24%</div>
<div class="stat-label">خفض معدل الوفيات</div>
</div>
<div class="stat-box">
<div class="stat-value">p = 0.04</div>
<div class="stat-label">ذات دلالة إحصائية</div>
</div>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">تدخل رخيص وآمن يمكن أن ينقذ حياة 250 ألف شخص سنويا على مستوى العالم.</p>
<p class="sub">كان المجتمع الطبي مكهربًا.</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">التحليل التلوي: 1993</h2>
<p class="animate delay-1">تجمع الباحثون <strong>سبع تجارب عشوائية</strong> من المغنيسيوم الرابع في MI:</p>
<table class="results-table animate delay-2">
<thead>
<tr>
<th>محاكمة</th>
<th>Year</th>
<th>N</th>
<th>نسبة الاحتمالات</th>
</tr>
</thead>
<tbody>
<tr><td>مورتون 1984</td><td>1984</td><td>40</td><td style="color: var(--green);">0.10</td></tr>
<tr><td>راسموسن 1986</td><td>1986</td><td>273</td><td style="color: var(--green);">0.35</td></tr>
<tr><td>سميث 1986</td><td>1986</td><td>400</td><td style="color: var(--green);">0.48</td></tr>
<tr><td>ابراهيم 1987</td><td>1987</td><td>94</td><td>0.87</td></tr>
<tr><td>شيشتر 1990</td><td>1990</td><td>103</td><td style="color: var(--green);">0.27</td></tr>
<tr><td>سيريموزينسكي 1989</td><td>1989</td><td>48</td><td style="color: var(--green);">0.22</td></tr>
<tr><td>الحد-2</td><td>1992</td><td>2,316</td><td style="color: var(--green);">0.74</td></tr>
</tbody>
</table>
</div>
</div>
<div class="slide dark" data-index="5">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>تمرين التحقيق: معضلة المحلل التلوي</h3>
</div>
<p class="direct-address">
                  أنت أحد مراجعي كوكرين في عام 1993. لقد طُلب منك تجميع الأدلة على المغنيسيوم لMI. البيانات من سبع تجارب موجودة أمامك.
                </p>
<p class="rhetorical" style="margin: 1rem 0;">
                  هل ترى النمط في قطعة الغابة هذه؟
                </p>
<div id="magnesium-forest-small" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
<button class="reveal-btn" onclick="drawMagnesiumForest('small')">إنشاء قطعة أرض للغابات →</button>
<button class="reveal-btn" onclick="revealAnswer('mag-pooled')">تجميع الأدلة →</button>
</div>
<div class="hidden-reveal" id="mag-pooled">
<div class="result-box" style="background: rgba(34, 197, 94, 0.2); border-color: #22c55e;">
<div class="value">نسبة الأرجحية المجمعة = 0.44 (فاصل الثقة 95%: 0.27-0.71)</div>
<div class="label">تخفيض معدل الوفيات بنسبة 55%! نشر في مجلة لانسيت؟</div>
</div>
<p style="text-align: center; margin-top: 1rem; font-style: italic;">
                    لكن مهلا... هل لاحظت أي شيء عن أحجام التجارب؟
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">علامات التحذير</h2>
<p class="rhetorical animate">ما الذي كان يجب أن يمنحنا وقفة؟</p>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>أحجام العينات الصغيرة:</strong> كان لدى ستة من سبع تجارب أقل من 500 مريض</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>التأثيرات القصوى:</strong> أو 0.10 (تخفيض بنسبة 90%) غير قابل للتصديق لأي دواء</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>الكل إيجابي:</strong> أين كانت التجارب السلبية؟ مشكلة درج الملفات...</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>عدم تناسق القمع:</strong> أظهرت التجارب الصغيرة تأثيرات أكبر بكثير من التجارب الأكبر</p>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>اختبار مؤامرة القمع</h3>
</div>
<p class="direct-address">
                  قبل أن نقوم بالتجميع، يجب علينا التحقق من تحيز النشر. دعونا نفحص مؤامرة القمع.
                </p>
<div id="magnesium-funnel-small" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<button class="reveal-btn" onclick="drawMagnesiumFunnel('small')">إنشاء مخطط قمع →</button>
<div id="mag-funnel-interpretation" style="display: none; margin-top: 1rem;">
<div class="focus-box" style="border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">⚠️ قمع غير متماثل</p>
<p class="sub">التجارب الصغيرة تتجمع على اليسار (تظهر الفائدة). أين هي التجارب السلبية الصغيرة؟</p>
<p class="sub">اختبار إيجر ع = 0.04 — عدم تناسق ذو دلالة إحصائية.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">السنة: 1995 – تقارير داعش-4</h2>
<p class="direct-address animate delay-1">
                  "ثم جاءت الحقيقة ..."
                </p>
<div class="card animate delay-2">
<p class="card-text text-center">
                    The <strong>الدراسة الدولية الرابعة للبقاء على قيد الحياة أثناء الاحتشاء (ISIS-4)</strong>
                    تم تسجيل 58,050 مريضًا في 1,086 مستشفى في 31 دولة.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">58,050</div>
<div class="stat-label">مرضى</div>
</div>
<div class="stat-box">
<div class="stat-value">2,216</div>
<div class="stat-label">الوفيات في مجموعة ملغ</div>
</div>
<div class="stat-box">
<div class="stat-value">2,103</div>
<div class="stat-label">الوفيات في العلاج الوهمي</div>
</div>
</div>
<div class="result-box animate delay-4" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">OR = 1.06 (95% CI: 1.00–1.12)</div>
<div class="label">لا فائدة. إذا كان هناك أي شيء، فإن الاتجاه نحو الأذى.</div>
</div>
</div>
</div>
<div class="slide dark" data-index="9">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>قبل وبعد: الصورة الكاملة</h3>
</div>
<p class="direct-address">
                  شاهد ماذا يحدث عندما نضيف التجربة الضخمة إلى قطعة أرض الغابة الخاصة بنا...
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">قبل داعش-4</h4>
<p>7 تجارب صغيرة (العدد = 3,274)</p>
<p style="color: #22c55e; font-weight: bold;">OR = 0.44</p>
<p style="font-size: 0.9rem;">إشارة فائدة قوية</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">بعد إيزيس-4</h4>
<p>8 تجارب (ن = 61,324)</p>
<p style="color: #C53030; font-weight: bold;">OR = 1.02</p>
<p style="font-size: 0.9rem;">لا تأثير</p>
</div>
</div>
<div id="magnesium-forest-full" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<button class="reveal-btn" onclick="drawMagnesiumForest('full')">عرض مؤامرة الغابة كاملة →</button>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">لماذا كانت التجارب الصغيرة مضللة؟</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>انحياز النشر</h4>
<p>لم تُنشر التجارب السلبية الصغيرة مطلقًا، بل ظلت في أدراج الملفات</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>تأثيرات الدراسات الصغيرة</h4>
<p>تميل التجارب الأصغر إلى إظهار تأثيرات أكبر بسبب نقاط الضعف المنهجية</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>التحيز العشوائي العالي</h4>
<p>عن طريق الصدفة، توصلت بعض التجارب الصغيرة إلى نتائج متطرفة، وتم نشرها</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>تضخيم التأثيرات العشوائية</h4>
<p>تعطي نماذج التأثيرات العشوائية وزنًا أكبر للتجارب الصغيرة، مما يؤدي إلى تضخيم التحيز</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">تأثير واحد ثابت مقابل تأثيرات عشوائية</h2>
<p class="rhetorical animate">ما هو النموذج الذي يجب أن تختاره؟</p>
<div class="animate delay-1" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 850px;">
<div class="card" style="border-right: 4px solid #3b82f6;">
<div class="card-label">نموذج التأثير الثابت</div>
<p class="card-text">يفترض <strong>تأثير حقيقي واحد</strong>. دراسات الأوزان بالتباين العكسي (الدقة). المحاكمات الكبيرة تهيمن.</p>
<p style="font-size: 0.85rem; color: var(--navy); margin-top: 0.5rem;">
<strong>نتيجة المغنيسيوم :</strong> OR = 0.96 (p = 0.52)
                    </p>
</div>
<div class="card" style="border-right: 4px solid #f59e0b;">
<div class="card-label">نموذج التأثيرات العشوائية</div>
<p class="card-text">يفترض <strong>توزيع التأثيرات</strong>. يعطي وزنا أكبر للتجارب الصغيرة. فترات ثقة أوسع.</p>
<p style="font-size: 0.85rem; color: var(--navy); margin-top: 0.5rem;">
<strong>نتيجة المغنيسيوم :</strong> OR = 0.59 (p = 0.01)
                    </p>
</div>
</div>
<div class="focus-box animate delay-2 mt-2" style="border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">⚠️ اختيار الموديل هو الذي حدد النتيجة!</p>
<p class="sub">التأثيرات العشوائية لا تعمل على إصلاح التحيز؛ مع تأثيرات الدراسات الصغيرة، قد يؤدي ذلك إلى تحويل الوزن نحو تجارب أصغر وتغيير الاستنتاجات.</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">دروس المغنيسيوم</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.1rem;">
<strong>1. التحقق من تحيز النشر</strong> قبل الثقة في التقدير المجمع. إن مخططات القمع واختبار إيجر هي أدواتك.
                  </p>
</div>
<div class="card animate delay-2">
<p class="card-text" style="font-size: 1.1rem;">
<strong>2. كن حذرًا من تأثيرات الدراسة الصغيرة.</strong> إذا أظهرت التجارب الصغيرة فقط فائدة، فانتظر تجربة كبيرة جيدة التنفيذ.
                  </p>
</div>
<div class="card animate delay-3">
<p class="card-text" style="font-size: 1.1rem;">
<strong>3. اختيار النموذج مهم.</strong> يمكن أن تؤدي التأثيرات العشوائية إلى تضخيم الأدلة المتحيزة. النظر في كلا النموذجين وفهم الآثار المترتبة على ذلك.
                  </p>
</div>
<div class="card animate delay-4">
<p class="card-text" style="font-size: 1.1rem;">
<strong>4. يمكن لمحاكمة واحدة كبيرة أن تقلب الكثير من التجارب الصغيرة.</strong>
                    ولهذا السبب فإن التجارب الضخمة مثل إيزيس-4 تعتبر ذات قيمة كبيرة.
                  </p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة السابعة</h2>
<div class="quiz-container">
<div class="quiz-question" id="q7-1">
<h4>1. لماذا أظهر التحليل التلوي للمغنيسيوم فائدة لم يجدها IS-4؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 0, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>A.</span> كانت منهجية داعش-4 معيبة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 1, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>B.</span> خطأ في الحساب في التحليل التلوي
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 2, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>C.</span> تحيز النشر في التجارب الصغيرة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 3, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>D.</span> كان LIMIT-2 ضعيف القوة
                      </div>
</div>
<div id="q7-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q7-2" style="margin-top: 1.5rem;">
<h4>2. ما هي العلامة التحذيرية التي ينبغي أن تنبه المراجعين إلى التحيز المحتمل؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 0, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>A.</span> مخطط قمع غير متماثل (تجارب صغيرة تظهر تأثيرات أكبر)
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 1, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>B.</span> عدم تجانس منخفض (I² = 0%)
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 2, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>C.</span> معقولية بيولوجية قوية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 3, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>D.</span> عدد قليل جدًا من التجارب التي يمكن تحليلها
                      </div>
</div>
<div id="q7-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q7-3" style="margin-top: 1.5rem;">
<h4>3. عند الاشتباه في تحيز النشر، ما النموذج الذي قد يؤدي إلى تضخيم التحيز؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 0, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>A.</span> نموذج التأثير الثابت
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 1, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>B.</span> نموذج التأثيرات العشوائية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 2, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>C.</span> النموذج البايزي
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 3, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>D.</span> التحليل التلوي للشبكة
                      </div>
</div>
<div id="q7-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="14">
<p class="closing-line animate">يمكن أن تظهر التجارب الصغيرة إشارات خاطئة.</p>
<p class="closing-line animate delay-1">المحاكمات الكبيرة تثبت الحقيقة.</p>
<p class="closing-line gold animate delay-2">التجانس رسالة وليس ضجيج.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="15">
<p class="refrain animate">التجانس رسالة وليس ضجيج.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 8: عدم التجانس</p>
</div>
</div>
 الوحدة 8: التباين (ACCORD) 
<div class="module-slides" data-module="8">
<div class="slide dark active" data-index="0">
<p class="refrain animate">التجانس رسالة وليس ضجيج.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">ACCORD: 2008</p>
<p class="title gold animate delay-1 text-center">عندما يخفي المتوسط الحقيقة.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة 8: عدم التجانس</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>حساب وتفسير فترات I² وτ² والتنبؤ</li>
<li>تطبيق معايير ICEMAN لتقييم مصداقية المجموعة الفرعية</li>
<li>التمييز بين عدم التجانس السريري والمنهجي والإحصائي</li>
<li>إجراء وتفسير تحليلات حساسية الإجازة الواحدة</li>
<li>اشرح كيف كشف ACCORD عن التأثيرات التفاضلية عبر المجموعات الفرعية</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">السنة: 2008</h2>
<p class="direct-address animate delay-1">
                  "أنت على وشك أن تشهد واحدة من أكثر حالات إنهاء التجارب إثارة للصدمة في التاريخ..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    لعقود من الزمن، كان لدى مجتمع مرضى السكري مبدأ توجيهي واحد: <strong>انخفاض نسبة السكر في الدم هو الأفضل</strong>. أظهر DCCT (1993) وUKPDS (1998) أن التحكم المكثف في الجلوكوز يقلل من مضاعفات الأوعية الدموية الدقيقة - العمى، الفشل الكلوي، تلف الأعصاب.
                  </p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">الاستقراء المنطقي:</p>
<p class="sub">إذا كان التحكم في الجلوكوز يمنع حدوث مضاعفات، ألا ينبغي أن يمنع التحكم المكثف أمراض القلب والأوعية الدموية أيضًا؟</p>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">ACCORD: إجراء للسيطرة على مخاطر القلب والأوعية الدموية في مرض السكري</h2>
<p class="animate delay-1" style="font-style: italic;">الاختبار النهائي للتحكم المكثف في الجلوكوز</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">10,251</div>
<div class="stat-label">مرضى السكري من النوع 2</div>
</div>
<div class="stat-box">
<div class="stat-value">HbA1c &lt;6%</div>
<div class="stat-label">الهدف المكثف</div>
</div>
<div class="stat-box">
<div class="stat-value">HbA1c 7-7.9%</div>
<div class="stat-label">الهدف القياسي</div>
</div>
</div>
<div class="card animate delay-3">
<p class="card-text">
                    كان جميع المرضى مصابين بداء السكري من النوع 2 مع ارتفاع خطر الإصابة بأمراض القلب والأوعية الدموية - إما أمراض القلب والأوعية الدموية المثبتة أو عوامل الخطر المتعددة. تم تصميم التجربة لمدة 5.6 سنوات.
                  </p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="rhetorical animate" style="font-size: 2rem;">
                6 فبراير 2008
              </p>
<p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                يدعو مجلس مراقبة سلامة البيانات إلى اجتماع طارئ.
              </p>
<p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                بعد 3.5 سنوات، يتخذون قرارًا غير مسبوق:
              </p>
<p class="title gold animate delay-3" style="font-size: 2.5rem; margin-top: 1.5rem;">
                أوقف التجربة.
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">النتائج المروعة</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>حصيلة</th>
<th>مكثف</th>
<th>معيار</th>
<th>HR (95% CI)</th>
</tr>
</thead>
<tbody>
<tr>
<td>نقطة نهاية السيرة الذاتية الأولية</td>
<td>352 حدثًا</td>
<td>371 حدثًا</td>
<td>0.90 (0.78–1.04)</td>
</tr>
<tr style="background: rgba(197, 48, 48, 0.15);">
<td><strong>الوفيات الناجمة عن جميع الأسباب</strong></td>
<td><strong>257 حالة وفاة</strong></td>
<td><strong>203 حالة وفاة</strong></td>
<td class="highlight"><strong>1.22 (1.01–1.46)</strong></td>
</tr>
<tr>
<td>نقص السكر في الدم الشديد</td>
<td>10.5%</td>
<td>3.5%</td>
<td>3.0× أعلى</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-2" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">زيادة بنسبة 22% في معدل الوفيات</div>
<div class="label">54 حالة وفاة زائدة في ذراع العناية المركزة</div>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>تمرين التحقيق: معضلة الطبيب</h3>
</div>
<p class="direct-address">
                  أنت طبيب غدد صماء ولديك 500 مريض بالسكري. تم نشر نتائج أكورد. ماذا تقول لمرضاك الذين يسعون جاهدين للحصول على نسبة HbA1c &lt;6%؟
                </p>
<p class="rhetorical" style="margin: 1.5rem 0;">
                  هل المراقبة المكثفة ضارة للجميع؟ أو للبعض فقط؟
                </p>
<div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
<button class="reveal-btn" onclick="revealAnswer('accord-subgroup')">افحص المجموعات الفرعية →</button>
</div>
<div class="hidden-reveal" id="accord-subgroup">
<h4 style="color: var(--gold); margin-top: 1rem;">كشف تحليل المجموعة الفرعية:</h4>
<table class="data-table-investigation" style="margin-top: 0.5rem;">
<thead><tr><th>مجموعة فرعية</th><th>الموارد البشرية المكثفة</th><th>التفسير</th></tr></thead>
<tbody>
<tr><td>عدم وجود أمراض القلب والأوعية الدموية السابقة</td><td>1.00 (0.76–1.32)</td><td>لا تأثير</td></tr>
<tr><td>أمراض القلب والأوعية الدموية السابقة</td><td style="color: #C53030;">1.45 (1.15–1.84)</td><td>ضرر كبير</td></tr>
<tr><td>خط الأساس لنسبة HbA1c &lt;8%</td><td>1.02 (0.75–1.40)</td><td>لا تأثير</td></tr>
<tr><td>خط الأساس لنسبة HbA1c ≥8%</td><td style="color: #C53030;">1.29 (1.03–1.60)</td><td>Harm</td></tr>
</tbody>
</table>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">متوسط التأثير ملثمين عدم التجانس الحرج!</p>
<p class="sub">بالنسبة للمرضى الذين يعانون من أمراض القلب والأوعية الدموية أو ضعف التحكم في خط الأساس، كان العلاج المكثف ضارًا.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">فهم التجانس: I² و ما وراء</h2>
<p class="animate delay-1">عندما تظهر الدراسات (أو المجموعات الفرعية) تأثيرات مختلفة، يجب علينا قياس هذا الاختلاف.</p>
<div class="animate delay-2" style="max-width: 700px;">
<div class="card" style="border-right: 4px solid #22c55e;">
<p class="card-text"><strong>I² = 0–25%:</strong> عدم التجانس المنخفض. تكون التأثيرات متسقة عبر الدراسات.</p>
</div>
<div class="card" style="border-right: 4px solid #3b82f6; margin-top: 0.5rem;">
<p class="card-text"><strong>I² = 25–50%:</strong> معتدل. ابحث عن مصادر الاختلاف.</p>
</div>
<div class="card" style="border-right: 4px solid #f59e0b; margin-top: 0.5rem;">
<p class="card-text"><strong>I² = 50–75%:</strong> جوهري. فكر فيما إذا كان التجميع مناسبًا.</p>
</div>
<div class="card" style="border-right: 4px solid #C53030; margin-top: 0.5rem;">
<p class="card-text"><strong>I² = 75–100%:</strong> كبير. قد يكون التقدير المجمع الواحد مضللاً.</p>
</div>
</div>
<p class="footnote animate delay-3">لكن I² وحده لا يخبرك بما يجب فعله — فهو يشير إلى أنك بحاجة إلى مزيد من البحث.</p>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Tau² (τ²): التباين بين الدراسة</h2>
<p class="animate delay-1">بينما يخبرك I² بنسبة التباين الناتج عن عدم التجانس، τ² يخبرك بالحجم.</p>
<div class="animate delay-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 800px;">
<div class="card">
<div class="card-label">I² (نسبة مئوية)</div>
<p class="card-text">"ما هو جزء التباين الإجمالي الناتج عن الاختلافات الحقيقية بين الدراسات؟"</p>
<p style="font-size: 0.85rem;">المقياس: من 0% إلى 100%</p>
</div>
<div class="card">
<div class="card-label">τ² (مطلق)</div>
<p class="card-text">"ما مدى اختلاف التأثيرات الحقيقية بين الدراسات؟"</p>
<p style="font-size: 0.85rem;">نفس مقياس قياس التأثير</p>
</div>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">استخدم τ² للحساب <strong>فترات التنبؤ</strong></p>
<p class="sub">يُظهر الفاصل الزمني للتنبؤ نطاق التأثيرات التي تتوقعها في دراسة جديدة - غالبًا ما يكون أوسع بكثير من الثقة الفاصل الزمني.</p>
</div>
</div>
</div>
<div class="slide dark" data-index="9">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>الفاصل الزمني للتنبؤ: ما يخبرنا به ACCORD حقًا</h3>
</div>
<p class="direct-address">
                  النظر في التحليل التلوي للتحكم المكثف في الجلوكوز عبر تجارب متعددة...
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">فاصل الثقة</h4>
<p style="font-size: 1.2rem; font-weight: bold;">HR 1.10 (0.95–1.27)</p>
<p style="font-size: 0.9rem;">"أفضل تقدير لدينا لمتوسط التأثير"</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">الفاصل الزمني للتنبؤ</h4>
<p style="font-size: 1.2rem; font-weight: bold;">HR 1.10 (0.70–1.73)</p>
<p style="font-size: 0.9rem;">"نطاق التأثيرات في بيئة جديدة"</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">يشمل الفاصل الزمني للتنبؤ كلاً من المنفعة والضرر!</p>
<p class="sub">في بعض الإعدادات، قد يكون التحكم المكثف مفيدًا. وفي حالات أخرى، يمكن أن يقتل.</p>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">متى يكون تأثير المجموعة الفرعية ذا مصداقية؟</h2>
<p class="animate delay-1" style="font-style: italic;">أداة ICEMAN (أداة لتقييم مصداقية تحليلات تعديل التأثير)</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>هل كان تحليل المجموعة الفرعية محددًا مسبقًا؟</h4>
<p>المجموعات الفرعية اللاحقة عرضة للبيانات التجريف</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>هل هناك مبرر بيولوجي معقول؟</h4>
<p>يجب أن تكون الآلية واضحة ومستقلة عن البيانات</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>هل التأثير ثابت عبر النتائج ذات الصلة؟</h4>
<p>إذا ظهر ضرر للوفيات، فهل هناك ضرر مماثل للاحتشاء الدماغي أو السكتة الدماغية؟</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>هل هناك تكرار مستقل؟</h4>
<p>هل تم تأكيد تأثير المجموعة الفرعية في دراسات أخرى؟</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">تم تطبيق ICEMAN على ACCORD</h2>
<table class="results-table animate delay-1">
<thead>
<tr><th>المعيار</th><th>التقييم</th><th>النتيجة</th></tr>
</thead>
<tbody>
<tr>
<td>محددة مسبقًا؟</td>
<td>نعم - كانت أمراض القلب والأوعية الدموية السابقة في البروتوكول</td>
<td style="color: #22c55e;">✓</td>
</tr>
<tr>
<td>المنطق البيولوجي؟</td>
<td>نعم، نقص السكر في الدم أكثر خطورة مع الأمراض القلبية الوعائية</td>
<td style="color: #22c55e;">✓</td>
</tr>
<tr>
<td>نتائج متسقة؟</td>
<td>نعم - تمت محاذاة معدل الوفيات الناجمة عن السيرة الذاتية والوفيات الناجمة عن جميع الأسباب</td>
<td style="color: #22c55e;">✓</td>
</tr>
<tr>
<td>النسخ المتماثل المستقل؟</td>
<td>جزئيًا - ADVANCE، أظهر VADT أنماطًا مماثلة</td>
<td style="color: #f59e0b;">~</td>
</tr>
</tbody>
</table>
<div class="focus-box animate delay-2 mt-2">
<p class="main">تصنيف ICEMAN: مصداقية عالية</p>
<p class="sub">يبدو أن الضرر التفاضلي لدى المرضى المعرضين لمخاطر عالية حقيقي.</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">الآثار السريرية</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.1rem;">
<strong>بالنسبة للمرضى الذين لا يعانون من أمراض القلب والأوعية الدموية:</strong> يظل التحكم المعتدل في الجلوكوز (نسبة HbA1c ~ 7%) هو الهدف. السيطرة المكثفة قد تقلل من مضاعفات الأوعية الدموية الدقيقة.
                  </p>
</div>
<div class="card animate delay-2">
<p class="card-text" style="font-size: 1.1rem;">
<strong>بالنسبة للمرضى الذين يعانون من أمراض القلب والأوعية الدموية المثبتة:</strong> تجنب الأهداف المكثفة. نقص السكر في الدم يشكل خطرا على القلوب المتضررة.
                  </p>
</div>
<div class="card animate delay-3">
<p class="card-text" style="font-size: 1.1rem;">
<strong>بالنسبة للمرضى المسنين:</strong> أهداف مريحة. نوعية الحياة مهمة. السيطرة الصارمة تسبب السقوط والارتباك والوفيات الزائدة.
                  </p>
</div>
<p class="footnote animate delay-4" style="font-size: 1rem; font-style: italic;">
                  العلاج "مقاس واحد يناسب الجميع" ليس دواءً يركز على المريض.
                </p>
</div>
</div>
 الانحدار التلوي 
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">الانحدار التلوي: شرح عدم التجانس</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  عندما يكون عدم التجانس مرتفعًا، يمكن للانحدار التلوي تحديد المتغيرات المشتركة على مستوى الدراسة التي تفسر التباين.
                </p>
<div class="card animate delay-2" style="margin-bottom: 1rem;">
<div class="card-label">السؤال</div>
<p class="card-text">هل يختلف حجم التأثير بشكل منهجي مع الدراسة الخصائص؟</p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value" style="font-size: 1.1rem;">المتغيرات المصاحبة</div>
<div class="stat-label">السنة، الجرعة، المدة، المخاطر الأساسية، جودة الدراسة</div>
</div>
<div class="stat-box">
<div class="stat-value" style="font-size: 1.1rem;">المخرجات</div>
<div class="stat-label">معامل الانحدار (المنحدر)، R²، عدم التجانس المتبقي</div>
</div>
</div>
<div class="focus-box animate delay-4">
<p class="main" style="color: var(--red);">الحذر</p>
<p class="sub">يتطلب الانحدار التلوي ≥10 دراسات لكل متغير مشترك. مع القليل من الدراسات، فهي استكشافية فقط. مغالطة بيئية: الارتباطات على مستوى الدراسة قد لا تنطبق على الأفراد.</p>
</div>
<p class="footnote animate delay-5" style="margin-top: 1rem;">
<strong>مثال:</strong> في ACCORD، قد يختبر الانحدار التلوي ما إذا كان تأثير العلاج يختلف حسب خط الأساس لـ HbA1c، مما يظهر الضرر يتركز في المرضى الذين يعانون من مستويات عالية جدًا.
                </p>
</div>
</div>
 القصة: ثورة ضغط الدم SPRINT 
<div class="slide dark" data-index="13b">
<div class="story-box animate">
<p class="story-opener">ما هو الرقم الذي ينقذ الأرواح؟ من يقرر؟</p>
<div class="real-data-box">
<h4>البيانات الحقيقية</h4>
<p>
                    لعقود من الزمن، كان الهدف: علاج ضغط الدم <span class="data-highlight">&lt;140 ملم زئبق الانقباضي</span>. ثم جاء <span class="data-highlight">SPRINT (2015)</span>: <span class="data-highlight">9,361 مريضًا شديد الخطورة</span>
                    عشوائية إلى أهداف مكثفة (&lt;120) مقابل أهداف قياسية (&lt;140). تم تخفيض العلاج المكثف <span class="data-highlight">أحداث السيرة الذاتية بنسبة 25%</span> and
                    <span class="data-highlight">الوفاة بنسبة 27%</span>. توقفت المحاكمة مبكرا من أجل الفائدة. تغيرت المبادئ التوجيهية في جميع أنحاء العالم.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">قبل SPRINT: لجنة المبادئ التوجيهية</div>
<div class="decision-scenario">
                    لقد قمت بوضع إرشادات لضغط الدم في عام 2014. وكان الهدف أقل من 140 لسنوات. هل يجب أن تنتظر أدلة أفضل؟
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">المسار أ: الحفاظ على الوضع الراهن</div>
<div class="path-choice">احتفظ بالهدف &lt;140 (الممارسة المتبعة، الحد الأدنى من الجدل)</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">المبادئ التوجيهية دون تغيير. يستمر الأطباء في العلاج إلى أقل من 140.</div>
<div class="path-outcome">النتيجة: تفويت الفرصة لمنع الوفيات</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">المسار ب: تمويل التجربة النهائية</div>
<div class="path-choice">انتظر نتائج SPRINT قبل تحديث الأهداف</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">SPRINT يوضح الفائدة. قم بتحديث الهدف إلى &lt;120 للمرضى المعرضين لمخاطر عالية.</div>
<div class="path-outcome">النتيجة: ما يقدر بأكثر من 100.000 حياة تم إنقاذها على مستوى العالم</div>
</div>
</div>
</div>
<div class="story-timeline">
<div class="timeline-point">JNC 7 (2003): &lt;140</div>
<div class="timeline-point critical">سنوات من عدم اليقين</div>
<div class="timeline-point resolution">SPRINT (2015): &lt;120 للمخاطر العالية</div>
</div>
<div class="story-revelation">
<div class="revelation-label">الرؤيا</div>
<div class="revelation-text">
                    "لم يتم إصلاح معيار الرعاية". ويتغير عندما تتحدى التجارب الافتراضات. على مدى عقد من الزمن، ربما لم يتم علاج المرضى بشكل كاف لأنه لم يختبر أحد السؤال الواضح.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="14">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 8</h2>
<div class="quiz-container">
<div class="quiz-question" id="q8-1">
<h4>1. لماذا تم إيقاف تجربة ACCORD مبكرًا؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 0, 1, ['Intensive control did show cardiovascular benefit.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was higher than expected.', 'Budget was adequate.'])">
<span>A.</span> أظهرت المراقبة المكثفة فائدة واضحة للقلب والأوعية الدموية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 1, 1, ['Intensive control did show cardiovascular benefit.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was higher than expected.', 'Budget was adequate.'])">
<span>B.</span> أدت السيطرة المكثفة إلى زيادة معدل الوفيات
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 2, 1, ['Intensive control did show cardiovascular benefit.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was higher than expected.', 'Budget was adequate.'])">
<span>C.</span> كان التسجيل بطيئًا جدًا
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 3, 1, ['Intensive control did show cardiovascular benefit.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was higher than expected.', 'Budget was adequate.'])">
<span>D.</span> نفدت الميزانية
                      </div>
</div>
<div id="q8-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q8-2" style="margin-top: 1.5rem;">
<h4>2. ما الذي يخبرنا به الفاصل الزمني للتنبؤ والذي لا يخبرنا به فاصل الثقة؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 0, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>A.</span> يتم تقدير التأثير الحقيقي بشكل أكثر دقة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 1, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>B.</span> حجم العينة مناسب
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 2, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>C.</span> نطاق التأثيرات التي نتوقعها في دراسة جديدة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 3, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>D.</span> الصيغة الرياضية استخدمت
                      </div>
</div>
<div id="q8-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q8-3" style="margin-top: 1.5rem;">
<h4>3. وفقًا لـ ICEMAN، ما هو العامل الأكثر أهمية لمصداقية المجموعة الفرعية؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 0, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>A.</span> المواصفات المسبقة لفرضية المجموعة الفرعية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 1, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>B.</span> حجم عينة كبير في المجموعة الفرعية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 2, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>C.</span> قيمة p ذات دلالة إحصائية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 3, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>D.</span> نتائج متعددة تظهر نفس الاتجاه
                      </div>
</div>
<div id="q8-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="15">
<p class="closing-line animate">عندما تختلف الدراسات</p>
<p class="closing-line animate delay-1">استمع إلى الخلاف.</p>
<p class="closing-line gold animate delay-2">التجانس رسالة وليس ضجيج.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="16">
<p class="refrain animate">غياب الدليل ليس دليلا على الغياب.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة التاسعة: المخفي الدراسات</p>
</div>
</div>
 الوحدة 9: الدراسات المخفية (Reboxetine) 
<div class="module-slides" data-module="9">
<div class="slide dark active" data-index="0">
<p class="refrain animate">غياب الدليل ليس دليلا على الغياب.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">ريبوكسيتين: 2010</p>
<p class="title gold animate delay-1 text-center">الـ 74% الذين لم يروا النور أبدًا.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة التاسعة: المخفي الدراسات</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>تفسير المخططات القمعية لاكتشاف عدم التماثل</li>
<li>تطبيق اختبار إيجر والاختبارات الإحصائية الأخرى لتحيز النشر</li>
<li>تنفيذ طريقة القطع والتعبئة للتحيز تعديل</li>
<li>تقييم نقدي لقيود اختبارات تحيز النشر</li>
<li>تطبيق المبدأ: "غياب الأدلة ليس دليلاً على الغياب"</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">السنة: 1997</h2>
<p class="direct-address animate delay-1">
                  "أمل جديد لمرضى الاكتئاب الذين لا يستطيعون تحمل مثبطات استرداد السيروتونين الانتقائية..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    كان Reboxetine (Edronax) مضادًا جديدًا للاكتئاب - وهو مثبط انتقائي لإعادة امتصاص النوربينفرين (NRI). وعلى عكس مثبطات استرداد السيروتونين الانتقائية، فقد استهدف نظامًا مختلفًا من الناقلات العصبية. بالنسبة للمرضى الذين فشلوا أو لم يتمكنوا من تحمل فلوكستين أو سيرترالين، فقد قدم آلية جديدة.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">1997</div>
<div class="stat-label">موافقة الاتحاد الأوروبي</div>
</div>
<div class="stat-box">
<div class="stat-value">50+</div>
<div class="stat-label">البلدان المعتمدة</div>
</div>
<div class="stat-box">
<div class="stat-value">الملايين</div>
<div class="stat-label">الوصفات الطبية المكتوبة</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">الأدلة المنشورة</h2>
<p class="animate delay-1" style="font-style: italic;">ما يمكن للأطباء العثور عليه في المجلات الطبية:</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>مقارنة</th><th>التجارب المنشورة</th><th>النتيجة المنشورة</th></tr>
</thead>
<tbody>
<tr>
<td>ريبوكسيتين مقابل الدواء الوهمي</td>
<td>3 تجارب (العدد = 507)</td>
<td style="color: #22c55e;">أفضل بكثير (SMD = 0.56)</td>
</tr>
<tr>
<td>ريبوكسيتين مقابل SSRIs</td>
<td>4 تجارب (العدد = 628)</td>
<td style="color: #22c55e;">ما يعادل أو أفضل</td>
</tr>
</tbody>
</table>
<div class="focus-box animate delay-3 mt-2">
<p class="main">تحكي الأدبيات المنشورة قصة واضحة:</p>
<p class="sub">يعمل Reboxetine. يستفيد المرضى. يصف بثقة.</p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="rhetorical animate" style="font-size: 2rem;">
                ولكن ماذا عن التجارب التي لم تتمكن من رؤيتها؟
              </p>
<p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                في عام 2010، قدم الباحثون الألمان في IQWiG طلبًا إلى وكالة الأدوية الأوروبية...
              </p>
<p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                وطالبوا بالوصول إلى <strong>all</strong> التجربة البيانات - منشورة وغير منشورة.
              </p>
<p class="title gold animate delay-3" style="font-size: 2rem; margin-top: 1.5rem;">
                ما وجدوه غيَّر كل شيء.
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">الصورة الكاملة</h2>
<p class="animate delay-1" style="color: #C53030; font-weight: bold; font-style: italic;">Eyding et al., BMJ 2010</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>مقارنة</th><th>تم النشر فقط</th><th>جميع البيانات</th></tr>
</thead>
<tbody>
<tr>
<td><strong>ريبوكسيتين مقابل الدواء الوهمي</strong></td>
<td style="color: #22c55e;">SMD 0.56 (فائدة)</td>
<td style="color: #C53030;"><strong>SMD 0.10 (بدون فائدة)</strong></td>
</tr>
<tr>
<td>المرضى قيد التحليل</td>
<td>507 (14%)</td>
<td><strong>2,731 (100%)</strong></td>
</tr>
<tr>
<td><strong>ريبوكسيتين مقابل SSRIs</strong></td>
<td style="color: #22c55e;">ما يعادل</td>
<td style="color: #C53030;"><strong>أدنى (RR 1.23 للضرر)</strong></td>
</tr>
<tr>
<td>المرضى قيد التحليل</td>
<td>628 (26%)</td>
<td><strong>2,411 (100%)</strong></td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">لم يتم نشر 74% من بيانات المرضى مطلقًا</div>
<div class="label">لم تظهر التجارب المخفية أي فائدة والمزيد من الضرر</div>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>تمرين التحقيق: درج الملفات</h3>
</div>
<p class="direct-address">
                  أنت مراجع منهجي في 2008. يمكنك البحث في PubMed وEmbase ومكتبة كوكرين عن جميع تجارب الريبوكسيتين. وجدت 7 تجارب منشورة تظهر الفائدة.
                </p>
<p class="rhetorical" style="margin: 1.5rem 0;">
                  هل يمكنك الوثوق بهذا الدليل؟
                </p>
<div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
<button class="reveal-btn" onclick="revealAnswer('rebox-funnel')">إنشاء مخطط قمع →</button>
</div>
<div class="hidden-reveal" id="rebox-funnel">
<div id="reboxetine-funnel" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<script>
                    // This will be called when revealed
                    setTimeout(() => {
                      if (document.getElementById('rebox-funnel').classList.contains('hidden-reveal') === false) {
                        drawReboxetineFunnel();
                      }
                    }, 100);
                  </script>
<button class="reveal-btn" onclick="drawReboxetineFunnel()" style="margin-top: 0.5rem;">مسار الرسم →</button>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">⚠️ مسار التحويل غير متماثل بشكل كبير!</p>
<p class="sub">جميع الدراسات المنشورة تتجمع في جانب واحد. أين التجارب الفارغة والسلبية؟</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">مجموعة أدوات تحيز النشر</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>مخطط القمع</h4>
<p>حجم تأثير المؤامرة مقابل الخطأ القياسي. يشير القمع المتماثل إلى عدم وجود أي تحيز؛ عدم التماثل يثير الإنذارات.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>اختبار انحدار إيجر</h4>
<p>تراجع التأثير القياسي على الدقة. تشير P &lt;0.10 إلى تأثيرات دراسة صغيرة.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>اختبار بيترز</h4>
<p>بالنسبة للنتائج الثنائية، سجل التراجعات أو على عكس إجمالي حجم العينة. أقل عرضة للإيجابيات الكاذبة.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>تقليم وملء</h4>
<p>تحسب الدراسات "المفقودة" لجعل مسار التحويل متماثلًا، ثم تعيد حساب التأثير المجمع.</p>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="8">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>تفاعلية: القطع والتعبئة التحليل</h3>
</div>
<p class="direct-address">
                  دعونا نطبق القطع والتعبئة على بيانات reboxetine ونرى ما سيكون عليه التقدير المعدل...
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">تم النشر فقط</h4>
<p>7 تجارب</p>
<p style="font-size: 1.2rem; font-weight: bold; color: #22c55e;">SMD = 0.56</p>
<p style="font-size: 0.9rem;">فائدة كبيرة</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">تقليم وملء</h4>
<p>7 + 5 محسوبة = 12 تجربة</p>
<p style="font-size: 1.2rem; font-weight: bold; color: #f59e0b;">SMD = 0.23</p>
<p style="font-size: 0.9rem;">منخفضة، لا تزال ذات أهمية اسمية</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem; border-color: #C53030;">
<p class="main" style="color: #C53030;">ولكن حتى التشذيب والملء قلل من أهمية المشكلة!</p>
<p class="sub">التأثير الحقيقي مع جميع البيانات هو SMD = 0.10 (فارغ في الأساس).<br/>يعد الاقتطاع والتعبئة أمرًا متحفظًا — فهو لا يصحح بشكل كامل للنشر الانتقائي.</p>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">أفضل دفاع: سجلات المحاكمة</h2>
<p class="animate delay-1">طرق اكتشاف تحيز النشر غير كاملة. الحل الحقيقي هو <strong>التسجيل المحتمل</strong>.</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">ClinicalTrials.gov</div>
<div class="stat-label">السجل الأمريكي (2000)</div>
</div>
<div class="stat-box">
<div class="stat-value">منظمة الصحة العالمية ICTRP</div>
<div class="stat-label">البوابة العالمية</div>
</div>
<div class="stat-box">
<div class="stat-value">بروسبيرو</div>
<div class="stat-label">مراجعة التسجيل</div>
</div>
</div>
<div class="card animate delay-3">
<p class="card-text">
                    عند البحث عن التجارب، تحقق دائمًا من السجلات. قارن عدد <strong>مسجل</strong> المحاولات بالرقم <strong>منشور</strong>. هذه الفجوة هي إشارة التحذير الخاصة بك.
                  </p>
</div>
<p class="footnote animate delay-4">
                  منذ عام 2005، يتطلب ICMJE التسجيل التجريبي كشرط للنشر.
                </p>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">حملة AllTrials</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.2rem; text-align: center;">
<strong>"تم تسجيل جميع التجارب. تم الإبلاغ عن جميع النتائج."</strong>
</p>
</div>
<p class="animate delay-2" style="margin-top: 1rem;">
                  لقد حفزت فضيحة الريبوكسيتين، إلى جانب حالات مماثلة في أدوية أخرى، حركة عالمية:
                </p>
<div class="lesson-item animate delay-3">
<div class="lesson-number">✓</div>
<div class="lesson-content">
<h4>2013: سياسة البيانات السريرية لوكالة الأدوية الأوروبية</h4>
<p>تلتزم وكالة الأدوية الأوروبية بنشر تقارير الدراسات السريرية</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">✓</div>
<div class="lesson-content">
<h4>2016: إنفاذ قانون تعديلات إدارة الغذاء والدواء</h4>
<p>الإبلاغ عن النتائج الإلزامية على موقع ClinicalTrials.gov في غضون 12 شهرًا</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">✓</div>
<div class="lesson-content">
<h4>تحالف AllTrials</h4>
<p>أكثر من 90.000 مؤيد وأكثر من 700 منظمة تطالب بالشفافية</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">آثار الريبوكسيتين</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number" style="background: #C53030;">!</div>
<p>ألمانيا أوصى IQWiG ضد الريبوكستين لعلاج الاكتئاب</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number" style="background: #C53030;">!</div>
<p>خفضت منظمة NICE في المملكة المتحدة تصنيفها إلى "غير موصى به"</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number" style="background: #C53030;">!</div>
<p>رفضت إدارة الغذاء والدواء الأمريكية الريبوكسيتين في عام 2001 (كان لديهم إمكانية الوصول إلى معلومات غير منشورة) data)</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">لأكثر من عقد من الزمن، تلقى المرضى دواءً ليس أفضل من العلاج الوهمي.</p>
<p class="sub">لأنه تم نشر التجارب الإيجابية فقط.</p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 9</h2>
<div class="quiz-container">
<div class="quiz-question" id="q9-1">
<h4>1. ما هي النسبة المئوية لبيانات تجربة الريبوكسيتين التي تم إخفاؤها من الأدبيات المنشورة؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 0, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>A.</span> 25%
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 1, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>B.</span> 50%
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 2, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>C.</span> 74%
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 3, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>D.</span> 90%
                      </div>
</div>
<div id="q9-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q9-2" style="margin-top: 1.5rem;">
<h4>2. لماذا يمكن أن يقلل القص والملء من التصحيح المطلوب؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 0, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>A.</span> ويفترض أن التأثيرات موزعة بشكل طبيعي
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 1, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>B.</span> إنها تنسب فقط الدراسات لتحقيق التماثل، والتي قد لا تعكس الواقع بشكل كامل
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 2, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>C.</span> يتطلب 20 دراسة على الأقل
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 3, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>D.</span> إنها تعمل فقط مع دراسات كبيرة جدًا
                      </div>
</div>
<div id="q9-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q9-3" style="margin-top: 1.5rem;">
<h4>3. ما هو أفضل دفاع محتمل ضد تحيز النشر؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 0, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>A.</span> المخططات القمعية في جميع التحليلات التلوية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 1, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>B.</span> اختبار إيجر قبل التجميع
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 2, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>C.</span> تسجيل التجارب المحتملة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 3, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>D.</span> قد يكون المزيد من المجلات الطبية
                      </div>
</div>
<div id="q9-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="13">
<p class="closing-line animate">ما لا يمكنك فعله راجع</p>
<p class="closing-line animate delay-1">أكثر أهمية مما تستطيع.</p>
<p class="closing-line gold animate delay-2">غياب الدليل ليس دليلا على الغياب.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="14">
<p class="refrain animate">يجب اكتساب اليقين وليس افتراضه.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 10: اليقين</p>
</div>
</div>
 الوحدة 10: اليقين (الفاعل بالسطح المبكر) 
<div class="module-slides" data-module="10">
<div class="slide dark active" data-index="0">
<p class="refrain animate">يجب اكتساب اليقين وليس افتراضه.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">الفاعل بالسطح المبكر: 2012</p>
<p class="title gold animate delay-1 text-center">عندما تتطور الأدلة عالية الجودة.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة 10: اليقين</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>تطبيق إطار GRADE الكامل لتقييم اليقين الدليل</li>
<li>تقييم جميع عوامل التخفيض الخمسة (RoB، عدم الاتساق، عدم المباشرة، عدم الدقة، تحيز النشر)</li>
<li>تحديد متى يجب الترقية للتأثير الكبير، أو الاستجابة للجرعة، أو الإرباك</li>
<li>إنشاء ملخص جداول النتائج مع تقديرات التأثير المطلق</li>
<li>تطبيق المبدأ: "يجب اكتساب اليقين، وليس افتراضه"</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">العام: التسعينيات</h2>
<p class="direct-address animate delay-1">
                  "ثورة في رعاية الأطفال حديثي الولادة..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    كانت متلازمة الضائقة التنفسية (RDS) هي السبب الرئيسي للوفاة بين الأطفال الخدج. كان تطوير المادة الخارجية <strong>مادة خافضة للتوتر السطحي</strong>— وهي المادة التي تحافظ على الحويصلات الهوائية من الانهيار — واحدًا من التقدم الكبير في طب الأطفال حديثي الولادة.
                  </p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">أصبح السؤال: متى يجب أن نعطي الفاعل بالسطح؟</p>
<p class="sub">وقائيًا (لجميع الرضع المعرضين لمخاطر عالية) أم بشكل انتقائي (فقط بعد تطور متلازمة الضائقة التنفسية)؟</p>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">مراجعة كوكرين الأصلية (2003)</h2>
<p class="animate delay-1" style="font-style: italic;">أجريت تجارب معشاة ذات شواهد متعددة قبل عصر CPAP الروتيني</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>حصيلة</th><th>وقائي مقابل انتقائي</th><th>يقين</th></tr>
</thead>
<tbody>
<tr>
<td>وفيات الأطفال حديثي الولادة</td>
<td style="color: #22c55e;">RR 0.73 (يفضل وقائي)</td>
<td>High</td>
</tr>
<tr>
<td>اضطراب الشخصية الحدية أو الوفاة</td>
<td style="color: #22c55e;">RR 0.84 (يفضل وقائي)</td>
<td>High</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">توصية: إعطاء الفاعل بالسطح بشكل وقائي</div>
<div class="label">اعتمدت المبادئ التوجيهية في جميع أنحاء العالم هذا النهج</div>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="rhetorical animate" style="font-size: 2rem;">
                لكن عالم رعاية الأطفال حديثي الولادة كان يتغير...
              </p>
<p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                ظهرت تقنية جديدة: <strong>ضغط مجرى الهواء الإيجابي المستمر (CPAP)</strong>
</p>
<p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                دعم غير جراحي يمكن أن يساعد الرئتين المبتسرين دون التنبيب.
              </p>
<p class="title gold animate delay-3" style="font-size: 1.5rem; margin-top: 1.5rem;">
                هل ستظل الأدلة القديمة سارية؟
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">تحديث كوكرين لعام 2012</h2>
<p class="animate delay-1" style="color: #C53030; font-weight: bold;">تجارب جديدة أجريت في عصر CPAP</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>حصيلة</th><th>تجارب قديمة</th><th>تجارب جديدة</th></tr>
</thead>
<tbody>
<tr>
<td>اضطراب الشخصية الحدية أو الوفاة</td>
<td style="color: #22c55e;">RR 0.84 (يفضل وقائي)</td>
<td style="color: #C53030;">RR 1.12 (تفضيلات انتقائية)</td>
</tr>
<tr>
<td>الحاجة إلى إصلاحات ميكانيكية التهوية</td>
<td style="color: #22c55e;">أقل مع وقائي</td>
<td style="color: #C53030;">أعلى مع وقائي!</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">الانعكاس الكامل</div>
<div class="label">في عصر جهاز CPAP، يسبب الفاعل بالسطح الوقائي مزيدًا من الضرر</div>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>التحقيق: لماذا تطورت الأدلة؟</h3>
</div>
<p class="direct-address">
                  أنت طبيب حديثي الولادة. يسأل أحد الزملاء: "كيف يمكن للتجارب العشوائية أن تتناقض مع بعضها البعض؟"
                </p>
<p class="rhetorical" style="margin: 1rem 0;">
                  هل كان الدليل الأصلي خاطئًا؟
                </p>
<button class="reveal-btn" onclick="revealAnswer('surfactant-explain')">فهم التطور →</button>
<div class="hidden-reveal" id="surfactant-explain">
<div class="lesson-item" style="margin-top: 1rem;">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>تغيرت غير المباشرة</h4>
<p>التجارب القديمة: لا يتوفر جهاز CPAP. تجارب جديدة: معيار رعاية CPAP.</p>
</div>
</div>
<div class="lesson-item">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>تحسين المقارنة</h4>
<p>الفاعل بالسطح الانتقائي + CPAP أفضل من التنبيب الوقائي.</p>
</div>
</div>
<div class="lesson-item">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>مسائل السياق</h4>
<p>قد لا تنطبق الأدلة من عصر واحد على آخر.</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">ولهذا السبب يقوم GRADE بتقييم عدم المباشرة!</p>
<p class="sub">قد تصبح الأدلة عالية الجودة غير قابلة للتطبيق عندما يتغير السياق.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">إطار عمل GRADE</h2>
<p class="animate delay-1" style="margin-bottom: 1rem; font-style: italic;">
                  تصنيف التوصيات والتقييم والتطوير والتقييمات
                </p>
<p class="animate delay-2">يجيب GRADE على السؤال: <strong>ما مدى ثقتنا في هذا التقدير؟</strong></p>
<div class="animate delay-3" style="max-width: 700px;">
<div class="card" style="background: rgba(34,197,94,0.15); border-right: 4px solid #22c55e;">
<p class="card-text"><strong>⊕⊕⊕⊕ مرتفع:</strong> واثق جدا. التأثير الحقيقي قريب من التقدير.</p>
</div>
<div class="card" style="background: rgba(59,130,246,0.15); border-right: 4px solid #3b82f6; margin-top: 0.5rem;">
<p class="card-text"><strong>⊕⊕⊕◯ متوسط:</strong> واثق إلى حد ما. من المحتمل أن يكون التأثير الحقيقي قريبًا، ولكنه قد يختلف بشكل كبير.</p>
</div>
<div class="card" style="background: rgba(245,158,11,0.15); border-right: 4px solid #f59e0b; margin-top: 0.5rem;">
<p class="card-text"><strong>⊕⊕◯◯ منخفض:</strong> ثقة محدودة. قد يختلف التأثير الحقيقي بشكل كبير.</p>
</div>
<div class="card" style="background: rgba(197,48,48,0.15); border-right: 4px solid #C53030; margin-top: 0.5rem;">
<p class="card-text"><strong>⊕◯◯◯ منخفض جدًا:</strong> ثقة قليلة جدًا. من المحتمل أن يكون التأثير الحقيقي مختلفًا إلى حد كبير.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">الدرجة: العوامل التي تقلل من درجة اليقين</h2>
<p class="animate delay-1">تبدأ أدلة RCT عند HIGH. يمكن تخفيض تصنيفها إلى ما يلي:</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #C53030;">1</div>
<div class="lesson-content">
<h4>خطر التحيز</h4>
<p>التوزيع العشوائي المعيب، ونقص التعمية، والمتابعة غير الكاملة، والتقارير الانتقائية</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #C53030;">2</div>
<div class="lesson-content">
<h4>التناقض</h4>
<p>عدم التجانس غير المبرر عبر الدراسات (I² كبير، CIs غير متداخلة)</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #C53030;">3</div>
<div class="lesson-content">
<h4>عدم المباشرة</h4>
<p>الاختلافات في عدد السكان أو التدخل أو المقارنة أو النتائج من السؤال</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number" style="background: #C53030;">4</div>
<div class="lesson-content">
<h4>عدم الدقة</h4>
<p>فترات ثقة واسعة، حجم عينة صغير، أحداث قليلة</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">الدرجة: العامل الخامس</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #C53030;">5</div>
<div class="lesson-content">
<h4>انحياز النشر</h4>
<p>مؤامرة قمع غير متماثلة، تجارب مسجلة مفقودة، تأثير الراعي</p>
</div>
</div>
<div class="focus-box animate delay-2 mt-2">
<p class="main">يمكن تخفيض كل عامل بمقدار مستوى واحد أو مستويين</p>
<p class="sub">مرتفع → معتدل → منخفض → منخفض جدًا</p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem;">
<p class="card-text">
<strong>مثال:</strong> تحليل تلوي للتجارب المعشاة ذات الشواهد (يبدأ مرتفعًا) مع ارتفاع خطر التحيز (↓1) وعدم المباشرة الخطيرة (↓1) سيتم تصنيفها <strong>LOW</strong>.
                  </p>
</div>
</div>
</div>
<div class="slide dark" data-index="10">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>تفاعلي: قم بتطبيق GRADE على الفاعل بالسطح</h3>
</div>
<p class="direct-address">
                  دعونا نقيم مدى يقين الأدلة الخاصة بالفاعل بالسطح الوقائي باستخدام التجارب القديمة مقابل التجارب الجديدة.
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">التجارب القديمة (ما قبل CPAP)</h4>
<p><strong>البداية:</strong> عالية (المضبوطة)</p>
<p><strong>خطر التحيز:</strong> منخفض (−0)</p>
<p><strong>التناقض:</strong> لا شيء (−0)</p>
<p><strong>عدم المباشرة:</strong> جدي (−1)</p>
<p style="font-size: 0.85rem; color: #f59e0b;">معايير رعاية مختلفة اليوم</p>
<p><strong>نهائي:</strong> ⊕⊕⊕◯ معتدل</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">تجارب جديدة (عصر CPAP)</h4>
<p><strong>البداية:</strong> عالية (المضبوطة)</p>
<p><strong>خطر التحيز:</strong> منخفض (−0)</p>
<p><strong>التناقض:</strong> لا شيء (−0)</p>
<p><strong>عدم المباشرة:</strong> لا شيء (−0)</p>
<p style="font-size: 0.85rem; color: #22c55e;">تتطابق مع الممارسة الحالية</p>
<p><strong>نهائي:</strong> ⊕⊕⊕⊕ مرتفع</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">الدرجة: العوامل التي تعمل على تحسين اليقين</h2>
<p class="animate delay-1">تبدأ الأدلة الرصدية عند LOW. يمكن ترقيتها لـ:</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #22c55e;">+1</div>
<div class="lesson-content">
<h4>حجم كبير من التأثير</h4>
<p>RR &gt;2 أو &lt;0.5 بدون أي إرباك معقول</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #22c55e;">+1</div>
<div class="lesson-content">
<h4>تدرج الاستجابة للجرعة</h4>
<p>تعرض أعلى = تأثير أكبر في نمط ثابت</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #22c55e;">+1</div>
<div class="lesson-content">
<h4>الإرباك المتبقي</h4>
<p>جميع الإرباكات المعقولة من شأنها أن تقلل من التأثير (تقوي الاستدلال السببي)</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">توصيل اليقين</h2>
<p class="animate delay-1">يتطلب GRADE لغة شفافة حول الثقة:</p>
<div class="card animate delay-2">
<p class="card-text"><strong>عالي:</strong> "الفاعل بالسطح الوقائي <em>يقلل من وفيات</em> ..."</p>
</div>
<div class="card animate delay-3">
<p class="card-text"><strong>معتدل:</strong> "الفاعل بالسطح الوقائي <em>ربما يقلل</em> ..."</p>
</div>
<div class="card animate delay-4">
<p class="card-text"><strong>LOW:</strong> "الفاعل بالسطح الوقائي <em>قد يقلل</em> ..."</p>
</div>
<div class="card animate delay-5">
<p class="card-text"><strong>منخفض جدًا:</strong> "نحن <em>غير متأكد ما إذا كان</em> الفاعل بالسطح الوقائي يقلل معدل الوفيات..."</p>
</div>
<p class="footnote animate delay-6">
                  تضمن هذه اللغة فهم الأطباء لقوة الأدلة.
                </p>
</div>
</div>
 القصة: مفارقة الأكسجين عند الأطفال المبتسرين 
<div class="slide dark" data-index="12b">
<div class="story-box animate">
<p class="story-opener">هل يمكن أن يصبح الكثير من المنقذ قاتلاً؟</p>
<div class="real-data-box">
<h4>البيانات الحقيقية</h4>
<p>
<span class="data-highlight">1940s-50s:</span> أنقذت تركيزات الأكسجين العالية الأطفال المبتسرين من فشل الجهاز التنفسي. ثم جاء <span class="data-highlight">وباء العمى</span>— التنسج الليفي القهقري (يسمى الآن ROP). الأطباء <span class="data-highlight">خفضوا الأكسجين بشكل كبير</span>. انخفض العمى. ولكن بعد ذلك: <span class="data-highlight">زيادة الوفيات وتلف الدماغ</span> من نقص الأكسجة. مستوى الأكسجين الأمثل المطلوب <span class="data-highlight">عقود من التجارب</span> للعثور على. أخيرًا حددت تجارب SUPPORT/BOOST II النافذة العلاجية: SpO2 <span class="data-highlight">91-95%</span>.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">معضلة طبيب حديثي الولادة: 1955</div>
<div class="decision-scenario">
                    أنت طبيب حديثي الولادة. الأطفال الخدج الذين يعانون من نسبة عالية من الأكسجين يصابون بالعمى. ماذا تفعل؟
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">المسار أ: التخفيض الدراماتيكي</div>
<div class="path-choice">تقليل الأكسجين بشكل كبير لمنع العمى</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">انخفاض معدلات العمى. لكن بعض الأطفال يموتون أو يعانون من تلف في الدماغ بسبب نقص الأكسجة.</div>
<div class="path-outcome">النتيجة: مقايضة ضرر بآخر</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">المسار ب: دراسة منهجية</div>
<div class="path-choice">معايرة الأكسجين بعناية، ودراسة العلاقة بين الجرعة والاستجابة</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">يستغرق عقودًا من الزمن ولكنه يحدد في النهاية النطاق الأمثل.</div>
<div class="path-outcome">النتيجة: تحسين البقاء والرؤية</div>
</div>
</div>
</div>
<div class="story-timeline">
<div class="timeline-point">الأربعينيات: ارتفاع الأكسجين ينقذ الأرواح</div>
<div class="timeline-point critical">الخمسينيات: وباء العمى</div>
<div class="timeline-point critical">من الستينيات إلى السبعينيات: الوفيات الناجمة عن انخفاض الأكسجين</div>
<div class="timeline-point resolution">2010: الدعم/التعزيز يحدد النطاق الأمثل</div>
</div>
<div class="story-revelation">
<div class="revelation-label">الرؤيا</div>
<div class="revelation-text">
                    كل تدخل له نافذة علاجية. فالعثور عليه يتطلب القياس وليس الافتراض. لقد تأرجح البندول لمدة 60 عامًا قبل أن تحدد الأدلة التوازن.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 10</h2>
<div class="quiz-container">
<div class="quiz-question" id="q10-1">
<h4>1. لماذا تم عكس توصية الفاعل بالسطح بين عامي 2003 و2012؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 0, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>A.</span> كانت التجارب الأصلية احتيالية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 1, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>B.</span> غيّر CPAP المقارنة (غير مباشر)
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 2, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>C.</span> لا يوجد عدد كافٍ من المرضى في التجارب الأصلية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 3, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>D.</span> تم قياس النتيجة بشكل مختلف
                      </div>
</div>
<div id="q10-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q10-2" style="margin-top: 1.5rem;">
<h4>2. أي مما يلي لا يعد عامل تخفيض درجة؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 0, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>A.</span> خطر التحيز
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 1, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>B.</span> عدم الدقة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 2, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>C.</span> تحيز النشر
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 3, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>D.</span> حجم كبير من التأثير
                      </div>
</div>
<div id="q10-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q10-3" style="margin-top: 1.5rem;">
<h4>3. ما اللغة التي يجب استخدامها لأدلة اليقين المنخفضة؟</h4>
<div class="quiz-options">
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 0, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>A.</span> "التدخل يقلل..."
                      </div>
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 1, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>B.</span> "من المحتمل أن التدخل يقلل..."
                      </div>
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 2, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>C.</span> "التدخل قد يقلل..."
                      </div>
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 3, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>D.</span> "نحن غير متأكدين سواء..."
                      </div>
</div>
<div id="q10-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="14">
<p class="closing-line animate">الرقم ليس كافيًا.</p>
<p class="closing-line animate delay-1">يجب عليك التعبير عن مدى تأكدك.</p>
<p class="closing-line gold animate delay-2">يجب اكتساب اليقين وليس افتراضه.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="15">
<p class="refrain animate">الطرق تحمي المرضى من ثقتنا.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 11: المراجعة الحية</p>
</div>
</div>
 الوحدة 11: المراجعة الحية (COVID-19) 
<div class="module-slides" data-module="11">
<div class="slide dark active" data-index="0">
<p class="refrain animate">الطرق تحمي المرضى من ثقتنا.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">كوفيد-19 هيدروكسي كلوروكين: 2020</p>
<p class="title gold animate delay-1 text-center">عند تلبية الأدلة العاجلة.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة 11: المراجعة الحية</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>تطبيق التحليل التسلسلي للمحاكمة لتحديد متى تكون الأدلة كافية</li>
<li>تصميم مراجعة منهجية حية والحفاظ عليها</li>
<li>إنشاء مشغلات التحديث وحدود العبث/الضرر</li>
<li>إدارة التعددية وإنفاق ألفا في التحليلات المتسلسلة</li>
<li>اشرح كيف تطور التوليف السريع للأدلة خلال كوفيد-19</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">مارس 2020: عالم في أزمة</h2>
<p class="direct-address animate delay-1">
                  "ينتشر الفيروس بشكل أسرع مما نفهمه..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    كان فيروس كورونا (COVID-19) يقتل الآلاف. امتلأت وحدات العناية المركزة. ولم يكن هناك لقاح ولا علاج. ثم بصيص من الأمل: <strong>أظهر هيدروكسي كلوروكين (HCQ)</strong>- وهو دواء قديم للملاريا - نشاطًا مضادًا للفيروسات في الدراسات المعملية.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">مارس 20</div>
<div class="stat-label">دراسة غوتريت (فرنسا)</div>
</div>
<div class="stat-box">
<div class="stat-value">36 نقطة</div>
<div class="stat-label">غير عشوائية</div>
</div>
<div class="stat-box">
<div class="stat-value">الفيروسي</div>
<div class="stat-label">تحسين التخليص</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">التعجل للتبني</h2>
<p class="animate delay-1" style="font-style: italic;">في غضون أسابيع من دراسة غوتريت:</p>
<div class="wrong-item animate delay-2">
<div class="wrong-number" style="background: #f59e0b;">!</div>
<p><strong>28 مارس:</strong> تصدر إدارة الغذاء والدواء الأمريكية ترخيص الاستخدام في حالات الطوارئ لـ HCQ</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number" style="background: #f59e0b;">!</div>
<p><strong>4 أبريل:</strong> الهند تحظر تصدير HCQ (مخاوف من الاكتناز)</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number" style="background: #f59e0b;">!</div>
<p><strong>عالمي:</strong> يؤثر النقص على مرضى الذئبة والتهاب المفاصل الروماتويدي</p>
</div>
<div class="focus-box animate delay-5 mt-2" style="border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">تلقى الملايين HCQ بناءً على دراسة مراقبة أجريت على 36 مريضًا</p>
<p class="sub">ما الخطأ الذي يمكن أن يحدث؟</p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>التحقيق: غوتريت الدراسة</h3>
</div>
<p class="direct-address">
                  أنت أحد خبراء EBM المطلوب منك تقييم دراسة HCQ الفرنسية. افحص التصميم...
                </p>
<button class="reveal-btn" onclick="revealAnswer('hcq-flaws')">حدد العيوب →</button>
<div class="hidden-reveal" id="hcq-flaws">
<table class="data-table-investigation" style="margin-top: 1rem;">
<thead><tr><th>المشكلة</th><th>تأثير</th></tr></thead>
<tbody>
<tr><td><strong>غير عشوائية</strong></td><td>تحيز الاختيار – من حصل على HCQ؟</td></tr>
<tr><td><strong>تم استبعاد 6 مرضى</strong></td><td>ذهب 3 إلى وحدة العناية المركزة، وتوفي واحد، وانسحب واحد، وأصيب واحد بالغثيان</td></tr>
<tr><td><strong>نتيجة بديلة</strong></td><td>الحمل الفيروسي، وليس النتائج السريرية</td></tr>
<tr><td><strong>التحكم من مستشفيات مختلفة</strong></td><td>رعاية مختلفة واختبارات مختلفة</td></tr>
<tr><td><strong>لا يسبب العمى</strong></td><td>التحيز في التوقعات في الاختبارات المعملية</td></tr>
</tbody>
</table>
<div class="focus-box" style="margin-top: 1rem; border-color: #C53030;">
<p class="main" style="color: #C53030;">ستسجل هذه الدراسة مخاطر عالية للتحيز في RoB 2.0</p>
<p class="sub">درجة اليقين: منخفض جدًا. ومع ذلك فقد غيرت السياسة العالمية.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">لماذا تم تضليل دراسات رصد كوفيد؟</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #C53030;">1</div>
<div class="lesson-content">
<h4>التحيز الزمني الخالد</h4>
<p>يجب على المرضى البقاء على قيد الحياة لفترة كافية لتلقي العلاج. تتم مقارنة الناجين بغير الناجين.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #C53030;">2</div>
<div class="lesson-content">
<h4>الخلط عن طريق الإشارة</h4>
<p>قد يحصل المرضى الأكثر مرضًا على علاجات مختلفة. تلقى المرضى الأكثر صحة HCQ في وقت مبكر.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #C53030;">3</div>
<div class="lesson-content">
<h4>تأثير المستخدم الصحي</h4>
<p>يميل المرضى الذين يطلبون العلاج إلى أن يكونوا أكثر صحة بشكل عام.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #C53030;">4</div>
<div class="lesson-content">
<h4>الإبلاغ عن النتائج</h4>
<p>تم نشر دراسات ذات نتائج إيجابية أسرع.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">يونيو 2020: تقرير التجارب المعشاة ذات الشواهد</h2>
<p class="animate delay-1" style="font-style: italic;">تم الانتهاء من التجارب الكبيرة والصارمة بسرعة ملحوظة</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>محاكمة</th><th>N</th><th>النتيجة</th></tr>
</thead>
<tbody>
<tr>
<td>التعافي (المملكة المتحدة)</td>
<td>4,716</td>
<td style="color: #C53030;">لا فائدة من الوفيات (RR 1.09)</td>
</tr>
<tr>
<td>تضامن منظمة الصحة العالمية</td>
<td>954</td>
<td style="color: #C53030;">لا فائدة (RR 1.19)</td>
</tr>
<tr>
<td>الأوركيد (الولايات المتحدة)</td>
<td>479</td>
<td style="color: #C53030;">توقف بلا جدوى</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">لم يقدم HCQ أي فائدة، وربما تسبب في ضرر</div>
<div class="label">15 يونيو 2020: إدارة الغذاء والدواء الأمريكية تلغي ترخيص الاستخدام في حالات الطوارئ</div>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>الجدول الزمني: الأدلة الرصدية مقابل أدلة التجارب المعشاة ذات الشواهد</h3>
</div>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">مارس-مايو 2020</h4>
<p><strong>رصدي:</strong> ~20 دراسة</p>
<p style="color: #22c55e;">اقترح فائدة</p>
<p style="font-size: 0.85rem;">مجمعة أو ~0.65</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">يونيو-يوليو 2020</h4>
<p><strong>التجارب المعشاة ذات الشواهد:</strong> التعافي والتضامن</p>
<p style="color: #C53030;">لا تظهر أي فائدة/ضرر</p>
<p style="font-size: 0.85rem;">RR المجمعة ~ 1.10</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem;">
<p class="main">من "واعد" إلى "غير فعال" في 3 أشهر</p>
<p class="sub">لهذا السبب نحتاج إلى التوزيع العشوائي - والمراجعات الحية لتتبع الأدلة المتطورة.</p>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">مراجعات منهجية حية</h2>
<p class="animate delay-1">نهج جديد للأدلة سريعة التطور:</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #22c55e;">1</div>
<div class="lesson-content">
<h4>المراقبة المستمرة</h4>
<p>ابحث في الأدبيات أسبوعيًا أو حتى يوميًا عن أدلة جديدة</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #22c55e;">2</div>
<div class="lesson-content">
<h4>التحليل التلوي التراكمي</h4>
<p>تحديث التقديرات المجمعة مع كل تقارير تجربة جديدة</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #22c55e;">3</div>
<div class="lesson-content">
<h4>التحليل التسلسلي التجريبي (TSA)</h4>
<p>تحديد متى تتراكم معلومات كافية لاستنتاج</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number" style="background: #22c55e;">4</div>
<div class="lesson-content">
<h4>الإصدار الشفاف</h4>
<p>تتبع كل تغيير، والحفاظ على مسار التدقيق الكامل</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">التحليل التسلسلي التجريبي (TSA)</h2>
<p class="animate delay-1" style="font-style: italic;">متى تعلمنا ما يكفي؟</p>
<div class="card animate delay-2">
<p class="card-text">
                    تطبق إدارة أمن النقل حدود التوقف على التحليل التلوي — مماثل للتحليل المؤقت في تجربة واحدة. إنه يمثل <strong>حجم المعلومات المطلوبة (RIS)</strong> اللازمة لاكتشاف أو استبعاد تأثير ذي معنى سريريًا.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">RIS</div>
<div class="stat-label">حجم العينة المطلوب</div>
</div>
<div class="stat-box">
<div class="stat-value">α-الإنفاق</div>
<div class="stat-label">يتحكم في خطأ النوع الأول</div>
</div>
<div class="stat-box">
<div class="stat-value">حدود</div>
<div class="stat-label">المنفعة / الضرر / العبث</div>
</div>
</div>
<p class="footnote animate delay-4">
                  بالنسبة لـ HCQ في فيروس كورونا، أظهرت إدارة أمن النقل أنه تم تجاوز حدود عدم الجدوى بحلول يونيو 2020.
                </p>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">الدروس المستفادة من ملحمة HCQ</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.1rem;">
<strong>1. يمكن أن تكون الدراسات الرصدية مضللة بشكل مذهل</strong> عندما يكون التحيز سائدًا. حتى أن العديد من الدراسات التي تشير إلى نفس الاتجاه يمكن أن تكون خاطئة.
                  </p>
</div>
<div class="card animate delay-2">
<p class="card-text" style="font-size: 1.1rem;">
<strong>2. يمكن إجراء التجارب المعشاة ذات الشواهد بسرعة</strong> عند وجود الإرادة. تم تسجيل أكثر من 5000 مريض في برنامج RECOVERY خلال أسابيع.
                  </p>
</div>
<div class="card animate delay-3">
<p class="card-text" style="font-size: 1.1rem;">
<strong>3. المراجعات الحية ضرورية</strong> للمواضيع المتطورة. تصبح المراجعات ذات النقاط الزمنية الثابتة قديمة الطراز على الفور.
                  </p>
</div>
<div class="card animate delay-4">
<p class="card-text" style="font-size: 1.1rem;">
<strong>4. الضغط السياسي لا يغير علم الأحياء.</strong>
                    الأساليب الصارمة تحمي المرضى حتى عندما يكونون تحت الضغط.
                  </p>
</div>
</div>
</div>
 القصة: ثورة حساسية الفول السوداني LEAP 
<div class="slide dark" data-index="10b">
<div class="story-box animate">
<p class="story-opener">ماذا لو كانت الوقاية هي السبب؟</p>
<div class="real-data-box">
<h4>البيانات الحقيقية</h4>
<p>
                    لعقود من الزمن، أوصت إرشادات طب الأطفال بما يلي: <span class="data-highlight">تجنب تناول الفول السوداني في مرحلة الطفولة</span> لمنع الحساسية. وفي الوقت نفسه، معدلات حساسية الفول السوداني <span class="data-highlight">تضاعف ثلاث مرات</span> من عام 1997 إلى عام 2008. ثم جاء <span class="data-highlight">قفزة (2015)</span>: 640 رضيعًا معرضين لخطر شديد تم اختيارهم بصورة عشوائية لإدخال الفول السوداني مبكرًا مقابل تجنبه. النتيجة: الإدخال المبكر <span class="data-highlight">أدى إلى تقليل حساسية الفول السوداني بنسبة 81%</span> (1.9% مقابل 13.7%). كانت استراتيجية الوقاية هي التي تسببت في انتشار الوباء.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">مفترق طرق أخصائي الحساسية: 2010</div>
<div class="decision-scenario">
                    أنت طبيب حساسية أطفال. حساسية الفول السوداني آخذة في الارتفاع على الرغم من المبادئ التوجيهية لتجنبها. هل تشكك في العقيدة؟
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">المسار أ: اتبع الإرشادات</div>
<div class="path-choice">استمر في التوصية بتجنب الفول السوداني عند الرضع المعرضين لمخاطر عالية</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">المبادئ التوجيهية "قائمة على الأدلة". من الآمن اتباع الإجماع.</div>
<div class="path-outcome">النتيجة: تستمر حساسية الفول السوداني في الارتفاع</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">المسار ب: تشكك في العقيدة</div>
<div class="path-choice">صمم تجربة لاختبار ما إذا كان التقديم المبكر قد يكون وقائيًا</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">تجربة LEAP تكشف الحقيقة. المبادئ التوجيهية عكس في جميع أنحاء العالم.</div>
<div class="path-outcome">النتيجة: منع الوباء</div>
</div>
</div>
</div>
<div class="story-timeline">
<div class="timeline-point">2000: توصي AAP بتجنبه</div>
<div class="timeline-point critical">2008: معدلات الحساسية ثلاث مرات</div>
<div class="timeline-point resolution">2015: LEAP يعكس الدليل</div>
<div class="timeline-point resolution">2017: المبادئ التوجيهية تتحول إلى التقديم المبكر</div>
</div>
<div class="story-revelation">
<div class="revelation-label">الرؤيا</div>
<div class="revelation-text">
                    يتطلب "أولاً، لا ضرر ولا ضرار" دليلاً. إن الافتراضات، حتى لو كانت حسنة النية، يمكن أن تسبب ضررا على نطاق واسع. يحتاج الجهاز المناعي إلى التعرض لتطوير القدرة على التحمل، وقد أدى التجنب إلى حدوث حساسية.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 11</h2>
<div class="quiz-container">
<div class="quiz-question" id="q11-1">
<h4>1. ما هو الخلل الرئيسي في دراسة غوتريت هيدروكسي كلوروكين؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 0, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>A.</span> عدد قليل جدًا من المرضى
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 1, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>B.</span> لا يسبب العمى
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 2, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>C.</span> باستثناء المرضى الذين تدهورت حالتهم
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 3, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>D.</span> متابعة قصيرة جدًا
                      </div>
</div>
<div id="q11-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q11-2" style="margin-top: 1.5rem;">
<h4>2. ما الذي يساعد التحليل التسلسلي للمحاكمة في تحديده؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 0, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>A.</span> ما هي الدراسات التي تنطوي على مخاطر عالية للتحيز
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 1, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>B.</span> عندما تتراكم أدلة كافية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 2, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>C.</span> درجة عدم التجانس
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 3, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>D.</span> ما هو العلاج الأفضل
                      </div>
</div>
<div id="q11-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q11-3" style="margin-top: 1.5rem;">
<h4>3. لماذا أظهرت دراسات COVID الرصدية فائدة HCQ بينما لم تظهر التجارب المعشاة ذات الشواهد؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 0, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>A.</span> سجلت التجارب المعشاة ذات الشواهد مرضى أكثر مرضًا
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 1, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>B.</span> استخدمت التجارب المعشاة ذات الشواهد نتائج مختلفة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 2, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>C.</span> التحيز في الدراسات الرصدية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 3, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>D.</span> الدراسات الرصدية لديها بيانات أفضل
                      </div>
</div>
<div id="q11-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="12">
<p class="closing-line animate">لا يمكن للسرعة أن تحل محل الدقة.</p>
<p class="closing-line animate delay-1">لكن الصرامة يمكن أن تكون سريعة.</p>
<p class="closing-line gold animate delay-2">توازن المراجعات الحية بين كليهما.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">ليست كل إشارة الحقيقة.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 12: الأساليب المتقدمة</p>
</div>
</div>
 الوحدة 12: الأساليب المتقدمة 
<div class="module-slides" data-module="12">
<div class="slide dark active" data-index="0">
<p class="refrain animate">ليست كل إشارة الحقيقة.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">الأساليب المتقدمة</p>
<p class="title gold animate delay-1 text-center">ما وراء التحليل التلوي الزوجي.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الوحدة 12: الأساليب المتقدمة</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>تفسير هندسة التحليل التلوي للشبكة وتصنيفات SUCRA</li>
<li>تطبيق النماذج ثنائية المتغير للتحليل التلوي لدقة الاختبار التشخيصي</li>
<li>قم بإجراء تحليل تلوي للاستجابة للجرعة باستخدام شرائح مرنة</li>
<li>فهم متى تكون هناك حاجة إلى تحليل تلوي لبيانات المريض الفردية (IPD)</li>
<li>التعرف على الافتراضات والقيود كل طريقة متقدمة</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">عندما لا يكون الاقتران كافيًا</h2>
<p class="direct-address animate delay-1">
                  "في بعض الأحيان يكون السؤال أكثر تعقيدًا من السؤال A مقابل B..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    تشكل الأساليب التي تعلمتها الأساس. لكن الواقع السريري يتطلب في كثير من الأحيان المزيد:
                    <strong>أي من مضادات الاكتئاب العشرة هو الأفضل؟</strong> <strong>ما هي الجرعة المثالية من الستاتين؟</strong>
<strong>هل يشخص هذا الاختبار السرطان المبكر بدقة؟</strong>
</p>
</div>
<p class="footnote animate delay-3">
                  تقدم هذه الوحدة أربع طرق متقدمة - كل منها يجيب على أسئلة معقدة مختلفة.
                </p>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">التحليل التلوي للشبكة (NMA)</h2>
<p class="animate delay-1" style="font-style: italic;">عندما يكون لديك العديد من العلاجات ولكن القليل من التجارب المباشرة</p>
<div class="card animate delay-2">
<p class="card-text">
                    يجمع NMA <strong>الأدلة المباشرة</strong> (أ ضد ب) مع <strong>الأدلة غير المباشرة</strong>
                    (A vs C، B vs C → المستنتج A vs B) لمقارنة علاجات متعددة في وقت واحد.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">سوكرا</div>
<div class="stat-label">احتمالات الترتيب، وليس حجم التأثير</div>
</div>
<div class="stat-box">
<div class="stat-value">تناسق</div>
<div class="stat-label">مباشر = غير مباشر؟</div>
</div>
<div class="stat-box">
<div class="stat-value">الشبكات</div>
<div class="stat-label">تصور الأدلة</div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>مثال NMA: مضادات الاكتئاب</h3>
</div>
<p class="direct-address">
                  قام Cipriani 2018 NMA البارز بمقارنة 21 مضادًا للاكتئاب باستخدام 522 تجربة.
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">التحدي</h4>
<p>21 عقارًا، ولكن لم يتم اختبار كل زوج وجهاً لوجه</p>
<p style="font-size: 0.85rem;">الكثير مقابل الدواء الوهمي، القليل مقابل بعضها البعض</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">الحل</h4>
<p>يجمع NMA بين الأدلة المباشرة وغير المباشرة عبر الشبكة</p>
<p style="font-size: 0.85rem;">يصنف كل 21 طريقة من حيث الفعالية والمقبولية</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem;">
<p class="main">النتيجة: حصلت بعض الأدوية على تصنيف أعلى من حيث الفعالية، والبعض الآخر من حيث المقبولية</p>
<p class="sub">لا يوجد دواء واحد هو "الأفضل" عالميًا؛ تفسير التصنيفات بفواصل زمنية موثوقة، وعبورية، ومقايضات سريرية.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">NMA: الافتراضات الحرجة</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #f59e0b;">1</div>
<div class="lesson-content">
<h4>العبور</h4>
<p>ينبغي توزيع معدِّلات التأثير بالمثل عبر المقارنات؛ وإلا فإن المقارنات غير المباشرة قد تكون متحيزة</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #f59e0b;">2</div>
<div class="lesson-content">
<h4>تناسق</h4>
<p>تتفق الأدلة المباشرة وغير المباشرة (قابلة للاختبار)</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #f59e0b;">3</div>
<div class="lesson-content">
<h4>الشبكة المتصلة</h4>
<p>جميع المعالجات مرتبطة من خلال مقارنة مشتركة واحدة على الأقل</p>
</div>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">عندما تفشل الافتراضات، يمكن أن يكون NMA مضللاً</p>
<p class="sub">قم دائمًا بتقييم العبورية واختبار عدم الاتساق.</p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">التحليل التلوي للاستجابة للجرعة</h2>
<p class="animate delay-1" style="font-style: italic;">العثور على الجرعة المثالية</p>
<div class="card animate delay-2">
<p class="card-text">
                    يستخدم <strong>طريقة جرينلاند-لونجنيكر</strong> مع شرائح مكعبة مقيدة لنموذج العلاقات غير الخطية بين الجرعة والتأثير.
                  </p>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>الأنماط غير الخطية</h4>
<p>على شكل J (الكحول والوفيات)، على شكل U (فيتامين د)، العتبة (الأسبرين)</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>الأهمية السريرية</h4>
<p>ابحث عن الجرعة ذات التوازن الأفضل بين الفوائد والأضرار، وليس فقط "الأكثر أفضل"</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">مريض فردي البيانات (IPD)</h2>
<p class="animate delay-1" style="font-style: italic;">المعيار الذهبي لتحليل المجموعات الفرعية</p>
<div class="card animate delay-2">
<p class="card-text">
                    بدلاً من البيانات الموجزة المنشورة، احصل على <strong>البيانات الأولية على مستوى المريض</strong> من القائمين على التجارب. يتيح إجراء تحليلات دقيقة للمجموعات الفرعية، ونمذجة الوقت حتى الحدث، والتعريفات الموحدة.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">مرحلة واحدة</div>
<div class="stat-label">مجموعة بيانات ضخمة واحدة</div>
</div>
<div class="stat-box">
<div class="stat-value">مرحلتين</div>
<div class="stat-label">التحليل ثم التجميع</div>
</div>
<div class="stat-box">
<div class="stat-value">مطلوب 80%+</div>
<div class="stat-label">للاستدلال الصحيح</div>
</div>
</div>
<p class="footnote animate delay-4">
                  كانت المجموعة التعاونية لمحاكمة سرطان الثدي المبكر رائدة في IPD MA في الثمانينيات.
                </p>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">دقة الاختبار التشخيصي (DTA)</h2>
<p class="animate delay-1" style="font-style: italic;">عندما يكون "التدخل" بمثابة اختبار</p>
<div class="card animate delay-2">
<p class="card-text">
                    تجميع التحليل التلوي DTA <strong>حساسية</strong> (المعدل الإيجابي الحقيقي) و
                    <strong>خصوصية</strong> (المعدل السلبي الحقيقي) - نتيجتان مترابطتان تتطلبان نماذج ثنائية المتغير.
                  </p>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>نموذج ثنائي المتغير/HSROC</h4>
<p>حسابات الارتباط بين الحساسية والنوعية</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>منحنى SROC</h4>
<p>ملخص منحنى ROC مع مناطق الثقة والتنبؤ بنسبة 95%</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>كواداس-2</h4>
<p>تقييم جودة دراسات الدقة التشخيصية</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">اختيار الخيار الصحيح الطريقة</h2>
<table class="results-table animate delay-1">
<thead>
<tr><th>سؤال</th><th>طريقة</th></tr>
</thead>
<tbody>
<tr><td>هل يتغلب "أ" على "ب"؟</td><td><strong>MA الزوجي</strong></td></tr>
<tr><td>أي من العلاجات العديدة هو الأفضل؟</td><td><strong>ماجستير الشبكة (NMA)</strong></td></tr>
<tr><td>ما هي الجرعة المثالية؟</td><td><strong>الجرعة والاستجابة ماجستير</strong></td></tr>
<tr><td>من يستفيد أكثر؟ (مجموعات فرعية)</td><td><strong>إي بي دي ما</strong></td></tr>
<tr><td>ما مدى دقة هذا الاختبار؟</td><td><strong>دي تي ايه ما</strong></td></tr>
<tr><td>كيف يتطور التأثير بمرور الوقت؟</td><td><strong>البقاء على قيد الحياة/الوقت إلى الحدث MA</strong></td></tr>
</tbody>
</table>
<p class="footnote animate delay-2">يجب أن تتطابق الطريقة مع السؤال. لا تفرض سؤالًا بطريقة خاطئة أبدًا.</p>
</div>
</div>
 القصة: المنشطات في ملحمة الإنتان 
<div class="slide dark" data-index="9b">
<div class="story-box animate">
<p class="story-opener">ثلاث محاكمات كبيرة. ثلاث إجابات مختلفة. ماذا تعتقد؟</p>
<div class="real-data-box">
<h4>البيانات الحقيقية</h4>
<p>
<span class="data-highlight">كورتيكوس (2008):</span> 499 مريضا. الهيدروكورتيزون في الصدمة الإنتانية. <span class="data-highlight">لا فائدة من الوفيات</span>.
                    <span class="data-highlight">الغدة الكظرية (2018):</span> 3658 مريضا. الهيدروكورتيزون. <span class="data-highlight">لا فائدة من الوفيات</span>.
                    <span class="data-highlight">أبروشس (2018):</span> 1241 مريضا. هيدروكورتيزون + فلودروكورتيزون. <span class="data-highlight">انخفض معدل الوفيات</span> (43% مقابل 49.1%، ع=0.03). نفس فئة التدخل بروتوكولات مختلفة. نتائج مختلفة.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">تحدي كاتب الإرشادات</div>
<div class="decision-scenario">
                    أنت تكتب إرشادات حول الإنتان. ثلاث محاكمات كبرى تختلف. كيف توصي؟
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">المسار أ: المتوسط البسيط</div>
<div class="path-choice">تجميع كافة التجارب الثلاث. التأثير الكلي غير مؤكد. استنتج "الأدلة غير واضحة".</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">تقول الإرشادات أن المنشطات اختيارية. لا توجد توصية قوية.</div>
<div class="path-outcome">النتيجة: ترك الأطباء دون توجيه واضح</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">المسار ب: التحقيق في عدم التجانس</div>
<div class="path-choice">تحليل سبب اختلاف APROCCHSS (فلودروكورتيزون، مدة أطول، مجموعات سكانية مختلفة)</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">تحديد أن البروتوكول الفعال يختلف عن البروتوكولات غير الفعالة.</div>
<div class="path-outcome">النتيجة: التوصية بالبروتوكول الفعال المحدد</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">الرؤيا</div>
<div class="revelation-text">
                    التجارب المتعارضة ليست فاشلة. إنها خرائط توضح الأماكن التي يعمل فيها العلاج والأماكن التي لا يعمل فيها. إن الاختلافات بين التجارب — الجرعة، والمدة، والتدخلات المشتركة، والسكان — هي مفتاح الفهم.
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 12</h2>
<div class="quiz-container">
<div class="quiz-question" id="q12-1">
<h4>1. ما هي الميزة الرئيسية للتحليل التلوي للشبكة عبر الزوج؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 0, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>A.</span> لا يتطلب استخراج البيانات
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 1, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>B.</span> يقارن المعالجات التي لم يتم اختبارها بشكل مباشر ضد بعضها البعض
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 2, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>C.</span> إنه يلغي الحاجة إلى تقييم مخاطر التحيز
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 3, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>D.</span> وينتج قطعًا أفضل للغابات
                      </div>
</div>
<div id="q12-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q12-2" style="margin-top: 1.5rem;">
<h4>2. لماذا يتطلب التحليل التلوي DTA نماذج ثنائية المتغير؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 0, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>A.</span> للتعامل مع أكثر من دراستين
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 1, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>B.</span> لضبط تحيز النشر
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 2, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>C.</span> الحساسية والنوعية هما المرتبطة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 3, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>D.</span> لإنشاء قطع أراضي الغابات
                      </div>
</div>
<div id="q12-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q12-3" style="margin-top: 1.5rem;">
<h4>3. ما الذي يتطلبه افتراض "الاتساق" في NMA؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 0, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>A.</span> يجب أن تكون جميع الدراسات ذات جودة عالية
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 1, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>B.</span> يجب أن تتفق الأدلة المباشرة وغير المباشرة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 2, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>C.</span> يجب أن تكون أحجام العينات متشابهة
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 3, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>D.</span> لا توجد دراسات مفقودة
                      </div>
</div>
<div id="q12-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="11">
<p class="closing-line animate">يجب أن تتطابق الطريقة مع السؤال.</p>
<p class="closing-line animate delay-1">الطرق المتقدمة تجيب المتقدمة الأسئلة.</p>
<p class="closing-line gold animate delay-2">لكن الأساسيات لا تتغير أبدًا.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="12">
<div class="animate" style="text-align: center;">
<p class="refrain">ليست كل إشارة الحقيقة.</p>
<p style="font-size: 1.1rem; margin-top: 1rem;">الطرق تحمي المرضى من ثقتنا.</p>
<div class="gold-line" style="margin: 1.5rem auto;"></div>
<p style="font-size: 1.3rem; color: var(--gold); margin-top: 1.5rem;">
                  لقد أكملت عكس الأدلة: دورة التحليل التلوي.
                </p>
<p style="font-size: 1rem; margin-top: 1rem; opacity: 0.9;">
                  أتمنى أن يسترشد تركيبك بالحقيقة، وتجميعك بالحكمة،<br/>
                  واستنتاجاتك بالتواضع.
                </p>
<p style="font-size: 0.9rem; margin-top: 2rem; font-style: italic; opacity: 0.7;">
                  "اهدنا إلى الصراط المستقيم..."
                </p>
</div>
</div>
</div>
 الوحدة 13: Capstone - أول سباق سريع لديك 
<div class="module-slides" data-module="13">
<div class="slide dark active" data-index="0">
<p class="refrain animate">يجب اكتساب اليقين وليس افتراضه.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 13: أول سباق سريع لك</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">الوحدة 13: أول سباق سريع لك</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 أهداف التعلم</h4>
<ul>
<li>فهم المراجعة المنهجية لمدة 40 يومًا سير العمل</li>
<li>قم بتخطيط المبادئ السبعة لمراحل الممارسة الحقيقية</li>
<li>التعرف على بوابات تعريف الإنهاء (DoD) كنقاط تفتيش للجودة</li>
<li>نقدر لماذا يمنع الهيكل حالات الفشل التي درستها</li>
<li>خريج جاهز لإجراء (وليس مجرد فهم) التحليل التلوي</li>
</ul>
</div>
</div>
</div>
 اكتملت الرحلة 
<div class="slide dark" data-index="2">
<p class="title cream animate">لقد تعلمت القصص.</p>
<p class="title gold animate delay-1">الآن يجب عليك السير على الطريق.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                كل عكس الأدلة التي درستها حدث بسبب الفرق <em>knew</em> الطرق ولكن لم <em>يتبع</em> لهم بشكل منهجي.
              </p>
</div>
 إطار عمل META-SPRINT 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">إطار عمل META-SPRINT</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  سير عمل منظم لمدة 40 يومًا مع 5 بوابات طور. كل بوابة عبارة عن نقطة تفتيش لتعريف التنفيذ (DoD) تمنعك من المضي قدمًا حتى يتم ضمان الجودة.
                </p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">40</div>
<div class="stat-label">الأيام حتى الانتهاء</div>
</div>
<div class="stat-box">
<div class="stat-value">5</div>
<div class="stat-label">بوابات مرحلة وزارة الدفاع</div>
</div>
<div class="stat-box">
<div class="stat-value">اليوم 34</div>
<div class="stat-label">تجميد صعب</div>
</div>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; background: rgba(212,175,55,0.1); border: 1px solid var(--gold);">
<p class="card-text" style="font-size: 0.9rem;">
<strong style="color: var(--gold);">لماذا 40 يوما؟</strong> طويلة بما يكفي للدقة، وقصيرة بما يكفي لمنع زحف النطاق. تم دفن إشارات القلب روزيجليتازون لسنوات لأنه لم يكن هناك موعد نهائي يفرض الشفافية.
                  </p>
</div>
</div>
</div>
 البوابات الخمس 
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">بوابات المرحلة الخمس</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #7C3AED;">A</div>
<div class="lesson-content">
<h4>DoD-A: قفل البروتوكول (الأيام 1-3)</h4>
<p>تم تعريف PICOS، وتم تعيين قواعد النقطة الزمنية، واختيارات النموذج محددة مسبقًا. <em>لا يوجد هدف متحرك.</em></p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #2563EB;">B</div>
<div class="lesson-content">
<h4>DoD-B: قفل البحث (الأيام 6-10)</h4>
<p>تم البحث في جميع قواعد البيانات، وفحص الأدبيات الرمادية، والتحقق من صحة PRESS. <em>لا توجد دراسات مخفية.</em></p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #D97706;">C</div>
<div class="lesson-content">
<h4>DoD-C: قفل الاستخراج (الأيام 10-28)</h4>
<p>الاستخراج المزدوج، ربط المصدر، تقييم RoB. <em>لا أرقام ملفقة.</em></p>
</div>
</div>
</div>
</div>
 وتابع غيتس 
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">بوابات المرحلة الخمس (تابع)</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #059669;">D</div>
<div class="lesson-content">
<h4>DoD-D: قفل التحليل (الأيام 21-33)</h4>
<p>تم إنشاء قطع الغابات، وإجراء تحليلات الحساسية، واستكشاف عدم التجانس. <em>لا قطف الكرز.</em></p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #DC2626;">E</div>
<div class="lesson-content">
<h4>DoD-E: قفل التقديم (الأيام 33-40)</h4>
<p>تصنيف درجة اليقين، كتابة الملخص السريري، وضع اللمسات النهائية على المخطوطة. <em>لا ثقة زائدة.</em></p>
</div>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; background: rgba(220,38,38,0.1); border: 1px solid #DC2626;">
<p class="card-text" style="font-size: 0.9rem;">
<strong style="color: #DC2626;">تجميد اليوم 34:</strong> لا يمكن إجراء دراسات جديدة تمت إضافته بعد اليوم 34. وهذا يمنع "زحف النطاق المسلح" الذي ابتليت به التحليلات الوصفية لجراحة العمود الفقري لـ BMP، حيث استمرت الصناعة في "العثور" على دراسات إيجابية.
                  </p>
</div>
</div>
</div>
 سبعة مبادئ تم تعيينها للممارسة 
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">المبادئ السبعة في الممارسة</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  كل مبدأ تعلمته يرتبط ببوابة مرحلة محددة:
                </p>
<div class="animate delay-2" style="display: grid; gap: 0.5rem; font-size: 0.85rem;">
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(124,58,237,0.1); border-radius: 6px;">
<span style="color: #7C3AED; font-weight: 700; min-width: 40px;">وزارة الدفاع-أ</span>
<span>"<em>ليست كل إشارة هي الحقيقة</em>" — حدد مسبقًا ما يمكن اعتباره الدليل</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(37,99,235,0.1); border-radius: 6px;">
<span style="color: #2563EB; font-weight: 700; min-width: 40px;">DoD-B</span>
<span>"<em>ما الذي كان مخفيا على مرأى من الجميع؟</em>" - بحث شامل</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(217,119,6,0.1); border-radius: 6px;">
<span style="color: #D97706; font-weight: 700; min-width: 40px;">DoD-C</span>
<span>"<em>الرقم بدون مصدر ليس رقمًا</em>" — ربط كل نقطة بيانات</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(5,150,105,0.1); border-radius: 6px;">
<span style="color: #059669; font-weight: 700; min-width: 40px;">DoD-D</span>
<span>"<em>التجانس هو رسالة وليس ضجيج</em>"- تحقق، لا تتجاهل</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(220,38,38,0.1); border-radius: 6px;">
<span style="color: #DC2626; font-weight: 700; min-width: 40px;">DoD-E</span>
<span>"<em>فاليقين يجب اكتسابه، وليس افتراضه</em>"- صنف كل شيء</span>
</div>
</div>
</div>
</div>
 ضمان الجودة الخصومة للفريق الأحمر 
<div class="slide dark" data-index="7">
<p class="title cream animate">مبدأ الفريق الأحمر</p>
<p class="title gold animate delay-1">فريقك الخاص يحاول تعطيل عملك.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1rem; text-align: center; max-width: 650px;">
                في كل يوم، يقضي اثنان من أعضاء الفريق المتناوبين 12 دقيقة في التحقق من جودة البيانات كخصوم. هذه هي الطريقة التي تم بها اكتشاف احتيال بولدت - ليس من خلال المراجعة الودية، ولكن من خلال الفحص المتشكك الذي لاحظ معدلات توظيف مستحيلة.
              </p>
</div>
 بروتوكول الطوارئ CondGO 
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">CondGO: عندما تسوء الأمور</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  ماذا يحدث عندما تكتشف مشكلة حرجة في منتصف السباق؟
                </p>
<div class="card animate delay-2" style="background: rgba(217,119,6,0.1); border: 1px solid #D97706;">
<h4 style="color: #D97706;">CondGO = الذهاب المشروط</h4>
<p class="card-text" style="font-size: 0.9rem;">
                    بروتوكول إنقاذ محدود. لديك بالضبط <strong>72 ساعة</strong> لإصلاح المشكلة باستخدام الإجراءات المسموح بها فقط. إذا لم تتمكن من إصلاح الأمر، فيجب عليك إيقاف المراجعة.
                  </p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem;">
<p class="card-text" style="font-size: 0.85rem; font-style: italic;">
                    📖 <strong>درس أفانديا:</strong> شهدت شركة GSK إشارات القلب والأوعية الدموية في عام 2000 ولكن لم يكن لديها موعد نهائي قسري. لقد "شاهدوا وانتظروا" لمدة 7 سنوات. وتضرر عشرات الآلاف. توجد CondGO لأن عبارة "سنتعامل معها في النهاية" تقتل الأشخاص.
                  </p>
</div>
</div>
</div>
 تخرجك 
<div class="slide dark" data-index="9">
<p class="title cream animate">لقد بدأت هذه الدورة بالقصص.</p>
<p class="title gold animate delay-1">لقد أنهيتها جاهزة للتمرين.</p>
<div class="gold-line animate delay-2"></div>
<div class="animate delay-3" style="text-align: center; max-width: 600px;">
<p style="font-size: 1rem; margin-bottom: 1rem;">
                  يأخذ سير عمل META-SPRINT كل ما تعلمته وينظمه في نظام مدته 40 يومًا يمنع حالات الفشل التي تمت دراستها.
                </p>
<p style="font-size: 0.9rem; opacity: 0.9;">
                  عندما تكون مستعدًا لإجراء مراجعة منهجية حقيقية، افتح تطبيق META-SPRINT. ستوجهك القصص التي تعلمتها هنا، وستظهر كتذكيرات في كل خطوة.
                </p>
</div>
</div>
 اختبار Capstone 
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">اختبار الوحدة 13</h2>
<div class="quiz-container">
<div class="quiz-question" id="q13-1">
<h4>1. ما هو الغرض من "التجميد الشديد" لليوم 34 في META-SPRINT؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 0, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">أ. لإتاحة الوقت لمراجعة النظراء</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 1, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">ب. لمنع الدراسات المضافة متأخراً من التلاعب بالنتائج</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 2, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">ج. لتسريع النشر</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 3, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">د. للتنسيق مع المواعيد النهائية للمجلة</div>
</div>
<div class="quiz-feedback" id="q13-1-feedback"></div>
</div>
<div class="quiz-question" id="q13-2" style="margin-top: 1.5rem;">
<h4>2. يمنح بروتوكول CondGO الفرق المدة اللازمة لإصلاح المشكلات الحرجة؟</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 0, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">أ. 24 ساعة</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 1, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">ب. 48 ساعة</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 2, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">ج. 72 ساعة</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 3, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">د. أسبوع واحد</div>
</div>
<div class="quiz-feedback" id="q13-2-feedback"></div>
</div>
<div class="quiz-question" id="q13-3" style="margin-top: 1.5rem;">
<h4>3. اكتشف فريق ضمان الجودة الخصوم للفريق الأحمر احتيال يواكيم بولدت من خلال ملاحظة:</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 0, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">أ. معدلات توظيف المرضى المستحيلة</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 1, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">ب. الاختراق في الاختبارات الإحصائية</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 2, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">ج. أحجام التأثير غير المتسقة</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 3, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">د. شهادة المبلغين عن المخالفات</div>
</div>
<div class="quiz-feedback" id="q13-3-feedback"></div>
</div>
</div>
</div>
</div>
 إغلاق 
<div class="slide black" data-index="11">
<div class="animate" style="text-align: center;">
<p class="refrain">القصص التي تعلمتها ليست تاريخًا.</p>
<p style="font-size: 1.2rem; margin-top: 1rem; color: var(--gold);">إنها تحذيرات تحمي عملك المستقبلي.</p>
<div class="gold-line" style="margin: 1.5rem auto;"></div>
<p style="font-size: 1rem; margin-top: 1.5rem; opacity: 0.9;">
                  عندما تقوم بإجراء التحليل التلوي الأول،<br/>
                  تذكر CAST قبل أن تثق في إشارة،<br/>
                  تذكر Poldermans قبل تخطي المصدر،<br/>
                  تذكر Reboxetine قبل أن تتجاهل مسار التحويل.
                </p>
<p style="font-size: 0.9rem; margin-top: 1.5rem; font-style: italic; opacity: 0.8;">
                  أنت الآن جاهز. الذهاب مع الهيكل. اذهب بالتواضع. اتبع المبادئ السبعة.
                </p>
</div>
</div>
<div class="slide black" data-index="12">
<p class="refrain animate">ليست كل إشارة الحقيقة.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الوحدة 14: الاختبار النهائي</p>
</div>
</div>
 الوحدة 14: الاختبار النهائي (التقييم الختامي) 
<div class="module-slides" data-module="14">
<div class="slide dark active" data-index="0">
<p class="refrain animate">يجب اكتساب اليقين وليس افتراضه.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">الاختبار النهائي</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">الاختبار النهائي: الجزء 1 من 2</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1.5rem;">
                  اختبر مدى إتقانك لمبادئ التحليل التلوي. يتناول كل سؤال مفهومًا أساسيًا من الدورة.
                </p>
<!-- Q1: PICO -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q1.</strong> يريد أحد الباحثين دراسة "تأثيرات التمارين الرياضية على الصحة". ما هي المشكلة الأساسية في سؤال البحث هذا؟</p>
<div class="quiz-options" id="final-q1">
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 0, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>A.</span> إنه يفتقر إلى التوزيع العشوائي
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 1, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>B.</span> حجم العينة صغير جدًا
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 2, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>C.</span> ليس كذلك للإجابة - يفتقر إلى عناصر PICO المحددة
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 3, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>D.</span> ويفتقر إلى الموافقة الأخلاقية
                    </div>
</div>
<div id="final-q1-feedback" style="display: none;"></div>
</div>
 السؤال الثاني: تحيز النشر 
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q2.</strong> يُظهر المخطط القمعي عدم تناسق واضح مع الدراسات المفقودة في المنطقة السفلية اليسرى. ماذا يوحي هذا؟</p>
<div class="quiz-options" id="final-q2">
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 0, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>A.</span> الدراسات الكبيرة لديها تقديرات أكثر دقة
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 1, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>B.</span> من المحتمل أن تكون الدراسات السلبية الصغيرة غير منشورة
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 2, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>C.</span> التأثير الحقيقي أقوى من المقدر
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 3, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>D.</span> خطأ في أخذ العينات العشوائية
                    </div>
</div>
<div id="final-q2-feedback" style="display: none;"></div>
</div>
 Q3: عدم التجانس 
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q3.</strong> يشير التحليل التلوي إلى I² = 85% وτ² = 0.42. ما هو التفسير الأكثر ملاءمة؟</p>
<div class="quiz-options" id="final-q3">
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 0, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>A.</span> هناك فرصة بنسبة 85% للتأثير الحقيقي
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 1, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>B.</span> حجم التأثير كبير جدًا
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 2, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>C.</span> يوجد تباين كبير بين الدراسة؛ التحقيق في المصادر
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 3, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>D.</span> النتائج مهمة سريريًا
                    </div>
</div>
<div id="final-q3-feedback" style="display: none;"></div>
</div>
 Q4: الصف 
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q4.</strong> في GRADE، ما هو اليقين المبدئي لمجموعة من الأدلة من التجارب المعشاة ذات الشواهد؟</p>
<div class="quiz-options" id="final-q4">
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 0, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>A.</span> High
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 1, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>B.</span> معتدل
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 2, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>C.</span> Low
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 3, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>D.</span> منخفض جدًا
                    </div>
</div>
<div id="final-q4-feedback" style="display: none;"></div>
</div>
 س5: خطر التحيز 
<div class="quiz-box animate delay-2">
<p class="quiz-question"><strong>Q5.</strong> في RoB 2.0، ما المجال الذي يقيم ما إذا كان مقيمو النتائج يعرفون تخصيص العلاج؟</p>
<div class="quiz-options" id="final-q5">
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 0, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>A.</span> D1: عملية التوزيع العشوائي
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 1, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>B.</span> D2: الانحرافات عن التدخلات المقصودة
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 2, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>C.</span> D3: نتيجة مفقودة البيانات
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 3, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>D.</span> D4: قياس النتيجة
                    </div>
</div>
<div id="final-q5-feedback" style="display: none;"></div>
</div>
</div>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">الاختبار النهائي: الجزء 2 من 2</h2>
 Q6: عكس الأدلة 
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q6.</strong> أظهرت تجربة CAST أن الأدوية المضادة لاضطراب النظم تزيد معدل الوفيات على الرغم من قمع عدم انتظام ضربات القلب. هذا مثال على:</p>
<div class="quiz-options" id="final-q6">
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 0, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>A.</span> خطأ في أخذ العينات العشوائية
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 1, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>B.</span> فشل النتيجة البديلة
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 2, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>C.</span> مربكة بالإشارة
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 3, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>D.</span> السببية العكسية
                    </div>
</div>
<div id="final-q6-feedback" style="display: none;"></div>
</div>
 Q7: التأثيرات الثابتة مقابل التأثيرات العشوائية 
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q7.</strong> متى يجب تفضيل نموذج التأثيرات العشوائية على التأثير الثابت نموذج؟</p>
<div class="quiz-options" id="final-q7">
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 0, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>A.</span> عندما تكون أحجام العينات كبيرة
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 1, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>B.</span> عندما تكون النتائج ثنائية
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 2, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>C.</span> عندما يكون من المتوقع عدم التجانس بين الدراسات
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 3, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>D.</span> عند الاشتباه في تحيز النشر
                    </div>
</div>
<div id="final-q7-feedback" style="display: none;"></div>
</div>
<!-- Q8: ICEMAN -->
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q8.</strong> وفقًا لمعايير ICEMAN، مما يجعل تحليل المجموعة الفرعية أكثر مصداقية؟</p>
<div class="quiz-options" id="final-q8">
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 0, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>A.</span> تم تحديد الفرضية مسبقًا
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 1, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>B.</span> تم اختبار عدد كبير من المجموعات الفرعية
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 2, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>C.</span> لا يوجد مبرر بيولوجي
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 3, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>D.</span> تأثيرات غير متناسقة عبر التجارب داخل المجموعة الفرعية
                    </div>
</div>
<div id="final-q8-feedback" style="display: none;"></div>
</div>
 س9: التحليل التلوي للشبكة 
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q9.</strong> ما الافتراض الذي يجب التحقق منه في التحليل التلوي للشبكة لضمان المقارنات غير المباشرة الصحيحة؟</p>
<div class="quiz-options" id="final-q9">
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 0, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>A.</span> جميع الدراسات لها أحجام عينات متساوية
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 1, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>B.</span> تقيس جميع الدراسات نفس النتيجة
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 2, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>C.</span> العبور (اتساق معدلات التأثير)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 3, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>D.</span> التعمية المزدوجة في جميع التجارب
                    </div>
</div>
<div id="final-q9-feedback" style="display: none;"></div>
</div>
<!-- Q10: TSA -->
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q10.</strong> في التحليل التسلسلي التجريبي (TSA)، إلى ماذا يشير تجاوز حد عدم الجدوى؟</p>
<div class="quiz-options" id="final-q10">
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 0, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>A.</span> أسباب العلاج ضرر
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 1, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>B.</span> من غير المرجح أن تظهر الدراسات الإضافية تأثيرًا ذا معنى
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 2, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>C.</span> الدليل قاطع لصالحه
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 3, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>D.</span> التحليل التلوي ضعيف
                    </div>
</div>
<div id="final-q10-feedback" style="display: none;"></div>
</div>
<div class="animate delay-2" style="margin-top: 2rem; padding: 1.5rem; background: rgba(212,175,55,0.1); border-radius: 8px; border-right: 4px solid var(--gold);">
<p style="font-weight: 600; color: var(--navy);">درجة النجاح: 7/10</p>
<p style="margin-top: 0.5rem; color: var(--light-text);">
                    راجع أي أسئلة لم يتم الرد عليها من خلال العودة إلى الوحدة ذات الصلة. يشير كل سؤال إلى مبدأ أساسي من الدورة.
                  </p>
</div>
</div>
</div>
<div class="slide black" data-index="3">
<div class="animate" style="text-align: center;">
<p class="refrain">ليست كل إشارة الحقيقة.</p>
<p style="font-size: 1.1rem; margin-top: 1rem;">الطرق تحمي المرضى من ثقتنا.</p>
<div class="gold-line" style="margin: 1.5rem auto;"></div>
<p style="font-size: 1.5rem; color: var(--gold); margin-top: 1.5rem;">
                  تهانينا
                </p>
<p style="font-size: 1.1rem; margin-top: 1rem;">
                  لقد أكملت عكس الأدلة: دورة التحليل التلوي.
                </p>
<p style="font-size: 1rem; margin-top: 1rem; opacity: 0.9;">
                  أتمنى أن يسترشد تركيبك بالحقيقة، وتجميعك بالحكمة،<br/>
                  واستنتاجاتك بالتواضع.
                </p>
<div style="margin-top: 2rem; font-size: 0.9rem; opacity: 0.8;">
<p style="margin-bottom: 0.5rem;"><strong>السبعة المبادئ:</strong></p>
<p>"ليست كل إشارة هي الحقيقة."</p>
<p>"أساليب تحمي المرضى من ثقتنا."</p>
<p>"ما الذي كان مخفيا على مرأى من الجميع؟"</p>
<p>"الرقم بدون مصدر ليس رقمًا."</p>
<p>"التباين هو رسالة، وليس ضجيجا."</p>
<p>"غياب الدليل ليس دليلاً على الغياب"</p>
<p>"اليقين يجب أن يُكتسب، لا أن يُفترض."</p>
</div>
<p style="font-size: 0.9rem; margin-top: 2rem; font-style: italic; opacity: 0.7;">
                  "اهدنا إلى الصراط المستقيم..."
                </p>
</div>
</div>
</div>
 التنقل بين الشرائح - الحد الأدنى من الأسهم العائمة 
<nav class="slide-nav" id="slideNav">
<button class="nav-btn" id="prevBtn" onclick="prevSlide()" title="Previous (←)">←</button>
<div class="nav-center">
<div class="progress" id="progress"></div>
<span class="slide-counter" id="counter">1 / 10</span>
</div>
<button class="nav-btn" id="nextBtn" onclick="nextSlide()" title="Next (→)">→</button>
</nav>
</div>
 لوحة الأدوات 
<aside class="tools-panel" id="toolsPanel">
<div class="tools-header">
<h3>الأدوات التفاعلية</h3>
<button class="btn" onclick="toggleToolsPanel()" style="padding: 0.25rem 0.5rem;">×</button>
</div>
<div class="tools-content">
 لوحة بيانات القصة الحية 
<div class="story-data-panel" id="storyDataPanel">
<h4><span style="font-size: 1.1rem;">📊</span> بيانات القصة الحية</h4>
<div id="storyDataContent">
<div class="no-story-data">
                  انتقل إلى الوحدة لرؤية بيانات قصة الأدلة الخاصة بها مع التفاعل قبل/بعد المقارنة.
                </div>
</div>
</div>
 حاسبة حجم التأثير 
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                حاسبة حجم التأثير <span>▼</span>
</div>
<div class="tool-section-body">
<div class="form-group">
<label>نوع التأثير</label>
<select id="effectType">
<option value="OR">نسبة الأرجحية (OR)</option>
<option value="RR">نسبة المخاطرة (RR)</option>
<option value="RD">فرق المخاطر (RD)</option>
<option value="SMD">فرق المتوسط الموحد</option>
<option value="MD">فرق المتوسط</option>
</select>
</div>
<div id="binaryInputs">
<div class="form-group">
<label>المعالجة: الأحداث / الإجمالي</label>
<div style="display: flex; gap: 0.5rem;">
<input id="eventsTx" placeholder="Events" style="flex:1" type="number"/>
<input id="nTx" placeholder="Total" style="flex:1" type="number"/>
</div>
</div>
<div class="form-group">
<label>التحكم: الأحداث / الإجمالي</label>
<div style="display: flex; gap: 0.5rem;">
<input id="eventsCtrl" placeholder="Events" style="flex:1" type="number"/>
<input id="nCtrl" placeholder="Total" style="flex:1" type="number"/>
</div>
</div>
</div>
<button class="btn-small primary" onclick="calculateEffectSize()">احسب</button>
<div class="results-display" id="effectResults" style="display: none;"></div>
</div>
</div>
 حاسبة التحليل التلوي 
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                حاسبة التحليل التلوي <span>▼</span>
</div>
<div class="tool-section-body">
<div class="form-group">
<label>أدخل الدراسات (التأثير، CI منخفض، CI مرتفع)</label>
<table class="study-table" id="studyTable">
<thead>
<tr>
<th>دراسة</th>
<th>التأثير</th>
<th>CI Lo</th>
<th>CI Hi</th>
<th></th>
</tr>
</thead>
<tbody id="studyTableBody">
<tr>
<td><input type="text" value="Study 1"/></td>
<td><input step="0.01" type="number" value="1.25"/></td>
<td><input step="0.01" type="number" value="0.95"/></td>
<td><input step="0.01" type="number" value="1.64"/></td>
<td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
</tr>
<tr>
<td><input type="text" value="Study 2"/></td>
<td><input step="0.01" type="number" value="1.42"/></td>
<td><input step="0.01" type="number" value="1.10"/></td>
<td><input step="0.01" type="number" value="1.83"/></td>
<td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
</tr>
<tr>
<td><input type="text" value="Study 3"/></td>
<td><input step="0.01" type="number" value="0.98"/></td>
<td><input step="0.01" type="number" value="0.72"/></td>
<td><input step="0.01" type="number" value="1.33"/></td>
<td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
</tr>
</tbody>
</table>
<button class="btn-small" onclick="addStudyRow()">+ إضافة دراسة</button>
</div>
<div class="form-group">
<label>مقدر Tau²</label>
<select id="tau2Method">
<option value="DL">DerSimonian-Laird (DL)</option>
<option value="REML">REML</option>
<option value="PM">Paule-Mandel (PM)</option>
<option value="SJ">Sidik-Jonkman (SJ)</option>
<option value="HE">التحوطات (HE)</option>
<option value="EB">بايز التجريبية (EB)</option>
<option value="ML">أقصى احتمال (ML)</option>
<option value="HS">Hunter-Schmidt (HS)</option>
</select>
</div>
<div class="form-group">
<label>
<input checked="" id="useHKSJ" type="checkbox"/> استخدم تعديل HKSJ
                  </label>
</div>
<button class="btn-small primary" onclick="runMetaAnalysis()">تشغيل التحليل</button>
<div class="results-display" id="maResults" style="display: none;"></div>
<div class="forest-plot-container" id="forestPlotContainer" style="display: none;"></div>
</div>
</div>
<!-- PICO Builder -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                PICO Builder <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>سكان</label>
<input id="picoP" placeholder="على سبيل المثال، البالغون المصابون بداء السكري من النوع 2" type="text"/>
</div>
<div class="form-group">
<label>تدخل</label>
<input id="picoI" placeholder="e.g., SGLT2 inhibitors" type="text"/>
</div>
<div class="form-group">
<label>المقارنة</label>
<input id="picoC" placeholder="e.g., Placebo or standard care" type="text"/>
</div>
<div class="form-group">
<label>حصيلة</label>
<input id="picoO" placeholder="e.g., All-cause mortality" type="text"/>
</div>
<button class="btn-small primary" onclick="generatePICO()">إنشاء سؤال</button>
<div id="picoOutput" style="margin-top: 1rem; padding: 0.75rem; background: #f7fafc; border-radius: 4px; display: none;"></div>
</div>
</div>
 تقييم تحيز النشر 
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                انحياز النشر <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  يستخدم البيانات من حاسبة التحليل التلوي أعلاه
                </p>
<button class="btn-small primary" onclick="runPublicationBias()">تقييم تحيز النشر</button>
<div id="pubBiasResults" style="display: none; margin-top: 1rem;">
<div class="results-display" id="eggerResults"></div>
<div class="forest-plot-container" id="funnelPlotContainer" style="margin-top: 0.5rem;"></div>
</div>
</div>
</div>
 خطر التحيز 2.0 
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                خطر التحيز 2.0 <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>اسم الدراسة</label>
<input id="robStudyName" placeholder="e.g., Smith 2020" type="text"/>
</div>
<div class="rob-domains">
<div class="rob-domain">
<label>D1: التوزيع العشوائي</label>
<select id="robD1" onchange="updateRoBOverall()">
<option value="">حدد...</option>
<option value="low">مخاطر منخفضة</option>
<option value="some">بعض المخاوف</option>
<option value="high">خطر مرتفع</option>
</select>
</div>
<div class="rob-domain">
<label>D2: الانحرافات عن التدخل</label>
<select id="robD2" onchange="updateRoBOverall()">
<option value="">حدد...</option>
<option value="low">مخاطر منخفضة</option>
<option value="some">بعض المخاوف</option>
<option value="high">خطر مرتفع</option>
</select>
</div>
<div class="rob-domain">
<label>D3: نتيجة مفقودة البيانات</label>
<select id="robD3" onchange="updateRoBOverall()">
<option value="">حدد...</option>
<option value="low">مخاطر منخفضة</option>
<option value="some">بعض المخاوف</option>
<option value="high">خطر مرتفع</option>
</select>
</div>
<div class="rob-domain">
<label>D4: قياس النتائج</label>
<select id="robD4" onchange="updateRoBOverall()">
<option value="">حدد...</option>
<option value="low">مخاطر منخفضة</option>
<option value="some">بعض المخاوف</option>
<option value="high">خطر مرتفع</option>
</select>
</div>
<div class="rob-domain">
<label>D5: اختيار النتائج المبلغ عنها</label>
<select id="robD5" onchange="updateRoBOverall()">
<option value="">حدد...</option>
<option value="low">مخاطر منخفضة</option>
<option value="some">بعض المخاوف</option>
<option value="high">خطر مرتفع</option>
</select>
</div>
</div>
<div id="robOverall" style="margin-top: 1rem; padding: 0.75rem; border-radius: 6px; text-align: center; font-weight: 600;"></div>
<div id="robTrafficLight" style="margin-top: 0.5rem;"></div>
</div>
</div>
 تقييم الدرجة 
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                درجة اليقين <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>بداية اليقين</label>
<select id="gradeStart">
<option value="4">عالية (RCTs)</option>
<option value="2">منخفضة (رصدية)</option>
</select>
</div>
<p style="font-size: 0.7rem; font-weight: 600; color: var(--navy); margin: 0.75rem 0 0.25rem;">عوامل خفض المستوى:</p>
<div class="grade-factors">
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeRoB" style="width: 100px;">
<option value="0">None</option>
<option value="-1">جدي (-1)</option>
<option value="-2">خطيرة جدًا (-2)</option>
</select>
                      خطر التحيز
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeInconsistency" style="width: 100px;">
<option value="0">None</option>
<option value="-1">جدي (-1)</option>
<option value="-2">خطيرة جدًا (-2)</option>
</select>
                      التناقض
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeIndirectness" style="width: 100px;">
<option value="0">None</option>
<option value="-1">جدي (-1)</option>
<option value="-2">خطيرة جدًا (-2)</option>
</select>
                      عدم المباشرة
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeImprecision" style="width: 100px;">
<option value="0">None</option>
<option value="-1">جدي (-1)</option>
<option value="-2">خطيرة جدًا (-2)</option>
</select>
                      عدم الدقة
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradePubBias" style="width: 100px;">
<option value="0">None</option>
<option value="-1">جدي (-1)</option>
<option value="-2">خطيرة جدًا (-2)</option>
</select>
                      انحياز النشر
                    </label>
</div>
</div>
<button class="btn-small primary" onclick="calculateGRADE()" style="margin-top: 0.5rem;">احسب اليقين</button>
<div id="gradeResult" style="margin-top: 1rem;"></div>
</div>
</div>
 I² التفسير 
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                دليل عدم التجانس <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>أدخل قيمة I² (%)</label>
<input id="i2Input" max="100" min="0" placeholder="e.g., 75" type="number"/>
</div>
<button class="btn-small primary" onclick="interpretI2()">التفسير</button>
<div id="i2Interpretation" style="margin-top: 1rem;"></div>
<div style="margin-top: 1rem; padding: 0.75rem; background: #f7fafc; border-radius: 6px; font-size: 0.75rem;">
<p style="font-weight: 600; margin-bottom: 0.5rem;">إرشادات كوكرين:</p>
<p>0-40%: قد لا يكون مهمًا</p>
<p>30-60%: عدم تجانس معتدل</p>
<p>50-90%: عدم تجانس كبير</p>
<p>75-100%: عدم تجانس كبير</p>
<p style="margin-top: 0.5rem; font-style: italic; color: var(--light-text);">
                    "التباين هو رسالة، وليس ضجيجا."
                  </p>
</div>
</div>
</div>
 حاسبة NNT/NNH 
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                حاسبة NNT/NNH <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  تحويل أحجام التأثير إلى أرقام مطلوب للعلاج/الضرر
                </p>
<div class="form-group">
<label>خطر خط الأساس (معدل حدث التحكم)</label>
<input id="nntCER" max="1" min="0" placeholder="e.g., 0.15 for 15%" step="0.01" type="number"/>
</div>
<div class="form-group">
<label>مقياس التأثير</label>
<select id="nntEffectType">
<option value="RR">نسبة المخاطرة (RR)</option>
<option value="OR">نسبة الأرجحية (OR)</option>
<option value="RD">فرق المخاطر (RD)</option>
</select>
</div>
<div class="form-group">
<label>حجم التأثير</label>
<input id="nntEffect" placeholder="e.g., 0.75" step="0.01" type="number"/>
</div>
<div class="form-group">
<label>95% CI أقل</label>
<input id="nntCILo" placeholder="e.g., 0.60" step="0.01" type="number"/>
</div>
<div class="form-group">
<label>95% CI العلوي</label>
<input id="nntCIHi" placeholder="e.g., 0.95" step="0.01" type="number"/>
</div>
<button class="btn-small primary" onclick="calculateNNT()">احسب NNT/NNH</button>
<div class="results-display" id="nntResults" style="display: none;"></div>
</div>
</div>
 حساسية الإجازة لمرة واحدة 
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                تحليل الإجازة لمرة واحدة <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  اختبار تأثير كل دراسة على النتيجة المجمعة. يستخدم البيانات من حاسبة التحليل التلوي.
                </p>
<button class="btn-small primary" onclick="runLeaveOneOut()">تشغيل تحليل الحساسية</button>
<div id="looResults" style="display: none; margin-top: 1rem;">
<div class="results-display" id="looSummary"></div>
<div class="forest-plot-container" id="looPlotContainer" style="margin-top: 0.5rem;"></div>
</div>
</div>
</div>
 تقليم وملء 
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                تقليم وملء <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  يحسب الدراسات المفقودة لتصحيح عدم تناسق المخطط القمعي. يستخدم البيانات من حاسبة التحليل التلوي.
                </p>
<div class="form-group">
<label>المقدر</label>
<select id="trimFillEstimator">
<option value="L0">L0 (خطي)</option>
<option selected="" value="R0">R0 (على أساس الرتبة)</option>
</select>
</div>
<div class="form-group">
<label>Side</label>
<select id="trimFillSide">
<option value="right">اليمين (قمع إيجابي)</option>
<option selected="" value="left">اليسار (منع السلبية)</option>
</select>
</div>
<button class="btn-small primary" onclick="runTrimAndFill()">تشغيل القطع والتعبئة</button>
<div id="trimFillResults" style="display: none; margin-top: 1rem;">
<div class="results-display" id="trimFillSummary"></div>
<div class="forest-plot-container" id="trimFillPlotContainer" style="margin-top: 0.5rem;"></div>
</div>
</div>
</div>
 المراجع الرئيسية 
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                المراجع الرئيسية <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.7rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--navy);">حالات عكس الأدلة:</p>
<ul style="font-size: 0.7rem; color: var(--light-text); margin-right: 1rem; line-height: 1.6;">
<li><strong>CAST:</strong> إخت DS وآخرون. NEJM 1991;324:781-788</li>
<li><strong>HRT/WHI:</strong> روسو جي وآخرون. JAMA 2002;288:321-333</li>
<li><strong>روزيجليتازون:</strong> Nissen SE, Wolski K. NEJM 200;356:2457-2471</li>
<li><strong>فيوكس:</strong> Bombardier C et al. NEJM 2000;343:1520-1528</li>
<li><strong>تقليل الاحتيال:</strong> تحقيقات Erasmus MC 2012</li>
<li><strong>بارت:</strong> فيرغسون DA وآخرون. NEJM 2008;358:2319-2331</li>
<li><strong>إيزيس-4:</strong> المجموعة التعاونية لـداعش-4. لانسيت 1995;345:669-685</li>
<li><strong>ACCORD:</strong> مجموعة دراسة ACCORD. نيم 200؛358:2545-2559</li>
<li><strong>Reboxetine:</strong> إيدنج د وآخرون. BMJ 2010;341:c4737</li>
</ul>
<p style="font-size: 0.7rem; font-weight: 600; margin: 0.75rem 0 0.5rem; color: var(--navy);">مراجع الأساليب:</p>
<ul style="font-size: 0.7rem; color: var(--light-text); margin-right: 1rem; line-height: 1.6;">
<li><strong>الصف:</strong> Guyatt GH et al. بمج 2008;336:924-926</li>
<li><strong>RoB 2.0:</strong> ستيرن جاك وآخرون. بمج 2019;366:l4898</li>
<li><strong>ROBINS-I:</strong> ستيرن جا وآخرون. بمج 2016;355:i4919</li>
<li><strong>ICEMAN:</strong> شاندلماير إس وآخرون. CMAJ 2020;192:E901-E906</li>
<li><strong>HKSJ:</strong> Hartung J, Knapp G. Stat Med 2001;20:3875-3889</li>
<li><strong>بريسما:</strong> صفحة MJ et al. BMJ 2021;372:n71</li>
<li><strong>TSA:</strong> Wetterslev J et al. بي إم سي ميد ريس ميثودول 200؛8:39</li>
</ul>
</div>
</div>
</div>
</aside>
</div>
</main>
</div>
<script>
    // ============================================================
    // CONSTANTS
    // ============================================================
    const Z_95 = 1.96;
    const Z_95_CI_DIVISOR = 2 * Z_95;

    // ============================================================
    // LIVE STORY DATA SYSTEM
    // ============================================================

    const storyData = {
      1: { // CAST
        title: 'تجربة CAST: مضادات اضطراب النظم',
        subtitle: 'هل الأدوية التي تثبط PVCs تنقذ الأرواح؟',
        before: {
          label: 'قبل CAST (1989)',
          studies: [
            { name: 'Obs Study 1', effect: 0.45, lo: 0.28, hi: 0.72, n: 450 },
            { name: 'Obs Study 2', effect: 0.52, lo: 0.35, hi: 0.77, n: 380 },
            { name: 'Obs Study 3', effect: 0.38, lo: 0.22, hi: 0.65, n: 290 },
            { name: 'Surrogate', effect: 0.42, lo: 0.31, hi: 0.57, n: 1200 },
          ],
          pooled: { effect: 0.44, lo: 0.35, hi: 0.55 },
          metrics: { or: '0.44', nnt: '12', conclusion: 'Benefit' },
          insight: 'تشير بيانات المراقبة + المعقولية البيولوجية إلى أن مضادات اضطراب النظم تنقذ الأرواح عن طريق قمع PVCs.'
        },
        after: {
          label: 'بعد CAST (1991)',
          studies: [
            { name: 'CAST-Encainide', effect: 2.38, lo: 1.59, hi: 3.57, n: 730 },
            { name: 'CAST-Flecainide', effect: 2.64, lo: 1.60, hi: 4.36, n: 641 },
          ],
          pooled: { effect: 2.50, lo: 1.80, hi: 3.47 },
          metrics: { or: '2.50', nnh: '17', conclusion: 'Harm' },
          insight: '<strong>عكس الأدلة:</strong> أدت مضادات اضطراب النظم إلى زيادة معدل الوفيات بنسبة 150%. ما يقدر بنحو 50000+ حالة وفاة سنويا سببتها هذه الأدوية.'
        }
      },
      2: { // HRT
        title: 'العلاج التعويضي بالهرمونات وأمراض القلب',
        subtitle: 'هل استبدال الهرمونات يحمي القلب؟',
        before: {
          label: 'قبل WHI (2002)',
          studies: [
            { name: "Nurses' Health", effect: 0.50, lo: 0.40, hi: 0.63, n: 48470 },
            { name: 'Framingham', effect: 0.55, lo: 0.35, hi: 0.86, n: 1234 },
            { name: 'Meta 1998', effect: 0.65, lo: 0.52, hi: 0.81, n: 22000 },
          ],
          pooled: { effect: 0.56, lo: 0.47, hi: 0.67 },
          metrics: { rr: '0.56', nnt: '32', conclusion: 'Benefit' },
          insight: 'أظهرت أكثر من 30 دراسة رصدية انخفاضًا بنسبة 44% تقريبًا في أمراض القلب التاجية. تمت التوصية باستخدام العلاج التعويضي بالهرمونات للوقاية من أمراض القلب.'
        },
        after: {
          label: 'بعد WHI (2002)',
          studies: [
            { name: 'WHI E+P', effect: 1.29, lo: 1.02, hi: 1.63, n: 16608 },
            { name: 'WHI E-only', effect: 0.91, lo: 0.75, hi: 1.12, n: 10739 },
          ],
          pooled: { effect: 1.13, lo: 0.95, hi: 1.34 },
          metrics: { rr: '1.13', nnh: '∞', conclusion: 'لا فائدة / ضرر' },
          insight: '<strong>عكس الأدلة:</strong> أوضح تحيز المستخدم السليم نتائج المراقبة. كانت النساء اللاتي تناولن العلاج التعويضي بالهرمونات أكثر صحة في الأساس.'
        }
      },
      3: { // Rosiglitazone
        title: 'Rosiglitazone (Avandia)',
        subtitle: 'ما الذي تم إخفاؤه في التجارب غير المنشورة؟',
        before: {
          label: 'منشورة فقط',
          studies: [
            { name: 'ADOPT', effect: 1.08, lo: 0.75, hi: 1.56, n: 4360 },
            { name: 'DREAM', effect: 1.20, lo: 0.83, hi: 1.74, n: 5269 },
            { name: 'Published pool', effect: 1.14, lo: 0.90, hi: 1.45, n: 15000 },
          ],
          pooled: { effect: 1.14, lo: 0.92, hi: 1.41 },
          metrics: { or: '1.14', pvalue: '0.23', conclusion: 'NS' },
          insight: 'أظهرت التجارب المنشورة اتجاهًا غير مهم. تم طمأنة إدارة الغذاء والدواء والأطباء.'
        },
        after: {
          label: 'جميع البيانات (Nissen 2007)',
          studies: [
            { name: 'ADOPT', effect: 1.25, lo: 0.78, hi: 2.01, n: 4360 },
            { name: 'DREAM', effect: 1.36, lo: 0.68, hi: 2.71, n: 5269 },
            { name: '42 unpublished', effect: 1.45, lo: 1.10, hi: 1.91, n: 22000 },
          ],
          pooled: { effect: 1.43, lo: 1.03, hi: 1.98 },
          metrics: { or: '1.43', pvalue: '0.03', conclusion: 'HARM' },
          insight: '<strong>عكس الأدلة:</strong> كشفت التجارب غير المنشورة عن زيادة خطر الإصابة بالاحتشاء الدماغي بنسبة 43%. ~ 83000 نوبة قلبية زائدة تقدر.'
        }
      },
      6: { // Aprotinin
        title: 'Aprotinin (Trasylol)',
        subtitle: 'هل أخطأت الدراسات الرصدية الضرر؟',
        before: {
          label: 'Observational Studies',
          studies: [
            { name: 'Mangano 2006', effect: 0.80, lo: 0.64, hi: 1.00, n: 4374 },
            { name: 'Karkouti 2006', effect: 0.85, lo: 0.68, hi: 1.06, n: 10870 },
            { name: 'Obs Meta', effect: 0.82, lo: 0.70, hi: 0.96, n: 30000 },
          ],
          pooled: { effect: 0.82, lo: 0.71, hi: 0.95 },
          metrics: { rr: '0.82', nnt: '50', conclusion: 'Benefit' },
          insight: 'اقترحت الدراسات الرصدية انخفاض معدل الوفيات بنسبة 18%. تم استخدام الأبروتينين على نطاق واسع في جراحة القلب.'
        },
        after: {
          label: 'تجربة بارت (RCT)',
          studies: [
            { name: 'BART', effect: 1.53, lo: 1.10, hi: 2.15, n: 2331 },
          ],
          pooled: { effect: 1.53, lo: 1.10, hi: 2.15 },
          metrics: { rr: '1.53', nnh: '53', conclusion: 'HARM' },
          insight: '<strong>عكس الأدلة:</strong> أظهرت التجارب المعشاة ذات الشواهد زيادة في معدل الوفيات بنسبة 53%. الخلط من حيث الإشارة: المرضى الأكثر مرضًا حصلوا على الدواء.'
        }
      },
      7: { // Magnesium
        title: 'IV المغنيسيوم في MI',
        subtitle: 'المحاكمات الصغيرة مقابل المحاكمات الكبرى',
        before: {
          label: 'التجارب الصغيرة ميتا (1991)',
          studies: [
            { name: 'Morton 1984', effect: 0.10, lo: 0.01, hi: 0.87, n: 40 },
            { name: 'Rasmussen 1986', effect: 0.35, lo: 0.13, hi: 0.94, n: 273 },
            { name: 'Shechter 1990', effect: 0.27, lo: 0.08, hi: 0.95, n: 103 },
            { name: 'LIMIT-2', effect: 0.74, lo: 0.57, hi: 0.97, n: 2316 },
          ],
          pooled: { effect: 0.44, lo: 0.27, hi: 0.71 },
          metrics: { or: '0.44', nnt: '25', conclusion: 'Benefit' },
          insight: 'أظهر التحليل التلوي لـ 7 تجارب صغيرة انخفاض معدل الوفيات بنسبة 56%. بدا المغنيسيوم وكأنه معجزة.'
        },
        after: {
          label: 'مع داعش-4 (1995)',
          studies: [
            { name: 'Small trials', effect: 0.44, lo: 0.27, hi: 0.71, n: 2774 },
            { name: 'ISIS-4', effect: 1.06, lo: 0.99, hi: 1.13, n: 58050 },
          ],
          pooled: { effect: 1.02, lo: 0.95, hi: 1.09 },
          metrics: { or: '1.02', nnt: '∞', conclusion: 'لا يوجد تأثير' },
          insight: '<strong>عكس الأدلة:</strong> لم يجد إيزيس-4 (58,050 مريضًا) أي فائدة. من المحتمل أن تكون تأثيرات الدراسات الصغيرة وتحيز النشر قد ساهمت في التحليل التلوي الإيجابي السابق.'
        }
      },
      9: { // Reboxetine
        title: 'Reboxetine',
        subtitle: 'ما مقدار البيانات التي تم إخفاؤها؟',
        before: {
          label: 'منشورة فقط',
          studies: [
            { name: 'Pub Trial 1', effect: 0.62, lo: 0.35, hi: 1.10, n: 254 },
            { name: 'Pub Trial 2', effect: 0.48, lo: 0.22, hi: 1.05, n: 187 },
            { name: 'Pub Trial 3', effect: 0.55, lo: 0.28, hi: 1.08, n: 203 },
          ],
          pooled: { effect: 0.56, lo: 0.39, hi: 0.80 },
          metrics: { smd: '0.56', pvalue: '<0.001', conclusion: 'Benefit' },
          insight: 'أظهرت التجارب المنشورة فائدة كبيرة مقارنة بالعلاج الوهمي. تمت الموافقة على الريبوكسيتين وتسويقه.'
        },
        after: {
          label: 'جميع البيانات (EMA 2010)',
          studies: [
            { name: 'Published (26%)', effect: 0.56, lo: 0.39, hi: 0.80, n: 644 },
            { name: 'Unpublished (74%)', effect: 0.98, lo: 0.81, hi: 1.19, n: 1802 },
          ],
          pooled: { effect: 0.85, lo: 0.72, hi: 1.00 },
          metrics: { smd: '0.10', pvalue: '0.43', conclusion: 'لا يوجد تأثير' },
          insight: '<strong>نقض الأدلة:</strong> لم يتم نشر 74% من بيانات المرضى! كان التأثير الحقيقي فارغًا في الأساس. ولم يكن الدواء أفضل من العلاج الوهمي.'
        }
      },
      4: { // Vioxx
        title: 'Vioxx (Rofecoxib)',
        subtitle: 'ما الذي تم الإبلاغ عنه بشكل انتقائي؟',
        before: {
          label: 'VIGOR Published (2000)',
          studies: [
            { name: 'VIGOR (GI)', effect: 0.46, lo: 0.33, hi: 0.64, n: 8076 },
          ],
          pooled: { effect: 0.46, lo: 0.33, hi: 0.64 },
          metrics: { rr: '0.46', nnt: '41', conclusion: 'فائدة جي آي' },
          insight: 'تم نشر VIGOR مع التركيز على تقليل مضاعفات الجهاز الهضمي بنسبة 54%. تم التقليل من أهمية أحداث القلب والأوعية الدموية.'
        },
        after: {
          label: 'كشف بيانات السيرة الذاتية الكاملة',
          studies: [
            { name: 'VIGOR (CV)', effect: 4.25, lo: 1.39, hi: 17.37, n: 8076 },
            { name: 'APPROVe', effect: 1.92, lo: 1.19, hi: 3.11, n: 2586 },
          ],
          pooled: { effect: 2.24, lo: 1.24, hi: 4.02 },
          metrics: { rr: '2.24', nnh: '73', conclusion: 'ضرر السيرة الذاتية' },
          insight: '<strong>عكس الدليل:</strong> أظهرت البيانات الكاملة زيادة في خطر الإصابة باحتشاء عضلة القلب بمقدار 4 أضعاف. ~ 88.000 نوبة قلبية زائدة. تم سحبه عام 2004.'
        }
      },
      5: { // DECREASE
        title: 'تقليل المحاكمات (الاحتيال)',
        subtitle: 'ماذا يحدث عندما يتم تلفيق البيانات؟',
        before: {
          label: 'قبل أن ينكشف الاحتيال',
          studies: [
            { name: 'DECREASE-I', effect: 0.09, lo: 0.02, hi: 0.37, n: 112 },
            { name: 'DECREASE-IV', effect: 0.65, lo: 0.24, hi: 1.74, n: 1066 },
            { name: 'محاكمات أخرى', effect: 0.78, lo: 0.58, hi: 1.05, n: 3500 },
          ],
          pooled: { effect: 0.56, lo: 0.35, hi: 0.89 },
          metrics: { or: '0.56', nnt: '15', conclusion: 'Benefit' },
          insight: 'وأظهر التحليل التلوي بما في ذلك انخفاض معدل الوفيات بنسبة 44٪. تم تكليف حاصرات بيتا في المبادئ التوجيهية.'
        },
        after: {
          label: 'باستثناء البيانات الاحتيالية',
          studies: [
            { name: 'POISE', effect: 1.33, lo: 1.03, hi: 1.74, n: 8351 },
            { name: 'DIPOM', effect: 1.11, lo: 0.66, hi: 1.87, n: 921 },
            { name: 'MaVS', effect: 0.92, lo: 0.46, hi: 1.84, n: 496 },
          ],
          pooled: { effect: 1.27, lo: 1.01, hi: 1.60 },
          metrics: { or: '1.27', nnh: '67', conclusion: 'HARM' },
          insight: '<strong>عكس الأدلة:</strong> بدون بيانات الانخفاض الملفقة، أدت حاصرات بيتا إلى زيادة معدل الوفيات بنسبة 27%. ~ 10.000 حالة وفاة زائدة في أوروبا بسبب المبادئ التوجيهية المعيبة.'
        }
      },
      8: { // ACCORD
        title: 'ACCORD Trial',
        subtitle: 'عندما يخفي المتوسط الحقيقة',
        before: {
          label: 'قبل أكورد (2008)',
          studies: [
            { name: 'DCCT (Type 1)', effect: 0.42, lo: 0.23, hi: 0.75, n: 1441 },
            { name: 'UKPDS', effect: 0.84, lo: 0.71, hi: 0.99, n: 3867 },
            { name: 'Obs studies', effect: 0.70, lo: 0.60, hi: 0.82, n: 50000 },
          ],
          pooled: { effect: 0.72, lo: 0.62, hi: 0.84 },
          metrics: { hr: '0.72', nnt: '20', conclusion: 'Benefit' },
          insight: 'أظهرت التجارب السابقة أن التحكم المكثف في الجلوكوز يقلل من مضاعفات الأوعية الدموية الدقيقة. فائدة مفترضة للأوعية الدموية الكبيرة أيضًا.'
        },
        after: {
          label: 'ACCORD Results',
          studies: [
            { name: 'ACCORD', effect: 1.22, lo: 1.01, hi: 1.46, n: 10251 },
            { name: 'ADVANCE', effect: 0.93, lo: 0.83, hi: 1.06, n: 11140 },
            { name: 'VADT', effect: 1.07, lo: 0.81, hi: 1.42, n: 1791 },
          ],
          pooled: { effect: 1.04, lo: 0.91, hi: 1.19 },
          metrics: { hr: '1.22*', nnh: '95', conclusion: 'ضرر في اتفاق' },
          insight: '<strong>عكس الأدلة:</strong> توقف عقار أكورد مبكرًا - أدت المراقبة المكثفة إلى زيادة معدل الوفيات بنسبة 22%. كان عدم التجانس مهمًا: فالضرر يتركز في المرضى الأكبر سناً المصابين بأمراض القلب والأوعية الدموية.'
        }
      },
      10: { // Surfactant
        title: 'الفاعل بالسطح المبكر في الخدج',
        subtitle: 'عندما يتغير سياق الممارسة',
        before: {
          label: 'Early Trials (1990s)',
          studies: [
            { name: 'Kendig 1991', effect: 0.55, lo: 0.35, hi: 0.86, n: 479 },
            { name: 'OSECT 1992', effect: 0.61, lo: 0.41, hi: 0.91, n: 338 },
            { name: 'Egberts 1993', effect: 0.58, lo: 0.37, hi: 0.91, n: 324 },
          ],
          pooled: { effect: 0.58, lo: 0.45, hi: 0.75 },
          metrics: { rr: '0.58', nnt: '9', conclusion: 'Benefit' },
          insight: 'أظهر الفاعل بالسطح المبكر (الوقائي) انخفاض معدل الوفيات/اضطراب الشخصية الحدية بنسبة 42% مقارنةً بالفاعل بالسطح الإنقاذي. أصبح المعيار.'
        },
        after: {
          label: 'التجارب الحديثة مع CPAP',
          studies: [
            { name: 'COIN 2008', effect: 1.05, lo: 0.78, hi: 1.41, n: 610 },
            { name: 'SUPPORT 2010', effect: 0.91, lo: 0.68, hi: 1.21, n: 1316 },
            { name: 'VON 2011', effect: 0.94, lo: 0.71, hi: 1.25, n: 648 },
          ],
          pooled: { effect: 0.96, lo: 0.82, hi: 1.13 },
          metrics: { rr: '0.96', nnt: '∞', conclusion: 'لا فائدة' },
          insight: '<strong>تطور الأدلة:</strong> غيرت أجهزة CPAP الحديثة السياق. لم يعد الفاعل بالسطح المبكر متفوقًا على CPAP + الفاعل بالسطح الانتقائي. ويجب أن تتطور الممارسات بالأدلة.'
        }
      },
      11: { // HCQ COVID
        title: 'COVID-19 Hydroxychloroquine',
        subtitle: 'الوعد المبكر مقابل الأدلة الصارمة',
        before: {
          label: 'الدراسات المبكرة (مارس-مايو 2020)',
          studies: [
            { name: 'Gautret', effect: 0.15, lo: 0.03, hi: 0.75, n: 36 },
            { name: 'Chen J', effect: 0.65, lo: 0.25, hi: 1.69, n: 62 },
            { name: 'Million', effect: 0.22, lo: 0.11, hi: 0.44, n: 1061 },
          ],
          pooled: { effect: 0.28, lo: 0.15, hi: 0.52 },
          metrics: { or: '0.28', pvalue: '<0.001', conclusion: 'Benefit' },
          insight: 'اقترحت الدراسات الصغيرة/الرصدية المبكرة فائدة هائلة. تبع ذلك تفويضات الطوارئ.'
        },
        after: {
          label: 'التجارب المعشاة ذات الشواهد (التعافي، منظمة الصحة العالمية)',
          studies: [
            { name: 'RECOVERY', effect: 1.09, lo: 0.97, hi: 1.23, n: 4716 },
            { name: 'تضامن منظمة الصحة العالمية', effect: 1.19, lo: 0.89, hi: 1.59, n: 954 },
            { name: 'RCT Meta', effect: 1.11, lo: 1.00, hi: 1.22, n: 8000 },
          ],
          pooled: { effect: 1.11, lo: 1.00, hi: 1.22 },
          metrics: { or: '1.11', pvalue: '0.05', conclusion: 'لا فائدة / ضرر' },
          insight: '<strong>عكس الأدلة:</strong> لم تظهر التجارب المعشاة ذات الشواهد الكبيرة أي فائدة أو ضرر محتمل. تم إلغاء التفويضات. المحاكمات الصارمة تستغرق وقتا ولكنها تعطي الحقيقة.'
        }
      }
    };

    let currentStoryView = 'before';
    let storyPlotType = 'forest';
    let storyPredictions = {}; // Track predictions per module
    let showingPrediction = false;

    function setStoryPlotType(type) {
      storyPlotType = type;
      const story = storyData[currentModule];
      if (story) renderStoryContent(story);
    }

    function hasPredicted(moduleId) {
      return storyPredictions[moduleId] !== undefined;
    }

    function makePrediction(moduleId, prediction) {
      const story = storyData[moduleId];
      if (!story) return;

      // Determine the actual answer
      const afterEffect = story.after.pooled.effect;
      let actual;
      if (afterEffect < 0.9) actual = 'benefit';
      else if (afterEffect > 1.1) actual = 'harm';
      else actual = 'neutral';

      // Store prediction and result
      storyPredictions[moduleId] = {
        prediction: prediction,
        actual: actual,
        correct: prediction === actual
      };

      // Update progress
      saveProgress();

      // Now show the actual results
      showingPrediction = false;
      renderStoryContent(story);
    }

    function updateStoryPanel(moduleId) {
      const panel = document.getElementById('storyDataPanel');
      const content = document.getElementById('storyDataContent');
      const story = storyData[moduleId];

      panel.classList.add('updating');
      setTimeout(() => panel.classList.remove('updating'), 500);

      if (!story) {
        content.innerHTML = `
          <div class="no-story-data">
            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">📚</p>
            <p>Module ${moduleId}: ${modules[moduleId]?.title || 'Unknown'}</p>
            <p style="margin-top: 0.5rem; opacity: 0.7;">This module focuses on methods rather than a specific evidence reversal story.</p>
          </div>
        `;
        return;
      }

      currentStoryView = 'before';
      renderStoryContent(story);
    }

    function renderStoryContent(story) {
      const content = document.getElementById('storyDataContent');
      const moduleId = currentModule;
      const data = currentStoryView === 'before' ? story.before : story.after;
      const predicted = hasPredicted(moduleId);
      const predictionResult = storyPredictions[moduleId];

      // If viewing "After" and haven'لم يتم توقعه بعد، قم بإظهار واجهة التنبؤ إذا كان (currentStoryView ==='after' && !predicted && showingPrediction) {
        content.innerHTML = `
          <div style="margin-bottom: 0.75rem;">
            <div style="font-size: 1rem; font-weight: 600; color: white;">${story.title}</div>
            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">${story.subtitle}</div>
          </div>

          <div class="story-toggle">
            <button class="" onclick="toggleStoryView('before')">
              ${story.before.label}
            </button>
            <button class="active" onclick="toggleStoryView('after')">
              ${story.after.label}
            </button>
          </div>

          <div class="predict-first-panel">
            <div class="predict-icon">🤔</div>
            <h4>Predict First!</h4>
            <p>Based on ${story.before.label}, the evidence suggested <strong>${story.before.metrics.conclusion.toLowerCase()}</strong>.</p>
            <p style="margin-top: 0.5rem;">What do you think the rigorous evidence showed?</p>

            <div class="predict-buttons">
              <button class="predict-btn benefit" onclick="makePrediction(${moduleId}, 'benefit')"> <span class="predict-icon-small">✓</span> يساعد العلاج </button> <button class="predict-btn Neutral" onclick="makePrediction(${moduleId},'neutral')"> <span class="predict-icon-small">—</span> لا يوجد تأثير </button> <button class="predict-btn ضرر" onclick="makePrediction(${moduleId},'harm')">
                <span class="predict-icon-small">✗</span>
                Treatment Harms
              </button>
            </div>

            <p style="font-size: 0.7rem; opacity: 0.6; margin-top: 0.75rem;">Making a prediction improves learning retention by 40%</p>
          </div>
        `;
        return;
      }

      // Prediction feedback (shown after predicting)
      let predictionFeedback = ''; إذا (currentStoryView ==='after' && predicted) {
        const wasCorrect = predictionResult.correct;
        predictionFeedback = `
          <div class="prediction-feedback ${wasCorrect ? 'correct' : 'incorrect'}">
            <span class="feedback-icon">${wasCorrect ? '✓' : '✗'}</span>
            <span>${wasCorrect ? 'Correct! You predicted this evidence reversal.' : 'Not quite - this is why we need rigorous evidence!'}</span>
          </div>
        `;
      }

      content.innerHTML = `
        <div style="margin-bottom: 0.75rem;">
          <div style="font-size: 1rem; font-weight: 600; color: white;">${story.title}</div>
          <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">${story.subtitle}</div>
        </div>

        <div class="story-toggle">
          <button class="${currentStoryView === 'before' ? 'active' : ''}" onclick="toggleStoryView('before')">
            ${story.before.label}
          </button>
          <button class="${currentStoryView === 'after' ? 'active' : ''}" onclick="toggleStoryView('after')">
            ${story.after.label}
          </button>
        </div>

        ${predictionFeedback}

        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
          <button class="btn-small ${storyPlotType === 'forest' ? 'primary' : ''}" onclick="setStoryPlotType('forest')" style="flex:1; font-size: 0.7rem;">Forest Plot</button>
          <button class="btn-small ${storyPlotType === 'funnel' ? 'primary' : ''}" onclick="setStoryPlotType('funnel')" style="flex:1; font-size: 0.7rem;">Funnel Plot</button>
        </div>

        <div class="story-viz" id="storyForestPlot"></div>

        <div class="story-metrics">
          <div class="story-metric ${getMetricHighlight(data.metrics.conclusion)}">
            <div class="value">${Object.values(data.metrics)[0]}</div>
            <div class="label">${Object.keys(data.metrics)[0].toUpperCase()}</div>
          </div>
          <div class="story-metric ${getMetricHighlight(data.metrics.conclusion)}">
            <div class="value">${data.metrics.conclusion}</div>
            <div class="label">Conclusion</div>
          </div>
        </div>

        <div class="story-insight">${data.insight}</div>

        <button class="btn-small primary" style="width: 100%; margin-top: 0.75rem;" onclick="loadStoryIntoCalculator()">
          Load Data into Calculator →
        </button>
      `;

      // Draw the appropriate plot
      if (storyPlotType === 'funnel') { drawStoryFunnelPlot(data.studies, data.pooled,currentStoryView ==='after'); } else { drawStoryForestPlot(data.studies, data.pooled,currentStoryView ==='after'); } } الدالة getMetricHighlight(conclusion) { if (conclusion.includes('Harm') || conclusion === 'HARM') return 'highlight-bad'; إذا (الاستنتاج. يشمل ('Benefit')) return 'highlight-good';
      return '';
    }

    function toggleStoryView(view) {
      const moduleId = currentModule;
      const story = storyData[moduleId];
      if (!story) return;

      currentStoryView = view;

      // If switching to "after" and haven't predicted yet, show prediction interface
      if (view === 'after' && !hasPredicted(moduleId)) {
        showingPrediction = true;
      } else {
        showingPrediction = false;
      }

      renderStoryContent(story);
    }

    function drawStoryForestPlot(studies, pooled, isAfter) {
      const container = document.getElementById('storyForestPlot');
      if (!container) return;

      const width = 320;
      const height = studies.length * 32 + 60;
      const margin = { left: 100, right: 30, top: 15, bottom: 30 };
      const plotWidth = width - margin.left - margin.right;

      // Find data range
      const allEffects = [...studies.map(s => [s.lo, s.hi]).flat(), pooled.lo, pooled.hi];
      let minE = Math.min(...allEffects, 0.1);
      let maxE = Math.max(...allEffects, 3);

      // Log scale
      const logMin = Math.log(Math.max(0.05, minE * 0.8));
      const logMax = Math.log(maxE * 1.2);
      const xScale = (v) => margin.left + ((Math.log(v) - logMin) / (logMax - logMin)) * plotWidth;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="العرض: 100%؛ الارتفاع: تلقائي؛ عائلة الخط: بلا الرقيق؛" role="img" aria-label="قطعة أرض توضح أحجام التأثير لدراسات ${studies.length}.">`;

      // Add pattern definitions for color-blind accessibility
      svg += `<defs>
        <pattern id="harmPattern" patternUnits="userSpaceOnUse" width="4" height="4">
          <path d="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2" stroke="#ef4444" stroke-width="1"/>
        </pattern>
        <pattern id="benefitPattern" patternUnits="userSpaceOnUse" width="4" height="4">
          <circle cx="2" cy="2" r="1" fill="#22c55e"/>
        </pattern>
      </defs>`;

      // Grid lines
      [0.1, 0.25, 0.5, 1, 2, 4].forEach(tick => {
        if (tick >= minE * 0.8 && tick <= maxE * 1.2) {
          const x = xScale(tick);
          svg += `<line x1="${x}" y1="${margin.top}" x2="${x}" y2="${الارتفاع - هامش.أسفل}" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>`;
          svg += `<text x="${x}" y="${الارتفاع - هامش.أسفل + 12}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.5)">${tick}</text>`;
        }
      });

      // Null line at 1
      const nullX = xScale(1);
      svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${الارتفاع - هامش.أسفل}" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>`;

      // Studies - COLOR-BLIND SAFE: use different shapes + colors
      studies.forEach((study, i) => {
        const y = margin.top + 15 + i * 32;
        const x = xScale(Math.max(0.05, Math.min(10, study.effect)));
        const xLo = xScale(Math.max(0.05, study.lo));
        const xHi = xScale(Math.min(10, study.hi));

        // Color-blind safe: green (#22c55e) for benefit, red (#ef4444) for harm, gray for neutral
        const isBenefit = study.effect < 1;
        const isHarm = study.effect > 1.1;
        const color = isBenefit ? '#22c55e' : (isHarm ? '#ef4444' : '#94a3b8');

        // Study name
        svg += `<text x="${margin.left - 5}" y="${y + 4}" text-anchor="end" font-size="9" fill="white">${study.name}</text>`;

        // CI line - use dashed for harm, solid for benefit (color-blind safe)
        const dashArray = isHarm ? 'stroke-dasharray="3,2"' : '';
        svg += `<line x1="${xLo}" y1="${y}" x2="${xHi}" y2="${y}" stroke="${color}" stroke-width="2" ${dashArray}/>`;

        // Effect marker - SHAPES differ: square for benefit, circle for harm, diamond for neutral
        const size = Math.min(10, Math.max(5, study.n ? Math.sqrt(study.n) / 10 : 6));
        if (isBenefit) {
          // Square with fill for benefit
          svg += `<rect x="${x - size/2}" y="${y - size/2}" width="${size}" height="${size}" fill="${color}" rx="1"/>`;
        } else if (isHarm) {
          // Circle for harm
          svg += `<circle cx="${x}" cy="${y}" r="${size/2}" fill="${color}"/>`;
        } else {
          // Diamond for neutral
          svg += `<polygon points="${x},${y-size/2} ${x+size/2},${y} ${x},${y+size/2} ${x-size/2},${y}" fill="${color}"/>`;
        }
      });

      // Pooled diamond
      const poolY = height - margin.bottom - 10;
      const poolX = xScale(Math.max(0.05, Math.min(10, pooled.effect)));
      const poolXLo = xScale(Math.max(0.05, pooled.lo));
      const poolXHi = xScale(Math.min(10, pooled.hi));
      const isPooledHarm = pooled.effect > 1;
      const diamondColor = isAfter ? (isPooledHarm ? '#ef4444' : '#22c55e') : '#D4AF37';

      svg += `<polygon points="${poolXLo},${poolY} ${poolX},${poolY - 6} ${poolXHi},${poolY} ${poolX},${poolY + 6}" fill="${diamondColor}" stroke="white" stroke-width="1"/>`;
      svg += `<text x="${margin.left - 5}" y="${poolY + 3}" text-anchor="end" font-size="9" font-weight="bold" fill="${diamondColor}">Pooled</text>`;

      // Labels with symbols for color-blind users
      svg += `<text x="${xScale(0.3)}" y="${height - 3}" text-anchor="middle" font-size="7" fill="rgba(255,255,255,0.6)">■ Favors Treatment</text>`;
      svg += `<text x="${xScale(2.5)}" y="${height - 3}" text-anchor="middle" font-size="7" fill="rgba(255,255,255,0.6)">● Favors Control</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    function drawStoryFunnelPlot(studies, pooled, isAfter) {
      const container = document.getElementById('storyForestPlot');
      if (!container) return;

      const width = 320;
      const height = 200;
      const margin = { left: 40, right: 20, top: 20, bottom: 35 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Calculate SE from CI
      const studiesWithSE = studies.map(s => ({
        ...s,
        se: (Math.log(s.hi) - Math.log(s.lo)) / 3.92
      }));

      const maxSE = Math.max(...studiesWithSE.map(s => s.se)) * 1.2;
      const logPooled = Math.log(pooled.effect);

      // Scale functions
      const logEffects = studiesWithSE.map(s => Math.log(s.effect));
      const minLog = Math.min(...logEffects, logPooled) - 0.5;
      const maxLog = Math.max(...logEffects, logPooled) + 0.5;

      const xScale = (logE) => margin.left + ((logE - minLog) / (maxLog - minLog)) * plotWidth;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="العرض: 100%؛ الارتفاع: تلقائي؛ عائلة الخط: بلا الرقيق؛">`;

      // Funnel shape
      const funnelLeft = xScale(logPooled - 1.96 * maxSE);
      const funnelRight = xScale(logPooled + 1.96 * maxSE);
      const funnelTop = xScale(logPooled);

      svg += `<polygon points="${funnelTop},${margin.top} ${funnelLeft},${margin.top +plotHeight} ${funnelRight},${margin.top +plotHeight}"
               fill="rgba(255,255,255,0.1)" stroke="rgba(255,255,255,0.3)" stroke-dasharray="3"/>`;

      // Vertical line at pooled effect
      svg += `<line x1="${xScale(logPooled)}" y1="${margin.top}" x2="${xScale(logPooled)}" y2="${margin.top +plotHeight}"
               stroke="${isAfter ? '#ef4444' : '#D4AF37'}" stroke-width="2"/>`;

      // Null line at log(1) = 0
      const nullX = xScale(0);
      if (nullX > margin.left && nullX < width - margin.right) {
        svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${margin.top +plotHeight}"
                 stroke="rgba(255,255,255,0.4)" stroke-width="1" stroke-dasharray="4"/>`;
      }

      // Study points
      studiesWithSE.forEach(study => {
        const x = xScale(Math.log(study.effect));
        const y = yScale(study.se);
        const color = study.effect < 1 ? '#22c55e' : '#ef4444';

        svg += `<circle cx="${x}" cy="${y}" r="6" fill="${color}" stroke="white" stroke-width="1"/>`;
      });

      // X-axis label
      svg += `<text x="${width/2}" y="${height - 5}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.6)">Effect Size (log scale)</text>`;

      // Y-axis label
      svg += `<text x="12" y="${height/2}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.6)" transform="rotate(-90, 12, ${height/2})">Standard Error</text>`;

      // Show asymmetry indicator if appropriate
      if (isAfter) {
        svg += `<text x="${width - 10}" y="${margin.top + 15}" text-anchor="end" font-size="8" fill="#ef4444">⚠ Asymmetry</text>`;
      }

      svg += '</svg>';
      container.innerHTML = svg;
    }

    function openToolsWithStory() {
      // Open tools panel
      const panel = document.getElementById('toolsPanel');
      panel.classList.add('open');

      // Scroll to story data section
      const storyPanel = document.getElementById('storyDataPanel');
      if (storyPanel) {
        storyPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        storyPanel.classList.add('updating');
        setTimeout(() => storyPanel.classList.remove('updating'), 500);
      }

      // Hide the indicator button since they found it
      document.getElementById('storyIndicatorBtn').classList.remove('pulse');
    }

    function loadStoryIntoCalculator() {
      const story = storyData[currentModule];
      if (!story) {
        alert('لا توجد بيانات قصة متاحة لهذه الوحدة.');
        return;
      }

      const data = currentStoryView === 'before' ? story.before : story.after;
      const tbody = document.getElementById('studyTableBody');

      // Clear existing rows
      tbody.innerHTML = '';

      // Add story studies
      data.studies.forEach(study => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input type="text" value="${study.name}"></td>
          <td><input type="number" step="0.01" value="${study.effect.toFixed(2)}"></td>
          <td><input type="number" step="0.01" value="${study.lo.toFixed(2)}"></td>
          <td><input type="number" step="0.01" value="${study.hi.toFixed(2)}"></td>
          <td><button class="btn-small" onclick="RemoveStudyRow(this)">×</button></td>
        `;
        tbody.appendChild(row);
      });

      // Auto-run the analysis
      runMetaAnalysis();

      // Show notification
      const panel = document.getElementById('storyDataPanel');
      panel.classList.add('updating');
      setTimeout(() => panel.classList.remove('updating'), 500);
    }

    // ============================================================
    // STATISTICAL FUNCTIONS
    // ============================================================

    function normalCDF(x) {
      const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741;
      const a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911;
      const sign = x < 0 ? -1 : 1;
      x = Math.abs(x) / Math.sqrt(2);
      const t = 1 / (1 + p * x);
      const y = 1 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
      return 0.5 * (1 + sign * y);
    }

    function tCDF(t, df) {
      if (df <= 0) return 0.5;
      const x = df / (df + t * t);
      return 1 - 0.5 * incompleteBeta(x, df / 2, 0.5);
    }

    function incompleteBeta(x, a, b) {
      if (x === 0) return 0;
      if (x === 1) return 1;
      const bt = Math.exp(
        logGamma(a + b) - logGamma(a) - logGamma(b) +
        a * Math.log(x) + b * Math.log(1 - x)
      );
      if (x < (a + 1) / (a + b + 2)) {
        return bt * betaCF(x, a, b) / a;
      }
      return 1 - bt * betaCF(1 - x, b, a) / b;
    }

    function betaCF(x, a, b) {
      const maxIter = 200, eps = 1e-10;
      const qab = a + b, qap = a + 1, qam = a - 1;
      let c = 1, d = 1 - qab * x / qap;
      if (Math.abs(d) < 1e-30) d = 1e-30;
      d = 1 / d;
      let h = d;
      for (let m = 1; m <= maxIter; m++) {
        const m2 = 2 * m;
        let aa = m * (b - m) * x / ((qam + m2) * (a + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < 1e-30) d = 1e-30;
        c = 1 + aa / c;
        if (Math.abs(c) < 1e-30) c = 1e-30;
        d = 1 / d;
        h *= d * c;
        aa = -(a + m) * (qab + m) * x / ((a + m2) * (qap + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < 1e-30) d = 1e-30;
        c = 1 + aa / c;
        if (Math.abs(c) < 1e-30) c = 1e-30;
        d = 1 / d;
        const del = d * c;
        h *= del;
        if (Math.abs(del - 1) < eps) break;
      }
      return h;
    }

    function logGamma(x) {
      const c = [76.18009172947146, -86.50532032941677, 24.01409824083091,
        -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5];
      let y = x, tmp = x + 5.5;
      tmp -= (x + 0.5) * Math.log(tmp);
      let ser = 1.000000000190015;
      for (let j = 0; j < 6; j++) ser += c[j] / ++y;
      return -tmp + Math.log(2.5066282746310005 * ser / x);
    }

    function tQuantile(p, df) {
      if (p <= 0) return -Infinity;
      if (p >= 1) return Infinity;
      if (df <= 0) return NaN;
      let lo = -10, hi = 10;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (tCDF(mid, df) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    function chiSquareCDF(x, df) {
      if (x <= 0) return 0;
      return regularizedGammaP(df / 2, x / 2);
    }

    function regularizedGammaP(a, x) {
      if (x < 0 || a <= 0) return NaN;
      if (x === 0) return 0;
      if (x < a + 1) {
        let sum = 1 / a, term = sum;
        for (let n = 1; n < 100; n++) {
          term *= x / (a + n);
          sum += term;
          if (Math.abs(term) < 1e-10) break;
        }
        return sum * Math.exp(-x + a * Math.log(x) - logGamma(a));
      } else {
        let b = x + 1 - a, c = 1 / 1e-30, d = 1 / b, h = d;
        for (let i = 1; i < 100; i++) {
          const an = -i * (i - a);
          b += 2;
          d = an * d + b;
          if (Math.abs(d) < 1e-30) d = 1e-30;
          c = b + an / c;
          if (Math.abs(c) < 1e-30) c = 1e-30;
          d = 1 / d;
          const del = d * c;
          h *= del;
          if (Math.abs(del - 1) < 1e-10) break;
        }
        return 1 - Math.exp(-x + a * Math.log(x) - logGamma(a)) * h;
      }
    }

    function chiSquareQuantile(p, df) {
      if (p <= 0) return 0;
      if (p >= 1) return Infinity;
      let lo = 0, hi = df * 5 + 50;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (chiSquareCDF(mid, df) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    // ============================================================
    // TAU² ESTIMATORS
    // ============================================================

    function calculateTau2DL(effects, ses) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      const weights = variances.map(v => 1 / v);
      const totalWeight = weights.reduce((a, b) => a + b, 0);
      const meanEffect = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / totalWeight;
      const q = effects.reduce((sum, e, i) => sum + weights[i] * (e - meanEffect) ** 2, 0);
      const c = totalWeight - weights.reduce((sum, w) => sum + w * w, 0) / totalWeight;
      return c > 0 ? Math.max(0, (q - (k - 1)) / c) : 0;
    }

    function calculateTau2REML(effects, ses, maxIter = 100, tol = 1e-6) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < maxIter; iter++) {
        const w = variances.map(v => 1 / (v + tau2));
        const sumW = w.reduce((a, b) => a + b, 0);
        const sumW2 = w.reduce((sum, wi) => sum + wi * wi, 0);
        const mu = effects.reduce((sum, e, i) => sum + e * w[i], 0) / sumW;
        const score = -0.5 * sumW2 / sumW + 0.5 * effects.reduce((sum, e, i) => sum + w[i] * w[i] * (e - mu) ** 2, 0);
        const info = 0.5 * (sumW2 - w.reduce((sum, wi) => sum + wi * wi * wi, 0) * 2 / sumW + sumW2 * sumW2 / (sumW * sumW));
        const delta = info > 0 ? score / info : 0;
        const newTau2 = Math.max(0, tau2 + delta);
        if (Math.abs(newTau2 - tau2) < tol) return newTau2;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2PM(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      let tau2 = 0.1;
      for (let iter = 0; iter < 100; iter++) {
        const weights = variances.map(v => 1 / (v + tau2));
        const sumW = weights.reduce((a, b) => a + b, 0);
        const meanEffect = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
        const Q = effects.reduce((sum, e, i) => sum + weights[i] * (e - meanEffect) ** 2, 0);
        if (Math.abs(Q - (n - 1)) < 0.0001) break;
        const dQ = -effects.reduce((sum, e, i) => sum + weights[i] * weights[i] * (e - meanEffect) ** 2, 0);
        tau2 = Math.max(0, tau2 - (Q - (n - 1)) / dQ);
      }
      return tau2;
    }

    function calculateTau2SJ(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / n;
      let tau2 = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / (n - 1);
      const weights = variances.map(v => 1 / (v + tau2));
      const sumW = weights.reduce((a, b) => a + b, 0);
      const pooled = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
      tau2 = effects.reduce((sum, e, i) => sum + (e - pooled) ** 2 / (variances[i] + tau2), 0) / (n - 1);
      return Math.max(0, tau2);
    }

    function calculateTau2HE(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / n;
      const S2 = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / (n - 1);
      const avgVar = variances.reduce((a, b) => a + b, 0) / n;
      return Math.max(0, S2 - avgVar);
    }

    function calculateTau2EB(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < 20; iter++) {
        const weights = variances.map(v => 1 / (v + tau2));
        const sumW = weights.reduce((a, b) => a + b, 0);
        const mean = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
        const Q = effects.reduce((sum, e, i) => sum + weights[i] * (e - mean) ** 2, 0);
        const C = sumW - weights.reduce((sum, w) => sum + w * w, 0) / sumW;
        const newTau2 = Math.max(0, (Q - (n - 1)) / C);
        if (Math.abs(newTau2 - tau2) < 1e-8) break;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2ML(effects, ses, maxIter = 100, tol = 1e-6) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < maxIter; iter++) {
        const w = variances.map(v => 1 / (v + tau2));
        const sumW = w.reduce((a, b) => a + b, 0);
        const mu = effects.reduce((sum, e, i) => sum + e * w[i], 0) / sumW;
        const score = 0.5 * effects.reduce((sum, e, i) => sum + w[i] * w[i] * (e - mu) ** 2, 0) -
                      0.5 * w.reduce((sum, wi) => sum + wi, 0) + 0.5 * k;
        const sumW2 = w.reduce((sum, wi) => sum + wi * wi, 0);
        const info = 0.5 * sumW2;
        const delta = info > 0 ? score / info : 0;
        const newTau2 = Math.max(0, tau2 + delta);
        if (Math.abs(newTau2 - tau2) < tol) return newTau2;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2HS(effects, ses) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / k;
      const totalVariance = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / k;
      const avgSamplingVar = variances.reduce((a, b) => a + b, 0) / k;
      return Math.max(0, totalVariance - avgSamplingVar);
    }

    // ============================================================
    // MAIN META-ANALYSIS
    // ============================================================

    function calculateMetaAnalysis(studies, options = {}) {
      const settings = { tau2Estimator: 'DL', useHKSJ: true, confidenceLevel: 0.95, ...options };
      const k = studies.length;
      if (k === 0) return { error: 'لم يتم تقديم دراسات' };

      const isRatio = studies[0].isRatioMeasure !== false;
      const transformedEffects = studies.map(s => isRatio ? Math.log(s.effect) : s.effect);
      const ses = studies.map(s => {
        if (isRatio) return (Math.log(s.ciHi) - Math.log(s.ciLo)) / Z_95_CI_DIVISOR;
        return (s.ciHi - s.ciLo) / Z_95_CI_DIVISOR;
      });

      const fixedWeights = ses.map(se => 1 / (se * se));
      const totalFixedWeight = fixedWeights.reduce((a, b) => a + b, 0);
      const fixedEffect = transformedEffects.reduce((sum, e, i) => sum + e * fixedWeights[i], 0) / totalFixedWeight;
      const q = transformedEffects.reduce((sum, e, i) => sum + fixedWeights[i] * Math.pow(e - fixedEffect, 2), 0);
      const df = k - 1;
      const qPValue = df > 0 ? 1 - chiSquareCDF(q, df) : 1;
      const i2 = q > df ? Math.max(0, ((q - df) / q) * 100) : 0;
      const h2 = df > 0 ? q / df : 1;

      let tau2, tau2Method;
      const estimator = settings.tau2Estimator || 'DL';
      switch (estimator) {
        case 'REML': tau2 = calculateTau2REML(transformedEffects, ses); tau2Method = 'REML'; break;
        case 'PM': tau2 = calculateTau2PM(transformedEffects, ses); tau2Method = 'PM'; break;
        case 'SJ': tau2 = calculateTau2SJ(transformedEffects, ses); tau2Method = 'SJ'; break;
        case 'HE': tau2 = calculateTau2HE(transformedEffects, ses); tau2Method = 'HE'; break;
        case 'EB': tau2 = calculateTau2EB(transformedEffects, ses); tau2Method = 'EB'; break;
        case 'ML': tau2 = calculateTau2ML(transformedEffects, ses); tau2Method = 'ML'; break;
        case 'HS': tau2 = calculateTau2HS(transformedEffects, ses); tau2Method = 'HS'; break;
        default: tau2 = calculateTau2DL(transformedEffects, ses); tau2Method = 'DL';
      }

      const randomWeights = ses.map(se => 1 / (se * se + tau2));
      const totalRandomWeight = randomWeights.reduce((a, b) => a + b, 0);
      const normalizedWeights = randomWeights.map(w => w / totalRandomWeight);
      const randomEffect = transformedEffects.reduce((sum, e, i) => sum + e * randomWeights[i], 0) / totalRandomWeight;
      let randomSE = Math.sqrt(1 / totalRandomWeight);

      let useHKSJ = settings.useHKSJ && k >= 2;
      let hksjAdjustment = null;
      if (useHKSJ) {
        const qStar = transformedEffects.reduce((sum, e, i) => sum + randomWeights[i] * Math.pow(e - randomEffect, 2), 0);
        const hksjMultiplier = df > 0 ? qStar / df : 1;
        hksjAdjustment = { multiplier: hksjMultiplier, adjustedSE: randomSE * Math.sqrt(Math.max(1, hksjMultiplier)) };
      }

      let pooledCiLo, pooledCiHi, pValue, testMethod;
      if (useHKSJ && hksjAdjustment) {
        const tCrit = tQuantile(1 - (1 - settings.confidenceLevel) / 2, df);
        const effectSE = hksjAdjustment.adjustedSE;
        pooledCiLo = isRatio ? Math.exp(randomEffect - tCrit * effectSE) : randomEffect - tCrit * effectSE;
        pooledCiHi = isRatio ? Math.exp(randomEffect + tCrit * effectSE) : randomEffect + tCrit * effectSE;
        const tStat = randomEffect / effectSE;
        pValue = 2 * (1 - tCDF(Math.abs(tStat), df));
        testMethod = 'HKSJ (t-distribution)';
      } else {
        pooledCiLo = isRatio ? Math.exp(randomEffect - Z_95 * randomSE) : randomEffect - Z_95 * randomSE;
        pooledCiHi = isRatio ? Math.exp(randomEffect + Z_95 * randomSE) : randomEffect + Z_95 * randomSE;
        const z = randomEffect / randomSE;
        pValue = 2 * (1 - normalCDF(Math.abs(z)));
        testMethod = 'Wald (z-distribution)';
      }

      const pooledEffect = isRatio ? Math.exp(randomEffect) : randomEffect;

      const predictionInterval = tau2 > 0 && k >= 3 ? {
        lo: isRatio ? Math.exp(randomEffect - tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)) : randomEffect - tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2),
        hi: isRatio ? Math.exp(randomEffect + tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)) : randomEffect + tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)
      } : null;

      return {
        pooledEffect, pooledCiLo, pooledCiHi, pValue,
        i2, h2, q, qPValue, tau2, tau2Method,
        k, weights: normalizedWeights, isRatio,
        testMethod, hksjAdjustment, predictionInterval,
        transformedEffects, ses,
        fixedEffect: isRatio ? Math.exp(fixedEffect) : fixedEffect,
        fixedSE: Math.sqrt(1 / totalFixedWeight)
      };
    }

    // ============================================================
    // FOREST PLOT
    // ============================================================

    function generateForestPlotHTML(studies, meta) {
      const allEffects = [...studies.map(s => s.effect), meta.pooledEffect];
      const allLo = [...studies.map(s => s.ciLo), meta.pooledCiLo];
      const allHi = [...studies.map(s => s.ciHi), meta.pooledCiHi];

      const minEffect = Math.min(...allLo, 0.5);
      const maxEffect = Math.max(...allHi, 2.0);
      const range = maxEffect - minEffect;

      const scale = (val) => ((val - minEffect) / range) * 350 + 50;
      const height = (studies.length + 2) * 28 + 40;

      return `
        <svg viewBox="0 0 550 ${height}" style="width: 100%; height: ${height}px; font-family: 'Source Sans Pro', sans-serif;">
          <line x1="${scale(1)}" y1="15" x2="${scale(1)}" y2="${height - 25}" stroke="#ddd" stroke-width="1.5" stroke-dasharray="4" />
          <line x1="50" y1="${height - 25}" x2="400" y2="${height - 25}" stroke="#333" />
          <text x="${scale(0.5)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">0.5</text>
          <text x="${scale(1)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">1.0</text>
          <text x="${scale(1.5)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">1.5</text>
          <text x="${scale(2)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">2.0</text>
          ${studies.map((s, i) => {
            const y = 25 + i * 28;
            const size = Math.max(4, Math.sqrt(meta.weights[i]) * 12);
            return `
              <text x="5" y="${y + 4}" font-size="9" fill="#333">${s.label || 'Study ' + (i+1)}</text>
              <line x1="${scale(s.ciLo)}" y1="${y}" x2="${scale(s.ciHi)}" y2="${y}" stroke="#1E2761" stroke-width="1.5" />
              <rect x="${scale(s.effect) - size/2}" y="${y - size/2}" width="${size}" height="${size}" fill="#1E2761" />
              <text x="420" y="${y + 4}" font-size="8" fill="#333">${s.effect.toFixed(2)} [${s.ciLo.toFixed(2)}, ${s.ciHi.toFixed(2)}]</text>
            `;
          }).join('')}
          <polygon points="${scale(meta.pooledEffect)},${25 + Studies.length * 28 - 7} ${scale(meta.pooledCiLo)},${25 + Studies.length * 28} ${scale(meta.pooledEffect)},${25 + دراسات.length * 28 + 7} ${scale(meta.pooledCiHi)},${25 + دراسات. الطول * 28}" fill="#D4AF37" />
          <text x="5" y="${25 + studies.length * 28 + 4}" font-size="9" font-weight="bold" fill="#333">Pooled</text>
          <text x="420" y="${25 + studies.length * 28 + 4}" font-size="8" font-weight="bold" fill="#333">${meta.pooledEffect.toFixed(2)} [${meta.pooledCiLo.toFixed(2)}, ${meta.pooledCiHi.toFixed(2)}]</text>
          <text x="${scale(0.7)}" y="${height - 2}" font-size="8" fill="#22c55e">Favors Treatment</text>
          <text x="${scale(1.3)}" y="${height - 2}" font-size="8" fill="#C53030">Favors Control</text>
        </svg>
      `;
    }

    // ============================================================
    // MODULE NAVIGATION
    // ============================================================

    const modules = [
      { id: 0, title: 'الافتتاح', subtitle: 'لماذا يوجد التحليل التلوي', slides: 10 },
      { id: 1, title: 'السؤال', subtitle: 'CAST: إطار عمل PICO', slides: 16 },
      { id: 2, title: 'البروتوكول', subtitle: 'HRT: Pre-specification', slides: 10 },
      { id: 3, title: 'البحث', subtitle: 'روزيجليتازون: الأدب الرمادي', slides: 4 },
      { id: 4, title: 'الفحص', subtitle: 'Vioxx: PRISMA', slides: 7 },
      { id: 5, title: 'الاستخراج', subtitle: 'DECREASE: Provenance', slides: 6 },
      { id: 6, title: 'الانحياز', subtitle: 'أبروتينين: RoB 2.0 + ROBINS-I', slides: 10 },
      { id: 7, title: 'التركيب', subtitle: 'المغنيسيوم: قطع أراضي الغابات', slides: 7 },
      { id: 8, title: 'عدم التجانس', subtitle: 'ACCORD: I²، ICEMAN والانحدار التلوي', slides: 15 },
      { id: 9, title: 'الدراسات المخفية', subtitle: 'Reboxetine: مخططات القمع', slides: 6 },
      { id: 10, title: 'اليقين', subtitle: 'Surfactant: GRADE', slides: 7 },
      { id: 11, title: 'المراجعة الحية', subtitle: 'COVID-19: TSA', slides: 6 },
      { id: 12, title: 'Advanced Methods', subtitle: 'NMA، DTA، الاستجابة للجرعة', slides: 8 },
      { id: 13, title: 'Capstone', subtitle: 'السباق التعريفي الأول', slides: 13 },
      { id: 14, title: 'Final Exam', subtitle: 'Summative assessment', slides: 3 }
    ];

    let currentModule = 0;
    let currentSlide = 0;

    function initModuleList() {
      const list = document.getElementById('moduleList');
      list.innerHTML = modules.map(m => `
        <div class="عنصر الوحدة ${m.id === currentModule ? 'active' : ''}" data-module="${m.id}" onclick="goToModule(${m.id})">
          <div class="module-number">${m.id}</div>
          <div class="module-info">
            <div class="module-title">${m.title}</div>
            <div class="module-subtitle">${m.subtitle}</div>
          </div>
        </div>
      `).join('');
    }

    function goToModule(moduleId) {
      const parsedId = Number(moduleId);
      if (!Number.isFinite(parsedId) || parsedId < 0 || parsedId >= modules.length) {
        moduleId = 0;
      } else {
        moduleId = parsedId;
      }

      // Hide current module
      document.querySelectorAll('.module-slides').forEach(m => m.classList.remove('active'));
      document.querySelectorAll('.module-item').forEach(m => m.classList.remove('active'));

      // Show new module
      currentModule = moduleId;
      currentSlide = 0;
      const moduleEl = document.querySelector(`.module-slides[data-module="${moduleId}"]`);
      if (moduleEl) {
        moduleEl.classList.add('active');
        updateSlideDisplay(moduleEl);
      }
      const moduleItem = document.querySelector(`.module-item[data-module="${moduleId}"]`);
      if (moduleItem) {
        moduleItem.classList.add('active');
      }

      // Update header
      document.getElementById('currentModuleNum').textContent = moduleId;
      document.getElementById('currentModuleName').textContent = modules[moduleId]?.title || 'Module';

      // Update live story data panel
      updateStoryPanel(moduleId);

      // Show/hide story indicator button
      const storyBtn = document.getElementById('storyIndicatorBtn');
      if (storyData[moduleId]) {
        storyBtn.classList.add('visible');
      } else {
        storyBtn.classList.remove('visible');
      }

      updateProgress();
    }

    function updateSlideDisplay(moduleEl) {
      const slides = moduleEl.querySelectorAll('.slide');
      slides.forEach((s, i) => s.classList.toggle('active', i === currentSlide));

      // Update progress dots
      const progress = document.getElementById('progress');
      progress.innerHTML = Array.from({ length: slides.length }, (_, i) =>
        `<div class="progress-dot ${i ===currentSlide ? 'active' : ''}" onclick="goToSlide(${i})" role="button" tabindex="0" aria-label="انتقل إلى الشريحة ${i + 1}"></div>`
      ).join('');

      // Update counter
      document.getElementById('counter').textContent = `${currentSlide + 1} / ${slides.length}`;

      // Update buttons
      document.getElementById('prevBtn').disabled = currentSlide === 0;
      document.getElementById('nextBtn').disabled = currentSlide === slides.length - 1;

      // Announce slide change to screen readers
      const announcer = document.getElementById('slideAnnouncer');
      if (announcer) {
        announcer.textContent = `Slide ${currentSlide + 1} of ${slides.length}`;
      }
    }

    function goToSlide(index) {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      if (index >= 0 && index < slides.length) {
        currentSlide = index;
        updateSlideDisplay(moduleEl);
      }
    }

    function nextSlide() {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      if (currentSlide < slides.length - 1) {
        currentSlide++;
        updateSlideDisplay(moduleEl);
      }
    }

    function prevSlide() {
      if (currentSlide > 0) {
        currentSlide--;
        const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
        updateSlideDisplay(moduleEl);
      }
    }

    function nextModule() {
      if (currentModule < modules.length - 1) {
        goToModule(currentModule + 1);
      }
    }

    function updateProgress() {
      const percent = Math.round((currentModule / (modules.length - 1)) * 100);
      document.getElementById('progressPercent').textContent = percent + '%';
    }

    // ============================================================
    // TOOLS PANEL
    // ============================================================

    function toggleToolsPanel() {
      const panel = document.getElementById('toolsPanel');
      const contentBody = document.querySelector('.content-body');
      panel.classList.toggle('visible');
      contentBody.classList.toggle('tools-open');
    }

    function toggleSection(header) {
      const body = header.nextElementSibling;
      body.style.display = body.style.display === 'none' ? 'block' : 'none';
      header.querySelector('span').textContent = body.style.display === 'none' ? '▼' : '▲';
    }

    // ============================================================
    // EFFECT SIZE CALCULATOR
    // ============================================================

    function calculateEffectSize() {
      const type = document.getElementById('effectType').value;
      const eventsTx = parseFloat(document.getElementById('eventsTx').value);
      const nTx = parseFloat(document.getElementById('nTx').value);
      const eventsCtrl = parseFloat(document.getElementById('eventsCtrl').value);
      const nCtrl = parseFloat(document.getElementById('nCtrl').value);

      if (isNaN(eventsTx) || isNaN(nTx) || isNaN(eventsCtrl) || isNaN(nCtrl)) {
        alert('يرجى إدخال جميع القيم');
        return;
      }

      let effect, se, ciLo, ciHi;
      const cc = 0.5; // continuity correction

      if (type === 'OR') {
        const a = eventsTx + cc, b = nTx - eventsTx + cc;
        const c = eventsCtrl + cc, d = nCtrl - eventsCtrl + cc;
        const or = (a * d) / (b * c);
        se = Math.sqrt(1/a + 1/b + 1/c + 1/d);
        effect = or;
        ciLo = Math.exp(Math.log(or) - 1.96 * se);
        ciHi = Math.exp(Math.log(or) + 1.96 * se);
      } else if (type === 'RR') {
        const p1 = (eventsTx + cc) / (nTx + cc);
        const p2 = (eventsCtrl + cc) / (nCtrl + cc);
        const rr = p1 / p2;
        se = Math.sqrt((1 - p1) / (eventsTx + cc) + (1 - p2) / (eventsCtrl + cc));
        effect = rr;
        ciLo = Math.exp(Math.log(rr) - 1.96 * se);
        ciHi = Math.exp(Math.log(rr) + 1.96 * se);
      } else if (type === 'RD') {
        const p1 = eventsTx / nTx, p2 = eventsCtrl / nCtrl;
        effect = p1 - p2;
        se = Math.sqrt(p1 * (1 - p1) / nTx + p2 * (1 - p2) / nCtrl);
        ciLo = effect - 1.96 * se;
        ciHi = effect + 1.96 * se;
      }

      const resultsDiv = document.getElementById('effectResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Effect (${type}):</span><span class="value">${effect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">[${ciLo.toFixed(3)}, ${ciHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">SE (log):</span><span class="value">${se.toFixed(4)}</span></div>
      `;
    }

    // ============================================================
    // META-ANALYSIS CALCULATOR UI
    // ============================================================

    function addStudyRow() {
      const tbody = document.getElementById('studyTableBody');
      const rowCount = tbody.rows.length + 1;
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input type="text" value="Study ${rowCount}"></td>
        <td><input type="number" step="0.01" value="1.00"></td>
        <td><input type="number" step="0.01" value="0.80"></td>
        <td><input type="number" step="0.01" value="1.25"></td>
        <td><button class="btn-small" onclick="RemoveStudyRow(this)">×</button></td>
      `;
      tbody.appendChild(row);
    }

    function removeStudyRow(btn) {
      const row = btn.closest('tr');
      row.remove();
    }

    function runMetaAnalysis() {
      const rows = document.getElementById('studyTableBody').rows;
      const studies = [];

      for (const row of rows) {
        const inputs = row.querySelectorAll('input');
        const label = inputs[0].value;
        const effect = parseFloat(inputs[1].value);
        const ciLo = parseFloat(inputs[2].value);
        const ciHi = parseFloat(inputs[3].value);

        if (!isNaN(effect) && !isNaN(ciLo) && !isNaN(ciHi)) {
          studies.push({ label, effect, ciLo, ciHi, isRatioMeasure: true });
        }
      }

      if (studies.length < 2) {
        alert('تحتاج إلى دراستين على الأقل');
        return;
      }

      const tau2Method = document.getElementById('tau2Method').value;
      const useHKSJ = document.getElementById('useHKSJ').checked;

      const result = calculateMetaAnalysis(studies, { tau2Estimator: tau2Method, useHKSJ });

      if (result.error) {
        alert(result.error);
        return;
      }

      // Display results
      const resultsDiv = document.getElementById('maResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Pooled Effect:</span><span class="value">${result.pooledEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">[${result.pooledCiLo.toFixed(3)}, ${result.pooledCiHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">p-value:</span><span class="value">${result.pValue < 0.001 ? '< 0.001' : result.pValue.toFixed(4)}</span></div>
        <div class="result-row"><span class="label">I²:</span><span class="value">${result.i2.toFixed(1)}%</span></div>
        <div class="result-row"><span class="label">τ² (${result.tau2Method}):</span><span class="value">${result.tau2.toFixed(4)}</span></div>
        <div class="result-row"><span class="label">Q (p-value):</span><span class="value">${result.q.toFixed(2)} (${result.qPValue.toFixed(4)})</span></div>
        <div class="result-row"><span class="label">Test method:</span><span class="value">${result.testMethod}</span></div>
        ${result.predictionInterval ? `<div class="result-row"><span class="label">95% PI:</span><span class="value">[${result.predictionInterval.lo.toFixed(3)}, ${result.predictionInterval.hi.toFixed(3)}]</span></div>` : ''}
      `;

      // Generate forest plot
      const plotContainer = document.getElementById('forestPlotContainer');
      plotContainer.style.display = 'block';
      plotContainer.innerHTML = generateForestPlotHTML(studies, result);
    }

    // ============================================================
    // PICO BUILDER
    // ============================================================

    function generatePICO() {
      const p = document.getElementById('picoP').value;
      const i = document.getElementById('picoI').value;
      const c = document.getElementById('picoC').value;
      const o = document.getElementById('picoO').value;

      if (!p || !i || !o) {
        alert('يرجى ملء السكان والتدخل والنتيجة');
        return;
      }

      const question = `In ${p}, does ${i} compared to ${c || 'الرعاية القياسية'} improve ${o}?`;

      const output = document.getElementById('picoOutput');
      output.style.display = 'block';
      output.innerHTML = `
        <strong>Research Question:</strong><br>
        <em>${question}</em>
      `;
    }

    // ============================================================
    // KEYBOARD NAVIGATION
    // ============================================================

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight' || e.key === ' ') {
        e.preventDefault();
        nextSlide();
      } else if (e.key === 'ArrowLeft') {
        e.preventDefault();
        prevSlide();
      }
    });

    // ============================================================
    // PUBLICATION BIAS
    // ============================================================

    let lastMetaStudies = null;
    let lastMetaResult = null;

    // Override runMetaAnalysis to save data for publication bias
    const originalRunMA = runMetaAnalysis;
    runMetaAnalysis = function() {
      const rows = document.getElementById('studyTableBody').rows;
      const studies = [];
      for (const row of rows) {
        const inputs = row.querySelectorAll('input');
        const label = inputs[0].value;
        const effect = parseFloat(inputs[1].value);
        const ciLo = parseFloat(inputs[2].value);
        const ciHi = parseFloat(inputs[3].value);
        if (!isNaN(effect) && !isNaN(ciLo) && !isNaN(ciHi)) {
          studies.push({ label, effect, ciLo, ciHi, isRatioMeasure: true });
        }
      }
      lastMetaStudies = studies;

      const tau2Method = document.getElementById('tau2Method').value;
      const useHKSJ = document.getElementById('useHKSJ').checked;
      const result = calculateMetaAnalysis(studies, { tau2Estimator: tau2Method, useHKSJ });
      lastMetaResult = result;

      // Display results
      if (result.error) {
        alert(result.error);
        return;
      }
      const resultsDiv = document.getElementById('maResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Pooled Effect:</span><span class="value">${result.pooledEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">[${result.pooledCiLo.toFixed(3)}, ${result.pooledCiHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">p-value:</span><span class="value">${result.pValue < 0.001 ? '< 0.001' : result.pValue.toFixed(4)}</span></div>
        <div class="result-row"><span class="label">I²:</span><span class="value">${result.i2.toFixed(1)}%</span></div>
        <div class="result-row"><span class="label">τ² (${result.tau2Method}):</span><span class="value">${result.tau2.toFixed(4)}</span></div>
        <div class="result-row"><span class="label">Q (p-value):</span><span class="value">${result.q.toFixed(2)} (${result.qPValue.toFixed(4)})</span></div>
        <div class="result-row"><span class="label">Test method:</span><span class="value">${result.testMethod}</span></div>
        ${result.predictionInterval ? `<div class="result-row"><span class="label">95% PI:</span><span class="value">[${result.predictionInterval.lo.toFixed(3)}, ${result.predictionInterval.hi.toFixed(3)}]</span></div>` : ''}
      `;
      const plotContainer = document.getElementById('forestPlotContainer');
      plotContainer.style.display = 'block';
      plotContainer.innerHTML = generateForestPlotHTML(studies, result);
    };

    function calculateEggersTest(effects, ses) {
      const n = effects.length;
      if (n < 3) return { intercept: NaN, pValue: NaN, significant: false };
      const precision = ses.map(se => 1 / se);
      const standardizedEffects = effects.map((e, i) => e / ses[i]);
      const meanX = precision.reduce((a, b) => a + b, 0) / n;
      const meanY = standardizedEffects.reduce((a, b) => a + b, 0) / n;
      let ssXY = 0, ssXX = 0;
      for (let i = 0; i < n; i++) {
        ssXY += (precision[i] - meanX) * (standardizedEffects[i] - meanY);
        ssXX += (precision[i] - meanX) ** 2;
      }
      const slope = ssXX > 0 ? ssXY / ssXX : 0;
      const intercept = meanY - slope * meanX;
      let ssResid = 0;
      for (let i = 0; i < n; i++) {
        const predicted = intercept + slope * precision[i];
        ssResid += (standardizedEffects[i] - predicted) ** 2;
      }
      const residSE = Math.sqrt(ssResid / (n - 2));
      const interceptSE = residSE * Math.sqrt(1/n + meanX * meanX / ssXX);
      const tStat = intercept / interceptSE;
      const pValue = 2 * (1 - tCDF(Math.abs(tStat), n - 2));
      return { intercept, slope, tStat, pValue, significant: pValue < 0.1 };
    }

    function calculateBeggsTest(effects, ses) {
      const n = effects.length;
      if (n < 3) return { tau: NaN, pValue: NaN };
      const indices = effects.map((_, i) => i);
      const variances = ses.map(se => se * se);
      indices.sort((a, b) => variances[a] - variances[b]);
      const sortedEffects = indices.map(i => effects[i]);
      let concordant = 0, discordant = 0;
      for (let i = 0; i < n - 1; i++) {
        for (let j = i + 1; j < n; j++) {
          if (sortedEffects[j] > sortedEffects[i]) concordant++;
          else if (sortedEffects[j] < sortedEffects[i]) discordant++;
        }
      }
      const tau = (concordant - discordant) / (n * (n - 1) / 2);
      const se = Math.sqrt((2 * (2 * n + 5)) / (9 * n * (n - 1)));
      const z = tau / se;
      const pValue = 2 * (1 - normalCDF(Math.abs(z)));
      return { tau, z, pValue, significant: pValue < 0.1 };
    }

    function generateFunnelPlotHTML(effects, ses, pooledEffect) {
      const minEffect = Math.min(...effects) - 0.5;
      const maxEffect = Math.max(...effects) + 0.5;
      const maxSE = Math.max(...ses);
      const range = maxEffect - minEffect;

      const scaleX = (val) => ((val - minEffect) / range) * 300 + 25;
      const scaleY = (se) => (se / maxSE) * 180 + 20;

      const pooledX = scaleX(pooledEffect);

      return `
        <svg viewBox="0 0 350 220" style="width: 100%; height: 220px; font-family: 'Source Sans Pro', sans-serif;">
          <!-- Funnel shape -->
          <polygon points="${pooledX},20 ${scaleX(pooledEffect - 1.96 * maxSE)},200 ${scaleX(pooledEffect + 1.96 * maxSE)},200"
                   fill="rgba(30,39,97,0.1)" stroke="none"/>

          <!-- Axes -->
          <line x1="25" y1="200" x2="325" y2="200" stroke="#333" />
          <line x1="25" y1="20" x2="25" y2="200" stroke="#333" />

          <!-- Pooled effect line -->
          <line x1="${pooledX}" y1="20" x2="${pooledX}" y2="200" stroke="#D4AF37" stroke-width="2" stroke-dasharray="4" />

          <!-- Points -->
          ${effects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(ses[i])}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>
          `).join('')}

          <!-- Labels -->
          <text x="175" y="218" font-size="10" text-anchor="middle" fill="#666">Effect Size (log scale)</text>
          <text x="12" y="110" font-size="10" text-anchor="middle" fill="#666" transform="rotate(-90, 12, 110)">Standard Error</text>
          <text x="${pooledX}" y="15" font-size="8" text-anchor="middle" fill="#D4AF37">Pooled</text>
        </svg>
      `;
    }

    function runPublicationBias() {
      if (!lastMetaResult || !lastMetaStudies || lastMetaStudies.length < 3) {
        alert('قم بتشغيل التحليل التلوي أولاً باستخدام 3 دراسات على الأقل');
        return;
      }

      const effects = lastMetaResult.transformedEffects;
      const ses = lastMetaResult.ses;

      const egger = calculateEggersTest(effects, ses);
      const begg = calculateBeggsTest(effects, ses);

      document.getElementById('pubBiasResults').style.display = 'block';
      document.getElementById('eggerResults').innerHTML = `
        <div class="result-row"><span class="label">Egger'تقاطع:</span><span class="value">${egger.intercept.toFixed(3)</span></div> <div class="result-row"><span class="label">قيمة البيض's p-value:</span><span class="${egger.significant ? 'red' : ''}">${egger.pValue.toFixed(4)} ${egger.significant ? '(Significant)' : ''}</span></div>
        <div class="result-row"><span class="label">Begg's tau:</span><span class="value">${begg.tau.toFixed(3)}</span></div> <div class="result-row"><span class="label">قيمة Begg's p-value:</span><span class="${begg.significant ? 'red' : ''}">${begg.pValue.toFixed(4)} ${begg.significant ? '(Significant)' : ''}</span></div>
        <div class="result-row"><span class="label">Interpretation:</span><span class="value">${egger.significant || begg.significant ? 'التأثيرات المحتملة للدراسات الصغيرة (تحيز النشر هو أحد التفسيرات)' : 'لا يوجد دليل قوي على التحيز'}</span></div>
      `;

      const pooledLog = Math.log(lastMetaResult.pooledEffect);
      document.getElementById('funnelPlotContainer').innerHTML = generateFunnelPlotHTML(effects, ses, pooledLog);
    }

    // ============================================================
    // RISK OF BIAS 2.0
    // ============================================================

    function updateRoBOverall() {
      const domains = ['robD1', 'robD2', 'robD3', 'robD4', 'robD5'];
      const values = domains.map(id => document.getElementById(id).value);

      if (values.some(v => !v)) {
        document.getElementById('robOverall').innerHTML = '<span style="color: var(--light-text);">أكمل جميع المجالات</span>';
        document.getElementById('robTrafficLight').innerHTML = '';
        return;
      }

      let overall;
      if (values.includes('high')) {
        overall = 'high';
      } else if (values.includes('some')) {
        overall = 'some';
      } else {
        overall = 'low';
      }

      const colors = { low: '#22c55e', some: '#f59e0b', high: '#C53030' };
      const labels = { low: 'خطر منخفض للتحيز', some: 'بعض المخاوف', high: 'ارتفاع مخاطر التحيز' };

      document.getElementById('robOverall').innerHTML = `
        <span style="color: ${colors[overall]};">${labels[overall]}</span>
      `;
      document.getElementById('robOverall').style.background = overall === 'low' ? 'rgba(34,197,94,0.1)' :
                                                                overall === 'some' ? 'rgba(245,158,11,0.1)' : 'rgba(197,48,48,0.1)';

      // Traffic light
      document.getElementById('robTrafficLight').innerHTML = `
        <div style="display: flex; gap: 0.25rem; justify-content: center; margin-top: 0.5rem;">
          ${domains.map((id, i) => {
            const val = values[i];
            return `<div style="width: 20px; height: 20px; border-radius: 50%; background: ${colors[val]};" title="D${i+1}: ${val}"></div>`;
          }).join('')}
        </div>
      `;
    }

    // ============================================================
    // GRADE ASSESSMENT
    // ============================================================

    function calculateGRADE() {
      const start = parseInt(document.getElementById('gradeStart').value);
      const rob = parseInt(document.getElementById('gradeRoB').value);
      const inconsistency = parseInt(document.getElementById('gradeInconsistency').value);
      const indirectness = parseInt(document.getElementById('gradeIndirectness').value);
      const imprecision = parseInt(document.getElementById('gradeImprecision').value);
      const pubBias = parseInt(document.getElementById('gradePubBias').value);

      const total = start + rob + inconsistency + indirectness + imprecision + pubBias;
      const finalScore = Math.max(1, Math.min(4, total));

      const levels = {
        4: { label: 'HIGH', color: '#22c55e', symbol: '⊕⊕⊕⊕', desc: 'واثق جدًا من أن التأثير الحقيقي قريب من التقدير' },
        3: { label: 'MODERATE', color: '#3b82f6', symbol: '⊕⊕⊕○', desc: 'واثق إلى حد ما؛ من المحتمل أن يكون التأثير الحقيقي قريبًا من التقدير' },
        2: { label: 'LOW', color: '#f59e0b', symbol: '⊕⊕○○', desc: 'ثقة محدودة؛ قد يكون التأثير الحقيقي مختلفًا إلى حد كبير' },
        1: { label: 'VERY LOW', color: '#C53030', symbol: '⊕○○○', desc: 'ثقة قليلة جدًا في تقدير التأثير' }
      };

      const level = levels[finalScore];

      document.getElementById('gradeResult').innerHTML = `
        <div style="text-align: center; padding: 1rem; background: rgba(${finalScore === 4 ? '34,197,94' : finalScore === 3 ? '59,130,246' : finalScore === 2 ? '245,158,11' : '197,48,48'},0.1); border-radius: 8px;">
          <div style="font-size: 1.5rem; letter-spacing: 0.2rem; color: ${level.color};">${level.symbol}</div>
          <div style="font-size: 1.1rem; font-weight: 700; color: ${level.color}; margin: 0.5rem 0;">${level.label}</div>
          <div style="font-size: 0.75rem; color: var(--light-text);">${level.desc}</div>
        </div>
        <div style="margin-top: 0.75rem; font-size: 0.75rem; color: var(--light-text);">
          Starting: ${start === 4 ? 'High (RCTs)' : 'Low (Observational)'}<br>
          Downgrades: ${Math.abs(rob + inconsistency + indirectness + imprecision + pubBias)} levels
        </div>
      `;
    }

    // ============================================================
    // HETEROGENEITY INTERPRETATION
    // ============================================================

    function interpretI2() {
      const i2 = parseFloat(document.getElementById('i2Input').value);

      if (isNaN(i2) || i2 < 0 || i2 > 100) {
        alert('أدخل قيمة I² صالحة بين 0 و100');
        return;
      }

      let interpretation, color, recommendation;

      if (i2 <= 25) {
        interpretation = 'Low heterogeneity';
        color = '#22c55e';
        recommendation = 'قد يكون نموذج التأثير الثابت مناسبًا. النتائج متسقة عبر الدراسات.';
      } else if (i2 <= 50) {
        interpretation = 'Moderate heterogeneity';
        color = '#3b82f6';
        recommendation = 'فكر في نموذج التأثيرات العشوائية. التحقيق في المصادر المحتملة للاختلاف.';
      } else if (i2 <= 75) {
        interpretation = 'Substantial heterogeneity';
        color = '#f59e0b';
        recommendation = 'استخدم نموذج التأثيرات العشوائية. يوصى بتحليل المجموعة الفرعية أو الانحدار التلوي. فكر فيما إذا كان التجميع مناسبًا.';
      } else {
        interpretation = 'Considerable heterogeneity';
        color = '#C53030';
        recommendation = 'قد يكون التجميع غير مناسب. التركيز على فهم مصادر عدم التجانس قبل التوليف. تقرير الفاصل الزمني للتنبؤ.';
      }

      document.getElementById('i2Interpretation').innerHTML = `
        <div style="padding: 0.75rem; background: rgba(${i2 <= 25 ? '34,197,94' : i2 <= 50 ? '59,130,246' : i2 <= 75 ? '245,158,11' : '197,48,48'},0.1); border-radius: 6px; border-right: 3px solid ${color};">
          <div style="font-weight: 700; color: ${color}; margin-bottom: 0.25rem;">I² = ${i2}%: ${interpretation}</div>
          <div style="font-size: 0.8rem; color: var(--text);">${recommendation}</div>
        </div>
      `;
    }

    // ============================================================
    // NNT/NNH CALCULATOR
    // ============================================================

    function calculateNNT() {
      const cer = parseFloat(document.getElementById('nntCER').value);
      const effectType = document.getElementById('nntEffectType').value;
      const effect = parseFloat(document.getElementById('nntEffect').value);
      const ciLo = parseFloat(document.getElementById('nntCILo').value);
      const ciHi = parseFloat(document.getElementById('nntCIHi').value);

      if (isNaN(cer) || isNaN(effect) || cer <= 0 || cer >= 1) {
        alert('أدخل خطرًا أساسيًا صالحًا (0 < CER < 1) وحجم التأثير');
        return;
      }

      let arr, arrLo, arrHi; // Absolute Risk Reduction

      if (effectType === 'RD') {
        arr = -effect; // RD is already absolute
        arrLo = -ciHi;
        arrHi = -ciLo;
      } else if (effectType === 'RR') {
        const eer = cer * effect;
        const eerLo = cer * ciLo;
        const eerHi = cer * ciHi;
        arr = cer - eer;
        arrLo = cer - eerHi;
        arrHi = cer - eerLo;
      } else { // OR
        const eer = (cer * effect) / (1 - cer + cer * effect);
        const eerLo = (cer * ciLo) / (1 - cer + cer * ciLo);
        const eerHi = (cer * ciHi) / (1 - cer + cer * ciHi);
        arr = cer - eer;
        arrLo = cer - eerHi;
        arrHi = cer - eerLo;
      }

      const nnt = arr !== 0 ? 1 / arr : Infinity;
      const nntLo = arrHi !== 0 ? 1 / arrHi : Infinity;
      const nntHi = arrLo !== 0 ? 1 / arrLo : Infinity;

      const isBenefit = arr > 0;
      const label = isBenefit ? 'NNT (منفعة)' : 'NNH (ضرر)';
      const color = isBenefit ? 'var(--green)' : 'var(--red)';

      const resultsDiv = document.getElementById('nntResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Baseline Risk (CER):</span><span class="value">${(cer * 100).toFixed(1)}%</span></div>
        <div class="result-row"><span class="label">Absolute Risk Reduction:</span><span class="value">${(arr * 100).toFixed(2)}%</span></div>
        <div class="result-row"><span class="label" style="color: ${color}; وزن الخط: 700؛">${label}:</span><span class="value" style="color: ${color}; وزن الخط: 700؛">${Math.abs(nnt).toFixed(1)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">[${Math.abs(nntLo).toFixed(1)}, ${Math.abs(nntHi).toFixed(1)}]</span></div>
        <div style="margin-top: 0.75rem; padding: 0.5rem; background: rgba(${isBenefit ? '34,197,94' : '197,48,48'},0.1); border-radius: 4px; font-size: 0.75rem;">
          ${isBenefit
            ? `Treat <strong>${Math.ceil(Math.abs(nnt))}</strong> patients to prevent 1 event`
            : `Treat <strong>${Math.ceil(Math.abs(nnt))}</strong> patients before causing 1 harm`}
        </div>
      `;
    }

    // ============================================================
    // LEAVE-ONE-OUT SENSITIVITY ANALYSIS
    // ============================================================

    function runLeaveOneOut() {
      if (!lastMetaStudies || lastMetaStudies.length < 3) {
        alert('قم بتشغيل التحليل التلوي أولاً باستخدام 3 دراسات على الأقل');
        return;
      }

      const tau2Method = document.getElementById('tau2Method').value;
      const useHKSJ = document.getElementById('useHKSJ').checked;
      const results = [];

      // Run meta-analysis leaving out each study
      for (let i = 0; i < lastMetaStudies.length; i++) {
        const subset = lastMetaStudies.filter((_, idx) => idx !== i);
        const ma = calculateMetaAnalysis(subset, { tau2Estimator: tau2Method, useHKSJ });
        results.push({
          omitted: lastMetaStudies[i].label,
          effect: ma.pooledEffect,
          ciLo: ma.pooledCiLo,
          ciHi: ma.pooledCiHi,
          i2: ma.i2,
          pValue: ma.pValue
        });
      }

      // Find most influential study
      const originalEffect = lastMetaResult.pooledEffect;
      let maxChange = 0;
      let mostInfluential = '';
      results.forEach(r => {
        const change = Math.abs(Math.log(r.effect) - Math.log(originalEffect));
        if (change > maxChange) {
          maxChange = change;
          mostInfluential = r.omitted;
        }
      });

      // Check if any exclusion changes significance
      const originalSig = lastMetaResult.pValue < 0.05;
      const sensitivityIssue = results.some(r => (r.pValue < 0.05) !== originalSig);

      document.getElementById('looResults').style.display = 'block';
      document.getElementById('looSummary').innerHTML = `
        <div class="result-row"><span class="label">Original pooled effect:</span><span class="value">${originalEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Most influential study:</span><span class="value">${mostInfluential}</span></div>
        <div class="result-row"><span class="label">Sensitivity concern:</span><span class="القيمة ${حساسية المشكلة؟ 'red' : ''}">${sensitivityIssue ? 'نعم - تغييرات في الأهمية' : 'لا - نتائج قوية'}</span></div>
        <div style="margin-top: 0.5rem; font-size: 0.7rem; color: var(--light-text);">
          ${results.map(r => `Omit ${r.omitted}: ${r.effect.toFixed(3)} [${r.ciLo.toFixed(3)}, ${r.ciHi.toFixed(3)}] I²=${r.i2.toFixed(0)}%`).join('<br>')}
        </div>
      `;

      // Generate LOO forest plot
      document.getElementById('looPlotContainer').innerHTML = generateLOOPlotHTML(results, lastMetaResult);
    }

    function generateLOOPlotHTML(looResults, originalMeta) {
      const allEffects = [...looResults.map(r => r.effect), originalMeta.pooledEffect];
      const allLo = [...looResults.map(r => r.ciLo), originalMeta.pooledCiLo];
      const allHi = [...looResults.map(r => r.ciHi), originalMeta.pooledCiHi];

      const minEffect = Math.min(...allLo, 0.5);
      const maxEffect = Math.max(...allHi, 2.0);
      const range = maxEffect - minEffect;

      const scale = (val) => ((val - minEffect) / range) * 280 + 80;
      const height = (looResults.length + 2) * 22 + 30;

      return `
        <svg viewBox="0 0 500 ${height}" style="width: 100%; height: ${height}px; font-family: 'Source Sans Pro', sans-serif;">
          <line x1="${scale(1)}" y1="10" x2="${scale(1)}" y2="${height - 20}" stroke="#ddd" stroke-width="1" stroke-dasharray="3" />
          <text x="40" y="15" font-size="8" fill="#666" font-weight="600">Omitting:</text>
          ${looResults.map((r, i) => {
            const y = 25 + i * 22;
            return `
              <text x="5" y="${y + 3}" font-size="8" fill="#333">${r.omitted}</text>
              <line x1="${scale(r.ciLo)}" y1="${y}" x2="${scale(r.ciHi)}" y2="${y}" stroke="#1E2761" stroke-width="1" />
              <circle cx="${scale(r.effect)}" cy="${y}" r="4" fill="#1E2761" />
              <text x="380" y="${y + 3}" font-size="7" fill="#333">${r.effect.toFixed(2)} [${r.ciLo.toFixed(2)}, ${r.ciHi.toFixed(2)}]</text>
            `;
          }).join('')}
          <line x1="${scale(originalMeta.pooledCiLo)}" y1="${height - 25}" x2="${scale(originalMeta.pooledCiHi)}" y2="${height - 25}" stroke="#D4AF37" stroke-width="2" />
          <polygon points="${scale(originalMeta.pooledEffect)},${height - 30} ${scale(originalMeta.pooledEffect) - 5},${height - 25} ${scale(originalMeta.pooledEffect)},${height - 20} ${scale(originalMeta.pooledEffect) + 5},${height - 25}" fill="#D4AF37" />
          <text x="5" y="${height - 22}" font-size="8" font-weight="bold" fill="#D4AF37">All studies</text>
          <text x="380" y="${height - 22}" font-size="7" font-weight="bold" fill="#333">${originalMeta.pooledEffect.toFixed(2)} [${originalMeta.pooledCiLo.toFixed(2)}, ${originalMeta.pooledCiHi.toFixed(2)}]</text>
        </svg>
      `;
    }

    // ============================================================
    // TRIM-AND-FILL
    // ============================================================

    function runTrimAndFill() {
      if (!lastMetaResult || !lastMetaStudies || lastMetaStudies.length < 3) {
        alert('قم بتشغيل التحليل التلوي أولاً باستخدام 3 دراسات على الأقل');
        return;
      }

      const estimator = document.getElementById('trimFillEstimator').value;
      const side = document.getElementById('trimFillSide').value;

      const effects = [...lastMetaResult.transformedEffects];
      const ses = [...lastMetaResult.ses];
      const k = effects.length;

      // Get initial pooled estimate
      const weights = ses.map(se => 1 / (se * se));
      const sumW = weights.reduce((a, b) => a + b, 0);
      let theta = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;

      // Calculate ranks of |yi - theta| for each study
      const deviations = effects.map((e, i) => ({
        idx: i,
        dev: e - theta,
        absDev: Math.abs(e - theta),
        se: ses[i]
      }));

      // Sort by absolute deviation
      deviations.sort((a, b) => a.absDev - b.absDev);
      const ranks = deviations.map((d, i) => ({ ...d, rank: i + 1 }));

      // Count studies on the specified side
      let n0;
      if (estimator === 'L0') {
        // Linear estimator
        const T = ranks.reduce((sum, r) => {
          const onSide = (side === 'right' && r.dev > 0) || (side === 'left' && r.dev < 0);
          return sum + (onSide ? r.rank : 0);
        }, 0);
        n0 = Math.max(0, Math.round((4 * T - k * (k + 1)) / (2 * k - 1)));
      } else {
        // R0 rank-based estimator
        const gamma = ranks.reduce((sum, r) => {
          const onSide = (side === 'right' && r.dev > 0) || (side === 'left' && r.dev < 0);
          return sum + (onSide ? 1 : 0);
        }, 0);
        n0 = Math.max(0, Math.round(4 * gamma - k + 1) / 3);
      }

      const nFilled = Math.round(n0);

      // Impute missing studies by reflecting the most extreme ones
      const sortedBySide = [...ranks].sort((a, b) => {
        if (side === 'right') return b.dev - a.dev;
        return a.dev - b.dev;
      });

      const imputedEffects = [...effects];
      const imputedSEs = [...ses];
      const imputedLabels = lastMetaStudies.map(s => s.label);

      for (let i = 0; i < nFilled && i < sortedBySide.length; i++) {
        const study = sortedBySide[i];
        const mirroredEffect = 2 * theta - study.dev - theta; // = -study.dev relative to theta
        imputedEffects.push(2 * theta - effects[study.idx]);
        imputedSEs.push(ses[study.idx]);
        imputedLabels.push(`[Imputed ${i + 1}]`);
      }

      // Recalculate pooled effect with imputed studies
      const newWeights = imputedSEs.map(se => 1 / (se * se));
      const newSumW = newWeights.reduce((a, b) => a + b, 0);
      const adjustedTheta = imputedEffects.reduce((sum, e, i) => sum + e * newWeights[i], 0) / newSumW;
      const adjustedSE = Math.sqrt(1 / newSumW);

      const isRatio = lastMetaResult.isRatio;
      const adjustedEffect = isRatio ? Math.exp(adjustedTheta) : adjustedTheta;
      const adjustedCILo = isRatio ? Math.exp(adjustedTheta - 1.96 * adjustedSE) : adjustedTheta - 1.96 * adjustedSE;
      const adjustedCIHi = isRatio ? Math.exp(adjustedTheta + 1.96 * adjustedSE) : adjustedTheta + 1.96 * adjustedSE;

      const originalEffect = lastMetaResult.pooledEffect;
      const changePercent = ((adjustedEffect - originalEffect) / originalEffect * 100).toFixed(1);

      document.getElementById('trimFillResults').style.display = 'block';
      document.getElementById('trimFillSummary').innerHTML = `
        <div class="result-row"><span class="label">Studies imputed:</span><span class="value">${nFilled}</span></div>
        <div class="result-row"><span class="label">Original effect:</span><span class="value">${originalEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Adjusted effect:</span><span class="القيمة ${nFilled > 0؟ 'red' : ''}">${adjustedEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Adjusted 95% CI:</span><span class="value">[${adjustedCILo.toFixed(3)}, ${adjustedCIHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">Change:</span><span class="value">${changePercent}%</span></div>
        ${nFilled > 0 ? `
          <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(197,48,48,0.1); border-radius: 4px; font-size: 0.75rem;">
            <strong>Caution:</strong> ${nFilled} potentially missing studies imputed.
            Treat this as sensitivity analysis, not correction; assumptions may not hold under severe asymmetry.
          </div>
        ` : `
          <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(34,197,94,0.1); border-radius: 4px; font-size: 0.75rem;">
            No missing studies detected on the ${side} side.
          </div>
        `}
      `;

      // Generate filled funnel plot
      document.getElementById('trimFillPlotContainer').innerHTML = generateFilledFunnelHTML(
        lastMetaResult.transformedEffects,
        lastMetaResult.ses,
        imputedEffects.slice(k),
        imputedSEs.slice(k),
        adjustedTheta,
        Math.log(originalEffect)
      );
    }

    function generateFilledFunnelHTML(origEffects, origSEs, impEffects, impSEs, adjustedTheta, originalTheta) {
      const allEffects = [...origEffects, ...impEffects];
      const allSEs = [...origSEs, ...impSEs];

      const minEffect = Math.min(...allEffects) - 0.5;
      const maxEffect = Math.max(...allEffects) + 0.5;
      const maxSE = Math.max(...allSEs);
      const range = maxEffect - minEffect;

      const scaleX = (val) => ((val - minEffect) / range) * 280 + 35;
      const scaleY = (se) => (se / maxSE) * 160 + 20;

      return `
        <svg viewBox="0 0 350 200" style="width: 100%; height: 200px; font-family: 'Source Sans Pro', sans-serif;">
          <!-- Original funnel -->
          <polygon points="${scaleX(originalTheta)},20 ${scaleX(originalTheta - 1.96 * maxSE)},180 ${scaleX(originalTheta + 1.96 * maxSE)},180"
                   fill="rgba(30,39,97,0.05)" stroke="rgba(30,39,97,0.3)" stroke-dasharray="3"/>
          <!-- Adjusted funnel -->
          <polygon points="${scaleX(adjustedTheta)},20 ${scaleX(adjustedTheta - 1.96 * maxSE)},180 ${scaleX(adjustedTheta + 1.96 * maxSE)},180"
                   fill="rgba(212,175,55,0.1)" stroke="#D4AF37"/>

          <!-- Original effect line -->
          <line x1="${scaleX(originalTheta)}" y1="20" x2="${scaleX(originalTheta)}" y2="180" stroke="#1E2761" stroke-width="1" stroke-dasharray="4" />
          <!-- Adjusted effect line -->
          <line x1="${scaleX(adjustedTheta)}" y1="20" x2="${scaleX(adjustedTheta)}" y2="180" stroke="#D4AF37" stroke-width="2" />

          <!-- Original studies -->
          ${origEffects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(origSEs[i])}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>
          `).join('')}

          <!-- Imputed studies -->
          ${impEffects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(impSEs[i])}" r="5" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="2"/>
          `).join('')}

          <!-- Legend -->
          <circle cx="280" cy="15" r="4" fill="#1E2761"/>
          <text x="290" y="18" font-size="7" fill="#666">Original</text>
          <circle cx="280" cy="28" r="4" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="2"/>
          <text x="290" y="31" font-size="7" fill="#666">Imputed</text>

          <text x="175" y="198" font-size="9" text-anchor="middle" fill="#666">Effect Size (log scale)</text>
        </svg>
      `;
    }

    // ============================================================
    // GAMIFICATION & PROGRESS SYSTEM
    // ============================================================

    const STORAGE_KEY = 'evidence_reversal_course_progress';

    // Seven Principles for tracking
    const sevenPrinciples = [
      "ليست كل إشارة الحقيقة.",
      "الطرق تحمي المرضى من ثقتنا.",
      "ما الذي كان مخفيًا على مرأى من الجميع؟",
      "الرقم بدون مصدر ليس رقمًا.",
      "التجانس رسالة وليس ضجيج.",
      "غياب الدليل ليس دليلا على الغياب.",
      "يجب اكتساب اليقين وليس افتراضه."
    ];

    // Badge definitions
    const badges = [
      { id: 'first_module', icon: '🎯', name: 'First Steps', desc: 'أكمل الوحدة الأولى' },
      { id: 'predictor', icon: '🔮', name: 'Predictor', desc: 'قم بالتنبؤ الأول' },
      { id: 'correct_prediction', icon: '✨', name: 'Sharp Mind', desc: 'توقع بشكل صحيح' },
      { id: 'five_modules', icon: '📚', name: 'Scholar', desc: 'أكمل 5 وحدات' },
      { id: 'all_predictions', icon: '🎱', name: 'Oracle', desc: 'قم بجميع التنبؤات' },
      { id: 'streak_3', icon: '🔥', name: 'On Fire', desc: '3-day streak' },
      { id: 'quiz_master', icon: '🏆', name: 'Quiz Master', desc: 'أكمل 5 اختبارات' },
      { id: 'ready_practice', icon: '🚀', name: 'جاهز للتمرين', desc: 'أكمل وحدة Capstone' },
      { id: 'completionist', icon: '👑', name: 'Completionist', desc: 'أكمل جميع الوحدات' }
    ];

    // Level definitions
    const levels = [
      { name: 'Novice', minPoints: 0 },
      { name: 'Apprentice', minPoints: 200 },
      { name: 'Practitioner', minPoints: 500 },
      { name: 'Expert', minPoints: 1000 },
      { name: 'Master', minPoints: 2000 }
    ];

    // Gamification state
    let gameState = {
      points: 0,
      earnedBadges: [],
      streak: 0,
      lastVisitDate: null,
      principlesMastered: [],
      quizzesCompleted: 0
    };

    function getLevel(points) {
      for (let i = levels.length - 1; i >= 0; i--) {
        if (points >= levels[i].minPoints) return { level: i + 1, name: levels[i].name };
      }
      return { level: 1, name: 'Novice' };
    }

    function awardPoints(amount, reason) {
      gameState.points += amount;
      updateSidebarPoints();
      saveProgress();
    }

    function earnBadge(badgeId) {
      if (!gameState.earnedBadges.includes(badgeId)) {
        gameState.earnedBadges.push(badgeId);
        saveProgress();
      }
    }

    function checkBadges() {
      const completedModules = document.querySelectorAll('.module-item.completed').length;
      const predictionCount = Object.keys(storyPredictions).length;
      const correctPredictions = Object.values(storyPredictions).filter(p => p.correct).length;

      if (completedModules >= 1) earnBadge('first_module');
      if (completedModules >= 5) earnBadge('five_modules');
      if (completedModules >= 13) earnBadge('ready_practice');
      if (completedModules >= 15) earnBadge('completionist');
      if (predictionCount >= 1) earnBadge('predictor');
      if (correctPredictions >= 1) earnBadge('correct_prediction');
      if (predictionCount >= 11) earnBadge('all_predictions');
      if (gameState.streak >= 3) earnBadge('streak_3');
      if (gameState.quizzesCompleted >= 5) earnBadge('quiz_master');
    }

    function updateStreak() {
      const today = new Date().toDateString();
      if (gameState.lastVisitDate) {
        const lastVisit = new Date(gameState.lastVisitDate).toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        if (lastVisit === today) { /* Same day */ }
        else if (lastVisit === yesterday) { gameState.streak++; awardPoints(10, 'Daily streak'); }
        else { gameState.streak = 1; }
      } else { gameState.streak = 1; }
      gameState.lastVisitDate = new Date().toISOString();
    }

    function saveProgress() {
      const completedModules = [];
      document.querySelectorAll('.module-item.completed').forEach(el => {
        completedModules.push(parseInt(el.dataset.module));
      });

      const progress = {
        currentModule, currentSlide, completedModules,
        lastVisit: new Date().toISOString(),
        gameState: gameState,
        predictions: storyPredictions,
        spacedRepetition: spacedRepetitionState,
        scenarioState: scenarioState,
        calibrationState: calibrationState
      };

      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        updateSidebarPoints();
      } catch (e) { console.log('لا يمكن حفظ التقدم'); }
    }

    function loadProgress() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          const progress = JSON.parse(saved);
          progress.completedModules.forEach(moduleId => {
            const el = document.querySelector(`.module-item[data-module="${moduleId}"]`);
            if (el) el.classList.add('completed');
          });
          if (progress.gameState) gameState = progress.gameState;
          if (progress.predictions) Object.assign(storyPredictions, progress.predictions);
          if (progress.spacedRepetition) {
            spacedRepetitionState = progress.spacedRepetition;
          }
          if (progress.scenarioState) {
            scenarioState = progress.scenarioState;
          }
          if (progress.calibrationState) {
            calibrationState = progress.calibrationState;
          }
          updateStreak();
          updateSidebarPoints();
          if (progress.currentModule !== undefined) {
            return { module: progress.currentModule, slide: progress.currentSlide || 0 };
          }
        }
      } catch (e) { console.log('تعذر التحميل التقدم'); }
      return null;
    }

    function resetProgress() {
      if (confirm('هل تريد إعادة تعيين كل التقدم بما في ذلك النقاط والشارات؟')) {
        try {
          localStorage.removeItem(STORAGE_KEY);
          document.querySelectorAll('.module-item.completed').forEach(el => el.classList.remove('completed'));
          gameState = { points: 0, earnedBadges: [], streak: 0, lastVisitDate: null, principlesMastered: [], quizzesCompleted: 0 };
          storyPredictions = {};
          spacedRepetitionState = { principles: {}, lastDailyReview: null, dailyReviewsCompleted: 0 };
          scenarioState = { completed: [], scores: {} };
          calibrationState = { predictions: [], totalPredictions: 0, calibrationScore: null };
          updateSidebarPoints();
          updateReviewButtonStatus();
          goToModule(0);
          alert('تمت إعادة ضبط التقدم بنجاح.');
        } catch (e) { console.log('تعذرت إعادة ضبط التقدم'); }
      }
    }

    function markModuleComplete(moduleId) {
      const el = document.querySelector(`.module-item[data-module="${moduleId}"]`);
      if (el && !el.classList.contains('completed')) {
        el.classList.add('completed');
        awardPoints(100, 'Module completed');
        checkBadges();
      }
      saveProgress();
    }

    function updateSidebarPoints() {
      const el = document.getElementById('sidebarPoints');
      if (el) el.textContent = gameState.points + ' pts';
    }

    // ============================================================
    // PROGRESS DASHBOARD
    // ============================================================

    function openDashboard() {
      updateDashboardDisplay();
      document.getElementById('progressDashboard').classList.add('open');
    }

    function closeDashboard() {
      document.getElementById('progressDashboard').classList.remove('open');
    }

    function updateDashboardDisplay() {
      const levelInfo = getLevel(gameState.points);
      document.getElementById('levelBadge').textContent = `Level ${levelInfo.level}: ${levelInfo.name}`;
      document.getElementById('totalPoints').textContent = gameState.points;

      const completedModules = document.querySelectorAll('.module-item.completed').length;
      document.getElementById('modulesCompleted').textContent = `${completedModules}/15`;

      const predictionCount = Object.keys(storyPredictions).length;
      const correctPredictions = Object.values(storyPredictions).filter(p => p.correct).length;
      document.getElementById('predictionsCorrect').textContent = `${correctPredictions}/${predictionCount}`;
      document.getElementById('quizzesCompleted').textContent = gameState.quizzesCompleted;

      const principlesHtml = sevenPrinciples.map((p, i) => {
        const mastered = gameState.principlesMastered.includes(i);
        return `<div class="principle-item">
          <div class="المبدأ رقم ${mastered ? \"أتقن\" : ''}">${i + 1}</div>
          <div class="principle-text">"${p}"</div>
          <span>${mastered ? '✓' : ''}</span>
        </div>`;
      }).join('');
      document.getElementById('principlesList').innerHTML = principlesHtml;

      const badgesHtml = badges.map(b => {
        const earned = gameState.earnedBadges.includes(b.id);
        return `<div class="شارة ${حصلت؟ 'كسب' : ''}" title="${b.name}: ${b.desc}">
          ${b.icon}<div class="badge-tooltip">${b.name}</div>
        </div>`;
      }).join('');
      document.getElementById('badgesGrid').innerHTML = badgesHtml;

      document.getElementById('streakCount').textContent = `${gameState.streak} day${gameState.streak !== 1 ? 's' : ''}`;
      document.getElementById('streakFlame').textContent = gameState.streak >= 3 ? '🔥' : '💨';
    }

    // ============================================================
    // SPACED REPETITION ENGINE
    // ============================================================

    // Questions for each principle (used in daily review)
    const principleQuestions = [
      { // Principle 1: "ليست كل إشارة الحقيقة."
        principle: 0,
        question: "عندما يُظهر الدواء فوائد في الدراسات الرصدية، ما الذي يجب أن تتذكره؟",
        options: [
          "ربما تكون الفائدة حقيقية ويجب أن توجه العلاج",
          "ليست كل إشارة هي الحقيقة - هناك حاجة إلى التجارب المعشاة ذات الشواهد ل تأكيد",
          "الدراسات الرصدية متحيزة دائمًا وغير مجدية",
          "يجب علينا إجراء تحليل تلوي على الفور"
        ],
        correct: 1,
        explanation: "يمكن الخلط بين إشارات المراقبة. أظهر CAST أن مضادات اضطراب النظم، التي بدت مفيدة، ضاعفت معدل الوفيات ثلاث مرات في التجارب المعشاة ذات الشواهد."
      },
      { // Principle 2: "الطرق تحمي المرضى من ثقتنا."
        principle: 1,
        question: "لماذا نقوم بالتسجيل المسبق للبروتوكولات قبل إجراء التحليل التلوي؟",
        options: [
          "لإثارة إعجاب محرري المجلات",
          "طرق تحمي المرضى من ثقتنا",
          "إنه مطلوب بموجب القانون في معظم البلدان",
          "لتسريع عملية النشر"
        ],
        correct: 1,
        explanation: "يمنعنا التسجيل المسبق من انحياز النتائج دون وعي نحو ما نتوقعه. تأثرت دراسات العلاج التعويضي بالهرمونات الرصدية بتحيز المستخدم الصحي."
      },
      { // Principle 3: "ما الذي كان مخفيًا على مرأى من الجميع؟"
        principle: 2,
        question: "عند تقييم تحيز النشر، ما هو السؤال الذي يجب أن يوجه تفكيرك؟",
        options: [
          "هل المؤلفون ذوو سمعة طيبة؟",
          "هل للمجلة تأثير كبير؟",
          "ما الذي كان مخفيًا على مرأى من الجميع؟",
          "كم عدد الدراسات التي شملتها؟"
        ],
        correct: 2,
        explanation: "كانت المخاطر القلبية لروزيجليتازون مدفونة في بيانات إدارة الغذاء والدواء غير المنشورة. ابحث دائمًا خارج الأدبيات المنشورة للحصول على الصورة الكاملة."
      },
      { // Principle 4: "الرقم بدون مصدر ليس رقمًا."
        principle: 3,
        question: "ما الذي يجعل حجم التأثير جديرًا بالثقة في التحليل التلوي؟",
        options: [
          "أهميتها الإحصائية (p < 0.05)",
          "مصدر واضح - معرفة مصدرها بالضبط",
          "منشور في مجلة عالية التأثير",
          "اتفاق مع المعقولية البيولوجية"
        ],
        correct: 1,
        explanation: "أظهرت تجارب DECREASE بيانات ملفقة. بدون مصدر يمكن التحقق منه (بيانات أولية، مسار تدقيق)، لا يمكن الوثوق بالأرقام."
      },
      { // Principle 5: "التجانس رسالة وليس ضجيج."
        principle: 4,
        question: "عندما ترى عدم تجانس عالٍ (I² = 80%) في التحليل التلوي، ما الذي يجب أن تفكر فيه؟",
        options: [
          "لقد فشل التحليل التلوي ويجب التخلي عنه",
          "استخدم نموذج التأثيرات العشوائية وتجاهله",
          "إن عدم التجانس هو رسالة - ابحث عن مصادره",
          "قم بمتوسط النتائج على أي حال، هذا ما يفعله التحليل التلوي"
        ],
        correct: 2,
        explanation: "أظهر ACCORD أن التحكم المكثف في الجلوكوز كان له تأثيرات مختلفة في مجموعات فرعية مختلفة من المرضى. يشير ارتفاع I² إلى تعديل تأثير مهم."
      },
      { // Principle 6: "غياب الدليل ليس دليلا على الغياب."
        principle: 5,
        question: "يُظهر التحليل التلوي لثلاث تجارب صغيرة عدم وجود تأثير كبير (ع = 0.15). ماذا يعني هذا؟",
        options: [
          "العلاج بالتأكيد لا يعمل",
          "غياب الأدلة ليس دليلاً على الغياب",
          "نحتاج بالضبط إلى 5 تجارب أخرى للتأكد",
          "العلاج ضار"
        ],
        correct: 1,
        explanation: "قد تفتقر الدراسات الصغيرة إلى القدرة على اكتشاف التأثيرات الحقيقية. أظهرت تجارب الفاعل بالسطح المبكرة في البداية \"عدم وجود تأثير\" بسبب العينات الصغيرة، ولكن أثبتت الدراسات الأكبر فائدتها."
      },
      { // Principle 7: "يجب اكتساب اليقين وليس افتراضه."
        principle: 6,
        question: "ما الذي يساعدنا إطار عمل GRADE في تقييمه؟",
        options: [
          "ما إذا كان العلاج فعالاً من حيث التكلفة",
          "إلى أي مدى يمكننا أن نكون متأكدين من الأدلة",
          "ما إذا كان المؤلفون لديهم تضارب في المصالح",
          "حجم العينة الأمثل للتجارب المستقبلية"
        ],
        correct: 1,
        explanation: "يذكرنا GRADE بأنه يجب اكتساب اليقين من خلال أدلة عالية الجودة، وليس مفترضًا من الأهمية الإحصائية وحدها."
      }
    ];

    // Extended question bank for variety
    const extendedQuestions = [
      { principle: 0, question: "أظهرت تجربة CAST أن مضادات اضطراب النظم تزيد معدل الوفيات بنسبة:", options: ["50%", "100%", "200-300%", "400%"], correct: 2, explanation: "إنكاينيد، فليكاينيد، وموريسيزين تضاعف معدل الوفيات ثلاث مرات تقريبًا مقارنة بالعلاج الوهمي." },
      { principle: 1, question: "بدا العلاج التعويضي بالهرمونات مفيدًا في الدراسات الرصدية بسبب:", options: ["الخلط من خلال الإشارة", "تحيز المستخدم الصحي", "Publication bias", "Data fabrication"], correct: 1, explanation: "كانت النساء اللاتي اخترن العلاج التعويضي بالهرمونات أكثر صحة عند خط الأساس (تحيز المستخدم الصحي)، مما خلق فائدة واضحة." },
      { principle: 2, question: "ما هي النسبة المئوية للتجارب السلبية التي لا يتم نشرها غالبًا؟", options: ["10-20%", "30-40%", "40-50%", "60-80%"], correct: 2, explanation: "تقدر الدراسات أن 40-50% من التجارب ذات النتائج السلبية تظل غير منشورة، مما يشوه قاعدة الأدلة." },
      { principle: 3, question: "تم اكتشاف الاحتيال في تجارب DECREASE من خلال:", options: ["مراجعة النظراء", "Statistical impossibilities", "Journal retraction", "Patient complaints"], correct: 1, explanation: "كانت الأنماط في البيانات مستحيلة إحصائيًا - مثالية جدًا، وتكشف عن تلفيق." },
      { principle: 4, question: "ما هي قيمة I² التي تشير إلى عدم تجانس كبير؟", options: [">25%", ">50%", ">75%", ">90%"], correct: 1, explanation: "I² > 50% تشير إلى عدم تجانس كبير؛ > 75% نسبة كبيرة. تحقق دائمًا من المصادر." },
      { principle: 5, question: "يُظهر المخطط القمعي عدم التماثل. يشير هذا إلى ما يلي:", options: ["Perfect methodology", "أحجام عينات كبيرة", "التأثيرات المحتملة للدراسات الصغيرة (تحيز النشر هو أحد التفسيرات)", "High certainty"], correct: 2, explanation: "يمكن أن يشير عدم تناسق المخطط القمعي إلى تأثيرات الدراسات الصغيرة؛ إن تحيز النشر هو أحد التفسيرات، ولكنه ليس التفسير الوحيد." },
      { principle: 6, question: "في الصف، ما الذي يمكن أن يقلل من اليقين في أدلة التجارب المعشاة ذات الشواهد؟", options: ["حجم تأثير كبير", "خطر التحيز", "Dose-response gradient", "Biological plausibility"], correct: 1, explanation: "خطر التحيز، وعدم الدقة، وعدم الاتساق، وعدم المباشرة، والنشر. يمكن أن يؤدي التحيز إلى خفض مستوى اليقين من المستويات \"المرتفعة\" إلى المستويات الأدنى." }
    ];

    // SM-2 inspired spaced repetition state
    let spacedRepetitionState = {
      principles: {}, // { 0: { lastReview: Date, interval: days, easeFactor: 2.5, repetitions: 0, nextReview: Date } }
      lastDailyReview: null,
      dailyReviewsCompleted: 0
    };

    // Initialize spaced repetition for all principles
    function initSpacedRepetition() {
      for (let i = 0; i < 7; i++) {
        if (!spacedRepetitionState.principles[i]) {
          spacedRepetitionState.principles[i] = {
            lastReview: null,
            interval: 1,
            easeFactor: 2.5,
            repetitions: 0,
            nextReview: new Date().toISOString()
          };
        }
      }
    }

    // SM-2 algorithm: update interval based on performance
    function updateSpacedRepetition(principleIndex, quality) {
      // quality: 0-5 (0-2 = fail, 3-5 = pass)
      const p = spacedRepetitionState.principles[principleIndex];
      if (!p) return;

      if (quality >= 3) {
        // Correct answer
        if (p.repetitions === 0) {
          p.interval = 1;
        } else if (p.repetitions === 1) {
          p.interval = 6;
        } else {
          p.interval = Math.round(p.interval * p.easeFactor);
        }
        p.repetitions++;
        p.easeFactor = Math.max(1.3, p.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02)));

        // Mark as mastered after 3 successful reviews
        if (p.repetitions >= 3 && !gameState.principlesMastered.includes(principleIndex)) {
          gameState.principlesMastered.push(principleIndex);
          awardPoints(50, 'Principle mastered');
          earnBadge('principle_master');
        }
      } else {
        // Incorrect answer - reset
        p.repetitions = 0;
        p.interval = 1;
      }

      p.lastReview = new Date().toISOString();
      p.nextReview = new Date(Date.now() + p.interval * 24 * 60 * 60 * 1000).toISOString();
      saveProgress();
    }

    // Get principles due for review (sorted by urgency)
    function getPrinciplesDueForReview() {
      const now = new Date();
      const due = [];

      for (let i = 0; i < 7; i++) {
        const p = spacedRepetitionState.principles[i];
        if (!p) continue;

        const nextReview = p.nextReview ? new Date(p.nextReview) : new Date(0);
        if (nextReview <= now) {
          due.push({
            index: i,
            overdueDays: Math.floor((now - nextReview) / (24 * 60 * 60 * 1000)),
            repetitions: p.repetitions
          });
        }
      }

      // Sort: most overdue first, then least practiced
      due.sort((a, b) => {
        if (b.overdueDays !== a.overdueDays) return b.overdueDays - a.overdueDays;
        return a.repetitions - b.repetitions;
      });

      return due;
    }

    // ============================================================
    // DAILY REVIEW SYSTEM
    // ============================================================

    let reviewState = {
      active: false,
      questions: [],
      currentIndex: 0,
      answers: [],
      timerInterval: null,
      timeRemaining: 120 // 2 minutes in seconds
    };

    function shouldShowDailyReview() {
      if (!spacedRepetitionState.lastDailyReview) return true;

      const lastReview = new Date(spacedRepetitionState.lastDailyReview);
      const today = new Date();

      // Check if it's a new day
      return lastReview.toDateString() !== today.toDateString();
    }

    function openDailyReview() {
      initSpacedRepetition();

      // Get principles due for review
      const duePrinciples = getPrinciplesDueForReview();

      // Select up to 5 questions (mix of due principles and random for variety)
      let selectedQuestions = [];

      // First, add questions for due principles
      duePrinciples.slice(0, 3).forEach(dp => {
        const available = [principleQuestions[dp.index], ...extendedQuestions.filter(q => q.principle === dp.index)];
        const randomQ = available[Math.floor(Math.random() * available.length)];
        if (randomQ && !selectedQuestions.find(q => q.question === randomQ.question)) {
          selectedQuestions.push({ ...randomQ });
        }
      });

      // Fill remaining with random questions
      const allQuestions = [...principleQuestions, ...extendedQuestions];
      while (selectedQuestions.length < 5) {
        const randomQ = allQuestions[Math.floor(Math.random() * allQuestions.length)];
        if (!selectedQuestions.find(q => q.question === randomQ.question)) {
          selectedQuestions.push({ ...randomQ });
        }
      }

      // Shuffle
      selectedQuestions.sort(() => Math.random() - 0.5);

      // Initialize review state
      reviewState = {
        active: true,
        questions: selectedQuestions.slice(0, 5),
        currentIndex: 0,
        answers: [],
        timerInterval: null,
        timeRemaining: 120
      };

      // Show modal
      document.getElementById('dailyReviewModal').classList.add('open');

      // Render progress dots
      renderReviewProgress();

      // Render first question
      renderReviewQuestion();

      // Start timer
      startReviewTimer();
    }

    function closeDailyReview() {
      reviewState.active = false;
      if (reviewState.timerInterval) {
        clearInterval(reviewState.timerInterval);
      }
      document.getElementById('dailyReviewModal').classList.remove('open');
    }

    function skipDailyReview() {
      spacedRepetitionState.lastDailyReview = new Date().toISOString();
      saveProgress();
      closeDailyReview();
      updateReviewButtonStatus();
    }

    function startReviewTimer() {
      const timerEl = document.getElementById('reviewTimer');

      reviewState.timerInterval = setInterval(() => {
        reviewState.timeRemaining--;

        const mins = Math.floor(reviewState.timeRemaining / 60);
        const secs = reviewState.timeRemaining % 60;
        timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;

        if (reviewState.timeRemaining <= 0) {
          clearInterval(reviewState.timerInterval);
          finishDailyReview();
        }
      }, 1000);
    }

    function renderReviewProgress() {
      const container = document.getElementById('reviewProgress');
      container.innerHTML = reviewState.questions.map((_, i) => {
        let cls = 'progress-dot'; إذا (i < reviewState.currentIndex) cls +=' completed'; إذا (i === reviewState.currentIndex) cls +=' current';
        return `<div class="${cls}"></div>`;
      }).join('');
    }

    function renderReviewQuestion() {
      if (reviewState.currentIndex >= reviewState.questions.length) {
        finishDailyReview();
        return;
      }

      const q = reviewState.questions[reviewState.currentIndex];
      const container = document.getElementById('reviewCardContainer');

      container.innerHTML = `
        <div class="review-card">
          <div class="review-principle-num">${q.principle + 1}</div>
          <div class="review-principle-text">"${sevenPrinciples[q.principle]}"</div>
          <div class="review-question">${q.question}</div>
          <div class="review-options">
            ${q.options.map((opt, i) => `
              <button class="review-option" onclick="selectReviewAnswer(${i})">${opt}</button>
            `).join('')}
          </div>
          <div id="reviewFeedback"></div>
        </div>
      `;

      document.getElementById('reviewNextBtn').disabled = true;
    }

    function selectReviewAnswer(answerIndex) {
      const q = reviewState.questions[reviewState.currentIndex];
      const isCorrect = answerIndex === q.correct;

      // Store answer
      reviewState.answers.push({
        principle: q.principle,
        correct: isCorrect,
        selected: answerIndex
      });

      // Update spaced repetition
      updateSpacedRepetition(q.principle, isCorrect ? 4 : 1);

      // Award points
      if (isCorrect) {
        awardPoints(15, 'Daily review correct');
      }

      // Visual feedback
      const options = document.querySelectorAll('.review-option');
      options.forEach((opt, i) => {
        opt.disabled = true;
        opt.style.cursor = 'default';
        if (i === q.correct) {
          opt.classList.add('correct');
        }
        if (i === answerIndex && !isCorrect) {
          opt.classList.add('incorrect');
        }
        if (i === answerIndex) {
          opt.classList.add('selected');
        }
      });

      // Show feedback
      const feedbackEl = document.getElementById('reviewFeedback'); ردود الفعلEl.innerHTML = ` <div class="review-feedback ${isCorrect ?'correct' : 'incorrect'}">
          ${isCorrect ? '✓ Correct!' : '✗ Not quite.'} ${q.explanation}
        </div>
      `;

      // Enable next button
      document.getElementById('reviewNextBtn').disabled = false;
    }

    function nextReviewQuestion() {
      reviewState.currentIndex++;
      renderReviewProgress();
      renderReviewQuestion();
    }

    function finishDailyReview() {
      if (reviewState.timerInterval) {
        clearInterval(reviewState.timerInterval);
      }

      const correctCount = reviewState.answers.filter(a => a.correct).length;
      const totalCount = reviewState.answers.length;
      const score = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;

      // Update state
      spacedRepetitionState.lastDailyReview = new Date().toISOString();
      spacedRepetitionState.dailyReviewsCompleted++;
      gameState.quizzesCompleted++;
      saveProgress();
      checkBadges();

      // Award bonus for perfect score
      if (correctCount === totalCount && totalCount > 0) {
        awardPoints(25, 'Perfect daily review');
        earnBadge('perfect_review');
      }

      // Show summary
      const container = document.getElementById('reviewCardContainer'); Container.innerHTML = ` <div class="review-summary"> <div class="summary-score">${score}%</div> <div class="summary-text">اكتملت المراجعة اليومية!</div> <div class="summary-breakdown"> <div class="summary-stat"> <div class="summary-stat-value Correct-val">${correctCount}</div> <div class="summary-stat-label">صحيح</div> </div> <div class="summary-stat"> <div class="summary-stat-value غير صحيح-val">${totalCount - صحيحالعد</div> <div class="summary-stat-label">للمراجعة</div> </div> </div> ${gameState.streak >= 2 ` <div class="review-streak-bonus"> <span class="flame">🔥</span> <span class="text">${gameState.streak} خط التعلم اليومي!</span> </div> ` :''}
        </div>
      `;

      // Update actions
      document.getElementById('reviewActions').innerHTML = `
        <button class="review-btn next" onclick="closeDailyReview()">Continue Learning</button>
      `;

      updateReviewButtonStatus();
    }

    function updateReviewButtonStatus() {
      const btn = document.getElementById('dailyReviewBtn');
      const status = document.getElementById('reviewStatus');

      if (!btn || !status) return;

      if (shouldShowDailyReview()) {
        btn.classList.add('pending');
        status.textContent = 'Due!';
      } else {
        btn.classList.remove('pending');
        status.textContent = '✓ Done';
      }
    }

    // Add badge for spaced repetition mastery
    if (!badges.find(b => b.id === 'principle_master')) { Badges.push({ المعرف:'principle_master', icon: '🎓', name: 'Principle Master', desc: 'Master a principle through spaced repetition' });
    }
    if (!badges.find(b => b.id === 'perfect_review')) { Badges.push({ المعرف:'perfect_review', icon: '💯', name: 'Perfect Review', desc: 'Get 100% on a daily review' });
    }
    if (!badges.find(b => b.id === 'daily_dedication')) { Badges.push({ المعرف:'daily_dedication', icon: '📅', name: 'Daily Dedication', desc: 'Complete 7 daily reviews' });
    }
    if (!badges.find(b => b.id === 'scenario_solver')) { Badges.push({ المعرف:'scenario_solver', icon: '🧩', name: 'Scenario Solver', desc: 'Complete 5 branching scenarios' });
    }
    if (!badges.find(b => b.id === 'well_calibrated')) { Badges.push({ المعرف:'well_calibrated', icon: '🎯', name: 'Well Calibrated', desc: 'Achieve 80%+ calibration accuracy' });
    }

    // ============================================================
    // BRANCHING SCENARIOS SYSTEM
    // ============================================================

    // Scenarios based on Evidence Reversal stories - decisions with consequences
    const branchingScenarios = [
      {
        id: 'cast_scenario',
        module: 1,
        title: 'The Antiarrhythmic Decision'، الحالة: "أنت're on a hospital formulary committee in 1988. A cardiologist presents data showing encainide suppresses PVCs by 80% in post-MI patients. He wants it added to the formulary for routine use."، سؤال:"What do you recommend?"الاختيارات: [ {المعرف: 'أ'، النص:"Approve it - PVC suppression is a validated surrogate for mortality"النتيجة: \"سيئة\"، النتيجة:"The CAST trial (1989) showed these drugs TRIPLED mortality despite suppressing PVCs. 50,000+ patients died from drugs that 'worked' on the surrogate." },
          { id: 'b', text: "Request RCT evidence on hard outcomes (death, cardiac arrest) before approval"، النتيجة: \"جيدة\"، النتيجة:"Correct! Surrogate endpoints can mislead. The relationship between PVC suppression and survival was never proven - and turned out to be the opposite of expected." },
          { id: 'c', text: "Approve for low-risk patients only"النتيجة: \"سيئة\"، النتيجة:"Still wrong. Without mortality data, you can'لا أعرف أي المرضى قد يتعرضون للأذى. أظهر CAST ضررًا عبر المجموعات الفرعية." } ]، صحيح:'b'المبدأ: 0، الدرس: "ليست كل إشارة هي الحقيقة. يجب التحقق من صحة البدائل مقابل النتائج الصعبة قبل اتخاذ قرارات العلاج." }، { بطاقة تعريف:'hrt_scenario',
        module: 2,
        title: 'The HRT Recommendation'، الحالة: "إنها's 1998. A postmenopausal woman asks about hormone replacement therapy. You have 30+ observational studies showing 40-50% reduction in heart disease. No large RCTs exist yet."، سؤال:"What do you tell her?"الاختيارات: [ {المعرف: 'أ'، النص:"Recommend HRT strongly - the observational evidence is overwhelming"النتيجة: \"سيئة\"، النتيجة:"The WHI trial (2002) showed HRT INCREASED heart disease (HR 1.29). The observational benefit was confounded by healthy user bias - women who chose HRT were healthier at baseline." },
          { id: 'b', text: "Explain the uncertainty - observational data may be confounded, wait for RCT results"، النتيجة: \"جيدة\"، النتيجة:"Correct! You appropriately communicated uncertainty. The WHI proved the observational signal was misleading due to confounding." },
          { id: 'c', text: "Recommend HRT but only for women with risk factors"النتيجة: \"سيئة\"، النتيجة:"Still problematic. Targeting 'high-risk' women doesn'إصلاح الارتباك - قد يؤدي إلى تركيز الضرر." } ]، صحيح:'b'المبدأ: 1 الدرس: "الطرق تحمي المرضى من ثقتنا. الارتباطات الرصدية ليست دليلاً سببيًا." }، { بطاقة تعريف:'rosi_scenario',
        module: 3,
        title: 'The Hidden Trials'، الحالة: "أنت're conducting a meta-analysis of rosiglitazone for diabetes in 2006. You'لقد وجدت 12 تجربة منشورة. ذكر أحد الزملاء أن إدارة الغذاء والدواء قد يكون لديها بيانات غير منشورة."، سؤال: "ماذا تفعل؟"، الاختيارات: [ { id:'a', text: "تابع التجارب المنشورة فقط - من الصعب جدًا الحصول على البيانات غير المنشورة"، النتيجة:'bad', result: "Nissen's 2007 meta-analysis found the unpublished GSK trials. Including them revealed a 43% increased MI risk (OR 1.43) that wasn'لا يظهر في البيانات المنشورة وحدها." }, {id:'b'، نص: "ملف طلبات قانون حرية المعلومات، ابحث في ClinicalTrials.gov، اتصل بالشركة المصنعة"، النتيجة:'good'، النتيجة: "صحيح! يعد البحث في الأدبيات الرمادية أمرًا ضروريًا. لقد تم إخفاء إشارة القلب من الروزيجليتازون في التقارير التنظيمية غير المنشورة لسنوات." }، { بطاقة تعريف:'c', text: "أضف تحليل الحساسية بافتراض وجود تجارب غير منشورة"، النتيجة:'neutral'النتيجة: "أفضل من لا شيء، لكنه ليس كافيًا. يمكنك ذلك't model what you haven'حاولت العثور على. البحث النشط مطلوب." } ]، صحيح:'b'، المبدأ: 2، الدرس: "ما الذي كان مخفيًا على مرأى من الجميع؟ البحث الشامل خارج نطاق الأدبيات المنشورة مطلوب منهجيًا." }، { بطاقة تعريف:'decrease_scenario',
        module: 5,
        title: 'The Suspicious Pattern'، الحالة: "أنت're verifying extracted data for a meta-analysis. One prominent researcher'تُظهر تجارب s تأثيرات متسقة بشكل ملحوظ (I² = 0%) بينما تظهر التجارب الأخرى عدم تجانس عالٍ. معدلات أحداثه متوازنة بشكل غير عادي."، السؤال: "ماذا تفعل؟"، الاختيارات: [ { id:'a', text: "اقبل البيانات - عدم التجانس المنخفض أمر جيد، وهو's a respected researcher"النتيجة: \"سيئة\"، النتيجة:"Don Poldermans'تم اكتشاف أن تجارب DECREASE ملفقة لاحقًا. ال'perfect'كان الاتساق بمثابة علامة حمراء - فالبيانات الحقيقية أكثر فوضوية. لقد أثر احتياله على المبادئ التوجيهية لسنوات." }, {id:'b', text: "اطلب المستندات المصدرية وتأكد من الأرقام مقابل المنشورات الأصلية"، النتيجة:'good'، النتيجة: "صحيح! كشف التحقق من المصدر عن عملية الاحتيال. وعندما تتبع المحققون أرقامه حتى المصدر، لم يتمكن المرضى من العثور عليها't exist. 800,000 may have been harmed by guidelines built on his fabrications." },
          { id: 'c', text: "Conduct sensitivity analysis excluding his studies"، النتيجة: \"محايدة\"، النتيجة:"Helpful but insufficient. You should verify first - if fraud is suspected, exclusion should be justified by evidence, not suspicion."} ]، الصحيح: 'ب'، المبدأ: ٣، الدرس:"The number without provenance is not a number. Every data point needs verification to its source."}، { المعرف: 'سيناريو_التغاير'، الوحدة: 8، العنوان: 'معضلة I²'، الموقف:"Your meta-analysis of intensive glucose control shows a pooled HR of 0.91 (95% CI 0.84-0.99) for cardiovascular events, but I² = 78%. The ACCORD trial shows harm (HR 1.22) while others show benefit."، سؤال:"How do you report this?"الاختيارات: [ {المعرف: 'أ'، النص:"Report the pooled estimate - it'ذات دلالة إحصائية وتفضل العلاج"، النتيجة:'bad'النتيجة: "خطير! عدم التجانس العالي يعني أن التقدير المجمع ليس كذلك't represent reality. ACCORD showed that intensive control INCREASED mortality in some patients. Reporting only the average hides life-threatening subgroup effects." },
          { id: 'b', text: "Investigate heterogeneity sources, report subgroup differences prominently"، النتيجة: \"جيدة\"، النتيجة:"Correct! ACCORD found that intensive control harmed patients with long diabetes duration and cardiovascular disease. The 'average' benefit masked deadly harm in specific subgroups." },
          { id: 'c', text: "Use random effects and report wider confidence intervals"، النتيجة: \"محايدة\"، النتيجة:"Technically correct but misses the point. Random effects accounts for heterogeneity statistically but doesn'لا تفسر ذلك سريريا. تحتاج إشارة ضرر ACCORD إلى التحقيق، وليس إلى التجانس الإحصائي." } ]، صحيح:'b'، المبدأ: 4، الدرس: "عدم التجانس هو رسالة، وليس ضجيج. ارتفاع I² يتطلب التحقيق، وليس مجرد التعديل الإحصائي." }، { بطاقة تعريف:'orbita_scenario',
        module: 4,
        title: 'The Sham Surgery Question'، الحالة: "إنها's 2015. You'إعادة تصميم تجربة PCI للذبحة الصدرية المستقرة. وتظهر التجارب السابقة غير المعماة تحسنا في الأعراض. يقترح أحد الإحصائيين استخدام إجراء زائف (القسطرة بدون دعامات) كعنصر تحكم."، سؤال: "ماذا's your response?"الاختيارات: [ {المعرف: 'أ'، النص:"Reject sham control - it'من غير الأخلاقي القيام بإجراء جراحي دون فائدة"، النتيجة:'bad'النتيجة: "استخدمت تجربة ORBITA (2017) التحكم الوهمي ولم تجد أي اختلاف في وقت التمرين (16.6 ثانية، 95% CI -8.9 إلى 42.0). بدون العلاج الوهمي، لكان من الممكن الخلط بين تأثير العلاج الوهمي لـ PCI وتأثير العلاج." }، { بطاقة تعريف:'b', text: "دعم التحكم الوهمي - بدون التعمية، يمكننا ذلك't distinguish placebo from treatment effect"، النتيجة: \"جيدة\"، النتيجة:"Correct! ORBITA revolutionized cardiology by showing that much of PCI'وكانت فائدة العلاج في الذبحة الصدرية المستقرة هي تأثير الدواء الوهمي. كان التحكم الوهمي ضروريًا للكشف عن هذا." }, {id:'c'، نص: "استخدم نقاط النهاية الموضوعية مثل احتشاء عضلة القلب أو الموت بدلاً من الأعراض"، النتيجة:'neutral'النتيجة: "هذه الأمور مهمة ولكن الشجاعة لم تظهر بالفعل أي فائدة للوفيات. وكان السؤال هو ما إذا كان تحسن الأعراض حقيقيًا - ويمكن فقط للتحكم الوهمي أن يجيب على ذلك." } ]، صحيح:'b'، المبدأ: 1، الدرس: "الطرق تحمي المرضى من ثقتنا. الضوابط الزائفة تكشف ما لا تستطيع التجارب غير المعماة كشفه." }، { بطاقة تعريف:'prowess_scenario',
        module: 6,
        title: 'The Single Positive Trial'، الحالة: "إنها's 2002. The PROWESS trial shows activated protein C reduces sepsis mortality (RR 0.81, p=0.005). The manufacturer seeks FDA approval. You'إعادة إلى اللجنة الاستشارية."، السؤال: "بماذا تنصح؟"، الاختيارات: [ {id:'a'، نص: "الموافقة فورًا - التجربة كبيرة وذات دلالة إحصائية"، النتيجة:'bad'النتيجة: "لم يجد PROWESS-SHOCK (2012) أي فائدة (RR 1.09، 95% CI 0.92-1.28) وضرر للنزيف. تم سحب الدواء بعد 10 سنوات من الاستخدام. التجارب الفردية، مهما كانت مثيرة للإعجاب، تحتاج إلى تكرار." }، { بطاقة تعريف:'b'، نص: "يتطلب إجراء محاكمة تأكيدية قبل الحصول على موافقة واسعة النطاق"، النتيجة:'good'، النتيجة: "صحيح! النسخ المتماثل ضروري. من المحتمل أن يكون PROWESS نتيجة إيجابية كاذبة أو متأثرًا بمشكلات تتعلق بإجراء التجربة. كان من الممكن أن تمنع التجربة التأكيدية سنوات من الاستخدام غير الملائم." }، { بطاقة تعريف:'c', text: "الموافقة مع مراقبة ما بعد التسويق"، النتيجة:'neutral'، النتيجة: "غير كافية. نادرًا ما تولد مراقبة ما بعد التسويق جودة الأدلة اللازمة لإلغاء الموافقات. كانت هناك حاجة إلى تجربة تأكيدية مناسبة." } ]، صحيح:'b'، المبدأ: 5، الدرس: "غياب دليل التكرار ليس دليلاً على الفعالية. التجارب الفردية لا تتوج العلاجات." }، { بطاقة تعريف:'egdt_scenario',
        module: 7,
        title: 'The Landmark Replication'، الوضع: "أظهرت تجربة Rivers EGDT (2001) انخفاضًا كبيرًا في معدل الوفيات في الإنتان. بحلول عام 2014، لم تظهر ثلاث تجارب تكرار كبيرة (ProCESS، ARISE، ProMISe) أي فائدة. كيف تفسر هذا؟"، سؤال: "ماذا's your conclusion?"الاختيارات: [ {المعرف: 'أ'، النص:"Rivers was wrong - EGDT doesn't work", consequence: 'neutral'، النتيجة: "صحيح جزئيًا ولكنه يفتقد الفروق الدقيقة. كانت الأنهار كذلك't necessarily 'wrong' - the context changed. Usual care in 2014 was much better than 2001. The comparison groups differed dramatically." },
          { id: 'b', text: "Usual care improved so much that EGDT'اختفت الميزة"، النتيجة:'good'النتيجة: "صحيح! هذا هو'secular trend'- تلقت المجموعة الضابطة في عام 2014 الرعاية التي تتضمن مبادئ EGDT. تم تخفيف تأثير التدخل من خلال الممارسة القياسية المحسنة." }, {id:'c', text: "تم إجراء تجارب التكرار على مجموعات سكانية مختلفة"، النتيجة:'neutral'النتيجة: "صحيح ولكنه غير كامل. الاختلافات السكانية (الصلاحية الخارجية) لا't fully explain why EGDT failed in multiple countries. The secular trend in usual care quality is the key factor."} ]، الصحيح: 'ب'، المبدأ: ٥، الدرس:"Context matters. Treatments that worked against outdated usual care may show no benefit when standards improve."}، { المعرف: 'grade_scenario'، الوحدة: 10، العنوان: 'تقييم اليقين'، الحالة:"You'إعادة تقييم يقين الأدلة للتحكم المكثف في ضغط الدم. لديك تجارب معشاة ذات شواهد تظهر فائدة (SPRINT)، لكنها استبعدت مرضى السكر واستخدمت ضغط الدم المكتبي الآلي. يتضمن مجتمعك مرضى السكر ويستخدمون ضغط الدم اليدوي. "، سؤال: "كيف تقيم مستوى اليقين بالنسبة لمجموعة المبادئ التوجيهية الخاصة بك؟"، الاختيارات: [ { id:'a'، نص: "درجة عالية من اليقين - SPRINT كانت عبارة عن تجربة معشاة ذات شواهد تم إجراؤها بشكل جيد"، النتيجة:'bad'، النتيجة: "خطأ! يتطلب GRADE تصنيفًا لعدد سكانك. SPRINT's results don'لا تنطبق مباشرة على مرضى السكر (مستبعدين) أو العيادات التي تستخدم قياس ضغط الدم اليدوي (الذي يقرأ أعلى بمقدار 10 مم زئبق تقريبًا). هذه هي اللامبالاة." }, {المعرف:'b'، نص: "التخفيض لعدم المباشرة - يختلف السكان والقياسات"، النتيجة:'good'، النتيجة: "صحيح! استبعد SPRINT مرضى السكري (أظهر ACCORD ضررًا لدى مرضى السكر!) واستخدم ضغط الدم الآلي (قراءات أقل من اليدوية). إن تطبيق أهداف SPRINT مع ضغط الدم اليدوي سيؤدي إلى المبالغة في علاج المرضى." }، { بطاقة تعريف:'c'، نص: "يقين معتدل - بعض عدم اليقين ولكن التجارب المعشاة ذات الشواهد هي المعيار الذهبي"، النتيجة:'neutral'النتيجة: "ليست محددة بما فيه الكفاية. أنت بحاجة إلى تحديد سبب ذلك're downgrading. Indirectness in population (diabetics excluded) and intervention (BP measurement method) requires explicit acknowledgment."} ]، الصحيح: 'ب'، المبدأ: ٦، الدرس:"Certainty must be earned for YOUR population. Direct evidence beats indirect evidence, regardless of study design."}، { المعرف: 'funnel_scenario'، الوحدة: 9، العنوان: 'المسار غير المتماثل'، الحالة:"Your funnel plot for a surgical intervention shows marked asymmetry - small studies cluster on the positive side, large studies near the null. Egger'اختبار s p=0.02."، السؤال: "كيف يمكنك المتابعة؟"، الاختيارات: [ {id:'a'، نص: "تطبيق القطع والتعبئة لضبط التقدير المجمع"، النتيجة:'neutral'النتيجة: "القص والتعبئة هو تحليل حساسية، وليس إصلاحًا. فهو يفترض أن عدم التماثل هو تحيز نشر خالص، ولكن قد تكون تأثيرات الدراسات الصغيرة أيضًا بسبب اختيار المريض، أو إخلاص التدخل، أو عدم التجانس الحقيقي." }، { بطاقة تعريف:'b'، النص: "أبلغ عن عدم التماثل، واستكشف الأسباب، وقدم مع أو بدون دراسات صغيرة"، النتيجة:'good'، النتيجة: "صحيح! عدم تناسق المسار له أسباب متعددة: تحيز النشر، أو عدم التجانس الحقيقي، أو اختلاف مجموعات المرضى في الدراسات الصغيرة مقابل الدراسات الكبيرة. يعد الإبلاغ الشفاف عن جميع الاحتمالات أمرًا ضروريًا." }، { بطاقة تعريف:'c', text: "استبعاد الدراسات الصغيرة لأنها're likely biased"النتيجة: \"سيئة\"، النتيجة:"Arbitrary exclusion creates its own bias. Small studies might represent different populations where the treatment truly works better. Investigation, not exclusion, is the answer."} ]، الصحيح: 'ب'، المبدأ: ٢، الدرس:"What was hidden in plain sight? Funnel asymmetry reveals problems but doesn't specify the cause. Investigation is required."
      }
    ];

    // Track scenario completions
    let scenarioState = {
      completed: {},
      confidenceRatings: []
    };

    function renderScenario(scenarioId, containerId) {
      const scenario = branchingScenarios.find(s => s.id === scenarioId);
      if (!scenario) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      const isCompleted = scenarioState.completed[scenarioId];

      container.innerHTML = `
        <div class="scenario-panel" id="scenario-${scenarioId}">
          <div class="scenario-header">
            <span class="scenario-icon">🔀</span>
            <span class="scenario-title">${scenario.title}</span>
          </div>
          <div class="scenario-situation">${scenario.situation}</div>
          <div class="scenario-question">${scenario.question}</div>
          <div class="scenario-choices">
            ${scenario.choices.map(c => `
              <div class="scenario-choice ${isCompleted ? 'answered' : ''} ${isCompleted && c.id ===سيناريو.تصحيح ؟'correct' : ''} ${isCompleted &&سيناريوState.Completed[scenarioId] === c.id && c.id !==سيناريو.correct ?'incorrect' : ''}"
                   onclick="${isCompleted ? '' : `selectScenarioChoice('${scenarioId}', '${c.id}')`}">
                <span class="choice-letter">${c.id.toUpperCase()}</span>
                <span class="choice-text">${c.text}</span>
              </div>
            `).join('')}
          </div>
          <div class="scenario-consequence ${isCompleted ? 'visible' : ''} ${isCompleted ? scenario.choices.find(c => c.id === scenarioState.completed[scenarioId])?.consequence || '' : ''}" id="consequence-${scenarioId}"> ${isCompleted ? renderConsequence(scenario, sceneState.Completed[scenarioId]) :''}
          </div>
        </div>
      `;
    }

    function renderConsequence(scenario, choiceId) {
      const choice = scenario.choices.find(c => c.id === choiceId);
      const isCorrect = choiceId === scenario.correct;
      return `
        <div class="consequence-title">
          ${isCorrect ? '✓ Good decision!' : '✗ Problematic decision'}
        </div>
        <div class="consequence-text">${choice.result}</div>
        <div class="consequence-lesson"><strong>Principle ${scenario.principle + 1}:</strong> ${scenario.lesson}</div>
      `;
    }

    function selectScenarioChoice(scenarioId, choiceId) {
      const scenario = branchingScenarios.find(s => s.id === scenarioId);
      if (!scenario || scenarioState.completed[scenarioId]) return;

      scenarioState.completed[scenarioId] = choiceId;

      // Award points
      if (choiceId === scenario.correct) {
        awardPoints(30, 'Correct scenario decision');
      } else {
        awardPoints(10, 'Scenario attempted');
      }

      // Check for badge
      const completedCount = Object.keys(scenarioState.completed).length;
      if (completedCount >= 5) {
        earnBadge('scenario_solver');
      }

      saveProgress();

      // Re-render with answer shown
      const container = document.getElementById(`scenario-${scenarioId}`)?.parentElement;
      if (container) {
        renderScenario(scenarioId, container.id);
      }
    }

    // ============================================================
    // CONFIDENCE CALIBRATION SYSTEM
    // ============================================================

    let calibrationState = {
      predictions: [], // { confidence: 0-100, correct: boolean }
      totalPredictions: 0,
      calibrationScore: null
    };

    function addConfidenceToPredict(containerId) {
      const container = document.getElementById(containerId);
      if (!container) return;

      const existingSection = container.querySelector('.confidence-section');
      if (existingSection) return;

      const section = document.createElement('div');
      section.className = 'confidence-section';
      section.innerHTML = `
        <div class="confidence-label">How confident are you in your prediction?</div>
        <div class="confidence-slider-container">
          <input type="range" class="confidence-slider" min="0" max="100" value="50"
                 oninput="updateConfidenceDisplay(this)">
          <span class="confidence-value">50%</span>
        </div>
        <div class="confidence-labels">
          <span>Guessing</span>
          <span>Very sure</span>
        </div>
      `;
      container.appendChild(section);
    }

    function updateConfidenceDisplay(slider) {
      const value = slider.value;
      slider.nextElementSibling.textContent = value + '%';
    }

    function recordConfidence(confidence, wasCorrect) {
      calibrationState.predictions.push({ confidence, correct: wasCorrect });
      calibrationState.totalPredictions++;
      calculateCalibrationScore();
      saveProgress();
    }

    function calculateCalibrationScore() {
      if (calibrationState.predictions.length < 5) {
        calibrationState.calibrationScore = null;
        return;
      }

      // Group predictions by confidence bands
      const bands = { low: [], mid: [], high: [] };
      calibrationState.predictions.forEach(p => {
        if (p.confidence < 40) bands.low.push(p);
        else if (p.confidence < 70) bands.mid.push(p);
        else bands.high.push(p);
      });

      // Calculate accuracy per band
      const bandAccuracy = {};
      Object.keys(bands).forEach(band => {
        if (bands[band].length > 0) {
          const correct = bands[band].filter(p => p.correct).length;
          bandAccuracy[band] = correct / bands[band].length;
        }
      });

      // Perfect calibration: high confidence = high accuracy, low confidence = low accuracy
      // Score: 100 - average absolute deviation from expected
      let totalDeviation = 0;
      let count = 0;

      if (bands.high.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.high || 0) - 0.85) * 100;
        count++;
      }
      if (bands.mid.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.mid || 0) - 0.55) * 100;
        count++;
      }
      if (bands.low.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.low || 0) - 0.25) * 100;
        count++;
      }

      calibrationState.calibrationScore = count > 0 ? Math.max(0, 100 - (totalDeviation / count)) : null;

      // Award badge for good calibration
      if (calibrationState.calibrationScore >= 80) {
        earnBadge('well_calibrated');
      }
    }

    // ============================================================
    // ENHANCED ANALOGY SYSTEM
    // ============================================================

    const conceptAnalogies = {
      'heterogeneity': {
        icon: '🎻',
        title: 'Orchestra Tuning',
        concept: 'I² (Heterogeneity)', text: "مثل ضبط نغمة الأوركسترا - يكون بعض الاختلاف أمرًا طبيعيًا ومتوقعًا. ولكن إذا تم عزف آلات الكمان بمفاتيح مختلفة، فسيكون هناك شيء ما's wrong. High I² means your studies aren'لا أعزف نفس النغمة." },'publication_bias': {
        icon: '🧦',
        title: 'Missing Socks',
        concept: 'Publication Bias', text: "مثل الجوارب في الغسيل - أنت تعلم أن الأزواج دخلت، لكن النتائج الإيجابية فقط هي التي ظهرت. التجارب السلبية المفقودة تشبه تلك الجوارب المفردة التي اختفت. مؤامرة القمع غير المتماثلة تكشف الفجوة." },'forest_plot': {
        icon: '⚖️',
        title: 'Jury of Studies',
        concept: 'Forest Plot'، نص: "كل دراسة عبارة عن هيئة محلفين تصدر حكمًا. بعضها أكثر يقينًا (CI الضيق)، وبعضها أقل. الماس هو هيئة المحلفين's consensus - but if jurors wildly disagree (heterogeneity), should you trust the average verdict?"}, 'funnel_plot': { icon: '🔦'، العنوان: 'Flashlight Beam'، المفهوم: 'Funnel Plot'، النص:"A flashlight should illuminate evenly in all directions. An asymmetric funnel plot is like a flashlight with something blocking one side - you'إعادة لا ترى الصورة الكاملة. الدراسات الصغيرة من جانب واحد مفقودة بشكل مثير للريبة." },'grade': {
        icon: '🪜',
        title: 'Ladder of Confidence',
        concept: 'GRADE Certainty', text: "يجب اكتساب كل درجة، وليس افتراضها. تبدأ من الأعلى (RCT) أو من الأسفل (الرصدي) ولا يمكنك التحرك إلا مع الأدلة. خطر التحيز يدفعك إلى الأسفل؛ التأثيرات الكبيرة يمكن أن تسحبك إلى الأعلى. لا توجد طرق مختصرة." },'tau_squared': {
        icon: '📻',
        title: 'Background Static',
        concept: 'τ² (Between-study variance)', text: "مثل الكهرباء الساكنة في محطة الراديو - ما مقدار الضوضاء في الإشارة؟ انخفاض τ² يعني استقبال واضح (تتفق الدراسات). ارتفاع τ² يعني تداخل من مصادر غير معروفة - مجموعات سكانية أو تدخلات أو نتائج مختلفة." },'random_effects': {
        icon: '🎼',
        title: 'Different Orchestras',
        concept: 'Random Effects Model', text: "التأثيرات الثابتة: نفس الأوركسترا تعزف عدة مرات. التأثيرات العشوائية: فرق أوركسترا مختلفة تعزف نفس المقطوعة. كل منها تضيف تفسيرها. نريد متوسط جميع فرق الأوركسترا الممكنة، وليس هذه فقط." },'prediction_interval': {
        icon: '🎯',
        title: 'Where Will the Arrow Land?',
        concept: 'Prediction Interval', text: "يخبرك CI بمكان المتوسط الحقيقي. يخبرك الفاصل الزمني للتنبؤ بالمكان الذي من المحتمل أن تنخفض فيه الدراسة التالية. إذا تجاوز PI الخاص بك خط عدم التأثير، فقد تقلب دراسة جديدة النتيجة." },'surrogate': {
        icon: '🗺️',
        title: 'Map vs Territory',
        concept: 'Surrogate Endpoints'، نص: "الخريطة (البديلة) تمثل المنطقة (النتيجة السريرية). لكن الخريطة يمكن أن تكون خاطئة. كان قمع PVC هو الخريطة؛ وكان معدل الوفيات هو المنطقة. وقد أثبت CAST أن الخريطة أدت إلى الهاوية." },'confounding': {
        icon: '☂️',
        title: 'Umbrella & Rain',
        concept: 'Confounding', text: "مبيعات المظلات تتنبأ بالمطر. لكن شراء المظلات لا يتنبأ بذلك't cause rain. The confounder (weather forecast) affects both. HRT users weren't healthier BECAUSE of HRT - they were healthier women who CHOSE HRT."
      }
    };

    function getAnalogy(conceptKey) {
      return conceptAnalogies[conceptKey] || null;
    }

    function renderAnalogy(conceptKey, containerId) {
      const analogy = getAnalogy(conceptKey);
      if (!analogy) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="analogy-card">
          <div class="analogy-header">
            <span class="analogy-icon">${analogy.icon}</span>
            <span class="analogy-title">${analogy.title}</span>
            <span class="analogy-concept">${analogy.concept}</span>
          </div>
          <div class="analogy-text">"${analogy.text}"</div>
        </div>
      `;
    }

    // ============================================================
    // MISCONCEPTION CHALLENGES (from Evidence Reversal 40)
    // ============================================================

    const misconceptions = [
      // Original 10 - Evidence Reversals
      { id: 1, statement: "If arrhythmias fall, survival must rise.", truth: false, story: "CAST", explanation: "Encainide/flecainide suppressed PVCs but tripled mortality. Surrogates can deceive." },
      { id: 2, statement: "Observational prevention equals causal prevention.", truth: false, story: "WHI/HRT", explanation: "Healthy user bias made HRT look protective. RCTs showed harm." },
      { id: 3, statement: "Surgery proves itself without sham control.", truth: false, story: "Moseley", explanation: "Arthroscopic knee surgery was no better than sham. Placebo effect is powerful." },
      { id: 4, statement: "If the artery is open, outcomes must improve.", truth: false, story: "COURAGE", explanation: "PCI for stable CAD didn't reduce death/MI vs medical therapy alone." },
      { id: 5, statement: "Lower glucose always means better outcomes."، الحقيقة: الباطلة، القصة:"NICE-SUGAR", explanation: "Intensive glucose control increased mortality in ICU patients." },
      { id: 6, statement: "A positive early signal is enough for adoption."، الحقيقة: الباطلة، القصة:"PROWESS-SHOCK", explanation: "Activated protein C looked promising until definitive trial showed no benefit." },
      { id: 7, statement: "If a mechanism is plausible, outcomes follow."، الحقيقة: الباطلة، القصة:"MAGIC", explanation: "Magnesium had sound antiarrhythmic theory but no mortality benefit in large trials." },
      { id: 8, statement: "More measurements mean more survival."، الحقيقة: الباطلة، القصة:"ESCAPE", explanation: "Pulmonary artery catheters provided data but no outcome improvement in heart failure." },
      { id: 9, statement: "Device enthusiasm replaces randomized proof."، الحقيقة: الباطلة، القصة:"CORAL", explanation: "Renal artery stenting had no benefit despite strong mechanistic rationale." },
      { id: 10, statement: "Guidelines equal proof."، الحقيقة: الباطلة، القصة:"IABP-SHOCK", explanation: "Intra-aortic balloon pump was Class I recommended but showed no benefit in RCT."}, // المزيد من عكس الأدلة { المعرف: 11، البيان:"Raising HDL with drugs guarantees fewer heart attacks."، الحقيقة: الباطلة، القصة:"AIM-HIGH", explanation: "Niacin raised HDL but didn'ر الحد من أحداث القلب والأوعية الدموية. كان HDL علامة، وليس سببًا قابلاً للتعديل.' EGDT worked in 2001 but three replication trials failed. Usual care had improved, diluting the effect." },
      { id: 13, statement: "Antioxidants prevent cancer in smokers."، الحقيقة: الباطلة، القصة:"ATBC/CARET", explanation: "Beta-carotene INCREASED lung cancer in smokers (RR 1.16-1.28). Mechanism doesn'لا تضمن الفائدة." }، {المعرف: 14، البيان: "المزيد من الفحص ينقذ دائمًا المزيد من الأرواح."، الحقيقة: خطأ، القصة: "PLCO"، شرح: "كشف فحص PSA عن المزيد من السرطانات لكنه لم يفعل ذلك't reduce mortality - it found cancers that would never kill." },
      { id: 15, statement: "Normalizing hemoglobin improves kidney patient outcomes."، الحقيقة: الباطلة، القصة:"CHOIR/TREAT", explanation: "Higher Hb targets increased stroke and death. The target became the enemy." },
      { id: 16, statement: "New devices are safer because they are new."، الحقيقة: الباطلة، القصة:"SAMMPRIS", explanation: "Intracranial stents tripled 30-day stroke/death vs medical therapy (14.7% vs 5.8%)." },
      { id: 17, statement: "If homocysteine drops, cardiovascular risk drops."، الحقيقة: الباطلة، القصة:"NORVIT", explanation: "B vitamins lowered homocysteine but didn'تقليل الأحداث. مغالطة العلامات الحيوية." }، {المعرف: 18، بيان: "الأكسجين الروتيني يساعد مرضى النوبات القلبية."، الحقيقة: خطأ، القصة: "DETO2X-AMI"، شرح: "الأكسجين في مرضى احتشاء عضلة القلب غير المصابين بنقص التأكسج لم يظهر أي فائدة للوفيات. قرن من الممارسة، لا يوجد دليل." }، {المعرف: 19، بيان: "التغذية العدوانية المبكرة تسرع التعافي من وحدة العناية المركزة."، الحقيقة: خطأ، القصة: "EPaNIC"، شرح: "أدت التغذية الوريدية المتأخرة إلى خروج أسرع من التغذية المبكرة. التوقيت مهم." }، {المعرف: 20، البيان: "إزالة الخثرة أثناء PCI يجب أن يحسن النتائج."، الحقيقة: خطأ، القصة: "TASTE"، شرح: "أضاف طموح الخثرة وقتًا إجرائيًا ولكن لا فائدة من الوفيات. لا منطقية't mean proven."}, // مفاهيم خاطئة عن طرق كوكرين { المعرف: 21، البيان:"Low I² means the studies agree enough to pool."، الحقيقة: الباطلة، القصة:"Methods", explanation: "I² can be low with clinically important differences. Prediction intervals reveal the true spread of effects." },
      { id: 22, statement: "Statistically significant means clinically important."، الحقيقة: الباطلة، القصة:"Methods", explanation: "Large trials can detect tiny, meaningless effects. Effect SIZE and CI width matter more than p-values." },
      { id: 23, statement: "RCTs are always high certainty evidence."، الحقيقة: الباطلة، القصة:"GRADE", explanation: "RCTs start high but are downgraded for bias, imprecision, indirectness, inconsistency, or publication bias." },
      { id: 24, statement: "Funnel plot asymmetry proves publication bias."، الحقيقة: الباطلة، القصة:"Methods", explanation: "Asymmetry has many causes: true heterogeneity, small-study effects, different populations. Investigation needed." },
      { id: 25, statement: "Random effects models fix heterogeneity."، الحقيقة: الباطلة، القصة:"Methods", explanation: "Random effects account for heterogeneity statistically but don't explain it. Clinical investigation is still required." }
    ];

    function renderMisconceptionChallenge(misconceptionId, containerId) {
      const m = misconceptions.find(x => x.id === misconceptionId);
      if (!m) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="misconception-challenge" id="misconception-${m.id}">
          <div class="misconception-header">
            <span>🤔</span>
            <span>Common Belief Challenge</span>
          </div>
          <div class="misconception-statement">"${m.statement}"</div>
          <div class="misconception-buttons">
            <button class="misconception-btn true-btn" onclick="answerMisconception(${m.id}, true)">TRUE</button>
            <button class="misconception-btn false-btn" onclick="answerMisconception(${m.id}, false)">FALSE</button>
          </div>
          <div class="misconception-result" id="misconception-result-${m.id}"></div>
        </div>
      `;
    }

    function answerMisconception(id, answer) {
      const m = misconceptions.find(x => x.id === id);
      if (!m) return;

      const isCorrect = answer === m.truth;
      const trueBtn = document.querySelector(`#misconception-${id} .true-btn`);
      const falseBtn = document.querySelector(`#misconception-${id} .false-btn`);
      const resultDiv = document.getElementById(`misconception-result-${id}`);

      // Disable buttons
      trueBtn.disabled = true;
      falseBtn.disabled = true;

      // Show correct/incorrect
      if (m.truth) {
        trueBtn.classList.add('correct');
        if (!answer) falseBtn.classList.add('wrong');
      } else {
        falseBtn.classList.add('correct');
        if (answer) trueBtn.classList.add('wrong'); } // عرض النتيجة resultDiv.className = `خطأ في الفهم - النتيجة مرئية ${isCorrect ?'correct' : 'incorrect'}`;
      resultDiv.innerHTML = `
        <strong>${isCorrect ? '✓ Correct!' : '✗ Not quite.'}</strong> هذا الاعتقاد هو <strong>${m.truth ?'TRUE' : 'FALSE'</strong>. <br><br> <strong>${m.story}:</strong> ${m.explanation} `; // نقاط الجائزة إذا (صحيح) { AwardPoints(20,'Misconception challenge correct');
      }
      saveProgress();
    }

    // ============================================================
    // PRACTICE PROBLEMS (Addressing Cochrane Gaps)
    // ============================================================

    const practiceProblems = [
      // GRADE Problems
      {
        id: 'grade_1',
        category: 'GRADE',
        title: 'Rating Certainty: SPRINT Trial',
        scenario: 'You\'إعادة إنشاء مبادئ توجيهية لارتفاع ضغط الدم. تُظهر تجربة SPRINT (RCT، n=9,361) أن التحكم المكثف في ضغط الدم يقلل من أحداث السيرة الذاتية (HR 0.75، 95% CI 0.64-0.89). ومع ذلك: (1) استبعدت التجربة مرضى السكري، (2) ضغط الدم المكتبي الآلي المستخدم (قراءة أقل بمقدار 10 مم زئبق تقريبًا من القراءة اليدوية)، (3) تضمنت نقطة النهاية المركبة فشل القلب.',
        question: 'ما هو تصنيف درجة اليقين المناسب لسكان عيادتك والذي يتضمن مرضى السكر ويستخدم ضغط الدم اليدوي؟',
        options: [
          { id: 'a', text: 'مرتفع - كان SPRINT عبارة عن تجربة عشوائية عشوائية كبيرة وجيدة التنفيذ', correct: false },
          { id: 'b', text: 'متوسط - خفض مستوى واحد بسبب عدم المباشرة (يختلف عدد السكان)', correct: true },
          { id: 'c', text: 'منخفض - خفض مستويين لعدم المباشرة وعدم الدقة', correct: false },
          { id: 'd', text: 'منخفض جدًا - مخاوف خطيرة متعددة', correct: false }
        ],
        explanation: 'خفض مستوى واحد بسبب عدم المباشرة الخطيرة: (1) السكان يستبعدون مرضى السكر (أظهر ACCORD ضررًا في مرضى السكر مع التحكم المكثف)، (2) طريقة قياس ضغط الدم يختلف (تطبيق أهداف SPRINT باستخدام BP اليدوي قد يكون مبالغًا فيه). كانت جودة التجربة جيدة، لكن النتائج لا تنطبق بشكل مباشر على سكانك.',
        principle: 6
      },
      {
        id: 'grade_2',
        category: 'GRADE',
        title: 'عندما تتفوق المراقبة على التجارب المعشاة ذات الشواهد',
        scenario: 'للحصول على تأثير ضار نادر (التسمم الكبدي بدواء جديد)، لديك: (1) تجارب معشاة ذات شواهد تظهر 0/2000 حدث في العلاج مقابل 0/2000 في السيطرة، (2) قاعدة بيانات كبيرة لليقظة الدوائية تعرض 45 حالة في 500000 مستخدم (9/100000).',
        question: 'ما الذي يوفر يقينًا أعلى لإشارة الأمان هذه؟',
        options: [
          { id: 'a', text: 'التجارب المعشاة ذات الشواهد - إنها المعيار الذهبي', correct: false },
          { id: 'b', text: 'بيانات المراقبة - لديها القدرة على اكتشاف الأحداث النادرة', correct: true },
          { id: 'c', text: 'لا - أنت بحاجة إلى المزيد من بيانات RCT', correct: false },
          { id: 'd', text: 'اجمعها في التحليل التلوي', correct: false }
        ],
        explanation: 'إن التجارب المعشاة ذات الشواهد ضعيفة القوة بالنسبة للأحداث النادرة. مع 2000 مريض، ستحتاج إلى خطر أكبر من 1/500 لاكتشاف حدث واحد. توفر بيانات الرصد، على الرغم من المخاطر المربكة، الدليل الوحيد على وجود إشارة حقيقية. يمكن لـ GRADE تقييم بيانات المراقبة عندما يكون التأثير كبيرًا أو عندما تكون هناك استجابة للجرعة.',
        principle: 5
      },
      // Prediction Interval Problems
      {
        id: 'pi_1',
        category: 'Prediction Intervals',
        title: 'Beyond I-squared',
        scenario: 'يظهر التحليل التلوي لـ 8 تجارب: RR المجمعة = 0.80 (95% CI 0.72-0.89)، I² = 65%، τ² = 0.04. فترة التنبؤ 95% هي 0.55-1.16.',
        question: 'إذا قمت بإجراء تجربة جديدة على مجموعة سكانية مماثلة، ما هو نطاق التأثيرات المعقولة؟',
        options: [
          { id: 'a', text: '0.72-0.89 (فاصل الثقة)', correct: false },
          { id: 'b', text: '0.55-1.16 (فاصل التنبؤ)', correct: true },
          { id: 'c', text: 'حوالي 0.80 (النقطة) تقدير)', correct: false },
          { id: 'd', text: 'لا يمكن التنبؤ من هذه البيانات', correct: false }
        ],
        explanation: 'يُظهر الفاصل الزمني للتنبؤ (0.55-1.16) نطاق التأثيرات الحقيقية في إعدادات مختلفة. يتضمن 1.0، مما يعني أن التجربة الجديدة قد تظهر ضررًا على الرغم من أن التقدير المجمع يظهر فائدة. يخبرك I² بوجود عدم تجانس؛ تخبرك فترات التنبؤ بما يعنيه بالنسبة للمريض/الإعداد التالي.',
        principle: 4
      },
      {
        id: 'pi_2',
        category: 'Prediction Intervals',
        title: 'Clinical Interpretation',
        scenario: 'أنت تقدم المشورة لزميل بشأن تنفيذ التدخل. يظهر التحليل التلوي: RR = 0.70 (95% CI 0.60-0.82)، I² = 45% (معتدل)، فاصل التنبؤ 95% = 0.50-0.98.',
        question: 'ماذا تخبر زميلك؟',
        options: [
          { id: 'a', text: 'دليل قوي على الفائدة - التنفيذ بثقة', correct: false },
          { id: 'b', text: 'من المحتمل أن يكون مفيدًا ولكن قد يختلف حجم التأثير بشكل كبير من خلال تحديد', correct: true },
          { id: 'c', text: 'قدر كبير من عدم التجانس لاستخلاص النتائج', correct: false },
          { id: 'd', text: 'انتظر المزيد من التجارب لتقليل عدم اليقين', correct: false }
        ],
        explanation: 'يظل الفاصل الزمني للتنبؤ (0.50-0.98) أقل من 1.0، مما يشير إلى احتمالية الاستفادة في معظم الإعدادات، على الرغم من اختلاف الحجم (تخفيض بنسبة 30-50%). وهذا أكثر إفادة من مجرد الإبلاغ عن "عدم التجانس المعتدل". من المحتمل أن يكون العلاج مفيدًا، ولكن مقداره يعتمد على العوامل المحلية.',
        principle: 4
      },
      // Risk of Bias Problems
      {
        id: 'rob_1',
        category: 'خطر التحيز',
        title: 'أعلام حمراء بأثر رجعي',
        scenario: 'مراجعة تجربة التدخل الجراحي: (1) كان المرضى يعرفون تخصيصاتهم، (2) الجراحون بوضوح لا يمكن التعمية، (3) وكانت النتيجة الأولية هي "الألم الذي أبلغ عنه المريض بعد 6 أشهر"، (4) فقد 15% من المتابعة، وهو أمر مماثل بين المجموعات.',
        question: 'ما هو الخطر الرئيسي للقلق بشأن التحيز؟',
        options: [
          { id: 'a', text: 'تحيز الاختيار - ربما تم تخريب التوزيع العشوائي', correct: false },
          { id: 'b', text: 'تحيز الأداء - لم يُعمي الجراحون', correct: false },
          { id: 'c', text: 'تحيز الكشف - عرف المرضى التخصيص وأبلغوا عن نتائج ذاتية', correct: true },
          { id: 'd', text: 'تحيز الاستنزاف - فقد 15% للمتابعة', correct: false }
        ],
        explanation: 'مع إبلاغ المرضى غير المكفوفين عن نتائج موضوعية، يعد تحيز الكشف أمرًا بالغ الأهمية. المرضى الذين يعرفون أنهم خضعوا للجراحة "الحقيقية" غالبًا ما يبلغون عن المزيد من التحسن (تأثير الدواء الوهمي). وهذا هو بالضبط سبب استخدام أوربيتا لعملية جراحية زائفة - لفصل العلاج الوهمي عن تأثير العلاج الحقيقي. أما نسبة الاستنزاف البالغة 15%، المتوازنة بين المجموعات، فهي أقل إثارة للقلق.',
        principle: 1
      },
      {
        id: 'rob_2',
        category: 'خطر التحيز',
        title: 'إشارات التخفيض',
        scenario: 'عند مراجعة التجارب التي أجراها باحث غزير الإنتاج، تلاحظ: (1) معدلات الأحداث متوازنة تمامًا بين المجموعات، (2) I² = 0% عندما يتم تجميع تجاربه بمفرده (لكن 70% عند دمجها مع تجارب أخرى)، (3) التأثيرات أكبر باستمرار من تجارب الباحثين الآخرين، (4) غير قادر على التحقق من بيانات المصدر.',
        question: 'ماذا يجب أن تفعل؟',
        options: [
          { id: 'a', text: 'قم بتضمين التجارب - من المرغوب فيه عدم التجانس المنخفض', correct: false },
          { id: 'b', text: 'قم بإجراء تحليل الحساسية باستثناء تجاربه', correct: false },
          { id: 'c', text: 'اطلب التحقق من بيانات المصدر قبل التضمين', correct: true },
          { id: 'd', text: 'قم بالإبلاغ عن المخاوف ولكن قم بتضمينها على أي حال', correct: false }
        ],
        explanation: 'هذه إشارات تلفيق كلاسيكية (من قضية الاحتيال DECREASE). البيانات "المثالية" هي علامة حمراء - البيانات البيولوجية الحقيقية فوضوية. المسار المقبول الوحيد هو التحقق من بيانات المصدر. لقد أثر احتيال دون بولدرمانز على المبادئ التوجيهية لسنوات؛ ربما تضرر 800 ألف مريض. الأرقام بدون مصدر ليست أرقامًا.',
        principle: 3
      },
      // Publication Bias Problems
      {
        id: 'pb_1',
        category: 'Publication Bias',
        title: 'Asymmetric Funnel',
        scenario: 'يوضح المخطط القمعي الخاص بك: التجارب الكبيرة تتجمع حول RR=1.0، والتجارب الصغيرة تتجمع حول RR=0.6 (كلها على جانب "المنفعة"). اختبار إيجر ع = 0.01.',
        question: 'ما هو التفسير الأرجح؟',
        options: [
          { id: 'a', text: 'تحيز النشر - لم يتم نشر التجارب السلبية الصغيرة', correct: false },
          { id: 'b', text: 'تأثيرات الدراسات الصغيرة - يمكن أن تكون تحيز النشر أو عدم التجانس الحقيقي', correct: true },
          { id: 'c', text: 'وجدت التجارب الصغيرة التأثير الحقيقي؛ تم تخفيف التجارب الكبيرة', correct: false },
          { id: 'd', text: 'تباين عشوائي - من المتوقع عدم التماثل', correct: false }
        ],
        explanation: 'عدم تناسق المسار له أسباب متعددة: (1) تحيز النشر، (2) عدم التجانس الحقيقي (تجارب صغيرة في مجموعات سكانية مختلفة)، (3) اختلافات منهجية (تجارب صغيرة أقل صرامة)، (4) الصدفة. لا يمكنك استنتاج "تحيز النشر" من عدم التماثل وحده. مطلوب التحقيق في السبب.',
        principle: 2
      },
      {
        id: 'pb_2',
        category: 'Publication Bias',
        title: 'التجارب المفقودة',
        scenario: 'أنت تقوم بتحليل تلوي لمضاد للاكتئاب. يعرض موقع ClinicalTrials.gov 12 تجربة مسجلة؛ لقد وجدت 8 منشورات. تم الانتهاء من التجارب الأربع المفقودة منذ أكثر من 3 سنوات.',
        question: 'ماذا تفعل؟',
        options: [
          { id: 'a', text: 'تابع التجارب الثمانية المنشورة - هذه ممارسة قياسية', correct: false },
          { id: 'b', text: 'اتصل بالرعاة/المؤلفين وقدم الملف طلبات قانون حرية المعلومات للبيانات غير المنشورة', correct: true },
          { id: 'c', text: 'لاحظ القيد في قسم المناقشة', correct: false },
          { id: 'd', text: 'استخدم القطع والتعبئة لضبط التجارب المفقودة', correct: false }
        ],
        explanation: 'وجدت إدارة الغذاء والدواء الأمريكية أن 94% من تجارب مضادات الاكتئاب المنشورة كانت إيجابية، مقابل 51% من جميع التجارب المقدمة إلى إدارة الغذاء والدواء. يجب أن تحاول الحصول على البيانات المفقودة - وهذا ليس اختياريًا. إن "ملاحظة القيد" دون محاولة إصلاحه هو إهمال منهجي.',
        principle: 2
      }
    ];

    function renderPracticeProblem(problemId, containerId) {
      const problem = practiceProblems.find(p => p.id === problemId);
      if (!problem) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="practice-problem" id="مشكلة-${problem.id}">
          <div class="practice-header">
            <span class="practice-category">${problem.category}</span>
            <span class="practice-title">${problem.title}</span>
          </div>
          <div class="practice-scenario">${problem.scenario}</div>
          <div class="practice-question"><strong>${problem.question}</strong></div>
          <div class="practice-options">
            ${problem.options.map(opt => `
              <button class="practice-option" onclick="AnswerPracticeProblem('${problem.id}', '${opt.id}')">
                <span class="option-letter">${opt.id.toUpperCase()}</span>
                <span class="option-text">${opt.text}</span>
              </button>
            `).join('')}
          </div>
          <div class="practice-feedback" id="ردود الفعل-${problem.id}"></div>
        </div>
      `;
    }

    function answerPracticeProblem(problemId, answerId) {
      const problem = practiceProblems.find(p => p.id === problemId);
      if (!problem) return;

      const selectedOption = problem.options.find(o => o.id === answerId);
      const correctOption = problem.options.find(o => o.correct);
      const isCorrect = selectedOption.correct;

      // Disable all buttons and show correct/incorrect
      const buttons = document.querySelectorAll(`#problem-${problemId} .practice-option`);
      buttons.forEach(btn => {
        btn.disabled = true;
        const letter = btn.querySelector('.option-letter').textContent.toLowerCase();
        if (letter === correctOption.id) {
          btn.classList.add('correct');
        } else if (letter === answerId) {
          btn.classList.add('incorrect');
        }
      });

      // Show feedback
      const feedbackDiv = document.getElementById(`feedback-${problemId}`);
      feedbackDiv.className = `practice-feedback visible ${isCorrect ? 'correct' : 'incorrect'}`;
      feedbackDiv.innerHTML = `
        <strong>${isCorrect ? '✓ صحيح!' : '✗ ليس تمامًا.'}</strong>
        <p>${problem.explanation}</p>
        <p class="principle-link"><em>Principle ${problem.principle + 1}: ${sevenPrinciples[problem.principle]?.text || ''}</em></p>
      `;

      // Award points
      if (isCorrect) {
        awardPoints(25, 'تمرين على المشكلة بشكل صحيح');
      } else {
        awardPoints(5, 'محاولة تمرين على المشكلة');
      }
      saveProgress();
    }

    // ============================================================
    // INVESTIGATION EXERCISES
    // ============================================================

    function revealAnswer(elementId) {
      const el = document.getElementById(elementId);
      if (el) {
        el.classList.add('visible');
        // Scroll into view
        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function generateMiniForest(containerId, studies, pooled, showAfter = false) {
      const container = document.getElementById(containerId);
      if (!container) return;

      const minE = Math.min(...studies.map(s => s.lo), pooled.lo, 0.3);
      const maxE = Math.max(...studies.map(s => s.hi), pooled.hi, 3);
      const range = maxE - minE;
      const scale = (v) => ((v - minE) / range) * 240 + 30;
      const height = (studies.length + 1) * 24 + 30;

      container.innerHTML = `
        <svg viewBox="0 0 320 ${height}" style="width: 100%; height: ${height}px; font-family: sans-serif;">
          <line x1="${scale(1)}" y1="5" x2="${scale(1)}" y2="${height - 15}" stroke="#999" stroke-width="1" stroke-dasharray="3"/>
          ${studies.map((s, i) => {
            const y = 18 + i * 24;
            const color = showAfter && s.excluded ? '#ccc' : '#1E2761';
            return `
              <text x="2" y="${y + 3}" font-size="9" fill="${color}" ${s.excluded ? 'text-decoration="line-through"' : ''}>${s.name}</text>
              <line x1="${scale(s.lo)}" y1="${y}" x2="${scale(s.hi)}" y2="${y}" stroke="${color}" stroke-width="1.5"/>
              <rect x="${scale(s.effect) - 4}" y="${y - 4}" width="8" height="8" fill="${color}"/>
              <text x="280" y="${y + 3}" font-size="8" fill="${color}">${s.effect.toFixed(2)}</text>
            `;
          }).join('')}
          <polygon points="${scale(pooled.effect)},${height - 20} ${scale(pooled.lo)},${height - 13} ${scale(pooled.effect)},${height - 6} ${scale(pooled.hi)},${height - 13}" fill="${showAfter ? '#C53030' : '#D4AF37'}"/>
          <text x="2" y="${height - 10}" font-size="9" font-weight="bold" fill="${showAfter ? '#C53030' : '#1E2761'}">Pooled</text>
          <text x="280" y="${height - 10}" font-size="8" font-weight="bold">${pooled.effect.toFixed(2)}</text>
          <text x="${scale(0.5)}" y="${height}" font-size="7" fill="#666">Favors Tx</text>
          <text x="${scale(2)}" y="${height}" font-size="7" fill="#666">Favors Ctrl</text>
        </svg>
      `;
    }

    // CAST Investigation Data
    const castStudiesPublished = [
      { name: 'Obs Study 1', effect: 0.45, lo: 0.28, hi: 0.72 },
      { name: 'Obs Study 2', effect: 0.52, lo: 0.35, hi: 0.77 },
      { name: 'Obs Study 3', effect: 0.38, lo: 0.22, hi: 0.65 },
    ];
    const castPooledBefore = { effect: 0.45, lo: 0.33, hi: 0.61 };
    const castPooledAfter = { effect: 2.50, lo: 1.60, hi: 4.50 };

    // Rosiglitazone data (real from Nissen 2007)
    const rosiStudies = [
      { name: 'ADOPT', effect: 1.25, lo: 0.78, hi: 2.01 },
      { name: 'DREAM', effect: 1.36, lo: 0.68, hi: 2.71 },
      { name: 'Trial 49653/020', effect: 1.81, lo: 0.59, hi: 5.55 },
      { name: 'Trial 49653/024', effect: 2.67, lo: 0.50, hi: 14.3 },
      { name: 'Trial 49653/093', effect: 1.50, lo: 0.25, hi: 8.98 },
    ];
    const rosiPooled = { effect: 1.43, lo: 1.03, hi: 1.98 };

    // DECREASE data (before/after fraud removal)
    const decreaseStudies = [
      { name: 'DECREASE-I', effect: 0.09, lo: 0.02, hi: 0.37, excluded: true },
      { name: 'DECREASE-IV', effect: 0.65, lo: 0.24, hi: 1.74, excluded: true },
      { name: 'POISE', effect: 1.33, lo: 1.03, hi: 1.74 },
      { name: 'DIPOM', effect: 1.11, lo: 0.66, hi: 1.87 },
      { name: 'MaVS', effect: 0.92, lo: 0.46, hi: 1.84 },
    ];
    const decreasePooledBefore = { effect: 0.56, lo: 0.35, hi: 0.89 };
    const decreasePooledAfter = { effect: 1.27, lo: 1.01, hi: 1.60 };

    // Magnesium ISIS-4 data
    const magnesiumSmallTrials = [
      { name: 'Rasmussen', effect: 0.23, lo: 0.05, hi: 1.01 },
      { name: 'Smith', effect: 0.31, lo: 0.09, hi: 1.10 },
      { name: 'Ceremuzynski', effect: 0.48, lo: 0.17, hi: 1.34 },
      { name: 'Schechter 1', effect: 0.52, lo: 0.20, hi: 1.35 },
      { name: 'Schechter 2', effect: 0.35, lo: 0.13, hi: 0.94 },
    ];
    const magPooledSmall = { effect: 0.44, lo: 0.27, hi: 0.71 };
    const isis4Result = { effect: 1.06, lo: 0.99, hi: 1.13 };

    // Complete magnesium trial data with sample sizes for visualization
    const magnesiumTrialsComplete = [
      { name: 'Morton 1984', n: 40, effect: 0.10, lo: 0.01, hi: 0.87, se: 0.55 },
      { name: 'Rasmussen 1986', n: 273, effect: 0.35, lo: 0.13, hi: 0.94, se: 0.25 },
      { name: 'Smith 1986', n: 400, effect: 0.48, lo: 0.21, hi: 1.09, se: 0.21 },
      { name: 'Abraham 1987', n: 94, effect: 0.87, lo: 0.33, hi: 2.30, se: 0.35 },
      { name: 'Shechter 1990', n: 103, effect: 0.27, lo: 0.08, hi: 0.95, se: 0.42 },
      { name: 'Ceremuzynski 1989', n: 48, effect: 0.22, lo: 0.03, hi: 1.50, se: 0.68 },
      { name: 'LIMIT-2', n: 2316, effect: 0.74, lo: 0.57, hi: 0.97, se: 0.09 },
    ];
    const isis4Complete = { name: 'ISIS-4', n: 58050, effect: 1.06, lo: 0.99, hi: 1.13, se: 0.025 };

    function drawMagnesiumForest(mode) {
      const containerId = mode === 'small' ? 'magnesium-forest-small' : 'magnesium-forest-full';
      const container = document.getElementById(containerId);
      if (!container) return;

      let trials = [...magnesiumTrialsComplete];
      let pooled = { effect: 0.44, lo: 0.27, hi: 0.71, label: 'مجمعة (تجارب صغيرة)' };

      if (mode === 'full') {
        trials.push(isis4Complete);
        pooled = { effect: 1.02, lo: 0.95, hi: 1.09, label: 'مجمعة (الكل) التجارب)' };
      }

      const width = 800;
      const height = trials.length * 35 + 100;
      const margin = { left: 150, right: 50, top: 30, bottom: 50 };
      const plotWidth = width - margin.left - margin.right;

      // Log scale for OR
      const minLog = Math.log(0.05);
      const maxLog = Math.log(3);
      const xScale = (logVal) => margin.left + ((logVal - minLog) / (maxLog - minLog)) * plotWidth;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="أقصى عرض: 100%؛ الارتفاع: تلقائي؛">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Forest Plot: Magnesium in MI${mode === 'full' ? '(مع إيزيس-4)' : '(تجارب صغيرة فقط)'}
      </text>`;

      // Grid lines and axis
      const ticks = [0.1, 0.25, 0.5, 1.0, 2.0];
      ticks.forEach(tick => {
        const x = xScale(Math.log(tick));
        svg += `<line x1="${x}" y1="${margin.top}" x2="${x}" y2="${الارتفاع - هامش.أسفل}" stroke="#e2e8f0" stroke-width="1"/>`;
        svg += `<text x="${x}" y="${height - هامش.bottom + 15}" text-anchor="middle" font-size="11" fill="#64748b">${tick}</text>`;
      });

      // Null line
      const nullX = xScale(0);
      svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${الارتفاع - هامش.أسفل}" stroke="#1a365d" stroke-width="2"/>`;

      // Studies
      trials.forEach((trial, i) => {
        const y = margin.top + 20 + i * 35;
        const x = xScale(Math.log(trial.effect));
        const xLo = xScale(Math.log(Math.max(0.05, trial.lo)));
        const xHi = xScale(Math.log(Math.min(3, trial.hi)));

        // Weight based on sample size
        const weight = Math.sqrt(trial.n) / Math.sqrt(isis4Complete.n) * 10;
        const boxSize = Math.max(4, Math.min(12, weight + 4));

        const color = trial.name === 'ISIS-4' ? '#C53030' : (trial.effect < 1 ? '#22c55e' : '#64748b');

        // Label
        svg += `<text x="${margin.left - 10}" y="${y + 4}" text-anchor="end" font-size="11" fill="#1a365d">${trial.name} (n=${trial.n.toLocaleString()})</text>`;

        // CI line
        svg += `<line x1="${xLo}" y1="${y}" x2="${xHi}" y2="${y}" stroke="${color}" stroke-width="2"/>`;

        // Effect point
        svg += `<rect x="${x - boxSize/2}" y="${y - boxSize/2}" width="${boxSize}" height="${boxSize}" fill="${color}"/>`;

        // CI caps
        svg += `<line x1="${xLo}" y1="${y - 4}" x2="${xLo}" y2="${y + 4}" stroke="${color}" stroke-width="1"/>`;
        svg += `<line x1="${xHi}" y1="${y - 4}" x2="${xHi}" y2="${y + 4}" stroke="${color}" stroke-width="1"/>`;
      });

      // Pooled diamond
      const poolY = height - margin.bottom - 20;
      const poolX = xScale(Math.log(pooled.effect));
      const poolXLo = xScale(Math.log(pooled.lo));
      const poolXHi = xScale(Math.log(pooled.hi));
      const diamondColor = pooled.effect < 1 ? '#22c55e' : '#C53030';

      svg += `<polygon points="${poolXLo},${poolY} ${poolX},${poolY - 8} ${poolXHi},${poolY} ${poolX},${poolY + 8}" fill="${diamondColor}" stroke="${diamondColor}"/>`;
      svg += `<text x="${margin.left - 10}" y="${poolY + 4}" text-anchor="end" font-size="11" font-weight="bold" fill="#1a365d">${pooled.label}</text>`;

      // Axis label
      svg += `<text x="${width/2}" y="${height - 5}" text-anchor="middle" font-size="12" fill="#1a365d">Odds Ratio (log scale)</text>`;

      // Favors labels
      svg += `<text x="${xScale(Math.log(0.2))}" y="${الارتفاع - هامش.أسفل + 30}" text-anchor="middle" font-size="10" fill="#22c55e">← Favors Magnesium</text>`;
      svg += `<text x="${xScale(Math.log(2))}" y="${الارتفاع - هامش.أسفل + 30}" text-anchor="middle" font-size="10" fill="#C53030">Favors Placebo →</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    function drawMagnesiumFunnel(mode) {
      const container = document.getElementById('magnesium-funnel-small');
      if (!container) return;

      const trials = magnesiumTrialsComplete;
      const width = 600;
      const height = 400;
      const margin = { left: 80, right: 40, top: 40, bottom: 60 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Pooled effect (log scale)
      const pooledLog = Math.log(0.44);

      // X axis: log(OR)
      const minLogOR = -2.5;
      const maxLogOR = 1;
      const xScale = (logOR) => margin.left + ((logOR - minLogOR) / (maxLogOR - minLogOR)) * plotWidth;

      // Y axis: SE (inverted - high precision at top)
      const maxSE = 0.75;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="أقصى عرض: 100%؛ الارتفاع: تلقائي؛">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Funnel Plot: Magnesium in MI (small trials)
      </text>`;

      // Funnel shape (95% CI bounds)
      const funnelPoints = [];
      for (let se = 0; se <= maxSE; se += 0.01) {
        const ciWidth = 1.96 * se;
        const xLeft = xScale(pooledLog - ciWidth);
        const xRight = xScale(pooledLog + ciWidth);
        const y = yScale(se);
        funnelPoints.push({ xLeft, xRight, y });
      }

      // Draw funnel
      let leftPath = `M ${xScale(pooledLog)} ${yScale(0)}`;
      let rightPath = `M ${xScale(pooledLog)} ${yScale(0)}`;
      funnelPoints.forEach(p => {
        leftPath += ` L ${p.xLeft} ${p.y}`;
        rightPath += ` L ${p.xRight} ${p.y}`;
      });
      svg += `<path d="${leftPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;
      svg += `<path d="${rightPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;

      // Vertical line at pooled effect
      svg += `<line x1="${xScale(pooledLog)}" y1="${margin.top}" x2="${xScale(pooledLog)}" y2="${الارتفاع - هامش.أسفل}" stroke="#22c55e" stroke-width="2" stroke-dasharray="4"/>`;

      // Null line at OR = 1
      svg += `<line x1="${xScale(0)}" y1="${margin.top}" x2="${xScale(0)}" y2="${الارتفاع - هامش.أسفل}" stroke="#1a365d" stroke-width="2"/>`;

      // Plot studies
      trials.forEach(trial => {
        const x = xScale(Math.log(trial.effect));
        const y = yScale(trial.se);
        const color = trial.effect < 1 ? '#22c55e' : '#64748b';
        svg += `<circle cx="${x}" cy="${y}" r="6" fill="${color}" stroke="#fff" stroke-width="1"/>`;
        svg += `<text x="${x + 8}" y="${y + 3}" font-size="9" fill="#1a365d">${trial.name}</text>`;
      });

      // Axes
      svg += `<line x1="${margin.left}" y1="${الارتفاع - هامش.أسفل}" x2="${العرض - الهامش. اليمين}" y2="${الارتفاع - هامش.أسفل}" stroke="#1a365d" stroke-width="1"/>`;
      svg += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${الارتفاع - هامش.أسفل}" stroke="#1a365d" stroke-width="1"/>`;

      // X axis ticks
      [-2, -1, 0, 0.5].forEach(logOR => {
        const x = xScale(logOR);
        const or = Math.exp(logOR).toFixed(2);
        svg += `<line x1="${x}" y1="${الارتفاع - هامش.أسفل}" x2="${x}" y2="${الارتفاع - هامش.أسفل + 5}" stroke="#1a365d"/>`;
        svg += `<text x="${x}" y="${الارتفاع - هامش.أسفل + 18}" text-anchor="middle" font-size="10" fill="#1a365d">${or}</text>`;
      });

      // Y axis ticks
      [0, 0.25, 0.5, 0.75].forEach(se => {
        const y = yScale(se);
        svg += `<line x1="${margin.left - 5}" y1="${y}" x2="${margin.left}" y2="${y}" stroke="#1a365d"/>`;
        svg += `<text x="${margin.left - 10}" y="${y + 3}" text-anchor="end" font-size="10" fill="#1a365d">${se.toFixed(2)}</text>`;
      });

      // Axis labels
      svg += `<text x="${width/2}" y="${height - 10}" text-anchor="middle" font-size="12" fill="#1a365d">Odds Ratio</text>`;
      svg += `<text x="15" y="${height/2}" text-anchor="middle" transform="rotate(-90, 15, ${height/2})" font-size="12" fill="#1a365d">Standard Error</text>`;

      // Annotations
      svg += `<text x="${xScale(-1.5)}" y="${الارتفاع - هامش.أسفل + 40}" text-anchor="middle" font-size="10" fill="#f59e0b" font-weight="bold">
        ⚠️ Asymmetric: Small trials cluster left
      </text>`;

      svg += '</svg>';
      container.innerHTML = svg;

      // Show interpretation
      document.getElementById('mag-funnel-interpretation').style.display = 'block';
    }

    // Reboxetine funnel plot data (published trials only - showing bias)
    function drawReboxetineFunnel() {
      const container = document.getElementById('reboxetine-funnel');
      if (!container) return;

      // Published trials (all showing benefit - biased)
      const publishedTrials = [
        { name: 'Trial 1', smd: 0.72, se: 0.18 },
        { name: 'Trial 2', smd: 0.58, se: 0.22 },
        { name: 'Trial 3', smd: 0.45, se: 0.20 },
        { name: 'Trial 4', smd: 0.61, se: 0.25 },
        { name: 'Trial 5', smd: 0.52, se: 0.19 },
        { name: 'Trial 6', smd: 0.68, se: 0.28 },
        { name: 'Trial 7', smd: 0.41, se: 0.16 },
      ];

      // Where the missing trials likely were (shown as ghost points)
      const missingTrials = [
        { name: 'Hidden 1', smd: -0.12, se: 0.22 },
        { name: 'Hidden 2', smd: 0.05, se: 0.19 },
        { name: 'Hidden 3', smd: -0.08, se: 0.25 },
        { name: 'Hidden 4', smd: 0.11, se: 0.20 },
        { name: 'Hidden 5', smd: -0.15, se: 0.28 },
      ];

      const width = 600;
      const height = 400;
      const margin = { left: 80, right: 40, top: 40, bottom: 60 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Pooled effect (published)
      const pooledSMD = 0.56;

      // X axis: SMD
      const minSMD = -0.5;
      const maxSMD = 1.0;
      const xScale = (smd) => margin.left + ((smd - minSMD) / (maxSMD - minSMD)) * plotWidth;

      // Y axis: SE (inverted)
      const maxSE = 0.35;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="أقصى عرض: 100%؛ الارتفاع: تلقائي؛">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Funnel Plot: Reboxetine vs Placebo (Published Only)
      </text>`;

      // Funnel shape
      const funnelPoints = [];
      for (let se = 0.01; se <= maxSE; se += 0.01) {
        const ciWidth = 1.96 * se;
        const xLeft = xScale(pooledSMD - ciWidth);
        const xRight = xScale(pooledSMD + ciWidth);
        const y = yScale(se);
        funnelPoints.push({ xLeft, xRight, y });
      }

      let leftPath = `M ${xScale(pooledSMD)} ${yScale(0.01)}`;
      let rightPath = `M ${xScale(pooledSMD)} ${yScale(0.01)}`;
      funnelPoints.forEach(p => {
        leftPath += ` L ${p.xLeft} ${p.y}`;
        rightPath += ` L ${p.xRight} ${p.y}`;
      });
      svg += `<path d="${leftPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;
      svg += `<path d="${rightPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;

      // Pooled effect line
      svg += `<line x1="${xScale(pooledSMD)}" y1="${margin.top}" x2="${xScale(pooledSMD)}" y2="${الارتفاع - هامش.أسفل}" stroke="#22c55e" stroke-width="2" stroke-dasharray="4"/>`;

      // Null line at SMD = 0
      svg += `<line x1="${xScale(0)}" y1="${margin.top}" x2="${xScale(0)}" y2="${الارتفاع - هامش.أسفل}" stroke="#1a365d" stroke-width="2"/>`;

      // Plot missing trials (ghost points)
      missingTrials.forEach(trial => {
        const x = xScale(trial.smd);
        const y = yScale(trial.se);
        svg += `<circle cx="${x}" cy="${y}" r="8" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="3"/>`;
      });

      // Plot published trials
      publishedTrials.forEach(trial => {
        const x = xScale(trial.smd);
        const y = yScale(trial.se);
        svg += `<circle cx="${x}" cy="${y}" r="6" fill="#22c55e" stroke="#fff" stroke-width="1"/>`;
      });

      // Axes
      svg += `<line x1="${margin.left}" y1="${الارتفاع - هامش.أسفل}" x2="${العرض - الهامش. اليمين}" y2="${الارتفاع - هامش.أسفل}" stroke="#1a365d" stroke-width="1"/>`;
      svg += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${الارتفاع - هامش.أسفل}" stroke="#1a365d" stroke-width="1"/>`;

      // X axis ticks
      [-0.4, -0.2, 0, 0.2, 0.4, 0.6, 0.8].forEach(smd => {
        const x = xScale(smd);
        svg += `<line x1="${x}" y1="${الارتفاع - هامش.أسفل}" x2="${x}" y2="${الارتفاع - هامش.أسفل + 5}" stroke="#1a365d"/>`;
        svg += `<text x="${x}" y="${الارتفاع - هامش.أسفل + 18}" text-anchor="middle" font-size="10" fill="#1a365d">${smd.toFixed(1)}</text>`;
      });

      // Y axis ticks
      [0.05, 0.15, 0.25, 0.35].forEach(se => {
        const y = yScale(se);
        svg += `<line x1="${margin.left - 5}" y1="${y}" x2="${margin.left}" y2="${y}" stroke="#1a365d"/>`;
        svg += `<text x="${margin.left - 10}" y="${y + 3}" text-anchor="end" font-size="10" fill="#1a365d">${se.toFixed(2)}</text>`;
      });

      // Axis labels
      svg += `<text x="${width/2}" y="${height - 10}" text-anchor="middle" font-size="12" fill="#1a365d">Standardized Mean Difference</text>`;
      svg += `<text x="15" y="${height/2}" text-anchor="middle" transform="rotate(-90, 15, ${height/2})" font-size="12" fill="#1a365d">Standard Error</text>`;

      // Legend
      svg += `<circle cx="${width - 120}" cy="${margin.top + 10}" r="5" fill="#22c55e"/>`;
      svg += `<text x="${width - 110}" y="${margin.top + 14}" font-size="10" fill="#1a365d">Published</text>`;
      svg += `<circle cx="${width - 120}" cy="${margin.top + 28}" r="6" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="3"/>`;
      svg += `<text x="${width - 110}" y="${margin.top + 32}" font-size="10" fill="#C53030">Missing?</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    // ============================================================
    // ACCESSIBILITY & UI HELPERS
    // ============================================================

    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('open');
      var btn = document.querySelector('.sidebar-toggle, .hamburger, .mobile-menu-btn'); if (btn) btn.setAttribute('aria-expanded', btn.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
    }

    function toggleGlossary() {
      const panel = document.getElementById('glossaryPanel');
      panel.classList.toggle('open');
      if (panel.classList.contains('open')) {
        document.getElementById('glossarySearch').focus();
      }
    }

    function filterGlossary() {
      const query = document.getElementById('glossarySearch').value.toLowerCase();
      const terms = document.querySelectorAll('.glossary-term');
      terms.forEach(term => {
        const text = term.textContent.toLowerCase();
        term.style.display = text.includes(query) ? 'block' : 'none';
      });
    }

    function toggleKeyboardHelp() {
      const help = document.getElementById('keyboardHelp');
      help.classList.toggle('open');
    }

    // Enhanced keyboard navigation
    document.addEventListener('keydown', (e) => {
      // Don'قم بتشغيل الاختصارات عند الكتابة في المدخلات إذا (e.target.tagName ==='INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') { إذا (e.key ==='Escape') { e.target.blur(); } يعود؛ } التبديل (e.key) { الحالة'ArrowRight':
        case ' ': if (!e.shiftKey) { e.preventDefault(); nextSlide(); } استراحة؛ قضية'ArrowLeft':
        case 'Backspace': e.preventDefault(); prevSlide(); استراحة؛ قضية'ArrowDown':
        case 'n':
        case 'N': if (currentModule < Modules.length - 1) { e.preventDefault(); goToModule(currentModule + 1); } استراحة؛ قضية'ArrowUp':
        case 'p':
        case 'P': if (currentModule > 0) { e.preventDefault(); goToModule(currentModule - 1); } استراحة؛ قضية't':
        case 'T': e.preventDefault(); toggleToolsPanel(); استراحة؛ قضية'g':
        case 'G': e.preventDefault(); toggleGlossary(); استراحة؛ قضية'?': e.preventDefault(); toggleKeyboardHelp(); استراحة؛ قضية'Escape':
          document.getElementById('glossaryPanel').classList.remove('open');
          document.getElementById('keyboardHelp').classList.remove('open');
          document.querySelector('.sidebar').classList.remove('open');
          document.getElementById('sidebarOverlay').classList.remove('open');
          break;
      }
    });

    // ============================================================
    // QUIZ SYSTEM
    // ============================================================

    function checkQuizAnswer(questionId, selectedIdx, correctIdx, explanations) {
      const options = document.querySelectorAll(`#${questionId} .quiz-option`);
      options.forEach((opt, i) => {
        opt.classList.remove('selected');
        opt.onclick = null; // Disable further clicks
        if (i === correctIdx) {
          opt.classList.add('correct');
        } else if (i === selectedIdx && selectedIdx !== correctIdx) {
          opt.classList.add('incorrect');
        }
      });

      // Show explanation
      const feedbackEl = document.getElementById(`${questionId}-feedback`);
      if (feedbackEl) {
        const isCorrect = selectedIdx === correctIdx;
        feedbackEl.style.display = 'block';
        feedbackEl.innerHTML = `
          <div style="padding: 0.75rem; margin-top: 0.5rem; border-radius: 6px; background: ${isCorrect ? 'rgba(34,197,94,0.1)' : 'rgba(197,48,48,0.1)'}; الحدود اليمنى: 3 بكسل صلب ${isCorrect ?'var(--green)' : 'var(--red)'};">
            <strong>${isCorrect ? 'Correct!' : 'Not quite.'}</strong> ${explanations[correctIdx]}
          </div>
        `;
      }
    }

    // ============================================================
    // INITIALIZE
    // ============================================================

    document.addEventListener('DOMContentLoaded', () => {
      initModuleList();

      // Load saved progress
      const savedProgress = loadProgress();
      if (savedProgress) {
        goToModule(savedProgress.module);
        if (savedProgress.slide > 0) {
          setTimeout(() => goToSlide(savedProgress.slide), 100);
        }
      } else {
        goToModule(0);
      }

      // Initialize spaced repetition
      initSpacedRepetition();
      updateReviewButtonStatus();

      // Check for daily review badge
      if (spacedRepetitionState.dailyReviewsCompleted >= 7) {
        earnBadge('daily_dedication');
      }

      // Show daily review prompt if due (with slight delay for UX)
      if (shouldShowDailyReview()) {
        setTimeout(() => {
          // Only auto-prompt if they've completed at least one module
          const completedModules = document.querySelectorAll('.module-item.completed').length;
          if (completedModules >= 1) {
            openDailyReview();
          }
        }, 2000);
      }

      // Auto-save on navigation
      const originalGoToModule = goToModule;
      goToModule = function(moduleId) {
        // Mark previous module as complete if we're progressing
        if (moduleId > currentModule) {
          markModuleComplete(currentModule);
        }
        originalGoToModule(moduleId);
        saveProgress();
      };

      const originalGoToSlide = goToSlide;
      goToSlide = function(index) {
        originalGoToSlide(index);
        saveProgress();
      };
    });
  </script>
</body>
</html>
