<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>証拠の逆転: メタ分析コース</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&amp;family=Source+Sans+Pro:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
<style>
    :root {
      --navy: #1E2761;
      --deep-navy: #141B3D;
      --gold: #D4AF37;
      --cream: #FAF8F5;
      --light-cream: #FFFFFF;
      --text: #2D3748;
      --light-text: #718096;
      --red: #C53030;
      --green: #22c55e;
      --transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
      font-family: 'Source Sans Pro', sans-serif;
      background: var(--deep-navy);
      color: var(--cream);
    }

    /* ====== COURSE SHELL ====== */
    .course-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* ====== SIDEBAR NAV ====== */
    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, var(--deep-navy) 0%, #0a0f1a 100%);
      border-right: 1px solid rgba(212,175,55,0.2);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .sidebar-header h1 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.25rem;
    }

    .sidebar-header p {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
    }

    .module-list {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
    }

    .module-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .module-item:hover {
      background: rgba(212,175,55,0.1);
    }

    .module-item.active {
      background: rgba(212,175,55,0.15);
      border-left-color: var(--gold);
    }

    .module-item.completed .module-number {
      background: var(--green);
      color: white;
    }

    .module-number {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .module-item.active .module-number {
      background: var(--gold);
      color: var(--navy);
    }

    .module-info {
      flex: 1;
      min-width: 0;
    }

    .module-title {
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .module-subtitle {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.7); /* Increased for WCAG AA contrast */
    }

    .sidebar-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(212,175,55,0.2);
      font-size: 0.75rem;
      color: rgba(255,255,255,0.4);
    }

    /* ====== MAIN CONTENT ====== */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .content-header {
      padding: 1rem 2rem;
      background: rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(212,175,55,0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .breadcrumb {
      font-size: 0.85rem;
      color: rgba(255,255,255,0.6);
    }

    .breadcrumb span {
      color: var(--gold);
    }

    .header-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      background: rgba(212,175,55,0.2);
      border-color: var(--gold);
    }

    .btn.primary {
      background: var(--gold);
      color: var(--navy);
      border-color: var(--gold);
      font-weight: 600;
    }

    .content-body {
      flex: 1;
      overflow: hidden;
      display: flex;
    }

    /* ====== SLIDES AREA ====== */
    .slides-container {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .module-slides {
      display: none;
      width: 100%;
      height: 100%;
    }

    .module-slides.active {
      display: block;
    }

    .slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start; /* Changed from center - prevents content clipping */
      align-items: center;
      padding: 2rem 2rem 5rem 2rem; /* Extra bottom clearance for nav bar */
      padding-top: 3rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition), visibility var(--transition);
      overflow-y: auto; /* Allow scrolling if content is tall */
      overflow-x: hidden;
    }

    /* Center content vertically only when there's enough space */
    .slide .content,
    .slide .refrain,
    .slide .title {
      margin-top: auto;
      margin-bottom: auto;
    }

    /* Ensure content doesn't overflow horizontally */
    .slide > * {
      max-width: 100%;
      word-wrap: break-word;
    }

    .slide.active {
      opacity: 1;
      visibility: visible;
    }

    .slide.dark { background: var(--deep-navy); color: var(--cream); }
    .slide.light { background: var(--cream); color: var(--text); }
    .slide.black { background: #000; color: var(--cream); }

    /* Typography */
    .serif { font-family: 'Cormorant Garamond', Georgia, serif; }

    .title {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 700;
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .title.navy { color: var(--navy); }
    .title.gold { color: var(--gold); }
    .title.cream { color: var(--cream); }

    .subtitle {
      font-size: clamp(1rem, 2vw, 1.5rem);
      color: var(--light-text);
      margin-bottom: 2rem;
    }

    .slide.dark .subtitle { color: rgba(255,255,255,0.7); }

    .big-number {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(4rem, 15vw, 10rem);
      font-weight: 700;
      line-height: 1;
    }

    .big-number.navy { color: var(--navy); }
    .big-number.gold { color: var(--gold); }

    .refrain {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      max-width: 800px;
    }

    /* Cards */
    .card {
      background: var(--light-cream);
      border: 1px solid var(--gold);
      padding: 1.5rem 2rem;
      margin: 0.75rem 0;
      max-width: 800px;
      width: 100%;
    }

    .card.navy-bg {
      background: var(--navy);
      color: var(--cream);
    }

    .card.red-border { border: 2px solid var(--red); }

    .card-label {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .card-text {
      font-size: clamp(0.9rem, 1.8vw, 1.1rem);
    }

    .card.navy-bg .card-text { color: var(--cream); }

    /* Stats grid */
    .stats-grid {
      display: flex;
      gap: 1rem;
      margin: 1.5rem 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .stat-box {
      background: var(--navy);
      color: var(--cream);
      padding: 1rem 1.5rem;
      text-align: center;
      min-width: 140px;
    }

    .stat-value {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 700;
    }

    .stat-label {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-top: 0.25rem;
    }

    /* Design grid */
    .design-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      max-width: 900px;
      width: 100%;
    }

    @media (max-width: 768px) {
      .design-grid { grid-template-columns: repeat(2, 1fr); }
    }

    .design-item {
      background: var(--light-cream);
      border-left: 3px solid var(--gold);
      padding: 1rem;
    }

    .design-item-label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }

    .design-item-value {
      font-size: 0.85rem;
      color: var(--text);
      line-height: 1.4;
    }

    /* Results table */
    .results-table {
      width: 100%;
      max-width: 700px;
      border-collapse: collapse;
      margin: 1rem 0;
    }

    .results-table th {
      background: var(--navy);
      color: var(--cream);
      padding: 0.75rem 1rem;
      text-align: left;
      font-weight: 600;
    }

    .results-table th:not(:first-child) { text-align: center; }

    .results-table td {
      padding: 0.6rem 1rem;
      border-bottom: 1px solid #E2E8F0;
    }

    .results-table td:not(:first-child) { text-align: center; }
    .results-table .highlight { color: var(--red); font-weight: 700; }

    /* Result box */
    .result-box {
      background: var(--navy);
      padding: 1rem 2rem;
      text-align: center;
      margin: 1rem 0;
      max-width: 500px;
    }

    .result-box .value {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 700;
      color: var(--gold);
    }

    .result-box .label {
      font-size: 0.9rem;
      color: var(--cream);
      margin-top: 0.25rem;
    }

    /* Lesson items */
    .lesson-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin: 0.75rem 0;
      max-width: 800px;
    }

    .lesson-number {
      background: var(--gold);
      color: var(--navy);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }

    .lesson-content h4 {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .lesson-content p {
      font-size: 0.9rem;
      color: var(--light-text);
    }

    /* Gold line */
    .gold-line {
      width: 150px;
      height: 2px;
      background: var(--gold);
      margin: 1.5rem auto;
    }

    /* Closing lines */
    .closing-line {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.2rem, 2.5vw, 1.75rem);
      margin: 0.5rem 0;
      text-align: center;
    }

    .closing-line.gold { color: var(--gold); font-weight: 700; }
    .closing-line.italic { font-style: italic; opacity: 0.9; }

    /* Focus box */
    .focus-box {
      background: var(--navy);
      padding: 1rem 2rem;
      text-align: center;
      max-width: 600px;
    }

    .focus-box .main {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem;
      font-style: italic;
      color: var(--gold);
    }

    .focus-box .sub {
      font-size: 0.9rem;
      color: var(--cream);
      margin-top: 0.5rem;
    }

    /* Arrow */
    .arrow { color: var(--light-text); font-size: 1.2rem; margin: 0.25rem 0; }
    .footnote { font-size: 0.75rem; color: var(--light-text); font-style: italic; text-align: center; margin-top: 1rem; }
    .red { color: var(--red); }
    .text-center { text-align: center; }
    .mb-1 { margin-bottom: 1rem; }
    .mb-2 { margin-bottom: 2rem; }
    .mt-1 { margin-top: 1rem; }
    .mt-2 { margin-top: 2rem; }

    /* Content wrapper */
    .content {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 1000px;
    }

    /* Animation */
    .slide.active .animate { animation: fadeUp 0.6s ease-out forwards; }
    .slide.active .animate.delay-1 { animation-delay: 0.1s; }
    .slide.active .animate.delay-2 { animation-delay: 0.2s; }
    .slide.active .animate.delay-3 { animation-delay: 0.3s; }
    .slide.active .animate.delay-4 { animation-delay: 0.4s; }
    .slide.active .animate.delay-5 { animation-delay: 0.5s; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate { opacity: 0; }

    /* ====== SLIDE NAV ====== */
    /* Minimal floating arrows - no background strip */
    .slide-nav {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      padding: 1rem 1rem 1.5rem 1rem;
      z-index: 100;
      pointer-events: none; /* Allow clicks through to content */
    }

    .nav-btn {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 1.25rem;
      cursor: pointer;
      opacity: 0.6;
      transition: all 0.2s;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      pointer-events: auto; /* Buttons are clickable */
    }

    .nav-btn:hover {
      opacity: 1;
      background: rgba(0,0,0,0.7);
      border-color: var(--gold);
    }
    .nav-btn:disabled { opacity: 0.2; cursor: not-allowed; }

    /* Center info (counter + progress) - compact */
    .nav-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      pointer-events: none; /* Don't block quiz/content clicks beneath */
    }

    .slide-counter {
      font-size: 0.75rem;
      opacity: 0.6;
    }

    .progress { display: flex; gap: 4px; }

    .progress-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(255,255,255,0.25);
      cursor: pointer;
      transition: all 0.2s;
      pointer-events: auto; /* Only dots are clickable, not the whole nav-center */
    }

    .progress-dot.active {
      background: var(--gold);
      transform: scale(1.3);
    }

    .progress-dot:hover {
      background: rgba(255,255,255,0.5);
    }

    .progress-dot:hover { background: rgba(255,255,255,0.6); }

    .slide-counter {
      color: rgba(255,255,255,0.6);
      font-size: 0.85rem;
      min-width: 50px;
      text-align: center;
    }

    /* ====== TOOLS PANEL ====== */
    .tools-panel {
      width: 380px;
      max-width: 40vw; /* Limit to 40% of viewport so content isn't squeezed too much */
      background: var(--cream);
      border-left: 1px solid rgba(0,0,0,0.1);
      display: none; /* Hidden by default */
      flex-direction: column;
      flex-shrink: 0;
      overflow-y: auto;
    }

    .tools-panel.visible {
      display: flex;
    }

    .tools-panel.collapsed {
      width: 50px;
    }

    /* Adjust slide padding when tools panel is open */
    .content-body.tools-open .slide {
      padding-left: 1.5rem;
      padding-right: 1.5rem;
    }

    .content-body.tools-open .slide .content {
      max-width: 100%;
    }

    .tools-header {
      padding: 1rem;
      background: var(--navy);
      color: var(--cream);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tools-header h3 {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .tools-content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    /* Live Story Data Panel */
    .story-data-panel {
      background: linear-gradient(135deg, #1E2761 0%, #141B3D 100%);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      color: white;
    }

    .story-data-panel h4 {
      color: var(--gold);
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .story-toggle {
      display: flex;
      background: rgba(255,255,255,0.1);
      border-radius: 25px;
      padding: 4px;
      margin-bottom: 1rem;
    }

    .story-toggle button {
      flex: 1;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 20px;
      background: transparent;
      color: rgba(255,255,255,0.7);
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .story-toggle button.active {
      background: var(--gold);
      color: var(--navy);
    }

    .story-toggle button:hover:not(.active) {
      background: rgba(255,255,255,0.15);
      color: white;
    }

    .story-viz {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      min-height: 200px;
      transition: all 0.5s ease;
    }

    .story-viz svg {
      transition: all 0.5s ease;
    }

    .story-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }

    .story-metric {
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .story-metric.highlight-good {
      background: rgba(34, 197, 94, 0.3);
      border: 1px solid rgba(34, 197, 94, 0.5);
    }

    .story-metric.highlight-bad {
      background: rgba(197, 48, 48, 0.3);
      border: 1px solid rgba(197, 48, 48, 0.5);
    }

    .story-metric .value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
    }

    .story-metric .label {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.7);
      margin-top: 0.25rem;
    }

    .story-insight {
      background: rgba(212,175,55,0.2);
      border-left: 3px solid var(--gold);
      padding: 0.75rem;
      border-radius: 0 8px 8px 0;
      margin-top: 0.75rem;
      font-size: 0.75rem;
      line-height: 1.5;
    }

    /* ====== PREDICT FIRST INTERFACE ====== */
    .predict-first-panel {
      background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(30,39,97,0.3));
      border: 1px solid var(--gold);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      margin-top: 0.5rem;
    }

    .predict-first-panel .predict-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .predict-first-panel h4 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .predict-first-panel p {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.9);
      line-height: 1.4;
    }

    .predict-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .predict-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      border: 2px solid;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(0,0,0,0.2);
    }

    .predict-btn.benefit {
      border-color: #22c55e;
      color: #22c55e;
    }

    .predict-btn.benefit:hover {
      background: rgba(34,197,94,0.2);
    }

    .predict-btn.neutral {
      border-color: #94a3b8;
      color: #94a3b8;
    }

    .predict-btn.neutral:hover {
      background: rgba(148,163,184,0.2);
    }

    .predict-btn.harm {
      border-color: #ef4444;
      color: #ef4444;
    }

    .predict-btn.harm:hover {
      background: rgba(239,68,68,0.2);
    }

    .predict-icon-small {
      font-size: 1rem;
    }

    /* Prediction Feedback */
    .prediction-feedback {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .prediction-feedback.correct {
      background: rgba(34,197,94,0.2);
      border: 1px solid #22c55e;
      color: #22c55e;
    }

    .prediction-feedback.incorrect {
      background: rgba(239,68,68,0.15);
      border: 1px solid #ef4444;
      color: #fca5a5;
    }

    .feedback-icon {
      font-size: 1rem;
    }

    /* ====== PROGRESS DASHBOARD ====== */
    .progress-dashboard {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(5px);
      z-index: 2000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .progress-dashboard.open {
      display: flex;
    }

    .dashboard-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 1px solid var(--gold);
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(212,175,55,0.3);
    }

    .dashboard-header h2 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1.3rem;
    }

    .dashboard-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      opacity: 0.7;
    }

    .dashboard-close:hover { opacity: 1; }

    .level-display {
      background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(212,175,55,0.05));
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .level-badge {
      display: inline-block;
      background: var(--gold);
      color: var(--navy);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.8rem;
      margin-bottom: 0.5rem;
    }

    .points-display {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--gold);
    }

    .points-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .stat-card {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--gold);
    }

    .stat-label {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.6);
      margin-top: 0.25rem;
    }

    .principles-section h3, .badges-section h3, .streak-section h3 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .principle-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem;
      background: rgba(255,255,255,0.03);
      border-radius: 6px;
      margin-bottom: 0.35rem;
    }

    .principle-num {
      width: 20px;
      height: 20px;
      background: rgba(212,175,55,0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      color: var(--gold);
      flex-shrink: 0;
    }

    .principle-num.mastered {
      background: var(--gold);
      color: var(--navy);
    }

    .principle-text {
      flex: 1;
      font-size: 0.7rem;
      color: rgba(255,255,255,0.8);
    }

    .badges-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .badge {
      width: 44px;
      height: 44px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      opacity: 0.3;
      position: relative;
    }

    .badge.earned {
      opacity: 1;
      background: rgba(212,175,55,0.2);
      border-color: var(--gold);
    }

    .badge-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--navy);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.6rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .badge:hover .badge-tooltip {
      opacity: 1;
    }

    .streak-display {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
    }

    .streak-flame { font-size: 2rem; }

    .streak-count {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--gold);
    }

    .streak-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
    }

    .dashboard-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.6rem 0.75rem;
      background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.05));
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      color: var(--gold);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 0.5rem;
    }

    .dashboard-btn:hover {
      background: linear-gradient(135deg, rgba(212,175,55,0.25), rgba(212,175,55,0.1));
      border-color: var(--gold);
    }

    /* ====== DAILY REVIEW MODAL ====== */
    .daily-review-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 1rem;
    }

    .daily-review-modal.open {
      display: flex;
    }

    .daily-review-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 2px solid var(--gold);
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .daily-review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(212,175,55,0.3);
    }

    .daily-review-header h2 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1.5rem;
      margin: 0;
    }

    .daily-review-close {
      background: none;
      border: none;
      color: rgba(255,255,255,0.6);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .daily-review-close:hover {
      color: white;
    }

    .review-timer {
      text-align: center;
      margin-bottom: 1rem;
    }

    .timer-display {
      font-size: 2rem;
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
    }

    .timer-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    .review-progress {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      transition: all 0.3s;
    }

    .progress-dot.current {
      background: var(--gold);
      transform: scale(1.2);
    }

    .progress-dot.completed {
      background: #22c55e;
    }

    .review-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(212,175,55,0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .review-principle-num {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(212,175,55,0.2);
      border-radius: 50%;
      color: var(--gold);
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .review-principle-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.25rem;
      color: var(--cream);
      font-style: italic;
      margin-bottom: 1rem;
    }

    .review-question {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
    }

    .review-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .review-option {
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      font-size: 0.85rem;
    }

    .review-option:hover {
      background: rgba(212,175,55,0.15);
      border-color: var(--gold);
    }

    .review-option.correct {
      background: rgba(34,197,94,0.2);
      border-color: #22c55e;
    }

    .review-option.incorrect {
      background: rgba(239,68,68,0.2);
      border-color: #ef4444;
    }

    .review-option.selected {
      border-width: 2px;
    }

    .review-feedback {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .review-feedback.correct {
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.3);
      color: #86efac;
    }

    .review-feedback.incorrect {
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.3);
      color: #fca5a5;
    }

    .review-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      margin-top: 1rem;
    }

    .review-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .review-btn.skip {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: rgba(255,255,255,0.6);
    }

    .review-btn.skip:hover {
      border-color: rgba(255,255,255,0.5);
      color: white;
    }

    .review-btn.next {
      background: var(--gold);
      border: none;
      color: var(--navy);
      font-weight: 600;
    }

    .review-btn.next:hover {
      background: #e6c94a;
    }

    .review-summary {
      text-align: center;
    }

    .summary-score {
      font-size: 3rem;
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
    }

    .summary-text {
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
    }

    .summary-breakdown {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin: 1rem 0;
    }

    .summary-stat {
      text-align: center;
    }

    .summary-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .summary-stat-value.correct-val { color: #22c55e; }
    .summary-stat-value.incorrect-val { color: #ef4444; }

    .summary-stat-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    .review-streak-bonus {
      margin-top: 1rem;
      padding: 0.75rem;
      background: rgba(212,175,55,0.15);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .review-streak-bonus .flame { font-size: 1.5rem; }
    .review-streak-bonus .text { color: var(--gold); font-size: 0.9rem; }

    .daily-review-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.5rem 0.75rem;
      background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.05));
      border: 1px solid rgba(34,197,94,0.3);
      border-radius: 6px;
      color: #86efac;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 0.75rem;
    }

    .daily-review-btn:hover {
      background: linear-gradient(135deg, rgba(34,197,94,0.25), rgba(34,197,94,0.1));
      border-color: #22c55e;
    }

    .daily-review-btn.pending {
      animation: gentlePulse 2s infinite;
    }

    @keyframes gentlePulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(34,197,94,0.3); }
      50% { box-shadow: 0 0 0 6px rgba(34,197,94,0); }
    }

    /* ====== BRANCHING SCENARIOS ====== */
    .scenario-panel {
      background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(30,39,97,0.2));
      border: 2px solid rgba(124,58,237,0.4);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .scenario-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .scenario-icon { font-size: 1.5rem; }
    .scenario-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      color: #7C3AED;
      font-weight: 600;
    }

    .scenario-situation {
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--navy);
    }

    .scenario-question {
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--navy);
    }

    .scenario-choices {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .scenario-choice {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.8);
      border: 2px solid rgba(124,58,237,0.2);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .scenario-choice:hover:not(.answered) { background: rgba(124,58,237,0.1); border-color: rgba(124,58,237,0.5); }
    .scenario-choice.selected { border-color: #7C3AED; background: rgba(124,58,237,0.15); }
    .scenario-choice.correct { border-color: #22c55e; background: rgba(34,197,94,0.15); }
    .scenario-choice.incorrect { border-color: #ef4444; background: rgba(239,68,68,0.1); }

    .choice-letter {
      min-width: 24px; height: 24px; border-radius: 50%;
      background: rgba(124,58,237,0.2); color: #7C3AED;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 0.8rem;
    }
    .scenario-choice.correct .choice-letter { background: #22c55e; color: white; }
    .scenario-choice.incorrect .choice-letter { background: #ef4444; color: white; }
    .choice-text { flex: 1; font-size: 0.9rem; color: var(--navy); }

    .scenario-consequence {
      margin-top: 1rem; padding: 1rem; border-radius: 10px; display: none;
    }
    .scenario-consequence.visible { display: block; }
    .scenario-consequence.good { background: rgba(34,197,94,0.15); border: 1px solid rgba(34,197,94,0.3); }
    .scenario-consequence.bad { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); }
    .scenario-consequence.neutral { background: rgba(217,119,6,0.1); border: 1px solid rgba(217,119,6,0.3); }

    .consequence-title { font-weight: 700; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
    .scenario-consequence.good .consequence-title { color: #059669; }
    .scenario-consequence.bad .consequence-title { color: #dc2626; }
    .scenario-consequence.neutral .consequence-title { color: #d97706; }
    .consequence-text { font-size: 0.9rem; line-height: 1.5; }
    .consequence-lesson { margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed currentColor; font-style: italic; opacity: 0.9; }

    /* ====== CONFIDENCE CALIBRATION ====== */
    .confidence-section {
      margin-top: 1rem; padding: 0.75rem;
      background: rgba(212,175,55,0.1); border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);
    }
    .confidence-label { font-size: 0.8rem; color: var(--gold); margin-bottom: 0.5rem; }
    .confidence-slider-container { display: flex; align-items: center; gap: 0.75rem; }
    .confidence-slider {
      flex: 1; -webkit-appearance: none; height: 6px; border-radius: 3px;
      background: linear-gradient(to right, #ef4444, #eab308, #22c55e); outline: none;
    }
    .confidence-slider::-webkit-slider-thumb {
      -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: white; border: 2px solid var(--gold); cursor: pointer;
    }
    .confidence-value { min-width: 45px; font-size: 0.85rem; font-weight: 700; color: var(--gold); }
    .confidence-labels { display: flex; justify-content: space-between; font-size: 0.65rem; color: rgba(255,255,255,0.6); margin-top: 0.25rem; }

    /* ====== ANALOGY SYSTEM ====== */
    .analogy-card {
      background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(30,39,97,0.1));
      border: 1px solid rgba(212,175,55,0.4);
      border-radius: 12px;
      padding: 1rem;
      margin: 1rem 0;
    }
    .analogy-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
    .analogy-icon { font-size: 1.25rem; }
    .analogy-title { font-weight: 600; color: var(--gold); font-size: 0.9rem; }
    .analogy-concept { font-size: 0.75rem; color: rgba(255,255,255,0.6); }
    .analogy-text { font-size: 0.9rem; line-height: 1.5; font-style: italic; }

    /* ====== MISCONCEPTION CHALLENGE ====== */
    .misconception-challenge {
      background: linear-gradient(135deg, rgba(239,68,68,0.08), rgba(30,39,97,0.12));
      border: 2px solid rgba(239,68,68,0.25);
      border-radius: 12px;
      padding: 1.25rem;
      margin: 1rem 0;
    }
    .misconception-header { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: #dc2626; margin-bottom: 0.75rem; }
    .misconception-statement {
      font-size: 1rem; font-style: italic; color: var(--navy);
      margin-bottom: 1rem; padding: 0.75rem; background: rgba(255,255,255,0.85); border-radius: 8px;
    }
    .misconception-buttons { display: flex; gap: 0.75rem; justify-content: center; }
    .misconception-btn {
      padding: 0.6rem 1.5rem; border-radius: 8px; font-weight: 600;
      cursor: pointer; transition: all 0.2s; border: 2px solid;
    }
    .misconception-btn.true-btn { background: rgba(34,197,94,0.1); border-color: #22c55e; color: #059669; }
    .misconception-btn.false-btn { background: rgba(239,68,68,0.1); border-color: #ef4444; color: #dc2626; }
    .misconception-btn:hover { transform: scale(1.05); }
    .misconception-btn.correct { background: #22c55e; color: white; border-color: #22c55e; }
    .misconception-btn.wrong { background: #ef4444; color: white; border-color: #ef4444; }
    .misconception-result { margin-top: 1rem; padding: 0.75rem; border-radius: 8px; display: none; }
    .misconception-result.visible { display: block; }
    .misconception-result.correct { background: rgba(34,197,94,0.15); color: #059669; }
    .misconception-result.incorrect { background: rgba(239,68,68,0.1); color: #dc2626; }

    /* ====== PRACTICE PROBLEMS ====== */
    .practice-problem {
      background: linear-gradient(135deg, rgba(15,91,106,0.08), rgba(30,39,97,0.12));
      border: 2px solid rgba(15,91,106,0.3);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .practice-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .practice-category {
      background: rgba(15,91,106,0.2);
      color: #0f5b6a;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .practice-title {
      font-weight: 700;
      color: var(--navy);
      font-size: 1.1rem;
    }
    .practice-scenario {
      background: rgba(255,255,255,0.9);
      padding: 1rem;
      border-radius: 10px;
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--text);
      margin-bottom: 1rem;
    }
    .practice-question {
      color: var(--navy);
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    .practice-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .practice-option {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.95);
      border: 2px solid rgba(30,39,97,0.15);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      font-family: inherit;
      font-size: 0.9rem;
    }
    .practice-option:hover:not(:disabled) {
      border-color: var(--navy);
      transform: translateX(4px);
    }
    .practice-option .option-letter {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--navy);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.8rem;
      flex-shrink: 0;
    }
    .practice-option.correct {
      border-color: #22c55e;
      background: rgba(34,197,94,0.1);
    }
    .practice-option.correct .option-letter {
      background: #22c55e;
    }
    .practice-option.incorrect {
      border-color: #ef4444;
      background: rgba(239,68,68,0.08);
    }
    .practice-option.incorrect .option-letter {
      background: #ef4444;
    }
    .practice-option:disabled {
      cursor: default;
      opacity: 0.8;
    }
    .practice-feedback {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 10px;
      display: none;
      line-height: 1.6;
    }
    .practice-feedback.visible {
      display: block;
    }
    .practice-feedback.correct {
      background: rgba(34,197,94,0.12);
      border: 1px solid rgba(34,197,94,0.3);
      color: #047857;
    }
    .practice-feedback.incorrect {
      background: rgba(239,68,68,0.08);
      border: 1px solid rgba(239,68,68,0.2);
      color: #b91c1c;
    }
    .practice-feedback p {
      margin: 0.5rem 0;
    }
    .practice-feedback .principle-link {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(0,0,0,0.1);
      font-size: 0.85rem;
      color: var(--navy);
    }

    .story-insight strong {
      color: var(--gold);
    }

    .no-story-data {
      text-align: center;
      padding: 2rem 1rem;
      color: rgba(255,255,255,0.5);
      font-size: 0.8rem;
    }

    @keyframes pulseGold {
      0%, 100% { box-shadow: 0 0 0 0 rgba(212,175,55,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(212,175,55,0); }
    }

    .story-data-panel.updating {
      animation: pulseGold 0.5s ease;
    }

    .tool-section {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .tool-section-header {
      padding: 0.75rem 1rem;
      background: #f7fafc;
      border-bottom: 1px solid #e2e8f0;
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--navy);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tool-section-body {
      padding: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(212,175,55,0.2);
    }

    .btn-small {
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #e2e8f0;
      background: white;
      color: var(--text);
    }

    .btn-small.primary {
      background: var(--navy);
      color: white;
      border-color: var(--navy);
    }

    /* Study input table */
    .study-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .study-table th,
    .study-table td {
      padding: 0.4rem;
      border: 1px solid #e2e8f0;
      text-align: center;
    }

    .study-table th {
      background: #f7fafc;
      font-weight: 600;
    }

    .study-table input {
      width: 100%;
      padding: 0.25rem;
      border: 1px solid #e2e8f0;
      border-radius: 2px;
      font-size: 0.75rem;
      text-align: center;
    }

    /* Results display */
    .results-display {
      background: #f7fafc;
      border-radius: 6px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      padding: 0.4rem 0;
      font-size: 0.8rem;
      border-bottom: 1px solid #e2e8f0;
    }

    .result-row:last-child { border-bottom: none; }
    .result-row .label { color: var(--light-text); }
    .result-row .value { font-weight: 600; color: var(--navy); }

    /* Forest plot container */
    .forest-plot-container {
      margin-top: 1rem;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 1rem;
      overflow-x: auto;
    }

    /* Hide tools panel on small screens */
    @media (max-width: 1200px) {
      .tools-panel { display: none; }
      .sidebar { width: 60px; }
      .sidebar .module-info,
      .sidebar .sidebar-header p,
      .sidebar .sidebar-footer { display: none; }
      .sidebar .sidebar-header h1 { font-size: 1rem; }
    }

    /* Leap badge */
    .leap-badge {
      background: var(--red);
      color: white;
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      font-weight: 700;
      position: absolute;
      right: -10px;
      top: 50%;
      transform: translateY(-50%);
    }

    .card-wrapper {
      position: relative;
      max-width: 800px;
      width: 100%;
    }

    /* Wrong items */
    .wrong-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      background: var(--light-cream);
      padding: 1rem;
      margin: 0.5rem 0;
      max-width: 800px;
      width: 100%;
    }

    .wrong-number {
      background: var(--navy);
      color: var(--cream);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    /* Quiz styles */
    .quiz-container {
      max-width: 700px;
      width: 100%;
    }

    .quiz-question {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
    }

    .quiz-question h4 {
      font-size: 1rem;
      color: var(--navy);
      margin-bottom: 1rem;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .quiz-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      /* Accessibility: make focusable for keyboard nav */
      padding: 0.75rem 1rem;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quiz-option:hover {
      background: #f7fafc;
      border-color: var(--gold);
    }

    .quiz-option.selected {
      background: rgba(212,175,55,0.1);
      border-color: var(--gold);
    }

    .quiz-option.correct {
      background: rgba(34,197,94,0.1);
      border-color: var(--green);
    }

    .quiz-option.incorrect {
      background: rgba(197,48,48,0.1);
      border-color: var(--red);
    }

    /* RoB Domain Styles */
    .rob-domains {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .rob-domain {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .rob-domain label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text);
    }

    .rob-domain select {
      padding: 0.4rem;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 0.8rem;
    }

    /* GRADE factor styles */
    .grade-factors .form-group label {
      font-size: 0.75rem;
      color: var(--text);
    }

    .grade-factors select {
      font-size: 0.75rem;
    }

    /* Red text utility */
    .result-row .value.red {
      color: var(--red);
      font-weight: 700;
    }

    /* Interactive Investigation Exercises */
    .investigation-box {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 900px;
      width: 100%;
      margin: 1rem 0;
    }

    .investigation-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      color: var(--gold);
    }

    .investigation-header .icon {
      font-size: 1.5rem;
    }

    .investigation-header h3 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0;
    }

    .investigation-prompt {
      font-style: italic;
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
      font-size: 1.05rem;
      line-height: 1.5;
    }

    .data-table-investigation {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: 0.85rem;
    }

    .data-table-investigation th,
    .data-table-investigation td {
      padding: 0.5rem 0.75rem;
      border: 1px solid rgba(212,175,55,0.3);
      text-align: center;
      color: var(--cream);
    }

    .data-table-investigation th {
      background: rgba(212,175,55,0.2);
      color: var(--gold);
      font-weight: 600;
    }

    .data-table-investigation tr:nth-child(even) {
      background: rgba(255,255,255,0.05);
    }

    .reveal-btn {
      background: var(--gold);
      color: var(--navy);
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
      transition: all 0.2s;
    }

    .reveal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(212,175,55,0.3);
    }

    .hidden-reveal {
      display: none;
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(197,48,48,0.1);
      border-left: 3px solid var(--red);
      color: var(--cream);
    }

    .hidden-reveal.visible {
      display: block;
      animation: fadeUp 0.4s ease-out;
    }

    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 1rem 0;
    }

    .comparison-panel {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .comparison-panel h4 {
      color: var(--gold);
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .comparison-panel.after {
      border-color: var(--red);
    }

    .comparison-panel.after h4 {
      color: var(--red);
    }

    /* Rhetorical question styling */
    .rhetorical {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.3rem, 3vw, 1.8rem);
      font-style: italic;
      color: rgba(255,255,255,0.9);
      text-align: center;
      max-width: 700px;
      margin: 1rem 0;
    }

    /* Direct address styling */
    .direct-address {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.2rem;
      color: var(--gold);
      border-left: 3px solid var(--gold);
      padding-left: 1rem;
      margin: 1rem 0;
      font-style: italic;
    }

    /* Mini forest plot for exercises */
    .mini-forest {
      background: white;
      border-radius: 8px;
      padding: 0.75rem;
      margin-top: 0.5rem;
    }

    /* ============================================================
       ACCESSIBILITY IMPROVEMENTS
       ============================================================ */

    /* Focus states for keyboard navigation */
    *:focus {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }

    *:focus:not(:focus-visible) {
      outline: none;
    }

    *:focus-visible {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }

    .quiz-option:focus-visible,
    .btn:focus-visible,
    .module-item:focus-visible,
    .nav-btn:focus-visible {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }

    /* Skip to content link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--gold);
      color: var(--navy);
      padding: 8px 16px;
      z-index: 1000;
      font-weight: 600;
      text-decoration: none;
      border-radius: 0 0 4px 0;
    }

    .skip-link:focus {
      top: 0;
    }

    /* Screen reader only text */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Improved color contrast for accessibility */
    .light-text-accessible {
      color: #a0aec0; /* Lighter for better contrast on dark */
    }

    /* ============================================================
       MOBILE RESPONSIVE (< 768px)
       ============================================================ */

    .mobile-menu-btn {
      display: none;
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1001;
      background: var(--gold);
      color: var(--navy);
      border: none;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      font-size: 1.2rem;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: block;
      }

      .sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        height: 100vh;
        z-index: 1000;
        transition: left 0.3s ease;
      }

      .sidebar.open {
        left: 0;
      }

      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
      }

      .sidebar-overlay.open {
        display: block;
      }

      .content-header {
        padding-left: 4rem;
      }

      .tools-panel {
        width: 100%;
        right: -100%;
      }

      .tools-panel.open {
        right: 0;
      }

      .slide .content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
    }

    /* ============================================================
       GLOSSARY PANEL
       ============================================================ */

    .glossary-btn {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      background: var(--navy);
      color: var(--gold);
      border: 2px solid var(--gold);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .glossary-btn:hover {
      background: var(--gold);
      color: var(--navy);
    }

    /* Story Data Indicator Button */
    .story-indicator-btn {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background: linear-gradient(135deg, #1E2761 0%, #141B3D 100%);
      color: var(--gold);
      border: 2px solid var(--gold);
      border-radius: 25px;
      padding: 0.5rem 1rem;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      z-index: 100;
      display: none;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .story-indicator-btn.visible {
      display: flex;
    }

    .story-indicator-btn:hover {
      background: var(--gold);
      color: var(--navy);
      transform: translateY(-2px);
    }

    .story-indicator-btn.pulse {
      animation: pulseBtn 2s infinite;
    }

    @keyframes pulseBtn {
      0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 0 0 rgba(212,175,55,0.4); }
      50% { box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 0 8px rgba(212,175,55,0); }
    }

    .story-indicator-dot {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .glossary-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 0;
      background: var(--deep-navy);
      border-top: 2px solid var(--gold);
      z-index: 999;
      overflow: hidden;
      transition: height 0.3s ease;
    }

    .glossary-panel.open {
      height: 50vh;
    }

    .glossary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .glossary-header h3 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
    }

    .glossary-close {
      background: none;
      border: none;
      color: var(--cream);
      font-size: 1.5rem;
      cursor: pointer;
    }

    .glossary-search {
      padding: 0.75rem 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .glossary-search input {
      width: 100%;
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.9rem;
    }

    .glossary-content {
      padding: 1rem 1.5rem;
      overflow-y: auto;
      height: calc(50vh - 120px);
    }

    .glossary-term {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .glossary-term dt {
      color: var(--gold);
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
    }

    .glossary-term dd {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* ============================================================
       KEYBOARD SHORTCUTS HELP
       ============================================================ */

    .keyboard-help {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--deep-navy);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 2rem;
      z-index: 1001;
      display: none;
      min-width: 300px;
      max-width: 90vw;
    }

    .keyboard-help.open {
      display: block;
    }

    .keyboard-help h3 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      margin-bottom: 1rem;
      text-align: center;
    }

    .keyboard-help-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .keyboard-help-key {
      background: rgba(255,255,255,0.1);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.85rem;
    }

    /* ============================================================
       LEARNING OBJECTIVES BOX
       ============================================================ */

    .learning-objectives {
      background: rgba(212,175,55,0.1);
      border: 1px solid var(--gold);
      border-radius: 8px;
      padding: 1rem 1.5rem;
      margin: 1rem 0;
      max-width: 700px;
    }

    .learning-objectives h4 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .learning-objectives ul {
      margin: 0;
      padding-left: 1.25rem;
    }

    .learning-objectives li {
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    /* ============================================================
       DECISION TREE STORIES (Quranic Storytelling)
       ============================================================ */

    .story-box {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid var(--gold);
      border-radius: 16px;
      padding: 2rem;
      max-width: 900px;
      width: 100%;
      margin: 1rem 0;
    }

    .story-opener {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.4rem, 3vw, 2rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      margin-bottom: 1.5rem;
      line-height: 1.4;
    }

    .story-opener::before {
      content: '"';
      font-size: 1.5em;
      opacity: 0.5;
    }

    .story-opener::after {
      content: '"';
      font-size: 1.5em;
      opacity: 0.5;
    }

    .real-data-box {
      background: rgba(255,255,255,0.05);
      border-left: 4px solid #3b82f6;
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      border-radius: 0 8px 8px 0;
    }

    .real-data-box h4 {
      color: #60a5fa;
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .real-data-box h4::before {
      content: '📊';
    }

    .real-data-box p {
      color: var(--cream);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .real-data-box .data-highlight {
      color: var(--gold);
      font-weight: 700;
    }

    .decision-tree {
      background: rgba(212,175,55,0.1);
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .decision-tree-header {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.2rem;
      color: var(--gold);
      margin-bottom: 1rem;
      text-align: center;
      font-weight: 600;
    }

    .decision-scenario {
      background: rgba(0,0,0,0.3);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-style: italic;
      color: rgba(255,255,255,0.9);
      text-align: center;
    }

    .decision-paths {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    @media (max-width: 768px) {
      .decision-paths {
        grid-template-columns: 1fr;
      }
    }

    .decision-path {
      padding: 1.25rem;
      border-radius: 8px;
      position: relative;
    }

    .decision-path.path-a {
      background: rgba(197, 48, 48, 0.15);
      border: 2px solid rgba(197, 48, 48, 0.5);
    }

    .decision-path.path-b {
      background: rgba(34, 197, 94, 0.15);
      border: 2px solid rgba(34, 197, 94, 0.5);
    }

    .path-label {
      font-weight: 700;
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .decision-path.path-a .path-label {
      color: #f87171;
    }

    .decision-path.path-b .path-label {
      color: #4ade80;
    }

    .path-choice {
      font-size: 0.95rem;
      color: var(--cream);
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .path-arrow {
      color: rgba(255,255,255,0.5);
      text-align: center;
      margin: 0.5rem 0;
      font-size: 1.2rem;
    }

    .path-consequence {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      line-height: 1.5;
    }

    .path-outcome {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255,255,255,0.2);
      font-weight: 700;
    }

    .decision-path.path-a .path-outcome {
      color: #f87171;
    }

    .decision-path.path-b .path-outcome {
      color: #4ade80;
    }

    .decision-path:focus {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }

    .story-revelation {
      background: linear-gradient(135deg, rgba(212,175,55,0.3), rgba(212,175,55,0.1));
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 1.5rem;
      text-align: center;
    }

    .revelation-label {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.15em;
      margin-bottom: 0.75rem;
    }

    .revelation-text {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.1rem, 2.5vw, 1.4rem);
      color: var(--cream);
      line-height: 1.5;
      font-weight: 600;
    }

    .story-timeline {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }

    .timeline-point {
      background: rgba(255,255,255,0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      color: rgba(255,255,255,0.8);
    }

    .timeline-point.critical {
      background: rgba(197, 48, 48, 0.3);
      border: 1px solid rgba(197, 48, 48, 0.5);
      color: #fca5a5;
    }

    .timeline-point.resolution {
      background: rgba(34, 197, 94, 0.3);
      border: 1px solid rgba(34, 197, 94, 0.5);
      color: #86efac;
    }

    /* ============================================================
       REDUCED MOTION (Accessibility)
       ============================================================ */

    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }

      .animate {
        animation: none !important;
        opacity: 1 !important;
      }

      .slide {
        transition: none !important;
      }
    }

    /* ============================================================
       PRINT STYLESHEET
       ============================================================ */

    @media print {
      .sidebar,
      .content-header,
      .slide-nav,
      .tools-panel,
      .glossary-btn,
      .glossary-panel,
      .mobile-menu-btn,
      .keyboard-help,
      .btn,
      .nav-btn,
      .reveal-btn {
        display: none !important;
      }

      .course-container {
        display: block;
        height: auto;
      }

      .main-content {
        display: block;
      }

      .content-body {
        display: block;
      }

      .slides-container {
        display: block;
        height: auto;
        overflow: visible;
      }

      .module-slides {
        display: block !important;
      }

      .slide {
        display: block !important;
        page-break-inside: avoid;
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #ccc;
      }

      .slide.dark,
      .slide.black {
        background: white !important;
        color: black !important;
      }

      .slide.dark *,
      .slide.black * {
        color: black !important;
      }

      .refrain,
      .title {
        color: #1E2761 !important;
      }

      .gold-line {
        background: #D4AF37 !important;
      }

      body {
        background: white;
        color: black;
      }
    }

    /* ============================================================
       TIER SYSTEM — Clinician | Researcher | Methodologist
       ============================================================ */
    .tier-selector {
      display: flex;
      gap: 2px;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }
    .tier-btn {
      flex: 1;
      padding: 0.4rem 0.25rem;
      font-size: 0.65rem;
      font-weight: 600;
      text-align: center;
      border: 1px solid rgba(212,175,55,0.3);
      background: transparent;
      color: rgba(255,255,255,0.6);
      cursor: pointer;
      transition: all 0.2s;
      border-radius: 4px;
    }
    .tier-btn:hover { background: rgba(212,175,55,0.1); color: var(--cream); }
    .tier-btn.active {
      background: var(--gold);
      color: var(--navy);
      border-color: var(--gold);
    }
    .tier-btn .tier-icon { display: block; font-size: 1rem; margin-bottom: 2px; }

    /* Tier visibility: slides tagged data-tier="methods" or "mastery" */
    [data-tier="methods"],
    [data-tier="mastery"] {
      display: none;
    }
    body.tier-researcher [data-tier="methods"] { display: flex; }
    body.tier-methodologist [data-tier="methods"],
    body.tier-methodologist [data-tier="mastery"] { display: flex; }
    /* Foundation slides always visible — no data-tier attr needed */

    /* Tier badge shown on slides */
    .tier-badge {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      font-size: 0.65rem;
      font-weight: 700;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      z-index: 2;
    }
    .tier-badge.methods {
      background: rgba(59,130,246,0.2);
      color: #60a5fa;
      border: 1px solid rgba(59,130,246,0.3);
    }
    .tier-badge.mastery {
      background: rgba(168,85,247,0.2);
      color: #c084fc;
      border: 1px solid rgba(168,85,247,0.3);
    }
    .slide.light .tier-badge.methods {
      background: rgba(59,130,246,0.1);
      color: #2563eb;
      border-color: rgba(59,130,246,0.3);
    }
    .slide.light .tier-badge.mastery {
      background: rgba(168,85,247,0.1);
      color: #7c3aed;
      border-color: rgba(168,85,247,0.3);
    }
  </style>
</head>
<body>
<!-- Skip to content link for accessibility -->
<a class="skip-link" href="#main-content">Skip to content</a>
<!-- Mobile menu button -->
<button aria-expanded="false" aria-label="Toggle navigation menu" class="mobile-menu-btn" onclick="toggleSidebar()">☰</button>
<!-- Mobile sidebar overlay -->
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
<!-- Glossary button -->
 ストーリー データ インジケーター 
<button aria-label="ストーリーデータの表示" class="story-indicator-btn pulse" id="storyIndicatorBtn" onclick="openToolsWithStory()">
<span class="story-indicator-dot"></span>
<span>📊 利用可能なライブ データ</span>
</button>
<button aria-label="Open glossary" class="glossary-btn" onclick="toggleGlossary()" title="Glossary (press G)">📖</button>
<!-- Glossary Panel -->
<div aria-label="Glossary" class="glossary-panel" id="glossaryPanel" role="dialog">
<div class="glossary-header">
<h3>Glossary of Terms</h3>
<button aria-label="Close glossary" class="glossary-close" onclick="toggleGlossary()">×</button>
</div>
<div class="glossary-search">
<input aria-label="Search glossary" id="glossarySearch" onkeyup="filterGlossary()" placeholder="Search terms..." type="text"/>
</div>
<div class="glossary-content" id="glossaryContent">
<dl>
<div class="glossary-term" data-term="meta-analysis">
<dt>Meta-Analysis</dt>
<dd>同じ質問に対処する複数の独立した研究の結果を組み合わせて統合推定値を生成する統計手法。</dd>
</div>
<div class="glossary-term" data-term="systematic review">
<dt>Systematic Review</dt>
<dd>包括的で再現性のある明示的な方法を使用して、特定の質問に関するすべての関連研究を特定、選択、評価、総合する文献レビュー。</dd>
</div>
<div class="glossary-term" data-term="pico">
<dt>PICO</dt>
<dd>Framework for formulating clinical questions: Population, Intervention, Comparator, Outcome.</dd>
</div>
<div class="glossary-term" data-term="heterogeneity">
<dt>Heterogeneity</dt>
<dd>偶然に予想されるものを超える研究結果のばらつき。 I²、τ²、および Q 統計によって測定されます。</dd>
</div>
<div class="glossary-term" data-term="i-squared">
<dt>I² (I-squared)</dt>
<dd>サンプリング誤差ではなく不均一性に起因する、効果推定値の変動のパーセンテージ。 0 ～ 25%: 低、25 ～ 50%: 中程度、50 ～ 75%: かなり、75 ～ 100%: かなり。</dd>
</div>
<div class="glossary-term" data-term="tau-squared">
<dt>τ² (Tau-squared)</dt>
<dd>変量効果モデルにおける研究間の分散。効果サイズスケールにおける不均一性の絶対的な大きさを測定します。</dd>
</div>
<div class="glossary-term" data-term="fixed effect">
<dt>Fixed Effect Model</dt>
<dd>すべての研究が同じ真の効果を推定していると仮定します。逆分散（精度）によって研究を重み付けします。大規模な研究が多数を占めます。</dd>
</div>
<div class="glossary-term" data-term="random effects">
<dt>Random Effects Model</dt>
<dd>研究は、分布から異なるが関連する効果を推定すると仮定します。研究間の分散 (τ²) を重みに組み込みます。</dd>
</div>
<div class="glossary-term" data-term="forest plot">
<dt>Forest Plot</dt>
<dd>個々の研究とプールされた推定値からの効果量を信頼区間付きでグラフ表示します。</dd>
</div>
<div class="glossary-term" data-term="funnel plot">
<dt>Funnel Plot</dt>
<dd>A scatter plot of effect size vs. standard error. Asymmetry may indicate publication bias or small-study effects.</dd>
</div>
<div class="glossary-term" data-term="publication bias">
<dt>Publication Bias</dt>
<dd>陽性/有意な結果が得られた研究が、ヌル/陰性の研究よりも多く発表される傾向があります。</dd>
</div>
<div class="glossary-term" data-term="egger test">
<dt>Egger's Test</dt>
<dd>A regression test for funnel plot asymmetry. P &lt; 0.10 suggests potential small-study effects or publication bias.</dd>
</div>
<div class="glossary-term" data-term="trim and fill">
<dt>Trim-and-Fill</dt>
<dd>期限切れの欠落研究の数を推定する方法</dd>
</div>
<div class="glossary-term" data-term="risk of bias">
<dt>Risk of Bias (RoB)</dt>
<dd>結果に影響を与える可能性のある、研究計画、実施、または報告における系統的エラーの評価。 RoB 2.0 は、RCT 用のコクラン ツールです。</dd>
</div>
<div class="glossary-term" data-term="robins-i">
<dt>ROBINS-I</dt>
<dd>介入の非ランダム化研究におけるバイアスのリスク。観察研究におけるバイアスを評価するためのコクラン ツール。</dd>
</div>
<div class="glossary-term" data-term="grade">
<dt>GRADE</dt>
<dd>推奨事項、評価、開発および評価の等級付け。証拠の確実性を評価するためのフレームワーク (高、中、低、非常に低)。</dd>
</div>
<div class="glossary-term" data-term="prediction interval">
<dt>Prediction Interval</dt>
<dd>研究間の不均一性を考慮した、新しい研究で期待される効果の範囲。信頼区間より広い。</dd>
</div>
<!-- NNT defined in new glossary section below with fuller definition -->
<div class="glossary-term" data-term="nnh">
<dt>NNH (Number Needed to Harm)</dt>
<dd>さらに 1 人の患者が害を受けるために治療が必要な患者の数。 NNH = 1/ARI.</dd>
</div>
<div class="glossary-term" data-term="hksj">
<dt>HKSJ Adjustment</dt>
<dd>ハルトゥング-ナップ-シディク-ヨンクマン調整。変量効果モデルの信頼区間に t 分布を使用し、少数の研究でより適切な範囲を提供します。</dd>
</div>
<div class="glossary-term" data-term="prospero">
<dt>PROSPERO</dt>
<dd>International prospective register of systematic reviews. Pre-registration prevents post-hoc methodological changes.</dd>
</div>
<div class="glossary-term" data-term="prisma">
<dt>PRISMA</dt>
<dd>システマティック レビューおよびメタ分析に推奨されるレポート項目。フロー図とチェックリストを含むレポート ガイドライン。</dd>
</div>
<div class="glossary-term" data-term="nma">
<dt>Network Meta-Analysis (NMA)</dt>
<dd>共通の比較器による直接的および間接的な証拠を使用して複数の治療法を同時に比較する方法。</dd>
</div>
<div class="glossary-term" data-term="sucra">
<dt>SUCRA</dt>
<dd>累積ランキング曲線の下の表面。 NMA の治療を 0% (最悪) から 100% (最高) までランク付けします。</dd>
</div>
<div class="glossary-term" data-term="ipd">
<dt>IPD Meta-Analysis</dt>
<dd>個々の患者データのメタ分析。公開された概要ではなく、試験からの生の患者レベルのデータを使用します。サブグループ分析のゴールドスタンダード。</dd>
</div>
<div class="glossary-term" data-term="dta">
<dt>DTA Meta-Analysis</dt>
<dd>Diagnostic Test Accuracy meta-analysis. Synthesizes sensitivity and specificity using bivariate models.</dd>
</div>
<div class="glossary-term" data-term="sroc">
<dt>SROC Curve</dt>
<dd>Summary Receiver Operating Characteristic curve. Used in DTA meta-analysis to display pooled sensitivity/specificity.</dd>
</div>
<div class="glossary-term" data-term="iceman">
<dt>ICEMAN</dt>
<dd>効果修飾分析の信頼性を評価するためのツール。サブグループ分析の信頼性を評価します。</dd>
</div>
<div class="glossary-term" data-term="tsa">
<dt>試験逐次分析 (TSA)</dt>
<dd>累積メタ分析に停止境界を適用して、十分な証拠がいつ蓄積されたかを判断する方法。</dd>
</div>
<div class="glossary-term" data-term="living review">
<dt>リビング・システマティック・レビュー</dt>
<dd>新しい証拠として継続的に更新されるレビュー</dd>
</div>
 高度なモジュール用語集の用語 
<div class="glossary-term" data-term="bayesian"><dt>Bayesian Meta-Analysis</dt>
<dd>ベイズの定理を使用したメタ分析: 事前信念とデータ (尤度) を組み合わせて、効果パラメーターの事後分布を生成します。</dd></div>
<div class="glossary-term" data-term="prior"><dt>Prior Distribution</dt>
<dd>データを見る前のパラメータに関する信念を表す確率分布。曖昧、情報力が弱い、または有益である可能性があります。</dd></div>
<div class="glossary-term" data-term="posterior"><dt>Posterior Distribution</dt>
<dd>事前分布とデータ尤度を組み合わせた後の更新された確率分布。すべてのベイズ推論の基礎。</dd></div>
<div class="glossary-term" data-term="credible interval"><dt>Credible Interval</dt>
<dd>信頼区間のベイズ類似物。 95% CrI は、パラメーターが区間内にある確率が 95% であることを意味します。</dd></div>
<div class="glossary-term" data-term="mcmc"><dt>MCMC (Markov Chain Monte Carlo)</dt>
<dd>分析解が利用できない場合に事後分布からサンプルを抽出するための計算手法。ツール: JAGS、Stan、PyMC。</dd></div>
<div class="glossary-term" data-term="bayes factor"><dt>Bayes Factor</dt>
<dd>2 つの仮説を比較する周辺尤度の比。 BF10 &gt; 10 = H1 の強力な証拠。ベイジアン テストの p 値を置き換えます。</dd></div>
<div class="glossary-term" data-term="transitivity"><dt>Transitivity</dt>
<dd>核となる NMA 仮定: 効果修飾子がネットワーク内の比較全体に同様に分布している場合、間接比較は有効です。</dd></div>
<div class="glossary-term" data-term="consistency"><dt>Consistency (NMA)</dt>
<dd>直接証拠と間接証拠の間の合意。ノード分割 (ローカル) または治療ごとの設計相互作用 (グローバル) を介してテストされます。</dd></div>
<div class="glossary-term" data-term="p-score"><dt>P-score</dt>
<dd>NMA における SUCRA の頻度主義的類似体。ある治療法が他のすべての治療法より優れているという確信度の平均を測定します。</dd></div>
<div class="glossary-term" data-term="component nma"><dt>Component NMA</dt>
<dd>Decomposes multi-component interventions to estimate individual component effects. Uses additive models.</dd></div>
<div class="glossary-term" data-term="ecological bias"><dt>Ecological Bias</dt>
<dd>研究レベルの関連性が患者レベルの関連性と異なる場合に発生します。研究内の効果と研究間の効果を分離できるのは IPD だけです。</dd></div>
<div class="glossary-term" data-term="one-stage"><dt>One-Stage IPD Model</dt>
<dd>単一の混合効果モデルをすべての患者データに同時に適合させます。 2 段階よりも相互作用やまれなイベントに対して強力です。</dd></div>
<div class="glossary-term" data-term="two-stage"><dt>Two-Stage IPD Model</dt>
<dd>Analyze each study separately, then combine estimates. Simpler but potentially loses information compared to one-stage.</dd></div>
<div class="glossary-term" data-term="dose-response"><dt>Dose-Response Meta-Analysis</dt>
<dd>研究全体にわたる被ばく線量と結果の関係をモデル化します。線形回帰、多項式回帰、またはスプライン回帰を使用します。</dd></div>
<div class="glossary-term" data-term="restricted cubic spline"><dt>Restricted Cubic Splines (RCS)</dt>
<dd>事前に指定された線量点にノットがある区分多項式曲線。境界ノットを越えた直線。柔軟な用量反応モデリングに使用されます。</dd></div>
<div class="glossary-term" data-term="fragility index"><dt>Fragility Index</dt>
<dd>The minimum number of patient outcome changes needed to flip a statistically significant result to non-significant. Lower = more fragile.</dd></div>
<div class="glossary-term" data-term="gosh"><dt>GOSH Plot</dt>
<dd>研究の不均一性のグラフィック概要。影響力のある研究とクラスターを明らかにするために、考えられるすべての研究サブセットのプール効果と I² をプロットします。</dd></div>
<div class="glossary-term" data-term="contour funnel"><dt>Contour-Enhanced Funnel Plot</dt>
<dd>影付きの有意性等高線を持つファネル プロット (p&lt;0.01、0.05、0.10)。出版バイアスを非対称性の他の原因から区別するのに役立ちます。</dd></div>
<div class="glossary-term" data-term="copas"><dt>Copas Selection Model</dt>
<dd>研究出版の確率を SE と効果の大きさの関数としてモデル化します。真の効果と選択メカニズムを共同で推定します。</dd></div>
<div class="glossary-term" data-term="pet-peese"><dt>PET-PEESE</dt>
<dd>精度効果テスト / 標準誤差による精度効果推定。小規模研究の効果と出版バイアスに関する回帰ベースのテスト。</dd></div>
<div class="glossary-term" data-term="progress-plus"><dt>PROGRESS-Plus</dt>
<dd>Framework for assessing equity: Place, Race, Occupation, Gender, Religion, Education, SES, Social capital, plus age, disability, orientation.</dd></div>
<div class="glossary-term" data-term="prisma-equity"><dt>PRISMA-Equity</dt>
<dd>株式に焦点を当てた体系的レビューのための PRISMA の拡張。恵まれない集団と適用性に関する報告が必要です。</dd></div>
<div class="glossary-term" data-term="transportability"><dt>Transportability</dt>
<dd>試験結果が試験サンプルとは異なる対象集団に適用される程度。試験データの重みを再設定する方法が存在します。</dd></div>
<div class="glossary-term" data-term="active learning"><dt>Active Learning (Screening)</dt>
<dd>人間によるレビューに最も有益な引用を繰り返し選択し、それぞれの決定から学習してランキングを向上させる ML アプローチ。</dd></div>
<div class="glossary-term" data-term="wss"><dt>WSS@95%</dt>
<dd>Work Saved over Sampling at 95% recall. Measures screening automation efficiency: what percentage of citations can be safely skipped.</dd></div>
<div class="glossary-term" data-term="meta-ethnography"><dt>Meta-Ethnography</dt>
<dd>研究全体の概念を翻訳して新しい解釈を生み出す定性合成手法 (Noblit &amp; Hare 1988)フレームワーク。</dd></div>
<div class="glossary-term" data-term="cerqual"><dt>CERQual</dt>
<dd>定性的研究のレビューからの証拠への信頼。方法論的な制限、一貫性、適切性、および関連性を通じて信頼性を評価します。</dd></div>
<div class="glossary-term" data-term="thematic synthesis"><dt>Thematic Synthesis</dt>
<dd>研究全体にわたる結果をコード化し、分析テーマを生成する定性的アプローチ。メタエスノグラフィーとグラウンデッド・セオリーの要素を組み合わせます。</dd></div>
<div class="glossary-term" data-term="rve"><dt>RVE (Robust Variance Estimation)</dt>
<dd>研究内の真の相関関係を知ることなく、依存効果の大きさの有効な標準誤差を提供するサンドイッチ型推定器。</dd></div>
<div class="glossary-term" data-term="three-level model"><dt>Three-Level Model</dt>
<dd>入れ子効果のサンプリング (L1)、研究内 (L2)、および研究間 (L3) 成分に分散を分割するマルチレベル モデルサイズ。</dd></div>
<div class="glossary-term" data-term="reproducibility"><dt>Reproducibility</dt>
<dd>同じデータ + 同じコード = 同じ結果。あらゆる定量分析の最低基準。複製可能性 (新しいデータ、同じメソッド) とは区別されます。</dd></div>
<div class="glossary-term" data-term="proof-carrying number"><dt>Proof-Carrying Number</dt>
<dd>完全な来歴チェーンにバンドルされた数値結果: 入力データのハッシュ、変換コード、バリデーターの結果、監査証跡。</dd></div>
<div class="glossary-term" data-term="evidence hashing"><dt>Evidence Hashing</dt>
<dd>入力データと変更を検出するコードの暗号化フィンガープリント (SHA-256)。証明番号のコアコンポーネント。</dd></div>
<div class="glossary-term" data-term="bma"><dt>Bayesian Model Averaging (BMA)</dt>
<dd>Weights multiple models (FE, RE, etc.) by their posterior probability rather than choosing one. Accounts for model uncertainty.</dd></div>
<div class="glossary-term" data-term="half-cauchy"><dt>Half-Cauchy Prior</dt>
<dd>不均一性パラメーター タウに一般的に使用される以前のファミリー。確率をゼロ近くに集中させながら大きな値を許可しますが、スケールの選択は効果の測定基準と臨床状況に応じて正当化される必要があります。</dd></div>
<div class="glossary-term" data-term="league table"><dt>League Table</dt>
<dd>NMA output showing all pairwise comparisons in a matrix. Upper/lower triangles show effect estimates and credible intervals.</dd></div>
<div class="glossary-term" data-term="node-splitting"><dt>Node-Splitting</dt>
<dd>各比較の直接証拠と間接証拠を比較する NMA のローカル不一致テスト。有意な差は、推移性の違反を示唆しています。</dd></div>
<div class="glossary-term" data-term="sick-quitter bias"><dt>Sick-Quitter Bias</dt>
<dd>元ユーザー (病気のため辞めた) が非ユーザーとして分類されるときに発生し、非ユーザー グループが実際よりも病気であるように見えます。</dd></div>
<div class="glossary-term" data-term="knots"><dt>Knots (Spline)</dt>
<dd>Pre-specified dose points where polynomial segments join in restricted cubic splines. Typically 3-5 knots placed at dose distribution quantiles.</dd></div>
<div class="glossary-term" data-term="scoping-review"><dt>Scoping Review</dt>
<dd>ある分野における研究活動の範囲、範囲、性質をマッピングする証拠合成の一種。 PCC (人口、概念、コンテキスト) フレームワークを使用します。 PRISMA-ScRで報告。品質の評価や結果のプールは行いません。</dd></div>
<div class="glossary-term" data-term="umbrella-review"><dt>Umbrella Review</dt>
<dd>トピックに関する既存の系統的レビューのレビュー。 AMSTAR 2 を使用してレビューの品質を評価し、ROBIS を使用してバイアスのリスクを評価します。 「レビューの概要」とも呼ばれます。修正対象エリア (CCA) 法を使用して研究の重複を修正します。</dd></div>
<div class="glossary-term" data-term="cluster-rct"><dt>Cluster-Randomized Trial</dt>
<dd>個人ではなくグループ (病院、学校、コミュニティ) をランダム化する試験。設計効果 = 1 + (m−1) × ICC による調整が必要です。ここで、m はクラスター サイズ、ICC はクラスター内相関です。クラスタリングを無視すると精度が高まります。</dd></div>
<div class="glossary-term" data-term="crossover-trial"><dt>Crossover Trial</dt>
<dd>各参加者が両方の治療を順番に (ウォッシュアウト期間あり) 受ける試験。一対の分析により分散が減少します。正しいメタ分析プーリングには患者内相関またはペア SE が必要です。</dd></div>
<div class="glossary-term" data-term="design-effect"><dt>Design Effect (DEFF)</dt>
<dd>単純なランダム サンプリングでの分散に対するクラスター サンプリングでの分散の比率。 DEFF = 1 + (m−1) × ICC。メタ分析でプールする前に、クラスターランダム化試験からのサンプル サイズと標準誤差を調整するために使用されます。</dd></div>
<div class="glossary-term" data-term="hazard-ratio"><dt>Hazard Ratio (HR)</dt>
<dd>イベント発生までの時間分析における 2 つのグループ間のハザード率の比。 HR &lt; 1 は治療を好みます。逆分散重み付けを使用して対数スケールにプールされます。 95% CI から導出された SE: SE = (ln(上) − ln(下)) / 3.92.</dd></div>
<div class="glossary-term" data-term="masem"><dt>MASEM (Meta-Analytic SEM)</dt>
<dd>メタ分析構造方程式モデリング。 2 段階の方法: (1) 研究全体で相関行列をプールする、(2) プールされた行列に構造方程式モデルを当てはめる。複数の研究にわたる理論的パス モデルをテストするために使用されます。</dd></div>
<div class="glossary-term" data-term="nnt"><dt>Number Needed to Treat (NNT)</dt>
<dd>さらに 1 人の患者が利益を得るためには治療が必要な患者の数。 NNT = 1 / 絶対的なリスクの削減。ベースラインリスクによって異なります。臨床的解釈を可能にするために、常に OR または RR と並行して報告してください。</dd></div>
<div class="glossary-term" data-term="power-ma"><dt>Power in Meta-Analysis</dt>
<dd>特定のサイズの真の効果を検出する確率。研究の数、研究の規模、不均一性 (τ²)、および効果の大きさによって異なります。メタ分析用の検出力計算ツールは存在します (Valentine et al. 2010 など)。異質性の高いスタディは、電力を大幅に削減します。</dd></div>
</dl>
</div>
</div>
<!-- Keyboard shortcuts help -->
<div aria-label="Keyboard shortcuts" class="keyboard-help" id="keyboardHelp" role="dialog">
<h3>Keyboard Shortcuts</h3>
<div class="keyboard-help-item">
<span>Next slide</span>
<span class="keyboard-help-key">→ or Space</span>
</div>
<div class="keyboard-help-item">
<span>Previous slide</span>
<span class="keyboard-help-key">← or Backspace</span>
</div>
<div class="keyboard-help-item">
<span>Next module</span>
<span class="keyboard-help-key">↓ or N</span>
</div>
<div class="keyboard-help-item">
<span>Previous module</span>
<span class="keyboard-help-key">↑ or P</span>
</div>
<div class="keyboard-help-item">
<span>ツール パネルの切り替え</span>
<span class="keyboard-help-key">T</span>
</div>
<div class="keyboard-help-item">
<span>Toggle glossary</span>
<span class="keyboard-help-key">G</span>
</div>
<div class="keyboard-help-item">
<span>This help</span>
<span class="keyboard-help-key">?</span>
</div>
<div class="keyboard-help-item">
<span>Close dialogs</span>
<span class="keyboard-help-key">Esc</span>
</div>
<button class="btn" onclick="toggleKeyboardHelp()" style="margin-top: 1rem; width: 100%;">Close</button>
</div>
<div class="course-container">
<!-- Sidebar Navigation -->
<nav aria-label="モジュールナビゲーション" class="sidebar" role="navigation">
<div class="sidebar-header">
<a href="index.html" onmouseout="this.style.color='rgba(212,175,55,0.7)'" onmouseover="this.style.color='#D4AF37'" style="display:block;font-size:0.7rem;color:rgba(212,175,55,0.7);text-decoration:none;margin-bottom:0.5rem;">← Course Library</a>
<h1>証拠逆転コース</h1>
<p>Meta-Analysis Methods</p>
</div>
<div class="module-list" id="moduleList">
 JS によって生成されたモジュール項目 
</div>
<!-- Tier Selector -->
<div aria-label="Content depth level" class="tier-selector" role="radiogroup">
<button aria-checked="true" class="tier-btn active" data-tier="foundation" onclick="setTier('foundation')" role="radio">
<span class="tier-icon">🩺</span>Clinician
        </button>
<button aria-checked="false" class="tier-btn" data-tier="researcher" onclick="setTier('researcher')" role="radio">
<span class="tier-icon">🔬</span>Researcher
        </button>
<button aria-checked="false" class="tier-btn" data-tier="methodologist" onclick="setTier('methodologist')" role="radio">
<span class="tier-icon">🧮</span>Methodologist
        </button>
</div>
<div class="sidebar-footer">
<button class="dashboard-btn" onclick="openDashboard()">
<span>📊</span>
<span>Progress Dashboard</span>
<span id="sidebarPoints" style="margin-left: auto; font-weight: 700;">0 pts</span>
</button>
<button class="daily-review-btn" id="dailyReviewBtn" onclick="openDailyReview()">
<span>🧠</span>
<span>Daily Review</span>
<span id="reviewStatus" style="margin-left: auto;">Ready</span>
</button>
<p style="text-align: center; margin-bottom: 0.5rem;">Progress: <span id="progressPercent">0%</span></p>
<button class="btn" onclick="resetProgress()" style="padding: 0.25rem 0.5rem; font-size: 0.7rem; width: 100%;">Reset Progress</button>
</div>
</nav>
 進行状況ダッシュボード モーダル 
<div class="progress-dashboard" id="progressDashboard">
<div class="dashboard-content">
<div class="dashboard-header">
<h2>Your Progress</h2>
<button class="dashboard-close" onclick="closeDashboard()">×</button>
</div>
<div class="level-display">
<div class="level-badge" id="levelBadge">Level 1: Novice</div>
<div class="points-display" id="totalPoints">0</div>
<div class="points-label">Total Points</div>
</div>
<div class="stats-grid">
<div class="stat-card">
<div class="stat-value" id="modulesCompleted">0/25</div>
<div class="stat-label">Modules</div>
</div>
<div class="stat-card">
<div class="stat-value" id="predictionsCorrect">0/0</div>
<div class="stat-label">Predictions</div>
</div>
<div class="stat-card">
<div class="stat-value" id="quizzesCompleted">0</div>
<div class="stat-label">Quizzes</div>
</div>
</div>
<div class="principles-section">
<h3>7 つの原則</h3>
<div id="principlesList"></div>
</div>
<div class="badges-section">
<h3>Badges Earned</h3>
<div class="badges-grid" id="badgesGrid"></div>
</div>
<div class="streak-section">
<h3>Learning Streak</h3>
<div class="streak-display">
<div class="streak-flame" id="streakFlame">🔥</div>
<div class="streak-info">
<div class="streak-count" id="streakCount">0 days</div>
<div class="streak-label">Keep learning daily!</div>
</div>
</div>
</div>
</div>
</div>
 毎日の復習モーダル 
<div aria-label="毎日のレビュー" class="daily-review-modal" id="dailyReviewModal" role="dialog">
<div class="daily-review-content">
<div class="daily-review-header">
<h2>📚 Daily Review</h2>
<button class="daily-review-close" onclick="closeDailyReview()">×</button>
</div>
<div class="review-timer">
<div class="timer-display" id="reviewTimer">2:00</div>
<div class="timer-label">記憶力を強化</div>
</div>
<div class="review-progress" id="reviewProgress">
<!-- Progress dots inserted by JS -->
</div>
<div id="reviewCardContainer">
 JS によって挿入されたカードを復習する 
</div>
<div class="review-actions" id="reviewActions">
<button class="review-btn skip" onclick="skipDailyReview()">今日はスキップ</button>
<button class="review-btn next" disabled="" id="reviewNextBtn" onclick="nextReviewQuestion()">Continue</button>
</div>
</div>
</div>
<!-- Main Content -->
<main class="main-content">
<header class="content-header">
<div class="breadcrumb">
          Module <span id="currentModuleNum">0</span>: <span id="currentModuleName">The Opening</span>
</div>
<div class="header-actions">
<button class="btn" onclick="toggleToolsPanel()">Tools</button>
<button class="btn primary" onclick="nextModule()">Next Module</button>
</div>
</header>
<div class="content-body">
<!-- Accessibility: Screen reader announcements for slide changes -->
<div aria-atomic="true" aria-live="polite" class="sr-only" id="slideAnnouncer"></div>
<!-- Slides Container -->
<div aria-label="コーススライド" class="slides-container" id="main-content" role="region">
 モジュール 0:冒頭 
<div class="module-slides active" data-module="0">
<div class="slide dark active" data-index="0">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 0:冒頭</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>メタ分析を定義し、証拠合成におけるその役割を説明します</li>
<li>研究をプールすべきでない場合を特定します</li>
<li>証拠の階層構造と体系的レビューの場所について説明します座る</li>
<li>Recognize that meta-analysis can mislead when done poorly</li>
<li>このコースを支える 7 つの原則を思い出してください</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">このコースが存在するのは、</p>
<p class="title gold animate delay-1 text-center">医学が間違っていたからです。</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                一度もありません。めったにありません。繰り返し。証拠がしっかりしていると信じていた患者を殺害する方法で。
              </p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">What is Meta-Analysis?</h2>
<div class="card animate delay-1">
<p class="card-text text-center">
                    同じ質問に対処する複数の独立した研究の結果を組み合わせるための統計的手法。
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">1976</div>
<div class="stat-label">Term coined by Gene Glass</div>
</div>
<div class="stat-box">
<div class="stat-value">~50,000</div>
<div class="stat-label">Published per year</div>
</div>
<div class="stat-box">
<div class="stat-value">#1</div>
<div class="stat-label">Evidence hierarchy*</div>
</div>
</div>
<p class="footnote animate delay-3">*When well conducted. Quality of conduct matters more than study design alone — as GRADE recognizes.</p>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">研究をプールする理由</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Increase Statistical Power</h4>
<p>Individual studies may be too small to detect effects.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Improve Precision</h4>
<p>Narrower confidence intervals around effect estimates.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Resolve Disagreement</h4>
<p>研究が矛盾する場合、プールすることでシグナルを明確にすることができます。</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Explore Heterogeneity</h4>
<p>Identify why effects differ across populations or settings.</p>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="title cream animate text-center">But meta-analysis can also</p>
<p class="big-number gold animate delay-1">MISLEAD</p>
<p class="animate delay-2" style="font-size: 1.1rem; text-align: center; max-width: 600px; margin-top: 1rem;">
                When done poorly, it amplifies bias rather than truth.
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">プールしない場合</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p>研究では根本的に異なるものを測定します（リンゴとoranges)</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p>Extreme heterogeneity that cannot be explained</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p>One study dominates all others (megastudy problem)</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p>研究には調整できないバイアスのリスクが高く、</p>
</div>
<div class="focus-box animate delay-5 mt-2">
<p class="main">プールは権利ではなく特権です。</p>
<p class="sub">The decision to combine must be defended.</p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">証拠の階層</h2>
<div style="max-width: 600px; margin-top: 1.5rem;">
<div class="card animate delay-1" style="background: var(--gold); color: var(--navy);">
<p class="card-text text-center" style="font-weight: 700;">Systematic Reviews &amp; Meta-Analyses of RCTs</p>
</div>
<div class="card animate delay-2">
<p class="card-text text-center">Randomized Controlled Trials</p>
</div>
<div class="card animate delay-3">
<p class="card-text text-center">Cohort Studies</p>
</div>
<div class="card animate delay-4">
<p class="card-text text-center">Case-Control Studies</p>
</div>
<div class="card animate delay-5">
<p class="card-text text-center">Case Series / Expert Opinion</p>
</div>
</div>
<p class="footnote animate delay-5">階層内の位置は研究の種類ではなく方法論の質に依存します。</p>
</div>
</div>
<div class="slide dark" data-index="7">
<p class="title cream animate text-center">このコースは、</p>
<p class="title gold animate delay-1 text-center">evidence reversals.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1rem; text-align: center; max-width: 700px;">
                を通して教えます。各モジュールは、医学がどのように間違っていたかという物語から始まります。次に、危害を防止できたであろう方法を学びます。
              </p>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">7 つの原則</h2>
<p class="animate delay-1" style="font-style: italic; margin-bottom: 1.5rem;">
                  次のフレーズが旅の途中で繰り返されます:
                </p>
<div style="text-align: left; max-width: 700px;">
<p class="animate delay-1" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">1.</span> 「すべての信号が真実であるわけではありません。」</p>
<p class="animate delay-2" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">2.</span> 「方法は患者を私たちの信頼から守るものです。」</p>
<p class="animate delay-3" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">3.</span> "What was hidden in plain sight?"</p>
<p class="animate delay-3" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">4.</span> 「出所のない数字は数字ではありません」 "</p>
<p class="animate delay-4" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">5.</span> 「異質性はノイズではなくメッセージです。"</p>
<p class="animate delay-4" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">6.</span> "証拠の不在は不在の証拠ではありません。"</p>
<p class="animate delay-5" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">7.</span> "Certainty must be earned, not assumed."</p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Module 0 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q0-1">
<h4>1.メタ分析で研究をプールしてはいけない場合があるのはなぜですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 0, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>A.</span> Pooling is always better than single studies
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 1, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>B.</span> When heterogeneity is extreme or studies measure different things
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 2, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>C.</span> Pooling is always appropriate for RCTs
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-1', 3, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
<span>D.</span> Statistical methods handle any situation
                      </div>
</div>
<div id="q0-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q0-2" style="margin-top: 1.5rem;">
<h4>2. RCT の系統的レビューは証拠階層のどこに位置しますか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 0, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>A.</span> At the top
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 1, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>B.</span> Same level as individual RCTs
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 2, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>C.</span> コホート研究の下
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q0-2', 3, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
<span>D.</span> Same as expert opinion
                      </div>
</div>
<div id="q0-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="10">
<p class="refrain animate">旅を始めましょう。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 1: 質問</p>
</div>
<!-- Slide nav generated by JS -->
</div>
 モジュール 1: 質問(CAST) 
<div class="module-slides" data-module="1">
<div class="slide dark active" data-index="0">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">これはエラーについての話ではありません。</p>
<p class="title gold animate delay-1 text-center">これは確実性についての話です。</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 1: 質問</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>系統的レビューのために焦点を絞った PICO の質問を作成します</li>
<li>Distinguish surrogate outcomes from patient-important outcomes</li>
<li>Explain why biological plausibility alone is insufficient evidence</li>
<li>CAST 試験とその証拠に基づく影響について説明します薬</li>
<li>原則を適用する: 「すべての明るい兆候が導きであるわけではない」</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">~9,000</p>
<p class="subtitle animate delay-1">excess deaths per year</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">From a treatment everyone believed worked.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">これは、私たちがどのように信じたか、そしてどのように間違っていたのかについての物語です。</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Observation</h2>
<div class="card animate delay-1">
<p class="card-text text-center">Patients with frequent PVCs after MI had 2-5x higher mortality.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">400,000+</div>
<div class="stat-label">MI survivors/year</div>
</div>
<div class="stat-box">
<div class="stat-value">~40%</div>
<div class="stat-label">重要な PVC が含まれています</div>
</div>
<div class="stat-box">
<div class="stat-value">160,000</div>
<div class="stat-label">at elevated risk</div>
</div>
</div>
<p class="footnote animate delay-3">A massive clinical need. A clear target.</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">The Response</h2>
<p class="animate delay-1" style="font-size: 1.2rem; text-align: center; margin: 1rem 0;">
                  Antiarrhythmic drugs were developed, FDA approved,<br/>and prescribed to ~200,000 patients per year.
                </p>
<div class="focus-box animate delay-2">
<p class="main">この物語には悪役は登場しません。</p>
<p class="sub">全員が行動しました。</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">誰もが納得するロジック</h2>
<div class="card animate delay-1">
<div class="card-label">PREMISE 1</div>
<p class="card-text">PVCs after MI predict sudden cardiac death</p>
</div>
<div class="arrow animate delay-1">↓</div>
<div class="card animate delay-2">
<div class="card-label">PREMISE 2</div>
<p class="card-text">Antiarrhythmic drugs suppress PVCs</p>
</div>
<div class="arrow animate delay-2">↓</div>
<div class="card animate delay-3">
<div class="card-label">PREMISE 3</div>
<p class="card-text">Suppressing PVCs should prevent sudden death</p>
</div>
<div class="arrow animate delay-3">↓</div>
<div class="card navy-bg animate delay-4">
<div class="card-label">CONCLUSION</div>
<p class="card-text">Antiarrhythmics save lives in post-MI patients</p>
</div>
<p class="footnote animate delay-5">その連鎖は論理的でした。この結論は避けられないと思われた。</p>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">CAST: The Cardiac Arrhythmia Suppression Trial</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1.5rem;">
                  Finally, someone asked: "Does suppressing PVCs actually save lives?"
                </p>
<div class="design-grid animate delay-2">
<div class="design-item">
<div class="design-item-label">Design</div>
<div class="design-item-value">Randomized, double-blind, placebo-controlled</div>
</div>
<div class="design-item">
<div class="design-item-label">Population</div>
<div class="design-item-value">Post-MI patients with asymptomatic PVCs</div>
</div>
<div class="design-item">
<div class="design-item-label">Intervention</div>
<div class="design-item-value">Encainide, flecainide, or moricizine vs placebo</div>
</div>
<div class="design-item">
<div class="design-item-label">Run-in</div>
<div class="design-item-value">Only patients with ≥80% PVC suppression randomized</div>
</div>
<div class="design-item">
<div class="design-item-label">Primary endpoint</div>
<div class="design-item-value">Death or cardiac arrest with resuscitation</div>
</div>
<div class="design-item">
<div class="design-item-label">Sample size</div>
<div class="design-item-value">1,498 patients (encainide/flecainide arms)</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">結果: 1989 年 4 月</h2>
<p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">
                  データ安全監視委員会は試験を早期に中止した。
                </p>
<table class="results-table animate delay-2">
<thead>
<tr>
<th>Outcome</th>
<th>Drug (n=755)</th>
<th>Placebo (n=743)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Arrhythmic deaths</td>
<td class="highlight">33</td>
<td>9</td>
</tr>
<tr>
<td>All cardiac deaths</td>
<td class="highlight">43</td>
<td>16</td>
</tr>
<tr>
<td>Total deaths</td>
<td class="highlight">56</td>
<td>22</td>
</tr>
<tr>
<td><strong>Death rate</strong></td>
<td class="highlight">7.4%</td>
<td><strong>3.0%</strong></td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">Relative Risk of Death: 2.5</div>
<div class="label">95% CI: 1.6 - 4.5 | p &lt; 0.001</div>
</div>
<p class="footnote animate delay-4">不整脈を完全に抑制した薬剤は死亡率を 150% 増加させた。</p>
</div>
</div>
<div class="slide dark" data-index="8">
<div class="content">
<h2 class="title cream animate">The Humanコスト</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">Before CAST, ~200,000 Americans per year received these drugs.</p>
<p class="big-number gold animate delay-2">~9,000</p>
<p class="animate delay-2" style="font-size: 1.25rem;">excess deaths per year - possibly more</p>
<div class="animate delay-3" style="background: rgba(45,58,95,0.8); padding: 1rem 2rem; text-align: center; margin: 1rem 0;">
<p style="color: var(--cream);">Vietnam War: ~6,000 US deaths/year • These drugs: ~9,000+ deaths/year</p>
</div>
<p class="serif animate delay-4" style="font-style: italic; color: var(--gold); margin-top: 1.5rem; text-align: center;">
                  For every number, a name we will never know.
                </p>
</div>
</div>
<div class="slide black" data-index="9">
<p class="serif animate" style="font-size: clamp(2rem, 5vw, 3rem);">Look again.</p>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">ロジック - 再考</h2>
<div class="card animate delay-1">
<div class="card-label">PREMISE 1</div>
<p class="card-text">PVCs after MI predict sudden cardiac death</p>
</div>
<div class="arrow animate delay-1">↓</div>
<div class="card-wrapper animate delay-2">
<div class="card">
<div class="card-label">PREMISE 2</div>
<p class="card-text">Antiarrhythmic drugs suppress PVCs</p>
</div>
<div class="leap-badge">← THE LEAP</div>
</div>
<div class="arrow animate delay-2">↓</div>
<div class="card red-border animate delay-3">
<div class="card-label">PREMISE 3</div>
<p class="card-text">Suppressing PVCs should prevent sudden death</p>
</div>
<div class="arrow animate delay-3">↓</div>
<div class="card navy-bg animate delay-4">
<div class="card-label">CONCLUSION</div>
<p class="card-text">Antiarrhythmics save lives in post-MI patients</p>
</div>
<p class="footnote animate delay-5">マーカーを抑制すると結果が修正されるという仮定は、テストされたことがありません。</p>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">What Went Wrong: The Surrogate Trap</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p>PVC は損傷した組織のマーカーであり、死因ではありません</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p>The drugs had proarrhythmic effects - triggering deadlier rhythms</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p>代理母は改善しましたが、転帰は悪化しました - 解離した代理母</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">代理母は嘘をつきませんでした。私たちは間違った質問をしました。</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">PICO フレームワーク</h2>
<p class="animate delay-1" style="margin-bottom: 1.5rem; font-style: italic;">
                  Every answerable clinical question has four components:
                </p>
<div class="design-grid" style="grid-template-columns: repeat(2, 1fr);">
<div class="design-item animate delay-1" style="border-left-color: var(--navy);">
<div class="design-item-label" style="color: var(--navy);">P - POPULATION</div>
<div class="design-item-value">患者は誰ですか?彼らの特徴は何ですか?</div>
</div>
<div class="design-item animate delay-2" style="border-left-color: var(--green);">
<div class="design-item-label" style="color: var(--green);">I - INTERVENTION</div>
<div class="design-item-value">What treatment or exposure is being evaluated?</div>
</div>
<div class="design-item animate delay-3" style="border-left-color: var(--red);">
<div class="design-item-label" style="color: var(--red);">C - COMPARATOR</div>
<div class="design-item-value">What is the alternative? Placebo? Standard care?</div>
</div>
<div class="design-item animate delay-4" style="border-left-color: var(--gold);">
<div class="design-item-label" style="color: var(--gold);">O - OUTCOME</div>
<div class="design-item-value">What matters to patients? Hard endpoints vs surrogates.</div>
</div>
</div>
<div class="result-box animate delay-5" style="margin-top: 1.5rem;">
<div class="label">CAST PICO</div>
<div class="value" style="font-size: 1rem; line-height: 1.5;">
                    Post-MI patients with PVCs | Antiarrhythmics | Placebo | Mortality
                  </div>
</div>
</div>
</div>
<!-- CAST Investigation Exercise -->
<div class="slide dark" data-index="13">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>調査演習: CAST 前の証拠</h3>
</div>
<p class="direct-address">あなたは 1988 年に心臓専門医です。ある患者は MI から生還しましたが、頻繁に PVC を患っています。観察文献は明確です...</p>
<table class="data-table-investigation">
<thead>
<tr><th>Study</th><th>PVC を有する患者</th><th>Mortality Risk</th></tr>
</thead>
<tbody>
<tr><td>Lown (1977)</td><td>High-grade PVCs</td><td>2.4x higher</td></tr>
<tr><td>Bigger (1984)</td><td>&gt;10 PVCs/hour</td><td>3.1x higher</td></tr>
<tr><td>Mukharji (1984)</td><td>Complex PVCs</td><td>4.8x higher</td></tr>
</tbody>
</table>
<p class="rhetorical" style="margin-top: 1rem;">信号は明確です。そのメカニズムは納得できる。抗不整脈薬を処方していただけますか?</p>
<button class="reveal-btn" onclick="revealAnswer('cast-reveal')">See What CAST Revealed →</button>
<div class="hidden-reveal" id="cast-reveal">
<div class="comparison-grid">
<div class="comparison-panel">
<h4>Before: Observational Logic</h4>
<p>PVCs → Higher mortality</p>
<p>Drugs suppress PVCs</p>
<p><strong>∴ Drugs should reduce mortality</strong></p>
</div>
<div class="comparison-panel after">
<h4>After: CAST RCT (1989)</h4>
<p>Death rate on drug: <strong style="color: var(--red);">7.4%</strong></p>
<p>Death rate on placebo: <strong>3.0%</strong></p>
<p><strong style="color: var(--red);">RR = 2.5 (150% increase in deaths)</strong></p>
</div>
</div>
<p style="margin-top: 1rem; font-style: italic; color: var(--gold);">代理母は改善しました。患者たちは死亡した。これが、「重要な結果は何ですか?」</p>
</div>
</div>
</div>
<div class="slide light" data-index="14">
<div class="content">
<h2 class="title navy animate">証拠総合のための教訓</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>生物学的妥当性は証明ではない</h4>
<p>A logical mechanism doesn't guarantee the expected effect.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Surrogate endpoints can mislead</h4>
<p>Improving a biomarker doesn't prove improvement in outcomes.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>ランダム化試験は最も強力な因果関係の証拠を提供する</h4>
<p>観察データのみ交絡による介入の因果関係が確立されることはほとんどありません。</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>合意は証拠ではありません</h4>
<p>20万件の処方箋、FDAの承認、ガイドラインはすべて間違っていました。</p>
</div>
</div>
<p class="serif animate delay-5" style="font-style: italic; color: var(--gold); margin-top: 1.5rem; text-align: center;">
                  This is why we do meta-analysis: to see past apparent truths.
                </p>
</div>
</div>
 ストーリー: DES-II代理人の悲劇 
<div class="slide dark" data-index="14b">
<div class="story-box animate">
<p class="story-opener">何あなたの質問によって誰が生き、誰が死ぬかが決まるとしたら?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    1989 年、心臓専門医は <span class="data-highlight">PVC 抑制がエンカイニドとフレカイニドで達成可能であることを知っていました</span> 。代理エンドポイントは完璧に見えました。実薬とプラセボに対して、薬物は <span class="data-highlight">80%+</span>.
                    But CAST randomized <span class="data-highlight">1,498 patients</span> によってPVCを抑制しました。試験は早期に中止されました: <span class="data-highlight">56 deaths in the drug group vs 22 in placebo</span>.
                    Mortality increased <span class="data-highlight">2.5-fold</span>.
                    An estimated <span class="data-highlight">~9,000 excess American deaths per year</span> これらの薬剤が原因でした。
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">心臓専門医の選択: 1987</div>
<div class="decision-scenario">
                    MI 後の患者は頻繁に PVC を使用しています。それらを完全に抑制する薬があります。何をしますか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">パス A: 代理母の治療</div>
<div class="path-choice">Prescribe encainide — PVCs vanish, the ECG looks clean</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">バイオマーカーが改善します。自信が持てるようになります。患者が死亡。</div>
<div class="path-outcome">OUTCOME: An estimated 50,000+ excess deaths across the US during years of use</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Demand a Mortality Trial</div>
<div class="path-choice">主張:「心電図だけでなく、生存率が改善することを見せてください。」</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">この試験では害が明らかになりました。薬は撤去される。命は救われます。</div>
<div class="path-outcome">結果: PICO の正しい質問により大惨事が防止されます</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    質問は決して「PVC を抑制できますか?」ではありませんでした。それは「PVC抑制は命を救うのか?」です。サロゲート エンドポイントが間違った質問に答えました。適切な PICO であれば、最初から結果として死亡を要求していたでしょう。
                  </div>
</div>
</div>
</div>
<div class="slide dark" data-index="14">
<p class="closing-line animate">What appears certain may be wrong.</p>
<p class="closing-line animate delay-1">What everyone believes may be false.</p>
<p class="closing-line gold animate delay-2">患者が私たちの信頼のためにお金を払わないようにする方法は存在します。</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">これが、あなたがここにいる理由です。</p>
</div>
<!-- Module 1 Quiz -->
<div class="slide light" data-index="16">
<div class="content">
<h2 class="title navy animate">Module 1 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q1-1">
<h4>1。抗不整脈ロジックの根本的なエラーは何でしたか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 0, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>A.</span> 試験はランダム化されていません
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 1, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>B.</span> Treating a surrogate (PVCs) was assumed to improve outcomes
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 2, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>C.</span> サンプルサイズが小さすぎました
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-1', 3, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
<span>D.</span> FDAの承認は急遽行われました
                      </div>
</div>
<div id="q1-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q1-2">
<h4>2。 PICO では、「O」は何を表しますか?なぜそれが重要ですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 0, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>A.</span> Observation - what researchers see
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 1, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>B.</span> 目的 - 研究目標
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 2, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>C.</span> Outcome - what matters to patients
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q1-2', 3, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
<span>D.</span> 組織 - 研究構造
                      </div>
</div>
<div id="q1-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="17">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">
                メソッドは、私たちの信頼から患者を守ります。
              </p>
</div>
</div>
 モジュール 2: プロトコル (HRT) 
<div class="module-slides" data-module="2">
<div class="slide dark active" data-index="0">
<p class="refrain animate">What was hidden in plain sight?</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">これは、</p>
<p class="title gold animate delay-1 text-center">observational evidence.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 2: プロトコル</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Explain why protocol pre-registration prevents bias</li>
<li>Identify key elements of a PROSPERO registration</li>
<li>Distinguish healthy user bias from true treatment effects</li>
<li>Describe why observational studies overestimated HRT benefits</li>
<li>「メソッドは、私たちの信頼から患者を守る」という原則を適用します。自信"</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">30+</p>
<p class="subtitle animate delay-1">observational studies</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">
                All showing hormone replacement therapy protected postmenopausal women from heart disease.
              </p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">証拠は圧倒的に見えました。結論は確実であるように思われた。</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">看護師の健康調査</h2>
<div class="card animate delay-1">
<p class="card-text text-center">122,000 nurses followed for decades. HRT users had 40-50% lower cardiovascular mortality.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">RR 0.56</div>
<div class="stat-label">Cardiovascular mortality</div>
</div>
<div class="stat-box">
<div class="stat-value">122,000</div>
<div class="stat-label">Women followed</div>
</div>
<div class="stat-box">
<div class="stat-value">20+ years</div>
<div class="stat-label">Follow-up</div>
</div>
</div>
<p class="footnote animate delay-3">Landmark study. Impeccable methodology. Wrong conclusion.</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">隠れた偏見</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Healthy User Bias:</strong> Women who chose HRT were healthier, wealthier, better educated</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Compliance Bias:</strong> Women who took HRT consistently also took better care of themselves</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>Prescriber Bias:</strong> Doctors gave HRT to healthier women with fewer risk factors</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">治療は彼らを守っていなかった。彼らはすでに保護されていました。</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">WHI: The Women's Health Initiative</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1.5rem;">
                  The largest randomized trial of HRT ever conducted.
                </p>
<div class="design-grid animate delay-2">
<div class="design-item">
<div class="design-item-label">Design</div>
<div class="design-item-value">Randomized, double-blind, placebo-controlled</div>
</div>
<div class="design-item">
<div class="design-item-label">Population</div>
<div class="design-item-value">Postmenopausal women aged 50-79</div>
</div>
<div class="design-item">
<div class="design-item-label">Intervention</div>
<div class="design-item-value">Estrogen + Progestin vs Placebo</div>
</div>
<div class="design-item">
<div class="design-item-label">Sample size</div>
<div class="design-item-value">16,608 women</div>
</div>
<div class="design-item">
<div class="design-item-label">Primary endpoint</div>
<div class="design-item-value">Coronary heart disease</div>
</div>
<div class="design-item">
<div class="design-item-label">Planned duration</div>
<div class="design-item-value">8.5 years</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">結果: 2002 年 7 月</h2>
<p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">
                  Trial stopped early after 5.2 years. Harm exceeded benefits.
                </p>
<table class="results-table animate delay-2">
<thead>
<tr>
<th>Outcome</th>
<th>Hazard Ratio</th>
<th>Direction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Coronary heart disease</td>
<td class="highlight">1.29</td>
<td class="highlight">HARM</td>
</tr>
<tr>
<td>Stroke</td>
<td class="highlight">1.41</td>
<td class="highlight">HARM</td>
</tr>
<tr>
<td>Breast cancer</td>
<td class="highlight">1.26</td>
<td class="highlight">HARM</td>
</tr>
<tr>
<td>Pulmonary embolism</td>
<td class="highlight">2.13</td>
<td class="highlight">HARM</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">Complete Reversal</div>
<div class="label">30 年間の観察証拠が覆されました</div>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<p class="title cream animate">The Lesson</p>
<p class="big-number gold animate delay-1" style="font-size: clamp(2rem, 8vw, 5rem);">PRE-SPECIFY</p>
<p class="animate delay-2" style="font-size: 1.1rem; text-align: center; max-width: 600px; margin-top: 1rem;">
                A protocol written before the search begins prevents fishing, prevents bias, prevents hindsight distortion.
              </p>
</div>
 ストーリー: ホルモン タイミング仮説 
<div class="slide dark" data-index="7b">
<div class="story-box animate">
<p class="story-opener">治療が効果がある場合はどうなるでしょうか。いくつか?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    WHI showed HRT <span class="data-highlight">increased cardiovascular events overall</span>.
                    But later analyses revealed a critical pattern: women who started HRT
                    <span class="data-highlight">within 10 years of menopause</span> had
                    <span class="data-highlight">REDUCED cardiovascular risk</span>.
                    Women starting <span class="data-highlight">20+ years after menopause</span> had
                    <span class="data-highlight">INCREASED risk</span>.
                    The overall null/harm result hid a timing effect.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">アナリストのジレンマ</div>
<div class="decision-scenario">
                    あなたは WHI サブグループを分析しています。全体的な結果は害を示しています。さらに詳しく調べますか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Report Overall Only</div>
<div class="path-choice">Conclude HRT is harmful for all postmenopausal women</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Simple message. Guidelines recommend against HRT universally.</div>
<div class="path-outcome">OUTCOME: Deny potential benefit to younger menopausal women</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Pre-Specify Timing Subgroups</div>
<div class="path-choice">Analyze by years since menopause (biologically plausible)</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">安全な HRT 開始のための「タイミング ウィンドウ」を発見します。</div>
<div class="path-outcome">OUTCOME: Enable personalized recommendations</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    釣りをする場合、サブグループ分析は危険です。生物学が効果の変化を予測する場合、これは不可欠です。タイミング仮説は生物学的に妥当であり、事前に指定されるべきでした。
                  </div>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">PROSPERO Registration</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>検索する前に登録</h4>
<p>PROSPERO: International prospective register of systematic reviews</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>決定をロック</h4>
<p>PICO, search strategy, outcomes, analysis plan - all pre-specified</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Document Amendments</h4>
<p>変更は許可されますが、透明性と正当性が必要です</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Prevent Duplication</h4>
<p>事前にレビューが存在するかどうかを確認してください開始</p>
</div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Module 2 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q2-1">
<h4>1。看護師健康調査では、WHI では得られなかった HRT の利点が示されたのはなぜですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 0, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>A.</span> Nurses' Health had too few patients
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 1, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>B.</span> Healthy user bias in observational studies
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 2, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>C.</span> Nurses' Health had shorter follow-up
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-1', 3, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthier—confounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
<span>D.</span> Different hormone formulations were used
                      </div>
</div>
<div id="q2-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q2-2" style="margin-top: 1.5rem;">
<h4>2. What is the primary purpose of PROSPERO registration?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 0, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>A.</span> To register clinical trials
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 1, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>B.</span> レビューの完了を迅速化するため
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 2, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>C.</span> 方法を事前に指定し、偏見を防ぐため
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q2-2', 3, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
<span>D.</span> レビューのための資金を獲得するため
                      </div>
</div>
<div id="q2-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="10">
<p class="closing-line animate">事前指定は必要ありません</p>
<p class="closing-line animate delay-1">It is protection.</p>
<p class="closing-line gold animate delay-2">Against our own tendency to find what we expect.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">メソッドは、私たちの信頼から患者を守ります。</p>
</div>
<div class="slide black" data-index="11">
<p class="refrain animate">What was hidden in plain sight?</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 3: 検索</p>
</div>
</div>
 モジュール 3: 検索 (ロシグリタゾン) 
<div class="module-slides" data-module="3">
<div class="slide dark active" data-index="0">
<p class="refrain animate">What was hidden in plain sight?</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">これは、</p>
<p class="title gold animate delay-1 text-center">what they didn't publish.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 3: 検索</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Develop a comprehensive search strategy using PRESS guidelines</li>
<li>Search multiple databases including grey literature sources</li>
<li>Identify trial registries and regulatory databases (ClinicalTrials.gov, FDA)</li>
<li>Explain how the rosiglitazone case exposed hidden cardiovascular harms</li>
<li>原則を適用する:「目に見えないところに何が隠されていたのか?」</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">$3.2B</p>
<p class="subtitle animate delay-1">annual sales at peak</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">アバンディア (ロシグリタゾン) は、世界のベストセラーの糖尿病薬。</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">公表された試験は安心できるものに見えました。未公開のものは別の物語を語っていました。</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">公開された証拠 (2007 年以前)</h2>
<div class="card animate delay-1">
<p class="card-text text-center">Published trials showed rosiglitazone effectively lowered HbA1c. Cardiovascular outcomes were rarely reported.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">1999</div>
<div class="stat-label">FDA approval</div>
</div>
<div class="stat-box">
<div class="stat-value">6M+</div>
<div class="stat-label">Patients treated</div>
</div>
<div class="stat-box">
<div class="stat-value">~0.7%</div>
<div class="stat-label">HbA1c reduction</div>
</div>
</div>
<p class="footnote animate delay-3">代理母は良好に見えました。しかし、実際の心血管イベントについてはどうでしょうか?</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Nissen's Discovery: May 2007</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1rem;">博士。 Steven Nissen は、未公開の治験データを GSK 自身の Web サイトから入手しました。</p>
<div class="card animate delay-2">
<p class="card-text text-center">GSK は法的和解により、臨床試験結果をオンラインに掲載するよう求められていました。 Nissen と Wolski は 42 件の試験を分析しましたが、その多くは雑誌に掲載されたことがありません。</p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">データは技術的に公開されていました。</p>
<p class="sub">No one had systematically searched for it.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">メタ分析の結果</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>Outcome</th>
<th>Odds Ratio</th>
<th>95% CI</th>
</tr>
</thead>
<tbody>
<tr>
<td>Myocardial Infarction</td>
<td class="highlight">1.43</td>
<td class="highlight">1.03 - 1.98</td>
</tr>
<tr>
<td>CV Death</td>
<td>1.64</td>
<td>0.98 - 2.74</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-2">
<div class="value">43% Increased Risk of Heart Attack</div>
<div class="label">心筋梗塞の p = 0.03</div>
</div>
<p class="footnote animate delay-3">Published in NEJM. The FDA called an emergency advisory committee meeting.</p>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="content">
<h2 class="title cream animate">The FDA Advisory Committee: July 2007</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">22-1</div>
<div class="stat-label">Voted: CV risk exists</div>
</div>
<div class="stat-box">
<div class="stat-value">20-3</div>
<div class="stat-label">警告</div>
</div>
</div>
<p class="animate delay-2" style="margin-top: 1.5rem; text-align: center;">委員会は分裂しました。撤回を望む人もいた。メタ分析には欠陥があると言う人もいた。</p>
<p class="animate delay-3" style="margin-top: 1rem; font-size: 1.1rem; text-align: center; color: var(--gold);">しかし、信号は見えないわけではありません。</p>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">The Aftermath</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Black box warning</strong> added for heart failure risk (2007)</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Severe restrictions</strong> on prescribing in the US (2010)</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>Withdrawn</strong> 完全に欧州市場から (2010 年)</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>FDA now requires</strong> cardiovascular outcome trials for all diabetes drugs</p>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">What a Comprehensive Search Requires</h2>
<div class="design-grid animate delay-1">
<div class="design-item">
<div class="design-item-label">PUBLISHED</div>
<div class="design-item-value">PubMed, Embase, CENTRAL, Web of Science</div>
</div>
<div class="design-item">
<div class="design-item-label">GREY LITERATURE</div>
<div class="design-item-value">Conference abstracts, dissertations, regulatory docs</div>
</div>
<div class="design-item">
<div class="design-item-label">TRIAL REGISTRIES</div>
<div class="design-item-value">ClinicalTrials.gov, WHO ICTRP, EU CTR</div>
</div>
<div class="design-item">
<div class="design-item-label">REGULATORY</div>
<div class="design-item-value">FDA, EMA, Health Canada submissions</div>
</div>
<div class="design-item">
<div class="design-item-label">COMPANY DATA</div>
<div class="design-item-value">GSK, Pfizer, Roche clinical trial registries</div>
</div>
<div class="design-item">
<div class="design-item-label">HAND SEARCH</div>
<div class="design-item-value">Reference lists, contact authors, experts</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">PRESS チェックリスト</h2>
<p class="animate delay-1" style="font-style: italic; margin-bottom: 1rem;">Peer Review of Electronic Search Strategies</p>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>調査質問の翻訳</h4>
<p>検索は PICO を反映していますか要素?</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>ブール演算子と近接演算子</h4>
<p>AND、OR、は正しく使用されていませんか?</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Subject Headings</h4>
<p>MeSH/Emtree 用語は適切で展開されていますか?</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Text Words</h4>
<p>Synonyms, spelling variants, truncation?</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">PRESS Checklist (continued)</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">5</div>
<div class="lesson-content">
<h4>Spelling, Syntax, Line Numbers</h4>
<p>取得の原因となるエラーはありますか?失敗しましたか?</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">6</div>
<div class="lesson-content">
<h4>制限とフィルター</h4>
<p>日付、言語、研究設計の制限は適切ですか?</p>
</div>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">Peer-reviewed searches substantially improve retrieval of key studies.</p>
<p class="sub">PRESS guideline: McGowan et al., 2016</p>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Database Translation</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">各データベースに同じ検索を適用する必要があります:</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 700px;">
<div class="card animate delay-2">
<div class="card-label">PubMed</div>
<p class="card-text" style="font-family: monospace; font-size: 0.8rem;">"diabetes mellitus, type 2"[MeSH] OR "type 2 diabetes"[tiab]</p>
</div>
<div class="card animate delay-3">
<div class="card-label">Embase</div>
<p class="card-text" style="font-family: monospace; font-size: 0.8rem;">'non insulin dependent diabetes mellitus'/exp OR 'type 2 diabetes':ti,ab</p>
</div>
</div>
<p class="footnote animate delay-4">Subject headings, field tags, and operators differ between databases.</p>
</div>
</div>
 ストーリー: タミフル透明性キャンペーン 
<div class="slide dark" data-index="12b">
<div class="story-box animate">
<p class="story-opener">次の場合に何が起こりますか?検索しても何も見つかりませんか?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    Governments stockpiled <span class="data-highlight">$9 billion</span> パンデミック インフルエンザに対するオセルタミビル (タミフル) について。コクラン共同研究は証拠を検討しようとしました。 <span class="data-highlight">77 clinical trials</span>,
                    full reports existed for only <span class="data-highlight">20</span>の。ロシュは <span class="data-highlight">5 years</span>のデータ共有を拒否しました。 BMJ とコクランが最終的に入手したとき <span class="data-highlight">over 160,000 pages</span> of clinical study reports,
                    they found: Tamiflu reduced symptoms by <span class="data-highlight">less than 1 day</span>,
                    with <span class="data-highlight">no evidence</span> it prevented hospitalizations or complications.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">レビューアーのジレンマ: 2009</div>
<div class="decision-scenario">
                    あなたはタミフルに関するコクランのレビューを更新しています。公表された試験結果は良好なようです。しかし、57件の試験ではアクセス可能な完全な報告書が存在しない。何をしますか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Analyze What's Published</div>
<div class="path-choice">Use the 20 available trials. Conclude Tamiflu is effective.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">あなたのレビューは備蓄の継続をサポートします。弱い証拠に 90 億ドルが費やされました。</div>
<div class="path-outcome">OUTCOME: Billions wasted, true efficacy unknown</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">パス B: 完全なデータの要求</div>
<div class="path-choice">Refuse to publish until all trial data is accessible</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">5-year campaign. 160,000+ pages finally obtained. Truth emerges.</div>
<div class="path-outcome">OUTCOME: Evidence policy changed; EMA now publishes all trial reports</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    検索は、見つけられるものと同じくらい有効です。灰色の文献が企業の壁に隠されている場合、最も包括的な PubMed 検索でも真実を見逃してしまいます。タミフルの騒動は世界的な政策を変えました。EMA は現在、すべての医薬品の臨床研究報告書を発行しています。
                  </div>
</div>
</div>
</div>
<div class="slide dark" data-index="12">
<p class="closing-line animate">If Nissen had searched only PubMed,</p>
<p class="closing-line animate delay-1">the signal would have remained hidden.</p>
<p class="closing-line gold animate delay-2">Comprehensive search is survival.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">What was hidden in plain sight?</p>
</div>
<!-- Quiz -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">Module 3 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q3-1">
<h4>1。ロシグリタゾン心血管シグナルを明らかにした証拠ソースの種類は何ですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 0, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>A.</span> Published journal articles
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 1, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>B.</span> Cochrane Library
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 2, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>C.</span> Company clinical trial registry
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-1', 3, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
<span>D.</span> FDA approval documents
                      </div>
</div>
<div id="q3-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q3-2">
<h4>2. What does PRESS stand for?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 0, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>A.</span> 証拠検索基準の出版レビュー
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 1, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>B.</span> Peer Review of Electronic Search Strategies
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 2, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>C.</span> 証拠総合研究報告用プロトコル
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q3-2', 3, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
<span>D.</span> Primary Research Evidence Search System
                      </div>
</div>
<div id="q3-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="14">
<p class="refrain animate">What was hidden in plain sight?</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 4: スクリーニング</p>
</div>
</div>
 モジュール4: スクリーニング (Vioxx) 
<div class="module-slides" data-module="4">
<div class="slide dark active" data-index="0">
<p class="refrain animate">出所のない数字は数字ではない。</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">これは、</p>
<p class="title gold animate delay-1 text-center">what they chose to report.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 4: スクリーニング</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Apply PRISMA flow diagram to document study selection</li>
<li>Implement dual-reviewer screening with conflict resolution</li>
<li>選択的結果レポートとデータ操作を特定する</li>
<li>Calculate inter-rater reliability (Cohen's kappa)</li>
<li>「出所のない数字は数字ではない」原則を適用する</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">88,000</p>
<p class="subtitle animate delay-1">heart attacks attributed to Vioxx</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">A blockbuster drug. A hidden signal. A preventable catastrophe.</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">1999 年から2004年、何百万人もの人々がこの鎮痛剤を服用しました。</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Vioxx の台頭</h2>
<div class="card animate delay-1">
<p class="card-text text-center">ロフェコキシブ (Vioxx) は COX-2 選択的 NSAID でした。従来の鎮痛剤よりも胃にとって安全であるとして販売されています。</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">1999</div>
<div class="stat-label">FDA approval</div>
</div>
<div class="stat-box">
<div class="stat-value">$2.5B</div>
<div class="stat-label">Peak annual sales</div>
</div>
<div class="stat-box">
<div class="stat-value">80M+</div>
<div class="stat-label">Patients prescribed</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">VIGOR 試験 (2000)</h2>
<p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1rem;">Vioxx Gastrointestinal Outcomes Research</p>
<div class="design-grid animate delay-2">
<div class="design-item">
<div class="design-item-label">Design</div>
<div class="design-item-value">Randomized, double-blind</div>
</div>
<div class="design-item">
<div class="design-item-label">Comparison</div>
<div class="design-item-value">Vioxx vs Naproxen</div>
</div>
<div class="design-item">
<div class="design-item-label">Population</div>
<div class="design-item-value">Rheumatoid arthritis</div>
</div>
<div class="design-item">
<div class="design-item-label">Sample</div>
<div class="design-item-value">8,076 patients</div>
</div>
<div class="design-item">
<div class="design-item-label">Primary Outcome</div>
<div class="design-item-value">GI events</div>
</div>
<div class="design-item">
<div class="design-item-label">Published</div>
<div class="design-item-value">NEJM, November 2000</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">What VIGOR Published</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>GI Outcome</th>
<th>Vioxx</th>
<th>Naproxen</th>
</tr>
</thead>
<tbody>
<tr>
<td>Confirmed GI events</td>
<td style="color: var(--green);">2.1 per 100 pt-yrs</td>
<td>4.5 per 100 pt-yrs</td>
</tr>
<tr>
<td>Reduction</td>
<td colspan="2" style="color: var(--green); font-weight: 700;">54% fewer GI events</td>
</tr>
</tbody>
</table>
<div class="card navy-bg animate delay-2">
<p class="card-text text-center">見出し: Vioxx は胃にとってより安全です!</p>
</div>
<p class="footnote animate delay-3">これは医師に言われたことです。これが患者が信じていたことです。</p>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">What VIGOR Buried</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>CV Outcome</th>
<th>Vioxx</th>
<th>Naproxen</th>
</tr>
</thead>
<tbody>
<tr>
<td>Myocardial Infarction</td>
<td class="highlight">20 events</td>
<td>4 events</td>
</tr>
<tr>
<td>Relative Risk</td>
<td class="highlight" colspan="2">5x higher in Vioxx group</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-2">
<div class="value">5-fold Increase in Heart Attacks</div>
<div class="label">Mentioned only briefly, attributed to naproxen being "cardioprotective"</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">選択的報告</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>データカットオフ操作:</strong> 3 additional heart attacks occurred after the cutoff used in publication</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Spin:</strong> CVシグナルはナプロキセンが心臓保護作用があると説明された(証拠なし)</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>Outcome switching:</strong> CVイベントは事前に特定されていたが強調されていなかった</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>Internal knowledge:</strong> メルクの電子メールは、信号について知っていたことを示しています</p>
</div>
</div>
</div>
<div class="slide dark" data-index="8">
<div class="content">
<h2 class="title cream animate">APPROVe試験（2004年）</h2>
<p class="animate delay-1">結腸直腸ポリープ予防の試験 - 安全のため早期に中止されました。</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">RR 1.92</div>
<div class="stat-label">CV events vs placebo</div>
</div>
<div class="stat-box">
<div class="stat-value">Sept 2004</div>
<div class="stat-label">Vioxx withdrawn</div>
</div>
</div>
<p class="animate delay-3" style="margin-top: 1.5rem; color: var(--gold); font-style: italic; text-align: center;">
                  Four years after VIGOR showed a 5x risk. Four years too late.
                </p>
</div>
</div>
 ストーリー: Vioxx決定ツリー 
<div class="slide dark" data-index="8b">
<div class="story-box animate">
<p class="story-opener">信号が来たときに何が起こるか考えましたか？騒音の中に隠れていますか?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    Vioxx (rofecoxib) は <span class="data-highlight">1999</span>.
                    By <span class="data-highlight">2004</span>, estimates suggest
                    <span class="data-highlight">88,000-140,000 excess heart attacks</span> and
                    <span class="data-highlight">30,000-40,000 deaths</span>.
                    Merck's own VIGOR trial showed <span class="data-highlight">5x cardiovascular risk</span> in 2000—but
                    it was dismissed as a "naproxen cardioprotective effect."
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">分かれ道</div>
<div class="decision-scenario">
                    で承認されました。あなたは 2001 年に FDA の審査員です。VIGOR データは、Vioxx と比べて心臓発作のリスクが 5 倍であることを示しています。 naproxen.
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">パス A: 説明を受け入れる</div>
<div class="path-choice">Believe Merck's hypothesis: naproxen is cardioprotective</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">No additional safety studies required. Drug stays on market at full speed.</div>
<div class="path-outcome">結果: 4 年間で 40,000 人以上の死亡</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">パス B: 証拠を要求</div>
<div class="path-choice">Require a dedicated CV safety trial before continued marketing</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Delay or restrict marketing until cardiovascular safety is established.</div>
<div class="path-outcome">OUTCOME: Signal detected early, lives saved</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    シグナルは 2000 年に存在していました。間違った説明が行動を遅らせました。 4年までに。証拠なしで受け入れられた対立仮説は、数万人の命を犠牲にします。
                  </div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">PRISMA フロー図</h2>
<p class="animate delay-1" style="font-style: italic; margin-bottom: 1rem;">Every step of screening must be documented and transparent.</p>
<div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
<div class="stat-box animate delay-1" style="width: 300px;"><div class="stat-value">Identification</div><div class="stat-label">Records from databases + other sources</div></div>
<div class="arrow animate delay-1" style="font-size: 1.5rem;">↓</div>
<div class="stat-box animate delay-2" style="width: 300px;"><div class="stat-value">Screening</div><div class="stat-label">Title/abstract review (duplicates removed)</div></div>
<div class="arrow animate delay-2" style="font-size: 1.5rem;">↓</div>
<div class="stat-box animate delay-3" style="width: 300px;"><div class="stat-value">Eligibility</div><div class="stat-label">Full-text assessment (with exclusion reasons)</div></div>
<div class="arrow animate delay-3" style="font-size: 1.5rem;">↓</div>
<div class="stat-box animate delay-4" style="width: 300px; background: var(--gold); color: var(--navy);"><div class="stat-value">Included</div><div class="stat-label">Studies in synthesis</div></div>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Dual Screening: Why Two Reviewers?</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Reduces Selection Bias</h4>
<p>One reviewer might unconsciously favor certain studies</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Catches Errors</h4>
<p>疲労、読み間違い、間違いは避けられません</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Forces Explicit Criteria</h4>
<p>Disagreements reveal ambiguity in inclusion rules</p>
</div>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">Typical agreement: κ = 0.6-0.8</p>
<p class="sub">Disagreements resolved by discussion or third reviewer</p>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">キャリブレーション: パイロットフェーズ</h2>
<div class="card animate delay-1">
<p class="card-text text-center">Before screening thousands of records, reviewers should calibrate on a sample of 50-100 records.</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">1</div>
<p>Screen the same set independently</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">2</div>
<p>Compare decisions and discuss disagreements</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">3</div>
<p>Refine inclusion criteria until κ &gt; 0.7</p>
</div>
<div class="wrong-item animate delay-5">
<div class="wrong-number">4</div>
<p>キャリブレーションプロセスとルールを文書化します。変更点</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">PRISMA 2020 Updates</h2>
<div class="design-grid animate delay-1" style="grid-template-columns: 1fr 1fr;">
<div class="design-item">
<div class="design-item-label">New in 2020</div>
<div class="design-item-value">Separate reporting of database vs register searches</div>
</div>
<div class="design-item">
<div class="design-item-label">New in 2020</div>
<div class="design-item-value">自動化ツールは報告する必要があります</div>
</div>
<div class="design-item">
<div class="design-item-label">New in 2020</div>
<div class="design-item-value">Citation searching documented separately</div>
</div>
<div class="design-item">
<div class="design-item-label">New in 2020</div>
<div class="design-item-value">Reasons for exclusion at full-text mandatory</div>
</div>
</div>
<p class="footnote animate delay-2">PRISMA 2020 ではチェックリストが大幅に改訂され、合成方法、確実性評価、プロトコル登録に関するレポートが拡張されました。</p>
</div>
</div>
<div class="slide dark" data-index="13">
<p class="closing-line animate">If Vioxx's cardiovascular data had been screened by independent reviewers,</p>
<p class="closing-line animate delay-1">if all pre-specified outcomes had been required to be reported,</p>
<p class="closing-line gold animate delay-2">88,000 heart attacks might have been prevented.</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">出所のない数字は数字ではない。</p>
</div>
<!-- Quiz -->
<div class="slide light" data-index="14">
<div class="content">
<h2 class="title navy animate">Module 4 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q4-1">
<h4>1。 VIGOR 試験では、ナプロキセンと比較した Vioxx 群の MI の相対リスクはどのくらいでしたか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 0, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>A.</span> 1.5x higher
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 1, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>B.</span> 2x higher
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 2, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>C.</span> 5x higher
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-1', 3, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
<span>D.</span> 10x higher
                      </div>
</div>
<div id="q4-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q4-2">
<h4>2. Why is dual screening (two independent reviewers) important?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 0, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>A.</span> It makes screening faster
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 1, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>B.</span> It reduces selection bias and catches errors
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 2, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>C.</span> レビューする研究の数が減ります
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q4-2', 3, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
<span>D.</span> It allows reviewers to skip full-text review
                      </div>
</div>
<div id="q4-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="15">
<p class="refrain animate">出所のない数字は数字ではない。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 5: 抽出</p>
</div>
</div>
 モジュール 5: 抽出(減少) 
<div class="module-slides" data-module="5">
<div class="slide dark active" data-index="0">
<p class="refrain animate">出所のない数字は数字ではない。</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">これは、</p>
<p class="title gold animate delay-1 text-center">存在しなかった数値。</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 5: 抽出</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>来歴フィールドを含む標準化されたデータ抽出フォームを設計する</li>
<li>Calculate effect sizes from various reported statistics (OR, RR, HR, SMD)</li>
<li>Implement dual-extraction with discrepancy resolution</li>
<li>データ捏造と不正行為の危険信号を特定する</li>
<li>Explain how the DECREASE fraud affected clinical guidelines</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">~10,000</p>
<p class="subtitle animate delay-1">possible excess deaths in Europe</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">捏造された臨床試験に基づくガイドラインからデータ。</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">DECREASE 試験は世界中の周術期ケアに影響を与えました。データは発明されたものです。</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Don Poldermans: A Star Researcher</h2>
<div class="card animate delay-1">
<p class="card-text text-center">Professor at Erasmus Medical Center, Rotterdam. Author of over 500 papers. Lead author of ESC guidelines on perioperative cardiac care.</p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">500+</div>
<div class="stat-label">Publications</div>
</div>
<div class="stat-box">
<div class="stat-value">DECREASE</div>
<div class="stat-label">Trial series I-VI</div>
</div>
<div class="stat-box">
<div class="stat-value">ESC</div>
<div class="stat-label">Guideline chair</div>
</div>
</div>
<p class="footnote animate delay-3">一見非の打ちどころのない情報源。誰かがデータを見るまでは。</p>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">DECREASE 試験: 主張</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>Trial</th>
<th>Finding</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td>DECREASE-I (1999)</td>
<td>90% reduction in cardiac death</td>
<td>Changed guidelines</td>
</tr>
<tr>
<td>DECREASE-IV (2009)</td>
<td>Beta-blockers safe in low-risk</td>
<td>Expanded recommendations</td>
</tr>
</tbody>
</table>
<div class="focus-box animate delay-2 mt-2">
<p class="main">Effect sizes were implausibly large.</p>
<p class="sub">90% reduction? Almost nothing in medicine works that well.</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">The Investigation: 2011</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p>Erasmus MC investigated after whistleblower complaints</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>捏造された患者データ:</strong> Patients who didn't exist or weren't enrolled</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>No informed consent:</strong> Many "participants" never consented</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>Poldermans dismissed:</strong> From Erasmus MC in 2011</p>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="content">
<h2 class="title cream animate">害悪の連鎖</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">DECREASE が削除されたときメタ分析...</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">Benefit → Harm</div>
<div class="stat-label">Direction reversed</div>
</div>
<div class="stat-box">
<div class="stat-value">27% ↑</div>
<div class="stat-label">Stroke risk increase</div>
</div>
</div>
<p class="animate delay-3" style="margin-top: 1.5rem; color: var(--gold); font-style: italic; text-align: center;">
                  POISE 試験 (2008 年) は有害性を示しました。 DECREASEと矛盾するため却下されました。
                </p>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">なぜこれが捕まらなかったのか?</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Trust in authority:</strong> ポルダーマンスは自身の証拠をレビューするガイドライン作成者であった</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>No data verification:</strong> 誰も個々の患者データを求めなかった</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>Publication prestige:</strong> Published in top journals, assumed valid</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>Implausible effects accepted:</strong> 90% reductions should raise suspicion</p>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Data Extraction: Defense Against Fraud</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Dual Extraction</h4>
<p>Two extractors independently - catches transcription errors and forces scrutiny</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Record Provenance</h4>
<p>Table, page, paragraph - every number traceable to source</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Verify Against Registry</h4>
<p>ClinicalTrials.govの結果と出版物 -不一致は危険信号です</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Request IPD</h4>
<p>Individual patient data reveals what aggregate summaries hide</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Effect Size Calculation</h2>
<p class="animate delay-1" style="margin-bottom: 1rem;">抽出中に、報告されたデータから効果量を計算します。</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 700px;">
<div class="card animate delay-2">
<div class="card-label">BINARY OUTCOMES</div>
<p class="card-text" style="font-size: 0.85rem;">Odds Ratio, Risk Ratio, Risk Difference from 2x2 tables</p>
</div>
<div class="card animate delay-3">
<div class="card-label">CONTINUOUS OUTCOMES</div>
<p class="card-text" style="font-size: 0.85rem;">平均差、平均値と SD からの標準化平均差</p>
</div>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">常に最も信頼できるソースから抽出します。</p>
<p class="sub">Prefer: ITT results &gt; per-protocol &gt; subgroups</p>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Red Flags During Extraction</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">!</div>
<p><strong>Implausible effect sizes:</strong> 80-90% reductions should prompt scrutiny</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">!</div>
<p><strong>Baseline imbalances:</strong> 「完全に一致しすぎる」グループ</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">!</div>
<p><strong>Round numbers:</strong> "Exactly 50" or "exactly 100" patients per arm</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">!</div>
<p><strong>Registry discrepancies:</strong> 公開された N が登録された N と異なる</p>
</div>
</div>
</div>
<div class="slide light" data-index="11c" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Effect Size Conversions</h2>
<div class="card animate delay-1">
<p class="card-text">
                    調査レポートの結果は異なる指標で表示されます。それらをプールするには、多くの場合、変換が必要になります:
                  </p>
</div>
<table class="results-table animate delay-2" style="font-size: 0.9rem;">
<thead><tr><th>From</th><th>To</th><th>Formula</th></tr></thead>
<tbody>
<tr><td>SMD (d)</td><td>log-OR</td><td>log-OR = d × π / √3</td></tr>
<tr><td>log-OR</td><td>SMD (d)</td><td>d = log-OR × √3 / π</td></tr>
<tr><td>Correlation (r)</td><td>Fisher z</td><td>z = 0.5 × ln((1+r)/(1−r))</td></tr>
<tr><td>OR</td><td>RR</td><td>RR = OR / (1 − P₀ + P₀ × OR)</td></tr>
<tr><td>OR</td><td>NNT</td><td>NNT = 1 / (P₀ − OR×P₀ / (1−P₀+OR×P₀))</td></tr>
</tbody>
</table>
<p class="footnote animate delay-3">
                  P₀ = コントロール グループのベースライン リスク。これらの式は近似的な条件を想定しています。ボレンシュタインらを参照。正確な導出については、(Ch. 7) を参照してください。
                </p>
</div>
</div>
<div class="slide light" data-index="11d" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">イベント発生までの時間 (生存) データ</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Many trials report time-to-event outcomes using <strong>hazard ratios</strong> (HR).
                    Pooling HRs in meta-analysis requires special handling:
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>ログ (HR) + SE メソッド</h4>
<p>
                      試験からログ (HR) とその SE を抽出します。報告されていない場合は、CI から SE を導出します: SE = (ln(上) − ln(下)) / (2 × 1.96)。標準の逆分散法を使用してプールします。
                    </p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>HR が報告されない場合</h4>
<p>
                      カプラン・マイヤー曲線から IPD を再構成する方法 (Guyot et al. 2012)、または p 値とイベント数から HR を推定する方法 (Parmar et al. 1998) が存在します。利用可能な場合は、常に直接報告された調整済み心拍数を優先します。
                    </p>
</div>
</div>
<p class="footnote animate delay-4">
                  HR &lt; 1 favors treatment; HR &gt; 1 favors control.
                  Do <strong>not</strong> convert HRs to ORs or RRs—they measure fundamentally different quantities.
                </p>
</div>
</div>
 ストーリー: ボルト・コロイド事件 
<div class="slide dark" data-index="11b">
<div class="story-box animate">
<p class="story-opener">抽出したデータが本物ではなかったらどうしますか?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    ヨアヒム・ボルトは、麻酔液管理において最も多作な研究者でした。彼の出版物のうち 180 以上が <span class="data-highlight">撤回されました</span> - 医学史上最大の撤回事件の 1 つです。彼の捏造データは、ヒドロキシエチルデンプン (HES) が安全であることを示していました。彼の研究を含むメタ分析では、HES は無害であると結論づけられました。ボルトの研究が削除されると、 <span class="data-highlight">プールされた効果は逆転しました</span>:
                    HES increased <span class="data-highlight">kidney injury by 59%</span> (RR 1.59, 95% CI 1.26-2.00)
                    and <span class="data-highlight">mortality by ~9%</span> (RR 1.09). An estimated
                    <span class="data-highlight">thousands of patients</span> received a harmful fluid based on fabricated evidence.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">抽出者の警戒: 2010</div>
<div class="decision-scenario">
                    輸液蘇生メタアナリシス用のデータを抽出しています。ボルトの研究は文献の大半を占めています (90 以上の論文)。内部告発者が懸念を表明した。何をしますか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Extract as Published</div>
<div class="path-choice">Trust peer-reviewed publications. Extract Boldt's data like any other.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Your meta-analysis shows HES is safe. Guidelines recommend it.</div>
<div class="path-outcome">OUTCOME: Thousands receive a nephrotoxic fluid</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Verify Provenance</div>
<div class="path-choice">倫理承認をクロスチェックし、ソースデータを要求し、疑わしい研究を除外する感度分析を実施します</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Discover missing ethics approvals. Flag studies. Re-analyze without them.</div>
<div class="path-outcome">OUTCOME: True signal emerges — HES causes harm</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    出所は官僚主義ではありません。それは証拠とフィクションの違いです。抽出されたすべての数値は、検証可能な患者データを伴う倫理的に承認された研究に遡る必要があります。出所がなければ、所有者のいない番号は武器になる可能性があります。
                  </div>
</div>
</div>
</div>
<div class="slide dark" data-index="11">
<p class="closing-line animate">メタ分析のすべての番号</p>
<p class="closing-line animate delay-1">must trace back to a verifiable source.</p>
<p class="closing-line gold animate delay-2">出所のない数字は数字ではない。</p>
<div class="gold-line animate delay-3"></div>
<p class="closing-line italic animate delay-4">Fraudulent data can kill as surely as fraudulent drugs.</p>
</div>
<!-- Quiz -->
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Module 5 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q5-1">
<h4>1。 DECREASE 試験データがベータブロッカーのメタ分析から削除されたときに何が起こりましたか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 0, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>A.</span> The benefit became even larger
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 1, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>B.</span> No change in conclusions
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 2, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>C.</span> The direction reversed to show potential harm
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-1', 3, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
<span>D.</span> 結果は決定的ではなくなりました
                      </div>
</div>
<div id="q5-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q5-2">
<h4>2. Why should dual extraction be standard practice?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 0, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>A.</span> It catches transcription errors and forces scrutiny
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 1, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>B.</span> It makes extraction faster
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 2, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>C.</span> より多くの研究を見つけるのに役立ちます
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q5-2', 3, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
<span>D.</span> It reduces the amount of work needed
                      </div>
</div>
<div id="q5-2-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">出所のない数字は数字ではない。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 6: バイアス</p>
</div>
</div>
 モジュール 6: バイアス(アプロチニン/BART) 
<div class="module-slides" data-module="6">
<div class="slide dark active" data-index="0">
<p class="refrain animate">メソッドは、私たちの信頼から患者を守ります。</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">これは、</p>
<p class="title gold animate delay-1 text-center">バイアスは見えません。</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 6: バイアス</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Apply Risk of Bias 2.0 (RoB 2) to randomized trials</li>
<li>ROBINS-I を非ランダム化研究に適用</li>
<li>Assess all five RoB 2 domains (randomization, deviations, missing data, measurement, selection)</li>
<li>Distinguish confounding by indication from true treatment effects</li>
<li>Explain how BART revealed hidden harms of aprotinin</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<p class="big-number navy animate">20+</p>
<p class="subtitle animate delay-1">何年も市場に出て</p>
<p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">アプロチニンは外科手術を減らすためのゴールドスタンダードでした</p>
<div class="gold-line animate delay-3"></div>
<p class="animate delay-4" style="color: var(--light-text);">その後、誰かが RCT を実施しました。真実は異なりました。</p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Hidden Bias: Confounding by Indication</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Sicker patients got aprotinin:</strong> Surgeons used it in complex, high-risk cases</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Survivors bias:</strong> Dead patients can't report complications</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>Publication bias:</strong> 否定的な研究は発表されませんでした</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">観察研究では、薬の効果と患者のベースラインリスクを区別できませんでした。</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">BART: ランダム化された真実</h2>
<p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">Blood Conservation Using Antifibrinolytics in a Randomized Trial</p>
<table class="results-table animate delay-2">
<thead><tr><th>Outcome</th><th>Aprotinin</th><th>Alternatives</th></tr></thead>
<tbody>
<tr><td>30-day mortality</td><td class="highlight">6.0%</td><td>3.9%</td></tr>
<tr><td>Relative Risk</td><td class="highlight" colspan="2">1.53 (53% increased death)</td></tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">Trial Stopped Early for Harm</div>
<div class="label">11月に市場から撤退2007</div>
</div>
</div>
</div>
<!-- Investigation Exercise -->
<div class="slide dark" data-index="5">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>調査: バイアスの評価</h3>
</div>
<p class="direct-address">観察研究をレビューしています。バイアスのリスクの考え方を適用する:</p>
<table class="data-table-investigation">
<thead><tr><th>Question</th><th>Observational</th><th>BART (RCT)</th></tr></thead>
<tbody>
<tr><td>Random allocation?</td><td>❌ Surgeon choice</td><td>✓ Yes</td></tr>
<tr><td>Baseline comparable?</td><td>❌ Sicker got drug</td><td>✓ Balanced</td></tr>
<tr><td>Blinding?</td><td>❌ Open label</td><td>✓ Double-blind</td></tr>
</tbody>
</table>
<button class="reveal-btn" onclick="revealAnswer('bias-reveal')">重要な洞察を参照→</button>
<div class="hidden-reveal" id="bias-reveal">
<p><strong>Confounding by indication:</strong> 外科医は最も病気の患者にアプロチニンを投与しました。観察研究では、生存者バイアスを測定する際に、生存率は薬物によるものと考えられていました。</p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">Risk of Bias 2.0: The Five Domains</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">D1</div>
<div class="lesson-content"><h4>Randomization Process</h4></div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">D2</div>
<div class="lesson-content"><h4>意図した介入からの逸脱</h4></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">D3</div>
<div class="lesson-content"><h4>結果データの欠落</h4></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">D4</div>
<div class="lesson-content"><h4>結果の測定</h4></div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">D5</div>
<div class="lesson-content"><h4>報告結果の選択</h4></div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">ROBINS-I: 非ランダム化研究の場合</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">RCT が利用できない場合は、ROBINS-I (非ランダム化研究におけるバイアスのリスク) を使用します。介入)</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #7c3aed;">1</div>
<div class="lesson-content"><h4>Confounding</h4><p>Baseline differences between groups</p></div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #7c3aed;">2</div>
<div class="lesson-content"><h4>Selection of Participants</h4><p>Exclusions related to intervention</p></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #7c3aed;">3</div>
<div class="lesson-content"><h4>Classification of Interventions</h4><p>Misclassification of exposure status</p></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #7c3aed;">4</div>
<div class="lesson-content"><h4>意図した介入からの逸脱</h4><p>Co-interventions, contamination</p></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #7c3aed;">5</div>
<div class="lesson-content"><h4>Missing Data</h4><p>Differential loss to follow-up</p></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #7c3aed;">6</div>
<div class="lesson-content"><h4>Measurement of Outcomes</h4><p>Ascertainment bias</p></div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number" style="background: #7c3aed;">7</div>
<div class="lesson-content"><h4>Selection of Reported Result</h4><p>Selective reporting</p></div>
</div>
<p class="footnote animate delay-5" style="margin-top: 1rem;">Ratings: Low / Moderate / Serious / Critical / No information</p>
</div>
</div>
 ストーリー: アプロチニン BART 試験 
<div class="slide dark" data-index="8b">
<div class="story-box animate">
<p class="story-opener">64 件の研究が一致し、すべてが間違っている場合はどうなりますか?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    アプロチニンは、出血を減らすために心臓手術で使用され、 <span class="data-highlight">20 years</span>.
                    <span class="data-highlight">64 small randomized trials</span> 安全で効果的であることが示唆されました。メタ分析により利点が確認されました。次に、 <span class="data-highlight">BART trial</span> (2008)
                    randomized <span class="data-highlight">2,331 patients</span>: aprotinin vs. tranexamic acid vs. aminocaproic acid.
                    Result: aprotinin increased <span class="data-highlight">mortality by 53%</span> (RR 1.53、95% CI 1.06-2.22)。試験は <span class="data-highlight">危害のため早期に中止されました</span>。バイエルは数か月以内にアプロチニンを市場から撤退しました。
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">外科医の証拠: 2006</div>
<div class="decision-scenario">
                    あなたは抗線溶薬を選択している心臓外科医です。 64件の小規模な試験ではアプロチニンが支持されましたが、死亡率を検出する機能を備えた試験はありませんでした。大規模な RCT (BART) が登録中です。待ちますか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">パス A: メタ分析を信頼します</div>
<div class="path-choice">64 trials can't all be wrong. Continue prescribing aprotinin.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">小規模な試験では、死亡ではなく出血が測定されました。誰も死亡に耐える十分な力を持っていませんでした。メタ分析では検出力不足のサロゲート結果がプールされました。</div>
<div class="path-outcome">OUTCOME: Excess deaths in cardiac surgery patients</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Assess Risk of Bias First</div>
<div class="path-choice">64 件の試験すべてを RoB で評価します。規模が小さく、代理結果を使用し、減少率が高いことに注意してください。適切に機能する RCT を待ちます。</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">BART reveals the truth. Switch to safer alternatives.</div>
<div class="path-outcome">OUTCOME: Lives saved by demanding adequately powered evidence</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    証拠の量は質と同じではありません。間違った結果を測定した64件の検出力不足の試験は、死亡率を測定した1件の適切な検出力試験を上回ることはありません。バイアスのリスク評価は形式的なものではありません。これは、患者と、代理主導の小さな証拠からの誤解を招く結論との間の盾です。
                  </div>
</div>
</div>
</div>
<div class="slide dark" data-index="8">
<p class="closing-line animate">Sixty-four small trials measured bleeding, not death.</p>
<p class="closing-line animate delay-1">One adequately powered trial revealed 53% increased mortality.</p>
<p class="closing-line gold animate delay-2">証拠の量は、質や証拠の代わりにはなりません。</p>
<div class="gold-line animate delay-3"></div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Module 6 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q6-1">
<h4>1. Why did 64 small trials miss aprotinin's harm?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 0, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
<span>A.</span> Underpowered for mortality; used surrogate outcomes
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 1, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
<span>B.</span> Confounding by indication
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 2, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
<span>C.</span> Outcome measured incorrectly
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q6-1', 3, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
<span>D.</span> Follow-up too short
                      </div>
</div>
<div id="q6-1-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide black" data-index="9">
<p class="refrain animate">メソッドは、私たちの信頼から患者を守ります。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 7: 総合</p>
</div>
</div>
 モジュール 7: 総合(マグネシウム/ISIS-4) 
<div class="module-slides" data-module="7">
<div class="slide dark active" data-index="0">
<p class="refrain animate">異質性はノイズではなくメッセージです。</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">マグネシウム論争: 1991 ～ 1995 年</p>
<p class="title gold animate delay-1 text-center">When pooling leads us astray.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 7: 総合</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Calculate pooled effect sizes using fixed-effect and random-effects models</li>
<li>Choose between DerSimonian-Laird and HKSJ estimators appropriately</li>
<li>Interpret forest plots including weights, confidence intervals, and diamonds</li>
<li>Explain why small-study effects can mislead meta-analyses</li>
<li>原則を適用します: 「異質性はメッセージであり、メッセージではありません」ノイズ"</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Year: 1991</h2>
<p class="direct-address animate delay-1">
                  「あなたは希望と証拠の岐路に立たされています...」
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    Heart disease kills more people worldwide than any other cause.
                    In 1991, a new hope emerges: Could something as simple and cheap as
                    <strong>intravenous magnesium</strong> save lives after myocardial infarction?
                  </p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">生物学的理論的根拠は健全でした:</p>
<p class="sub">Magnesium stabilizes cardiac membranes, prevents arrhythmias, and vasodilates coronary arteries.</p>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">LIMIT-2:ランドマーク試験</h2>
<p class="animate delay-1" style="font-style: italic;">Leicester Intravenous Magnesium Intervention Trial, 1992</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">2,316</div>
<div class="stat-label">Patients enrolled</div>
</div>
<div class="stat-box" style="background: rgba(34, 197, 94, 0.2); border-color: #22c55e;">
<div class="stat-value">24%</div>
<div class="stat-label">Mortality reduction</div>
</div>
<div class="stat-box">
<div class="stat-value">p = 0.04</div>
<div class="stat-label">Statistically significant</div>
</div>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">A cheap, safe intervention that could save 250,000 lives per year globally.</p>
<p class="sub">医学界は興奮しました。</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">The Meta-Analysis: 1993</h2>
<p class="animate delay-1">Researchers pooled <strong>seven randomized trials</strong> of IV magnesium in MI:</p>
<table class="results-table animate delay-2">
<thead>
<tr>
<th>Trial</th>
<th>Year</th>
<th>N</th>
<th>Odds Ratio</th>
</tr>
</thead>
<tbody>
<tr><td>Morton 1984</td><td>1984</td><td>40</td><td style="color: var(--green);">0.10</td></tr>
<tr><td>Rasmussen 1986</td><td>1986</td><td>273</td><td style="color: var(--green);">0.35</td></tr>
<tr><td>Smith 1986</td><td>1986</td><td>400</td><td style="color: var(--green);">0.48</td></tr>
<tr><td>Abraham 1987</td><td>1987</td><td>94</td><td>0.87</td></tr>
<tr><td>Shechter 1990</td><td>1990</td><td>103</td><td style="color: var(--green);">0.27</td></tr>
<tr><td>Ceremuzynski 1989</td><td>1989</td><td>48</td><td style="color: var(--green);">0.22</td></tr>
<tr><td>LIMIT-2</td><td>1992</td><td>2,316</td><td style="color: var(--green);">0.74</td></tr>
</tbody>
</table>
</div>
</div>
<div class="slide dark" data-index="5">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Investigation Exercise: The Meta-Analyst's Dilemma</h3>
</div>
<p class="direct-address">
                  あなたあなたは、MI に対するマグネシウムに関する証拠を総合するように依頼されました。 7 つのトライアルからのデータが目の前にあります。
                </p>
<p class="rhetorical" style="margin: 1rem 0;">
                  この森林区画のパターンが見えますか?
                </p>
<div id="magnesium-forest-small" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
<button class="reveal-btn" onclick="drawMagnesiumForest('small')">Generate Forest Plot →</button>
<button class="reveal-btn" onclick="revealAnswer('mag-pooled')">証拠をプールしましょう →</button>
</div>
<div class="hidden-reveal" id="mag-pooled">
<div class="result-box" style="background: rgba(34, 197, 94, 0.2); border-color: #22c55e;">
<div class="value">Pooled OR = 0.44 (95% CI: 0.27–0.71)</div>
<div class="label">55% mortality reduction! Publish in the Lancet?</div>
</div>
<p style="text-align: center; margin-top: 1rem; font-style: italic;">
                    しかし、ちょっと待ってください...トライアルのサイズについて何か気づきましたか?
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">警告兆候</h2>
<p class="rhetorical animate">What should have given us pause?</p>
<div class="wrong-item animate delay-1">
<div class="wrong-number">1</div>
<p><strong>Small sample sizes:</strong> Six of seven trials had &lt;500 patients</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number">2</div>
<p><strong>Extreme effects:</strong> OR of 0.10 (90% reduction) is implausible for any drug</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number">3</div>
<p><strong>All positive:</strong> ネガティブな試験はどこにありましたか?ファイル ドロワーの問題...</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number">4</div>
<p><strong>Funnel asymmetry:</strong> Small trials showed much larger effects than larger ones</p>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>ファネル プロット テスト</h3>
</div>
<p class="direct-address">
                  プールする前に、出版バイアスをチェックする必要があります。ファネル プロットを調べてみましょう。
                </p>
<div id="magnesium-funnel-small" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<button class="reveal-btn" onclick="drawMagnesiumFunnel('small')">Generate Funnel Plot →</button>
<div id="mag-funnel-interpretation" style="display: none; margin-top: 1rem;">
<div class="focus-box" style="border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">⚠️ Asymmetric Funnel</p>
<p class="sub">左側には小規模なトライアル クラスターが表示されています (利点を示しています)。小規模な否定的な試験はどこにありますか?</p>
<p class="sub">Egger's test p = 0.04 — statistically significant asymmetry.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">年: 1995 — ISIS-4 レポート</h2>
<p class="direct-address animate delay-1">
                  「そして真実が明らかになりました...」
                </p>
<div class="card animate delay-2">
<p class="card-text text-center">
                    The <strong>Fourth International Study of Infarct Survival (ISIS-4)</strong>
                    enrolled 58,050 patients across 1,086 hospitals in 31 countries.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">58,050</div>
<div class="stat-label">Patients</div>
</div>
<div class="stat-box">
<div class="stat-value">2,216</div>
<div class="stat-label">Deaths in Mg group</div>
</div>
<div class="stat-box">
<div class="stat-value">2,103</div>
<div class="stat-label">Deaths in placebo</div>
</div>
</div>
<div class="result-box animate delay-4" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">OR = 1.06 (95% CI: 1.00–1.12)</div>
<div class="label">No benefit. If anything, a trend toward harm.</div>
</div>
</div>
</div>
<div class="slide dark" data-index="9">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>前後: 全体像</h3>
</div>
<p class="direct-address">
                  森林区画に大規模な試験を追加すると何が起こるかを見てください...
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">BEFORE ISIS-4</h4>
<p>7 small trials (N = 3,274)</p>
<p style="color: #22c55e; font-weight: bold;">OR = 0.44</p>
<p style="font-size: 0.9rem;">Strong benefit signal</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">AFTER ISIS-4</h4>
<p>8 trials (N = 61,324)</p>
<p style="color: #C53030; font-weight: bold;">OR = 1.02</p>
<p style="font-size: 0.9rem;">No effect</p>
</div>
</div>
<div id="magnesium-forest-full" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<button class="reveal-btn" onclick="drawMagnesiumForest('full')">完全なフォレスト プロットを表示 →</button>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Why Did Small Trials Mislead?</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Publication Bias</h4>
<p>Small negative trials were never published—they sat in file drawers</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Small-Study Effects</h4>
<p>Smaller trials tend to show larger effects due to methodological weaknesses</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Random High Bias</h4>
<p>偶然にも、いくつかの小さなトライアルで極端な結果が得られ、それが公開されます</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Random-Effects Amplification</h4>
<p>Random-effects models give more weight to small trials, amplifying bias</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Fixed vs. Random Effects</h2>
<p class="rhetorical animate">Which model should you choose?</p>
<div class="animate delay-1" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 850px;">
<div class="card" style="border-left: 4px solid #3b82f6;">
<div class="card-label">FIXED EFFECT MODEL</div>
<p class="card-text">Assumes <strong>one true effect</strong>. Weights studies by inverse variance (precision). Large trials dominate.</p>
<p style="font-size: 0.85rem; color: var(--navy); margin-top: 0.5rem;">
<strong>Magnesium result:</strong> OR = 0.96 (p = 0.52)
                    </p>
</div>
<div class="card" style="border-left: 4px solid #f59e0b;">
<div class="card-label">RANDOM EFFECTS MODEL</div>
<p class="card-text">Assumes <strong>distribution of effects</strong>. Gives more weight to small trials. Wider confidence intervals.</p>
<p style="font-size: 0.85rem; color: var(--navy); margin-top: 0.5rem;">
<strong>Magnesium result:</strong> OR = 0.59 (p = 0.01)
                    </p>
</div>
</div>
<div class="focus-box animate delay-2 mt-2" style="border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">⚠️ モデルの選択が結論を決定しました!</p>
<p class="sub">ランダム効果はバイアスを修正しません。小規模な研究効果がある場合、より小規模な試験に比重が移って結論が変わる可能性があります。</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">マグネシウムの教訓</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.1rem;">
<strong>1。プールされた推定値を信頼する前に、出版バイアス</strong> を確認してください。ファンネル プロットとエッガー テストがツールになります。
                  </p>
</div>
<div class="card animate delay-2">
<p class="card-text" style="font-size: 1.1rem;">
<strong>2. Be wary of small-study effects.</strong> If only small trials show benefit,
                    wait for a large, well-conducted trial.
                  </p>
</div>
<div class="card animate delay-3">
<p class="card-text" style="font-size: 1.1rem;">
<strong>3. Model choice matters.</strong> ランダム効果により、偏った証拠が増幅される可能性があります。両方のモデルを検討し、その意味を理解してください。
                  </p>
</div>
<div class="card animate delay-4">
<p class="card-text" style="font-size: 1.1rem;">
<strong>4. One large trial can overturn many small ones.</strong>
                    これが、ISIS-4 のようなメガトライアルが非常に価値のある理由です。
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="12c" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">メタアナリシスにおける特別な研究デザイン</h2>
<div class="card animate delay-1">
<p class="card-text">
                    すべての RCT が標準の並列グループ デザインを使用しているわけではありません。一般的な 2 つの選択肢では、結果をプールするときに特別な処理が必要です。
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Cluster-Randomized Trials</h4>
<p>
                      個人ではなくグループ (病院、学校) をランダム化します。 <strong>design effect</strong>
                      = 1 + (m−1) × ICC により、有効サンプル サイズが減少します。プールする前に N を設計効果で割るか、試験からの調整された SE を使用します。クラスタリングを無視すると、人為的に狭い CI が生成されます。
                    </p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Crossover Trials</h4>
<p>
                      各患者は両方の治療を受けます。ペア計画により分散は減少しますが、正しくプールするには <strong>within-patient correlation</strong> (またはペア解析 SE) が必要です。並列グループ SE の使用は保守的です。間違った N 個を使用すると、患者が二重カウントされます。
                    </p>
</div>
</div>
<p class="footnote animate delay-4">詳しい公式と実際の例については、コクラン ハンドブック v6.4、第 23 章を参照してください。</p>
</div>
</div>
 ストーリー: 初期の界面活性剤逆転 
<div class="slide dark" data-index="12b">
<div class="story-box animate">
<p class="story-opener">研究を組み合わせる方法によって、治療法が救命効果があるかどうかが決まるとしたらどうなるでしょうか。役に立たない?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    未熟児用の初期の界面活性剤は、初期の界面活性剤と後期の界面活性剤の比較 <span class="data-highlight">6 small trials</span>
                    showing <span class="data-highlight">reduced mortality</span> (RR 0.84).
                    A <span class="data-highlight">fixed-effect meta-analysis</span> confirmed benefit (p=0.04).
                    But a <span class="data-highlight">random-effects model</span> showed no significance (p=0.12)
                    — the confidence interval crossed 1.0.
                    Later, <span class="data-highlight">SUPPORT (2010)</span> and <span class="data-highlight">VON (2012)</span>,
                    two large pragmatic trials with <span class="data-highlight">~2,000 neonates</span> combined,
                    found <span class="data-highlight">no benefit</span> によってサポートされました。臨床実践は、小規模な試験と間違ったモデルに基づいて変更されてきました。
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">新生児科医のモデル選択: 2005</div>
<div class="decision-scenario">
                    あなたは、初期の界面活性剤に関するコクランのレビューを更新しています。 6 つの小規模な試験では、固定効果モデルによる利点が示されています。変量効果モデルは有意ではありません。どちらを報告しますか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Report Fixed-Effect Only</div>
<div class="path-choice">Fixed-effect is significant. Report the positive result. Change practice.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">NICUs adopt early surfactant. Later trials show no benefit. Practice reverses.</div>
<div class="path-outcome">OUTCOME: Years of unnecessary intubation of premature infants</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Report Both Models</div>
<div class="path-choice">FE と RE の結果を表示します。重要性がモデルの選択に依存することを示すフラグ。大規模な試験を募集します。</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Honest uncertainty. Large trials prioritized. True answer emerges faster.</div>
<div class="path-outcome">OUTCOME: Premature babies spared unnecessary intervention</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    固定効果を使用するか変量効果を使用するかによって結論が変わる場合、その結論は脆弱です。両方報告してください。不確実性を認めてください。そして覚えておいてください: 小規模な試験からの脆弱な結果は、慣行を変更する義務ではありません。
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">Module 7 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q7-1">
<h4>1。 ISIS-4 では得られなかったメリットがマグネシウムのメタ分析で示されたのはなぜですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 0, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>A.</span> ISIS-4 の方法論に欠陥がありました
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 1, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>B.</span> Calculation error in meta-analysis
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 2, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>C.</span> Publication bias in small trials
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-1', 3, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
<span>D.</span> LIMIT-2 の能力が不足していました
                      </div>
</div>
<div id="q7-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q7-2" style="margin-top: 1.5rem;">
<h4>2. What warning sign should have alerted reviewers to potential bias?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 0, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>A.</span> Asymmetric funnel plot (small trials showing larger effects)
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 1, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>B.</span> Low heterogeneity (I² = 0%)
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 2, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>C.</span> Strong biological plausibility
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-2', 3, 0, ['Correct! Small trials showed much larger effects than larger ones—a classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
<span>D.</span> Too few trials to analyze
                      </div>
</div>
<div id="q7-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q7-3" style="margin-top: 1.5rem;">
<h4>3. When publication bias is suspected, which model may amplify the bias?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 0, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>A.</span> Fixed effect model
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 1, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>B.</span> Random effects model
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 2, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>C.</span> Bayesian model
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q7-3', 3, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
<span>D.</span> Network meta-analysis
                      </div>
</div>
<div id="q7-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="14">
<p class="closing-line animate">Small trials can show false signals.</p>
<p class="closing-line animate delay-1">Large trials anchor the truth.</p>
<p class="closing-line gold animate delay-2">異質性はノイズではなくメッセージです。</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="15">
<p class="refrain animate">異質性はノイズではなくメッセージです。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 8: 異質性</p>
</div>
</div>
 モジュール8: 異質性 (ACCORD) 
<div class="module-slides" data-module="8">
<div class="slide dark active" data-index="0">
<p class="refrain animate">異質性はノイズではなくメッセージです。</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">ACCORD: 2008</p>
<p class="title gold animate delay-1 text-center">平均値が真実を隠すとき。</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 8: 異質性</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>I²、τ²、予測区間を計算して解釈する</li>
<li>Apply ICEMAN criteria to assess subgroup credibility</li>
<li>Distinguish between clinical, methodological, and statistical heterogeneity</li>
<li>Conduct and interpret leave-one-out sensitivity analyses</li>
<li>Explain how ACCORD revealed differential effects across subgroups</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Year: 2008</h2>
<p class="direct-address animate delay-1">
                  「あなたは、歴史上最も衝撃的な裁判終了の一つを目撃しようとしています...」
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    何十年もの間、糖尿病コミュニティには 1 つの指針がありました: <strong>lower blood sugar is better</strong>。画期的な DCCT (1993) と UKPDS (1998) は、集中的なグルコース制御により、微小血管合併症 (失明、腎不全、神経損傷) が減少することを示しました。
                  </p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">論理的推定:</p>
<p class="sub">If controlling glucose prevents complications, shouldn't intensive control prevent cardiovascular disease too?</p>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">ACCORD: Action to Control Cardiovascular Risk in Diabetes</h2>
<p class="animate delay-1" style="font-style: italic;">The definitive test of intensive glucose control</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">10,251</div>
<div class="stat-label">Type 2 diabetics</div>
</div>
<div class="stat-box">
<div class="stat-value">HbA1c &lt;6%</div>
<div class="stat-label">Intensive target</div>
</div>
<div class="stat-box">
<div class="stat-value">HbA1c 7-7.9%</div>
<div class="stat-label">Standard target</div>
</div>
</div>
<div class="card animate delay-3">
<p class="card-text">
                    すべての患者は、確立された心血管疾患または複数の危険因子のいずれかで、心血管リスクの高い 2 型糖尿病を患っていました。この試験は 5.6 年間計画されました。
                  </p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="rhetorical animate" style="font-size: 2rem;">
                February 6, 2008
              </p>
<p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                データ安全監視委員会は緊急会議を招集します。
              </p>
<p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                After 3.5 years, they make an unprecedented decision:
              </p>
<p class="title gold animate delay-3" style="font-size: 2.5rem; margin-top: 1.5rem;">
                試験を中止します。
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">衝撃的な結果</h2>
<table class="results-table animate delay-1">
<thead>
<tr>
<th>Outcome</th>
<th>Intensive</th>
<th>Standard</th>
<th>HR (95% CI)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Primary CV endpoint</td>
<td>352 events</td>
<td>371 events</td>
<td>0.90 (0.78–1.04)</td>
</tr>
<tr style="background: rgba(197, 48, 48, 0.15);">
<td><strong>All-cause mortality</strong></td>
<td><strong>257 deaths</strong></td>
<td><strong>203 deaths</strong></td>
<td class="highlight"><strong>1.22 (1.01–1.46)</strong></td>
</tr>
<tr>
<td>Severe hypoglycemia</td>
<td>10.5%</td>
<td>3.5%</td>
<td>3.0× higher</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-2" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">22% increase in mortality</div>
<div class="label">54 excess deaths in the intensive arm</div>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Investigation Exercise: The Clinician's Dilemma</h3>
</div>
<p class="direct-address">
                  あなたは 500 人の糖尿病患者を抱える内分泌学者です。 ACCORDの結果が公開されています。 HbA1c &lt;6% を目指して努力している患者さんに何と言いますか?
                </p>
<p class="rhetorical" style="margin: 1.5rem 0;">
                  集中管理は誰にとっても有害ですか?それとも一部の人だけ？
                </p>
<div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
<button class="reveal-btn" onclick="revealAnswer('accord-subgroup')">サブグループを調べる →</button>
</div>
<div class="hidden-reveal" id="accord-subgroup">
<h4 style="color: var(--gold); margin-top: 1rem;">サブグループ分析で判明:</h4>
<table class="data-table-investigation" style="margin-top: 0.5rem;">
<thead><tr><th>Subgroup</th><th>Intensive HR</th><th>Interpretation</th></tr></thead>
<tbody>
<tr><td>No prior CVD</td><td>1.00 (0.76–1.32)</td><td>No effect</td></tr>
<tr><td>Prior CVD</td><td style="color: #C53030;">1.45 (1.15–1.84)</td><td>Significant harm</td></tr>
<tr><td>Baseline HbA1c &lt;8%</td><td>1.02 (0.75–1.40)</td><td>No effect</td></tr>
<tr><td>Baseline HbA1c ≥8%</td><td style="color: #C53030;">1.29 (1.03–1.60)</td><td>Harm</td></tr>
</tbody>
</table>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">The average effect masked critical heterogeneity!</p>
<p class="sub">CVDが確立されている、またはベースラインコントロールが不十分な患者にとって、集中治療は有害でした。</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">異質性の理解: I²以降</h2>
<p class="animate delay-1">研究 (またはサブグループ) が異なることを示した場合影響を評価するには、この変動を定量化する必要があります。</p>
<div class="animate delay-2" style="max-width: 700px;">
<div class="card" style="border-left: 4px solid #22c55e;">
<p class="card-text"><strong>I² = 0–25%:</strong> 異質性が低い。効果は研究全体で一貫しています。</p>
</div>
<div class="card" style="border-left: 4px solid #3b82f6; margin-top: 0.5rem;">
<p class="card-text"><strong>I² = 25–50%:</strong> Moderate. Look for sources of variation.</p>
</div>
<div class="card" style="border-left: 4px solid #f59e0b; margin-top: 0.5rem;">
<p class="card-text"><strong>I² = 50–75%:</strong> Substantial. Consider whether pooling is appropriate.</p>
</div>
<div class="card" style="border-left: 4px solid #C53030; margin-top: 0.5rem;">
<p class="card-text"><strong>I² = 75–100%:</strong> Considerable. A single pooled estimate may mislead.</p>
</div>
</div>
<p class="footnote animate delay-3">しかし、I² だけでは何をすべきかわかりません。さらに調査する必要があることを示します。</p>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Tau² (τ²): 研究間の分散</h2>
<p class="animate delay-1">I² は不均一性による分散の割合を示しますが、τ² は</p>
<div class="animate delay-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 800px;">
<div class="card">
<div class="card-label">I² (percentage)</div>
<p class="card-text">「研究間の真の違いによる差異は全体の何分の 1 ですか?」</p>
<p style="font-size: 0.85rem;">Scale: 0% to 100%</p>
</div>
<div class="card">
<div class="card-label">τ² (absolute)</div>
<p class="card-text">「研究間の真の効果はどの程度異なりますか?」</p>
<p style="font-size: 0.85rem;">Same scale as the effect measure</p>
</div>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">Use τ² to calculate <strong>prediction intervals</strong></p>
<p class="sub">予測区間は、新しい研究で期待される効果の範囲を示します。多くの場合、信頼度よりもはるかに広いです。間隔。</p>
</div>
</div>
</div>
<div class="slide dark" data-index="9">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>The Prediction Interval: What ACCORD Really Tells Us</h3>
</div>
<p class="direct-address">
                  Consider a meta-analysis of intensive glucose control across multiple trials...
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">Confidence Interval</h4>
<p style="font-size: 1.2rem; font-weight: bold;">HR 1.10 (0.95–1.27)</p>
<p style="font-size: 0.9rem;">「平均効果の最良の推定値」</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">Prediction Interval</h4>
<p style="font-size: 1.2rem; font-weight: bold;">HR 1.10 (0.70–1.73)</p>
<p style="font-size: 0.9rem;">"The range of effects in a new setting"</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">予測間隔は利益と害の両方に及びます!</p>
<p class="sub">In some settings, intensive control might help. In others, it could kill.</p>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">When Is a Subgroup Effect Credible?</h2>
<p class="animate delay-1" style="font-style: italic;">Subgroup Credibility Criteria (adapted from ICEMAN, Schandelmaier 2020 &amp; Sun 2012)</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>サブグループ分析は事前に指定されていましたか?</h4>
<p>事後サブグループはデータが発生する傾向があります。浚渫</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Is there a plausible biological rationale?</h4>
<p>メカニズムは明確であり、データから独立している必要があります</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Is the effect consistent across related outcomes?</h4>
<p>死亡に害が現れる場合、MIや脳卒中にも同様の害はありますか?</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Is there independent replication?</h4>
<p>サブグループ効果は他の研究で確認されていますか?</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">ICEMAN Applied to ACCORD</h2>
<table class="results-table animate delay-1">
<thead>
<tr><th>Criterion</th><th>Assessment</th><th>Score</th></tr>
</thead>
<tbody>
<tr>
<td>Pre-specified?</td>
<td>はい—以前のCVDはプロトコル</td>
<td style="color: #22c55e;">✓</td>
</tr>
<tr>
<td>Biological rationale?</td>
<td>Yes—hypoglycemia more dangerous with CVD</td>
<td style="color: #22c55e;">✓</td>
</tr>
<tr>
<td>Consistent outcomes?</td>
<td>Yes—CV mortality and all-cause mortality aligned</td>
<td style="color: #22c55e;">✓</td>
</tr>
<tr>
<td>Independent replication?</td>
<td>Partially—ADVANCE, VADT showed similar patterns</td>
<td style="color: #f59e0b;">~</td>
</tr>
</tbody>
</table>
<div class="focus-box animate delay-2 mt-2">
<p class="main">ICEMAN Rating: High Credibility</p>
<p class="sub">The differential harm in high-risk patients appears genuine.</p>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">臨床的意義</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.1rem;">
<strong>CVDのない患者の場合:</strong> Moderate glucose control (HbA1c ~7%) remains the goal.
                    Intensive control may reduce microvascular complications.
                  </p>
</div>
<div class="card animate delay-2">
<p class="card-text" style="font-size: 1.1rem;">
<strong>CVDが確立している患者の場合:</strong> Avoid intensive targets.
                    Hypoglycemia is dangerous for damaged hearts.
                  </p>
</div>
<div class="card animate delay-3">
<p class="card-text" style="font-size: 1.1rem;">
<strong>高齢の患者の場合:</strong> Relaxed targets. Quality of life matters.
                    Tight control causes falls, confusion, and excess mortality.
                  </p>
</div>
<p class="footnote animate delay-4" style="font-size: 1rem; font-style: italic;">
                  "One size fits all" treatment is not patient-centered medicine.
                </p>
</div>
</div>
<!-- Meta-Regression -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">Meta-Regression: Explaining Heterogeneity</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  When heterogeneity is high, meta-regression can identify study-level covariates that explain variation.
                </p>
<div class="card animate delay-2" style="margin-bottom: 1rem;">
<div class="card-label">THE QUESTION</div>
<p class="card-text">効果量は研究によって系統的に変化するか特性?</p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value" style="font-size: 1.1rem;">Covariates</div>
<div class="stat-label">Year, dose, duration, baseline risk, study quality</div>
</div>
<div class="stat-box">
<div class="stat-value" style="font-size: 1.1rem;">Output</div>
<div class="stat-label">Regression coefficient (slope), R², residual heterogeneity</div>
</div>
</div>
<div class="focus-box animate delay-4">
<p class="main" style="color: var(--red);">Caution</p>
<p class="sub">メタ回帰には、共変量あたり 10 件以上の研究が必要です。研究はほとんどなく、あくまで探索的なものです。生態学的誤謬: 研究レベルの関連性は個人には当てはまらない可能性があります。</p>
</div>
<p class="footnote animate delay-5" style="margin-top: 1rem;">
<strong>Example:</strong> In ACCORD, meta-regression might test if treatment effect varies by baseline HbA1c, showing harm concentrated in patients with very high levels.
                </p>
</div>
</div>
 ストーリー: SPRINT 血圧革命 
<div class="slide dark" data-index="13b">
<div class="story-box animate">
<p class="story-opener">What number saves lives? Who decides?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    何十年もの間、目標は次のとおりでした: 血圧を治療して <span class="data-highlight">&lt;140 mmHg systolic</span>.
                    Then came <span class="data-highlight">SPRINT (2015)</span>: <span class="data-highlight">9,361 high-risk patients</span>
                    randomized to intensive (&lt;120) vs standard (&lt;140) targets.
                    Intensive treatment reduced <span class="data-highlight">CV events by 25%</span> and
                    <span class="data-highlight">death by 27%</span>.
                    Trial stopped early for benefit. Guidelines changed worldwide.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">Before SPRINT: The Guidelines Committee</div>
<div class="decision-scenario">
                    2014 年に血圧のガイドラインを設定しています。目標は何年も 140 未満でした。より良い証拠を待つべきですか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Maintain Status Quo</div>
<div class="path-choice">Keep &lt;140 target (established practice, minimal controversy)</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Guidelines unchanged. Physicians continue treating to &lt;140.</div>
<div class="path-outcome">OUTCOME: Miss opportunity to prevent deaths</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Fund the Definitive Trial</div>
<div class="path-choice">目標を更新する前に SPRINT の結果を待ちます</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">SPRINT demonstrates benefit. Update target to &lt;120 for high-risk patients.</div>
<div class="path-outcome">OUTCOME: Estimated 100,000+ lives saved globally</div>
</div>
</div>
</div>
<div class="story-timeline">
<div class="timeline-point">JNC 7 (2003): &lt;140</div>
<div class="timeline-point critical">Years of uncertainty</div>
<div class="timeline-point resolution">SPRINT (2015): &lt;&lt;120 (高リスク)</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    「標準治療」は修正されていません。試験が仮定に疑問を投げかけると状況は変わります。誰も明白な疑問を検証しなかったため、10 年間、患者は過小治療されてきた可能性があります。
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="14">
<div class="content">
<h2 class="title navy animate">Module 8 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q8-1">
<h4>1。 ACCORD 試験はなぜ早期に中止されたのですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 0, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
<span>A.</span> Intensive control showed clear cardiovascular benefit
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 1, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
<span>B.</span> Intensive control increased mortality
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 2, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
<span>C.</span> 登録が遅すぎました
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-1', 3, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
<span>D.</span> Budget ran out
                      </div>
</div>
<div id="q8-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q8-2" style="margin-top: 1.5rem;">
<h4>2. What does a prediction interval tell us that a confidence interval doesn't?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 0, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>A.</span> The true effect is more precisely estimated
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 1, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>B.</span> サンプルサイズは適切です
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 2, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>C.</span> 新しい研究で期待される効果の範囲
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-2', 3, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
<span>D.</span> 使用された数式
                      </div>
</div>
<div id="q8-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q8-3" style="margin-top: 1.5rem;">
<h4>3. According to ICEMAN, which factor is MOST important for subgroup credibility?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 0, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>A.</span> サブグループ仮説
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 1, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>B.</span> Large sample size in the subgroup
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 2, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>C.</span> Statistically significant p-value
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q8-3', 3, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
<span>D.</span> Multiple outcomes showing same direction
                      </div>
</div>
<div id="q8-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="15">
<p class="closing-line animate">研究結果が一致しない場合は、</p>
<p class="closing-line animate delay-1">その意見の相違に耳を傾けます。</p>
<p class="closing-line gold animate delay-2">異質性はノイズではなくメッセージです。</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="16">
<p class="refrain animate">証拠の不在は、不在の証拠ではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 9: 隠された研究</p>
</div>
</div>
 モジュール 9: 隠された研究 (レボセチン) 
<div class="module-slides" data-module="9">
<div class="slide dark active" data-index="0">
<p class="refrain animate">証拠の不在は、不在の証拠ではありません。</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Reboxetine: 2010</p>
<p class="title gold animate delay-1 text-center">決して日の目を見なかった 74%。</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 9: 隠された研究</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Interpret funnel plots for asymmetry detection</li>
<li>エッガーのテストとその他の統計テストを適用します。出版バイアス</li>
<li>バイアス調整のためのトリムアンドフィル手法の実装</li>
<li>Critically appraise the limitations of publication bias tests</li>
<li>原則の適用: 「証拠の不在は不在の証拠ではない」</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Year: 1997</h2>
<p class="direct-address animate delay-1">
                  "A new hope for depression patients who cannot tolerate SSRIs..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    レボキセチン (Edronax) は、新規の抗うつ薬、つまり選択的ノルエピネフリン再取り込み阻害剤 (NRI) でした。 SSRI とは異なり、異なる神経伝達物質系を標的としました。フルオキセチンまたはセルトラリンに失敗した、または耐性がなかった患者にとって、フルオキセチンまたはセルトラリンは新しいメカニズムを提供しました。
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">1997</div>
<div class="stat-label">EU approval</div>
</div>
<div class="stat-box">
<div class="stat-value">50+</div>
<div class="stat-label">Countries approved</div>
</div>
<div class="stat-box">
<div class="stat-value">Millions</div>
<div class="stat-label">Prescriptions written</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">公開された証拠</h2>
<p class="animate delay-1" style="font-style: italic;">What doctors could find in medical journals:</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>Comparison</th><th>Published Trials</th><th>Published Result</th></tr>
</thead>
<tbody>
<tr>
<td>Reboxetine vs Placebo</td>
<td>3 trials (n=507)</td>
<td style="color: #22c55e;">Significantly better (SMD = 0.56)</td>
</tr>
<tr>
<td>Reboxetine vs SSRIs</td>
<td>4 trials (n=628)</td>
<td style="color: #22c55e;">Equivalent or better</td>
</tr>
</tbody>
</table>
<div class="focus-box animate delay-3 mt-2">
<p class="main">公開された文献には明確なストーリーが語られています:</p>
<p class="sub">Reboxetine works. Patients benefit. Prescribe with confidence.</p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="rhetorical animate" style="font-size: 2rem;">
                しかし、目に見えなかった試験についてはどうですか?
              </p>
<p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                In 2010, German researchers at IQWiG made a request to the European Medicines Agency...
              </p>
<p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                They demanded access to <strong>all</strong> 試験データ - 公開されたものと未公開のもの。
              </p>
<p class="title gold animate delay-3" style="font-size: 2rem; margin-top: 1.5rem;">
                What they found changed everything.
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">全体像</h2>
<p class="animate delay-1" style="color: #C53030; font-weight: bold; font-style: italic;">Eyding et al., BMJ 2010</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>Comparison</th><th>Published Only</th><th>ALL DATA</th></tr>
</thead>
<tbody>
<tr>
<td><strong>Reboxetine vs Placebo</strong></td>
<td style="color: #22c55e;">SMD 0.56 (benefit)</td>
<td style="color: #C53030;"><strong>SMD 0.10 (no benefit)</strong></td>
</tr>
<tr>
<td>Patients in analysis</td>
<td>507 (14%)</td>
<td><strong>2,731 (100%)</strong></td>
</tr>
<tr>
<td><strong>Reboxetine vs SSRIs</strong></td>
<td style="color: #22c55e;">Equivalent</td>
<td style="color: #C53030;"><strong>劣悪（危害に対するRR 1.23）</strong></td>
</tr>
<tr>
<td>Patients in analysis</td>
<td>628 (26%)</td>
<td><strong>2,411 (100%)</strong></td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">患者データの74%は公開されなかった</div>
<div class="label">隠された試験では利点が示されなかったなど害</div>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Investigation Exercise: The File Drawer</h3>
</div>
<p class="direct-address">
                  あなたは、2008 年の系統的査読者です。PubMed、Embase、およびコクラン ライブラリですべてのレボセチン試験を検索します。利点を示している 7 件の公開試験が見つかりました。
                </p>
<p class="rhetorical" style="margin: 1.5rem 0;">
                  この証拠を信頼できますか?
                </p>
<div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
<button class="reveal-btn" onclick="revealAnswer('rebox-funnel')">Generate Funnel Plot →</button>
</div>
<div class="hidden-reveal" id="rebox-funnel">
<div id="reboxetine-funnel" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
<script>
                    // This will be called when revealed
                    setTimeout(() => {
                      if (document.getElementById('rebox-funnel').classList.contains('hidden-reveal') === false) {
                        drawReboxetineFunnel();
                      }
                    }, 100);
                  </script>
<button class="reveal-btn" onclick="drawReboxetineFunnel()" style="margin-top: 0.5rem;">Draw Funnel →</button>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">⚠️ ファネルは大幅に非対称です!</p>
<p class="sub">すべての公開された研究は片側に集まっています。ヌル試験と陰性試験はどこにありますか?</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">Publication Bias Toolkit</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Funnel Plot</h4>
<p>Plot effect size vs. standard error. A symmetric funnel suggests no bias; asymmetry raises alarms.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Egger's Regression Test</h4>
<p>Regress effect/SE on 1/SE. A non-zero intercept (P &lt; 0.10) suggests small-study effects. Note: inflated false-positive rate with binary outcomes; use Peters' test instead.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Peters' Test</h4>
<p>For binary outcomes, regresses log OR on inverse of total sample size. Less prone to false positives.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Trim-and-Fill</h4>
<p>「欠落している」研究を代入してファネルを対称にし、プールされた効果を再計算します。</p>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="8">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>インタラクティブ: トリムアンドフィル分析</h3>
</div>
<p class="direct-address">
                  適用しましょうリボセチン データをトリム アンド フィルして、調整された推定値がどのようになるかを確認します...
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">Published Only</h4>
<p>7 trials</p>
<p style="font-size: 1.2rem; font-weight: bold; color: #22c55e;">SMD = 0.56</p>
<p style="font-size: 0.9rem;">Significant benefit</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">Trim-and-Fill</h4>
<p>7 + 5 imputed = 12 trials</p>
<p style="font-size: 1.2rem; font-weight: bold; color: #f59e0b;">SMD = 0.23</p>
<p style="font-size: 0.9rem;">Reduced, still nominally significant</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem; border-color: #C53030;">
<p class="main" style="color: #C53030;">But even trim-and-fill underestimated the problem!</p>
<p class="sub">すべてのデータの真の効果は SMD = 0.10 (本質的にゼロ) でした。<br/>Trim-and-fill is conservative—it doesn't fully correct for selective publication.</p>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">The Best Defense: Trial Registries</h2>
<p class="animate delay-1">出版バイアスの検出方法は不完全です。本当の解決策は、 <strong>prospective registration</strong>.</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">ClinicalTrials.gov</div>
<div class="stat-label">US registry (2000)</div>
</div>
<div class="stat-box">
<div class="stat-value">WHO ICTRP</div>
<div class="stat-label">Global portal</div>
</div>
<div class="stat-box">
<div class="stat-value">PROSPERO</div>
<div class="stat-label">Review registration</div>
</div>
</div>
<div class="card animate delay-3">
<p class="card-text">
                    トライアル版を検索するときは、必ずレジストリを確認してください。 <strong>registered</strong> 試行回数と <strong>published</strong>の数を比較します。ギャップは警告信号です。
                  </p>
</div>
<p class="footnote animate delay-4">
                  Since 2005, ICMJE requires trial registration as a condition of publication.
                </p>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">AllTrials キャンペーン</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.2rem; text-align: center;">
<strong>"All trials registered. All results reported."</strong>
</p>
</div>
<p class="animate delay-2" style="margin-top: 1rem;">
                  レボセチンのスキャンダルは、他の医薬品の同様の事件とともに、世界的な動きを引き起こしました:
                </p>
<div class="lesson-item animate delay-3">
<div class="lesson-number">✓</div>
<div class="lesson-content">
<h4>2013: EMA 臨床データ ポリシー</h4>
<p>European Medicines Agency commits to publishing clinical study reports</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">✓</div>
<div class="lesson-content">
<h4>2016: FDA Amendments Act enforcement</h4>
<p>Mandatory results reporting on ClinicalTrials.gov within 12 months</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">✓</div>
<div class="lesson-content">
<h4>AllTrials Coalition</h4>
<p>Over 90,000 supporters, 700+ organizations demanding transparency</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">レボセチン余波</h2>
<div class="wrong-item animate delay-1">
<div class="wrong-number" style="background: #C53030;">!</div>
<p>Germany's IQWiG recommended against reboxetine for depression</p>
</div>
<div class="wrong-item animate delay-2">
<div class="wrong-number" style="background: #C53030;">!</div>
<p>英国のNICEはレボキセチンを「非推奨」に格下げ</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number" style="background: #C53030;">!</div>
<p>FDAは2001年にレボキセチンを拒否していた（未発表データにアクセスできた）</p>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">10年以上にわたり、患者はレボキセチンと同等の薬を投与されてきた。プラセボ。</p>
<p class="sub">肯定的な試験のみが公表されたため。</p>
</div>
</div>
</div>
 ストーリー: パロキセチン研究 329 の欺瞞 
<div class="slide dark" data-index="11b">
<div class="story-box animate">
<p class="story-opener">公表された結論が実際のデータと逆だったらどうなるか?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    グラクソ・スミスクラインの研究 329パロキセチンをテストした <span class="data-highlight">adolescent depression</span>。発表された論文 (2001 年) は、パロキセチンは <span class="data-highlight">"generally well tolerated and effective."</span>
                    であると結論付けました。実際のデータ: パロキセチン <span class="data-highlight">failed on all 8 pre-specified outcomes</span>.
                    When re-analyzed (RIAT 2015), suicidal/self-harm events: <span class="data-highlight">パロキセチン群では 23 対、プラセボ群では 5 でした</span>。公開された論文では、製造の重要性に対して事後的な結果を再定義しました。 2015 年、 <span class="data-highlight">元の臨床研究報告書</span>
                    を使用した RIAT (目に見えない試験や放棄された試験の復元) の再分析は、パロキセチンは <span class="data-highlight">neither safe nor effective</span> for adolescents.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">処方者のパズルであると結論付けました。 2003</div>
<div class="decision-scenario">
                    あなたは児童精神科医です。唯一の大規模試験である研究 329 では、パロキセチンは十代の若者に効果があると述べています。しかし、FDAは青少年に対するそれを承認していません。親がそれを処方するように頼みます。何をしますか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">パス A: 出版物を信頼します</div>
<div class="path-choice">A peer-reviewed JAACAP paper says it works. Prescribe off-label.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Millions of prescriptions worldwide. Suicidal events in adolescents.</div>
<div class="path-outcome">OUTCOME: FDA issues black box warning for SSRIs in youth (2004)</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Check the Trial Registry</div>
<div class="path-choice">ClinicalTrials.gov で元のエンドポイントを検索します。公開された結果が登録されたプロトコルと一致しないことに注意してください。</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">赤フラグ: 結果の切り替えが検出されました。あなたは薬を差し控えます。患者はより安全です。</div>
<div class="path-outcome">OUTCOME: Publication bias identified before harm</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    出版バイアスは、研究を見逃していることだけではありません。それは、公表された研究の中に真実が欠けているということです。結果の切り替え、ゴーストライティング、選択的なレポートにより、失敗した治験をマーケティング ツールに変えることができます。公開された結果をトライアル レジストリ プロトコルと常に比較してください。
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Module 9 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q9-1">
<h4>1.レボキセチン試験データの何パーセントが公表された文献から隠蔽されていますか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 0, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>A.</span> 25%
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 1, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>B.</span> 50%
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 2, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>C.</span> 74%
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-1', 3, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
<span>D.</span> 90%
                      </div>
</div>
<div id="q9-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q9-2" style="margin-top: 1.5rem;">
<h4>2. Why can trim-and-fill underestimate the correction needed?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 0, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>A.</span> It assumes effects are normally distributed
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 1, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>B.</span> 対称性を達成するために研究を押し付けているだけであり、現実を完全には反映していない可能性があります
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 2, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>C.</span> 少なくとも 20 件の研究が必要です
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-2', 3, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
<span>D.</span> 非常に大規模な研究でのみ機能します
                      </div>
</div>
<div id="q9-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q9-3" style="margin-top: 1.5rem;">
<h4>3. What is the best prospective defense against publication bias?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 0, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>A.</span> Funnel plots in all meta-analyses
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 1, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>B.</span> Egger's test before pooling
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 2, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>C.</span> Prospective trial registration
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q9-3', 3, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
<span>D.</span> More medical journals
                      </div>
</div>
<div id="q9-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="13">
<p class="closing-line animate">できないこと</p>
<p class="closing-line animate delay-1">may be more important than what you can.</p>
<p class="closing-line gold animate delay-2">証拠の不在は、不在の証拠ではありません。</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="14">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 10: 確実性</p>
</div>
</div>
 モジュール 10: 確実性 (初期界面活性剤) 
<div class="module-slides" data-module="10">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Early Surfactant: 2012</p>
<p class="title gold animate delay-1 text-center">高品質の証拠が進化するとき。</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 10: 確実性</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>完全な GRADE フレームワークを適用して、確実性を評価します。証拠</li>
<li>Evaluate all five downgrade factors (RoB, inconsistency, indirectness, imprecision, publication bias)</li>
<li>Identify when to upgrade for large effect, dose-response, or confounding</li>
<li>Construct Summary of Findings tables with absolute effect estimates</li>
<li>原則を適用する:「確実性は仮定ではなく獲得する必要がある」</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Year: 1990s</h2>
<p class="direct-address animate delay-1">
                  "A revolution in neonatal care..."
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    呼吸窮迫症候群 (RDS) は、未熟児の主な死亡原因でした。外因性 <strong>surfactant</strong>（肺胞の崩壊を防ぐ物質）の開発は、新生児医療における大きな進歩の 1 つでした。
                  </p>
</div>
<div class="focus-box animate delay-3 mt-2">
<p class="main">問題は、いつ界面活性剤を投与すべきかということになりました。</p>
<p class="sub">Prophylactically (to all high-risk infants) or selectively (only after RDS develops)?</p>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">オリジナルのコクラン レビュー(2003)</h2>
<p class="animate delay-1" style="font-style: italic;">Multiple RCTs conducted before the era of routine CPAP</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>Outcome</th><th>Prophylactic vs Selective</th><th>Certainty</th></tr>
</thead>
<tbody>
<tr>
<td>Neonatal mortality</td>
<td style="color: #22c55e;">RR 0.73 (favors prophylactic)</td>
<td>High</td>
</tr>
<tr>
<td>BPD or death</td>
<td style="color: #22c55e;">RR 0.84 (favors prophylactic)</td>
<td>High</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3">
<div class="value">Recommendation: Give surfactant prophylactically</div>
<div class="label">Guidelines worldwide adopted this approach</div>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<p class="rhetorical animate" style="font-size: 2rem;">
                しかし、新生児ケアの世界は変化していました...
              </p>
<p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                A new technology emerged: <strong>Continuous Positive Airway Pressure (CPAP)</strong>
</p>
<p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                Non-invasive support that could help preterm lungs without intubation.
              </p>
<p class="title gold animate delay-3" style="font-size: 1.5rem; margin-top: 1.5rem;">
                古い証拠はまだ適用されますか?
              </p>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">2012 コクラン アップデート</h2>
<p class="animate delay-1" style="color: #C53030; font-weight: bold;">New trials conducted in the CPAP era</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>Outcome</th><th>Old Trials</th><th>New Trials</th></tr>
</thead>
<tbody>
<tr>
<td>BPD or death</td>
<td style="color: #22c55e;">RR 0.84 (favors prophylactic)</td>
<td style="color: #C53030;">RR 1.12 (favors selective)</td>
</tr>
<tr>
<td>機械的ケアの必要性換気</td>
<td style="color: #22c55e;">予防薬で下げる</td>
<td style="color: #C53030;">予防薬で上げる!</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">Complete Reversal</div>
<div class="label">In the CPAP era, prophylactic surfactant causes more harm</div>
</div>
</div>
</div>
<div class="slide dark" data-index="6">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>Investigation: Why Did Evidence Evolve?</h3>
</div>
<p class="direct-address">
                  あなたは新生児科医です。同僚の質問: 「ランダム化試験はどのようにして互いに矛盾するのでしょうか?」
                </p>
<p class="rhetorical" style="margin: 1rem 0;">
                  元の証拠は間違っていましたか?
                </p>
<button class="reveal-btn" onclick="revealAnswer('surfactant-explain')">進化を理解する →</button>
<div class="hidden-reveal" id="surfactant-explain">
<div class="lesson-item" style="margin-top: 1rem;">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Indirectness Changed</h4>
<p>Old trials: No CPAP available. New trials: CPAP standard of care.</p>
</div>
</div>
<div class="lesson-item">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>コンパレータが改良されました</h4>
<p>Selective surfactant + CPAP is better than prophylactic intubation.</p>
</div>
</div>
<div class="lesson-item">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Context Matters</h4>
<p>ある時代の証拠は次の時代には当てはまらない可能性があります</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">This is why GRADE assesses Indirectness!</p>
<p class="sub">High-quality evidence can become inapplicable when context changes.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">GRADE フレームワーク</h2>
<p class="animate delay-1" style="margin-bottom: 1rem; font-style: italic;">
                  Grading of Recommendations, Assessment, Development and Evaluations
                </p>
<p class="animate delay-2">GRADE は次の質問に答えます: <strong>この推定値にはどの程度自信がありますか?</strong></p>
<div class="animate delay-3" style="max-width: 700px;">
<div class="card" style="background: rgba(34,197,94,0.15); border-left: 4px solid #22c55e;">
<p class="card-text"><strong>⊕⊕⊕⊕ HIGH:</strong> Very confident. True effect is close to the estimate.</p>
</div>
<div class="card" style="background: rgba(59,130,246,0.15); border-left: 4px solid #3b82f6; margin-top: 0.5rem;">
<p class="card-text"><strong>⊕⊕⊕◯ MODERATE:</strong> Moderately confident. True effect likely close, but may differ substantially.</p>
</div>
<div class="card" style="background: rgba(245,158,11,0.15); border-left: 4px solid #f59e0b; margin-top: 0.5rem;">
<p class="card-text"><strong>⊕⊕◯◯ LOW:</strong> Limited confidence. True effect may differ substantially.</p>
</div>
<div class="card" style="background: rgba(197,48,48,0.15); border-left: 4px solid #C53030; margin-top: 0.5rem;">
<p class="card-text"><strong>⊕◯◯◯ VERY LOW:</strong> Very little confidence. True effect likely substantially different.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">GRADE: Factors That Downgrade Certainty</h2>
<p class="animate delay-1">RCT の証拠は HIGH から始まります。以下の場合に格下げされる可能性があります。</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #C53030;">1</div>
<div class="lesson-content">
<h4>Risk of Bias</h4>
<p>Flawed randomization, lack of blinding, incomplete follow-up, selective reporting</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #C53030;">2</div>
<div class="lesson-content">
<h4>Inconsistency</h4>
<p>Unexplained heterogeneity across studies (large I², non-overlapping CIs)</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #C53030;">3</div>
<div class="lesson-content">
<h4>Indirectness</h4>
<p>母集団、介入、比較対象、または質問からの結果の違い</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number" style="background: #C53030;">4</div>
<div class="lesson-content">
<h4>Imprecision</h4>
<p>Wide confidence intervals, small sample size, few events</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">グレード: 第 5 因子</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #C53030;">5</div>
<div class="lesson-content">
<h4>Publication Bias</h4>
<p>Asymmetric funnel plot, missing registered trials, sponsor influence</p>
</div>
</div>
<div class="focus-box animate delay-2 mt-2">
<p class="main">Each factor can downgrade by one or two levels</p>
<p class="sub">High → Moderate → Low → Very Low</p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem;">
<p class="card-text">
<strong>Example:</strong> バイアスのリスクが高く (↓1)、深刻な間接性 (↓1) の RCT (高から始まる) のメタ分析は次のようになります。評価 <strong>LOW</strong>.
                  </p>
</div>
</div>
</div>
<div class="slide dark" data-index="10">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>Interactive: Apply GRADE to Surfactant</h3>
</div>
<p class="direct-address">
                  古い試験と新しい試験を使用して、予防用界面活性剤の証拠の確実性を評価しましょう。
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">OLD TRIALS (Pre-CPAP)</h4>
<p><strong>Starting:</strong> HIGH (RCTs)</p>
<p><strong>Risk of Bias:</strong> Low (−0)</p>
<p><strong>Inconsistency:</strong> None (−0)</p>
<p><strong>Indirectness:</strong> Serious (−1)</p>
<p style="font-size: 0.85rem; color: #f59e0b;">Different standard of care today</p>
<p><strong>Final:</strong> ⊕⊕⊕◯ MODERATE</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">NEW TRIALS (CPAP Era)</h4>
<p><strong>Starting:</strong> HIGH (RCTs)</p>
<p><strong>Risk of Bias:</strong> Low (−0)</p>
<p><strong>Inconsistency:</strong> None (−0)</p>
<p><strong>Indirectness:</strong> None (−0)</p>
<p style="font-size: 0.85rem; color: #22c55e;">Matches current practice</p>
<p><strong>Final:</strong> ⊕⊕⊕⊕ HIGH</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">GRADE: Factors That Upgrade Certainty</h2>
<p class="animate delay-1">観察証拠は低から始まります。以下の条件でアップグレードできます。</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #22c55e;">+1</div>
<div class="lesson-content">
<h4>Large Magnitude of Effect</h4>
<p>RR &gt;2 または &lt;0.5 で、もっともらしい交絡はありません</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #22c55e;">+1</div>
<div class="lesson-content">
<h4>Dose-Response Gradient</h4>
<p>Higher exposure = larger effect in a consistent pattern</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #22c55e;">+1</div>
<div class="lesson-content">
<h4>Residual Confounding</h4>
<p>All plausible confounders would reduce the effect (strengthens causal inference)</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Communicating Certainty</h2>
<p class="animate delay-1">GRADE requires transparent language about confidence:</p>
<div class="card animate delay-2">
<p class="card-text"><strong>HIGH:</strong> "Prophylactic surfactant <em>reduces</em> mortality..."</p>
</div>
<div class="card animate delay-3">
<p class="card-text"><strong>MODERATE:</strong> "Prophylactic surfactant <em>probably reduces</em> mortality..."</p>
</div>
<div class="card animate delay-4">
<p class="card-text"><strong>LOW:</strong> "Prophylactic surfactant <em>may reduce</em> mortality..."</p>
</div>
<div class="card animate delay-5">
<p class="card-text"><strong>VERY LOW:</strong> "We are <em>uncertain whether</em> prophylactic surfactant reduces mortality..."</p>
</div>
<p class="footnote animate delay-6">
                  この言語により、臨床医は証拠の強さを確実に理解できます。
                </p>
</div>
</div>
 ストーリー: 低酸素症による未熟児酸素のパラドックス 
<div class="slide dark" data-index="12b">
<div class="story-box animate">
<p class="story-opener">Can too much of a lifesaver become a killer?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
<span class="data-highlight">1940s-50s:</span> High oxygen concentrations saved premature babies from respiratory failure.
                    Then came an <span class="data-highlight">epidemic of blindness</span>—retrolental fibroplasia (now called ROP).
                    Doctors <span class="data-highlight">reduced oxygen dramatically</span>. Blindness dropped.
                    But then: <span class="data-highlight">increased deaths and brain damage</span> 。必要な最適酸素レベル <span class="data-highlight">decades of trials</span> to find.
                    Recent SUPPORT/BOOST II trials finally defined the therapeutic window: SpO2 <span class="data-highlight">91-95%</span>.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">新生児科医のジレンマ: 1955</div>
<div class="decision-scenario">
                    あなたは新生児科医です。高酸素状態の未熟児は失明してしまいます。何をしますか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Dramatic Reduction</div>
<div class="path-choice">Drastically reduce oxygen to prevent blindness</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Blindness rates drop. But some babies die or suffer brain damage from hypoxia.</div>
<div class="path-outcome">OUTCOME: Trading one harm for another</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">パス B: 系統的研究</div>
<div class="path-choice">酸素を慎重に滴定し、用量反応関係を研究します</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Takes decades but eventually identifies the optimal range.</div>
<div class="path-outcome">OUTCOME: Optimize both survival and vision</div>
</div>
</div>
</div>
<div class="story-timeline">
<div class="timeline-point">1940s: High O2 saves lives</div>
<div class="timeline-point critical">1950s: Blindness epidemic</div>
<div class="timeline-point critical">1960 年代から 70 年代: 低酸素による死亡</div>
<div class="timeline-point resolution">2010s: SUPPORT/BOOST define optimal range</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    すべての介入には治療期間があります。それを見つけるには、仮定ではなく測定が必要です。証拠がバランスを決定するまで、振り子は 60 年間揺れました。
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="13">
<div class="content">
<h2 class="title navy animate">Module 10 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q10-1">
<h4>1。 2003 年から 2012 年にかけて界面活性剤の推奨が逆転したのはなぜですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 0, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>A.</span> 元の試験は不正でした
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 1, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>B.</span> CPAP changed the comparator (indirectness)
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 2, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>C.</span> Not enough patients in original trials
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-1', 3, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
<span>D.</span> 結果の測定方法は異なりました
                      </div>
</div>
<div id="q10-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q10-2" style="margin-top: 1.5rem;">
<h4>2。 GRADE ダウングレード要素ではないものは次のうちどれですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 0, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>A.</span> Risk of bias
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 1, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>B.</span> Imprecision
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 2, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>C.</span> Publication bias
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q10-2', 3, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
<span>D.</span> Large magnitude of effect
                      </div>
</div>
<div id="q10-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q10-3" style="margin-top: 1.5rem;">
<h4>3.確実性が低い証拠にはどのような表現を使用する必要がありますか?</h4>
<div class="quiz-options">
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 0, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>A.</span> 「介入により減少します...」
                      </div>
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 1, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>B.</span> 「介入によりおそらく減少します...」
                      </div>
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 2, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>C.</span> 「介入により減少する可能性があります...」
                      </div>
<div '\"probably="" '\"uncertain\"="" 'correct!="" \"may="" class="quiz-option" confidence.',="" confidence.'])"="" for="" high="" implies="" is="" low="" moderate="" onclick="checkQuizAnswer('q10-3', 3, 2, ['\" reduce\"="" reduces\"="" signals="" very="">
<span>D.</span> 「かどうかは不明です...」
                      </div>
</div>
<div id="q10-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="14">
<p class="closing-line animate">数値は次のとおりです。十分ではありません。</p>
<p class="closing-line animate delay-1">どの程度確信しているのかを伝える必要があります。</p>
<p class="closing-line gold animate delay-2">Certainty must be earned, not assumed.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="15">
<p class="refrain animate">メソッドは、私たちの信頼から患者を守ります。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 11: 生活のレビュー</p>
</div>
</div>
 モジュール 11: 生活のレビュー (新型コロナウイルス感染症) 
<div class="module-slides" data-module="11">
<div class="slide dark active" data-index="0">
<p class="refrain animate">メソッドは、私たちの信頼から患者を守ります。</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">COVID-19 Hydroxychloroquine: 2020</p>
<p class="title gold animate delay-1 text-center">緊急性が高まったとき</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 11: 生活のレビュー</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>臨床試験の逐次分析を適用して証拠が十分であるかどうかを判断する</li>
<li>生きた系統的レビューを設計および維持する</li>
<li>Establish update triggers and futility/harm boundaries</li>
<li>Manage multiplicity and alpha-spending in sequential analyses</li>
<li>Explain how rapid evidence synthesis evolved during COVID-19</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">March 2020: A World in Crisis</h2>
<p class="direct-address animate delay-1">
                  「ウイルスは私たちの理解よりも速く拡散します...」
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    新型コロナウイルス感染症により数千人が死亡しました。 ICUが溢れた。ワクチンも治療法もありませんでした。そして、一縷の希望: <strong>hydroxychloroquine (HCQ)</strong>—an old malaria drug—showed
                    antiviral activity in lab studies.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">March 20</div>
<div class="stat-label">ゴートレ調査 (フランス)</div>
</div>
<div class="stat-box">
<div class="stat-value">36 pts</div>
<div class="stat-label">Non-randomized</div>
</div>
<div class="stat-box">
<div class="stat-value">Viral</div>
<div class="stat-label">Clearance improved</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">採用ラッシュ</h2>
<p class="animate delay-1" style="font-style: italic;">ゴートレ調査から数週間以内:</p>
<div class="wrong-item animate delay-2">
<div class="wrong-number" style="background: #f59e0b;">!</div>
<p><strong>March 28:</strong> FDA issues Emergency Use Authorization for HCQ</p>
</div>
<div class="wrong-item animate delay-3">
<div class="wrong-number" style="background: #f59e0b;">!</div>
<p><strong>April 4:</strong> India bans HCQ export (hoarding fears)</p>
</div>
<div class="wrong-item animate delay-4">
<div class="wrong-number" style="background: #f59e0b;">!</div>
<p><strong>Global:</strong> Shortages affect lupus and rheumatoid arthritis patients</p>
</div>
<div class="focus-box animate delay-5 mt-2" style="border-color: #f59e0b;">
<p class="main" style="color: #f59e0b;">Millions received HCQ based on a 36-patient observational study</p>
<p class="sub">What could go wrong?</p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>調査: ゴートレ調査</h3>
</div>
<p class="direct-address">
                  あなたは、フランスの HCQ 調査の評価を依頼された EBM 専門家です。設計を検討します...
                </p>
<button class="reveal-btn" onclick="revealAnswer('hcq-flaws')">欠陥を特定します →</button>
<div class="hidden-reveal" id="hcq-flaws">
<table class="data-table-investigation" style="margin-top: 1rem;">
<thead><tr><th>Issue</th><th>Impact</th></tr></thead>
<tbody>
<tr><td><strong>Non-randomized</strong></td><td>Selection bias—who got HCQ?</td></tr>
<tr><td><strong>6 patients excluded</strong></td><td>3 went to ICU, 1 died, 1 withdrew, 1 had nausea</td></tr>
<tr><td><strong>Surrogate outcome</strong></td><td>Viral load, not clinical outcomes</td></tr>
<tr><td><strong>別の病院からの対照</strong></td><td>Different care, different testing</td></tr>
<tr><td><strong>No blinding</strong></td><td>Expectation bias in lab testing</td></tr>
</tbody>
</table>
<div class="focus-box" style="margin-top: 1rem; border-color: #C53030;">
<p class="main" style="color: #C53030;">この研究では、RoB 2.0 に関するバイアスのリスクが高いと評価されます</p>
<p class="sub">GRADE certainty: VERY LOW. Yet it changed global policy.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Why Observational COVID Studies Misled</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #C53030;">1</div>
<div class="lesson-content">
<h4>Immortal Time Bias</h4>
<p>Patients must survive long enough to receive treatment. Survivors are compared to non-survivors.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #C53030;">2</div>
<div class="lesson-content">
<h4>Confounding by Indication</h4>
<p>Sicker patients may get different treatments. Healthier patients received HCQ early.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #C53030;">3</div>
<div class="lesson-content">
<h4>Healthy User Effect</h4>
<p>Patients who seek treatment tend to be healthier overall.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #C53030;">4</div>
<div class="lesson-content">
<h4>Outcome Reporting</h4>
<p>肯定的な結果が得られた研究はより早く発表されました。</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">2020 年 6 月: RCT レポート</h2>
<p class="animate delay-1" style="font-style: italic;">Large, rigorous trials completed at remarkable speed</p>
<table class="results-table animate delay-2">
<thead>
<tr><th>Trial</th><th>N</th><th>Result</th></tr>
</thead>
<tbody>
<tr>
<td>RECOVERY (UK)</td>
<td>4,716</td>
<td style="color: #C53030;">No benefit on mortality (RR 1.09)</td>
</tr>
<tr>
<td>WHO SOLIDARITY</td>
<td>954</td>
<td style="color: #C53030;">No benefit (RR 1.19)</td>
</tr>
<tr>
<td>ORCHID (US)</td>
<td>479</td>
<td style="color: #C53030;">停止されました。無駄性</td>
</tr>
</tbody>
</table>
<div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
<div class="value">HCQ provided no benefit—and may have caused harm</div>
<div class="label">June 15, 2020: FDA revokes Emergency Use Authorization</div>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">📊</span>
<h3>タイムライン: 観察証拠と RCT 証拠</h3>
</div>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">March-May 2020</h4>
<p><strong>Observational:</strong> ~20 studies</p>
<p style="color: #22c55e;">Suggest benefit</p>
<p style="font-size: 0.85rem;">Pooled OR ~0.65</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">June-July 2020</h4>
<p><strong>RCTs:</strong> RECOVERY, SOLIDARITY</p>
<p style="color: #C53030;">Show no benefit/harm</p>
<p style="font-size: 0.85rem;">Pooled RR ~1.10</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem;">
<p class="main">3 か月で「有望」から「効果がない」まで</p>
<p class="sub">これが、ランダム化と進化する証拠を追跡するための生きたレビューが必要な理由です。</p>
</div>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Living Systematic Reviews</h2>
<p class="animate delay-1">急速に進化するための新しいアプローチ証拠:</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #22c55e;">1</div>
<div class="lesson-content">
<h4>Continuous Surveillance</h4>
<p>文献を毎週または毎日検索して新しい証拠を探します</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #22c55e;">2</div>
<div class="lesson-content">
<h4>Cumulative Meta-Analysis</h4>
<p>Update pooled estimates as each new trial reports</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #22c55e;">3</div>
<div class="lesson-content">
<h4>試験逐次分析 (TSA)</h4>
<p>Determine when sufficient information has accumulated to conclude</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number" style="background: #22c55e;">4</div>
<div class="lesson-content">
<h4>Transparent Versioning</h4>
<p>Track every change, maintain full audit trail</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">試験逐次分析 (TSA)</h2>
<p class="animate delay-1" style="font-style: italic;">When have we learned enough?</p>
<div class="card animate delay-2">
<p class="card-text">
                    TSA は、単一試験の中間分析と同様に、メタ分析に停止境界を適用します。これは、 <strong>required information size (RIS)</strong> needed to detect or exclude
                    a clinically meaningful effect.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">RIS</div>
<div class="stat-label">Required sample size</div>
</div>
<div class="stat-box">
<div class="stat-value">α-spending</div>
<div class="stat-label">Controls type I error</div>
</div>
<div class="stat-box">
<div class="stat-value">Boundaries</div>
<div class="stat-label">Benefit / Harm / Futility</div>
</div>
</div>
<p class="footnote animate delay-4">
                  新型コロナウイルス感染症における HCQ について、TSA は 2020 年 6 月までに無駄の境界を越えたことを示しました。
                </p>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">バイアスが蔓延している場合の HCQ サーガからの教訓</h2>
<div class="card animate delay-1">
<p class="card-text" style="font-size: 1.1rem;">
<strong>1. Observational studies can mislead spectacularly</strong> 。同じ方向を指している多くの研究でも、間違っている可能性があります。
                  </p>
</div>
<div class="card animate delay-2">
<p class="card-text" style="font-size: 1.1rem;">
<strong>2. RCTs can be conducted quickly</strong> when the will exists.
                    RECOVERY enrolled 5,000+ patients in weeks.
                  </p>
</div>
<div class="card animate delay-3">
<p class="card-text" style="font-size: 1.1rem;">
<strong>3.生活レビューは不可欠です</strong> for evolving topics.
                    Fixed-point-in-time reviews become obsolete instantly.
                  </p>
</div>
<div class="card animate delay-4">
<p class="card-text" style="font-size: 1.1rem;">
<strong>4. Political pressure doesn't change biology.</strong>
                    プレッシャーの下でも厳格な方法で患者を守ります。
                  </p>
</div>
</div>
</div>
 ストーリー: LEAP ピーナッツ アレルギー革命 
<div class="slide dark" data-index="10b">
<div class="story-box animate">
<p class="story-opener">予防が原因ならどうしますか?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    For decades, pediatric guidelines recommended: <span class="data-highlight">avoid peanuts in infancy</span> to prevent allergy.
                    Meanwhile, peanut allergy rates <span class="data-highlight">tripled</span> 1997 年から 2008 年まで。 <span class="data-highlight">LEAP (2015)</span>: 640 high-risk infants randomized to
                    early peanut introduction vs. avoidance.
                    Result: Early introduction <span class="data-highlight">reduced peanut allergy by 81%</span> が来ました (1.9% 対 13.7%)。予防戦略が流行の原因となっていました。
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">アレルギー専門医の岐路: 2010</div>
<div class="decision-scenario">
                    あなたは小児アレルギー専門医です。回避ガイドラインにもかかわらず、ピーナッツアレルギーは増加しています。定説に疑問を持ちますか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Follow Guidelines</div>
<div class="path-choice">Continue recommending peanut avoidance in high-risk infants</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Guidelines are "evidence-based." Safe to follow consensus.</div>
<div class="path-outcome">OUTCOME: Peanut allergies continue to rise</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">パス B: 定説に疑問を呈します</div>
<div class="path-choice">Design a trial to test if early introduction might be protective</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">LEAP trial reveals the truth. Guidelines reverse worldwide.</div>
<div class="path-outcome">OUTCOME: Prevent an epidemic</div>
</div>
</div>
</div>
<div class="story-timeline">
<div class="timeline-point">2000: AAP recommends avoidance</div>
<div class="timeline-point critical">2008: Allergy rates triple</div>
<div class="timeline-point resolution">2015: LEAP が証拠を覆します</div>
<div class="timeline-point resolution">2017: Guidelines flip to early introduction</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    「まず、危害を加えない」には証拠が必要です。思い込みは、たとえ善意のものであっても、大規模な損害を引き起こす可能性があります。免疫系は耐性を獲得するために曝露を必要とし、回避すると感作が生じます。
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 11 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q11-1">
<h4>1. Gautret ヒドロキシクロロキン研究の主な欠陥は何でしたか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 0, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>A.</span> Too few patients
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 1, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>B.</span> No blinding
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 2, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>C.</span> Excluding patients who deteriorated
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-1', 3, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
<span>D.</span> Too short follow-up
                      </div>
</div>
<div id="q11-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q11-2" style="margin-top: 1.5rem;">
<h4>2. What does Trial Sequential Analysis help determine?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 0, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>A.</span> Which studies have high risk of bias
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 1, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>B.</span> When enough evidence has accumulated
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 2, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>C.</span> 不均一性の程度
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-2', 3, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
<span>D.</span> Which treatment is best
                      </div>
</div>
<div id="q11-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q11-3" style="margin-top: 1.5rem;">
<h4>3。新型コロナウイルスの観察研究ではHCQの利点が示されたのに、RCTでは効果が得られなかったのはなぜですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 0, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>A.</span> RCTs enrolled sicker patients
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 1, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>B.</span> RCTs used different outcomes
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 2, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>C.</span> 観察研究の偏り
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q11-3', 3, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
<span>D.</span> 観察研究にはより優れたデータがあった
                      </div>
</div>
<div id="q11-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="12">
<p class="closing-line animate">Speed cannot replace rigor.</p>
<p class="closing-line animate delay-1">But rigor can be fast.</p>
<p class="closing-line gold animate delay-2">Living reviews balance both.</p>
<div class="gold-line animate delay-3"></div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 12: 高度な手法</p>
</div>
</div>
 モジュール 12: 高度な手法 
<div class="module-slides" data-module="12">
<div class="slide dark active" data-index="0">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
</div>
<div class="slide dark" data-index="1">
<p class="title cream animate text-center">Advanced Methods</p>
<p class="title gold animate delay-1 text-center">Beyond pairwise meta-analysis.</p>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">モジュール 12: 高度な手法</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Interpret network meta-analysis geometry and SUCRA rankings</li>
<li>Apply bivariate models for diagnostic test accuracy meta-analysis</li>
<li>Conduct dose-response meta-analysis with flexible splines</li>
<li>Understand when individual patient data (IPD) meta-analysis is needed</li>
<li>それぞれの先進的な手法の仮定と限界を認識するメソッド</li>
</ul>
</div>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">ペアワイズが不十分な場合</h2>
<p class="direct-address animate delay-1">
                  「質問が A と B よりも複雑な場合もあります...」
                </p>
<div class="card animate delay-2">
<p class="card-text">
                    これまでに学習したメソッドが基礎を形成します。しかし、臨床の現実では、さらに多くのことが要求されることがよくあります。
                    <strong>Which of 10 antidepressants is best?</strong> <strong>What's the optimal dose of statin?</strong>
<strong>Does this test accurately diagnose early cancer?</strong>
</p>
</div>
<p class="footnote animate delay-3">
                  このモジュールでは、4 つの高度な方法が紹介されており、それぞれが異なる複雑な質問に答えます。
                </p>
</div>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Network Meta-Analysis (NMA)</h2>
<p class="animate delay-1" style="font-style: italic;">When you have many treatments but few head-to-head trials</p>
<div class="card animate delay-2">
<p class="card-text">
                    NMA combines <strong>direct evidence</strong> (A vs B) with <strong>indirect evidence</strong>
                    (A vs C, B vs C → inferred A vs B) to compare multiple treatments simultaneously.
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">SUCRA</div>
<div class="stat-label">Ranking probabilities, not effect size</div>
</div>
<div class="stat-box">
<div class="stat-value">Consistency</div>
<div class="stat-label">Direct = Indirect?</div>
</div>
<div class="stat-box">
<div class="stat-value">Networks</div>
<div class="stat-label">Visualize evidence</div>
</div>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<div class="investigation-box animate">
<div class="investigation-header">
<span class="icon">🔍</span>
<h3>NMA Example: Antidepressants</h3>
</div>
<p class="direct-address">
                  The landmark Cipriani 2018 NMA compared 21 antidepressants using 522 trials.
                </p>
<div class="comparison-grid" style="margin-top: 1rem;">
<div class="comparison-box">
<h4 style="color: var(--gold);">The Challenge</h4>
<p>21 drugs, but not every pair tested head-to-head</p>
<p style="font-size: 0.85rem;">Many vs. placebo, few vs. each other</p>
</div>
<div class="comparison-box">
<h4 style="color: var(--gold);">The Solution</h4>
<p>NMA はネットワーク全体で直接証拠と間接証拠を組み合わせます</p>
<p style="font-size: 0.85rem;">有効性と受け入れ可能性に関して 21 項目すべてをランク付けします</p>
</div>
</div>
<div class="focus-box" style="margin-top: 1rem;">
<p class="main">結果: 一部の薬は有効性で上位にランクされ、他の薬は受け入れやすさで上位にランクされます</p>
<p class="sub">単一の薬は普遍的に「最良」というわけではありません。信頼区間、推移性、および臨床的トレードオフを使用してランキングを解釈します。</p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">NMA: Critical Assumptions</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #f59e0b;">1</div>
<div class="lesson-content">
<h4>Transitivity</h4>
<p>Effect modifiers should be similarly distributed across comparisons; otherwise indirect comparisons may be biased</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #f59e0b;">2</div>
<div class="lesson-content">
<h4>Consistency</h4>
<p>直接証拠と間接証拠が一致します (テスト可能)</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #f59e0b;">3</div>
<div class="lesson-content">
<h4>Connected Network</h4>
<p>All treatments linked through at least one common comparator</p>
</div>
</div>
<div class="focus-box animate delay-4 mt-2">
<p class="main">When assumptions fail, NMA can mislead</p>
<p class="sub">常に推移性を評価し、テストを行ってください。不一致。</p>
</div>
</div>
</div>
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">Dose-Response Meta-Analysis</h2>
<p class="animate delay-1" style="font-style: italic;">最適な投与量を見つける</p>
<div class="card animate delay-2">
<p class="card-text">
                    Uses the <strong>Greenland-Longnecker method</strong> 制限付き三次スプラインを使用して、用量と効果の間の非線形関係をモデル化します。
                  </p>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Non-linear patterns</h4>
<p>J-shaped (alcohol &amp; mortality), U-shaped (vitamin D), threshold (aspirin)</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Clinical relevance</h4>
<p>「多ければ多いほど良い」だけではなく、利益と害のバランスが最適な用量を見つけます</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">個別の患者データ (IPD)</h2>
<p class="animate delay-1" style="font-style: italic;">サブグループ分析のゴールドスタンダード</p>
<div class="card animate delay-2">
<p class="card-text">
                    Instead of published summary data, obtain <strong>生治験実施者からの患者レベルのデータ</strong> 。正確なサブグループ分析、イベント発生までの時間モデリング、および標準化された定義を可能にします。
                  </p>
</div>
<div class="stats-grid animate delay-3">
<div class="stat-box">
<div class="stat-value">One-Stage</div>
<div class="stat-label">Single hierarchical model (not mega-trial)</div>
</div>
<div class="stat-box">
<div class="stat-value">Two-Stage</div>
<div class="stat-label">Analyze, then pool</div>
</div>
<div class="stat-box">
<div class="stat-value">80%+ target</div>
<div class="stat-label">データ利用可能性の目標</div>
</div>
</div>
<p class="footnote animate delay-4">
                  早期乳がん治験者の共同グループは、1980 年代に IPD MA の先駆者となりました。
                </p>
</div>
</div>
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Diagnostic Test Accuracy (DTA)</h2>
<p class="animate delay-1" style="font-style: italic;">「介入」が必要な場合テスト</p>
<div class="card animate delay-2">
<p class="card-text">
                    DTA meta-analysis synthesizes <strong>sensitivity</strong> (真陽性率) と
                    <strong>specificity</strong> (true negative rate)—two correlated outcomes requiring
                    bivariate models.
                  </p>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Bivariate/HSROC Model</h4>
<p>感度と特異度の相関関係を考慮</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>SROC Curve</h4>
<p>95% の信頼度および予測領域を含む ROC 曲線の概要</p>
</div>
</div>
<div class="lesson-item animate delay-5">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>QUADAS-2</h4>
<p>Quality Assessment of Diagnostic Accuracy Studies</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">適切な方法の選択</h2>
<table class="results-table animate delay-1">
<thead>
<tr><th>Question</th><th>Method</th></tr>
</thead>
<tbody>
<tr><td>Does A beat B?</td><td><strong>Pairwise MA</strong></td></tr>
<tr><td>Which of many treatments is best?</td><td><strong>Network MA (NMA)</strong></td></tr>
<tr><td>最適なものは何か用量は?</td><td><strong>Dose-Response MA</strong></td></tr>
<tr><td>Who benefits most? (subgroups)</td><td><strong>IPD MA</strong></td></tr>
<tr><td>この検査はどの程度正確ですか?</td><td><strong>DTA MA</strong></td></tr>
<tr><td>効果は時間の経過とともにどのように変化しますか?</td><td><strong>Survival/Time-to-Event MA</strong></td></tr>
</tbody>
</table>
<p class="footnote animate delay-2">方法は質問と一致している必要があります。間違った方法で質問を強制しないでください。</p>
</div>
</div>
 ストーリー: 敗血症のステロイド 
<div class="slide dark" data-index="9b">
<div class="story-box animate">
<p class="story-opener">Three large trials. Three different answers. What do you believe?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
<span class="data-highlight">CORTICUS (2008):</span> 499 patients. Hydrocortisone in septic shock. <span class="data-highlight">No mortality benefit</span>.
                    <span class="data-highlight">ADRENAL (2018):</span> 3,658 patients. Hydrocortisone. <span class="data-highlight">No mortality benefit</span>.
                    <span class="data-highlight">APROCCHSS (2018):</span> 1,241 patients. Hydrocortisone + fludrocortisone. <span class="data-highlight">Mortality reduced</span> (43% vs 49.1%, p=0.03).
                    Same class of intervention. Different protocols. Different results.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">ガイドライン作成者の挑戦</div>
<div class="decision-scenario">
                    あなたは敗血症ガイドラインを作成しています。 3つの主要な裁判では意見が一致していない。どのように推奨しますか?
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">PATH A: Simple Average</div>
<div class="path-choice">Pool all three trials. Overall effect uncertain. Conclude "evidence unclear."</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Guidelines say steroids are optional. No strong recommendation.</div>
<div class="path-outcome">OUTCOME: Clinicians left without clear guidance</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">PATH B: Investigate Heterogeneity</div>
<div class="path-choice">Analyze why APROCCHSS differed (fludrocortisone, longer duration, different population)</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">効果的なプロトコルと効果のないプロトコルが異なることを確認します。</div>
<div class="path-outcome">OUTCOME: Recommend the specific effective protocol</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    矛盾するトライアルは失敗ではありません。それらは、治療が効果のある場所と効果のない場所を示す地図です。試験間の違い（用量、期間、共同介入、集団）が理解の鍵となります。
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Module 12 Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q12-1">
<h4>1.ペアワイズと比較したネットワーク メタ分析の主な利点は何ですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 0, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>A.</span> データ抽出が必要ありません
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 1, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>B.</span> It compares treatments not directly tested against each other
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 2, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>C.</span> バイアス評価のリスクが不要になります
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-1', 3, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
<span>D.</span> It produces better forest plots
                      </div>
</div>
<div id="q12-1-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q12-2" style="margin-top: 1.5rem;">
<h4>2. Why does DTA meta-analysis require bivariate models?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 0, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>A.</span> To handle more than two studies
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 1, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>B.</span> 出版バイアスを調整するため
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 2, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>C.</span> 感度と特異度は次のとおりです。相関
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-2', 3, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
<span>D.</span> To generate forest plots
                      </div>
</div>
<div id="q12-2-feedback" style="display: none;"></div>
</div>
<div class="quiz-question" id="q12-3" style="margin-top: 1.5rem;">
<h4>3. What does the "consistency" assumption in NMA require?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 0, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>A.</span> All studies must be high quality
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 1, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>B.</span> 直接証拠と間接証拠が一致する必要があります
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 2, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>C.</span> Sample sizes must be similar
                      </div>
<div class="quiz-option" onclick="checkQuizAnswer('q12-3', 3, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
<span>D.</span> No missing studies
                      </div>
</div>
<div id="q12-3-feedback" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="11" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">コースエコシステム</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  このコースでは、系統的レビューワークフロー全体をカバーします。さらに詳しく知りたい場合は、関連コースをご覧ください:
                </p>
<div class="animate delay-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; max-width: 700px; font-size: 0.85rem;">
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>DTA Course</strong><br/>Bivariate/HSROC, SROC curves, QUADAS-2</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>Risk of Bias Mastery</strong><br/>RoB 2, ROBINS-I/E, domain-level assessment</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>GRADE Certainty</strong><br/>Full SoF tables, GRADE-CERQual</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>IPD Meta-Analysis</strong><br/>One-stage/two-stage, mixed-effects models</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>Publication Bias Detective</strong><br/>Copas, PET-PEESE, p-curve, selection models</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>Umbrella Reviews</strong><br/>AMSTAR 2, ROBIS, overlap correction</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>Prognostic Reviews</strong><br/>CHARMS, PROBAST, c-statistic pooling</div>
<div class="card" style="padding: 0.5rem 0.75rem;"><strong>Living Reviews + Rapid Reviews</strong><br/>TSA, update triggers, abbreviated methods</div>
</div>
</div>
</div>
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 12 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「メソッドは質問に一致する必要があります。高度なメソッドは高度な質問に答えます。しかし、基本は決して変わりません。」
                </p>
<p class="animate delay-3" style="font-size: 1rem; margin-top: 1.5rem; opacity: 0.8;">
                  これで、コア ワークフローはマスターされました。次の 10 個のモジュールでは、ベイジアン推論、ネットワーク メタ分析、個々の患者データ、用量反応モデリング、堅牢性と脆弱性、公平性、AI 支援合成、定性的証拠、多変量手法、再現性などの最前線を探ります。
                </p>
</div>
</div>
<div class="slide black" data-index="12">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 13: ベイジアンターン</p>
</div>
</div>
 ============================================================ モジュール 13: ベイジアン ターン (STAMPEDE プラットフォーム トライアル) ============================================================= 
<div class="module-slides" data-module="13">
<div class="slide dark active" data-index="0">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 13: ベイジアンターン</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 13: ベイジアンターン</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>頻度主義推論とベイズ推論の違いを説明します</li>
<li>Interpret prior distributions, likelihoods, and posterior distributions</li>
<li>Distinguish credible intervals from confidence intervals</li>
<li>Understand when Bayesian meta-analysis offers advantages</li>
<li>Recognize how prior choice affects conclusions</li>
</ul>
</div>
</div>
</div>
 ストーリーオープナー: STAMPEDE 
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">In 2005, a trial began</p>
<p class="title gold animate delay-1 text-center">that would never truly end.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                前立腺がんに対する STAMPEDE 試験では、マルチアーム、マルチステージ (MAMS) プラットフォーム設計が使用されました。証拠が蓄積されるにつれて、武器が追加または削除される可能性があります。その統計は頻度主義的でしたが、適応哲学は、データが蓄積されるにつれて決定を更新するというベイズの精神を具体化しました。
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">頻度主義の世界観</h2>
<div class="card animate delay-1">
<p class="card-text">
                    In frequentist statistics, probability means <strong>long-run frequency</strong>。 95% CI は、「95% の確率で真の効果が現れる」ことを意味するものではありません。つまり、研究を無限に繰り返した場合、区間の 95% に真実が含まれることになります。
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">p-value</div>
<div class="stat-label">P(H₀ | data) ではなく、P(data | H₀)</div>
</div>
<div class="stat-box">
<div class="stat-value">95% CI</div>
<div class="stat-label">信念ではなくカバレッジのプロパティ</div>
</div>
<div class="stat-box">
<div class="stat-value">Fixed</div>
<div class="stat-label">真のパラメータは固定</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">ベイズ世界観</h2>
<div class="card animate delay-1">
<p class="card-text">
                    In Bayesian statistics, probability represents <strong>degree of belief</strong>.
                    We start with a <strong>prior</strong> (データの前に信じていること)、
                    <strong>likelihood</strong> (データが教えてくれること)で更新し、 <strong>posterior</strong> (updated belief).
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Prior × Likelihood = Posterior</h4>
<p>ベイズを取得します。定理: P(θ|data) ∝ P(data|θ) × P(θ)</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Credible Intervals</h4>
<p>95% の信頼区間は、指定されたモデル以前の条件で確率的に解釈可能です。</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="5" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Choosing Priors</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Non-informative (Vague)</h4>
<p>Normal(0, 10000) または均一。データを優位にしましょう。頻度主義の結果を模倣します。</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Weakly Informative</h4>
<p>Normal(0, 1) for log-OR. Regularizes extreme estimates while remaining flexible.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Informative</h4>
<p>Based on previous evidence. Powerful but controversial. Must be pre-specified.</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content">
<h4>Half-Cauchy for τ</h4>
<p>Recommended for heterogeneity. Half-Cauchy(0, 0.5) allows large τ but concentrates near zero.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">MCMC Sampling</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Most Bayesian models cannot be solved analytically. We use
                    <strong>Markov Chain Monte Carlo</strong> (MCMC) で事後分布からサンプルを抽出します。ツール: JAGS、Stan、brms (R)、PyMC (Python)。
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">Chains</div>
<div class="stat-label">Multiple independent chains (typically 4)</div>
</div>
<div class="stat-box">
<div class="stat-value">R̂</div>
<div class="stat-label">Convergence: R̂ &lt; 1.01 (strict; older texts use &lt; 1.1)</div>
</div>
<div class="stat-box">
<div class="stat-value">ESS</div>
<div class="stat-label">Bulk-ESS &gt; 400 (平均)。 CI の tail-ESS &gt; 400</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="7" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Bayesian Model Averaging</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Instead of choosing between fixed-effect and random-effects models,
                    <strong>Bayesian model averaging</strong> (BMA) は、事後確率によって各モデルに重み付けを行います。これは、最終推定値におけるモデルの不確実性を説明します。
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">BF</div>
<div class="lesson-content">
<h4>Bayes Factors</h4>
<p>BF₁₀ &gt; 10 = H₁ の強力な証拠。 BF₁₀ &lt; 1/10 = H₀ の強力な証拠。</p>
</div>
</div>
</div>
</div>
 対話型ツールのプレースホルダー 
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Interactive: Posterior Visualizer</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  前の強度を調整して、事後強度にどのような影響を与えるかを確認します。より多くのデータが以前のデータをどのように圧倒するかをご覧ください。
                </p>
<div class="animate delay-2" id="bayesianPosteriorTool" style="min-height: 300px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
<div style="margin-bottom: 1rem;">
<label style="font-weight:600;">Prior Strength: <span id="priorStrengthLabel">Vague</span></label><br/>
<input id="priorStrengthSlider" max="100" min="0" oninput="updateBayesianPosterior()" style="width:100%;" type="range" value="10"/>
</div>
<div style="margin-bottom: 1rem;">
<label style="font-weight:600;">Prior Mean (log-OR): <span id="priorMeanLabel">0.00</span></label><br/>
<input id="priorMeanSlider" max="200" min="-200" oninput="updateBayesianPosterior()" style="width:100%;" type="range" value="0"/>
</div>
<div id="bayesianPlotArea" style="width:100%; min-height:220px;"></div>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="9">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">STAMPEDE ストーリー</h3>
<p style="margin-bottom: 0.75rem;">
                    STAMPEDE は、進行性前立腺がんの治療法を比較する 5 つの研究部門とともに 2005 年に発足しました。 2016 年までにアビラテロンを追加し、死亡が 37% 減少したことが示されました (HR 0.63、95% CI 0.52 ～ 0.76)。
                  </p>
<p style="margin-bottom: 0.75rem;">
                    プラットフォームの設計はベイズ適応的思考を体現しています。中間分析がアームの選択をガイドし、治療法が出現すると新しいアームが導入され、無駄なアームは早期に廃棄され、患者を効果のない状態から救います。
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    STAMPEDE は 100 以上の施設で 10,000 人以上の患者を登録し、前立腺がん治療を根本的に変えました。ベイジアンの考え方により、証拠が蓄積され、リアルタイムで決定を知らせることができます。
                  </p>
</div>
</div>
</div>
<!-- Decision tree -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Decision Tree: When to Go Bayesian?</h2>
<div class="decision-tree animate delay-1">
<div class="decision-tree-header">Frequentist vs Bayesian Meta-Analysis</div>
<div class="decision-scenario">
                    次の場合にはベイジアンを選択してください: (1) 本物の事前情報がある、(2) 確率的ステートメントが必要 (「80% の確率効果 &gt; 0」)、(3) 頻度主義の特性が信頼できないとしている研究がほとんどない、または (4) モデルの平均化を実行したい。
                  </div>
<div class="decision-options">
<div class="decision-option correct">
<div class="decision-label">Bayesian with weakly informative prior</div>
<div class="decision-detail">A common practical default. Regularizes extreme estimates without forcing strong prior conclusions.</div>
</div>
<div class="decision-option">
<div class="decision-label">ベイジアン事前情報</div>
<div class="decision-detail">事前の証拠が強力で、事前に指定されている場合のみ。感度分析を行う必要があります。</div>
</div>
<div class="decision-option">
<div class="decision-label">Stay frequentist</div>
<div class="decision-detail">Simpler, well-understood. Preferred when k is large and no prior information.</div>
</div>
</div>
</div>
</div>
</div>
<!-- Callback -->
<div class="slide dark" data-index="11">
<div class="content" style="text-align: center;">
<p class="animate" style="font-size: 1.1rem; opacity: 0.7;">Remember Module 1?</p>
<p class="title gold animate delay-1">CAST Through a Bayesian Lens</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="max-width: 600px; font-size: 1.05rem;">
                  CAST のベイジアン分析で基礎科学からの有益な事前分布 (抗不整脈薬は PVC を抑制する) を使用していたら、事後分析は依然として有害な方向に強くシフトしていただろう。十分なデータがあれば、強力な事前分布であっても可能性が高まります。教訓: ベイジアン手法は不正な事前分布から保護するものではありません。しかし、ベイジアン手法では次のような仮定が立てられます <em>transparent</em>.
                </p>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Module 13 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> What does a 95% Bayesian credible interval mean?</p>
<div class="quiz-options" id="m13-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 0, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
<span>A.</span> 95% of repeated experiments would produce intervals containing the true value
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 1, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
<span>B.</span> 真のパラメータがこの範囲内にある確率は 95% です
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 2, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
<span>C.</span> The interval has a 95% chance of being correct
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 3, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
<span>D.</span> 将来のデータの 95% はこの範囲に収まります
                    </div>
</div>
<div id="m13-q1-feedback" style="display: none;"></div>
</div>
<div class="quiz-box animate delay-2">
<p class="quiz-question"><strong>Q2.</strong> 研究間の不均一性に対して推奨される事前分布は何ですか(τ)?</p>
<div class="quiz-options" id="m13-q2">
<div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 0, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
<span>A.</span> Uniform(0, 100)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 1, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
<span>B.</span> Normal(0, 1)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 2, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
<span>C.</span> Half-Cauchy(0, 0.5)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 3, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
<span>D.</span> Fixed at 0.5
                    </div>
</div>
<div id="m13-q2-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing ceremony -->
<div class="slide dark" data-index="13">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 13 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「ベイジアンターンは数学に関するものではありません。それは誠実さに関するものです。つまり、仮定を可視化することです。」
                </p>
</div>
</div>
<!-- Transition -->
<div class="slide black" data-index="14">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 14:ネットワーク</p>
</div>
</div>
 ============================================================ モジュール 14: ネットワーク (Cipriani 2018 — 21 種類の抗うつ薬) ============================================================ 
<div class="module-slides" data-module="14">
<div class="slide dark active" data-index="0">
<p class="refrain animate">メソッドは、私たちの信頼から患者を守ります。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 14:ネットワーク</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 14:ネットワーク</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Explain why pairwise comparisons are insufficient when many treatments exist</li>
<li>Interpret network geometry (nodes, edges, thickness)</li>
<li>うつ病の推移性、一貫性、間接証拠の役割を理解する</li>
<li>Interpret SUCRA rankings and league tables</li>
<li>Recognize when NMA assumptions are violated</li>
</ul>
</div>
</div>
</div>
<!-- Story: Cipriani 2018 -->
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">A clinician faces a patient</p>
<p class="title gold animate delay-1 text-center">。どの薬ですか?</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                一般的に処方される抗うつ薬は 21 種類あります。ほとんどの直接比較試験は 2 つまたは 3 つだけを比較します。 (2018、Lancet) は、522 件の試験と 116,477 人の患者を単一のネットワークに接続しました。
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">ネットワーク メタ分析のロジック</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Direct Evidence</h4>
<p>Trials directly comparing A vs B give the most reliable estimate.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Indirect Evidence</h4>
<p>A 対 C および B 対 C が存在する場合、A 対 B を推論できます。これは「推移的」仮定です。</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Mixed Evidence</h4>
<p>NMA combines both, weighted by precision, to rank all treatments simultaneously.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Interactive: Network Graph</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  それぞれノードは治療です。エッジの厚さは、これら 2 つの処理を比較する研究の数を表します。
                </p>
<div class="animate delay-2" id="nmaNetworkTool" style="min-height: 350px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
<div id="nmaNetworkArea" style="width:100%; min-height:320px;"></div>
</div>
</div>
</div>
<div class="slide light" data-index="5" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Transitivity &amp; Consistency</h2>
<div class="card animate delay-1">
<p class="card-text">
<strong>Transitivity</strong>: 間接推定値 (共通のコンパレータによる) は直接推定値に近似する必要があります。これには、効果修飾子が比較全体で同様に分散される必要があります。
                  </p>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text">
<strong>Consistency</strong>: 直接証拠と間接証拠を比較する統計的テスト。グローバル (治療設計による相互作用) テストとローカル (ノード分割) テストは、不一致ループの特定に役立ちます。
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">SUCRA &amp; P-scores</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">SUCRA</div>
<div class="stat-label">累計ランキング中のサーフェス。値が大きいほど、順位付けの確率が高いことを示しますが、優位性が保証されるわけではありません。</div>
</div>
<div class="stat-box">
<div class="stat-value">P-score</div>
<div class="stat-label">頻度主義者は、確率の要約をランク付けすることに似ています。効果の大きさと不確実性を考慮して解釈します。</div>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text">
<strong>Caution:</strong> Ranking is seductive but misleading when differences between treatments are small
                    or uncertain. Always report credible/confidence intervals alongside ranks.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="7" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Component NMA</h2>
<div class="card animate delay-1">
<p class="card-text">
                    When interventions are complex (e.g., behavioral + pharmacological), <strong>component NMA</strong>
                    decomposes multi-component treatments to estimate the individual contribution of each component.
                    Uses additive models: effect(A+B) = effect(A) + effect(B) + interaction.
                  </p>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Cipriani Network</h3>
<p style="margin-bottom: 0.75rem;">
                    2018 年の Lancet 分析では、21 種類の抗うつ薬すべてがプラセボより効果的であることがわかりました。アミトリプチリン、ミルタザピン、ベンラファクシンが有効性で最高位にランクされました。アゴメラチン、フルオキセチン、エスシタロプラムは、受容性の点で最高ランクにランクされました (ドロップアウトが最も少ない)。
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    すべての結果で「勝った」単一の薬剤はありません。ネットワークは、ペアワイズ分析では見えないトレードオフを明らかにしました。
                  </p>
</div>
</div>
</div>
<!-- Decision tree -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Decision Tree: Is NMA Appropriate?</h2>
<div class="decision-tree animate delay-1">
<div class="decision-tree-header">NMA Feasibility Check</div>
<div class="decision-scenario">
                    6 つの異なるスタチンを比較する 15 の RCT があります。直接的な証拠があるペアもあれば、ないペアもあります。
                  </div>
<div class="decision-options">
<div class="decision-option correct">
<div class="decision-label">Check transitivity, then fit NMA</div>
<div class="decision-detail">患者集団と研究デザインが比較全体で十分に類似していることを確認します。</div>
</div>
<div class="decision-option">
<div class="decision-label">間接的な証拠を無視します。</div>
<div class="decision-detail">統計的検出力が失われ、証拠ベースにギャップが残ります。</div>
</div>
<div class="decision-option">
<div class="decision-label">Pool all into one pairwise comparison</div>
<div class="decision-detail">証拠の構造に違反します。スタチンは異なる薬剤です。</div>
</div>
</div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Module 14 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> NMA で間接証拠が有効であるためにはどのような仮定が必要ですか?</p>
<div class="quiz-options" id="m14-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 0, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I², not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
<span>A.</span> Transitivity — effect modifiers are balanced across comparisons
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 1, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I², not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
<span>B.</span> Homogeneity — I² must be below 25%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 2, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I², not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
<span>C.</span> All studies must have similar sample sizes
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 3, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I², not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
<span>D.</span> すべての研究は二重盲検である必要があります
                    </div>
</div>
<div id="m14-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="11">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 14 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「ネットワークは、ペアごとの比較ではできないもの、つまり治療選択の全体像を確認します。」
                </p>
</div>
</div>
<div class="slide black" data-index="12">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール15: 個人</p>
</div>
</div>
 ============================================================ モジュール 15: 個人 (EBCTCG — IPD メタ分析) =========================================================== 
<div class="module-slides" data-module="15">
<div class="slide dark active" data-index="0">
<p class="refrain animate">What was hidden in plain sight?</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール15: 個人</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール15: 個人</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Explain why aggregate data can mask treatment–covariate interactions</li>
<li>Distinguish one-stage from two-stage IPD models</li>
<li>Recognize ecological bias in aggregate meta-analysis</li>
<li>Understand the practical challenges of IPD collection</li>
<li>Interpret treatment–covariate interaction plots</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">For decades, breast cancer trials</p>
<p class="title gold animate delay-1 text-center">概要を公開。患者ではありません。</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                早期乳がん臨床試験担当者共同グループ (EBCTCG) は、数百件の臨床試験にわたって 100,000 人を超える女性から個人の記録を収集しました。彼らのIPDメタ分析は、タモキシフェンの利点がエストロゲン受容体の状態、つまり集計データでは目に見えないものに大きく依存していることを示しました。
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">概要が隠していたこと</h2>
<p class="direct-address animate delay-1">公開されているタモキシフェンのすべての試験で全体的な結果が報告されています。何百もの研究によると、タモキシフェンには適度な効果があるようです。しかし、「適度な利益」は、重大な真実を隠した平均値でした。</p>
<div class="investigation-box animate delay-2">
<h4>隠れたサブグループの分割</h4>
<div class="stats-grid" style="margin-top: 1rem;">
<div class="stat-box" style="border-left: 4px solid #22c55e;">
<div class="stat-value" style="color: #22c55e;">RR 0.59</div>
<div class="stat-label">ER-positive subgroup: 41% reduction in recurrence</div>
</div>
<div class="stat-box" style="border-left: 4px solid #ef4444;">
<div class="stat-value" style="color: #ef4444;">RR 0.97</div>
<div class="stat-label">ER-negative subgroup: essentially no benefit at all</div>
</div>
</div>
<p style="margin-top: 1rem; font-style: italic;">全体的な統合効果、つまり反応する患者と反応しない患者の混合は、統計上のフィクションでした。一方のグループの利益を誇張し、他方のグループでは利益が存在しない場合の暗黙の利益を示す「控えめな」平均。</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">集計対個別の患者データ</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">AD</div>
<div class="stat-label">Aggregate: published effect + CI only</div>
</div>
<div class="stat-box">
<div class="stat-value">IPD</div>
<div class="stat-label">Individual: raw patient-level records</div>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text">
                    IPD により、(1) 一貫した結果の定義、(2) 患者特性によるサブグループ分析、(3) イベント発生までの時間モデリング、(4) 生態学的バイアスのチェックが可能になります。それは、 <strong>gold standard</strong>
                    for exploring treatment effect modification.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="5" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">One-Stage vs Two-Stage IPD</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Two-Stage</h4>
<p>Analyze each study separately, then combine estimates (like standard MA). Simple but loses information.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>One-Stage</h4>
<p>単一の混合効果モデルをすべての患者データに同時に適合させることです。インタラクションやまれなイベントに対してはより強力です。</p>
</div>
</div>
<div class="card animate delay-3" style="margin-top: 1rem;">
<p class="card-text">
<strong>Key:</strong> どちらも研究のクラスタリングを考慮する必要があります。決して 1 つの大規模試験からのものであるかのように IPD をプールしないでください。これにより交絡が生じます (シンプソンのパラドックス)。
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="6" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Ecological Bias</h2>
<div class="card animate delay-1">
<p class="card-text">
                    A meta-regression using study-level mean age might show older patients benefit more.
                    But this could be <strong>ecological bias</strong>-研究レベルの関連性は患者レベルの真実を反映しません。 IPD だけが分離できる <em>within-study</em> from <em>between-study</em> effects.
                  </p>
</div>
</div>
</div>
<div class="slide dark" data-index="7">
<div class="content" style="max-width: 700px;">
<h2 class="title cream animate text-center">全体が部分に嘘をつくとき</h2>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2" style="font-size: 1.05rem; text-align: center; max-width: 650px; margin-top: 1rem;">
                  シンプソンのパラドックス: データが交絡変数によってグループ化されると、集計データに現れる傾向が逆転します。
                </p>
<div class="investigation-box animate delay-3" style="margin-top: 1.5rem;">
<h4>実際のパラドックス</h4>
<p style="margin-top: 0.75rem;">A mega-trial analysis found Treatment X beneficial <em>overall</em>. But <strong>それぞれのパラドックス研究</strong>、それは有害でした。どうやって？研究間のベースラインリスクの違いが幻想を生み出しました。つまり、より病気の集団がたまたまより多くの治療を受け、総利益が増大したのです。</p>
<p style="margin-top: 0.75rem;">Cates (2002, <em>BMJ</em>)、クラスタリングを考慮せずに研究全体をプールすると、効果の見かけの方向が逆転する可能性があることが示されました。</p>
<p style="margin-top: 0.75rem; font-weight: 600; color: var(--gold);">これが、IPD 1 段階モデルに研究をクラスタリング変数として含める理由であり、研究間の交絡が治療を装うことを防ぐためです。効果。</p>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">EBCTCG レガシー</h3>
<p style="margin-bottom: 0.75rem;">
                    EBCTCG の IPD メタ分析は、40 年間にわたって乳がん治療を定義してきました。彼らの 2005 年のタモキシフェンと無治療の分析では、ER 陽性腫瘍では明らかな利点が示されました (RR 0.59) が、ER 陰性腫瘍では利点がありませんでした (RR 0.97)。
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    IPD がなければ、全体的な効果は両方のグループにわたってプールされ、利点が薄まり、ER 陽性患者の効果の大きさが否定される可能性があります。ゲイン。
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Decision Tree: When Is IPD Worth Pursuing?</h2>
<div class="decision-tree animate delay-1">
<div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    Do you suspect treatment–covariate interactions?
                  </div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
<div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
<strong>Yes →</strong>
<p style="margin-top: 0.5rem; font-size: 0.95rem;">試験の 80% 以上から IPD を取得できますか?</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.75rem;">
<div style="background: rgba(34,197,94,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: #22c55e;">Yes →</strong> One-stage IPD meta-analysis with interaction terms
                        </div>
<div style="background: rgba(212,175,55,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: var(--gold);">No →</strong> 2 段階: 利用可能な IPD をリクエストし、残りの集計を行います
                        </div>
</div>
</div>
<div style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
<strong>No →</strong>
<p style="margin-top: 0.5rem; font-size: 0.95rem;">Is ecological bias a concern?</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.75rem;">
<div style="background: rgba(212,175,55,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: var(--gold);">Yes →</strong> IPD preferred even without interactions
                        </div>
<div style="background: rgba(239,68,68,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: #ef4444;">No →</strong> Aggregate data meta-analysis may suffice
                        </div>
</div>
</div>
</div>
<p class="footnote animate delay-2" style="margin-top: 1rem; font-size: 0.85rem; font-style: italic;">EBCTCG は、40 年間にわたる数百の試験からデータを収集しました。ほとんどの IPD メタ分析には 5 ～ 20 件の試験が含まれます。決定は野心ではなく質問によって決まります。</p>
</div>
</div>
</div>
<div class="slide light" data-index="10" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">パターンの繰り返し</h2>
<p class="direct-address animate delay-1">モジュール 3 を覚えていますか? HRT は観察研究では有益であるように見えましたが、RCT では有害であるように見えました。同じ集計マスキングが発生しました。つまり、全体的な利益がサブグループの害を隠しました。</p>
<div class="card animate delay-2">
<p class="card-text">
                    その後の Women's Health Initiative の IPD 分析では、 <strong>timing mattered</strong>、閉経後 10 年以内に HRT を開始した女性は、それ以降に開始した女性とは異なる結果が得られたことが示されました。 「タイミング仮説」は、公開された集計概要では見えませんでした。
                  </p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; border-left: 4px solid var(--gold);">
<p class="card-text">
<strong>教訓は繰り返します:</strong> 集計データは、重要な治療と共変量の相互作用を曖昧にする可能性があります。乳がんにおける ER の状態であっても、HRT におけるタイミングであっても、個人レベルのデータは要約に隠されているものを明らかにします。
                  </p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 15 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> 集約データのメタ分析に対する IPD の主な利点は何ですか?</p>
<div class="quiz-options" id="m15-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 0, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
<span>A.</span> 常により多くの研究が含まれています
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 1, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
<span>B.</span> コストが安く、より高速
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 2, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
<span>C.</span> It can explore treatment–covariate interactions without ecological bias
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 3, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
<span>D.</span> 変量効果モデルの必要性が排除されます
                    </div>
</div>
<div id="m15-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 15 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「プールされたすべての推定値の背後には、集計では伝えることができない個人のストーリーがあります。」
                </p>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">異質性はノイズではなくメッセージです。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 16:用量</p>
</div>
</div>
 ============================================================ モジュール 16: 用量 (アルコール J カーブ / Stockwell 2016) ============================================================= 
<div class="module-slides" data-module="16">
<div class="slide dark active" data-index="0">
<p class="refrain animate">異質性はノイズではなくメッセージです。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 16:用量</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 16:用量</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Explain why simple pairwise comparisons miss dose–response relationships</li>
<li>Distinguish linear, quadratic, and spline dose–response models</li>
<li>Interpret restricted cubic splines with knots</li>
<li>Identify threshold effects and J/U-shaped curves</li>
<li>Understand model comparison with AIC/BIC</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">数十年にわたり、適度な飲酒</p>
<p class="title gold animate delay-1 text-center">は、</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                「J 字型曲線」は、非飲酒者の心血管死亡率が適度な飲酒者よりも高いことを示しました。しかしストックウェルらは、 (2016) は、J カーブが元飲酒者 (病気のためやめた人) を「断酒者」として誤分類することによって生じた産物であることを実証しました。
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">A Scientific Consensus Built on Sand</h2>
<p class="direct-address animate delay-1">2010 年までに、100 を超える観察研究で J カーブが確認されました。医学の教科書がそう教えてくれました。心臓専門医がそれを引用した。ワイン業界のロビイストは、それを巡る会議に資金を提供した。</p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">100+</div>
<div class="stat-label">J カーブを確認する観察研究</div>
</div>
<div class="stat-box">
<div class="stat-value">15–25%</div>
<div class="stat-label">Lower cardiovascular mortality in moderate drinkers vs abstainers</div>
</div>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; border-left: 4px solid var(--red);">
<p class="card-text">
                    証拠は圧倒的であるように見えた。しかし、比較グループである「禁欲者」が汚染されていたとしたらどうでしょうか?
                  </p>
</div>
</div>
</div>
<div class="slide dark" data-index="4">
<div class="content" style="max-width: 700px;">
<h2 class="title cream animate text-center">病気の禁煙者</h2>
<p class="title gold animate delay-1 text-center" style="font-size: 1.2rem;">A Hidden Confounder</p>
<div class="gold-line animate delay-2"></div>
<div class="investigation-box animate delay-3" style="margin-top: 1.5rem;">
<h4>The Problem</h4>
<p style="margin-top: 0.75rem;">People who stop drinking often do so <strong>because they are already ill</strong>-肝臓病、薬物相互作用、癌の診断など。これらの「元飲酒者」は、ほとんどの研究で「禁酒者」として分類されました。</p>
<p style="margin-top: 0.75rem;"><strong>The Effect:</strong> The reference group (abstainers) appeared <em>less healthy</em>- 禁酒が有害だからではなく、病気の人が禁酒に加わったためです。</p>
</div>
<div class="card animate delay-4" style="margin-top: 1rem; background: rgba(212,175,55,0.15); border-left: 4px solid var(--gold);">
<p class="card-text" style="color: var(--cream);">
                    When Stockwell et al. (2016, <em>J Stud Alcohol Drugs</em>) removed former drinkers and applied appropriate study-quality corrections: <strong>J カーブが消えました</strong>。保護効果は幻想でした。
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Dose–Response Meta-Analysis</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Standard meta-analysis asks: "Does treatment X work?" Dose–response meta-analysis asks:
                    "<strong>At what dose</strong> 治療 X は最も効果的ですか?」 複数の研究にわたる線量レベルと結果の関係をモデル化します。
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">Linear</div>
<div class="stat-label">Simplest: log(RR) = β × dose</div>
</div>
<div class="stat-box">
<div class="stat-value">Spline</div>
<div class="stat-label">Flexible: piecewise polynomials with knots</div>
</div>
<div class="stat-box">
<div class="stat-value">Fractional</div>
<div class="stat-label">Polynomial: dose^p1 + dose^p2</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Restricted Cubic Splines</h2>
<div class="card animate delay-1">
<p class="card-text">
                    RCS place <strong>knots</strong> 事前に指定された線量点で、それらの間の滑らかな多項式を当てはめます。通常、線量分布の分位点で 3 ～ 5 ノットです。境界ノットを超えて線形です。非線形性のテストは比較されます。スプライン モデルと単純な線形モデルを比較します。
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">AIC</div>
<div class="lesson-content">
<h4>Model Comparison</h4>
<p>AIC/BIC は線形フィットとスプライン フィットを比較します。低い = 優れています。また、線形からの逸脱 (スプライン項の p 値) もテストします。</p>
</div>
</div>
</div>
</div>
<!-- Interactive tool -->
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">Interactive: Dose–Response Builder</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  さまざまな仮定でモデルの形状がどのように変化するかを確認します。
                </p>
<div class="animate delay-2" id="doseResponseTool" style="min-height: 300px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
<div style="display:flex; gap:1rem; margin-bottom:1rem; flex-wrap:wrap;">
<button class="btn" id="doseBtn-linear" onclick="setDoseModel('linear')">Linear</button>
<button class="btn" id="doseBtn-quadratic" onclick="setDoseModel('quadratic')">Quadratic</button>
<button class="btn primary" id="doseBtn-spline" onclick="setDoseModel('spline')">Spline (3 knots)</button>
</div>
<div id="doseResponsePlotArea" style="width:100%; min-height:240px;"></div>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">アルコールJ カーブの誤りが暴かれた</h3>
<p style="margin-bottom: 0.75rem;">
                    ストックウェルの2016年の再分析では、元飲酒者が「禁酒者」参照グループから正しく除外されると、適度な飲酒の保護効果が消失することが判明した。 J カーブは病気で禁煙する人のバイアスによって引き起こされました。
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    用量反応メタ分析により、曲線の形状は「ゼロ用量」をどのように定義するかに大きく依存するという真実が明らかになりました。間違った参照カテゴリーにより、幻の利益が生まれました。
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">When Curves Shape Policy</h2>
<p class="direct-address animate delay-1">The phantom J-curve influenced alcohol guidelines worldwide:</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #1a3a5c; color: white;">UK</div>
<div class="lesson-content">
<h4>NHS Guidance (until 2016)</h4>
<p>「適度な飲酒は心臓を守る可能性がある」と公式ガイドラインに登場。ストックウェルの修正後、英国は制限を週あたり 14 単位に修正しました。 <strong>all</strong> 飲酒者（以前は男性21名）。 「安全」と宣言された量はありませんでした。</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #3b4d8c; color: white;">US</div>
<div class="lesson-content">
<h4>Dietary Guidelines Advisory Committee</h4>
<p>J カーブ研究は 2015 年まで引用されていました。2020 年の委員会は、参照グループのバイアスを認めて、男性の制限を 1 日あたり 1 ドリンクに引き下げることを推奨しました。</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #2d6a4f; color: white;">AU</div>
<div class="lesson-content">
<h4>Australian Guidelines</h4>
<p>Safe drinking limits were delayed by industry-funded J-curve research promoting “cardioprotective” moderate intake.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Decision Tree: Is Dose-Response Analysis Appropriate?</h2>
<div class="decision-tree animate delay-1">
<div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    露出レベルが 3 つ以上ありますか (露出か非露出かだけでなく)?
                  </div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
<div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
<strong>Yes →</strong>
<p style="margin-top: 0.5rem; font-size: 0.95rem;">この関係はおそらく非線形でしょうか?</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.75rem;">
<div style="background: rgba(34,197,94,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: #22c55e;">Yes →</strong> Restricted cubic splines (3–5 knots). Compare AIC with linear model.
                        </div>
<div style="background: rgba(212,175,55,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
<strong style="color: var(--gold);">No →</strong> Linear dose-response meta-regression may suffice
                        </div>
</div>
</div>
<div style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
<strong>No →</strong>
<p style="margin-top: 0.5rem; font-size: 0.95rem;">Standard pairwise meta-analysis (no dose-response possible with only two levels)</p>
</div>
</div>
<div style="background: rgba(197,48,48,0.15); padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid var(--red);">
<strong style="color: #f87171;">Warning:</strong> 参照カテゴリがクリーンかどうかを常に確認してください。 J カーブのレッスン: 汚染された参照グループはファントム非線形性を生み出します。
                  </div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 16 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> What makes restricted cubic splines useful in dose–response meta-analysis?</p>
<div class="quiz-options" id="m16-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 0, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
<span>A.</span> They always produce a straight line
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 1, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
<span>B.</span> They flexibly capture non-linear dose–response curves
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 2, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
<span>C.</span> 必要な研究の数が減ります
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 3, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
<span>D.</span> They simplify the model to fewer parameters
                    </div>
</div>
<div id="m16-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 16 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「投与量によって毒が作られます。そして曲線の形状によって、その毒が本物かどうかがわかります。」
                </p>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">証拠の不在は、不在の証拠ではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 17: 脆弱性</p>
</div>
</div>
 ============================================================= モジュール 17: 脆弱性 (オセルタミビル / Jefferson 2014) ====================================================== 
<div class="module-slides" data-module="17">
<div class="slide dark active" data-index="0">
<p class="refrain animate">証拠の不在は、不在の証拠ではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 17: 脆弱性</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 17: 脆弱性</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>脆弱性指数の計算と解釈</li>
<li>GOSH プロットを使用して影響力のある研究とサブセット効果を特定する</li>
<li>Interpret contour-enhanced funnel plots</li>
<li>Copas 選択モデルと PET-PEESE を出版バイアスに適用する</li>
<li>Understand how sensitivity analyses strengthen meta-analytic conclusions</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">Governments stockpiled billions</p>
<p class="title gold animate delay-1 text-center">彼らが見ることができなかった証拠に基づいて。</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                H1N1の後、政府はオセルタミビル（タミフル）の備蓄に数十億ドルを費やした。コクランのチーム (Jefferson et al. 2014) は、未公開データにアクセスするために何年も戦いました。彼らが最終的にそれを実行したとき、合併症を防ぐための証拠は蒸発しました。
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">脆弱性指数</h2>
<div class="card animate delay-1">
<p class="card-text">
                    脆弱性指数では次のことが求められます。 <strong>"How many patients would need to change outcome
                    to flip a statistically significant result to non-significant?"</strong>
                    p &gt; 0.05 になるまで、イベントの数が少ないグループにイベントを繰り返し追加します (非イベントをイベントに変換します)。
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">FI = 1</div>
<div class="stat-label">Extremely fragile. One patient flip changes conclusion.</div>
</div>
<div class="stat-box">
<div class="stat-value">FI &gt; 8</div>
<div class="stat-label">Reasonably robust. Less sensitive to individual outcomes.</div>
</div>
</div>
</div>
</div>
<!-- Interactive tools -->
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Interactive: Fragility Calculator</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Enter a 2×2 table to calculate the fragility index. Watch events shift until significance flips.
                </p>
<div class="animate delay-2" id="fragilityTool" style="min-height: 200px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
<div style="display:grid; grid-template-columns: auto 1fr 1fr; gap:0.5rem; max-width:350px; margin-bottom:1rem;">
<div></div>
<div style="font-weight:600; text-align:center;">Events</div>
<div style="font-weight:600; text-align:center;">Total N</div>
<div style="font-weight:600;">Treatment</div>
<input id="fi-eventsTx" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;" type="number" value="15"/>
<input id="fi-nTx" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;" type="number" value="100"/>
<div style="font-weight:600;">Control</div>
<input id="fi-eventsCtrl" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;" type="number" value="30"/>
<input id="fi-nCtrl" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;" type="number" value="100"/>
</div>
<button class="btn primary" onclick="calculateFragilityIndex()">Calculate Fragility Index</button>
<div id="fragilityResult" style="margin-top:1rem; padding:1rem; background:rgba(212,175,55,0.1); border-radius:6px; display:none;"></div>
</div>
</div>
</div>
<div class="slide light" data-index="5" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">GOSH Plots</h2>
<div class="card animate delay-1">
<p class="card-text">
<strong>研究の不均一性の図による概要</strong> (GOSH) はメタ分析モデルを研究の考えられるすべてのサブセットに適合させます。各ドットは、1 つのサブセットのプール効果と I² をプロットします。クラスターは異なるサブグループを示唆します。外れ値の雲は、ある研究が異質性を推進していることを示唆しています。
                  </p>
</div>
<p class="footnote animate delay-2">k 個の研究には 2 つあります。<sup>k</sup>−1 subsets. For k &gt; 15, random sampling is used.</p>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Contour-Enhanced Funnel Plots</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Standard funnel plots show effect size vs standard error. <strong>Contour-enhanced</strong> バージョンでは、p &lt; 0.01、p &lt; 0.05、および p &lt; 0.10 の陰影領域が追加されます。欠落している研究が重要ではない領域にある場合、出版バイアスが発生している可能性があります。それらが重要な領域にある場合は、他の原因（研究の質など）によって非対称性が説明される可能性があります。
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="7" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Copas Selection &amp; PET-PEESE</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Copas Selection Model</h4>
<p>研究が発表される確率を、SE と効果の大きさの関数としてモデル化します。真の効果と選択メカニズムを共同で推定します。</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>PET-PEESE</h4>
<p>Precision-Effect Test (PET): regress effects on SE. If intercept = 0, no true effect. PEESE uses SE² for better performance when a true effect exists.</p>
</div>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">オセルタミビルの物語</h3>
<p style="margin-bottom: 0.75rem;">
                    ロシュが資金提供した最初のメタ分析 (Kaiser 2003) では、オセルタミビルがインフルエンザ合併症を 67% 減少させることが示されました。しかし、10件の試験のうち8件は公表されていなかった。コクランが臨床研究報告書を入手した後、合併症に対する利益は有意ではない 11% に減少しました。
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    脆弱性は単なる統計的なものではなく、情報的なものでした。証拠ベース自体にはほとんどのデータが欠けていました。
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">デシジョン ツリー: 脆弱性の結果を解釈する</h2>
<div class="decision-tree animate delay-1">
<div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    脆弱性指数を計算しました。数字は何を意味しますか?
                  </div>
<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.75rem;">
<div style="background: rgba(239,68,68,0.15); padding: 1rem; border-radius: 8px; border-top: 4px solid #ef4444;">
<strong style="color: #f87171; font-size: 1.1rem;">FI ≤ 3</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;"><strong>Highly fragile.</strong> いくつかの異なる出来事があれば、結論は覆されるでしょう。解釈には細心の注意を払ってください。</p>
</div>
<div style="background: rgba(212,175,55,0.15); padding: 1rem; border-radius: 8px; border-top: 4px solid var(--gold);">
<strong style="color: var(--gold); font-size: 1.1rem;">FI 4–8</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;"><strong>Moderately fragile.</strong> 小さな変動に敏感です。これを変える可能性のある未発表の試験はありますか?</p>
</div>
<div style="background: rgba(34,197,94,0.15); padding: 1rem; border-radius: 8px; border-top: 4px solid #22c55e;">
<strong style="color: #22c55e; font-size: 1.1rem;">FI &gt; 8</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;"><strong>Relatively robust.</strong> But remember: fragility is only one dimension. Publication bias can undermine even robust results.</p>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem; background: rgba(0,0,0,0.05);">
<p class="card-text" style="font-size: 0.9rem;">
                      Walsh et al. (2014, <em>J Clin Epidemiol</em>) は、トップジャーナルに掲載された 399 件の RCT において、脆弱性指数の中央値はわずか 8 であることを発見しました。25% 以上が FI ≤ 3 でした。臨床実践に影響を与える画期的な試験は、多くの場合、統計上の糸口に引っかかっていました。
                    </p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="10" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Beyond the Index: Structural Fragility</h2>
<p class="direct-address animate delay-1">オセルタミビルの物語は明らかにしました <strong>three types of fragility</strong>。そして脆弱性指数は、まず。</p>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #ef4444;">1</div>
<div class="lesson-content">
<h4>Statistical Fragility (FI)</h4>
<p>p 値を反転させるイベントはいくつありますか?これは脆弱性指数で測定されるものです。個々の患者の転帰に対する感度を定量化します。</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: var(--gold); color: var(--navy);">2</div>
<div class="lesson-content">
<h4>Informational Fragility</h4>
<p>どの程度の証拠が隠されていますか?ロシュのオセルタミビル試験10件のうち8件は未公表だった。証拠ベースは構造的に不完全でした。</p>
</div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number" style="background: #3b82f6;">3</div>
<div class="lesson-content">
<h4>Analytical Fragility</h4>
<p>研究者の自由度がどれだけあれば結論を変えることができますか?異なる結果定義、分析母集団、または統計手法。</p>
</div>
</div>
<div class="card animate delay-5" style="margin-top: 1rem; border-left: 4px solid var(--gold);">
<p class="card-text">
<strong>モジュール 10 (パロキセチン) へのコールバック:</strong> 異なる結果定義を使用した再分析により、結論が完全に逆転しました。それは分析の脆弱性でした。エンドポイント自体に異議があったため、FI は決して計算されませんでした。完全な堅牢性評価では、3 つの側面すべてが検査されます。
                  </p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 17 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> 試験では、アームあたり 200 人の患者、治療で 12 のイベント、対照で 25 のイベントが行われます (p=0.03)。脆弱性指数は 3 です。これは何を意味しますか?</p>
<div class="quiz-options" id="m17-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 0, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
<span>A.</span> 効果量は正確に 3
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 1, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
<span>B.</span> Changing just 3 patient outcomes would flip the result to non-significant
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 2, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
<span>C.</span> 結果は 3 つの確認研究で非常に堅牢です
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 3, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
<span>D.</span> 研究には少なくとも 3 人の患者が必要です
                    </div>
</div>
<div id="m17-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 17 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「それを打ち破るすべての試みで生き残った数が価値のある数字です」 "
                </p>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 18: 資本</p>
</div>
</div>
 ======================================================= モジュール 18: 資本(SPRINT の除外 / PROGRESS-Plus) =========================================================== 
<div class="module-slides" data-module="18">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 18: 資本</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 18: 資本</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Identify how trial exclusion criteria create evidence gaps</li>
<li>PROGRESS-Plus フレームワークを適用して公平性を評価する証拠</li>
<li>Use PRISMA-Equity reporting guidelines</li>
<li>Understand transportability: when trial findings fail in practice</li>
<li>Design equity-sensitive search and synthesis strategies</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">SPRINT proved tight blood pressure control</p>
<p class="title gold animate delay-1 text-center">saves lives. But whose lives?</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                画期的な SPRINT 試験では、糖尿病、脳卒中、心不全の患者は除外されていました。米国の高血圧患者の 75% 以上は資格を持っていません。証拠は強力でしたが、適用範囲は狭かったです。
              </p>
</div>
 スライド A: 欠落した多数派 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">ほとんどの患者を除外した試験</h2>
<div class="card animate delay-1">
<p class="card-text">
                    SPRINT は 9,361 人の患者を登録し、集中的な血圧管理 (目標 &lt;120 mmHg) により心血管イベントが減少することを証明しました。 25% (HR 0.75、95% CI 0.64 ～ 0.89)。しかし、包含基準は別のことを物語っていました。
                  </p>
</div>
<div class="card animate delay-2" style="margin-top: 1rem; background: rgba(197,48,48,0.08); border-left: 3px solid var(--red);">
<p class="card-text"><strong>誰が除外されたか:</strong></p>
<ul style="margin-top: 0.5rem; padding-left: 1.25rem; line-height: 1.8;">
<li><strong>Diabetes</strong> - 高血圧症の米国成人の 35%</li>
<li><strong>Prior stroke</strong> - 高血圧人口の 8%</li>
<li><strong>Symptomatic heart failure</strong> — 6% of hypertensive adults</li>
<li><strong>Expected survival &lt;3 years</strong> - 最も虚弱な人々患者</li>
<li><strong>Nursing home residents</strong> — excluded entirely</li>
<li><strong>GFR &lt;20 mL/min</strong> — advanced kidney disease</li>
</ul>
</div>
<p class="footnote animate delay-3" style="margin-top: 1rem; font-weight: 600;">
                  結果: 高血圧症の米国成人の 75% 以上は資格がありません。証拠は強力でした。しかし、誰のためのものでしょうか?
                </p>
</div>
</div>
 スライド B: 証拠の地理 
<div class="slide dark" data-index="4">
<div class="content" style="max-width: 750px;">
<h2 class="title cream animate" style="text-align: center;">証拠の出所</h2>
<div class="gold-line animate delay-1"></div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;">
<div class="animate delay-2" style="background: rgba(212,175,55,0.1); padding: 1.25rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
<p style="font-size: 2rem; font-weight: 700; color: var(--gold);">78%</p>
<p style="font-size: 0.95rem; margin-top: 0.5rem;">of cardiovascular mega-trial participants came from high-income countries (2000–2020).</p>
</div>
<div class="animate delay-3" style="background: rgba(212,175,55,0.1); padding: 1.25rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
<p style="font-size: 2rem; font-weight: 700; color: var(--gold);">6%</p>
<p style="font-size: 0.95rem; margin-top: 0.5rem;">from sub-Saharan Africa — where cardiovascular disease is rising fastest.</p>
</div>
</div>
<div class="animate delay-4" style="margin-top: 1.5rem; background: rgba(255,255,255,0.05); padding: 1.25rem; border-radius: 8px;">
<p style="font-size: 1rem; line-height: 1.7;">
                    ポリピル試験: 5 件中 4 件は平均 BMI &lt;25 の集団で実施されました。米国の平均BMIは30です。薬物代謝、併存疾患パターン、医療アクセス、遺伝的変異はすべて、集団によって異なります。 <strong>Efficacy in one population does not guarantee
                    effectiveness in another.</strong>
</p>
</div>
<p class="footnote animate delay-4" style="margin-top: 1rem; opacity: 0.7; font-size: 0.85rem;">
                  参考：多国間試験とPROGRESS-Plusギャップ
                </p>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">PROGRESS-Plus Framework</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box"><div class="stat-value">P</div><div class="stat-label">Place of residence</div></div>
<div class="stat-box"><div class="stat-value">R</div><div class="stat-label">Race / ethnicity</div></div>
<div class="stat-box"><div class="stat-value">O</div><div class="stat-label">Occupation</div></div>
<div class="stat-box"><div class="stat-value">G</div><div class="stat-label">Gender / sex</div></div>
<div class="stat-box"><div class="stat-value">R</div><div class="stat-label">Religion</div></div>
<div class="stat-box"><div class="stat-value">E</div><div class="stat-label">Education</div></div>
<div class="stat-box"><div class="stat-value">S</div><div class="stat-label">SES (socioeconomic)</div></div>
<div class="stat-box"><div class="stat-value">S</div><div class="stat-label">Social capital</div></div>
</div>
<p class="footnote animate delay-2"><strong>Plus:</strong> Age, disability, sexual orientation, other vulnerable groups.</p>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">PRISMA-Equity &amp; Transportability</h2>
<div class="card animate delay-1">
<p class="card-text">
<strong>PRISMA-Equity</strong> PRISMAは、レビューで公平性がどのように扱われたかについての報告を要求するよう拡張しました：集団の特徴、不利な点によるサブグループ分析、および十分なサービスを受けられていない人々への適用性の評価
                  </p>
</div>
<div class="card animate delay-2" style="margin-top:1rem;">
<p class="card-text">
<strong>Transportability</strong>: 試験の有効性は現実世界の有効性と同じではありません。対象集団の分布に合わせて試験データの重みを再設定する方法が存在します。
                  </p>
</div>
</div>
</div>
 スライド C: 輸送性に関する質問 
<div class="slide light" data-index="7" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">From Trial to Real World: Transportability</h2>
<div class="card animate delay-1">
<p class="card-text">
<strong>Transportability</strong> = 試験対象集団 X の結果を対象集団 Y に適用できますか?これは哲学的な質問ではなく、形式的な方法があります。
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Inverse Probability of Participation Weighting (IPPW)</h4>
<p>Re-weights trial participants so they resemble the target population on key covariates.</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Generalizability Index</h4>
<p>観察された特性に関して試験サンプルが対象集団とどの程度類似しているかを定量化します。</p>
</div>
</div>
<div class="card animate delay-4" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
<p class="card-text">
<strong>Stuart et al. (2015, <em>Stat Med</em>):</strong> SPRINT の結果を米国の高血圧人口に合わせて再重み付けすると、推定効果は減衰し、HR 0.82 (対治験では 0.75) となりました。治療はまだ効果があります。しかし、人口が変化すると規模も変わります。
                  </p>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">SPRINT と欠落多数</h3>
<p style="margin-bottom: 0.75rem;">
                    SPRINT は、9,361 人の患者を対象とした適切に設計された試験でした。その発見（集中的な血圧管理と標準的な血圧管理のHR 0.75）は、世界中のガイドラインを変えました。しかし、その後の分析では、試験母集団に最も近いサブグループで効果が最も強く、除外されたグループについては不確実であることが示されました。
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    証拠の統合における公平性とは、単に「効果があるか?」と尋ねることを意味します。しかし、「誰に効果があるのか​​?」
                  </p>
</div>
</div>
</div>
<!-- Slide D: Decision Tree -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">ディシジョン ツリー: レビューの公平性評価</h2>
<div class="decision-tree animate delay-1" style="font-size: 0.95rem; line-height: 1.7;">
<div class="card" style="background: var(--navy); color: var(--cream); padding: 1rem; border-radius: 8px;">
<p><strong>ROOT:</strong> レビューの証拠はターゲットに似た母集団から得られていますか?</p>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
<div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--green);">
<p><strong>YES</strong> → Good. But check: Are subgroups (age, sex, ethnicity, SES) reported separately?</p>
<ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
<li><strong>Yes:</strong> Use subgroup effects for population-specific recommendations</li>
<li><strong>No:</strong> Flag as limitation — equity gap in reporting</li>
</ul>
</div>
<div style="background: rgba(197,48,48,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--red);">
<p><strong>NO</strong> → Does PROGRESS-Plus analysis reveal differential effects?</p>
<ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
<li><strong>Yes:</strong> Population-specific recommendations needed. Consider transportability re-weighting.</li>
<li><strong>No:</strong> Cautious generalization with explicit equity statement in discussion</li>
</ul>
</div>
</div>
</div>
</div>
</div>
 スライド E: モジュール 3 へのコールバック 
<div class="slide dark" data-index="10" data-tier="mastery">
<span class="tier-badge mastery" style="position:absolute; top:1.5rem; right:1.5rem;">Methodologist</span>
<div class="content" style="max-width: 700px;">
<h2 class="title cream animate" style="text-align: center;">Callback: The HRT Lesson Revisited</h2>
<div class="gold-line animate delay-1"></div>
<div class="card animate delay-2" style="background: rgba(212,175,55,0.1); border: 1px solid rgba(212,175,55,0.3); margin-top: 1.5rem;">
<p class="card-text" style="color: var(--cream);">
                    モジュール 3 を覚えていますか? HRT の記事は、 <strong>healthy-user bias</strong> 有害な治療法を有益であるかのように見せかけていたことを示しました。 SPRINT は逆の問題を抱えている可能性があります。「健康なボランティア」効果により効果的な治療法が現れる可能性があります <em>more</em> effective than
                    it would be in the real world.
                  </p>
</div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; margin-top: 1.5rem; font-style: italic; opacity: 0.9;">
                  すべてのメタ分析では次のことを問う必要があります。誰が含まれていたのか?誰が除外されましたか?それは重要ですか?
                </p>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 18 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> What does the PROGRESS-Plus framework help reviewers assess?</p>
<div class="quiz-options" id="m18-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 0, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
<span>A.</span> Statistical heterogeneity
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 1, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
<span>B.</span> Equity and applicability across disadvantaged populations
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 2, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
<span>C.</span> 含まれる研究の内部的妥当性
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 3, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
<span>D.</span> 証拠の全体的な確実性
                    </div>
</div>
<div id="m18-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 18 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「弱者を排除する証拠は彼らに役立つと主張することはできません。」
                </p>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 19:マシン</p>
</div>
</div>
 ============================================================ モジュール 19: マシン (コクラン 新型コロナウイルス スクリーニング) ============================================================== 
<div class="module-slides" data-module="19">
<div class="slide dark active" data-index="0">
<p class="refrain animate">出所のない数字は数字ではない。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 19:マシン</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 19:マシン</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Describe how AI/ML is used in systematic review screening</li>
<li>Explain active learning and human-in-the-loop workflows</li>
<li>Assess automation validation: recall, workload savings, and risk</li>
<li>アルゴリズムによるスクリーニングの限界とバイアスを認識する</li>
<li>証拠において責任ある AI 使用のためのフレームワークを適用する合成</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">When COVID-19 hit,</p>
<p class="title gold animate delay-1 text-center">papers arrived faster than humans could read.</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                2021 年までに、300,000 を超える COVID 論文が存在しました。コクランは、機械学習分類子を使用して、迅速なレビューのための研究のトリアージを行いました。95% を超える再現率を維持しながら、スクリーニング作業負荷を最大 70% 削減しました。
              </p>
</div>
<!-- The Flood -->
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">The Flood</h2>
<div class="card animate delay-1">
<p>By April 2020, <strong>4,000 COVID preprints appeared every week</strong>.</p>
<p style="margin-top: 0.5rem;">PubMed indexed <strong>500 new COVID articles per day</strong>.</p>
<p style="margin-top: 0.5rem;">Cochrane's screening queue hit <strong>10,000 unreviewed titles</strong>.</p>
</div>
<div class="investigation-box animate delay-2" style="margin-top: 1rem;">
<div class="investigation-header"><span class="icon">🔍</span> 不可能性の数学</div>
<div class="investigation-content">
<p>A pair of reviewers screens ~200 titles per day.</p>
<p><strong>At 500 new articles/day, they fell further behind with every hour.</strong></p>
<p style="margin-top: 0.5rem; font-style: italic;">生きたレビューは、生きられる前に死にかけていました。</p>
</div>
</div>
</div>
</div>
 最初試み 
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">最初試み</h2>
<p class="direct-address animate delay-1">このアイデアは新しいものではありませんでした。コーエンら。 (2006 年、JAMIA) は、機械学習がスクリーニング作業負荷を 50% 削減でき、再現率の低下は 5% 未満であることを初めて示しました。</p>
<div class="lesson-item animate delay-2">
<div class="lesson-icon">📅</div>
<div class="lesson-text"><strong>2006:</strong> Cohen et al. — SVM classifiers for drug class reviews. Proof of concept.</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-icon">📅</div>
<div class="lesson-text"><strong>2016:</strong> RobotReviewer (Marshall et al., JMLR) — ML for risk of bias assessment. Inter-rater reliability comparable to human reviewers.</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-icon">📅</div>
<div class="lesson-text"><strong>2021:</strong> ASReview (van de Schoot et al., Nature Machine Intelligence) — active learning that simulated 95% workload reduction.</div>
</div>
<p class="animate delay-3" style="margin-top: 1rem; font-style: italic; color: var(--gold);">しかし、シミュレーションは現実ではありません。 COVID は、大規模な最初の真のテストとなります。</p>
</div>
</div>
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">AI in Systematic Reviews</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Screening Prioritization</h4>
<p>Active learning ranks citations by relevance. Reviewers screen the most likely relevant first.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>データ抽出アシスト</h4>
<p>NLP は、PICO 要素、結果、および結果を抽出します。常に人による検証が必要です。</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Risk of Bias Assessment</h4>
<p>ML classifiers predict RoB domains. Experimental—human judgment remains gold standard.</p>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Validating Automation</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">Recall</div>
<div class="stat-label">&gt;95% required. Missing 1 study can change conclusions.</div>
</div>
<div class="stat-box">
<div class="stat-value">WSS@95%</div>
<div class="stat-label">Work Saved over Sampling at 95% recall.</div>
</div>
<div class="stat-box">
<div class="stat-value">Stopping</div>
<div class="stat-label">When to stop screening? Consecutive irrelevant threshold.</div>
</div>
</div>
<div class="card animate delay-2" style="margin-top:1rem;">
<p class="card-text">
<strong>基本的な緊張:</strong> 自動化は時間を節約しますが、新たなエラーの原因が発生します。ツール、バージョン、トレーニング データ、および停止基準を常に報告してください。
                  </p>
</div>
</div>
</div>
 検証の危機 
<div class="slide dark" data-index="7">
<div class="content" style="max-width: 700px;">
<div class="investigation-box animate">
<div class="investigation-header"><span class="icon">🔍</span> 検証のパラドックス</div>
<div class="investigation-content">
<p>マシンが関連するスタディを見逃したかどうかを確認するには、 <strong>you need a human to screen everything</strong>.</p>
<p style="margin-top: 0.5rem;">But if humans screen everything, <strong>なぜマシン?</strong></p>
<p style="margin-top: 1rem;">The solution: <strong>prospective holdout validation</strong>.</p>
<ul style="margin-top: 0.5rem;">
<li>Random 10% sample screened by both human and machine</li>
<li>比較: 人間が見つけたものをマシンは見逃しましたか?</li>
<li>If recall drops below 95%, retrain and expand human screening</li>
</ul>
<p style="margin-top: 1rem; font-style: italic;">信頼しますが、確認してください。機械はその役割を獲得しますが、それを継承するわけではありません。</p>
</div>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Cochrane's COVID Response</h3>
<p style="margin-bottom: 0.75rem;">
                    コクランは、数百万のレコードで訓練された機械学習分類器を使用して、新型コロナウイルス感染症研究登録簿を構築しました。このシステムは、手動スクリーニングを数週間から数日に短縮しながら、99% の感度を達成しました。
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    しかし、このマシンはツールであり、代替品ではありませんでした。含まれているすべての研究は依然として人間の査読者によって検証されています。教訓: AI は査読者を補うものであり、置き換えるものではありません。
                  </p>
</div>
</div>
</div>
 ほとんど発見されなかった研究 
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">ほとんど発見されなかった研究</h2>
<div class="story-box animate delay-1">
<p>2020 年 6 月、RECOVERY 試験でデキサメタゾンの結果が発表されました。<strong>the first treatment proven to reduce COVID mortality</strong> (28-day mortality: 22.9% vs 25.7%, RR 0.83).</p>
<p style="margin-top: 0.5rem;">プレプリントは標準外のタイトルで medRxiv に掲載されました。このようなシナリオはパンデミック中に繰り返し発生しました。既存の用語で訓練された ML 分類子は、なじみのない枠組みを低くランク付けしました。</p>
<p style="margin-top: 0.5rem;">いくつかの実際のレビューでは、フラグが設定されたタイトルをスキャンしている人間の査読者が主要な薬剤名を認識し、分類子が優先順位を下げた研究をエスカレートしました。</p>
<p style="margin-top: 1rem; font-weight: 600; color: var(--gold);">これらの人間がいなかったら、画期的な治療結果が世に出るまでに何週間もかかっていたかもしれません。レビュー。</p>
<p style="margin-top: 0.5rem; font-style: italic;">マシンの読み取りが速くなります。人間はより深く読みます。どちらか一方だけでは十分ではありません。</p>
</div>
</div>
</div>
<!-- Decision Tree: When Should You Use AI? -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Decision Tree: When Should You Use AI?</h2>
<div class="decision-tree animate delay-1">
<div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    あなたのレビューは 5,000 以上のタイトルを審査しますか?
                  </div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
<div class="decision-option" style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
<strong>Yes → Consider AI-assisted screening</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;">Active learning prioritization. Dual-screen random 10% holdout. Stop when 3 consecutive batches yield 0 relevant studies.</p>
<p style="margin-top: 0.5rem; font-size: 0.85rem; font-style: italic;">Report: classifier type, training data, recall on holdout, stopping rule.</p>
</div>
<div class="decision-option" style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
<strong>No → Manual screening is feasible</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;">For &lt;5,000 titles, dual human screening remains gold standard. AI adds complexity without proportionate benefit.</p>
</div>
</div>
<div class="decision-node animate delay-2" style="background: rgba(212,175,55,0.15); padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid var(--gold);">
<strong>これは継続的なレビューですか?</strong>
<p style="margin-top: 0.5rem; font-size: 0.9rem;">If yes → AI is especially valuable. Continuous classifier retraining on new evidence. But: <strong>最終的な包含決定をマシンに行わせないでください。</strong></p>
</div>
</div>
</div>
</div>
 パターンの繰り返し 
<div class="slide light" data-index="11" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">パターンの繰り返し</h2>
<p class="direct-address animate delay-1">モジュール 6 を覚えていますか?ポルダーマンスは、周術期のベータ遮断薬のガイドラインを 10 年間にわたって導いた DECREASE データを捏造しました。</p>
<div class="card animate delay-2">
<p>AI can now detect statistical anomalies automatically:</p>
<ul style="margin-top: 0.5rem;">
<li><strong>GRIM test:</strong> 報告された平均値は整数のサンプル サイズと一致していますか?</li>
<li><strong>SPRITE:</strong> 報告された要約統計量は、もっともらしい個別データから再構成できますか?</li>
<li><strong>Statcheck:</strong> Do reported p-values match the test statistics?</li>
</ul>
<p style="margin-top: 1rem;">これらのツールは異常を発見しましたin <strong>hundreds of published papers</strong>—faster than any human auditor.</p>
<p style="margin-top: 0.5rem; font-style: italic; color: var(--gold);">しかし、マシンはフラグを立てます。人間の裁判官。撤回の決定は依然として人間的なものです。</p>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="12">
<div class="content">
<h2 class="title navy animate">Module 19 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> システマティックレビューにおける AI 支援スクリーニングの最小許容リコールはどれくらいですか?</p>
<div class="quiz-options" id="m19-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 0, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
<span>A.</span> 80%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 1, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
<span>B.</span> 90%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 2, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
<span>C.</span> &gt;95%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 3, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
<span>D.</span> 100%
                    </div>
</div>
<div id="m19-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="13">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 19 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「機械はより速く読み取ります。人間はより深く読み取ります。一緒に、彼らは真実を読み取ります。」
                </p>
</div>
</div>
<div class="slide black" data-index="14">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 20:定性的</p>
</div>
</div>
 ============================================================ モジュール 20: 定性的 (Bohren 2015 — マタニティケア) ============================================================ 
<div class="module-slides" data-module="20">
<div class="slide dark active" data-index="0">
<p class="refrain animate">メソッドは、私たちの信頼から患者を守ります。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 20:定性的</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 20:定性的</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Explain why some questions require qualitative evidence synthesis</li>
<li>Describe meta-ethnography (Noblit &amp; Hare) and thematic synthesis</li>
<li>Apply the CERQual framework to assess confidence in qualitative findings</li>
<li>Understand mixed-methods synthesis approaches</li>
<li>Recognize when qualitative evidence changes practice</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">WHO は質問をした</p>
<p class="title gold animate delay-1 text-center">どの RCT も回答できませんでした。</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                なぜ世界中の女性は出産中に軽蔑や虐待を経験していますか?ボーレンら。 (2015) は、34 か国からの 65 の定性的研究を、虐待の 7 つの領域の枠組みに統合しました。
              </p>
</div>
 スライド A: ランダム化を超えた質問 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">ランダム化を超えた質問</h2>
<div class="card animate delay-1" style="background: rgba(197,48,48,0.06); border-left: 3px solid var(--red);">
<p class="card-text">
                    2014 年、WHO は世界的危機に対処するためのパネルを招集しました。女性たちは身体的虐待、言葉による屈辱を受け、出産時のケアも拒否されていた。これは珍しい出来事ではありませんでした。 <strong>34 countries</strong>.
                  </p>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text">
                    They needed to understand <strong>WHY</strong>. What drives disrespect and abuse in maternity care?
                  </p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
<p class="card-text">
                    からの報告があり、RCT はこれに答えることができませんでした。女性を虐待的なケアと敬意を持ったケアにランダムに割り当てることはできません。助産師の目を盲目にすることはできません。リッカート尺度で「尊厳」を測定することはできません。
                    <strong>証拠は定性的である必要があります。</strong>
</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">Meta-Ethnography</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Developed by Noblit &amp; Hare (1988), meta-ethnography <strong>translates</strong>
                    数値を集計するのではなく、研究全体の概念。一次データ（参加者の引用）と二次データ（著者の解釈）から新しい解釈枠組み（三次構成）を生成します。
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">Reciprocal</div>
<div class="stat-label">研究は相互に確認します</div>
</div>
<div class="stat-box">
<div class="stat-value">Refutational</div>
<div class="stat-label">研究は相互に矛盾します</div>
</div>
<div class="stat-box">
<div class="stat-value">Line of<br/>argument</div>
<div class="stat-label">研究は新しいものを構築します理論</div>
</div>
</div>
</div>
</div>
<!-- Slide B: Bohren's Seven Domains -->
<div class="slide dark" data-index="5">
<div class="content" style="max-width: 750px;">
<h2 class="title cream animate" style="text-align: center;">What Bohren Found: A Taxonomy of Mistreatment</h2>
<div class="gold-line animate delay-1"></div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 1.5rem;">
<div class="animate delay-2" style="background: rgba(197,48,48,0.15); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">1. Physical abuse</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Hitting, pinching, slapping during labor</p>
</div>
<div class="animate delay-2" style="background: rgba(197,48,48,0.15); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">2. Sexual abuse</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Inappropriate touching, non-consensual procedures</p>
</div>
<div class="animate delay-3" style="background: rgba(197,48,48,0.12); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">3. Verbal abuse</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Shouting, threats, judgmental comments</p>
</div>
<div class="animate delay-3" style="background: rgba(197,48,48,0.12); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">4. Stigma &amp; discrimination</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Based on HIV status, ethnicity, age, poverty</p>
</div>
<div class="animate delay-4" style="background: rgba(197,48,48,0.09); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">5. Professional standards failure</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Neglect, lack of informed consent</p>
</div>
<div class="animate delay-4" style="background: rgba(197,48,48,0.09); padding: 0.75rem 1rem; border-radius: 6px;">
<strong style="color: var(--gold);">6. Poor rapport</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Poor communication, dismissiveness</p>
</div>
</div>
<div class="animate delay-4" style="background: rgba(197,48,48,0.06); padding: 0.75rem 1rem; border-radius: 6px; margin-top: 0.75rem; text-align: center;">
<strong style="color: var(--gold);">7. Health system conditions</strong>
<p style="font-size: 0.9rem; margin-top: 0.25rem;">Overcrowding, understaffing, lack of supplies</p>
</div>
<p class="animate delay-4" style="font-size: 1rem; text-align: center; margin-top: 1.25rem; font-style: italic; opacity: 0.9;">
                  65 の研究。 34か国。同じパターンが言語、文化、システムを超えて繰り返されます。これは逸話ではありませんでした。これは合成された証拠です。
                </p>
</div>
</div>
<div class="slide light" data-index="6" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">CERQual: 定性的証拠の信頼性</h2>
<div class="card animate delay-1">
<p class="card-text">
                    CERQual assesses confidence in qualitative review findings across four components:
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">1</div>
<div class="lesson-content"><h4>Methodological Limitations</h4><p>貢献研究の質。</p></div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">2</div>
<div class="lesson-content"><h4>Coherence</h4><p>データが発見をどの程度裏付けているか。</p></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">3</div>
<div class="lesson-content"><h4>Adequacy</h4><p>データの豊富さ (データの数だけではない)</p></div>
</div>
<div class="lesson-item animate delay-4">
<div class="lesson-number">4</div>
<div class="lesson-content"><h4>Relevance</h4><p>レビュー質問のコンテキストへの適用性。</p></div>
</div>
</div>
</div>
 スライド C: 証拠から行動へ 
<div class="slide light" data-index="7">
<div class="content">
<h2 class="title navy animate">When Qualitative Evidence Changes Practice</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Bohren's synthesis informed the WHO's <strong>2018 Recommendations on Intrapartum Care
                    for a Positive Childbirth Experience</strong>. Specific changes grounded in qualitative evidence:
                  </p>
</div>
<div class="stats-grid animate delay-2" style="margin-top: 1rem;">
<div class="stat-box" style="text-align: left; padding: 1rem;">
<div class="stat-value" style="font-size: 1.2rem;">Rec. 15</div>
<div class="stat-label">Companionship during labor</div>
</div>
<div class="stat-box" style="text-align: left; padding: 1rem;">
<div class="stat-value" style="font-size: 1.2rem;">Rec. 1</div>
<div class="stat-label">Respectful maternity care</div>
</div>
<div class="stat-box" style="text-align: left; padding: 1rem;">
<div class="stat-value" style="font-size: 1.2rem;">Rec. 3</div>
<div class="stat-label">Effective communication</div>
</div>
<div class="stat-box" style="text-align: left; padding: 1rem;">
<div class="stat-value" style="font-size: 1.2rem;">Rec. 12</div>
<div class="stat-label">Emotional support</div>
</div>
</div>
<p class="footnote animate delay-3" style="margin-top: 1rem; font-weight: 600;">
                  定性的証拠に基づいたこれらの推奨事項は、現在、WHO 加盟 194 か国の産科ケアの指針となっています。いかなる森林区画もそれらを生み出すことはできませんでした。 I² 統計ではそれらを明らかにすることはできませんでした。
                </p>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="8">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">Bohren's Framework of Mistreatment</h3>
<p style="margin-bottom: 0.75rem;">
                    2015 年の定性的統合では、身体的虐待、性的虐待、言葉による虐待、偏見と差別、職業的基準を満たしていない、不完全な関係、医療制度の状態の 7 つの領域が特定されました。この枠組みは、分娩中ケアに関する WHO 勧告 (2018 年) に影響を与えました。
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    どの p 値も、分娩中に平手打ちされた経験を捉えることはできません。定性的統合は、数字では表現できないものに声を与えました。
                  </p>
</div>
</div>
</div>
<!-- Slide D: Decision Tree -->
<div class="slide light" data-index="9">
<div class="content">
<h2 class="title navy animate">Decision Tree: When Is Qualitative Synthesis Appropriate?</h2>
<div class="decision-tree animate delay-1" style="font-size: 0.95rem; line-height: 1.7;">
<div class="card" style="background: var(--navy); color: var(--cream); padding: 1rem; border-radius: 8px;">
<p><strong>ROOT:</strong> あなたの研究の質問は、経験、認識、障壁、または促進者に関するものですか?</p>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
<div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--green);">
<p><strong>YES</strong> → あなたの質問は、「WHETHER」だけでなく、「HOW」または「WHY」に関するものですか?</p>
<ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
<li><strong>Yes:</strong> Qualitative evidence synthesis (meta-ethnography, thematic synthesis, or framework synthesis)</li>
<li><strong>No:</strong> 混合手法を検討してください: 効果のための定量的 + 定性的な分析メカニズム</li>
</ul>
</div>
<div style="background: rgba(212,175,55,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--gold);">
<p><strong>NO</strong> → ご質問は有効性/有効性に関するものですか?</p>
<ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
<li><strong>Yes:</strong> Quantitative meta-analysis</li>
<li><strong>But:</strong> 実装の障壁の定性的レビューで補完します (CERQual で評価)</li>
</ul>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
<p class="card-text" style="font-style: italic;">
<strong>Key insight:</strong> 最も強力な系統的レビューは両方の答えです: それは機能しますか? (定量的) そして、なぜそれがうまくいくのか、それとも失敗するのか? (定性的)
                    </p>
</div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Module 20 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> What distinguishes meta-ethnography from quantitative meta-analysis?</p>
<div class="quiz-options" id="m20-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 0, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
<span>A.</span> これには 3 ～ 5 件の研究のみが含まれています
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 1, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
<span>B.</span> It translates concepts across studies rather than pooling numbers
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 2, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
<span>C.</span> It does not require a systematic search
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 3, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
<span>D.</span> It is less rigorous than quantitative synthesis
                    </div>
</div>
<div id="m20-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="11">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 20 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「重要なものすべてが重要であるわけではありません。重要なものすべてが重要であるわけではありません。」
                </p>
</div>
</div>
<div class="slide black" data-index="12">
<p class="refrain animate">異質性はノイズではなくメッセージです。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 21:多変量</p>
</div>
</div>
 ============================================================== モジュール 21: 多変量 (相関結果 / RVE) ============================================================ 
<div class="module-slides" data-module="21">
<div class="slide dark active" data-index="0">
<p class="refrain animate">異質性はノイズではなくメッセージです。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 21:多変量</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 21:多変量</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>研究内の結果がいつ相関しているかを認識する</li>
<li>Explain multivariate random-effects models</li>
<li>Apply robust variance estimation (RVE) for dependent effect sizes</li>
<li>ネストされた 3 レベルのモデルを理解するデータ</li>
<li>Choose between multivariate approaches based on data structure</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">Cardiovascular trials report</p>
<p class="title gold animate delay-1 text-center">死亡率、心筋梗塞、脳卒中など。</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                これらの転帰は患者内で相関しています。死亡した患者には MI エンドポイントを設定することはできません。標準的なメタ分析では、依存関係を無視し、証拠を二重にカウントする可能性を無視して、各結果を独立して扱います。
              </p>
</div>
 スライド A: 便利な嘘 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">誰も質問しない仮定</h2>
<div class="card animate delay-1">
<p class="card-text">
                    標準的なメタ分析の教科書を開いてください。モデルは、各研究が
                    <strong>one independent effect size</strong>. But reality is different.
                  </p>
</div>
<div class="card animate delay-2" style="margin-top: 1rem; background: rgba(197,48,48,0.06); border-left: 3px solid var(--red);">
<p class="card-text">
                    単一の心血管試験で死亡率、心筋梗塞、脳卒中、血行再建に寄与していると仮定しています。単一の心理療法研究では、3、6、12 か月後のうつ病、不安、生活の質が報告されています。
                  </p>
</div>
<div class="stats-grid animate delay-3" style="margin-top: 1rem;">
<div class="stat-box">
<div class="stat-value">30 trials</div>
<div class="stat-label">× 4 outcomes</div>
</div>
<div class="stat-box">
<div class="stat-value">= 120</div>
<div class="stat-label">effect sizes</div>
</div>
</div>
<div class="card animate delay-4" style="margin-top: 1rem;">
<p class="card-text">
                    Most analysts either: <strong>(a)</strong> treat all 120 as independent (inflating precision
                    by a factor of √4), or <strong>(b)</strong> 1 つの結果を選択し、残りは破棄します。
                    <strong>どちらのアプローチも間違っています。</strong>
</p>
</div>
</div>
</div>
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">依存関係の問題</h2>
<div class="card animate delay-1">
<p class="card-text">
                    In standard pairwise meta-analysis, each study contributes <em>one</em> effect size.
                    But many studies report multiple outcomes, subgroups, timepoints, or arms—creating
                    <strong>dependent</strong> 効果の大きさ。これを無視すると、精度が増大し、推論が歪められます。
                  </p>
</div>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">RVE</div>
<div class="stat-label">Robust Variance Estimation. Sandwich estimator handles unknown correlation.</div>
</div>
<div class="stat-box">
<div class="stat-value">3-Level</div>
<div class="stat-label">Study → Outcome nesting modeled explicitly.</div>
</div>
</div>
</div>
</div>
<div class="slide light" data-index="5" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Robust Variance Estimation</h2>
<div class="card animate delay-1">
<p class="card-text">
                    RVE (Hedges, Tipton &amp; Johnson, 2010) uses a <strong>sandwich-type</strong> 依存効果間の真の相関関係に関係なく、有効な標準誤差を提供する推定器。研究内の相関関係を知ったり推定したりする必要はありません。 20 件以上のスタディに最適です。
                  </p>
</div>
<div class="card animate delay-2" style="margin-top:1rem;">
<p class="card-text">
<strong>Small-sample correction:</strong> Tipton &amp; Pustejovsky (2015) は、クラスター数が少ない場合にサタースウェイトの自由度を使用して、RVE 用の小サンプル補正 (CR2) を開発しました。
                  </p>
</div>
</div>
</div>
 スライド B: 数学的真実 
<div class="slide dark" data-index="6" data-tier="methods">
<span class="tier-badge methods" style="position:absolute; top:1.5rem; right:1.5rem;">Researcher</span>
<div class="content" style="max-width: 700px;">
<h2 class="title cream animate" style="text-align: center;">What Dependence Does to Your Confidence Intervals</h2>
<div class="gold-line animate delay-1"></div>
<div class="animate delay-2" style="margin-top: 1.5rem; background: rgba(212,175,55,0.1); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
<p style="font-size: 1rem; margin-bottom: 0.75rem;">
                    If 4同じ研究からの結果には研究内相関関係 ρ = 0.5 があります:
                  </p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
<div style="background: rgba(197,48,48,0.2); padding: 1rem; border-radius: 6px; text-align: center;">
<p style="font-size: 0.85rem; opacity: 0.8;">Treating as independent</p>
<p style="font-size: 1.5rem; font-weight: 700; color: var(--red); margin-top: 0.25rem;">CI width = X</p>
</div>
<div style="background: rgba(34,197,94,0.2); padding: 1rem; border-radius: 6px; text-align: center;">
<p style="font-size: 0.85rem; opacity: 0.8;">依存性の説明</p>
<p style="font-size: 1.5rem; font-weight: 700; color: var(--green); margin-top: 0.25rem;">CI width = 1.58X</p>
</div>
</div>
<p style="font-size: 1rem; margin-top: 1rem; text-align: center;">
                    信頼区間は <strong>58% wider</strong>である必要があります。これを無視したすべてのメタ分析では、誤って正確な結果が公表されました。
                  </p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border: 1px solid rgba(212,175,55,0.2);">
<p class="card-text" style="color: var(--cream);">
<strong>RVE</strong> (Hedges, Tipton &amp; Johnson, 2010): Uses a “sandwich”
                    variance estimator that produces correct standard errors <em>without</em> needing to know
                    the exact within-study correlation.
                  </p>
</div>
</div>
</div>
<!-- Slide C: The Three Levels (expanded) -->
<div class="slide light" data-index="7" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Three-Level Models: Making Structure Explicit</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number">1</div>
<div class="lesson-content">
<h4>Level 1: Sampling Variance</h4>
<p>Measurement error within each effect size estimate.</p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">2</div>
<div class="lesson-content">
<h4>Level 2: Within-Study Variance</h4>
<p>結果と時点は、単一の研究内でも異なります。</p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number">3</div>
<div class="lesson-content">
<h4>Level 3: Between-Study Variance</h4>
<p>研究は、母集団、設定、方法が互いに異なります。</p>
</div>
</div>
<div class="card animate delay-4" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
<p class="card-text">
<strong>Example:</strong> うつ病に対する心理療法のメタ分析において (k=50 研究、180 効果)サイズ）、 <strong>35%</strong> の分散は研究内（異なる結果）であり、 <strong>65%</strong> は研究間（異なる治療法、集団）でした。この分解により、効果がネストされている場合 (研究内の複数の結果や研究グループ内の研究など)、不均一性がどの程度であるかが明らかになります <em>within</em> vs <em>between</em> studies.
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="8" data-tier="mastery">
<span class="tier-badge mastery">Methodologist</span>
<div class="content">
<h2 class="title navy animate">Three-Level Models: Formal Framework</h2>
<div class="card animate delay-1">
<p class="card-text">
                    。 <strong>three-level model</strong> 分散を (1) サンプリング分散 (レベル 1)、(2) 研究内分散 (レベル 2)、および (3) 研究間の分散 (レベル 3) に分割します。これにより、レベル間で強度を借用しながら正しい推論が維持されます。
                  </p>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="9">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">心血管チャレンジ</h3>
<p style="margin-bottom: 0.75rem;">
                    スタチンのメタ分析には、死亡率、心筋梗塞、脳卒中、血行再建を報告する 30 件の試験が含まれる可能性があります。つまり、30 クラスターからの 120 の効果サイズになります。これらを 120 の独立した推定値として扱うと、研究内の相関関係に関連する係数によって精度が高まります。
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    RVE or multivariate models handle this correctly—producing wider, honest confidence intervals.
                  </p>
</div>
</div>
</div>
<!-- Slide D: Decision Tree -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Decision Tree: Which Approach for Dependent Effect Sizes?</h2>
<div class="decision-tree animate delay-1" style="font-size: 0.95rem; line-height: 1.7;">
<div class="card" style="background: var(--navy); color: var(--cream); padding: 1rem; border-radius: 8px;">
<p><strong>ROOT:</strong> メタ分析には研究ごとに複数の効果がありますか?</p>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
<div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--green);">
<p><strong>YES</strong> → 研究内の相関関係を知っていますか (または推定できますか)?</p>
<ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
<li><strong>Yes:</strong> Multivariate random-effects model (most efficient)</li>
<li><strong>No:</strong> RVE with small-sample correction (robust to unknown correlations)</li>
</ul>
</div>
<div style="background: rgba(212,175,55,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--gold);">
<p><strong>NO</strong> → Standard univariate random-effects model</p>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text"><strong>Sub-question:</strong> 複数の効果は異なる結果からのものですか、タイムポイント、それともサブグループ?</p>
<ul style="margin-top: 0.5rem; padding-left: 1.25rem; line-height: 1.8; font-size: 0.9rem;">
<li><strong>Different outcomes</strong> → Three-level model or RVE with clustering</li>
<li><strong>Different timepoints</strong> → Network of timepoints with temporal correlation</li>
<li><strong>Different subgroups</strong> → Consider if subgroups are meaningful or should be averaged</li>
</ul>
</div>
</div>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="11">
<div class="content">
<h2 class="title navy animate">Module 21 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> What problem does Robust Variance Estimation (RVE) solve?</p>
<div class="quiz-options" id="m21-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 0, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I² and tau².', 'Small study effects use regression-based methods.'])">
<span>A.</span> Publication bias
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 1, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I² and tau².', 'Small study effects use regression-based methods.'])">
<span>B.</span> 同じ研究からの複数の効果量間の依存性
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 2, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I² and tau².', 'Small study effects use regression-based methods.'])">
<span>C.</span> Between-study heterogeneity
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 3, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I² and tau².', 'Small study effects use regression-based methods.'])">
<span>D.</span> Small-study effects
                    </div>
</div>
<div id="m21-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="12">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 21 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「結果が複雑な場合、それらが独立しているかのように振る舞うことは便宜上の嘘です。」
                </p>
</div>
</div>
<div class="slide black" data-index="13">
<p class="refrain animate">出所のない数字は数字ではない。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 22:証明</p>
</div>
</div>
 ============================================================= モジュール 22: 証明 (Reinhart-Rogoff Excel エラー) ============================================================= 
<div class="module-slides" data-module="22">
<div class="slide dark active" data-index="0">
<p class="refrain animate">出所のない数字は数字ではない。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 22:証明</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 22:証明</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>Understand how computational errors propagate through policy</li>
<li>再現性を定義し、複製可能性と区別する</li>
<li>証拠のハッシュと証明保持を適用する数値</li>
<li>Use reproducibility checklists for meta-analysis</li>
<li>事前登録とオープンデータの役割を認識</li>
</ul>
</div>
</div>
</div>
<div class="slide dark" data-index="2">
<p class="title cream animate text-center">A graduate student opened a spreadsheet</p>
<p class="title gold animate delay-1 text-center">、緊縮財政時代は誤りの上に築かれていたことが判明した。</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                2010年、ラインハルト氏とロゴフ氏は、債務対GDP比が90%を超える国はマイナス成長であると主張した。これはヨーロッパ全土の緊縮政策に影響を与えた。 2013 年、トーマス・ハーンドンは、平均から 5 か国を除外する Excel のエラーを発見しました。修正された結果: 崩壊ではなく、緩やかなプラス成長。
              </p>
</div>
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Reproducibility vs Replicability</h2>
<div class="stats-grid animate delay-1">
<div class="stat-box">
<div class="stat-value">Reproducible</div>
<div class="stat-label">Same data + same code = same result</div>
</div>
<div class="stat-box">
<div class="stat-value">Replicable</div>
<div class="stat-label">新しいデータ + 同じ手法 = 一貫した結果</div>
</div>
</div>
<div class="card animate delay-2" style="margin-top: 1rem;">
<p class="card-text">
                    Reproducibility is the <strong>minimum standard</strong>。他の人が報告されたデータからプールされた推定値を再現できない場合、分析は検証できません。メタ分析では、抽出されたデータ、分析スクリプト、ソフトウェア バージョン、およびランダム シードを共有する必要があります。
                  </p>
</div>
</div>
</div>
<div class="slide light" data-index="4" data-tier="methods">
<span class="tier-badge methods">Researcher</span>
<div class="content">
<h2 class="title navy animate">Proof-Carrying Numbers</h2>
<div class="card animate delay-1">
<p class="card-text">
                    Every number in a meta-analysis should carry its <strong>provenance</strong>: データの出所、変換方法、生成されたコード。
                    <strong>Evidence hashing</strong> creates a cryptographic fingerprint of inputs
                    so any change (accidental or deliberate) is detectable.
                  </p>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number">SHA</div>
<div class="lesson-content">
<h4>Input Hash</h4>
<p>抽出データの SHA-256 ハッシュ。 1 つのセルが変更されると、ハッシュも変更されます。出所チェーン: データ → コード → 結果 → ハッシュ。</p>
</div>
</div>
</div>
</div>
<!-- Interactive tool -->
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">Interactive: Reproducibility Checklist</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  各項目にチェックを入れて、メタ分析の再現性を評価します。レビューのスコアはどのくらいですか?
                </p>
<div class="animate delay-2" id="reproducibilityTool" style="background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
<div id="reproChecklist"></div>
<div id="reproScore" style="margin-top:1rem; padding:0.75rem; background:rgba(212,175,55,0.1); border-radius:6px;"></div>
</div>
</div>
</div>
<!-- Story box -->
<div class="slide dark" data-index="6">
<div class="content" style="max-width: 700px;">
<div class="story-box animate">
<h3 style="color: var(--gold); margin-bottom: 1rem;">経済を変えた Excel のエラー</h3>
<p style="margin-bottom: 0.75rem;">
                    ラインハルト ロゴフの「債務時代の成長」は、議会証言、欧州委員会報告書、IMF 政策概要で引用されました。 Excel のエラー (行 30 ～ 34 が AVERAGE 式から除外されている) は、オーストラリア、オーストリア、ベルギー、カナダ、デンマークの 5 か国が単に欠落していることを意味します。
                  </p>
<p style="font-style: italic; opacity: 0.9;">
                    修正された平均は、-0.1% から +2.2% になりました。緊縮政策は何百万人もの人々に影響を与えました。再現性は学術的な完璧主義ではありません。それは大惨事に対する安全策です。
                  </p>
</div>
</div>
</div>
<!-- Callback -->
<div class="slide dark" data-index="7">
<div class="content" style="text-align: center;">
<p class="animate" style="font-size: 1.1rem; opacity: 0.7;">Remember Module 5?</p>
<p class="title gold animate delay-1">DECREASE Through the Lens of Reproducibility</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="max-width: 600px; font-size: 1.05rem;">
                  ドン・ポルダーマンスによるDECREASE試験は、データが捏造されたとして撤回されました。証拠を運ぶ数字（ハッシュ化された入力、来歴連鎖、検証された計算）が存在していれば、捏造は検出可能だったでしょう <em>before</em> 証拠はメタ分析に入り、手術ガイドラインを変更しました。
                </p>
</div>
</div>
<!-- Quiz -->
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">Module 22 Quiz</h2>
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q1.</strong> ラインハルト・ロゴフの誤りとは何でしたか?</p>
<div class="quiz-options" id="m22-q1">
<div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 0, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
<span>A.</span> They used too small a sample
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 1, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
<span>B.</span> An Excel formula excluded 5 countries, reversing the conclusion
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 2, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
<span>C.</span> They studied the wrong time period
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 3, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
<span>D.</span> They used the wrong statistical test
                    </div>
</div>
<div id="m22-q1-feedback" style="display: none;"></div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide dark" data-index="9">
<div class="content" style="text-align: center;">
<p class="title gold animate">Module 22 Complete</p>
<div class="gold-line animate delay-1"></div>
<p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  「出所のない数字は数字ではありません。再現性のない分析は証拠ではありません。」
                </p>
</div>
</div>
<div class="slide black" data-index="10">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 23: 初めてのメタスプリント</p>
</div>
</div>
 モジュール 23: Capstone - 初めてのメタスプリント 
<div class="module-slides" data-module="23">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 23: 初めてのメタスプリント</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">モジュール 23: 初めてのメタスプリント</h2>
<div class="learning-objectives animate delay-1">
<h4>🎯 Learning Objectives</h4>
<ul>
<li>40 日間のシステマティック レビュー ワークフローを理解する</li>
<li>Map the Seven Principles to real practice phases</li>
<li>Recognize Definition-of-Done (DoD) gates as quality checkpoints</li>
<li>Appreciate why structure prevents the failures you've studied</li>
<li>Graduate ready to conduct (not just understand) meta-analysis</li>
</ul>
</div>
</div>
</div>
 その道のり完了 
<div class="slide dark" data-index="2">
<p class="title cream animate">ストーリーを学びました。</p>
<p class="title gold animate delay-1">今度は道を歩まなければなりません。</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                あなたが調べたすべての証拠の逆転は、チームのおかげで起こりました。 <em>knew</em> メソッドはありましたが、実行されませんでした <em>follow</em> them systematically.
              </p>
</div>
 META-SPRINT フレームワーク 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">META-SPRINT フレームワーク</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  5 つのフェーズ ゲートを備えた 40 日間の構造化ワークフロー。各ゲートは、品質が保証されるまで先に進むことを妨げる Defining-of-Done (DoD) チェックポイントです。
                </p>
<div class="stats-grid animate delay-2">
<div class="stat-box">
<div class="stat-value">40</div>
<div class="stat-label">Days to Completion</div>
</div>
<div class="stat-box">
<div class="stat-value">5</div>
<div class="stat-label">DoD Phase Gates</div>
</div>
<div class="stat-box">
<div class="stat-value">Day 34</div>
<div class="stat-label">Hard Freeze</div>
</div>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; background: rgba(212,175,55,0.1); border: 1px solid var(--gold);">
<p class="card-text" style="font-size: 0.9rem;">
<strong style="color: var(--gold);">Why 40 days?</strong> 厳密さを保つには十分な長さ、スコープのクリープを防ぐのに十分な短さです。ロシグリタゾンの心臓信号は、透明性を強制する期限がなかったため、何年も埋もれていました。
                  </p>
</div>
</div>
</div>
 5 つのゲート 
<div class="slide light" data-index="4">
<div class="content">
<h2 class="title navy animate">5 つのフェーズ ゲート</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #7C3AED;">A</div>
<div class="lesson-content">
<h4>DoD-A: Protocol Lock (Days 1-3)</h4>
<p>PICOS defined, timepoint rules set, model choices pre-specified. <em>No moving target.</em></p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #2563EB;">B</div>
<div class="lesson-content">
<h4>DoD-B: Search Lock (Days 6-10)</h4>
<p>All databases searched, grey literature checked, PRESS validated. <em>No hidden studies.</em></p>
</div>
</div>
<div class="lesson-item animate delay-3">
<div class="lesson-number" style="background: #D97706;">C</div>
<div class="lesson-content">
<h4>DoD-C: Extraction Lock (Days 10-28)</h4>
<p>Dual extraction, provenance linked, RoB assessed. <em>No fabricated numbers.</em></p>
</div>
</div>
</div>
</div>
<!-- Gates continued -->
<div class="slide light" data-index="5">
<div class="content">
<h2 class="title navy animate">The Five Phase Gates (continued)</h2>
<div class="lesson-item animate delay-1">
<div class="lesson-number" style="background: #059669;">D</div>
<div class="lesson-content">
<h4>DoD-D: 分析ロック (21 ～ 33 日目)</h4>
<p>Forest plots generated, sensitivity analyses run, heterogeneity explored. <em>No cherry-picking.</em></p>
</div>
</div>
<div class="lesson-item animate delay-2">
<div class="lesson-number" style="background: #DC2626;">E</div>
<div class="lesson-content">
<h4>DoD-E: Submission Lock (Days 33-40)</h4>
<p>GRADE certainty rated, clinical summary written, manuscript finalized. <em>No overconfidence.</em></p>
</div>
</div>
<div class="card animate delay-3" style="margin-top: 1rem; background: rgba(220,38,38,0.1); border: 1px solid #DC2626;">
<p class="card-text" style="font-size: 0.9rem;">
<strong style="color: #DC2626;">Day 34 Freeze:</strong> その後は新しい研究を追加できません。 34 日目。これにより、業界が有利な研究を「発見」し続けた BMP 脊椎手術メタ解析を悩ませていた「武器化されたスコープクリープ」が防止されます。
                  </p>
</div>
</div>
</div>
<!-- Seven Principles Mapped to Practice -->
<div class="slide light" data-index="6">
<div class="content">
<h2 class="title navy animate">実際の 7 つの原則</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Every principle you learned maps to a specific phase gate:
                </p>
<div class="animate delay-2" style="display: grid; gap: 0.5rem; font-size: 0.85rem;">
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(124,58,237,0.1); border-radius: 6px;">
<span style="color: #7C3AED; font-weight: 700; min-width: 40px;">DoD-A</span>
<span>"<em>すべての信号が真実であるわけではありません</em>— 何をカウントするかを事前に指定します証拠</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(37,99,235,0.1); border-radius: 6px;">
<span style="color: #2563EB; font-weight: 700; min-width: 40px;">DoD-B</span>
<span>"<em>What was hidden in plain sight?</em>" — Search comprehensively</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(217,119,6,0.1); border-radius: 6px;">
<span style="color: #D97706; font-weight: 700; min-width: 40px;">DoD-C</span>
<span>"<em>出所のない数字は数字ではありません</em>" — すべてのデータポイントをリンクします</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(5,150,105,0.1); border-radius: 6px;">
<span style="color: #059669; font-weight: 700; min-width: 40px;">DoD-D</span>
<span>"<em>異質性はノイズではなくメッセージです</em>" — Investigate, don't ignore</span>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(220,38,38,0.1); border-radius: 6px;">
<span style="color: #DC2626; font-weight: 700; min-width: 40px;">DoD-E</span>
<span>"<em>Certainty must be earned, not assumed</em>" — GRADE everything</span>
</div>
</div>
</div>
</div>
<!-- Red-Team Adversarial QA -->
<div class="slide dark" data-index="7">
<p class="title cream animate">レッドチームの原則</p>
<p class="title gold animate delay-1">自分のチームが破ろうとしています</p>
<div class="gold-line animate delay-2"></div>
<p class="animate delay-3" style="font-size: 1rem; text-align: center; max-width: 650px;">
                毎日、交代する 2 人のチーム メンバーが敵対者として 12 分間かけてデータ品質をチェックします。このようにして、Boldt の不正行為はフレンドリーなレビューではなく、ありえない採用率に気づいた懐疑的なチェックによって捕らえられたのです。
              </p>
</div>
<!-- CondGO Emergency Protocol -->
<div class="slide light" data-index="8">
<div class="content">
<h2 class="title navy animate">CondGO: When Things Go Wrong</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  What happens when you discover a critical problem mid-sprint?
                </p>
<div class="card animate delay-2" style="background: rgba(217,119,6,0.1); border: 1px solid #D97706;">
<h4 style="color: #D97706;">CondGO = Conditional Go</h4>
<p class="card-text" style="font-size: 0.9rem;">
                    A bounded rescue protocol. You have exactly <strong>72 hours</strong> 許可されたアクションのみを使用して問題を解決します。修正できない場合は、レビューを中止する必要があります。
                  </p>
</div>
<div class="card animate delay-3" style="margin-top: 1rem;">
<p class="card-text" style="font-size: 0.85rem; font-style: italic;">
                    📖 <strong>Avandia のレッスン:</strong> GSK は 2000 年に心血管信号を確認しましたが、強制的な期限はありませんでした。彼らは7年間「見守り続けた」。数万人が被害を受けた。 CondGO が存在するのは、「最終的には対処します」が人を殺すからです。
                  </p>
</div>
</div>
</div>
<!-- Your Graduation -->
<div class="slide dark" data-index="9">
<p class="title cream animate">あなたはこのコースをストーリーから始めました。</p>
<p class="title gold animate delay-1">あなたは練習の準備ができて終了します。</p>
<div class="gold-line animate delay-2"></div>
<div class="animate delay-3" style="text-align: center; max-width: 600px;">
<p style="font-size: 1rem; margin-bottom: 1rem;">
                  META-SPRINT ワークフローは、これまでに学んだすべてを取り入れ、失敗を防ぐ 40 日間のシステムに構築します。
                </p>
<p style="font-size: 0.9rem; opacity: 0.9;">
                  実際の系統的レビューを実施する準備ができたら、META-SPRINT アプリケーションを開きます。ここで学んだストーリーが、すべてのステップでリマインダーとして表示され、あなたを導きます。
                </p>
</div>
</div>
 ストーリー: CTT コラボレーション — メソッドが数百万を節約するとき 
<div class="slide dark" data-index="9b">
<div class="story-box animate">
<p class="story-opener">What does it look like when every principle is followed?</p>
<div class="real-data-box">
<h4>REAL DATA</h4>
<p>
                    コレステロール治療臨床試験担当者 (CTT) のコラボレーションは、メタ分析のゴールド スタンダードです。彼らは <span class="data-highlight">170,000 人以上の参加者から個々の患者データを取得</span>
                    across <span class="data-highlight">26 statin trials</span>.
                    Pre-specified protocol. IPD from all major trials. Standardized outcomes.
                    Result: statins reduce <span class="data-highlight">major vascular events by 21% per mmol/L LDL reduction</span>
                    (RR 0.79, 95% CI 0.77-0.81), regardless of baseline risk.
                    This finding, replicated across <span class="data-highlight">15 年間にわたる 5 つのメタ分析</span>,
                    has prevented an estimated <span class="data-highlight">millions of heart attacks and strokes worldwide</span>.
                  </p>
</div>
<div class="decision-tree">
<div class="decision-tree-header">適用された 7 つの原則</div>
<div class="decision-scenario">
                    CTT のストーリーは、このコースのすべての原則に従った場合に何が起こるかを示しています。代替案を検討してください:
                  </div>
<div class="decision-paths">
<div class="decision-path path-a" role="button" tabindex="0">
<div class="path-label">パス A: 原則なし</div>
<div class="path-choice">No protocol. Published data only. No RoB. No heterogeneity investigation. No GRADE.</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">Conflicting small trials. Statin controversy persists. Millions untreated.</div>
<div class="path-outcome">OUTCOME: Preventable cardiovascular deaths continue</div>
</div>
<div class="decision-path path-b" role="button" tabindex="0">
<div class="path-label">パス B: CTT 方式</div>
<div class="path-choice">事前登録プロトコル。すべての試験からの IPD。標準化された結果。透過的なメソッド。 GRADE 確実性が高い。</div>
<div class="path-arrow">↓</div>
<div class="path-consequence">明確な答え。世界的なガイドラインが変わります。利益を受ける人に処方されるスタチン。</div>
<div class="path-outcome">OUTCOME: Millions of lives saved by rigorous evidence synthesis</div>
</div>
</div>
</div>
<div class="story-revelation">
<div class="revelation-label">THE REVELATION</div>
<div class="revelation-text">
                    このコースのすべての原則は、それが存在しないと害が生じるために存在します。 CTT コラボレーションは、方法が厳密であり、データの出所があり、バイアスが評価されて確実性が得られる場合、メタ分析が医療において最も強力なツールになることを証明しています。あなたは今、これらの原則を実践しています。使用してください。
                  </div>
</div>
</div>
</div>
<!-- Capstone Quiz -->
<div class="slide light" data-index="10">
<div class="content">
<h2 class="title navy animate">Capstone Quiz</h2>
<div class="quiz-container">
<div class="quiz-question" id="q13-1">
<h4>1. META-SPRINT の 34 日目の「ハード フリーズ」の目的は何ですか?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 0, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">A.ピアレビューの時間を確保するため</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 1, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">B.後から追加されたスタディによる結果の操作を防ぐため</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 2, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">C. To speed up publication</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-1', 3, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">D.ジャーナルの締め切りに合わせて調整するため</div>
</div>
<div class="quiz-feedback" id="q13-1-feedback"></div>
</div>
<div class="quiz-question" id="q13-2" style="margin-top: 1.5rem;">
<h4>2. The CondGO protocol gives teams how long to fix critical problems?</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 0, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">A. 24 hours</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 1, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">B. 48 hours</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 2, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">C. 72 hours</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-2', 3, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too long—problems would fester like they did at GSK.'])">D. 1 week</div>
</div>
<div class="quiz-feedback" id="q13-2-feedback"></div>
</div>
<div class="quiz-question" id="q13-3" style="margin-top: 1.5rem;">
<h4>3. Red-team adversarial QA caught Joachim Boldt's fraud by noticing:</h4>
<div class="quiz-options">
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 0, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">A. Impossible patient recruitment rates</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 1, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">B. p-hacking in statistical tests</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 2, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">C. Inconsistent effect sizes</div>
<div class="quiz-option" onclick="checkQuizAnswer('q13-3', 3, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistent—that was part of the deception.', 'There were no whistleblowers initially.'])">D. Whistleblower testimony</div>
</div>
<div class="quiz-feedback" id="q13-3-feedback"></div>
</div>
</div>
</div>
</div>
<!-- Closing -->
<div class="slide black" data-index="11">
<div class="animate" style="text-align: center;">
<p class="refrain">あなたが学んだストーリーは歴史ではありません。</p>
<p style="font-size: 1.2rem; margin-top: 1rem; color: var(--gold);">これらは、今後の作業を守る警告です。</p>
<div class="gold-line" style="margin: 1.5rem auto;"></div>
<p style="font-size: 1rem; margin-top: 1.5rem; opacity: 0.9;">
                  最初のメタ分析を行うときは、ファネルを無視する前に、<br/>
                  remember CAST before you trust a signal,<br/>
                  remember Poldermans before you skip provenance,<br/>
                  レボセチンを思い出してください。
                </p>
<p style="font-size: 0.9rem; margin-top: 1.5rem; font-style: italic; opacity: 0.8;">
                  これで準備は完了です。構造に従ってください。謙虚に行動してください。 7 つの原則に従ってください。
                </p>
</div>
</div>
<div class="slide black" data-index="12">
<p class="refrain animate">すべてのシグナルが真実であるわけではありません。</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">モジュール 24: 最終試験</p>
</div>
</div>
<!-- Module 24: Final Exam (Summative Assessment) -->
<div class="module-slides" data-module="24">
<div class="slide dark active" data-index="0">
<p class="refrain animate">Certainty must be earned, not assumed.</p>
<p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Final Examination</p>
</div>
<div class="slide light" data-index="1">
<div class="content">
<h2 class="title navy animate">Final Exam: Part 1 of 2</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1.5rem;">
                  メタ分析の原則の習熟度をテストします。各質問は、コースの中核となる概念を取り上げています。
                </p>
<!-- Q1: PICO -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q1.</strong> ある研究者は、「健康に対する運動の影響」を研究したいと考えています。この調査質問の主な問題は何ですか?</p>
<div class="quiz-options" id="final-q1">
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 0, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>A.</span> It lacks randomization
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 1, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>B.</span> Sample size is too small
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 2, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>C.</span> It is not answerable—lacks specific PICO elements
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q1', 3, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
<span>D.</span> It lacks ethical approval
                    </div>
</div>
<div id="final-q1-feedback" style="display: none;"></div>
</div>
<!-- Q2: Publication Bias -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q2.</strong> ファンネル プロットでは、左下の領域に調査が欠落しているという顕著な非対称性が示されています。これは何を示唆していますか?</p>
<div class="quiz-options" id="final-q2">
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 0, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>A.</span> Large studies have more precise estimates
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 1, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>B.</span> 小規模な否定的な研究は未発表である可能性があります
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 2, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>C.</span> The true effect is stronger than estimated
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q2', 3, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
<span>D.</span> Random sampling error
                    </div>
</div>
<div id="final-q2-feedback" style="display: none;"></div>
</div>
<!-- Q3: Heterogeneity -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q3.</strong> メタ分析では、I² = 85% および τ² = 0.42 と報告されています。最も適切な解釈は何ですか?</p>
<div class="quiz-options" id="final-q3">
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 0, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>A.</span> There is an 85% chance of a true effect
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 1, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>B.</span> The effect size is very large
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 2, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>C.</span> Substantial between-study variance exists; investigate sources
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q3', 3, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I².', 'Correct! High I² means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I².'])">
<span>D.</span> 結果は臨床的に重要です
                    </div>
</div>
<div id="final-q3-feedback" style="display: none;"></div>
</div>
<!-- Q4: GRADE -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q4.</strong> GRADE では、ランダム化対照試験からの一連の証拠に対する開始確実性は何ですか?</p>
<div class="quiz-options" id="final-q4">
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 0, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>A.</span> High
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 1, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>B.</span> Moderate
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 2, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>C.</span> Low
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q4', 3, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting point—it results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
<span>D.</span> Very low
                    </div>
</div>
<div id="final-q4-feedback" style="display: none;"></div>
</div>
<!-- Q5: Risk of Bias -->
<div class="quiz-box animate delay-2">
<p class="quiz-question"><strong>Q5.</strong> In RoB 2.0, which domain assesses whether outcome assessors knew the treatment allocation?</p>
<div class="quiz-options" id="final-q5">
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 0, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>A.</span> D1: Randomization process
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 1, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>B.</span> D2: 意図した介入からの逸脱
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 2, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>C.</span> D3: 結果の欠落データ
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q5', 3, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
<span>D.</span> D4: 結果の測定
                    </div>
</div>
<div id="final-q5-feedback" style="display: none;"></div>
</div>
</div>
</div>
<div class="slide light" data-index="2">
<div class="content">
<h2 class="title navy animate">Final Exam: Part 2 of 2</h2>
<!-- Q6: Evidence Reversal -->
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q6.</strong> CAST 試験では、抗不整脈薬は不整脈を抑制したにもかかわらず死亡率を増加させたことが示されました。これは次の例です:</p>
<div class="quiz-options" id="final-q6">
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 0, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>A.</span> Random sampling error
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 1, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>B.</span> Surrogate outcome failure
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 2, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>C.</span> Confounding by indication
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q6', 3, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
<span>D.</span> Reverse causation
                    </div>
</div>
<div id="final-q6-feedback" style="display: none;"></div>
</div>
<!-- Q7: Fixed vs Random Effects -->
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q7.</strong> When should a random-effects model be preferred over a fixed-effect model?</p>
<div class="quiz-options" id="final-q7">
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 0, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>A.</span> When sample sizes are large
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 1, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>B.</span> 結果が二値の場合
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 2, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>C.</span> When between-study heterogeneity is expected
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q7', 3, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
<span>D.</span> When publication bias is suspected
                    </div>
</div>
<div id="final-q7-feedback" style="display: none;"></div>
</div>
<!-- Q8: ICEMAN -->
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q8.</strong> According to ICEMAN criteria, which makes a subgroup analysis MORE credible?</p>
<div class="quiz-options" id="final-q8">
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 0, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>A.</span> Hypothesis specified a priori
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 1, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>B.</span> Large number of subgroups tested
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 2, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>C.</span> No biological rationale
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q8', 3, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Opposite—small numbers of subgroups are more credible.', 'Opposite—biological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
<span>D.</span> Inconsistent effects across trials within subgroup
                    </div>
</div>
<div id="final-q8-feedback" style="display: none;"></div>
</div>
<!-- Q9: Network Meta-Analysis -->
<div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
<p class="quiz-question"><strong>Q9.</strong> What assumption must be checked in network meta-analysis to ensure valid indirect comparisons?</p>
<div class="quiz-options" id="final-q9">
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 0, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>A.</span> All studies have equal sample sizes
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 1, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>B.</span> すべての研究は同じ結果を測定します
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 2, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>C.</span> Transitivity (consistency of effect modifiers)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q9', 3, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparators—no systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
<span>D.</span> Double-blinding in all trials
                    </div>
</div>
<div id="final-q9-feedback" style="display: none;"></div>
</div>
<!-- Q10: TSA -->
<div class="quiz-box animate delay-1">
<p class="quiz-question"><strong>Q10.</strong> 治験逐次分析 (TSA) では、無益境界を越えることは何を示していますか?</p>
<div class="quiz-options" id="final-q10">
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 0, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>A.</span> 治療の原因害
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 1, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>B.</span> 今後の研究では有意義な効果が示される可能性は低い
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 2, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>C.</span> 証拠は有益であると決定的である
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q10', 3, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Opposite—crossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
<span>D.</span> メタ分析の能力が不十分
                    </div>
</div>
<div id="final-q10-feedback" style="display: none;"></div>
</div>
<div class="animate delay-2" style="margin-top: 2rem; padding: 1.5rem; background: rgba(212,175,55,0.1); border-radius: 8px; border-left: 4px solid var(--gold);">
<p style="font-weight: 600; color: var(--navy);">Part 1 Complete — continue to Part 2 (Advanced Modules)</p>
</div>
</div>
</div>
 パート 2: 高度なモジュールの質問(Q11-Q25) 
<div class="slide light" data-index="3">
<div class="content">
<h2 class="title navy animate">Final Exam: Part 2 of 2 (Advanced)</h2>
<p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1.5rem;">
                  Questions 11–25 cover Modules 13–22 (Bayesian, NMA, IPD, Dose-Response, Fragility, Equity, AI, Qualitative, Multivariate, Reproducibility).
                </p>
<!-- Q11: Bayesian -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q11.</strong> ベイジアン メタ分析では、多くの研究で曖昧な事前分布を使用するとどうなりますか?</p>
<div class="quiz-options" id="final-q11">
<div class="quiz-option" onclick="checkQuizAnswer('final-q11', 0, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
<span>A.</span> 事後分布は頻度主義の結果とよく一致します
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q11', 1, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
<span>B.</span> 事前分布は事後分布を支配します
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q11', 2, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
<span>C.</span> The credible interval becomes infinitely wide
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q11', 3, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
<span>D.</span> モデルは失敗しますconverge
                    </div>
</div>
<div id="final-q11-feedback" style="display: none;"></div>
</div>
<!-- Q12: NMA -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q12.</strong> シプリアーニの抗うつ薬 NMA では、なぜ単一の薬剤が「勝者」と宣言されなかったのですか?</p>
<div class="quiz-options" id="final-q12">
<div class="quiz-option" onclick="checkQuizAnswer('final-q12', 0, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
<span>A.</span> 研究が少なすぎます
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q12', 1, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
<span>B.</span> Different drugs ranked best on different outcomes
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q12', 2, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
<span>C.</span> 入手可能な間接的な証拠はありません
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q12', 3, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
<span>D.</span> SUCRA はあり得ません計算済み
                    </div>
</div>
<div id="final-q12-feedback" style="display: none;"></div>
</div>
<!-- Q13: IPD -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q13.</strong> なぜ 1 つの大規模試験からのものであるかのように IPD をプールしてはいけないのですか?</p>
<div class="quiz-options" id="final-q13">
<div class="quiz-option" onclick="checkQuizAnswer('final-q13', 0, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
<span>A.</span> IPD always has fewer studies than aggregate
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q13', 1, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
<span>B.</span> 研究のクラスタリングが無視され、交絡が生じます
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q13', 2, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
<span>C.</span> イベントまでの時間データを処理できません
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q13', 3, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
<span>D.</span> Binary outcomes cannot be pooled
                    </div>
</div>
<div id="final-q13-feedback" style="display: none;"></div>
</div>
<!-- Q14: Dose-response -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q14.</strong> What caused the alcohol "J-curve" to disappear in Stockwell's reanalysis?</p>
<div class="quiz-options" id="final-q14">
<div class="quiz-option" onclick="checkQuizAnswer('final-q14', 0, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
<span>A.</span> 何も示さない新しい研究が追加されました利点
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q14', 1, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
<span>B.</span> 元飲酒者が禁酒参照グループから正しく除外されました
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q14', 2, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
<span>C.</span> サンプルサイズが増加しました
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q14', 3, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
<span>D.</span> 交絡因子の調整が改善されました
                    </div>
</div>
<div id="final-q14-feedback" style="display: none;"></div>
</div>
<!-- Q15: Fragility -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q15.</strong> オセルタミビルの物語で、コクランは未発表の臨床研究レポートにアクセスして何を発見しましたか?</p>
<div class="quiz-options" id="final-q15">
<div class="quiz-option" onclick="checkQuizAnswer('final-q15', 0, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
<span>A.</span> この薬はまったく効果がありませんでした
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q15', 1, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
<span>B.</span> その効果は当初考えられていたよりも大きかった
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q15', 2, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
<span>C.</span> 合併症に対する利点はほとんどなくなりました
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q15', 3, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
<span>D.</span> Side effects were more common than reported
                    </div>
</div>
<div id="final-q15-feedback" style="display: none;"></div>
</div>
<!-- Q16: Equity -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q16.</strong> 米国の高血圧患者の何パーセントが SPRINT 試験の対象にならなかったでしょうか?</p>
<div class="quiz-options" id="final-q16">
<div class="quiz-option" onclick="checkQuizAnswer('final-q16', 0, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
<span>A.</span> About 25%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q16', 1, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
<span>B.</span> About 50%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q16', 2, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
<span>C.</span> Over 75%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q16', 3, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
<span>D.</span> Nearly 100%
                    </div>
</div>
<div id="final-q16-feedback" style="display: none;"></div>
</div>
<!-- Q17: AI -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q17.</strong> Why is AI considered an "augmenter" rather than a "replacer" in systematic reviews?</p>
<div class="quiz-options" id="final-q17">
<div class="quiz-option" onclick="checkQuizAnswer('final-q17', 0, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
<span>A.</span> AI is slower than human reviewers
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q17', 1, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
<span>B.</span> AI has perfect recall
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q17', 2, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
<span>C.</span> AI screens fast but cannot make human-level contextual judgments
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q17', 3, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
<span>D.</span> AI is too expensive for most reviews
                    </div>
</div>
<div id="final-q17-feedback" style="display: none;"></div>
</div>
<!-- Q18: Qualitative -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q18.</strong> What does the "adequacy" component of CERQual assess?</p>
<div class="quiz-options" id="final-q18">
<div class="quiz-option" onclick="checkQuizAnswer('final-q18', 0, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
<span>A.</span> 研究の数のみ
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q18', 1, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
<span>B.</span> 発見を裏付けるデータの豊富さと量
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q18', 2, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
<span>C.</span> 研究全体での発見の一貫性
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q18', 3, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
<span>D.</span> Generalizability to other populations
                    </div>
</div>
<div id="final-q18-feedback" style="display: none;"></div>
</div>
<!-- Q19: Multivariate -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q19.</strong> A meta-analysis includes 30 statin trials, each reporting 4 correlated outcomes (120 effect sizes). Which approach is correct?</p>
<div class="quiz-options" id="final-q19">
<div class="quiz-option" onclick="checkQuizAnswer('final-q19', 0, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
<span>A.</span> Treat all 120 as independent effect sizes
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q19', 1, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
<span>B.</span> Use RVE with small-sample correction
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q19', 2, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
<span>C.</span> Pick only one outcome per study
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q19', 3, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
<span>D.</span> 各研究内の 4 つの結果の平均
                    </div>
</div>
<div id="final-q19-feedback" style="display: none;"></div>
</div>
<!-- Q20: Reproducibility -->
<div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
<p class="quiz-question"><strong>Q20.</strong> ラインハルト・ロゴフの誤りでは、高額債務の修正平均増加率はいくらでしたか</p>
<div class="quiz-options" id="final-q20">
<div class="quiz-option" onclick="checkQuizAnswer('final-q20', 0, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
<span>A.</span> −0.1% (same as claimed)
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q20', 1, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
<span>B.</span> +2.2%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q20', 2, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
<span>C.</span> 0%
                    </div>
<div class="quiz-option" onclick="checkQuizAnswer('final-q20', 3, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
<span>D.</span> +5%
                    </div>
</div>
<div id="final-q20-feedback" style="display: none;"></div>
</div>
<div class="animate delay-2" style="margin-top: 2rem; padding: 1.5rem; background: rgba(212,175,55,0.1); border-radius: 8px; border-left: 4px solid var(--gold);">
<p style="font-weight: 600; color: var(--navy);">Passing Score: 15/20 across both parts</p>
<p style="margin-top: 0.5rem; color: var(--light-text);">
                    該当するモジュールに戻って、見逃した質問を確認してください。各質問は核となる概念をテストします。
                  </p>
</div>
</div>
</div>
<div class="slide black" data-index="4">
<div class="animate" style="text-align: center;">
<p class="refrain">すべてのシグナルが真実であるわけではありません。</p>
<p style="font-size: 1.1rem; margin-top: 1rem;">メソッドは、私たちの信頼から患者を守ります。</p>
<div class="gold-line" style="margin: 1.5rem auto;"></div>
<p style="font-size: 1.5rem; color: var(--gold); margin-top: 1.5rem;">
                  Congratulations
                </p>
<p style="font-size: 1.1rem; margin-top: 1rem;">
                  あなたは証拠逆転: メタ分析コースを完了しました。
                </p>
<p style="font-size: 1rem; margin-top: 1rem; opacity: 0.9;">
                  あなたの統合が真実に導かれ、あなたの情報収集が知恵に導かれますように。<br/>
                  そして謙虚さによって結論が導かれますように。
                </p>
<div style="margin-top: 2rem; font-size: 0.9rem; opacity: 0.8;">
<p style="margin-bottom: 0.5rem;"><strong>ザ・セブン原則:</strong></p>
<p>「すべての信号が真実であるわけではありません。」</p>
<p>「方法は患者を私たちの信頼から守るものです。」</p>
<p>"What was hidden in plain sight?"</p>
<p>「出所のない数字は数字ではありません」 "</p>
<p>「異質性はノイズではなくメッセージです。"</p>
<p>"証拠の不在は不在の証拠ではありません。"</p>
<p>"Certainty must be earned, not assumed."</p>
</div>
<p style="font-size: 0.9rem; margin-top: 2rem; font-style: italic; opacity: 0.7;">
                  「まっすぐな道へ導いてください...」
                </p>
</div>
</div>
</div>
<!-- Slide Navigation - minimal floating arrows -->
<nav class="slide-nav" id="slideNav">
<button class="nav-btn" id="prevBtn" onclick="prevSlide()" title="Previous (←)">←</button>
<div class="nav-center">
<div class="progress" id="progress"></div>
<span class="slide-counter" id="counter">1 / 10</span>
</div>
<button class="nav-btn" id="nextBtn" onclick="nextSlide()" title="Next (→)">→</button>
</nav>
</div>
<!-- Tools Panel -->
<aside class="tools-panel" id="toolsPanel">
<div class="tools-header">
<h3>Interactive Tools</h3>
<button class="btn" onclick="toggleToolsPanel()" style="padding: 0.25rem 0.5rem;">×</button>
</div>
<div class="tools-content">
 ライブ ストーリー データ パネル 
<div class="story-data-panel" id="storyDataPanel">
<h4><span style="font-size: 1.1rem;">📊</span> ライブ ストーリー データ</h4>
<div id="storyDataContent">
<div class="no-story-data">
                  モジュールに移動して、インタラクティブなビフォー/アフターの証拠ストーリー データを確認します。
                </div>
</div>
</div>
<!-- Effect Size Calculator -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Effect Size Calculator <span>▼</span>
</div>
<div class="tool-section-body">
<div class="form-group">
<label>Effect Type</label>
<select id="effectType">
<option value="OR">Odds Ratio (OR)</option>
<option value="RR">Risk Ratio (RR)</option>
<option value="RD">Risk Difference (RD)</option>
<option value="SMD">Standardized Mean Difference</option>
<option value="MD">Mean Difference</option>
</select>
</div>
<div id="binaryInputs">
<div class="form-group">
<label>Treatment: Events / Total</label>
<div style="display: flex; gap: 0.5rem;">
<input id="eventsTx" placeholder="Events" style="flex:1" type="number"/>
<input id="nTx" placeholder="Total" style="flex:1" type="number"/>
</div>
</div>
<div class="form-group">
<label>Control: Events / Total</label>
<div style="display: flex; gap: 0.5rem;">
<input id="eventsCtrl" placeholder="Events" style="flex:1" type="number"/>
<input id="nCtrl" placeholder="Total" style="flex:1" type="number"/>
</div>
</div>
</div>
<button class="btn-small primary" onclick="calculateEffectSize()">Calculate</button>
<div class="results-display" id="effectResults" style="display: none;"></div>
</div>
</div>
<!-- Meta-Analysis Calculator -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Meta-Analysis Calculator <span>▼</span>
</div>
<div class="tool-section-body">
<div class="form-group">
<label>Enter Studies (Effect, CI Low, CI High)</label>
<table class="study-table" id="studyTable">
<thead>
<tr>
<th>Study</th>
<th>Effect</th>
<th>CI Lo</th>
<th>CI Hi</th>
<th></th>
</tr>
</thead>
<tbody id="studyTableBody">
<tr>
<td><input type="text" value="Study 1"/></td>
<td><input step="0.01" type="number" value="1.25"/></td>
<td><input step="0.01" type="number" value="0.95"/></td>
<td><input step="0.01" type="number" value="1.64"/></td>
<td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
</tr>
<tr>
<td><input type="text" value="Study 2"/></td>
<td><input step="0.01" type="number" value="1.42"/></td>
<td><input step="0.01" type="number" value="1.10"/></td>
<td><input step="0.01" type="number" value="1.83"/></td>
<td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
</tr>
<tr>
<td><input type="text" value="Study 3"/></td>
<td><input step="0.01" type="number" value="0.98"/></td>
<td><input step="0.01" type="number" value="0.72"/></td>
<td><input step="0.01" type="number" value="1.33"/></td>
<td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
</tr>
</tbody>
</table>
<button class="btn-small" onclick="addStudyRow()">+ Add Study</button>
</div>
<div class="form-group">
<label>Tau² Estimator</label>
<select id="tau2Method">
<option value="DL">DerSimonian-Laird (DL)</option>
<option value="REML">REML</option>
<option value="PM">Paule-Mandel (PM)</option>
<option value="SJ">Sidik-Jonkman (SJ)</option>
<option value="HE">Hedges (HE)</option>
<option value="EB">Empirical Bayes (EB)</option>
<option value="ML">Maximum Likelihood (ML)</option>
<option value="HS">Hunter-Schmidt (HS)</option>
</select>
</div>
<div class="form-group">
<label>
<input checked="" id="useHKSJ" type="checkbox"/> Use HKSJ Adjustment
                  </label>
</div>
<button class="btn-small primary" onclick="runMetaAnalysis()">Run Analysis</button>
<div class="results-display" id="maResults" style="display: none;"></div>
<div class="forest-plot-container" id="forestPlotContainer" style="display: none;"></div>
</div>
</div>
<!-- PICO Builder -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                PICO Builder <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>Population</label>
<input id="picoP" placeholder="例: 2 型糖尿病の成人" type="text"/>
</div>
<div class="form-group">
<label>Intervention</label>
<input id="picoI" placeholder="e.g., SGLT2 inhibitors" type="text"/>
</div>
<div class="form-group">
<label>Comparator</label>
<input id="picoC" placeholder="e.g., Placebo or standard care" type="text"/>
</div>
<div class="form-group">
<label>Outcome</label>
<input id="picoO" placeholder="e.g., All-cause mortality" type="text"/>
</div>
<button class="btn-small primary" onclick="generatePICO()">Generate Question</button>
<div id="picoOutput" style="margin-top: 1rem; padding: 0.75rem; background: #f7fafc; border-radius: 4px; display: none;"></div>
</div>
</div>
<!-- Publication Bias Assessment -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Publication Bias <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  上記のメタ分析計算ツールのデータを使用します
                </p>
<button class="btn-small primary" onclick="runPublicationBias()">Assess Publication Bias</button>
<div id="pubBiasResults" style="display: none; margin-top: 1rem;">
<div class="results-display" id="eggerResults"></div>
<div class="forest-plot-container" id="funnelPlotContainer" style="margin-top: 0.5rem;"></div>
</div>
</div>
</div>
<!-- Risk of Bias 2.0 -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Risk of Bias 2.0 <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>Study Name</label>
<input id="robStudyName" placeholder="e.g., Smith 2020" type="text"/>
</div>
<div class="rob-domains">
<div class="rob-domain">
<label>D1: Randomization</label>
<select id="robD1" onchange="updateRoBOverall()">
<option value="">Select...</option>
<option value="low">Low risk</option>
<option value="some">Some concerns</option>
<option value="high">High risk</option>
</select>
</div>
<div class="rob-domain">
<label>D2: 介入からの逸脱</label>
<select id="robD2" onchange="updateRoBOverall()">
<option value="">Select...</option>
<option value="low">Low risk</option>
<option value="some">Some concerns</option>
<option value="high">High risk</option>
</select>
</div>
<div class="rob-domain">
<label>D3: 結果の欠落データ</label>
<select id="robD3" onchange="updateRoBOverall()">
<option value="">Select...</option>
<option value="low">Low risk</option>
<option value="some">Some concerns</option>
<option value="high">High risk</option>
</select>
</div>
<div class="rob-domain">
<label>D4: Outcome measurement</label>
<select id="robD4" onchange="updateRoBOverall()">
<option value="">Select...</option>
<option value="low">Low risk</option>
<option value="some">Some concerns</option>
<option value="high">High risk</option>
</select>
</div>
<div class="rob-domain">
<label>D5: Selection of reported result</label>
<select id="robD5" onchange="updateRoBOverall()">
<option value="">Select...</option>
<option value="low">Low risk</option>
<option value="some">Some concerns</option>
<option value="high">High risk</option>
</select>
</div>
</div>
<div id="robOverall" style="margin-top: 1rem; padding: 0.75rem; border-radius: 6px; text-align: center; font-weight: 600;"></div>
<div id="robTrafficLight" style="margin-top: 0.5rem;"></div>
</div>
</div>
<!-- GRADE Assessment -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                GRADE Certainty <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>Starting certainty</label>
<select id="gradeStart">
<option value="4">High (RCTs)</option>
<option value="2">Low (Observational)</option>
</select>
</div>
<p style="font-size: 0.7rem; font-weight: 600; color: var(--navy); margin: 0.75rem 0 0.25rem;">Downgrade factors:</p>
<div class="grade-factors">
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeRoB" style="width: 100px;">
<option value="0">None</option>
<option value="-1">Serious (-1)</option>
<option value="-2">Very serious (-2)</option>
</select>
                      Risk of Bias
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeInconsistency" style="width: 100px;">
<option value="0">None</option>
<option value="-1">Serious (-1)</option>
<option value="-2">Very serious (-2)</option>
</select>
                      Inconsistency
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeIndirectness" style="width: 100px;">
<option value="0">None</option>
<option value="-1">Serious (-1)</option>
<option value="-2">Very serious (-2)</option>
</select>
                      Indirectness
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradeImprecision" style="width: 100px;">
<option value="0">None</option>
<option value="-1">Serious (-1)</option>
<option value="-2">Very serious (-2)</option>
</select>
                      Imprecision
                    </label>
</div>
<div class="form-group" style="margin-bottom: 0.5rem;">
<label style="display: flex; align-items: center; gap: 0.5rem;">
<select id="gradePubBias" style="width: 100px;">
<option value="0">None</option>
<option value="-1">Serious (-1)</option>
<option value="-2">Very serious (-2)</option>
</select>
                      Publication Bias
                    </label>
</div>
</div>
<button class="btn-small primary" onclick="calculateGRADE()" style="margin-top: 0.5rem;">Calculate Certainty</button>
<div id="gradeResult" style="margin-top: 1rem;"></div>
</div>
</div>
<!-- I² Interpretation -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Heterogeneity Guide <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<div class="form-group">
<label>Enter I² value (%)</label>
<input id="i2Input" max="100" min="0" placeholder="e.g., 75" type="number"/>
</div>
<button class="btn-small primary" onclick="interpretI2()">Interpret</button>
<div id="i2Interpretation" style="margin-top: 1rem;"></div>
<div style="margin-top: 1rem; padding: 0.75rem; background: #f7fafc; border-radius: 6px; font-size: 0.75rem;">
<p style="font-weight: 600; margin-bottom: 0.5rem;">Cochrane Guidelines:</p>
<p>0-40%: 重要ではない可能性があります</p>
<p>30-60%: Moderate heterogeneity</p>
<p>50-90%: Substantial heterogeneity</p>
<p>75-100%: Considerable heterogeneity</p>
<p style="margin-top: 0.5rem; font-style: italic; color: var(--light-text);">
                    「異質性はノイズではなくメッセージです。"
                  </p>
</div>
</div>
</div>
<!-- NNT/NNH Calculator -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                NNT/NNH Calculator <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  Convert effect sizes to Numbers Needed to Treat/Harm
                </p>
<div class="form-group">
<label>Baseline Risk (Control Event Rate)</label>
<input id="nntCER" max="1" min="0" placeholder="e.g., 0.15 for 15%" step="0.01" type="number"/>
</div>
<div class="form-group">
<label>Effect Measure</label>
<select id="nntEffectType">
<option value="RR">Risk Ratio (RR)</option>
<option value="OR">Odds Ratio (OR)</option>
<option value="RD">Risk Difference (RD)</option>
</select>
</div>
<div class="form-group">
<label>Effect Size</label>
<input id="nntEffect" placeholder="e.g., 0.75" step="0.01" type="number"/>
</div>
<div class="form-group">
<label>95% CI Lower</label>
<input id="nntCILo" placeholder="e.g., 0.60" step="0.01" type="number"/>
</div>
<div class="form-group">
<label>95% CI Upper</label>
<input id="nntCIHi" placeholder="e.g., 0.95" step="0.01" type="number"/>
</div>
<button class="btn-small primary" onclick="calculateNNT()">Calculate NNT/NNH</button>
<div class="results-display" id="nntResults" style="display: none;"></div>
</div>
</div>
<!-- Leave-One-Out Sensitivity -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Leave-One-Out Analysis <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  プールされた結果に対する各研究の影響をテストします。メタ分析計算機のデータを使用します。
                </p>
<button class="btn-small primary" onclick="runLeaveOneOut()">感度分析を実行</button>
<div id="looResults" style="display: none; margin-top: 1rem;">
<div class="results-display" id="looSummary"></div>
<div class="forest-plot-container" id="looPlotContainer" style="margin-top: 0.5rem;"></div>
</div>
</div>
</div>
<!-- Trim-and-Fill -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Trim-and-Fill <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  欠落しているスタディを代入してファネル プロットの非対称性を修正します。メタ分析計算機のデータを使用します。
                </p>
<div class="form-group">
<label>Estimator</label>
<select id="trimFillEstimator">
<option value="L0">L0 (Linear)</option>
<option selected="" value="R0">R0 (Rank-based)</option>
</select>
</div>
<div class="form-group">
<label>Side</label>
<select id="trimFillSide">
<option value="right">Right (suppress positive)</option>
<option selected="" value="left">Left (suppress negative)</option>
</select>
</div>
<button class="btn-small primary" onclick="runTrimAndFill()">Run Trim-and-Fill</button>
<div id="trimFillResults" style="display: none; margin-top: 1rem;">
<div class="results-display" id="trimFillSummary"></div>
<div class="forest-plot-container" id="trimFillPlotContainer" style="margin-top: 0.5rem;"></div>
</div>
</div>
</div>
<!-- Key References -->
<div class="tool-section">
<div class="tool-section-header" onclick="toggleSection(this)">
                Key References <span>▼</span>
</div>
<div class="tool-section-body" style="display: none;">
<p style="font-size: 0.7rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--navy);">証拠逆転ケース:</p>
<ul style="font-size: 0.7rem; color: var(--light-text); margin-left: 1rem; line-height: 1.6;">
<li><strong>CAST:</strong> Echt DS et al. NEJM 1991;324:781-788</li>
<li><strong>HRT/WHI:</strong> Rossouw JE et al. JAMA 2002;288:321-333</li>
<li><strong>Rosiglitazone:</strong> Nissen SE, Wolski K. NEJM 2007;356:2457-2471</li>
<li><strong>Vioxx:</strong> Bombardier C et al. NEJM 2000;343:1520-1528</li>
<li><strong>DECREASE Fraud:</strong> Erasmus MC Investigation 2012</li>
<li><strong>BART:</strong> Fergusson DA et al. NEJM 2008;358:2319-2331</li>
<li><strong>ISIS-4:</strong> ISIS-4 Collaborative Group. Lancet 1995;345:669-685</li>
<li><strong>ACCORD:</strong> ACCORD 研究グループ。 NEJM 2008;358:2545-2559</li>
<li><strong>Reboxetine:</strong> Eyding D et al. BMJ 2010;341:c4737</li>
</ul>
<p style="font-size: 0.7rem; font-weight: 600; margin: 0.75rem 0 0.5rem; color: var(--navy);">Methods References:</p>
<ul style="font-size: 0.7rem; color: var(--light-text); margin-left: 1rem; line-height: 1.6;">
<li><strong>GRADE:</strong> Guyatt GH et al. BMJ 2008;336:924-926</li>
<li><strong>RoB 2.0:</strong> Sterne JAC et al. BMJ 2019;366:l4898</li>
<li><strong>ROBINS-I:</strong> Sterne JA et al. BMJ 2016;355:i4919</li>
<li><strong>ICEMAN:</strong> Schandelmaier S et al. CMAJ 2020;192:E901-E906</li>
<li><strong>HKSJ:</strong> Hartung J, Knapp G. Stat Med 2001;20:3875-3889</li>
<li><strong>PRISMA:</strong> Page MJ et al. BMJ 2021;372:n71</li>
<li><strong>TSA:</strong> Wetterslev J et al. BMC Med Res Methodol 2008;8:39</li>
</ul>
</div>
</div>
</div>
</aside>
</div>
</main>
</div>
<script>
    // ============================================================
    // CONSTANTS
    // ============================================================
    const Z_95 = 1.96;
    const Z_95_CI_DIVISOR = 2 * Z_95;

    // ============================================================
    // LIVE STORY DATA SYSTEM
    // ============================================================

    const storyData = {
      1: { // CAST
        title: 'CAST Trial: Antiarrhythmics',
        subtitle: 'Do drugs that suppress PVCs save lives?',
        before: {
          label: 'Before CAST (1989)',
          studies: [
            { name: 'Obs Study 1', effect: 0.45, lo: 0.28, hi: 0.72, n: 450 },
            { name: 'Obs Study 2', effect: 0.52, lo: 0.35, hi: 0.77, n: 380 },
            { name: 'Obs Study 3', effect: 0.38, lo: 0.22, hi: 0.65, n: 290 },
            { name: 'Surrogate', effect: 0.42, lo: 0.31, hi: 0.57, n: 1200 },
          ],
          pooled: { effect: 0.44, lo: 0.35, hi: 0.55 },
          metrics: { or: '0.44', nnt: '12', conclusion: 'Benefit' },
          insight: 'Observational data + biological plausibility suggested antiarrhythmics save lives by suppressing PVCs.'
        },
        after: {
          label: 'After CAST (1991)',
          studies: [
            { name: 'CAST-Encainide', effect: 2.38, lo: 1.59, hi: 3.57, n: 730 },
            { name: 'CAST-Flecainide', effect: 2.64, lo: 1.60, hi: 4.36, n: 641 },
          ],
          pooled: { effect: 2.50, lo: 1.80, hi: 3.47 },
          metrics: { or: '2.50', nnh: '17', conclusion: 'Harm' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Antiarrhythmics INCREASED mortality by 150%. An estimated 50,000+ deaths per year were caused by these drugs.'
        }
      },
      2: { // HRT
        title: 'HRT & Heart Disease',
        subtitle: 'Does hormone replacement protect the heart?',
        before: {
          label: 'Before WHI (2002)',
          studies: [
            { name: "Nurses' Health", effect: 0.50, lo: 0.40, hi: 0.63, n: 48470 },
            { name: 'Framingham', effect: 0.55, lo: 0.35, hi: 0.86, n: 1234 },
            { name: 'Meta 1998', effect: 0.65, lo: 0.52, hi: 0.81, n: 22000 },
          ],
          pooled: { effect: 0.56, lo: 0.47, hi: 0.67 },
          metrics: { rr: '0.56', nnt: '32', conclusion: 'Benefit' },
          insight: '30を超える観察研究で、CHDが約44%減少することが示されました。 HRT は心臓保護のために推奨されました。'
        },
        after: {
          label: 'After WHI (2002)',
          studies: [
            { name: 'WHI E+P', effect: 1.29, lo: 1.02, hi: 1.63, n: 16608 },
            { name: 'WHI E-only', effect: 0.91, lo: 0.75, hi: 1.12, n: 10739 },
          ],
          pooled: { effect: 1.13, lo: 0.95, hi: 1.34 },
          metrics: { rr: '1.13', nnh: '∞', conclusion: 'No Benefit/Harm' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Healthy user bias explained the observational findings. Women who took HRT were healthier at baseline.'
        }
      },
      3: { // Rosiglitazone
        title: 'Rosiglitazone (Avandia)',
        subtitle: '未公開の試験には何が隠されていましたか?',
        before: {
          label: 'Published Only',
          studies: [
            { name: 'ADOPT', effect: 1.08, lo: 0.75, hi: 1.56, n: 4360 },
            { name: 'DREAM', effect: 1.20, lo: 0.83, hi: 1.74, n: 5269 },
            { name: 'Published pool', effect: 1.14, lo: 0.90, hi: 1.45, n: 15000 },
          ],
          pooled: { effect: 1.14, lo: 0.92, hi: 1.41 },
          metrics: { or: '1.14', pvalue: '0.23', conclusion: 'NS' },
          insight: '公開された試験では、有意ではない傾向が示されました。 FDA と医師は安心しました。'
        },
        after: {
          label: 'すべてのデータ (Nissen 2007)',
          studies: [
            { name: 'ADOPT', effect: 1.25, lo: 0.78, hi: 2.01, n: 4360 },
            { name: 'DREAM', effect: 1.36, lo: 0.68, hi: 2.71, n: 5269 },
            { name: '42 unpublished', effect: 1.45, lo: 1.10, hi: 1.91, n: 22000 },
          ],
          pooled: { effect: 1.43, lo: 1.03, hi: 1.98 },
          metrics: { or: '1.43', pvalue: '0.03', conclusion: 'HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Including unpublished trials revealed 43% increased MI risk. ~83,000 excess heart attacks estimated.'
        }
      },
      6: { // Aprotinin
        title: 'Aprotinin (Trasylol)',
        subtitle: '観察研究は害を見逃しましたか?',
        before: {
          label: 'Observational Studies',
          studies: [
            { name: 'Mangano 2006', effect: 0.80, lo: 0.64, hi: 1.00, n: 4374 },
            { name: 'Karkouti 2006', effect: 0.85, lo: 0.68, hi: 1.06, n: 10870 },
            { name: 'Obs Meta', effect: 0.82, lo: 0.70, hi: 0.96, n: 30000 },
          ],
          pooled: { effect: 0.82, lo: 0.71, hi: 0.95 },
          metrics: { rr: '0.82', nnt: '50', conclusion: 'Benefit' },
          insight: '観察研究は死亡率が 18% 減少することを示唆しました。アプロチニンは心臓手術で広く使用されていました。'
        },
        after: {
          label: 'BART Trial (RCT)',
          studies: [
            { name: 'BART', effect: 1.53, lo: 1.10, hi: 2.15, n: 2331 },
          ],
          pooled: { effect: 1.53, lo: 1.10, hi: 2.15 },
          metrics: { rr: '1.53', nnh: '53', conclusion: 'HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> The RCT showed 53% INCREASED mortality. Confounding by indication: sickest patients got the drug.'
        }
      },
      7: { // Magnesium
        title: 'IV Magnesium in MI',
        subtitle: 'Small trials vs mega-trial',
        before: {
          label: 'Small Trials Meta (1991)',
          studies: [
            { name: 'Morton 1984', effect: 0.10, lo: 0.01, hi: 0.87, n: 40 },
            { name: 'Rasmussen 1986', effect: 0.35, lo: 0.13, hi: 0.94, n: 273 },
            { name: 'Shechter 1990', effect: 0.27, lo: 0.08, hi: 0.95, n: 103 },
            { name: 'LIMIT-2', effect: 0.74, lo: 0.57, hi: 0.97, n: 2316 },
          ],
          pooled: { effect: 0.44, lo: 0.27, hi: 0.71 },
          metrics: { or: '0.44', nnt: '25', conclusion: 'Benefit' },
          insight: 'Meta-analysis of 7 small trials showed 56% mortality reduction. Magnesium seemed like a miracle.'
        },
        after: {
          label: 'With ISIS-4 (1995)',
          studies: [
            { name: 'Small trials', effect: 0.44, lo: 0.27, hi: 0.71, n: 2774 },
            { name: 'ISIS-4', effect: 1.06, lo: 0.99, hi: 1.13, n: 58050 },
          ],
          pooled: { effect: 1.02, lo: 0.95, hi: 1.09 },
          metrics: { or: '1.02', nnt: '∞', conclusion: 'No Effect' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> ISIS-4 (58,050 patients) found NO benefit. Small-study effects and publication bias likely contributed to the earlier positive meta-analysis.'
        }
      },
      9: { // Reboxetine
        title: 'Reboxetine',
        subtitle: 'どれだけのデータが隠蔽されていましたか?',
        before: {
          label: 'Published Only',
          studies: [
            { name: 'Pub Trial 1', effect: 0.62, lo: 0.35, hi: 1.10, n: 254 },
            { name: 'Pub Trial 2', effect: 0.48, lo: 0.22, hi: 1.05, n: 187 },
            { name: 'Pub Trial 3', effect: 0.55, lo: 0.28, hi: 1.08, n: 203 },
          ],
          pooled: { effect: 0.56, lo: 0.39, hi: 0.80 },
          metrics: { smd: '0.56', pvalue: '<0.001', conclusion: 'Benefit' },
          insight: '公表された試験では、プラセボと比較して有意な効果が示されました。レボキセチンは承認され、販売されました。'
        },
        after: {
          label: 'すべてのデータ (EMA 2010)',
          studies: [
            { name: 'Published (26%)', effect: 0.56, lo: 0.39, hi: 0.80, n: 644 },
            { name: 'Unpublished (74%)', effect: 0.98, lo: 0.81, hi: 1.19, n: 1802 },
          ],
          pooled: { effect: 0.85, lo: 0.72, hi: 1.00 },
          metrics: { smd: '0.10', pvalue: '0.43', conclusion: 'No Effect' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> 74% of patient data was unpublished! True effect was essentially null. The drug was no better than placebo.'
        }
      },
      4: { // Vioxx
        title: 'Vioxx (Rofecoxib)',
        subtitle: '何が選択的に報告されましたか?',
        before: {
          label: 'VIGOR Published (2000)',
          studies: [
            { name: 'VIGOR (GI)', effect: 0.46, lo: 0.33, hi: 0.64, n: 8076 },
          ],
          pooled: { effect: 0.46, lo: 0.33, hi: 0.64 },
          metrics: { rr: '0.46', nnt: '41', conclusion: 'GI Benefit' },
          insight: 'GI 合併症の 54% 減少を強調する VIGOR が発表されました。心血管イベントは軽視されていました。'
        },
        after: {
          label: '完全な履歴書データが明らかに',
          studies: [
            { name: 'VIGOR (CV)', effect: 4.25, lo: 1.39, hi: 17.37, n: 8076 },
            { name: 'APPROVe', effect: 1.92, lo: 1.19, hi: 3.11, n: 2586 },
          ],
          pooled: { effect: 2.24, lo: 1.24, hi: 4.02 },
          metrics: { rr: '2.24', nnh: '73', conclusion: 'CV HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Full data showed 4-fold increased MI risk. ~88,000 excess heart attacks. Withdrawn 2004.'
        }
      },
      5: { // DECREASE
        title: 'DECREASE Trials (Fraud)',
        subtitle: 'What happens when data is fabricated?',
        before: {
          label: 'Before Fraud Exposed',
          studies: [
            { name: 'DECREASE-I', effect: 0.09, lo: 0.02, hi: 0.37, n: 112 },
            { name: 'DECREASE-IV', effect: 0.65, lo: 0.24, hi: 1.74, n: 1066 },
            { name: 'Other trials', effect: 0.78, lo: 0.58, hi: 1.05, n: 3500 },
          ],
          pooled: { effect: 0.56, lo: 0.35, hi: 0.89 },
          metrics: { or: '0.56', nnt: '15', conclusion: 'Benefit' },
          insight: 'Meta-analysis including DECREASE showed 44% mortality reduction. Beta-blockers were mandated in guidelines.'
        },
        after: {
          label: '不正データの排除',
          studies: [
            { name: 'POISE', effect: 1.33, lo: 1.03, hi: 1.74, n: 8351 },
            { name: 'DIPOM', effect: 1.11, lo: 0.66, hi: 1.87, n: 921 },
            { name: 'MaVS', effect: 0.92, lo: 0.46, hi: 1.84, n: 496 },
          ],
          pooled: { effect: 1.27, lo: 1.01, hi: 1.60 },
          metrics: { or: '1.27', nnh: '67', conclusion: 'HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Without fabricated DECREASE data, beta-blockers INCREASED mortality by 27%. ~10,000 excess deaths in Europe from flawed guidelines.'
        }
      },
      8: { // ACCORD
        title: 'ACCORD Trial',
        subtitle: '平均値が真実を隠すとき',
        before: {
          label: 'Before ACCORD (2008)',
          studies: [
            { name: 'DCCT (Type 1)', effect: 0.42, lo: 0.23, hi: 0.75, n: 1441 },
            { name: 'UKPDS', effect: 0.84, lo: 0.71, hi: 0.99, n: 3867 },
            { name: 'Obs studies', effect: 0.70, lo: 0.60, hi: 0.82, n: 50000 },
          ],
          pooled: { effect: 0.72, lo: 0.62, hi: 0.84 },
          metrics: { hr: '0.72', nnt: '20', conclusion: 'Benefit' },
          insight: 'Previous trials showed intensive glucose control reduced microvascular complications. Assumed benefit for macrovascular too.'
        },
        after: {
          label: 'ACCORD Results',
          studies: [
            { name: 'ACCORD', effect: 1.22, lo: 1.01, hi: 1.46, n: 10251 },
            { name: 'ADVANCE', effect: 0.93, lo: 0.83, hi: 1.06, n: 11140 },
            { name: 'VADT', effect: 1.07, lo: 0.81, hi: 1.42, n: 1791 },
          ],
          pooled: { effect: 1.04, lo: 0.91, hi: 1.19 },
          metrics: { hr: '1.22*', nnh: '95', conclusion: 'Harm in ACCORD' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> ACCORD stopped early - intensive control INCREASED mortality by 22%. Heterogeneity mattered: harm concentrated in older patients with CVD.'
        }
      },
      10: { // Surfactant
        title: 'Early Surfactant in Preterm',
        subtitle: 'When practice context changes',
        before: {
          label: 'Early Trials (1990s)',
          studies: [
            { name: 'Kendig 1991', effect: 0.55, lo: 0.35, hi: 0.86, n: 479 },
            { name: 'OSECT 1992', effect: 0.61, lo: 0.41, hi: 0.91, n: 338 },
            { name: 'Egberts 1993', effect: 0.58, lo: 0.37, hi: 0.91, n: 324 },
          ],
          pooled: { effect: 0.58, lo: 0.45, hi: 0.75 },
          metrics: { rr: '0.58', nnt: '9', conclusion: 'Benefit' },
          insight: 'Early surfactant (prophylactic) showed 42% reduced mortality/BPD compared to rescue surfactant. Became standard.'
        },
        after: {
          label: '最新の試験CPAP',
          studies: [
            { name: 'COIN 2008', effect: 1.05, lo: 0.78, hi: 1.41, n: 610 },
            { name: 'SUPPORT 2010', effect: 0.91, lo: 0.68, hi: 1.21, n: 1316 },
            { name: 'VON 2011', effect: 0.94, lo: 0.71, hi: 1.25, n: 648 },
          ],
          pooled: { effect: 0.96, lo: 0.82, hi: 1.13 },
          metrics: { rr: '0.96', nnt: '∞', conclusion: 'No Benefit' },
          insight: '<strong>EVIDENCE EVOLUTION:</strong> Modern CPAP changed the context. Early surfactant no longer superior to CPAP + selective surfactant. Practices must evolve with evidence.'
        }
      },
      11: { // HCQ COVID
        title: 'COVID-19 Hydroxychloroquine',
        subtitle: '早期の約束と厳密な証拠',
        before: {
          label: '初期研究 (2020 年 3 月～5 月)',
          studies: [
            { name: 'Gautret', effect: 0.15, lo: 0.03, hi: 0.75, n: 36 },
            { name: 'Chen J', effect: 0.65, lo: 0.25, hi: 1.69, n: 62 },
            { name: 'Million', effect: 0.22, lo: 0.11, hi: 0.44, n: 1061 },
          ],
          pooled: { effect: 0.28, lo: 0.15, hi: 0.52 },
          metrics: { or: '0.28', pvalue: '<0.001', conclusion: 'Benefit' },
          insight: 'Early small/observational studies suggested massive benefit. Emergency authorizations followed.'
        },
        after: {
          label: 'RCTs (RECOVERY, WHO)',
          studies: [
            { name: 'RECOVERY', effect: 1.09, lo: 0.97, hi: 1.23, n: 4716 },
            { name: 'WHO Solidarity', effect: 1.19, lo: 0.89, hi: 1.59, n: 954 },
            { name: 'RCT Meta', effect: 1.11, lo: 1.00, hi: 1.22, n: 8000 },
          ],
          pooled: { effect: 1.11, lo: 1.00, hi: 1.22 },
          metrics: { or: '1.11', pvalue: '0.05', conclusion: 'No Benefit/Harm' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Large RCTs showed NO benefit and possible harm. Authorizations revoked. Rigorous trials take time but give truth.'
        }
      }
    };

    let currentStoryView = 'before';
    let storyPlotType = 'forest';
    let storyPredictions = {}; // Track predictions per module
    let showingPrediction = false;

    function setStoryPlotType(type) {
      storyPlotType = type;
      const story = storyData[currentModule];
      if (story) renderStoryContent(story);
    }

    function hasPredicted(moduleId) {
      return storyPredictions[moduleId] !== undefined;
    }

    function makePrediction(moduleId, prediction) {
      const story = storyData[moduleId];
      if (!story) return;

      // Determine the actual answer
      const afterEffect = story.after.pooled.effect;
      let actual;
      if (afterEffect < 0.9) actual = 'benefit';
      else if (afterEffect > 1.1) actual = 'harm';
      else actual = 'neutral';

      // Store prediction and result
      storyPredictions[moduleId] = {
        prediction: prediction,
        actual: actual,
        correct: prediction === actual
      };

      // Update progress
      saveProgress();

      // Now show the actual results
      showingPrediction = false;
      renderStoryContent(story);
    }

    function updateStoryPanel(moduleId) {
      const panel = document.getElementById('storyDataPanel');
      const content = document.getElementById('storyDataContent');
      const story = storyData[moduleId];

      panel.classList.add('updating');
      setTimeout(() => panel.classList.remove('updating'), 500);

      if (!story) {
        content.innerHTML = `
          <div class="no-story-data">
            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">📚</p>
            <p>Module ${moduleId}: ${modules[moduleId]?.title || 'Unknown'}</p>
            <p style="margin-top: 0.5rem; opacity: 0.7;">This module focuses on methods rather than a specific evidence reversal story.</p>
          </div>
        `;
        return;
      }

      currentStoryView = 'before';
      renderStoryContent(story);
    }

    function renderStoryContent(story) {
      const content = document.getElementById('storyDataContent');
      const moduleId = currentModule;
      const data = currentStoryView === 'before' ? story.before : story.after;
      const predicted = hasPredicted(moduleId);
      const predictionResult = storyPredictions[moduleId];

      // If viewing "After" and haven't predicted yet, show prediction interface
      if (currentStoryView === 'after' && !predicted && showingPrediction) {
        content.innerHTML = `
          <div style="margin-bottom: 0.75rem;">
            <div style="font-size: 1rem; font-weight: 600; color: white;">${story.title}</div>
            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">${story.subtitle}</div>
          </div>

          <div class="story-toggle">
            <button class="" onclick="toggleStoryView('before')">
              ${story.before.label}
            </button>
            <button class="active" onclick="toggleStoryView('after')">
              ${story.after.label}
            </button>
          </div>

          <div class="predict-first-panel">
            <div class="predict-icon">🤔</div>
            <h4>Predict First!</h4>
            <p>Based on ${story.before.label}, the evidence suggested <strong>${story.before.metrics.conclusion.toLowerCase()}</strong>.</p>
            <p style="margin-top: 0.5rem;">What do you think the rigorous evidence showed?</p>

            <div class="predict-buttons">
              <button class="predict-btn benefit" onclick="makePrediction(${moduleId}, 'benefit')">
                <span class="predict-icon-small">✓</span>
                Treatment Helps
              </button>
              <button class="predict-btn neutral" onclick="makePrediction(${moduleId}, 'neutral')">
                <span class="predict-icon-small">—</span>
                No Effect
              </button>
              <button class="predict-btn harm" onclick="makePrediction(${moduleId}, 'harm')">
                <span class="predict-icon-small">✗</span>
                Treatment Harms
              </button>
            </div>

            <p style="font-size: 0.7rem; opacity: 0.6; margin-top: 0.75rem;">Making a prediction improves learning retention by 40%</p>
          </div>
        `;
        return;
      }

      // Prediction feedback (shown after predicting)
      let predictionFeedback = '';
      if (currentStoryView === 'after' && predicted) {
        const wasCorrect = predictionResult.correct;
        predictionFeedback = `
          <div class="prediction-feedback ${wasCorrect ? 'correct' : 'incorrect'}">
            <span class="feedback-icon">${wasCorrect ? '✓' : '✗'}</span>
            <span>${wasCorrect ? 'Correct! You predicted this evidence reversal.' : 'Not quite - this is why we need rigorous evidence!'}</span>
          </div>
        `;
      }

      content.innerHTML = `
        <div style="margin-bottom: 0.75rem;">
          <div style="font-size: 1rem; font-weight: 600; color: white;">${story.title}</div>
          <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">${story.subtitle}</div>
        </div>

        <div class="story-toggle">
          <button class="${currentStoryView === 'before' ? 'active' : ''}" onclick="toggleStoryView('before')">
            ${story.before.label}
          </button>
          <button class="${currentStoryView === 'after' ? 'active' : ''}" onclick="toggleStoryView('after')">
            ${story.after.label}
          </button>
        </div>

        ${predictionFeedback}

        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
          <button class="btn-small ${storyPlotType === 'forest' ? 'primary' : ''}" onclick="setStoryPlotType('forest')" style="flex:1; font-size: 0.7rem;">Forest Plot</button>
          <button class="btn-small ${storyPlotType === 'funnel' ? 'primary' : ''}" onclick="setStoryPlotType('funnel')" style="flex:1; font-size: 0.7rem;">Funnel Plot</button>
        </div>

        <div class="story-viz" id="storyForestPlot"></div>

        <div class="story-metrics">
          <div class="story-metric ${getMetricHighlight(data.metrics.conclusion)}">
            <div class="value">${Object.values(data.metrics)[0]}</div>
            <div class="label">${Object.keys(data.metrics)[0].toUpperCase()}</div>
          </div>
          <div class="story-metric ${getMetricHighlight(data.metrics.conclusion)}">
            <div class="value">${data.metrics.conclusion}</div>
            <div class="label">Conclusion</div>
          </div>
        </div>

        <div class="story-insight">${data.insight}</div>

        <button class="btn-small primary" style="width: 100%; margin-top: 0.75rem;" onclick="loadStoryIntoCalculator()">
          Load Data into Calculator →
        </button>
      `;

      // Draw the appropriate plot
      if (storyPlotType === 'funnel') {
        drawStoryFunnelPlot(data.studies, data.pooled, currentStoryView === 'after');
      } else {
        drawStoryForestPlot(data.studies, data.pooled, currentStoryView === 'after');
      }
    }

    function getMetricHighlight(conclusion) {
      if (conclusion.includes('Harm') || conclusion === 'HARM') return 'highlight-bad';
      if (conclusion.includes('Benefit')) return 'highlight-good';
      return '';
    }

    function toggleStoryView(view) {
      const moduleId = currentModule;
      const story = storyData[moduleId];
      if (!story) return;

      currentStoryView = view;

      // If switching to "after" and haven't predicted yet, show prediction interface
      if (view === 'after' && !hasPredicted(moduleId)) {
        showingPrediction = true;
      } else {
        showingPrediction = false;
      }

      renderStoryContent(story);
    }

    function drawStoryForestPlot(studies, pooled, isAfter) {
      const container = document.getElementById('storyForestPlot');
      if (!container) return;

      const width = 320;
      const height = studies.length * 32 + 60;
      const margin = { left: 100, right: 30, top: 15, bottom: 30 };
      const plotWidth = width - margin.left - margin.right;

      // Find data range
      const allEffects = [...studies.map(s => [s.lo, s.hi]).flat(), pooled.lo, pooled.hi];
      let minE = Math.min(...allEffects, 0.1);
      let maxE = Math.max(...allEffects, 3);

      // Log scale
      const logMin = Math.log(Math.max(0.05, minE * 0.8));
      const logMax = Math.log(maxE * 1.2);
      const xScale = (v) => margin.left + ((Math.log(v) - logMin) / (logMax - logMin)) * plotWidth;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="width: 100%; height: auto; font-family: sans-serif;" role="img" aria-label="Forest plot showing effect sizes for ${studies.length} studies">`;

      // Add pattern definitions for color-blind accessibility
      svg += `<defs>
        <pattern id="harmPattern" patternUnits="userSpaceOnUse" width="4" height="4">
          <path d="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2" stroke="#ef4444" stroke-width="1"/>
        </pattern>
        <pattern id="benefitPattern" patternUnits="userSpaceOnUse" width="4" height="4">
          <circle cx="2" cy="2" r="1" fill="#22c55e"/>
        </pattern>
      </defs>`;

      // Grid lines
      [0.1, 0.25, 0.5, 1, 2, 4].forEach(tick => {
        if (tick >= minE * 0.8 && tick <= maxE * 1.2) {
          const x = xScale(tick);
          svg += `<line x1="${x}" y1="${margin.top}" x2="${x}" y2="${height - margin.bottom}" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>`;
          svg += `<text x="${x}" y="${height - margin.bottom + 12}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.5)">${tick}</text>`;
        }
      });

      // Null line at 1
      const nullX = xScale(1);
      svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${height - margin.bottom}" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>`;

      // Studies - COLOR-BLIND SAFE: use different shapes + colors
      studies.forEach((study, i) => {
        const y = margin.top + 15 + i * 32;
        const x = xScale(Math.max(0.05, Math.min(10, study.effect)));
        const xLo = xScale(Math.max(0.05, study.lo));
        const xHi = xScale(Math.min(10, study.hi));

        // Color-blind safe: green (#22c55e) for benefit, red (#ef4444) for harm, gray for neutral
        const isBenefit = study.effect < 1;
        const isHarm = study.effect > 1.1;
        const color = isBenefit ? '#22c55e' : (isHarm ? '#ef4444' : '#94a3b8');

        // Study name
        svg += `<text x="${margin.left - 5}" y="${y + 4}" text-anchor="end" font-size="9" fill="white">${study.name}</text>`;

        // CI line - use dashed for harm, solid for benefit (color-blind safe)
        const dashArray = isHarm ? 'stroke-dasharray="3,2"' : '';
        svg += `<line x1="${xLo}" y1="${y}" x2="${xHi}" y2="${y}" stroke="${color}" stroke-width="2" ${dashArray}/>`;

        // Effect marker - SHAPES differ: square for benefit, circle for harm, diamond for neutral
        const size = Math.min(10, Math.max(5, study.n ? Math.sqrt(study.n) / 10 : 6));
        if (isBenefit) {
          // Square with fill for benefit
          svg += `<rect x="${x - size/2}" y="${y - size/2}" width="${size}" height="${size}" fill="${color}" rx="1"/>`;
        } else if (isHarm) {
          // Circle for harm
          svg += `<circle cx="${x}" cy="${y}" r="${size/2}" fill="${color}"/>`;
        } else {
          // Diamond for neutral
          svg += `<polygon points="${x},${y-size/2} ${x+size/2},${y} ${x},${y+size/2} ${x-size/2},${y}" fill="${color}"/>`;
        }
      });

      // Pooled diamond
      const poolY = height - margin.bottom - 10;
      const poolX = xScale(Math.max(0.05, Math.min(10, pooled.effect)));
      const poolXLo = xScale(Math.max(0.05, pooled.lo));
      const poolXHi = xScale(Math.min(10, pooled.hi));
      const isPooledHarm = pooled.effect > 1;
      const diamondColor = isAfter ? (isPooledHarm ? '#ef4444' : '#22c55e') : '#D4AF37';

      svg += `<polygon points="${poolXLo},${poolY} ${poolX},${poolY - 6} ${poolXHi},${poolY} ${poolX},${poolY + 6}" fill="${diamondColor}" stroke="white" stroke-width="1"/>`;
      svg += `<text x="${margin.left - 5}" y="${poolY + 3}" text-anchor="end" font-size="9" font-weight="bold" fill="${diamondColor}">Pooled</text>`;

      // Labels with symbols for color-blind users
      svg += `<text x="${xScale(0.3)}" y="${height - 3}" text-anchor="middle" font-size="7" fill="rgba(255,255,255,0.6)">■ Favors Treatment</text>`;
      svg += `<text x="${xScale(2.5)}" y="${height - 3}" text-anchor="middle" font-size="7" fill="rgba(255,255,255,0.6)">● Favors Control</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    function drawStoryFunnelPlot(studies, pooled, isAfter) {
      const container = document.getElementById('storyForestPlot');
      if (!container) return;

      const width = 320;
      const height = 200;
      const margin = { left: 40, right: 20, top: 20, bottom: 35 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Calculate SE from CI
      const studiesWithSE = studies.map(s => ({
        ...s,
        se: (Math.log(s.hi) - Math.log(s.lo)) / 3.92
      }));

      const maxSE = Math.max(...studiesWithSE.map(s => s.se)) * 1.2;
      const logPooled = Math.log(pooled.effect);

      // Scale functions
      const logEffects = studiesWithSE.map(s => Math.log(s.effect));
      const minLog = Math.min(...logEffects, logPooled) - 0.5;
      const maxLog = Math.max(...logEffects, logPooled) + 0.5;

      const xScale = (logE) => margin.left + ((logE - minLog) / (maxLog - minLog)) * plotWidth;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="width: 100%; height: auto; font-family: sans-serif;">`;

      // Funnel shape
      const funnelLeft = xScale(logPooled - 1.96 * maxSE);
      const funnelRight = xScale(logPooled + 1.96 * maxSE);
      const funnelTop = xScale(logPooled);

      svg += `<polygon points="${funnelTop},${margin.top} ${funnelLeft},${margin.top + plotHeight} ${funnelRight},${margin.top + plotHeight}"
               fill="rgba(255,255,255,0.1)" stroke="rgba(255,255,255,0.3)" stroke-dasharray="3"/>`;

      // Vertical line at pooled effect
      svg += `<line x1="${xScale(logPooled)}" y1="${margin.top}" x2="${xScale(logPooled)}" y2="${margin.top + plotHeight}"
               stroke="${isAfter ? '#ef4444' : '#D4AF37'}" stroke-width="2"/>`;

      // Null line at log(1) = 0
      const nullX = xScale(0);
      if (nullX > margin.left && nullX < width - margin.right) {
        svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${margin.top + plotHeight}"
                 stroke="rgba(255,255,255,0.4)" stroke-width="1" stroke-dasharray="4"/>`;
      }

      // Study points
      studiesWithSE.forEach(study => {
        const x = xScale(Math.log(study.effect));
        const y = yScale(study.se);
        const color = study.effect < 1 ? '#22c55e' : '#ef4444';

        svg += `<circle cx="${x}" cy="${y}" r="6" fill="${color}" stroke="white" stroke-width="1"/>`;
      });

      // X-axis label
      svg += `<text x="${width/2}" y="${height - 5}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.6)">Effect Size (log scale)</text>`;

      // Y-axis label
      svg += `<text x="12" y="${height/2}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.6)" transform="rotate(-90, 12, ${height/2})">Standard Error</text>`;

      // Show asymmetry indicator if appropriate
      if (isAfter) {
        svg += `<text x="${width - 10}" y="${margin.top + 15}" text-anchor="end" font-size="8" fill="#ef4444">⚠ Asymmetry</text>`;
      }

      svg += '</svg>';
      container.innerHTML = svg;
    }

    // ============================================================
    // INTERACTIVE TOOLS FOR NEW MODULES (13-22)
    // ============================================================

    // --- Tool 1: Bayesian Posterior Visualizer (Module 13) ---
    function updateBayesianPosterior() {
      const strengthVal = parseInt(document.getElementById('priorStrengthSlider').value);
      const meanVal = parseInt(document.getElementById('priorMeanSlider').value) / 100;
      const priorSD = Math.max(0.1, 10 - strengthVal * 0.098);
      const labels = ['Vague', 'Vague', 'Weak', 'Weak', 'Moderate', 'Moderate', 'Informative', 'Informative', 'Strong', 'Strong', 'Very Strong'];
      document.getElementById('priorStrengthLabel').textContent = labels[Math.min(10, Math.floor(strengthVal / 10))];
      document.getElementById('priorMeanLabel').textContent = meanVal.toFixed(2);

      // Data likelihood: centered at observed log-OR = -0.47 (STAMPEDE HR 0.63), SE = 0.10
      const dataM = -0.47, dataSE = 0.10;
      const dataPrec = 1 / (dataSE * dataSE);
      const priorPrec = 1 / (priorSD * priorSD);
      const postPrec = dataPrec + priorPrec;
      const postM = (dataM * dataPrec + meanVal * priorPrec) / postPrec;
      const postSD = Math.sqrt(1 / postPrec);

      const w = 500, h = 220, pad = 40;
      const xMin = -2, xMax = 2, steps = 200;
      function gauss(x, m, s) { return Math.exp(-0.5 * ((x - m) / s) ** 2) / (s * Math.sqrt(2 * Math.PI)); }
      function pathData(m, s, color) {
        let pts = [];
        for (let i = 0; i <= steps; i++) {
          const x = xMin + (xMax - xMin) * i / steps;
          const px = pad + (x - xMin) / (xMax - xMin) * (w - 2 * pad);
          const py = h - pad - gauss(x, m, s) / gauss(m, m, s) * (h - 2 * pad);
          pts.push(`${i === 0 ? 'M' : 'L'}${px.toFixed(1)},${py.toFixed(1)}`);
        }
        return `<path d="${pts.join(' ')}" fill="none" stroke="${color}" stroke-width="2.5"/>`;
      }

      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      svg += `<line x1="${pad}" y1="${h-pad}" x2="${w-pad}" y2="${h-pad}" stroke="#ccc"/>`;
      // Zero line
      const zx = pad + (0 - xMin) / (xMax - xMin) * (w - 2 * pad);
      svg += `<line x1="${zx}" y1="${pad}" x2="${zx}" y2="${h-pad}" stroke="#aaa" stroke-dasharray="4"/>`;
      svg += `<text x="${zx}" y="${h-pad+15}" text-anchor="middle" font-size="10" fill="#666">0</text>`;
      // Labels
      svg += `<text x="${pad}" y="${h-pad+15}" text-anchor="middle" font-size="10" fill="#666">${xMin}</text>`;
      svg += `<text x="${w-pad}" y="${h-pad+15}" text-anchor="middle" font-size="10" fill="#666">${xMax}</text>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">log-OR</text>`;
      // Curves
      svg += pathData(meanVal, priorSD, '#3b82f6');
      svg += pathData(dataM, dataSE, '#22c55e');
      svg += pathData(postM, postSD, '#D4AF37');
      // Legend
      svg += `<circle cx="${pad+10}" cy="15" r="5" fill="#3b82f6"/><text x="${pad+20}" y="19" font-size="10" fill="#333">Prior</text>`;
      svg += `<circle cx="${pad+70}" cy="15" r="5" fill="#22c55e"/><text x="${pad+80}" y="19" font-size="10" fill="#333">Likelihood</text>`;
      svg += `<circle cx="${pad+160}" cy="15" r="5" fill="#D4AF37"/><text x="${pad+170}" y="19" font-size="10" fill="#333">Posterior</text>`;
      // Posterior summary
      svg += `<text x="${w-pad}" y="35" text-anchor="end" font-size="10" fill="#333">Posterior: ${postM.toFixed(2)} [${(postM-1.96*postSD).toFixed(2)}, ${(postM+1.96*postSD).toFixed(2)}]</text>`;
      svg += '</svg>';
      document.getElementById('bayesianPlotArea').innerHTML = svg;
    }

    // --- Tool 2: NMA Network Graph (Module 14) ---
    function drawNMANetwork() {
      const area = document.getElementById('nmaNetworkArea');
      if (!area) return;
      // Simplified antidepressant network (12 key drugs)
      const drugs = [
        { name: 'Placebo', x: 250, y: 160 },
        { name: 'Fluoxetine', x: 120, y: 60 }, { name: 'Sertraline', x: 180, y: 40 },
        { name: 'Paroxetine', x: 310, y: 40 }, { name: 'Citalopram', x: 380, y: 60 },
        { name: 'Escitalopram', x: 420, y: 130 }, { name: 'Venlafaxine', x: 400, y: 220 },
        { name: 'Duloxetine', x: 330, y: 270 }, { name: 'Mirtazapine', x: 220, y: 280 },
        { name: 'Amitriptyline', x: 130, y: 260 }, { name: 'Bupropion', x: 70, y: 200 },
        { name: 'Agomelatine', x: 80, y: 130 }
      ];
      // Edges: [from, to, nStudies]
      const edges = [
        [0,1,35],[0,2,15],[0,3,22],[0,4,12],[0,5,18],[0,6,20],[0,7,10],[0,8,14],[0,9,8],
        [1,2,5],[1,3,8],[1,6,12],[1,8,4],[2,3,3],[2,6,6],[3,6,7],[4,5,6],
        [5,6,8],[6,7,5],[6,8,6],[8,9,3],[1,10,4],[0,10,7],[0,11,9],[5,11,3]
      ];
      const w = 500, h = 320;
      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Edges
      edges.forEach(([a, b, n]) => {
        const d1 = drugs[a], d2 = drugs[b];
        const thick = Math.max(1, Math.min(6, n / 5));
        svg += `<line x1="${d1.x}" y1="${d1.y}" x2="${d2.x}" y2="${d2.y}" stroke="rgba(212,175,55,0.4)" stroke-width="${thick}"/>`;
      });
      // Nodes
      drugs.forEach((d, i) => {
        const r = i === 0 ? 18 : 12;
        const fill = i === 0 ? '#1E2761' : '#D4AF37';
        svg += `<circle cx="${d.x}" cy="${d.y}" r="${r}" fill="${fill}" stroke="white" stroke-width="1.5"/>`;
        svg += `<text x="${d.x}" y="${d.y + r + 12}" text-anchor="middle" font-size="8" fill="#333" font-weight="600">${d.name}</text>`;
      });
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 3: GOSH Plot Generator (Module 17) ---
    // xoshiro128** PRNG for deterministic sampling
    function xoshiro128ss(seed) {
      let s = [seed, seed ^ 0x9E3779B9, seed ^ 0x6A09E667, seed ^ 0xBB67AE85];
      function rotl(x, k) { return ((x << k) | (x >>> (32 - k))) >>> 0; }
      function next() {
        const result = (rotl((s[1] * 5) >>> 0, 7) * 9) >>> 0;
        const t = (s[1] << 9) >>> 0;
        s[2] ^= s[0]; s[3] ^= s[1]; s[1] ^= s[2]; s[0] ^= s[3];
        s[2] ^= t; s[3] = rotl(s[3], 11);
        return result / 4294967296;
      }
      return next;
    }

    function generateGOSHPlot() {
      const area = document.getElementById('goshPlotArea');
      if (!area) return;
      // Example 8-study data (log-OR and SE)
      const studies = [
        { y: -0.5, se: 0.2 }, { y: -0.3, se: 0.15 }, { y: -0.1, se: 0.25 },
        { y: -0.4, se: 0.18 }, { y: 0.6, se: 0.3 }, { y: -0.35, se: 0.12 },
        { y: -0.2, se: 0.22 }, { y: -0.45, se: 0.16 }
      ];
      const k = studies.length;
      const rng = xoshiro128ss(42);
      const nSubsets = Math.min(2000, Math.pow(2, k) - 1);
      const points = [];

      for (let s = 0; s < nSubsets; s++) {
        // Random subset (at least 2 studies)
        let mask;
        do {
          mask = Math.floor(rng() * (Math.pow(2, k) - 1)) + 1;
        } while (mask.toString(2).split('').filter(c => c === '1').length < 2);

        const sub = studies.filter((_, i) => mask & (1 << i));
        // Fixed-effect pooled estimate + I²
        const wSum = sub.reduce((a, s) => a + 1 / (s.se * s.se), 0);
        const pooled = sub.reduce((a, s) => a + s.y / (s.se * s.se), 0) / wSum;
        const Q = sub.reduce((a, s) => a + (s.y - pooled) ** 2 / (s.se * s.se), 0);
        const df = sub.length - 1;
        const I2 = Math.max(0, (Q - df) / Q * 100);
        points.push({ effect: pooled, I2 });
      }

      const w = 500, h = 280, pad = 50;
      const xMin = -1.2, xMax = 1.2, yMin = 0, yMax = 100;
      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Axes
      svg += `<line x1="${pad}" y1="${h-pad}" x2="${w-pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<line x1="${pad}" y1="${pad}" x2="${pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">Pooled Effect (log-OR)</text>`;
      svg += `<text x="12" y="${h/2}" text-anchor="middle" font-size="11" fill="#666" transform="rotate(-90,12,${h/2})">I² (%)</text>`;
      // Points
      points.forEach(p => {
        const px = pad + (p.effect - xMin) / (xMax - xMin) * (w - 2 * pad);
        const py = h - pad - (p.I2 - yMin) / (yMax - yMin) * (h - 2 * pad);
        svg += `<circle cx="${px.toFixed(1)}" cy="${py.toFixed(1)}" r="2" fill="rgba(212,175,55,0.4)"/>`;
      });
      // Tick labels
      [-1, -0.5, 0, 0.5, 1].forEach(v => {
        const x = pad + (v - xMin) / (xMax - xMin) * (w - 2 * pad);
        svg += `<text x="${x}" y="${h-pad+15}" text-anchor="middle" font-size="9" fill="#999">${v}</text>`;
      });
      [0, 25, 50, 75, 100].forEach(v => {
        const y = h - pad - v / 100 * (h - 2 * pad);
        svg += `<text x="${pad-5}" y="${y+3}" text-anchor="end" font-size="9" fill="#999">${v}</text>`;
      });
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 4: Contour-Enhanced Funnel Plot (Module 17) ---
    function generateContourFunnel() {
      const area = document.getElementById('contourFunnelArea');
      if (!area) return;
      // Reuse magnesium-like data
      const studies = [
        {y: -0.5, se: 0.20}, {y: -0.3, se: 0.15}, {y: -0.1, se: 0.25},
        {y: -0.4, se: 0.18}, {y: 0.6, se: 0.30}, {y: -0.35, se: 0.12},
        {y: -0.2, se: 0.22}, {y: -0.45, se: 0.16}, {y: -0.15, se: 0.28},
        {y: -0.55, se: 0.10}
      ];
      const w = 460, h = 300, pad = 50;
      const pooled = -0.28;
      const maxSE = 0.35;
      const xMin = -1.5, xMax = 1.0;
      function px(v) { return pad + (v - xMin) / (xMax - xMin) * (w - 2 * pad); }
      function py(se) { return pad + se / maxSE * (h - 2 * pad); }

      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Contour regions (p-value regions)
      // Draw widest region first (p<0.10) so narrower regions layer on top
      const zVals = [1.645, 1.96, 2.576]; // p<0.10, p<0.05, p<0.01
      const colors = ['rgba(212,175,55,0.15)', 'rgba(59,130,246,0.15)', 'rgba(34,197,94,0.15)'];
      const labels = ['p<0.10', 'p<0.05', 'p<0.01'];
      for (let z = 0; z < zVals.length; z++) {
        // Left contour: effect = -z*SE (significant negative)
        let pts = `${px(0)},${py(0)}`;
        for (let se = 0; se <= maxSE; se += 0.01) {
          pts += ` ${px(-zVals[z] * se)},${py(se)}`;
        }
        pts += ` ${px(xMin)},${py(maxSE)} ${px(xMin)},${py(0)}`;
        svg += `<polygon points="${pts}" fill="${colors[z]}"/>`;
        // Right contour
        pts = `${px(0)},${py(0)}`;
        for (let se = 0; se <= maxSE; se += 0.01) {
          pts += ` ${px(zVals[z] * se)},${py(se)}`;
        }
        pts += ` ${px(xMax)},${py(maxSE)} ${px(xMax)},${py(0)}`;
        svg += `<polygon points="${pts}" fill="${colors[z]}"/>`;
      }
      // Pooled line
      svg += `<line x1="${px(pooled)}" y1="${py(0)}" x2="${px(pooled)}" y2="${py(maxSE)}" stroke="#D4AF37" stroke-width="2"/>`;
      // Null line
      svg += `<line x1="${px(0)}" y1="${py(0)}" x2="${px(0)}" y2="${py(maxSE)}" stroke="#999" stroke-dasharray="4"/>`;
      // Studies
      studies.forEach(s => {
        svg += `<circle cx="${px(s.y)}" cy="${py(s.se)}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>`;
      });
      // Legend
      svg += `<text x="${w-pad}" y="15" text-anchor="end" font-size="9" fill="#22c55e">p&lt;0.01</text>`;
      svg += `<text x="${w-pad}" y="28" text-anchor="end" font-size="9" fill="#3b82f6">p&lt;0.05</text>`;
      svg += `<text x="${w-pad}" y="41" text-anchor="end" font-size="9" fill="#D4AF37">p&lt;0.10</text>`;
      // Axes
      svg += `<line x1="${pad}" y1="${py(0)}" x2="${w-pad}" y2="${py(0)}" stroke="#999"/>`;
      svg += `<line x1="${pad}" y1="${py(0)}" x2="${pad}" y2="${py(maxSE)}" stroke="#999"/>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">Effect Size</text>`;
      svg += `<text x="12" y="${h/2}" text-anchor="middle" font-size="11" fill="#666" transform="rotate(-90,12,${h/2})">Std Error</text>`;
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 5: Fragility Index Calculator (Module 17) ---
    function calculateFragilityIndex() {
      let eTx = parseInt(document.getElementById('fi-eventsTx').value) || 0;
      let nTx = parseInt(document.getElementById('fi-nTx').value) || 0;
      let eCtrl = parseInt(document.getElementById('fi-eventsCtrl').value) || 0;
      let nCtrl = parseInt(document.getElementById('fi-nCtrl').value) || 0;
      if (nTx <= 0 || nCtrl <= 0 || eTx < 0 || eCtrl < 0) {
        document.getElementById('fragilityResult').innerHTML = '<p style="color:#C53030;">Please enter valid positive numbers.</p>';
        document.getElementById('fragilityResult').style.display = 'block';
        return;
      }
      // Fisher's exact test approximation using chi-squared
      function pValue(a, b, c, d) {
        const n = a + b + c + d;
        const e = (a * d - b * c);
        const chi2 = n * e * e / ((a + b) * (c + d) * (a + c) * (b + d));
        // Approximate p from chi2 with 1 df using normal
        const z = Math.sqrt(chi2);
        return 2 * (1 - normalCDF(z));
      }
      function normalCDF(x) {
        const t = 1 / (1 + 0.2316419 * Math.abs(x));
        const d = 0.3989422804 * Math.exp(-x * x / 2);
        const p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
        return x > 0 ? 1 - p : p;
      }
      let fi = 0;
      let a = eTx, b = nTx - eTx, c = eCtrl, d = nCtrl - eCtrl;
      let p = pValue(a, b, c, d);
      if (p >= 0.05) {
        document.getElementById('fragilityResult').innerHTML = '<p>Result is already non-significant (p = ' + p.toFixed(4) + '). Fragility index = 0.</p>';
        document.getElementById('fragilityResult').style.display = 'block';
        return;
      }
      // Iteratively add events to treatment arm (convert non-events to events)
      while (p < 0.05 && fi < 500 && a < nTx) {
        a++;
        b = nTx - a;
        p = pValue(a, b, c, d);
        fi++;
      }
      const res = document.getElementById('fragilityResult');
      res.innerHTML = `
        <p style="font-weight:600; font-size:1.2rem; color:var(--navy);">Fragility Index = ${fi}</p>
        <p style="margin-top:0.5rem;">Changing <strong>${fi}</strong> event${fi !== 1 ? 's' : ''} flips p from significant to ${p.toFixed(4)}.</p>
        <p style="margin-top:0.5rem; color:${fi <= 3 ? '#C53030' : fi <= 8 ? '#D4AF37' : '#22c55e'}; font-weight:600;">
          ${fi <= 3 ? 'Very fragile result' : fi <= 8 ? 'Moderately fragile' : 'Reasonably robust'}
        </p>
      `;
      res.style.display = 'block';
    }

    // --- Tool 6: Dose-Response Curve Builder (Module 16) ---
    let currentDoseModel = 'spline';
    function setDoseModel(model) {
      currentDoseModel = model;
      ['linear', 'quadratic', 'spline'].forEach(m => {
        const btn = document.getElementById('doseBtn-' + m);
        if (btn) { btn.classList.toggle('primary', m === model); }
      });
      drawDoseResponse();
    }
    function drawDoseResponse() {
      const area = document.getElementById('doseResponsePlotArea');
      if (!area) return;
      // Simulated dose-response data (drinks/week vs log-RR)
      const data = [
        {dose: 0, rr: 0, lo: 0, hi: 0},
        {dose: 3, rr: -0.05, lo: -0.15, hi: 0.05},
        {dose: 7, rr: 0.02, lo: -0.08, hi: 0.12},
        {dose: 14, rr: 0.15, lo: 0.03, hi: 0.27},
        {dose: 21, rr: 0.35, lo: 0.18, hi: 0.52},
        {dose: 28, rr: 0.55, lo: 0.30, hi: 0.80}
      ];
      const w = 480, h = 240, pad = 50;
      const maxDose = 30, yMin = -0.3, yMax = 0.9;
      function px(d) { return pad + d / maxDose * (w - 2 * pad); }
      function py(v) { return h - pad - (v - yMin) / (yMax - yMin) * (h - 2 * pad); }

      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Reference line at 0
      svg += `<line x1="${pad}" y1="${py(0)}" x2="${w-pad}" y2="${py(0)}" stroke="#aaa" stroke-dasharray="4"/>`;
      // CI shading
      let ciPath = `M${px(data[0].dose)},${py(data[0].hi)}`;
      data.forEach(d => { ciPath += ` L${px(d.dose)},${py(d.hi)}`; });
      for (let i = data.length - 1; i >= 0; i--) { ciPath += ` L${px(data[i].dose)},${py(data[i].lo)}`; }
      ciPath += 'Z';
      svg += `<path d="${ciPath}" fill="rgba(212,175,55,0.15)"/>`;

      // Model curve
      let curvePts = [];
      for (let d = 0; d <= maxDose; d += 0.5) {
        let val;
        if (currentDoseModel === 'linear') {
          val = 0.019 * d;
        } else if (currentDoseModel === 'quadratic') {
          val = -0.005 * d + 0.0009 * d * d;
        } else { // spline
          // Simulate a J-curve effect
          if (d <= 5) val = -0.01 * d;
          else if (d <= 15) val = -0.05 + 0.02 * (d - 5);
          else val = 0.15 + 0.025 * (d - 15);
        }
        curvePts.push(`${px(d).toFixed(1)},${py(val).toFixed(1)}`);
      }
      svg += `<polyline points="${curvePts.join(' ')}" fill="none" stroke="#D4AF37" stroke-width="2.5"/>`;

      // Data points
      data.forEach(d => {
        svg += `<circle cx="${px(d.dose)}" cy="${py(d.rr)}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>`;
        svg += `<line x1="${px(d.dose)}" y1="${py(d.lo)}" x2="${px(d.dose)}" y2="${py(d.hi)}" stroke="#1E2761" stroke-width="1"/>`;
      });
      // Axes + labels
      svg += `<line x1="${pad}" y1="${h-pad}" x2="${w-pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<line x1="${pad}" y1="${pad}" x2="${pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">Dose (drinks/week)</text>`;
      svg += `<text x="12" y="${h/2}" text-anchor="middle" font-size="11" fill="#666" transform="rotate(-90,12,${h/2})">log-RR</text>`;
      svg += `<text x="${w-pad}" y="20" text-anchor="end" font-size="11" fill="#D4AF37" font-weight="600">${currentDoseModel.charAt(0).toUpperCase() + currentDoseModel.slice(1)} model</text>`;
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 7: CERQual Assessment Tool (Module 20) ---
    function initCERQualTool() {
      const container = document.getElementById('cerqualTool');
      if (!container) return;
      const components = [
        { id: 'meth', label: 'Methodological Limitations', desc: 'Extent of problems with design/conduct of contributing studies' },
        { id: 'cohe', label: 'Coherence', desc: 'How clearly and consistently the data supports the finding' },
        { id: 'adeq', label: 'Adequacy', desc: 'Degree of richness and quantity of data supporting the finding' },
        { id: 'relv', label: 'Relevance', desc: 'Extent to which the contributing studies apply to the review context' }
      ];
      const levels = ['No concerns', 'Minor concerns', 'Moderate concerns', 'Serious concerns'];
      let html = '';
      components.forEach(c => {
        html += `<div style="margin-bottom:0.75rem; padding:0.75rem; background:white; border-radius:6px; border:1px solid #e2e8f0;">
          <div style="font-weight:600; margin-bottom:0.25rem;">${c.label}</div>
          <div style="font-size:0.8rem; color:#718096; margin-bottom:0.5rem;">${c.desc}</div>
          <select id="cerqual-${c.id}" onchange="updateCERQual()" style="width:100%; padding:0.3rem; border:1px solid #ccc; border-radius:4px;">
            ${levels.map((l, i) => `<option value="${i}">${l}</option>`).join('')}
          </select>
        </div>`;
      });
      html += '<div id="cerqualResult" style="margin-top:0.75rem; padding:0.75rem; background:rgba(212,175,55,0.1); border-radius:6px;"></div>';
      container.innerHTML = html;
      updateCERQual();
    }
    function updateCERQual() {
      const ids = ['meth', 'cohe', 'adeq', 'relv'];
      const total = ids.reduce((s, id) => s + parseInt(document.getElementById('cerqual-' + id)?.value || 0), 0);
      const levels = ['High', 'Moderate', 'Low', 'Very Low'];
      const colors = ['#22c55e', '#D4AF37', '#f59e0b', '#C53030'];
      const idx = Math.min(3, Math.floor(total / 2));
      const res = document.getElementById('cerqualResult');
      if (res) res.innerHTML = `<p style="font-weight:600; color:${colors[idx]}; font-size:1.1rem;">Overall Confidence: ${levels[idx]}</p>
        <p style="font-size:0.85rem; margin-top:0.25rem;">Total concern score: ${total}/12</p>`;
    }

    // --- Tool 8: Reproducibility Checklist (Module 22) ---
    function initReproChecklist() {
      const container = document.getElementById('reproChecklist');
      if (!container) return;
      const items = [
        'Search strategy fully reported and reproducible',
        'Extracted data table available (supplementary or repository)',
        'Analysis code/script shared (R, Python, or equivalent)',
        'Software version and packages documented',
        'Random seed specified for stochastic analyses',
        'Sensitivity analyses pre-specified in protocol',
        'PRISMA checklist completed and submitted',
        'Data available in machine-readable format (CSV/JSON)'
      ];
      container.innerHTML = items.map((item, i) =>
        `<label style="display:flex; align-items:center; gap:0.5rem; padding:0.5rem 0; border-bottom:1px solid #e2e8f0; cursor:pointer;">
          <input type="checkbox" id="repro-${i}" onchange="updateReproScore()" style="width:18px;height:18px;accent-color:#D4AF37;">
          <span style="font-size:0.9rem;">${item}</span>
        </label>`
      ).join('');
      updateReproScore();
    }
    function updateReproScore() {
      const total = 8;
      let checked = 0;
      for (let i = 0; i < total; i++) {
        if (document.getElementById('repro-' + i)?.checked) checked++;
      }
      const pct = Math.round(checked / total * 100);
      const color = pct >= 75 ? '#22c55e' : pct >= 50 ? '#D4AF37' : '#C53030';
      const label = pct >= 75 ? 'Good' : pct >= 50 ? 'Fair' : 'Poor';
      const res = document.getElementById('reproScore');
      if (res) {
        res.innerHTML = `
          <div style="background:#e2e8f0; border-radius:4px; height:12px; margin-bottom:0.5rem;">
            <div style="background:${color}; height:100%; border-radius:4px; width:${pct}%; transition:width 0.3s;"></div>
          </div>
          <p style="font-weight:600; color:${color};">${label} Reproducibility (${checked}/${total} = ${pct}%)</p>
        `;
      }
    }

    // Initialize tools when modules are first visited
    function initAdvancedTools() {
      // Run once on first visit to these modules
      if (document.getElementById('bayesianPlotArea') && !document.getElementById('bayesianPlotArea').innerHTML) {
        updateBayesianPosterior();
      }
      if (document.getElementById('nmaNetworkArea') && !document.getElementById('nmaNetworkArea').innerHTML) {
        drawNMANetwork();
      }
      if (document.getElementById('doseResponsePlotArea') && !document.getElementById('doseResponsePlotArea').innerHTML) {
        drawDoseResponse();
      }
      if (document.getElementById('reproChecklist') && !document.getElementById('reproChecklist').innerHTML) {
        initReproChecklist();
      }
    }

    // Hook into goToModule to init tools
    const _origGoToModuleForTools = typeof goToModule === 'function' ? goToModule : null;

    function openToolsWithStory() {
      // Open tools panel
      const panel = document.getElementById('toolsPanel');
      panel.classList.add('open');

      // Scroll to story data section
      const storyPanel = document.getElementById('storyDataPanel');
      if (storyPanel) {
        storyPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        storyPanel.classList.add('updating');
        setTimeout(() => storyPanel.classList.remove('updating'), 500);
      }

      // Hide the indicator button since they found it
      document.getElementById('storyIndicatorBtn').classList.remove('pulse');
    }

    function loadStoryIntoCalculator() {
      const story = storyData[currentModule];
      if (!story) {
        alert('No story data available for this module.');
        return;
      }

      const data = currentStoryView === 'before' ? story.before : story.after;
      const tbody = document.getElementById('studyTableBody');

      // Clear existing rows
      tbody.innerHTML = '';

      // Add story studies
      data.studies.forEach(study => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input type="text" value="${study.name}"></td>
          <td><input type="number" step="0.01" value="${study.effect.toFixed(2)}"></td>
          <td><input type="number" step="0.01" value="${study.lo.toFixed(2)}"></td>
          <td><input type="number" step="0.01" value="${study.hi.toFixed(2)}"></td>
          <td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
        `;
        tbody.appendChild(row);
      });

      // Auto-run the analysis
      runMetaAnalysis();

      // Show notification
      const panel = document.getElementById('storyDataPanel');
      panel.classList.add('updating');
      setTimeout(() => panel.classList.remove('updating'), 500);
    }

    // ============================================================
    // STATISTICAL FUNCTIONS
    // ============================================================

    function normalCDF(x) {
      const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741;
      const a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911;
      const sign = x < 0 ? -1 : 1;
      x = Math.abs(x) / Math.sqrt(2);
      const t = 1 / (1 + p * x);
      const y = 1 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
      return 0.5 * (1 + sign * y);
    }

    function tCDF(t, df) {
      if (df <= 0) return 0.5;
      const x = df / (df + t * t);
      const half = 0.5 * incompleteBeta(x, df / 2, 0.5);
      return t >= 0 ? 1 - half : half;
    }

    function incompleteBeta(x, a, b) {
      if (x === 0) return 0;
      if (x === 1) return 1;
      const bt = Math.exp(
        logGamma(a + b) - logGamma(a) - logGamma(b) +
        a * Math.log(x) + b * Math.log(1 - x)
      );
      if (x < (a + 1) / (a + b + 2)) {
        return bt * betaCF(x, a, b) / a;
      }
      return 1 - bt * betaCF(1 - x, b, a) / b;
    }

    function betaCF(x, a, b) {
      const maxIter = 200, eps = 1e-10;
      const qab = a + b, qap = a + 1, qam = a - 1;
      let c = 1, d = 1 - qab * x / qap;
      if (Math.abs(d) < 1e-30) d = 1e-30;
      d = 1 / d;
      let h = d;
      for (let m = 1; m <= maxIter; m++) {
        const m2 = 2 * m;
        let aa = m * (b - m) * x / ((qam + m2) * (a + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < 1e-30) d = 1e-30;
        c = 1 + aa / c;
        if (Math.abs(c) < 1e-30) c = 1e-30;
        d = 1 / d;
        h *= d * c;
        aa = -(a + m) * (qab + m) * x / ((a + m2) * (qap + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < 1e-30) d = 1e-30;
        c = 1 + aa / c;
        if (Math.abs(c) < 1e-30) c = 1e-30;
        d = 1 / d;
        const del = d * c;
        h *= del;
        if (Math.abs(del - 1) < eps) break;
      }
      return h;
    }

    function logGamma(x) {
      const c = [76.18009172947146, -86.50532032941677, 24.01409824083091,
        -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5];
      let y = x, tmp = x + 5.5;
      tmp -= (x + 0.5) * Math.log(tmp);
      let ser = 1.000000000190015;
      for (let j = 0; j < 6; j++) ser += c[j] / ++y;
      return -tmp + Math.log(2.5066282746310005 * ser / x);
    }

    function tQuantile(p, df) {
      if (p <= 0) return -Infinity;
      if (p >= 1) return Infinity;
      if (df <= 0) return NaN;
      let lo = -10, hi = 10;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (tCDF(mid, df) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    function normalQuantile(p) {
      if (p <= 0) return -Infinity;
      if (p >= 1) return Infinity;
      let lo = -10, hi = 10;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (normalCDF(mid) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    function chiSquareCDF(x, df) {
      if (x <= 0) return 0;
      return regularizedGammaP(df / 2, x / 2);
    }

    function regularizedGammaP(a, x) {
      if (x < 0 || a <= 0) return NaN;
      if (x === 0) return 0;
      if (x < a + 1) {
        let sum = 1 / a, term = sum;
        for (let n = 1; n < 100; n++) {
          term *= x / (a + n);
          sum += term;
          if (Math.abs(term) < 1e-10) break;
        }
        return sum * Math.exp(-x + a * Math.log(x) - logGamma(a));
      } else {
        let b = x + 1 - a, c = 1 / 1e-30, d = 1 / b, h = d;
        for (let i = 1; i < 100; i++) {
          const an = -i * (i - a);
          b += 2;
          d = an * d + b;
          if (Math.abs(d) < 1e-30) d = 1e-30;
          c = b + an / c;
          if (Math.abs(c) < 1e-30) c = 1e-30;
          d = 1 / d;
          const del = d * c;
          h *= del;
          if (Math.abs(del - 1) < 1e-10) break;
        }
        return 1 - Math.exp(-x + a * Math.log(x) - logGamma(a)) * h;
      }
    }

    function chiSquareQuantile(p, df) {
      if (p <= 0) return 0;
      if (p >= 1) return Infinity;
      let lo = 0, hi = df * 5 + 50;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (chiSquareCDF(mid, df) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    // ============================================================
    // TAU² ESTIMATORS
    // ============================================================

    function calculateTau2DL(effects, ses) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      const weights = variances.map(v => 1 / v);
      const totalWeight = weights.reduce((a, b) => a + b, 0);
      const meanEffect = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / totalWeight;
      const q = effects.reduce((sum, e, i) => sum + weights[i] * (e - meanEffect) ** 2, 0);
      const c = totalWeight - weights.reduce((sum, w) => sum + w * w, 0) / totalWeight;
      return c > 0 ? Math.max(0, (q - (k - 1)) / c) : 0;
    }

    function calculateTau2REML(effects, ses, maxIter = 100, tol = 1e-6) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < maxIter; iter++) {
        const w = variances.map(v => 1 / (v + tau2));
        const sumW = w.reduce((a, b) => a + b, 0);
        const sumW2 = w.reduce((sum, wi) => sum + wi * wi, 0);
        const mu = effects.reduce((sum, e, i) => sum + e * w[i], 0) / sumW;
        const score = -0.5 * sumW + 0.5 * sumW2 / sumW + 0.5 * effects.reduce((sum, e, i) => sum + w[i] * w[i] * (e - mu) ** 2, 0);
        const info = 0.5 * (sumW2 - w.reduce((sum, wi) => sum + wi * wi * wi, 0) * 2 / sumW + sumW2 * sumW2 / (sumW * sumW));
        const delta = info > 0 ? score / info : 0;
        const newTau2 = Math.max(0, tau2 + delta);
        if (Math.abs(newTau2 - tau2) < tol) return newTau2;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2PM(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      let tau2 = 0.1;
      for (let iter = 0; iter < 100; iter++) {
        const weights = variances.map(v => 1 / (v + tau2));
        const sumW = weights.reduce((a, b) => a + b, 0);
        const meanEffect = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
        const Q = effects.reduce((sum, e, i) => sum + weights[i] * (e - meanEffect) ** 2, 0);
        if (Math.abs(Q - (n - 1)) < 0.0001) break;
        const dQ = -effects.reduce((sum, e, i) => sum + weights[i] * weights[i] * (e - meanEffect) ** 2, 0);
        tau2 = Math.max(0, tau2 - (Q - (n - 1)) / dQ);
      }
      return tau2;
    }

    function calculateTau2SJ(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / n;
      let tau2 = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / (n - 1);
      const weights = variances.map(v => 1 / (v + tau2));
      const sumW = weights.reduce((a, b) => a + b, 0);
      const pooled = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
      tau2 = effects.reduce((sum, e, i) => sum + (e - pooled) ** 2 / (variances[i] + tau2), 0) / (n - 1);
      return Math.max(0, tau2);
    }

    function calculateTau2HE(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / n;
      const S2 = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / (n - 1);
      const avgVar = variances.reduce((a, b) => a + b, 0) / n;
      return Math.max(0, S2 - avgVar);
    }

    function calculateTau2EB(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < 20; iter++) {
        const weights = variances.map(v => 1 / (v + tau2));
        const sumW = weights.reduce((a, b) => a + b, 0);
        const mean = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
        const Q = effects.reduce((sum, e, i) => sum + weights[i] * (e - mean) ** 2, 0);
        const C = sumW - weights.reduce((sum, w) => sum + w * w, 0) / sumW;
        const newTau2 = Math.max(0, (Q - (n - 1)) / C);
        if (Math.abs(newTau2 - tau2) < 1e-8) break;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2ML(effects, ses, maxIter = 100, tol = 1e-6) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < maxIter; iter++) {
        const w = variances.map(v => 1 / (v + tau2));
        const sumW = w.reduce((a, b) => a + b, 0);
        const mu = effects.reduce((sum, e, i) => sum + e * w[i], 0) / sumW;
        const score = 0.5 * effects.reduce((sum, e, i) => sum + w[i] * w[i] * (e - mu) ** 2, 0) -
                      0.5 * w.reduce((sum, wi) => sum + wi, 0);
        const sumW2 = w.reduce((sum, wi) => sum + wi * wi, 0);
        const info = 0.5 * sumW2;
        const delta = info > 0 ? score / info : 0;
        const newTau2 = Math.max(0, tau2 + delta);
        if (Math.abs(newTau2 - tau2) < tol) return newTau2;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2HS(effects, ses) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / k;
      const totalVariance = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / k;
      const avgSamplingVar = variances.reduce((a, b) => a + b, 0) / k;
      return Math.max(0, totalVariance - avgSamplingVar);
    }

    // ============================================================
    // MAIN META-ANALYSIS
    // ============================================================

    function calculateMetaAnalysis(studies, options = {}) {
      const settings = { tau2Estimator: 'DL', useHKSJ: true, confidenceLevel: 0.95, ...options };
      const k = studies.length;
      if (k === 0) return { error: 'No studies provided' };

      const isRatio = studies[0].isRatioMeasure !== false;
      const transformedEffects = studies.map(s => isRatio ? Math.log(s.effect) : s.effect);
      const ses = studies.map(s => {
        if (isRatio) return (Math.log(s.ciHi) - Math.log(s.ciLo)) / Z_95_CI_DIVISOR;
        return (s.ciHi - s.ciLo) / Z_95_CI_DIVISOR;
      });

      const fixedWeights = ses.map(se => 1 / (se * se));
      const totalFixedWeight = fixedWeights.reduce((a, b) => a + b, 0);
      const fixedEffect = transformedEffects.reduce((sum, e, i) => sum + e * fixedWeights[i], 0) / totalFixedWeight;
      const q = transformedEffects.reduce((sum, e, i) => sum + fixedWeights[i] * Math.pow(e - fixedEffect, 2), 0);
      const df = k - 1;
      const qPValue = df > 0 ? 1 - chiSquareCDF(q, df) : 1;
      const i2 = q > df ? Math.max(0, ((q - df) / q) * 100) : 0;
      const h2 = df > 0 ? q / df : 1;

      let tau2, tau2Method;
      const estimator = settings.tau2Estimator || 'DL';
      switch (estimator) {
        case 'REML': tau2 = calculateTau2REML(transformedEffects, ses); tau2Method = 'REML'; break;
        case 'PM': tau2 = calculateTau2PM(transformedEffects, ses); tau2Method = 'PM'; break;
        case 'SJ': tau2 = calculateTau2SJ(transformedEffects, ses); tau2Method = 'SJ'; break;
        case 'HE': tau2 = calculateTau2HE(transformedEffects, ses); tau2Method = 'HE'; break;
        case 'EB': tau2 = calculateTau2EB(transformedEffects, ses); tau2Method = 'EB'; break;
        case 'ML': tau2 = calculateTau2ML(transformedEffects, ses); tau2Method = 'ML'; break;
        case 'HS': tau2 = calculateTau2HS(transformedEffects, ses); tau2Method = 'HS'; break;
        default: tau2 = calculateTau2DL(transformedEffects, ses); tau2Method = 'DL';
      }

      const randomWeights = ses.map(se => 1 / (se * se + tau2));
      const totalRandomWeight = randomWeights.reduce((a, b) => a + b, 0);
      const normalizedWeights = randomWeights.map(w => w / totalRandomWeight);
      const randomEffect = transformedEffects.reduce((sum, e, i) => sum + e * randomWeights[i], 0) / totalRandomWeight;
      let randomSE = Math.sqrt(1 / totalRandomWeight);

      let useHKSJ = settings.useHKSJ && k >= 2;
      let hksjAdjustment = null;
      if (useHKSJ) {
        const qStar = transformedEffects.reduce((sum, e, i) => sum + randomWeights[i] * Math.pow(e - randomEffect, 2), 0);
        const hksjMultiplier = df > 0 ? qStar / df : 1;
        hksjAdjustment = { multiplier: hksjMultiplier, adjustedSE: randomSE * Math.sqrt(Math.max(1, hksjMultiplier)) };
      }

      let pooledCiLo, pooledCiHi, pValue, testMethod;
      if (useHKSJ && hksjAdjustment) {
        const tCrit = tQuantile(1 - (1 - settings.confidenceLevel) / 2, df);
        const effectSE = hksjAdjustment.adjustedSE;
        pooledCiLo = isRatio ? Math.exp(randomEffect - tCrit * effectSE) : randomEffect - tCrit * effectSE;
        pooledCiHi = isRatio ? Math.exp(randomEffect + tCrit * effectSE) : randomEffect + tCrit * effectSE;
        const tStat = randomEffect / effectSE;
        pValue = 2 * (1 - tCDF(Math.abs(tStat), df));
        testMethod = 'HKSJ (t-distribution)';
      } else {
        const zCrit = normalQuantile(1 - (1 - settings.confidenceLevel) / 2);
        pooledCiLo = isRatio ? Math.exp(randomEffect - zCrit * randomSE) : randomEffect - zCrit * randomSE;
        pooledCiHi = isRatio ? Math.exp(randomEffect + zCrit * randomSE) : randomEffect + zCrit * randomSE;
        const z = randomEffect / randomSE;
        pValue = 2 * (1 - normalCDF(Math.abs(z)));
        testMethod = 'Wald (z-distribution)';
      }

      const pooledEffect = isRatio ? Math.exp(randomEffect) : randomEffect;

      const predictionInterval = tau2 > 0 && k >= 3 ? {
        lo: isRatio ? Math.exp(randomEffect - tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)) : randomEffect - tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2),
        hi: isRatio ? Math.exp(randomEffect + tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)) : randomEffect + tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)
      } : null;

      return {
        pooledEffect, pooledCiLo, pooledCiHi, pValue,
        i2, h2, q, qPValue, tau2, tau2Method,
        k, weights: normalizedWeights, isRatio,
        testMethod, hksjAdjustment, predictionInterval,
        transformedEffects, ses, confidenceLevel: settings.confidenceLevel,
        fixedEffect: isRatio ? Math.exp(fixedEffect) : fixedEffect,
        fixedSE: Math.sqrt(1 / totalFixedWeight)
      };
    }

    // ============================================================
    // FOREST PLOT
    // ============================================================

    function generateForestPlotHTML(studies, meta) {
      const allEffects = [...studies.map(s => s.effect), meta.pooledEffect];
      const allLo = [...studies.map(s => s.ciLo), meta.pooledCiLo];
      const allHi = [...studies.map(s => s.ciHi), meta.pooledCiHi];

      const minEffect = Math.min(...allLo, 0.5);
      const maxEffect = Math.max(...allHi, 2.0);
      const range = maxEffect - minEffect;

      const scale = (val) => ((val - minEffect) / range) * 350 + 50;
      const height = (studies.length + 2) * 28 + 40;

      return `
        <svg viewBox="0 0 550 ${height}" style="width: 100%; height: ${height}px; font-family: 'Source Sans Pro', sans-serif;">
          <line x1="${scale(1)}" y1="15" x2="${scale(1)}" y2="${height - 25}" stroke="#ddd" stroke-width="1.5" stroke-dasharray="4" />
          <line x1="50" y1="${height - 25}" x2="400" y2="${height - 25}" stroke="#333" />
          <text x="${scale(0.5)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">0.5</text>
          <text x="${scale(1)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">1.0</text>
          <text x="${scale(1.5)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">1.5</text>
          <text x="${scale(2)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">2.0</text>
          ${studies.map((s, i) => {
            const y = 25 + i * 28;
            const size = Math.max(4, Math.sqrt(meta.weights[i]) * 12);
            return `
              <text x="5" y="${y + 4}" font-size="9" fill="#333">${_escHtml(s.label || 'Study ' + (i+1))}</text>
              <line x1="${scale(s.ciLo)}" y1="${y}" x2="${scale(s.ciHi)}" y2="${y}" stroke="#1E2761" stroke-width="1.5" />
              <rect x="${scale(s.effect) - size/2}" y="${y - size/2}" width="${size}" height="${size}" fill="#1E2761" />
              <text x="420" y="${y + 4}" font-size="8" fill="#333">${s.effect.toFixed(2)} [${s.ciLo.toFixed(2)}, ${s.ciHi.toFixed(2)}]</text>
            `;
          }).join('')}
          <polygon points="
            ${scale(meta.pooledEffect)},${25 + studies.length * 28 - 7}
            ${scale(meta.pooledCiLo)},${25 + studies.length * 28}
            ${scale(meta.pooledEffect)},${25 + studies.length * 28 + 7}
            ${scale(meta.pooledCiHi)},${25 + studies.length * 28}
          " fill="#D4AF37" />
          <text x="5" y="${25 + studies.length * 28 + 4}" font-size="9" font-weight="bold" fill="#333">Pooled</text>
          <text x="420" y="${25 + studies.length * 28 + 4}" font-size="8" font-weight="bold" fill="#333">${meta.pooledEffect.toFixed(2)} [${meta.pooledCiLo.toFixed(2)}, ${meta.pooledCiHi.toFixed(2)}]</text>
          <text x="${scale(0.7)}" y="${height - 2}" font-size="8" fill="#22c55e">Favors Treatment</text>
          <text x="${scale(1.3)}" y="${height - 2}" font-size="8" fill="#C53030">Favors Control</text>
        </svg>
      `;
    }

    // ============================================================
    // MODULE NAVIGATION
    // ============================================================

    const modules = [
      { id: 0, title: 'The Opening', subtitle: 'Why meta-analysis exists', slides: 12 },
      { id: 1, title: 'The Question', subtitle: 'CAST: PICO framework', slides: 20 },
      { id: 2, title: 'The Protocol', subtitle: 'HRT: Pre-specification', slides: 14 },
      { id: 3, title: 'The Search', subtitle: 'Rosiglitazone: Grey literature', slides: 17 },
      { id: 4, title: 'The Screening', subtitle: 'Vioxx: PRISMA', slides: 18 },
      { id: 5, title: 'The Extraction', subtitle: 'DECREASE: Provenance', slides: 18 },
      { id: 6, title: 'The Bias', subtitle: 'Aprotinin: RoB 2.0 + ROBINS-I', slides: 13 },
      { id: 7, title: 'The Synthesis', subtitle: 'Magnesium: Forest plots', slides: 19 },
      { id: 8, title: 'The Heterogeneity', subtitle: 'ACCORD: I², ICEMAN & Meta-regression', slides: 19 },
      { id: 9, title: 'The Hidden Studies', subtitle: 'Reboxetine: Funnel plots', slides: 17 },
      { id: 10, title: 'The Certainty', subtitle: 'Surfactant: GRADE', slides: 18 },
      { id: 11, title: 'The Living Review', subtitle: 'COVID-19: TSA', slides: 16 },
      { id: 12, title: 'Advanced Methods', subtitle: 'NMA, DTA, Dose-response', slides: 16 },
      { id: 13, title: 'The Bayesian Turn', subtitle: 'STAMPEDE: Priors & posteriors', slides: 16 },
      { id: 14, title: 'The Network', subtitle: 'Cipriani 2018: NMA & SUCRA', slides: 16 },
      { id: 15, title: 'The Individual', subtitle: 'EBCTCG: IPD meta-analysis', slides: 14 },
      { id: 16, title: 'The Dose', subtitle: 'Alcohol J-curve: Dose-response', slides: 14 },
      { id: 17, title: 'The Fragility', subtitle: 'Oseltamivir: Robustness', slides: 14 },
      { id: 18, title: 'The Equity', subtitle: 'SPRINT: PROGRESS-Plus', slides: 14 },
      { id: 19, title: 'The Machine', subtitle: 'Cochrane COVID: AI screening', slides: 15 },
      { id: 20, title: 'The Qualitative', subtitle: 'Bohren 2015: Meta-ethnography', slides: 13 },
      { id: 21, title: 'The Multivariate', subtitle: 'Correlated outcomes: RVE', slides: 14 },
      { id: 22, title: 'The Proof', subtitle: 'Reinhart-Rogoff: Reproducibility', slides: 16 },
      { id: 23, title: 'Capstone', subtitle: 'Your First Meta-Sprint', slides: 14 },
      { id: 24, title: 'Final Exam', subtitle: 'Summative assessment', slides: 5 }
    ];

    let currentModule = 0;
    let currentSlide = 0;
    let currentTier = 'foundation'; // foundation | researcher | methodologist

    function setTier(tier) {
      currentTier = tier;
      document.body.classList.remove('tier-foundation', 'tier-researcher', 'tier-methodologist');
      if (tier !== 'foundation') document.body.classList.add('tier-' + tier);
      document.querySelectorAll('.tier-btn').forEach(btn => {
        const isCurrent = btn.dataset.tier === tier;
        btn.classList.toggle('active', isCurrent);
        btn.setAttribute('aria-checked', isCurrent);
      });
      // Recalculate slide count for current module (tier-hidden slides don't count)
      updateSlideNavForTier();
      try { localStorage.setItem('synthesis_course_tier', tier); } catch(e) {}
    }

    function updateSlideNavForTier() {
      // After tier change, if current slide is now hidden, jump to nearest visible slide
      const container = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      if (!container) return;
      const allSlides = container.querySelectorAll('.slide');
      const activeSlide = allSlides[currentSlide];
      if (activeSlide && getComputedStyle(activeSlide).display === 'none') {
        // Find previous visible slide
        for (let i = currentSlide - 1; i >= 0; i--) {
          if (getComputedStyle(allSlides[i]).display !== 'none') {
            goToSlide(i);
            return;
          }
        }
        goToSlide(0);
      }
      updateCounter();
    }

    function getVisibleSlideCount() {
      const container = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      if (!container) return 0;
      let count = 0;
      container.querySelectorAll('.slide').forEach(s => {
        if (getComputedStyle(s).display !== 'none') count++;
      });
      return count;
    }

    function initModuleList() {
      const list = document.getElementById('moduleList');
      list.innerHTML = modules.map(m => `
        <div class="module-item ${m.id === currentModule ? 'active' : ''}" data-module="${m.id}" onclick="goToModule(${m.id})">
          <div class="module-number">${m.id}</div>
          <div class="module-info">
            <div class="module-title">${m.title}</div>
            <div class="module-subtitle">${m.subtitle}</div>
          </div>
        </div>
      `).join('');
    }

    function goToModule(moduleId) {
      // Hide current module
      document.querySelectorAll('.module-slides').forEach(m => m.classList.remove('active'));
      document.querySelectorAll('.module-item').forEach(m => m.classList.remove('active'));

      // Show new module
      currentModule = moduleId;
      currentSlide = 0;
      const moduleEl = document.querySelector(`.module-slides[data-module="${moduleId}"]`);
      if (moduleEl) {
        moduleEl.classList.add('active');
        updateSlideDisplay(moduleEl);
      }
      document.querySelector(`.module-item[data-module="${moduleId}"]`).classList.add('active');

      // Update header
      document.getElementById('currentModuleNum').textContent = moduleId;
      document.getElementById('currentModuleName').textContent = modules[moduleId].title;

      // Update live story data panel
      updateStoryPanel(moduleId);

      // Initialize advanced interactive tools (modules 13-22)
      setTimeout(initAdvancedTools, 100);

      // Show/hide story indicator button
      const storyBtn = document.getElementById('storyIndicatorBtn');
      if (storyData[moduleId]) {
        storyBtn.classList.add('visible');
      } else {
        storyBtn.classList.remove('visible');
      }

      updateProgress();
    }

    function updateSlideDisplay(moduleEl) {
      const slides = moduleEl.querySelectorAll('.slide');
      slides.forEach((s, i) => s.classList.toggle('active', i === currentSlide));

      // Build visible-only progress dots (skip tier-hidden slides)
      const progress = document.getElementById('progress');
      let dots = '';
      let visibleIndex = 0;
      let currentVisibleIndex = 0;
      let visibleTotal = 0;
      for (let i = 0; i < slides.length; i++) {
        if (getComputedStyle(slides[i]).display === 'none') continue;
        if (i === currentSlide) currentVisibleIndex = visibleIndex;
        dots += `<div class="progress-dot ${i === currentSlide ? 'active' : ''}" onclick="goToSlide(${i})" role="button" tabindex="0" aria-label="Go to slide ${visibleIndex + 1}"></div>`;
        visibleIndex++;
        visibleTotal++;
      }
      progress.innerHTML = dots;

      // Update counter with visible-only count
      document.getElementById('counter').textContent = `${currentVisibleIndex + 1} / ${visibleTotal}`;

      // Update buttons — check if there's a visible next/prev
      const hasVisiblePrev = (() => { for (let i = currentSlide - 1; i >= 0; i--) { if (getComputedStyle(slides[i]).display !== 'none') return true; } return false; })();
      const hasVisibleNext = (() => { for (let i = currentSlide + 1; i < slides.length; i++) { if (getComputedStyle(slides[i]).display !== 'none') return true; } return false; })();
      document.getElementById('prevBtn').disabled = !hasVisiblePrev;
      document.getElementById('nextBtn').disabled = !hasVisibleNext;

      // Announce slide change to screen readers
      const announcer = document.getElementById('slideAnnouncer');
      if (announcer) {
        announcer.textContent = `Slide ${currentVisibleIndex + 1} of ${visibleTotal}`;
      }
    }

    function updateCounter() {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      if (moduleEl) updateSlideDisplay(moduleEl);
    }

    function goToSlide(index) {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      if (index >= 0 && index < slides.length) {
        currentSlide = index;
        updateSlideDisplay(moduleEl);
      }
    }

    function nextSlide() {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      // Skip tier-hidden slides
      for (let i = currentSlide + 1; i < slides.length; i++) {
        if (getComputedStyle(slides[i]).display !== 'none') {
          currentSlide = i;
          updateSlideDisplay(moduleEl);
          return;
        }
      }
    }

    function prevSlide() {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      for (let i = currentSlide - 1; i >= 0; i--) {
        if (getComputedStyle(slides[i]).display !== 'none') {
          currentSlide = i;
          updateSlideDisplay(moduleEl);
          return;
        }
      }
    }

    function nextModule() {
      if (currentModule < modules.length - 1) {
        goToModule(currentModule + 1);
      }
    }

    function updateProgress() {
      const percent = Math.round((currentModule / (modules.length - 1)) * 100);
      document.getElementById('progressPercent').textContent = percent + '%';
    }

    // ============================================================
    // TOOLS PANEL
    // ============================================================

    function toggleToolsPanel() {
      const panel = document.getElementById('toolsPanel');
      const contentBody = document.querySelector('.content-body');
      panel.classList.toggle('visible');
      contentBody.classList.toggle('tools-open');
    }

    function toggleSection(header) {
      const body = header.nextElementSibling;
      body.style.display = body.style.display === 'none' ? 'block' : 'none';
      header.querySelector('span').textContent = body.style.display === 'none' ? '▼' : '▲';
    }

    // ============================================================
    // EFFECT SIZE CALCULATOR
    // ============================================================

    function calculateEffectSize() {
      const type = document.getElementById('effectType').value;
      const eventsTx = parseFloat(document.getElementById('eventsTx').value);
      const nTx = parseFloat(document.getElementById('nTx').value);
      const eventsCtrl = parseFloat(document.getElementById('eventsCtrl').value);
      const nCtrl = parseFloat(document.getElementById('nCtrl').value);

      if (isNaN(eventsTx) || isNaN(nTx) || isNaN(eventsCtrl) || isNaN(nCtrl)) {
        alert('Please enter all values');
        return;
      }

      let effect, se, ciLo, ciHi;
      const cc = 0.5; // continuity correction

      if (type === 'OR') {
        const a = eventsTx + cc, b = nTx - eventsTx + cc;
        const c = eventsCtrl + cc, d = nCtrl - eventsCtrl + cc;
        const or = (a * d) / (b * c);
        se = Math.sqrt(1/a + 1/b + 1/c + 1/d);
        effect = or;
        ciLo = Math.exp(Math.log(or) - 1.96 * se);
        ciHi = Math.exp(Math.log(or) + 1.96 * se);
      } else if (type === 'RR') {
        const p1 = (eventsTx + cc) / (nTx + 2*cc);
        const p2 = (eventsCtrl + cc) / (nCtrl + 2*cc);
        const rr = p1 / p2;
        se = Math.sqrt((1 - p1) / (eventsTx + cc) + (1 - p2) / (eventsCtrl + cc));
        effect = rr;
        ciLo = Math.exp(Math.log(rr) - 1.96 * se);
        ciHi = Math.exp(Math.log(rr) + 1.96 * se);
      } else if (type === 'RD') {
        const p1 = eventsTx / nTx, p2 = eventsCtrl / nCtrl;
        effect = p1 - p2;
        se = Math.sqrt(p1 * (1 - p1) / nTx + p2 * (1 - p2) / nCtrl);
        ciLo = effect - 1.96 * se;
        ciHi = effect + 1.96 * se;
      }

      const resultsDiv = document.getElementById('effectResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Effect (${type}):</span><span class="value">${effect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">[${ciLo.toFixed(3)}, ${ciHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">SE${type === 'RD' ? '' : ' (log)'}:</span><span class="value">${se.toFixed(4)}</span></div>
      `;
    }

    // ============================================================
    // META-ANALYSIS CALCULATOR UI
    // ============================================================

    function addStudyRow() {
      const tbody = document.getElementById('studyTableBody');
      const rowCount = tbody.rows.length + 1;
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input type="text" value="Study ${rowCount}"></td>
        <td><input type="number" step="0.01" value="1.00"></td>
        <td><input type="number" step="0.01" value="0.80"></td>
        <td><input type="number" step="0.01" value="1.25"></td>
        <td><button class="btn-small" onclick="removeStudyRow(this)">×</button></td>
      `;
      tbody.appendChild(row);
    }

    function removeStudyRow(btn) {
      const row = btn.closest('tr');
      row.remove();
    }

    function runMetaAnalysis() {
      const rows = document.getElementById('studyTableBody').rows;
      const studies = [];

      for (const row of rows) {
        const inputs = row.querySelectorAll('input');
        const label = inputs[0].value;
        const effect = parseFloat(inputs[1].value);
        const ciLo = parseFloat(inputs[2].value);
        const ciHi = parseFloat(inputs[3].value);

        if (!isNaN(effect) && !isNaN(ciLo) && !isNaN(ciHi)) {
          studies.push({ label, effect, ciLo, ciHi, isRatioMeasure: true });
        }
      }

      if (studies.length < 2) {
        alert('Need at least 2 studies');
        return;
      }

      const tau2Method = document.getElementById('tau2Method').value;
      const useHKSJ = document.getElementById('useHKSJ').checked;

      const result = calculateMetaAnalysis(studies, { tau2Estimator: tau2Method, useHKSJ });

      // Save for publication bias tools
      lastMetaStudies = studies;
      lastMetaResult = result;

      if (result.error) {
        alert(result.error);
        return;
      }

      // Display results
      const resultsDiv = document.getElementById('maResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Pooled Effect:</span><span class="value">${result.pooledEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">[${result.pooledCiLo.toFixed(3)}, ${result.pooledCiHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">p-value:</span><span class="value">${result.pValue < 0.001 ? '< 0.001' : result.pValue.toFixed(4)}</span></div>
        <div class="result-row"><span class="label">I²:</span><span class="value">${result.i2.toFixed(1)}%</span></div>
        <div class="result-row"><span class="label">τ² (${result.tau2Method}):</span><span class="value">${result.tau2.toFixed(4)}</span></div>
        <div class="result-row"><span class="label">Q (p-value):</span><span class="value">${result.q.toFixed(2)} (${result.qPValue.toFixed(4)})</span></div>
        <div class="result-row"><span class="label">Test method:</span><span class="value">${result.testMethod}</span></div>
        ${result.predictionInterval ? `<div class="result-row"><span class="label">95% PI:</span><span class="value">[${result.predictionInterval.lo.toFixed(3)}, ${result.predictionInterval.hi.toFixed(3)}]</span></div>` : ''}
      `;

      // Generate forest plot
      const plotContainer = document.getElementById('forestPlotContainer');
      plotContainer.style.display = 'block';
      plotContainer.innerHTML = generateForestPlotHTML(studies, result);
    }

    // ============================================================
    // PICO BUILDER
    // ============================================================

    function _escHtml(s) {
      const d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }

    function generatePICO() {
      const p = _escHtml(document.getElementById('picoP').value);
      const i = _escHtml(document.getElementById('picoI').value);
      const c = _escHtml(document.getElementById('picoC').value);
      const o = _escHtml(document.getElementById('picoO').value);

      if (!p || !i || !o) {
        alert('Please fill Population, Intervention, and Outcome');
        return;
      }

      const question = `In ${p}, does ${i} compared to ${c || 'standard care'} improve ${o}?`;

      const output = document.getElementById('picoOutput');
      output.style.display = 'block';
      output.innerHTML = `
        <strong>Research Question:</strong><br>
        <em>${question}</em>
      `;
    }

    // ============================================================
    // KEYBOARD NAVIGATION — see enhanced handler below (near toggleKeyboardHelp)
    // ============================================================

    // ============================================================
    // PUBLICATION BIAS
    // ============================================================

    let lastMetaStudies = null;
    let lastMetaResult = null;

    // runMetaAnalysis now saves lastMetaStudies/lastMetaResult directly (merged from override)

    function calculateEggersTest(effects, ses) {
      const n = effects.length;
      if (n < 3) return { intercept: NaN, pValue: NaN, significant: false };
      const precision = ses.map(se => 1 / se);
      const standardizedEffects = effects.map((e, i) => e / ses[i]);
      const meanX = precision.reduce((a, b) => a + b, 0) / n;
      const meanY = standardizedEffects.reduce((a, b) => a + b, 0) / n;
      let ssXY = 0, ssXX = 0;
      for (let i = 0; i < n; i++) {
        ssXY += (precision[i] - meanX) * (standardizedEffects[i] - meanY);
        ssXX += (precision[i] - meanX) ** 2;
      }
      const slope = ssXX > 0 ? ssXY / ssXX : 0;
      const intercept = meanY - slope * meanX;
      let ssResid = 0;
      for (let i = 0; i < n; i++) {
        const predicted = intercept + slope * precision[i];
        ssResid += (standardizedEffects[i] - predicted) ** 2;
      }
      const residSE = Math.sqrt(ssResid / (n - 2));
      const interceptSE = residSE * Math.sqrt(1/n + meanX * meanX / ssXX);
      const tStat = intercept / interceptSE;
      const pValue = 2 * (1 - tCDF(Math.abs(tStat), n - 2));
      return { intercept, slope, tStat, pValue, significant: pValue < 0.1 };
    }

    function calculateBeggsTest(effects, ses) {
      const n = effects.length;
      if (n < 3) return { tau: NaN, pValue: NaN };
      const indices = effects.map((_, i) => i);
      const variances = ses.map(se => se * se);
      indices.sort((a, b) => variances[a] - variances[b]);
      const sortedEffects = indices.map(i => effects[i]);
      let concordant = 0, discordant = 0;
      for (let i = 0; i < n - 1; i++) {
        for (let j = i + 1; j < n; j++) {
          if (sortedEffects[j] > sortedEffects[i]) concordant++;
          else if (sortedEffects[j] < sortedEffects[i]) discordant++;
        }
      }
      const tau = (concordant - discordant) / (n * (n - 1) / 2);
      const se = Math.sqrt((2 * (2 * n + 5)) / (9 * n * (n - 1)));
      const z = tau / se;
      const pValue = 2 * (1 - normalCDF(Math.abs(z)));
      return { tau, z, pValue, significant: pValue < 0.1 };
    }

    function generateFunnelPlotHTML(effects, ses, pooledEffect) {
      const minEffect = Math.min(...effects) - 0.5;
      const maxEffect = Math.max(...effects) + 0.5;
      const maxSE = Math.max(...ses);
      const range = maxEffect - minEffect;

      const scaleX = (val) => ((val - minEffect) / range) * 300 + 25;
      const scaleY = (se) => (se / maxSE) * 180 + 20;

      const pooledX = scaleX(pooledEffect);

      return `
        <svg viewBox="0 0 350 220" style="width: 100%; height: 220px; font-family: 'Source Sans Pro', sans-serif;">
          <!-- Funnel shape -->
          <polygon points="${pooledX},20 ${scaleX(pooledEffect - 1.96 * maxSE)},200 ${scaleX(pooledEffect + 1.96 * maxSE)},200"
                   fill="rgba(30,39,97,0.1)" stroke="none"/>

          <!-- Axes -->
          <line x1="25" y1="200" x2="325" y2="200" stroke="#333" />
          <line x1="25" y1="20" x2="25" y2="200" stroke="#333" />

          <!-- Pooled effect line -->
          <line x1="${pooledX}" y1="20" x2="${pooledX}" y2="200" stroke="#D4AF37" stroke-width="2" stroke-dasharray="4" />

          <!-- Points -->
          ${effects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(ses[i])}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>
          `).join('')}

          <!-- Labels -->
          <text x="175" y="218" font-size="10" text-anchor="middle" fill="#666">Effect Size (log scale)</text>
          <text x="12" y="110" font-size="10" text-anchor="middle" fill="#666" transform="rotate(-90, 12, 110)">Standard Error</text>
          <text x="${pooledX}" y="15" font-size="8" text-anchor="middle" fill="#D4AF37">Pooled</text>
        </svg>
      `;
    }

    function runPublicationBias() {
      if (!lastMetaResult || !lastMetaStudies || lastMetaStudies.length < 3) {
        alert('Run meta-analysis first with at least 3 studies');
        return;
      }

      const effects = lastMetaResult.transformedEffects;
      const ses = lastMetaResult.ses;

      const egger = calculateEggersTest(effects, ses);
      const begg = calculateBeggsTest(effects, ses);

      document.getElementById('pubBiasResults').style.display = 'block';
      document.getElementById('eggerResults').innerHTML = `
        <div class="result-row"><span class="label">Egger's intercept:</span><span class="value">${egger.intercept.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Egger's p-value:</span><span class="value ${egger.significant ? 'red' : ''}">${egger.pValue.toFixed(4)} ${egger.significant ? '(Significant)' : ''}</span></div>
        <div class="result-row"><span class="label">Begg's tau:</span><span class="value">${begg.tau.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Begg's p-value:</span><span class="value ${begg.significant ? 'red' : ''}">${begg.pValue.toFixed(4)} ${begg.significant ? '(Significant)' : ''}</span></div>
        <div class="result-row"><span class="label">Interpretation:</span><span class="value">${egger.significant || begg.significant ? 'Possible small-study effects (publication bias is one explanation)' : 'No strong statistical evidence of asymmetry'}</span></div>
      `;

      const pooledLog = Math.log(lastMetaResult.pooledEffect);
      document.getElementById('funnelPlotContainer').innerHTML = generateFunnelPlotHTML(effects, ses, pooledLog);
    }

    // ============================================================
    // RISK OF BIAS 2.0
    // ============================================================

    function updateRoBOverall() {
      const domains = ['robD1', 'robD2', 'robD3', 'robD4', 'robD5'];
      const values = domains.map(id => document.getElementById(id).value);

      if (values.some(v => !v)) {
        document.getElementById('robOverall').innerHTML = '<span style="color: var(--light-text);">Complete all domains</span>';
        document.getElementById('robTrafficLight').innerHTML = '';
        return;
      }

      let overall;
      if (values.includes('high')) {
        overall = 'high';
      } else if (values.includes('some')) {
        overall = 'some';
      } else {
        overall = 'low';
      }

      const colors = { low: '#22c55e', some: '#f59e0b', high: '#C53030' };
      const labels = { low: 'Low Risk of Bias', some: 'Some Concerns', high: 'High Risk of Bias' };

      document.getElementById('robOverall').innerHTML = `
        <span style="color: ${colors[overall]};">${labels[overall]}</span>
      `;
      document.getElementById('robOverall').style.background = overall === 'low' ? 'rgba(34,197,94,0.1)' :
                                                                overall === 'some' ? 'rgba(245,158,11,0.1)' : 'rgba(197,48,48,0.1)';

      // Traffic light
      document.getElementById('robTrafficLight').innerHTML = `
        <div style="display: flex; gap: 0.25rem; justify-content: center; margin-top: 0.5rem;">
          ${domains.map((id, i) => {
            const val = values[i];
            return `<div style="width: 20px; height: 20px; border-radius: 50%; background: ${colors[val]};" title="D${i+1}: ${val}"></div>`;
          }).join('')}
        </div>
      `;
    }

    // ============================================================
    // GRADE ASSESSMENT
    // ============================================================

    function calculateGRADE() {
      const start = parseInt(document.getElementById('gradeStart').value);
      const rob = parseInt(document.getElementById('gradeRoB').value);
      const inconsistency = parseInt(document.getElementById('gradeInconsistency').value);
      const indirectness = parseInt(document.getElementById('gradeIndirectness').value);
      const imprecision = parseInt(document.getElementById('gradeImprecision').value);
      const pubBias = parseInt(document.getElementById('gradePubBias').value);

      const total = start + rob + inconsistency + indirectness + imprecision + pubBias;
      const finalScore = Math.max(1, Math.min(4, total));

      const levels = {
        4: { label: 'HIGH', color: '#22c55e', symbol: '⊕⊕⊕⊕', desc: 'Very confident the true effect is close to the estimate' },
        3: { label: 'MODERATE', color: '#3b82f6', symbol: '⊕⊕⊕○', desc: 'Moderately confident; true effect likely close to estimate' },
        2: { label: 'LOW', color: '#f59e0b', symbol: '⊕⊕○○', desc: 'Limited confidence; true effect may be substantially different' },
        1: { label: 'VERY LOW', color: '#C53030', symbol: '⊕○○○', desc: 'Very little confidence in the effect estimate' }
      };

      const level = levels[finalScore];

      document.getElementById('gradeResult').innerHTML = `
        <div style="text-align: center; padding: 1rem; background: rgba(${finalScore === 4 ? '34,197,94' : finalScore === 3 ? '59,130,246' : finalScore === 2 ? '245,158,11' : '197,48,48'},0.1); border-radius: 8px;">
          <div style="font-size: 1.5rem; letter-spacing: 0.2rem; color: ${level.color};">${level.symbol}</div>
          <div style="font-size: 1.1rem; font-weight: 700; color: ${level.color}; margin: 0.5rem 0;">${level.label}</div>
          <div style="font-size: 0.75rem; color: var(--light-text);">${level.desc}</div>
        </div>
        <div style="margin-top: 0.75rem; font-size: 0.75rem; color: var(--light-text);">
          Starting: ${start === 4 ? 'High (RCTs)' : 'Low (Observational)'}<br>
          Downgrades: ${Math.abs(rob + inconsistency + indirectness + imprecision + pubBias)} levels
        </div>
      `;
    }

    // ============================================================
    // HETEROGENEITY INTERPRETATION
    // ============================================================

    function interpretI2() {
      const i2 = parseFloat(document.getElementById('i2Input').value);

      if (isNaN(i2) || i2 < 0 || i2 > 100) {
        alert('Enter a valid I² value between 0 and 100');
        return;
      }

      let interpretation, color, recommendation;

      if (i2 <= 25) {
        interpretation = 'Low heterogeneity';
        color = '#22c55e';
        recommendation = 'Fixed-effect model may be appropriate. Results are consistent across studies.';
      } else if (i2 <= 50) {
        interpretation = 'Moderate heterogeneity';
        color = '#3b82f6';
        recommendation = 'Consider random-effects model. Investigate potential sources of variation.';
      } else if (i2 <= 75) {
        interpretation = 'Substantial heterogeneity';
        color = '#f59e0b';
        recommendation = 'Use random-effects model. Subgroup analysis or meta-regression recommended. Consider whether pooling is appropriate.';
      } else {
        interpretation = 'Considerable heterogeneity';
        color = '#C53030';
        recommendation = 'Pooling may be inappropriate. Focus on understanding sources of heterogeneity before synthesizing. Report prediction interval.';
      }

      document.getElementById('i2Interpretation').innerHTML = `
        <div style="padding: 0.75rem; background: rgba(${i2 <= 25 ? '34,197,94' : i2 <= 50 ? '59,130,246' : i2 <= 75 ? '245,158,11' : '197,48,48'},0.1); border-radius: 6px; border-left: 3px solid ${color};">
          <div style="font-weight: 700; color: ${color}; margin-bottom: 0.25rem;">I² = ${i2}%: ${interpretation}</div>
          <div style="font-size: 0.8rem; color: var(--text);">${recommendation}</div>
        </div>
      `;
    }

    // ============================================================
    // NNT/NNH CALCULATOR
    // ============================================================

    function calculateNNT() {
      const cer = parseFloat(document.getElementById('nntCER').value);
      const effectType = document.getElementById('nntEffectType').value;
      const effect = parseFloat(document.getElementById('nntEffect').value);
      const ciLo = parseFloat(document.getElementById('nntCILo').value);
      const ciHi = parseFloat(document.getElementById('nntCIHi').value);

      if (isNaN(cer) || isNaN(effect) || cer <= 0 || cer >= 1) {
        alert('Enter valid baseline risk (0 < CER < 1) and effect size');
        return;
      }

      let arr, arrLo, arrHi; // Absolute Risk Reduction

      if (effectType === 'RD') {
        arr = -effect; // RD is already absolute
        arrLo = -ciHi;
        arrHi = -ciLo;
      } else if (effectType === 'RR') {
        const eer = cer * effect;
        const eerLo = cer * ciLo;
        const eerHi = cer * ciHi;
        arr = cer - eer;
        arrLo = cer - eerHi;
        arrHi = cer - eerLo;
      } else { // OR
        const eer = (cer * effect) / (1 - cer + cer * effect);
        const eerLo = (cer * ciLo) / (1 - cer + cer * ciLo);
        const eerHi = (cer * ciHi) / (1 - cer + cer * ciHi);
        arr = cer - eer;
        arrLo = cer - eerHi;
        arrHi = cer - eerLo;
      }

      const nnt = arr !== 0 ? 1 / arr : Infinity;
      const nntLo = arrHi !== 0 ? 1 / arrHi : Infinity;
      const nntHi = arrLo !== 0 ? 1 / arrLo : Infinity;
      const ciCrossesNull = arrLo * arrHi < 0;

      const isBenefit = arr > 0;
      const label = isBenefit ? 'NNT (Benefit)' : 'NNH (Harm)';
      const color = isBenefit ? 'var(--green)' : 'var(--red)';

      let nntCiText;
      if (ciCrossesNull) {
        // Altman (1998) convention: NNTB X to ∞ to NNTH Y
        const nntB = arrHi > 0 ? Math.abs(1 / arrHi).toFixed(1) : Math.abs(1 / arrLo).toFixed(1);
        const nntH = arrLo < 0 ? Math.abs(1 / arrLo).toFixed(1) : Math.abs(1 / arrHi).toFixed(1);
        nntCiText = `NNTB ${nntB} to \u221E to NNTH ${nntH}`;
      } else {
        nntCiText = `[${Math.abs(nntLo).toFixed(1)}, ${Math.abs(nntHi).toFixed(1)}]`;
      }

      const resultsDiv = document.getElementById('nntResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Baseline Risk (CER):</span><span class="value">${(cer * 100).toFixed(1)}%</span></div>
        <div class="result-row"><span class="label">Absolute Risk Reduction:</span><span class="value">${(arr * 100).toFixed(2)}%</span></div>
        <div class="result-row"><span class="label" style="color: ${color}; font-weight: 700;">${label}:</span><span class="value" style="color: ${color}; font-weight: 700;">${Math.abs(nnt).toFixed(1)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">${nntCiText}</span></div>
        ${ciCrossesNull ? '<div style="margin-top: 0.5rem; padding: 0.4rem; background: rgba(234,179,8,0.15); border-radius: 4px; font-size: 0.7rem; color: var(--text);">CI crosses the null \u2014 effect may be beneficial or harmful</div>' : ''}
        <div style="margin-top: 0.75rem; padding: 0.5rem; background: rgba(${isBenefit ? '34,197,94' : '197,48,48'},0.1); border-radius: 4px; font-size: 0.75rem;">
          ${isBenefit
            ? `Treat <strong>${Math.ceil(Math.abs(nnt))}</strong> patients to prevent 1 event`
            : `Treat <strong>${Math.ceil(Math.abs(nnt))}</strong> patients before causing 1 harm`}
        </div>
      `;
    }

    // ============================================================
    // LEAVE-ONE-OUT SENSITIVITY ANALYSIS
    // ============================================================

    function runLeaveOneOut() {
      if (!lastMetaStudies || lastMetaStudies.length < 3) {
        alert('Run meta-analysis first with at least 3 studies');
        return;
      }

      const tau2Method = document.getElementById('tau2Method').value;
      const useHKSJ = document.getElementById('useHKSJ').checked;
      const results = [];

      // Run meta-analysis leaving out each study
      for (let i = 0; i < lastMetaStudies.length; i++) {
        const subset = lastMetaStudies.filter((_, idx) => idx !== i);
        const ma = calculateMetaAnalysis(subset, { tau2Estimator: tau2Method, useHKSJ });
        results.push({
          omitted: lastMetaStudies[i].label,
          effect: ma.pooledEffect,
          ciLo: ma.pooledCiLo,
          ciHi: ma.pooledCiHi,
          i2: ma.i2,
          pValue: ma.pValue
        });
      }

      // Find most influential study
      const originalEffect = lastMetaResult.pooledEffect;
      let maxChange = 0;
      let mostInfluential = '';
      results.forEach(r => {
        const change = (lastMetaResult.isRatio !== false && r.effect > 0 && originalEffect > 0)
          ? Math.abs(Math.log(r.effect) - Math.log(originalEffect))
          : Math.abs(r.effect - originalEffect);
        if (change > maxChange) {
          maxChange = change;
          mostInfluential = r.omitted;
        }
      });

      // Check if any exclusion changes significance
      const originalSig = lastMetaResult.pValue < 0.05;
      const sensitivityIssue = results.some(r => (r.pValue < 0.05) !== originalSig);

      document.getElementById('looResults').style.display = 'block';
      document.getElementById('looSummary').innerHTML = `
        <div class="result-row"><span class="label">Original pooled effect:</span><span class="value">${originalEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Most influential study:</span><span class="value">${_escHtml(mostInfluential)}</span></div>
        <div class="result-row"><span class="label">Sensitivity concern:</span><span class="value ${sensitivityIssue ? 'red' : ''}">${sensitivityIssue ? 'Yes - significance changes' : 'No - results robust'}</span></div>
        <div style="margin-top: 0.5rem; font-size: 0.7rem; color: var(--light-text);">
          ${results.map(r => `Omit ${_escHtml(r.omitted)}: ${r.effect.toFixed(3)} [${r.ciLo.toFixed(3)}, ${r.ciHi.toFixed(3)}] I²=${r.i2.toFixed(0)}%`).join('<br>')}
        </div>
      `;

      // Generate LOO forest plot
      document.getElementById('looPlotContainer').innerHTML = generateLOOPlotHTML(results, lastMetaResult);
    }

    function generateLOOPlotHTML(looResults, originalMeta) {
      const allEffects = [...looResults.map(r => r.effect), originalMeta.pooledEffect];
      const allLo = [...looResults.map(r => r.ciLo), originalMeta.pooledCiLo];
      const allHi = [...looResults.map(r => r.ciHi), originalMeta.pooledCiHi];

      const minEffect = Math.min(...allLo, 0.5);
      const maxEffect = Math.max(...allHi, 2.0);
      const range = maxEffect - minEffect;

      const scale = (val) => ((val - minEffect) / range) * 280 + 80;
      const height = (looResults.length + 2) * 22 + 30;

      return `
        <svg viewBox="0 0 500 ${height}" style="width: 100%; height: ${height}px; font-family: 'Source Sans Pro', sans-serif;">
          <line x1="${scale(1)}" y1="10" x2="${scale(1)}" y2="${height - 20}" stroke="#ddd" stroke-width="1" stroke-dasharray="3" />
          <text x="40" y="15" font-size="8" fill="#666" font-weight="600">Omitting:</text>
          ${looResults.map((r, i) => {
            const y = 25 + i * 22;
            return `
              <text x="5" y="${y + 3}" font-size="8" fill="#333">${_escHtml(r.omitted)}</text>
              <line x1="${scale(r.ciLo)}" y1="${y}" x2="${scale(r.ciHi)}" y2="${y}" stroke="#1E2761" stroke-width="1" />
              <circle cx="${scale(r.effect)}" cy="${y}" r="4" fill="#1E2761" />
              <text x="380" y="${y + 3}" font-size="7" fill="#333">${r.effect.toFixed(2)} [${r.ciLo.toFixed(2)}, ${r.ciHi.toFixed(2)}]</text>
            `;
          }).join('')}
          <line x1="${scale(originalMeta.pooledCiLo)}" y1="${height - 25}" x2="${scale(originalMeta.pooledCiHi)}" y2="${height - 25}" stroke="#D4AF37" stroke-width="2" />
          <polygon points="${scale(originalMeta.pooledEffect)},${height - 30} ${scale(originalMeta.pooledEffect) - 5},${height - 25} ${scale(originalMeta.pooledEffect)},${height - 20} ${scale(originalMeta.pooledEffect) + 5},${height - 25}" fill="#D4AF37" />
          <text x="5" y="${height - 22}" font-size="8" font-weight="bold" fill="#D4AF37">All studies</text>
          <text x="380" y="${height - 22}" font-size="7" font-weight="bold" fill="#333">${originalMeta.pooledEffect.toFixed(2)} [${originalMeta.pooledCiLo.toFixed(2)}, ${originalMeta.pooledCiHi.toFixed(2)}]</text>
        </svg>
      `;
    }

    // ============================================================
    // TRIM-AND-FILL
    // ============================================================

    function runTrimAndFill() {
      if (!lastMetaResult || !lastMetaStudies || lastMetaStudies.length < 3) {
        alert('Run meta-analysis first with at least 3 studies');
        return;
      }

      const estimator = document.getElementById('trimFillEstimator').value;
      const side = document.getElementById('trimFillSide').value;

      const effects = [...lastMetaResult.transformedEffects];
      const ses = [...lastMetaResult.ses];
      const k = effects.length;

      // Get initial pooled estimate
      const weights = ses.map(se => 1 / (se * se));
      const sumW = weights.reduce((a, b) => a + b, 0);
      let theta = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;

      // Calculate ranks of |yi - theta| for each study
      const deviations = effects.map((e, i) => ({
        idx: i,
        dev: e - theta,
        absDev: Math.abs(e - theta),
        se: ses[i]
      }));

      // Sort by absolute deviation
      deviations.sort((a, b) => a.absDev - b.absDev);
      const ranks = deviations.map((d, i) => ({ ...d, rank: i + 1 }));

      // Count studies on the specified side
      let n0;
      if (estimator === 'L0') {
        // Linear estimator
        const T = ranks.reduce((sum, r) => {
          const onSide = (side === 'right' && r.dev > 0) || (side === 'left' && r.dev < 0);
          return sum + (onSide ? r.rank : 0);
        }, 0);
        n0 = Math.max(0, Math.round((4 * T - k * (k + 1)) / (2 * k - 1)));
      } else {
        // R0 rank-based estimator
        const gamma = ranks.reduce((sum, r) => {
          const onSide = (side === 'right' && r.dev > 0) || (side === 'left' && r.dev < 0);
          return sum + (onSide ? 1 : 0);
        }, 0);
        n0 = Math.max(0, Math.round((4 * gamma - k + 1) / 3));
      }

      const nFilled = Math.round(n0);

      // Impute missing studies by reflecting the most extreme ones
      const sortedBySide = [...ranks].sort((a, b) => {
        if (side === 'right') return b.dev - a.dev;
        return a.dev - b.dev;
      });

      const imputedEffects = [...effects];
      const imputedSEs = [...ses];
      const imputedLabels = lastMetaStudies.map(s => s.label);

      for (let i = 0; i < nFilled && i < sortedBySide.length; i++) {
        const study = sortedBySide[i];
        const mirroredEffect = 2 * theta - study.dev - theta; // = -study.dev relative to theta
        imputedEffects.push(2 * theta - effects[study.idx]);
        imputedSEs.push(ses[study.idx]);
        imputedLabels.push(`[Imputed ${i + 1}]`);
      }

      // Recalculate pooled effect with imputed studies
      const newWeights = imputedSEs.map(se => 1 / (se * se));
      const newSumW = newWeights.reduce((a, b) => a + b, 0);
      const adjustedTheta = imputedEffects.reduce((sum, e, i) => sum + e * newWeights[i], 0) / newSumW;
      const adjustedSE = Math.sqrt(1 / newSumW);

      const isRatio = lastMetaResult.isRatio;
      const tfZCrit = normalQuantile(1 - (1 - (lastMetaResult.confidenceLevel || 0.95)) / 2);
      const adjustedEffect = isRatio ? Math.exp(adjustedTheta) : adjustedTheta;
      const adjustedCILo = isRatio ? Math.exp(adjustedTheta - tfZCrit * adjustedSE) : adjustedTheta - tfZCrit * adjustedSE;
      const adjustedCIHi = isRatio ? Math.exp(adjustedTheta + tfZCrit * adjustedSE) : adjustedTheta + tfZCrit * adjustedSE;

      const originalEffect = lastMetaResult.pooledEffect;
      const changePercent = ((adjustedEffect - originalEffect) / originalEffect * 100).toFixed(1);

      document.getElementById('trimFillResults').style.display = 'block';
      document.getElementById('trimFillSummary').innerHTML = `
        <div class="result-row"><span class="label">Studies imputed:</span><span class="value">${nFilled}</span></div>
        <div class="result-row"><span class="label">Original effect:</span><span class="value">${originalEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Adjusted effect:</span><span class="value ${nFilled > 0 ? 'red' : ''}">${adjustedEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Adjusted ${Math.round((lastMetaResult.confidenceLevel || 0.95) * 100)}% CI:</span><span class="value">[${adjustedCILo.toFixed(3)}, ${adjustedCIHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">Change:</span><span class="value">${changePercent}%</span></div>
        ${nFilled > 0 ? `
          <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(197,48,48,0.1); border-radius: 4px; font-size: 0.75rem;">
            <strong>Caution:</strong> ${nFilled} potentially missing studies imputed.
            Treat this as sensitivity analysis, not correction; assumptions may not hold under severe asymmetry.
          </div>
        ` : `
          <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(34,197,94,0.1); border-radius: 4px; font-size: 0.75rem;">
            No missing studies detected on the ${side} side.
          </div>
        `}
      `;

      // Generate filled funnel plot
      document.getElementById('trimFillPlotContainer').innerHTML = generateFilledFunnelHTML(
        lastMetaResult.transformedEffects,
        lastMetaResult.ses,
        imputedEffects.slice(k),
        imputedSEs.slice(k),
        adjustedTheta,
        Math.log(originalEffect)
      );
    }

    function generateFilledFunnelHTML(origEffects, origSEs, impEffects, impSEs, adjustedTheta, originalTheta) {
      const allEffects = [...origEffects, ...impEffects];
      const allSEs = [...origSEs, ...impSEs];

      const minEffect = Math.min(...allEffects) - 0.5;
      const maxEffect = Math.max(...allEffects) + 0.5;
      const maxSE = Math.max(...allSEs);
      const range = maxEffect - minEffect;

      const scaleX = (val) => ((val - minEffect) / range) * 280 + 35;
      const scaleY = (se) => (se / maxSE) * 160 + 20;

      return `
        <svg viewBox="0 0 350 200" style="width: 100%; height: 200px; font-family: 'Source Sans Pro', sans-serif;">
          <!-- Original funnel -->
          <polygon points="${scaleX(originalTheta)},20 ${scaleX(originalTheta - 1.96 * maxSE)},180 ${scaleX(originalTheta + 1.96 * maxSE)},180"
                   fill="rgba(30,39,97,0.05)" stroke="rgba(30,39,97,0.3)" stroke-dasharray="3"/>
          <!-- Adjusted funnel -->
          <polygon points="${scaleX(adjustedTheta)},20 ${scaleX(adjustedTheta - 1.96 * maxSE)},180 ${scaleX(adjustedTheta + 1.96 * maxSE)},180"
                   fill="rgba(212,175,55,0.1)" stroke="#D4AF37"/>

          <!-- Original effect line -->
          <line x1="${scaleX(originalTheta)}" y1="20" x2="${scaleX(originalTheta)}" y2="180" stroke="#1E2761" stroke-width="1" stroke-dasharray="4" />
          <!-- Adjusted effect line -->
          <line x1="${scaleX(adjustedTheta)}" y1="20" x2="${scaleX(adjustedTheta)}" y2="180" stroke="#D4AF37" stroke-width="2" />

          <!-- Original studies -->
          ${origEffects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(origSEs[i])}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>
          `).join('')}

          <!-- Imputed studies -->
          ${impEffects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(impSEs[i])}" r="5" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="2"/>
          `).join('')}

          <!-- Legend -->
          <circle cx="280" cy="15" r="4" fill="#1E2761"/>
          <text x="290" y="18" font-size="7" fill="#666">Original</text>
          <circle cx="280" cy="28" r="4" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="2"/>
          <text x="290" y="31" font-size="7" fill="#666">Imputed</text>

          <text x="175" y="198" font-size="9" text-anchor="middle" fill="#666">Effect Size (log scale)</text>
        </svg>
      `;
    }

    // ============================================================
    // GAMIFICATION & PROGRESS SYSTEM
    // ============================================================

    const STORAGE_KEY = 'evidence_reversal_course_progress';

    // Seven Principles for tracking
    const sevenPrinciples = [
      "Not every signal is truth.",
      "Methods protect patients from our confidence.",
      "What was hidden in plain sight?",
      "The number without provenance is not a number.",
      "Heterogeneity is a message, not noise.",
      "Absence of evidence is not evidence of absence.",
      "Certainty must be earned, not assumed."
    ];

    // Badge definitions
    const badges = [
      { id: 'first_module', icon: '🎯', name: 'First Steps', desc: 'Complete your first module' },
      { id: 'predictor', icon: '🔮', name: 'Predictor', desc: 'Make your first prediction' },
      { id: 'correct_prediction', icon: '✨', name: 'Sharp Mind', desc: 'Predict correctly' },
      { id: 'five_modules', icon: '📚', name: 'Scholar', desc: 'Complete 5 modules' },
      { id: 'all_predictions', icon: '🎱', name: 'Oracle', desc: 'Make all predictions' },
      { id: 'streak_3', icon: '🔥', name: 'On Fire', desc: '3-day streak' },
      { id: 'quiz_master', icon: '🏆', name: 'Quiz Master', desc: 'Complete 5 quizzes' },
      { id: 'ready_practice', icon: '🚀', name: 'Ready for Practice', desc: 'Complete the Capstone module' },
      { id: 'completionist', icon: '👑', name: 'Completionist', desc: 'Finish all modules' }
    ];

    // Level definitions
    const levels = [
      { name: 'Novice', minPoints: 0 },
      { name: 'Apprentice', minPoints: 200 },
      { name: 'Practitioner', minPoints: 500 },
      { name: 'Expert', minPoints: 1000 },
      { name: 'Master', minPoints: 2000 }
    ];

    // Gamification state
    let gameState = {
      points: 0,
      earnedBadges: [],
      streak: 0,
      lastVisitDate: null,
      principlesMastered: [],
      quizzesCompleted: 0
    };

    function getLevel(points) {
      for (let i = levels.length - 1; i >= 0; i--) {
        if (points >= levels[i].minPoints) return { level: i + 1, name: levels[i].name };
      }
      return { level: 1, name: 'Novice' };
    }

    function awardPoints(amount, reason) {
      gameState.points += amount;
      updateSidebarPoints();
      saveProgress();
    }

    function earnBadge(badgeId) {
      if (!gameState.earnedBadges.includes(badgeId)) {
        gameState.earnedBadges.push(badgeId);
        saveProgress();
      }
    }

    function checkBadges() {
      const completedModules = document.querySelectorAll('.module-item.completed').length;
      const predictionCount = Object.keys(storyPredictions).length;
      const correctPredictions = Object.values(storyPredictions).filter(p => p.correct).length;

      if (completedModules >= 1) earnBadge('first_module');
      if (completedModules >= 5) earnBadge('five_modules');
      if (completedModules >= 23) earnBadge('ready_practice');
      if (completedModules >= 15) earnBadge('completionist');
      if (predictionCount >= 1) earnBadge('predictor');
      if (correctPredictions >= 1) earnBadge('correct_prediction');
      if (predictionCount >= 11) earnBadge('all_predictions');
      if (gameState.streak >= 3) earnBadge('streak_3');
      if (gameState.quizzesCompleted >= 5) earnBadge('quiz_master');
    }

    function updateStreak() {
      const today = new Date().toDateString();
      if (gameState.lastVisitDate) {
        const lastVisit = new Date(gameState.lastVisitDate).toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        if (lastVisit === today) { /* Same day */ }
        else if (lastVisit === yesterday) { gameState.streak++; awardPoints(10, 'Daily streak'); }
        else { gameState.streak = 1; }
      } else { gameState.streak = 1; }
      gameState.lastVisitDate = new Date().toISOString();
    }

    function saveProgress() {
      const completedModules = [];
      document.querySelectorAll('.module-item.completed').forEach(el => {
        completedModules.push(parseInt(el.dataset.module));
      });

      const progress = {
        currentModule, currentSlide, completedModules,
        lastVisit: new Date().toISOString(),
        gameState: gameState,
        predictions: storyPredictions,
        spacedRepetition: spacedRepetitionState,
        scenarioState: scenarioState,
        calibrationState: calibrationState
      };

      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        updateSidebarPoints();
      } catch (e) { console.log('Could not save progress'); }
    }

    function loadProgress() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          const progress = JSON.parse(saved);
          // Migrate old module IDs: 13→23, 14→24 (one-time)
          if (!progress._migrated25) {
            const remap = {13: 23, 14: 24};
            progress.completedModules = progress.completedModules.map(id => remap[id] || id);
            if (remap[progress.currentModule]) progress.currentModule = remap[progress.currentModule];
            progress._migrated25 = true;
            try { localStorage.setItem(STORAGE_KEY, JSON.stringify(progress)); } catch(e) {}
          }
          progress.completedModules.forEach(moduleId => {
            const el = document.querySelector(`.module-item[data-module="${moduleId}"]`);
            if (el) el.classList.add('completed');
          });
          if (progress.gameState) gameState = progress.gameState;
          if (progress.predictions) Object.assign(storyPredictions, progress.predictions);
          if (progress.spacedRepetition) {
            spacedRepetitionState = progress.spacedRepetition;
          }
          if (progress.scenarioState) {
            scenarioState = progress.scenarioState;
          }
          if (progress.calibrationState) {
            calibrationState = progress.calibrationState;
          }
          updateStreak();
          updateSidebarPoints();
          if (progress.currentModule !== undefined) {
            return { module: progress.currentModule, slide: progress.currentSlide || 0 };
          }
        }
      } catch (e) { console.log('Could not load progress'); }
      return null;
    }

    function resetProgress() {
      if (confirm('Reset all progress including points and badges?')) {
        try {
          localStorage.removeItem(STORAGE_KEY);
          document.querySelectorAll('.module-item.completed').forEach(el => el.classList.remove('completed'));
          gameState = { points: 0, earnedBadges: [], streak: 0, lastVisitDate: null, principlesMastered: [], quizzesCompleted: 0 };
          storyPredictions = {};
          spacedRepetitionState = { principles: {}, lastDailyReview: null, dailyReviewsCompleted: 0 };
          scenarioState = { completed: {}, scores: {} };
          calibrationState = { predictions: [], totalPredictions: 0, calibrationScore: null };
          updateSidebarPoints();
          updateReviewButtonStatus();
          goToModule(0);
          alert('Progress reset successfully.');
        } catch (e) { console.log('Could not reset progress'); }
      }
    }

    function markModuleComplete(moduleId) {
      const el = document.querySelector(`.module-item[data-module="${moduleId}"]`);
      if (el && !el.classList.contains('completed')) {
        el.classList.add('completed');
        awardPoints(100, 'Module completed');
        checkBadges();
      }
      saveProgress();
    }

    function updateSidebarPoints() {
      const el = document.getElementById('sidebarPoints');
      if (el) el.textContent = gameState.points + ' pts';
    }

    // ============================================================
    // PROGRESS DASHBOARD
    // ============================================================

    function openDashboard() {
      updateDashboardDisplay();
      document.getElementById('progressDashboard').classList.add('open');
    }

    function closeDashboard() {
      document.getElementById('progressDashboard').classList.remove('open');
    }

    function updateDashboardDisplay() {
      const levelInfo = getLevel(gameState.points);
      document.getElementById('levelBadge').textContent = `Level ${levelInfo.level}: ${levelInfo.name}`;
      document.getElementById('totalPoints').textContent = gameState.points;

      const completedModules = document.querySelectorAll('.module-item.completed').length;
      document.getElementById('modulesCompleted').textContent = `${completedModules}/${modules.length}`;

      const predictionCount = Object.keys(storyPredictions).length;
      const correctPredictions = Object.values(storyPredictions).filter(p => p.correct).length;
      document.getElementById('predictionsCorrect').textContent = `${correctPredictions}/${predictionCount}`;
      document.getElementById('quizzesCompleted').textContent = gameState.quizzesCompleted;

      const principlesHtml = sevenPrinciples.map((p, i) => {
        const mastered = gameState.principlesMastered.includes(i);
        return `<div class="principle-item">
          <div class="principle-num ${mastered ? 'mastered' : ''}">${i + 1}</div>
          <div class="principle-text">"${p}"</div>
          <span>${mastered ? '✓' : ''}</span>
        </div>`;
      }).join('');
      document.getElementById('principlesList').innerHTML = principlesHtml;

      const badgesHtml = badges.map(b => {
        const earned = gameState.earnedBadges.includes(b.id);
        return `<div class="badge ${earned ? 'earned' : ''}" title="${b.name}: ${b.desc}">
          ${b.icon}<div class="badge-tooltip">${b.name}</div>
        </div>`;
      }).join('');
      document.getElementById('badgesGrid').innerHTML = badgesHtml;

      document.getElementById('streakCount').textContent = `${gameState.streak} day${gameState.streak !== 1 ? 's' : ''}`;
      document.getElementById('streakFlame').textContent = gameState.streak >= 3 ? '🔥' : '💨';
    }

    // ============================================================
    // SPACED REPETITION ENGINE
    // ============================================================

    // Questions for each principle (used in daily review)
    const principleQuestions = [
      { // Principle 1: "Not every signal is truth."
        principle: 0,
        question: "When a drug shows benefits in observational studies, what should you remember?",
        options: [
          "The benefit is probably real and should guide treatment",
          "Not every signal is truth - RCTs are needed to confirm",
          "Observational studies are always biased and useless",
          "We should immediately conduct a meta-analysis"
        ],
        correct: 1,
        explanation: "Observational signals can be confounded. CAST showed that antiarrhythmics, which appeared beneficial, actually tripled mortality in RCTs."
      },
      { // Principle 2: "Methods protect patients from our confidence."
        principle: 1,
        question: "Why do we pre-register protocols before conducting a meta-analysis?",
        options: [
          "To impress journal editors",
          "Methods protect patients from our confidence",
          "It's required by law in most countries",
          "To speed up the publication process"
        ],
        correct: 1,
        explanation: "Pre-registration prevents us from unconsciously biasing results toward what we expect. HRT observational studies were affected by healthy user bias."
      },
      { // Principle 3: "What was hidden in plain sight?"
        principle: 2,
        question: "When evaluating publication bias, what question should guide your thinking?",
        options: [
          "Are the authors reputable?",
          "Is the journal high impact?",
          "What was hidden in plain sight?",
          "How many studies were included?"
        ],
        correct: 2,
        explanation: "Rosiglitazone's cardiac risks were buried in unpublished FDA data. Always search beyond published literature for the complete picture."
      },
      { // Principle 4: "The number without provenance is not a number."
        principle: 3,
        question: "What makes an effect size trustworthy in meta-analysis?",
        options: [
          "Its statistical significance (p < 0.05)",
          "Clear provenance - knowing exactly where it came from",
          "Publication in a high-impact journal",
          "Agreement with biological plausibility"
        ],
        correct: 1,
        explanation: "DECREASE trials showed fabricated data. Without verifiable provenance (raw data, audit trail), numbers cannot be trusted."
      },
      { // Principle 5: "Heterogeneity is a message, not noise."
        principle: 4,
        question: "When you see high heterogeneity (I² = 80%) in a meta-analysis, what should you think?",
        options: [
          "The meta-analysis has failed and should be abandoned",
          "Use a random-effects model and ignore it",
          "Heterogeneity is a message - investigate its sources",
          "Average the results anyway, that's what meta-analysis does"
        ],
        correct: 2,
        explanation: "ACCORD showed that intensive glucose control had different effects in different patient subgroups. High I² signals important effect modification."
      },
      { // Principle 6: "Absence of evidence is not evidence of absence."
        principle: 5,
        question: "A meta-analysis of 3 small trials shows no significant effect (p = 0.15). What does this mean?",
        options: [
          "The treatment definitely doesn't work",
          "Absence of evidence is not evidence of absence",
          "We need exactly 5 more trials to be sure",
          "The treatment is harmful"
        ],
        correct: 1,
        explanation: "Small studies may lack power to detect real effects. Early surfactant trials initially showed 'no effect' due to small samples, but larger studies proved benefit."
      },
      { // Principle 7: "Certainty must be earned, not assumed."
        principle: 6,
        question: "What does the GRADE framework help us assess?",
        options: [
          "Whether a treatment is cost-effective",
          "How certain we can be in the evidence",
          "Whether authors have conflicts of interest",
          "The optimal sample size for future trials"
        ],
        correct: 1,
        explanation: "GRADE reminds us that certainty must be earned through high-quality evidence, not assumed from statistical significance alone."
      }
    ];

    // Extended question bank for variety
    const extendedQuestions = [
      { principle: 0, question: "The CAST trial showed antiarrhythmics increased mortality by:", options: ["50%", "100%", "200-300%", "400%"], correct: 2, explanation: "Encainide, flecainide, and moricizine roughly tripled mortality compared to placebo." },
      { principle: 1, question: "HRT appeared beneficial in observational studies due to:", options: ["Confounding by indication", "Healthy user bias", "Publication bias", "Data fabrication"], correct: 1, explanation: "Women who chose HRT were healthier at baseline (healthy user bias), creating an apparent benefit." },
      { principle: 2, question: "What percentage of negative trials often go unpublished?", options: ["10-20%", "30-40%", "40-50%", "60-80%"], correct: 2, explanation: "Studies estimate 40-50% of trials with negative results remain unpublished, distorting the evidence base." },
      { principle: 3, question: "The DECREASE trials fraud was detected through:", options: ["Peer review", "Statistical impossibilities", "Journal retraction", "Patient complaints"], correct: 1, explanation: "Patterns in the data were statistically impossible - too perfect, revealing fabrication." },
      { principle: 4, question: "What I² value suggests substantial heterogeneity?", options: [">25%", ">50%", ">75%", ">90%"], correct: 1, explanation: "I² > 50% suggests substantial heterogeneity; > 75% is considerable. Always investigate sources." },
      { principle: 5, question: "A funnel plot shows asymmetry. This suggests:", options: ["Perfect methodology", "Large sample sizes", "Possible small-study effects (publication bias is one explanation)", "High certainty"], correct: 2, explanation: "Funnel plot asymmetry can indicate small-study effects; publication bias is one explanation, but not the only one." },
      { principle: 6, question: "In GRADE, what can LOWER certainty in RCT evidence?", options: ["Large effect size", "Risk of bias", "Dose-response gradient", "Biological plausibility"], correct: 1, explanation: "Risk of bias, imprecision, inconsistency, indirectness, and publication bias can lower certainty from 'high' to lower levels." }
    ];

    // SM-2 inspired spaced repetition state
    let spacedRepetitionState = {
      principles: {}, // { 0: { lastReview: Date, interval: days, easeFactor: 2.5, repetitions: 0, nextReview: Date } }
      lastDailyReview: null,
      dailyReviewsCompleted: 0
    };

    // Initialize spaced repetition for all principles
    function initSpacedRepetition() {
      for (let i = 0; i < 7; i++) {
        if (!spacedRepetitionState.principles[i]) {
          spacedRepetitionState.principles[i] = {
            lastReview: null,
            interval: 1,
            easeFactor: 2.5,
            repetitions: 0,
            nextReview: new Date().toISOString()
          };
        }
      }
    }

    // SM-2 algorithm: update interval based on performance
    function updateSpacedRepetition(principleIndex, quality) {
      // quality: 0-5 (0-2 = fail, 3-5 = pass)
      const p = spacedRepetitionState.principles[principleIndex];
      if (!p) return;

      if (quality >= 3) {
        // Correct answer
        if (p.repetitions === 0) {
          p.interval = 1;
        } else if (p.repetitions === 1) {
          p.interval = 6;
        } else {
          p.interval = Math.round(p.interval * p.easeFactor);
        }
        p.repetitions++;
        p.easeFactor = Math.max(1.3, p.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02)));

        // Mark as mastered after 3 successful reviews
        if (p.repetitions >= 3 && !gameState.principlesMastered.includes(principleIndex)) {
          gameState.principlesMastered.push(principleIndex);
          awardPoints(50, 'Principle mastered');
          earnBadge('principle_master');
        }
      } else {
        // Incorrect answer - reset
        p.repetitions = 0;
        p.interval = 1;
      }

      p.lastReview = new Date().toISOString();
      p.nextReview = new Date(Date.now() + p.interval * 24 * 60 * 60 * 1000).toISOString();
      saveProgress();
    }

    // Get principles due for review (sorted by urgency)
    function getPrinciplesDueForReview() {
      const now = new Date();
      const due = [];

      for (let i = 0; i < 7; i++) {
        const p = spacedRepetitionState.principles[i];
        if (!p) continue;

        const nextReview = p.nextReview ? new Date(p.nextReview) : new Date(0);
        if (nextReview <= now) {
          due.push({
            index: i,
            overdueDays: Math.floor((now - nextReview) / (24 * 60 * 60 * 1000)),
            repetitions: p.repetitions
          });
        }
      }

      // Sort: most overdue first, then least practiced
      due.sort((a, b) => {
        if (b.overdueDays !== a.overdueDays) return b.overdueDays - a.overdueDays;
        return a.repetitions - b.repetitions;
      });

      return due;
    }

    // ============================================================
    // DAILY REVIEW SYSTEM
    // ============================================================

    let reviewState = {
      active: false,
      questions: [],
      currentIndex: 0,
      answers: [],
      timerInterval: null,
      timeRemaining: 120 // 2 minutes in seconds
    };

    function shouldShowDailyReview() {
      if (!spacedRepetitionState.lastDailyReview) return true;

      const lastReview = new Date(spacedRepetitionState.lastDailyReview);
      const today = new Date();

      // Check if it's a new day
      return lastReview.toDateString() !== today.toDateString();
    }

    function openDailyReview() {
      initSpacedRepetition();

      // Get principles due for review
      const duePrinciples = getPrinciplesDueForReview();

      // Select up to 5 questions (mix of due principles and random for variety)
      let selectedQuestions = [];

      // First, add questions for due principles
      duePrinciples.slice(0, 3).forEach(dp => {
        const available = [principleQuestions[dp.index], ...extendedQuestions.filter(q => q.principle === dp.index)];
        const randomQ = available[Math.floor(Math.random() * available.length)];
        if (randomQ && !selectedQuestions.find(q => q.question === randomQ.question)) {
          selectedQuestions.push({ ...randomQ });
        }
      });

      // Fill remaining with random questions
      const allQuestions = [...principleQuestions, ...extendedQuestions];
      while (selectedQuestions.length < 5) {
        const randomQ = allQuestions[Math.floor(Math.random() * allQuestions.length)];
        if (!selectedQuestions.find(q => q.question === randomQ.question)) {
          selectedQuestions.push({ ...randomQ });
        }
      }

      // Shuffle
      selectedQuestions.sort(() => Math.random() - 0.5);

      // Initialize review state
      reviewState = {
        active: true,
        questions: selectedQuestions.slice(0, 5),
        currentIndex: 0,
        answers: [],
        timerInterval: null,
        timeRemaining: 120
      };

      // Show modal
      document.getElementById('dailyReviewModal').classList.add('open');

      // Render progress dots
      renderReviewProgress();

      // Render first question
      renderReviewQuestion();

      // Start timer
      startReviewTimer();
    }

    function closeDailyReview() {
      reviewState.active = false;
      if (reviewState.timerInterval) {
        clearInterval(reviewState.timerInterval);
      }
      document.getElementById('dailyReviewModal').classList.remove('open');
    }

    function skipDailyReview() {
      spacedRepetitionState.lastDailyReview = new Date().toISOString();
      saveProgress();
      closeDailyReview();
      updateReviewButtonStatus();
    }

    function startReviewTimer() {
      const timerEl = document.getElementById('reviewTimer');

      reviewState.timerInterval = setInterval(() => {
        reviewState.timeRemaining--;

        const mins = Math.floor(reviewState.timeRemaining / 60);
        const secs = reviewState.timeRemaining % 60;
        timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;

        if (reviewState.timeRemaining <= 0) {
          clearInterval(reviewState.timerInterval);
          finishDailyReview();
        }
      }, 1000);
    }

    function renderReviewProgress() {
      const container = document.getElementById('reviewProgress');
      container.innerHTML = reviewState.questions.map((_, i) => {
        let cls = 'progress-dot';
        if (i < reviewState.currentIndex) cls += ' completed';
        if (i === reviewState.currentIndex) cls += ' current';
        return `<div class="${cls}"></div>`;
      }).join('');
    }

    function renderReviewQuestion() {
      if (reviewState.currentIndex >= reviewState.questions.length) {
        finishDailyReview();
        return;
      }

      const q = reviewState.questions[reviewState.currentIndex];
      const container = document.getElementById('reviewCardContainer');

      container.innerHTML = `
        <div class="review-card">
          <div class="review-principle-num">${q.principle + 1}</div>
          <div class="review-principle-text">"${sevenPrinciples[q.principle]}"</div>
          <div class="review-question">${q.question}</div>
          <div class="review-options">
            ${q.options.map((opt, i) => `
              <button class="review-option" onclick="selectReviewAnswer(${i})">${opt}</button>
            `).join('')}
          </div>
          <div id="reviewFeedback"></div>
        </div>
      `;

      document.getElementById('reviewNextBtn').disabled = true;
    }

    function selectReviewAnswer(answerIndex) {
      const q = reviewState.questions[reviewState.currentIndex];
      const isCorrect = answerIndex === q.correct;

      // Store answer
      reviewState.answers.push({
        principle: q.principle,
        correct: isCorrect,
        selected: answerIndex
      });

      // Update spaced repetition
      updateSpacedRepetition(q.principle, isCorrect ? 4 : 1);

      // Award points
      if (isCorrect) {
        awardPoints(15, '毎日のレビューが正しい');
      }

      // Visual feedback
      const options = document.querySelectorAll('.review-option');
      options.forEach((opt, i) => {
        opt.disabled = true;
        opt.style.cursor = 'default';
        if (i === q.correct) {
          opt.classList.add('correct');
        }
        if (i === answerIndex && !isCorrect) {
          opt.classList.add('incorrect');
        }
        if (i === answerIndex) {
          opt.classList.add('selected');
        }
      });

      // Show feedback
      const feedbackEl = document.getElementById('reviewFeedback');
      feedbackEl.innerHTML = `
        <div class="review-feedback ${isCorrect ? 'correct' : 'incorrect'}">
          ${isCorrect ? '✓ Correct!' : '✗ Not quite.'} ${q.explanation}
        </div>
      `;

      // Enable next button
      document.getElementById('reviewNextBtn').disabled = false;
    }

    function nextReviewQuestion() {
      reviewState.currentIndex++;
      renderReviewProgress();
      renderReviewQuestion();
    }

    function finishDailyReview() {
      if (reviewState.timerInterval) {
        clearInterval(reviewState.timerInterval);
      }

      const correctCount = reviewState.answers.filter(a => a.correct).length;
      const totalCount = reviewState.answers.length;
      const score = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;

      // Update state
      spacedRepetitionState.lastDailyReview = new Date().toISOString();
      spacedRepetitionState.dailyReviewsCompleted++;
      gameState.quizzesCompleted++;
      saveProgress();
      checkBadges();

      // Award bonus for perfect score
      if (correctCount === totalCount && totalCount > 0) {
        awardPoints(25, '完璧な毎日のレビュー');
        earnBadge('perfect_review');
      }

      // Show summary
      const container = document.getElementById('reviewCardContainer');
      container.innerHTML = `
        <div class="review-summary">
          <div class="summary-score">${score}%</div>
          <div class="summary-text">Daily Review Complete!</div>

          <div class="summary-breakdown">
            <div class="summary-stat">
              <div class="summary-stat-value correct-val">${correctCount}</div>
              <div class="summary-stat-label">Correct</div>
            </div>
            <div class="summary-stat">
              <div class="summary-stat-value incorrect-val">${totalCount - correctCount}</div>
              <div class="summary-stat-label">To Review</div>
            </div>
          </div>

          ${gameState.streak >= 2 ? `
            <div class="review-streak-bonus">
              <span class="flame">🔥</span>
              <span class="text">${gameState.streak} day learning streak!</span>
            </div>
          ` : ''}
        </div>
      `;

      // Update actions
      document.getElementById('reviewActions').innerHTML = `
        <button class="review-btn next" onclick="closeDailyReview()">Continue Learning</button>
      `;

      updateReviewButtonStatus();
    }

    function updateReviewButtonStatus() {
      const btn = document.getElementById('dailyReviewBtn');
      const status = document.getElementById('reviewStatus');

      if (!btn || !status) return;

      if (shouldShowDailyReview()) {
        btn.classList.add('pending');
        status.textContent = 'Due!';
      } else {
        btn.classList.remove('pending');
        status.textContent = '✓ Done';
      }
    }

    // Add badge for spaced repetition mastery
    if (!badges.find(b => b.id === 'principle_master')) {
      badges.push({ id: 'principle_master', icon: '🎓', name: 'Principle Master', desc: 'Master a principle through spaced repetition' });
    }
    if (!badges.find(b => b.id === 'perfect_review')) {
      badges.push({ id: 'perfect_review', icon: '💯', name: 'Perfect Review', desc: '100% を取得毎日のレビュー' });
    }
    if (!badges.find(b => b.id === 'daily_dedication')) {
      badges.push({ id: 'daily_dedication', icon: '📅', name: 'Daily Dedication', desc: '7 つの毎日のレビューを完了' });
    }
    if (!badges.find(b => b.id === 'scenario_solver')) {
      badges.push({ id: 'scenario_solver', icon: '🧩', name: 'Scenario Solver', desc: '5 つの分岐シナリオを完了' });
    }
    if (!badges.find(b => b.id === 'well_calibrated')) {
      badges.push({ id: 'well_calibrated', icon: '🎯', name: 'Well Calibrated', desc: 'Achieve 80%+ calibration accuracy' });
    }

    // ============================================================
    // BRANCHING SCENARIOS SYSTEM
    // ============================================================

    // Scenarios based on Evidence Reversal stories - decisions with consequences
    const branchingScenarios = [
      {
        id: 'cast_scenario',
        module: 1,
        title: '抗不整脈の決定',
        situation: "あなたは 1988 年、病院の処方委員会に所属しています。心臓専門医が、エンカイニドが PVC を抑制することを示すデータを提示しました。 MI後の患者では80％。彼は、それを日常使用のために配合表に加えることを望んでいます。",
        question: "何を推奨しますか?",
        choices: [
          { id: 'a', text: "Approve it - PVC suppression is a validated surrogate for mortality", consequence: 'bad', result: "CAST 試験 (1989 年) では、PVC を抑制したにもかかわらず、これらの薬剤の死亡率が 3 倍高いことが示されました。 50,000 人以上の患者が、代理母に「作用した」薬によって死亡しました。" },
          { id: 'b', text: "Request RCT evidence on hard outcomes (death, cardiac arrest) before approval", consequence: 'good', result: "正解です!サロゲートエンドポイントは誤解を招く可能性があります。 PVC 抑制と生存の関係は証明されておらず、予想とは逆であることが判明しました。" },
          { id: 'c', text: "Approve for low-risk patients only", consequence: 'bad', result: "それでも間違っています。死亡率のデータがなければ、どの患者が被害を受ける可能性があるかを知ることはできません。 CAST はサブグループ全体で有害性を示しました。" }
        ],
        correct: 'b',
        principle: 0,
        lesson: "Not every signal is truth. Surrogates must be validated against hard outcomes before driving treatment decisions."
      },
      {
        id: 'hrt_scenario',
        module: 2,
        title: 'HRT の推奨',
        situation: "時は 1998 年です。閉経後の女性がホルモン補充療法について尋ねます。心臓病の 40 ～ 50% の減少を示す 30 以上の観察研究があります。大規模な RCT はまだ存在しません。",
        question: "彼女に何と言いますか?",
        choices: [
          { id: 'a', text: "HRT を強く推奨します - 観察証拠は圧倒的です", consequence: 'bad', result: "WHI 試験 (2002) では、HRT が心臓病の増加を示しました (HR 1.29)。観察上の利点は健康なユーザーのバイアスによって混乱しました - HRT を選択した女性はベースラインでより健康でした。" },
          { id: 'b', text: "不確実性を説明してください - 観察データは混乱している可能性があります。RCT の結果を待ちます", consequence: 'good', result: "正解です!不確実性を適切に伝えました。 WHI は、観察信号が交絡により誤解を招くものであることを証明しました。" },
          { id: 'c', text: "HRT を推奨しますが、危険因子のある女性にのみ推奨します", consequence: 'bad', result: "Still problematic. Targeting 'high-risk' women doesn't fix confounding - it may concentrate harm." }
        ],
        correct: 'b',
        principle: 1,
        lesson: "方法は、私たちの信頼から患者を守ります。観察上の関連性は因果関係の証拠ではありません。"
      },
      {
        id: 'rosi_scenario',
        module: 3,
        title: '隠された試験',
        situation: "あなたは、2006 年に糖尿病に対するロシグリタゾンのメタ分析を実施しています。12 件の公開された試験が見つかりました。同僚は、FDA が未公開データを持っている可能性があると述べています。",
        question: "What do you do?",
        choices: [
          { id: 'a', text: "公開された試験のみを続行してください - 未公開データは入手が難しすぎます", consequence: 'bad', result: "ニッセンの 2007 年のメタ分析では、未発表の GSK 試験が発見されました。これらを含めると、公表されたデータだけでは見えなかった心筋梗塞リスクが 43% 増加する (OR 1.43) ことが明らかになりました。" },
          { id: 'b', text: "File FOIA requests, search ClinicalTrials.gov, contact the manufacturer", consequence: 'good', result: "正解です。灰色の文献検索は不可欠です。ロシグリタゾンの心臓信号は、何年にもわたって未公開の規制当局への提出書類の中に隠されていました。" },
          { id: 'c', text: "Add a sensitivity analysis assuming unpublished trials exist", consequence: 'neutral', result: "何もしないよりはマシですが、十分ではありません。見つけようとしていないものをモデル化することはできません。積極的な検索が必要です。" }
        ],
        correct: 'b',
        principle: 2,
        lesson: "What was hidden in plain sight? Comprehensive searching beyond published literature is methodologically required."
      },
      {
        id: 'decrease_scenario',
        module: 5,
        title: '疑わしいパターン',
        situation: "You're verifying extracted data for a meta-analysis. One prominent researcher's trials show remarkably consistent effects (I² = 0%) while other trials show high heterogeneity. His event rates are unusually balanced.",
        question: "What do you do?",
        choices: [
          { id: 'a', text: "データを受け入れます - 異質性が低いのは良いことであり、彼は尊敬される研究者です", consequence: 'bad', result: "ドン・ポルダーマンスの DECREASE 試験は後に捏造されたことが判明しました。 「完璧な」一貫性は危険信号でした。実際のデータはさらに乱雑です。彼の不正行為は長年にわたりガイドラインに影響を与えました。" },
          { id: 'b', text: "Request source documents and verify numbers against original publications", consequence: 'good', result: "Correct! Provenance verification caught the fraud. When investigators traced his numbers to source, patients didn't exist. 800,000 may have been harmed by guidelines built on his fabrications." },
          { id: 'c', text: "彼の研究を除いて感度分析を実施", consequence: 'neutral', result: "役に立ちますが、不十分です。まず検証する必要があります。不正行為が疑われる場合は、疑惑ではなく証拠によって除外を正当化する必要があります。" }
        ],
        correct: 'b',
        principle: 3,
        lesson: "出所のない数字は数字ではありません。すべてのデータ ポイントはソースへの検証が必要です。"
      },
      {
        id: 'heterogeneity_scenario',
        module: 8,
        title: 'The I² Dilemma',
        situation: "Your meta-analysis of intensive glucose control shows a pooled HR of 0.91 (95% CI 0.84-0.99) for cardiovascular events, but I² = 78%. The ACCORD trial shows harm (HR 1.22) while others show benefit.",
        question: "これをどのように報告しますか?",
        choices: [
          { id: 'a', text: "プールされた推定値を報告します - これは統計的に有意であり、治療に有利です", consequence: 'bad', result: "危険です!不均一性が高いということは、プールされた推定値が現実を表していないことを意味します。 ACCORDは、集中管理により一部の患者の死亡率が増加したことを示した。平均値のみを報告すると、生命を脅かすサブグループの影響が隠蔽されます。" },
          { id: 'b', text: "Investigate heterogeneity sources, report subgroup differences prominently", consequence: 'good', result: "正解です。 ACCORDは、集中管理が長期にわたる糖尿病や心血管疾患の患者に悪影響を与えることを発見した。 「平均的な」利益は、特定のサブグループにおける致命的な害を覆い隠しました。" },
          { id: 'c', text: "Use random effects and report wider confidence intervals", consequence: 'neutral', result: "技術的には正しいですが、要点を外しています。ランダム効果は不均一性を統計的に説明しますが、臨床的には説明できません。 ACCORD の危害信号には、統計的平滑化ではなく、調査が必要です。" }
        ],
        correct: 'b',
        principle: 4,
        lesson: "不均一性はメッセージであり、ノイズではありません。 I² が高い場合は、統計的な調整だけでなく調査が必要です。"
      },
      {
        id: 'orbita_scenario',
        module: 4,
        title: '偽手術の質問',
        situation: "It's 2015. You're designing a trial of PCI for stable angina. Previous unblinded trials show symptom improvement. A statistician suggests using a sham procedure (catheterization without stenting) as control.",
        question: "あなたの答えは何ですか?",
        choices: [
          { id: 'a', text: "Reject sham control - it's unethical to do an invasive procedure without benefit", consequence: 'bad', result: "ORBITA 試験 (2017) では偽対照を使用し、運動時間に差は見られませんでした (16.6 秒、95% CI -8.9 ～ 42.0）。偽装がなければ、PCI のプラセボ効果が治療効果と誤解されていたでしょう。" },
          { id: 'b', text: "Support sham control - without blinding, we can't distinguish placebo from treatment effect", consequence: 'good', result: "正解です! ORBITA は、安定狭心症に対する PCI の利点の多くがプラセボ効果であることを示し、心臓病学に革命をもたらしました。これを明らかにするには偽のコントロールが不可欠でした。" },
          { id: 'c', text: "Use objective endpoints like MI or death instead of symptoms", consequence: 'neutral', result: "これらは重要ですが、COURAGE はすでに死亡率の利点を示していませんでした。問題は、症状の改善が本物かどうかということでした。そして、それに答えることができるのは偽のコントロールだけです。" }
        ],
        correct: 'b',
        principle: 1,
        lesson: "方法は、私たちの信頼から患者を守ります。偽対照は、非盲検試験ではできないことを明らかにします。"
      },
      {
        id: 'prowess_scenario',
        module: 6,
        title: '単一陽性試験',
        situation: "It's 2002. The PROWESS trial shows activated protein C reduces sepsis mortality (RR 0.81, p=0.005). The manufacturer seeks FDA approval. You're on the advisory committee.",
        question: "何を推奨しますか?",
        choices: [
          { id: 'a', text: "すぐに承認 - この試験は大規模で統計的に有意です", consequence: 'bad', result: "PROWESS-SHOCK (2012) では利点が見出されませんでした (RR 1.09、95% CI 0.92-1.28)そして出血被害。この薬は10年間の使用後に中止された。単一のトライアルは、どれほど印象的であっても、複製が必要です。" },
          { id: 'b', text: "Require confirmatory trial before broad approval", consequence: 'good', result: "正解です。レプリケーションは不可欠です。 PROWESS は誤検知か、試験実施の問題の影響を受けた可能性があります。確認試験があれば、長年にわたる不適切な使用は防げたでしょう。" },
          { id: 'c', text: "市販後調査で承認", consequence: 'neutral', result: "不十分。市販後調査では、承認を取り消すために必要な質の高い証拠が得られることはほとんどありません。適切な確認試験が必要でした。" }
        ],
        correct: 'b',
        principle: 5,
        lesson: "再現の証拠がないことは有効性の証拠ではありません。単一の試験では治療法が決定されるわけではありません。"
      },
      {
        id: 'egdt_scenario',
        module: 7,
        title: '画期的な複製',
        situation: "Rivers EGDT 試験 (2001 年) では、敗血症における劇的な死亡率の減少が示されました。 2014 年までに、3 つの大規模な複製試験 (ProCESS、ARISE、ProMISe) はいずれも利点を示さなかった。これをどう解釈しますか?",
        question: "結論は何ですか?",
        choices: [
          { id: 'a', text: "Rivers was wrong - EGDT doesn't work", consequence: 'neutral', result: "部分的には正しいですが、ニュアンスが異なります。リヴァーズの考えは必ずしも「間違っていた」わけではなく、状況が変化したのだ。 2014 年の通常のケアは 2001 年よりもはるかに優れていました。比較グループは大きく異なりました。" },
          { id: 'b', text: "Usual care improved so much that EGDT's advantage disappeared", consequence: 'good', result: "正解!これは「長期的な傾向」です。2014 年の対照群は EGDT 原則を組み込んだケアを受けました。介入効果は、標準的な実践の改善により薄められました。" },
          { id: 'c', text: "再現試験は異なる集団で行われました", consequence: 'neutral', result: "真実ですが、不完全です。人口の違い（外部妥当性）は、EGDT が複数の国で失敗した理由を完全には説明しません。通常のケアの質における長期的な傾向が重要な要素です。" }
        ],
        correct: 'b',
        principle: 5,
        lesson: "Context matters. Treatments that worked against outdated usual care may show no benefit when standards improve."
      },
      {
        id: 'grade_scenario',
        module: 10,
        title: '確実性の評価',
        situation: "集中的な血圧管理の証拠の確実性を評価しています。利点を示す RCT (SPRINT) がありますが、糖尿病患者は除外され、自動オフィス血圧が使用されていました。あなたの母集団には糖尿病患者が含まれており、手動血圧測定を使用しています。",
        question: "ガイドライン母集団の確実性をどのように評価しますか?",
        choices: [
          { id: 'a', text: "High certainty - SPRINT was a well-conducted RCT", consequence: 'bad', result: "間違っています! GRADE には母集団に対する評価が必要です。 SPRINT の結果は、糖尿病患者 (除外) や手動血圧測定 (最大 10 mmHg 高く測定される) を使用している診療所には直接当てはまりません。これは間接性です。" },
          { id: 'b', text: "間接性のためダウングレード - 母集団と測定値が異なります", consequence: 'good', result: "正解です。 SPRINTは糖尿病患者を除外し（ACCORDは糖尿病患者に害を及ぼすことを示した！）、自動血圧を使用した（測定値は手動よりも低い）。手動血圧で SPRINT 目標を適用すると、患者を過剰治療することになります。" },
          { id: 'c', text: "Moderate certainty - some uncertainty but RCTs are gold standard", consequence: 'neutral', result: "具体性が不十分です。ダウングレードする理由を特定する必要があります。集団における間接性 (糖尿病患者は除く) と介入 (血圧測定方法) には明示的な承認が必要です。" }
        ],
        correct: 'b',
        principle: 6,
        lesson: "あなたの集団について確実性を獲得する必要があります。研究デザインに関係なく、直接証拠は間接証拠に勝ります。"
      },
      {
        id: 'funnel_scenario',
        module: 9,
        title: '非対称ファネル',
        situation: "Your funnel plot for a surgical intervention shows marked asymmetry - small studies cluster on the positive side, large studies near the null. Egger's test p=0.02.",
        question: "どのように進めますか?",
        choices: [
          { id: 'a', text: "Apply trim-and-fill to adjust the pooled estimate", consequence: 'neutral', result: "トリムアンドフィルは感度分析であり、修正ではありません。非対称性は純粋な出版バイアスであると仮定していますが、小規模研究の影響は、患者の選択、介入の忠実度、真の不均一性によるものである可能性もあります。" },
          { id: 'b', text: "非対称性を報告し、原因を調査し、小規模研究の有無にかかわらず提示します", consequence: 'good', result: "Correct! Funnel asymmetry has multiple causes: publication bias, true heterogeneity, or different patient populations in small vs large studies. Transparent reporting of all possibilities is essential." },
          { id: 'c', text: "Exclude small studies as they're likely biased", consequence: 'bad', result: "恣意的な除外は独自のバイアスを生み出します。小規模な研究では、治療が本当に効果を発揮するさまざまな集団を代表する場合があります。排除ではなく調査が答えです。" }
        ],
        correct: 'b',
        principle: 2,
        lesson: "目に見えないところに何が隠されていたのでしょうか？ファネルの非対称性は問題を明らかにしますが、原因は特定されません。調査が必要です。"
      }
    ];

    // Track scenario completions
    let scenarioState = {
      completed: {},
      confidenceRatings: []
    };

    function renderScenario(scenarioId, containerId) {
      const scenario = branchingScenarios.find(s => s.id === scenarioId);
      if (!scenario) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      const isCompleted = scenarioState.completed[scenarioId];

      container.innerHTML = `
        <div class="scenario-panel" id="scenario-${scenarioId}">
          <div class="scenario-header">
            <span class="scenario-icon">🔀</span>
            <span class="scenario-title">${scenario.title}</span>
          </div>
          <div class="scenario-situation">${scenario.situation}</div>
          <div class="scenario-question">${scenario.question}</div>
          <div class="scenario-choices">
            ${scenario.choices.map(c => `
              <div class="scenario-choice ${isCompleted ? 'answered' : ''} ${isCompleted && c.id === scenario.correct ? 'correct' : ''} ${isCompleted && scenarioState.completed[scenarioId] === c.id && c.id !== scenario.correct ? 'incorrect' : ''}"
                   onclick="${isCompleted ? '' : `selectScenarioChoice('${scenarioId}', '${c.id}')`}">
                <span class="choice-letter">${c.id.toUpperCase()}</span>
                <span class="choice-text">${c.text}</span>
              </div>
            `).join('')}
          </div>
          <div class="scenario-consequence ${isCompleted ? 'visible' : ''} ${isCompleted ? scenario.choices.find(c => c.id === scenarioState.completed[scenarioId])?.consequence || '' : ''}" id="consequence-${scenarioId}">
            ${isCompleted ? renderConsequence(scenario, scenarioState.completed[scenarioId]) : ''}
          </div>
        </div>
      `;
    }

    function renderConsequence(scenario, choiceId) {
      const choice = scenario.choices.find(c => c.id === choiceId);
      const isCorrect = choiceId === scenario.correct;
      return `
        <div class="consequence-title">
          ${isCorrect ? '✓ Good decision!' : '✗ Problematic decision'}
        </div>
        <div class="consequence-text">${choice.result}</div>
        <div class="consequence-lesson"><strong>Principle ${scenario.principle + 1}:</strong> ${scenario.lesson}</div>
      `;
    }

    function selectScenarioChoice(scenarioId, choiceId) {
      const scenario = branchingScenarios.find(s => s.id === scenarioId);
      if (!scenario || scenarioState.completed[scenarioId]) return;

      scenarioState.completed[scenarioId] = choiceId;

      // Award points
      if (choiceId === scenario.correct) {
        awardPoints(30, 'Correct scenario decision');
      } else {
        awardPoints(10, 'Scenario attempted');
      }

      // Check for badge
      const completedCount = Object.keys(scenarioState.completed).length;
      if (completedCount >= 5) {
        earnBadge('scenario_solver');
      }

      saveProgress();

      // Re-render with answer shown
      const container = document.getElementById(`scenario-${scenarioId}`)?.parentElement;
      if (container) {
        renderScenario(scenarioId, container.id);
      }
    }

    // ============================================================
    // CONFIDENCE CALIBRATION SYSTEM
    // ============================================================

    let calibrationState = {
      predictions: [], // { confidence: 0-100, correct: boolean }
      totalPredictions: 0,
      calibrationScore: null
    };

    function addConfidenceToPredict(containerId) {
      const container = document.getElementById(containerId);
      if (!container) return;

      const existingSection = container.querySelector('.confidence-section');
      if (existingSection) return;

      const section = document.createElement('div');
      section.className = 'confidence-section';
      section.innerHTML = `
        <div class="confidence-label">How confident are you in your prediction?</div>
        <div class="confidence-slider-container">
          <input type="range" class="confidence-slider" min="0" max="100" value="50"
                 oninput="updateConfidenceDisplay(this)">
          <span class="confidence-value">50%</span>
        </div>
        <div class="confidence-labels">
          <span>Guessing</span>
          <span>Very sure</span>
        </div>
      `;
      container.appendChild(section);
    }

    function updateConfidenceDisplay(slider) {
      const value = slider.value;
      slider.nextElementSibling.textContent = value + '%';
    }

    function recordConfidence(confidence, wasCorrect) {
      calibrationState.predictions.push({ confidence, correct: wasCorrect });
      calibrationState.totalPredictions++;
      calculateCalibrationScore();
      saveProgress();
    }

    function calculateCalibrationScore() {
      if (calibrationState.predictions.length < 5) {
        calibrationState.calibrationScore = null;
        return;
      }

      // Group predictions by confidence bands
      const bands = { low: [], mid: [], high: [] };
      calibrationState.predictions.forEach(p => {
        if (p.confidence < 40) bands.low.push(p);
        else if (p.confidence < 70) bands.mid.push(p);
        else bands.high.push(p);
      });

      // Calculate accuracy per band
      const bandAccuracy = {};
      Object.keys(bands).forEach(band => {
        if (bands[band].length > 0) {
          const correct = bands[band].filter(p => p.correct).length;
          bandAccuracy[band] = correct / bands[band].length;
        }
      });

      // Perfect calibration: high confidence = high accuracy, low confidence = low accuracy
      // Score: 100 - average absolute deviation from expected
      let totalDeviation = 0;
      let count = 0;

      if (bands.high.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.high || 0) - 0.85) * 100;
        count++;
      }
      if (bands.mid.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.mid || 0) - 0.55) * 100;
        count++;
      }
      if (bands.low.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.low || 0) - 0.25) * 100;
        count++;
      }

      calibrationState.calibrationScore = count > 0 ? Math.max(0, 100 - (totalDeviation / count)) : null;

      // Award badge for good calibration
      if (calibrationState.calibrationScore >= 80) {
        earnBadge('well_calibrated');
      }
    }

    // ============================================================
    // ENHANCED ANALOGY SYSTEM
    // ============================================================

    const conceptAnalogies = {
      'heterogeneity': {
        icon: '🎻',
        title: 'Orchestra Tuning',
        concept: 'I² (Heterogeneity)',
        text: "オーケストラのチューニングと同様に、ある程度の差異は正常であり、予想されるものです。しかし、ヴァイオリンが異なるキーで演奏している場合は、何かが間違っています。 I² が高いということは、勉強が同じ曲を演奏していないことを意味します。"
      },
      'publication_bias': {
        icon: '🧦',
        title: 'Missing Socks',
        concept: 'Publication Bias',
        text: "洗濯物の靴下のように、靴下を履いたのはわかっていますが、結果は肯定的な結果しか出ません。失われた否定的な試練は、消えてしまった一枚の靴下のようなものです。非対称ファネル プロットはギャップを明らかにします。"
      },
      'forest_plot': {
        icon: '⚖️',
        title: 'Jury of Studies',
        concept: 'Forest Plot',
        text: "各研究は評決を下す陪審員です。より確実なもの (狭い CI) もあれば、そうでないものもあります。ダイヤモンドは陪審員の総意です - しかし、陪審員の意見が大きく異なる場合 (異質性)、平均的な評決を信頼すべきでしょうか?"
      },
      'funnel_plot': {
        icon: '🔦',
        title: 'Flashlight Beam',
        concept: 'Funnel Plot',
        text: "懐中電灯は全方向に均等に照らされるはずです。非対称ファネル プロットは、片側が何かで遮られている懐中電灯のようなもので、全体像が見えません。一方の小さな研究は疑わしいほど欠落しています。"
      },
      'grade': {
        icon: '🪜',
        title: 'Ladder of Confidence',
        concept: 'GRADE Certainty',
        text: "Each rung must be earned, not assumed. You start at the top (RCT) or bottom (observational) and can only move with evidence. Risk of bias pushes you down; large effects can pull you up. No shortcuts."
      },
      'tau_squared': {
        icon: '📻',
        title: 'Background Static',
        concept: 'τ² (Between-study variance)',
        text: "ラジオ局の静電気のようなものです - 信号にはどのくらいのノイズが含まれていますか? τ² が低いということは、受信がクリアであることを意味します (研究でも同意されています)。高い τ² は、未知の原因 (さまざまな集団、介入、または結果) からの干渉を意味します。"
      },
      'random_effects': {
        icon: '🎼',
        title: 'Different Orchestras',
        concept: 'Random Effects Model',
        text: "Fixed effects: same orchestra playing multiple times. Random effects: different orchestras playing the same piece. Each adds their interpretation. We want the average of all possible orchestras, not just this one."
      },
      'prediction_interval': {
        icon: '🎯',
        title: 'Where Will the Arrow Land?',
        concept: 'Prediction Interval',
        text: "CI は、真の平均がどこにあるかを示します。予測間隔は、次の研究がどこに該当する可能性があるかを示します。 PI が影響なしの境界線を越えた場合、新しい研究によって結論が覆される可能性があります。"
      },
      'surrogate': {
        icon: '🗺️',
        title: 'Map vs Territory',
        concept: 'Surrogate Endpoints',
        text: "A map (surrogate) represents the territory (clinical outcome). But a map can be wrong. PVC suppression was the map; mortality was the territory. CAST proved the map led off a cliff."
      },
      'confounding': {
        icon: '☂️',
        title: 'Umbrella & Rain',
        concept: 'Confounding',
        text: "傘の売れ行きは雨を予測します。しかし、傘を買ったからといって雨が降るわけではありません。交絡因子 (天気予報) は両方に影響します。 HRT ユーザーは HRT のせいでより健康になったわけではありません。HRT を選択した女性はより健康でした。"
      }
    };

    function getAnalogy(conceptKey) {
      return conceptAnalogies[conceptKey] || null;
    }

    function renderAnalogy(conceptKey, containerId) {
      const analogy = getAnalogy(conceptKey);
      if (!analogy) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="analogy-card">
          <div class="analogy-header">
            <span class="analogy-icon">${analogy.icon}</span>
            <span class="analogy-title">${analogy.title}</span>
            <span class="analogy-concept">${analogy.concept}</span>
          </div>
          <div class="analogy-text">"${analogy.text}"</div>
        </div>
      `;
    }

    // ============================================================
    // MISCONCEPTION CHALLENGES (from Evidence Reversal 40)
    // ============================================================

    const misconceptions = [
      // Original 10 - Evidence Reversals
      { id: 1, statement: "If arrhythmias fall, survival must rise.", truth: false, story: "CAST", explanation: "Encainide/flecainide suppressed PVCs but tripled mortality. Surrogates can deceive." },
      { id: 2, statement: "Observational prevention equals causal prevention.", truth: false, story: "WHI/HRT", explanation: "Healthy user bias made HRT look protective. RCTs showed harm." },
      { id: 3, statement: "Surgery proves itself without sham control.", truth: false, story: "Moseley", explanation: "Arthroscopic knee surgery was no better than sham. Placebo effect is powerful." },
      { id: 4, statement: "If the artery is open, outcomes must improve.", truth: false, story: "COURAGE", explanation: "PCI for stable CAD didn't reduce death/MI vs medical therapy alone." },
      { id: 5, statement: "Lower glucose always means better outcomes.", truth: false, story: "NICE-SUGAR", explanation: "Intensive glucose control increased mortality in ICU patients." },
      { id: 6, statement: "A positive early signal is enough for adoption.", truth: false, story: "PROWESS-SHOCK", explanation: "Activated protein C looked promising until definitive trial showed no benefit." },
      { id: 7, statement: "If a mechanism is plausible, outcomes follow.", truth: false, story: "MAGIC", explanation: "Magnesium had sound antiarrhythmic theory but no mortality benefit in large trials." },
      { id: 8, statement: "More measurements mean more survival.", truth: false, story: "ESCAPE", explanation: "Pulmonary artery catheters provided data but no outcome improvement in heart failure." },
      { id: 9, statement: "Device enthusiasm replaces randomized proof.", truth: false, story: "CORAL", explanation: "Renal artery stenting had no benefit despite strong mechanistic rationale." },
      { id: 10, statement: "Guidelines equal proof.", truth: false, story: "IABP-SHOCK", explanation: "Intra-aortic balloon pump was Class I recommended but showed no benefit in RCT." },
      // More Evidence Reversals
      { id: 11, statement: "Raising HDL with drugs guarantees fewer heart attacks.", truth: false, story: "AIM-HIGH", explanation: "ナイアシンは HDL を上昇させましたが、心血管イベントは軽減しませんでした。 HDL はマーカーであり、修正可能な原因ではありません。" },
      { id: 12, statement: "If it worked in one landmark trial, it works everywhere.", truth: false, story: "ProCESS/ARISE/ProMISe", explanation: "Rivers' EGDT worked in 2001 but three replication trials failed. Usual care had improved, diluting the effect." },
      { id: 13, statement: "Antioxidants prevent cancer in smokers.", truth: false, story: "ATBC/CARET", explanation: "Beta-carotene INCREASED lung cancer in smokers (RR 1.16-1.28). Mechanism doesn't guarantee benefit." },
      { id: 14, statement: "More screening always saves more lives.", truth: false, story: "PLCO", explanation: "PSA screening found more cancers but didn't reduce mortality - it found cancers that would never kill." },
      { id: 15, statement: "Normalizing hemoglobin improves kidney patient outcomes.", truth: false, story: "CHOIR/TREAT", explanation: "Hb 目標を高くすると、脳卒中と死亡が増加しました。ターゲットは敵になりました。" },
      { id: 16, statement: "新しいデバイスは新しいため安全です。", truth: false, story: "SAMMPRIS", explanation: "Intracranial stents tripled 30-day stroke/death vs medical therapy (14.7% vs 5.8%)." },
      { id: 17, statement: "If homocysteine drops, cardiovascular risk drops.", truth: false, story: "NORVIT", explanation: "B vitamins lowered homocysteine but didn't reduce events. Biomarker fallacy." },
      { id: 18, statement: "Routine oxygen helps heart attack patients.", truth: false, story: "DETO2X-AMI", explanation: "Oxygen in non-hypoxic MI patients showed no mortality benefit. A century of practice, no evidence." },
      { id: 19, statement: "Early aggressive feeding speeds ICU recovery.", truth: false, story: "EPaNIC", explanation: "Late parenteral nutrition led to FASTER discharge than early feeding. Timing matters." },
      { id: 20, statement: "Removing thrombus during PCI must improve outcomes.", truth: false, story: "TASTE", explanation: "Thrombus aspiration added procedural time but no mortality benefit. Logical doesn't mean proven." },
      // Cochrane Methods Misconceptions
      { id: 21, statement: "I² が低いということは、研究がプールするほど十分に一致していることを意味します。", truth: false, story: "Methods", explanation: "I² が低い場合には、臨床的に重要な違いがある可能性があります。予測間隔により、影響の真の広がりが明らかになります。" },
      { id: 22, statement: "Statistically significant means clinically important.", truth: false, story: "Methods", explanation: "Large trials can detect tiny, meaningless effects. Effect SIZE and CI width matter more than p-values." },
      { id: 23, statement: "RCT は常に高い確実性の証拠です。", truth: false, story: "GRADE", explanation: "RCT は最初は高いですが、バイアス、不正確さ、間接性、矛盾、出版バイアスにより格下げされます。" },
      { id: 24, statement: "Funnel plot asymmetry proves publication bias.", truth: false, story: "Methods", explanation: "Asymmetry has many causes: true heterogeneity, small-study effects, different populations. Investigation needed." },
      { id: 25, statement: "Random effects models fix heterogeneity.", truth: false, story: "Methods", explanation: "Random effects account for heterogeneity statistically but don't explain it. Clinical investigation is still required." }
    ];

    function renderMisconceptionChallenge(misconceptionId, containerId) {
      const m = misconceptions.find(x => x.id === misconceptionId);
      if (!m) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="misconception-challenge" id="misconception-${m.id}">
          <div class="misconception-header">
            <span>🤔</span>
            <span>Common Belief Challenge</span>
          </div>
          <div class="misconception-statement">"${m.statement}"</div>
          <div class="misconception-buttons">
            <button class="misconception-btn true-btn" onclick="answerMisconception(${m.id}, true)">TRUE</button>
            <button class="misconception-btn false-btn" onclick="answerMisconception(${m.id}, false)">FALSE</button>
          </div>
          <div class="misconception-result" id="misconception-result-${m.id}"></div>
        </div>
      `;
    }

    function answerMisconception(id, answer) {
      const m = misconceptions.find(x => x.id === id);
      if (!m) return;

      const isCorrect = answer === m.truth;
      const trueBtn = document.querySelector(`#misconception-${id} .true-btn`);
      const falseBtn = document.querySelector(`#misconception-${id} .false-btn`);
      const resultDiv = document.getElementById(`misconception-result-${id}`);

      // Disable buttons
      trueBtn.disabled = true;
      falseBtn.disabled = true;

      // Show correct/incorrect
      if (m.truth) {
        trueBtn.classList.add('correct');
        if (!answer) falseBtn.classList.add('wrong');
      } else {
        falseBtn.classList.add('correct');
        if (answer) trueBtn.classList.add('wrong');
      }

      // Show result
      resultDiv.className = `misconception-result visible ${isCorrect ? 'correct' : 'incorrect'}`;
      resultDiv.innerHTML = `
        <strong>${isCorrect ? '✓ Correct!' : '✗ Not quite.'}</strong>
        This belief is <strong>${m.truth ? 'TRUE' : 'FALSE'}</strong>.
        <br><br>
        <strong>${m.story}:</strong> ${m.explanation}
      `;

      // Award points
      if (isCorrect) {
        awardPoints(20, 'Misconception challenge correct');
      }
      saveProgress();
    }

    // ============================================================
    // PRACTICE PROBLEMS (Addressing Cochrane Gaps)
    // ============================================================

    const practiceProblems = [
      // GRADE Problems
      {
        id: 'grade_1',
        category: 'GRADE',
        title: 'Rating Certainty: SPRINT Trial',
        scenario: 'You\'re creating a guideline for hypertension. The SPRINT trial (RCT, n=9,361) shows intensive BP control reduces CV events (HR 0.75, 95% CI 0.64-0.89). However: (1) Trial excluded diabetics, (2) Used automated office BP (reads ~10 mmHg lower than manual), (3) Composite endpoint included heart failure.',
        question: '糖尿病患者や使用者を含むクリニックの母集団に適切な GRADE 確実性評価はどれですかマニュアルBP?',
        options: [
          { id: 'a', text: 'High - SPRINT was a large, well-conducted RCT', correct: false },
          { id: 'b', text: 'Moderate - Downgrade one level for indirectness (population differs)', correct: true },
          { id: 'c', text: '低 - 間接性と不正確さのため2レベルダウン', correct: false },
          { id: 'd', text: 'Very Low - Multiple serious concerns', correct: false }
        ],
        explanation: 'Downgrade ONE level for serious indirectness: (1) Population excludes diabetics (ACCORD showed HARM in diabetics with intensive control), (2) BP measurement method differs (applying SPRINT targets with manual BP would overtreate). The trial quality was good, but the results don\'t directly apply to your population.',
        principle: 6
      },
      {
        id: 'grade_2',
        category: 'GRADE',
        title: 'When Observational Beats RCT',
        scenario: 'For a rare adverse effect (hepatotoxicity with a new drug), you have: (1) RCTs showing 0/2,000 events in treatment vs 0/2,000 in control, (2) Large pharmacovigilance database showing 45 cases in 500,000 users (9/100,000).',
        question: 'この安全信号のより高い確実性を提供するものは何ですか?',
        options: [
          { id: 'a', text: 'RCT - ゴールドスタンダードです', correct: false },
          { id: 'b', text: '観測データ - まれなものを検出する力がありますイベント', correct: true },
          { id: 'c', text: 'どちらでもない - さらに多くの RCT データが必要', correct: false },
          { id: 'd', text: 'Combine them in a meta-analysis', correct: false }
        ],
        explanation: 'RCTs are underpowered for rare events. With 2,000 patients, you\'d need a risk >1/500 to detect one event. The observational data, despite confounding risks, provides the only evidence of a real signal. GRADE can rate UP observational data when effect is large or there\'s dose-response.',
        principle: 5
      },
      // Prediction Interval Problems
      {
        id: 'pi_1',
        category: 'Prediction Intervals',
        title: 'Beyond I-squared',
        scenario: 'A meta-analysis of 8 trials shows: Pooled RR = 0.80 (95% CI 0.72-0.89), I² = 65%, τ² = 0.04. The 95% prediction interval is 0.55-1.16.',
        question: 'If you run a new trial in a similar population, what range of effects is plausible?',
        options: [
          { id: 'a', text: '0.72-0.89 (信頼区間)', correct: false },
          { id: 'b', text: '0.55-1.16 (予測区間)', correct: true },
          { id: 'c', text: '約 0.80 (ポイント)推定値)', correct: false },
          { id: 'd', text: 'このデータからは予測できません', correct: false }
        ],
        explanation: 'The PREDICTION INTERVAL (0.55-1.16) shows the range of true effects in different settings. It INCLUDES 1.0, meaning a new trial might show HARM even though the pooled estimate shows benefit. I² tells you heterogeneity exists; prediction intervals tell you what it means for the next patient/setting.',
        principle: 4
      },
      {
        id: 'pi_2',
        category: 'Prediction Intervals',
        title: 'Clinical Interpretation',
        scenario: 'You\'re advising a colleague about implementing an intervention. The meta-analysis shows: RR = 0.70 (95% CI 0.60-0.82), I² = 45% (moderate), 95% prediction interval = 0.50-0.98.',
        question: '同僚に何と言いますか?',
        options: [
          { id: 'a', text: 'Strong evidence of benefit - implement confidently', correct: false },
          { id: 'b', text: 'Likely beneficial but effect size may vary substantially by setting', correct: true },
          { id: 'c', text: 'Too much heterogeneity to draw conclusions', correct: false },
          { id: 'd', text: 'Wait for more trials to reduce uncertainty', correct: false }
        ],
        explanation: '予測区間 (0.50 ～ 0.98) は 1.0 未満にとどまっており、大きさはさまざまですが (30 ～ 50% の削減)、ほとんどの設定で利点が得られる可能性が高いことを示唆しています。これは、単に「中程度の異質性」を報告するよりも有益です。治療はおそらく効果がありますが、どの程度効果があるかは局所的な要因によって異なります。',
        principle: 4
      },
      // Risk of Bias Problems
      {
        id: 'rob_1',
        category: 'Risk of Bias',
        title: 'Retrospective Red Flags',
        scenario: 'Reviewing a trial of a surgical intervention: (1) Patients knew their allocation, (2) Surgeons obviously couldn\'t be blinded, (3) Primary outcome was "patient-reported pain at 6 months", (4) 15% lost to follow-up, similar between groups.',
        question: 'What is the MAIN risk of bias concern?',
        options: [
          { id: 'a', text: 'Selection bias - randomization might have been subverted', correct: false },
          { id: 'b', text: 'Performance bias - surgeons weren\'t blinded', correct: false },
          { id: 'c', text: 'Detection bias - patients knew allocation and reported subjective outcome', correct: true },
          { id: 'd', text: 'Attrition bias - 15% lost to follow-up', correct: false }
        ],
        explanation: 'With UNBLINDED patients reporting SUBJECTIVE outcomes, detection bias is critical. Patients who know they got the "real" surgery often report more improvement (placebo effect). This is exactly why ORBITA used sham surgery - to separate placebo from true treatment effect. The 15% attrition, balanced between groups, is less concerning.',
        principle: 1
      },
      {
        id: 'rob_2',
        category: 'Risk of Bias',
        title: '減少シグナル',
        scenario: 'Reviewing trials by a prolific researcher, you notice: (1) Event rates perfectly balanced between groups, (2) I² = 0% when his trials pooled alone (but 70% when combined with others), (3) Effects consistently larger than other researchers\' trials, (4) Unable to verify source data.',
        question: '何をすべきですか?',
        options: [
          { id: 'a', text: 'Include the trials - low heterogeneity is desirable', correct: false },
          { id: 'b', text: 'Conduct sensitivity analysis excluding his trials', correct: false },
          { id: 'c', text: 'Request source data verification before inclusion', correct: true },
          { id: 'd', text: 'Report concerns but include anyway', correct: false }
        ],
        explanation: 'These are classic fabrication signals (from the DECREASE fraud case). "Perfect" data is a red flag - real biological data is messy. The ONLY acceptable path is source data verification. Don Poldermans\' fraud influenced guidelines for years; 800,000 patients may have been harmed. Numbers without provenance are not numbers.',
        principle: 3
      },
      // Publication Bias Problems
      {
        id: 'pb_1',
        category: 'Publication Bias',
        title: 'Asymmetric Funnel',
        scenario: 'Your funnel plot shows: Large trials cluster around RR=1.0, small trials cluster around RR=0.6 (all on the "benefit" side). Egger\'s test p=0.01.',
        question: 'What\'s the most likely explanation?',
        options: [
          { id: 'a', text: 'Publication bias - small negative trials weren\'t published', correct: false },
          { id: 'b', text: 'Small-study effects - could be publication bias OR true heterogeneity', correct: true },
          { id: 'c', text: 'The small trials found the true effect; large trials are diluted', correct: false },
          { id: 'd', text: 'Random variation - asymmetry is expected', correct: false }
        ],
        explanation: 'Funnel asymmetry has MULTIPLE causes: (1) Publication bias, (2) True heterogeneity (small trials in different populations), (3) Methodological differences (small trials less rigorous), (4) Chance. You cannot conclude "publication bias" from asymmetry alone. Investigation of WHY is required.',
        principle: 2
      },
      {
        id: 'pb_2',
        category: 'Publication Bias',
        title: '不足している試験',
        scenario: 'You\'re meta-analyzing an antidepressant. ClinicalTrials.gov shows 12 registered trials; you found 8 publications. The 4 missing trials were completed 3+ years ago.',
        question: 'What do you do?',
        options: [
          { id: 'a', text: '公開されている 8 件の試験を続行する - これが標準です実践', correct: false },
          { id: 'b', text: 'スポンサー/著者に連絡し、未公開データの FOIA リクエストを提出します', correct: true },
          { id: 'c', text: 'ディスカッションセクションの制限に注意してください', correct: false },
          { id: 'd', text: 'トリムアンドフィルを使用して欠落している試験を調整します', correct: false }
        ],
        explanation: 'FDA は、公開されている抗うつ薬試験の 94% が陽性であることを発見しました。すべての試験の 51% が FDA に提出されました。不足しているデータの取得を試みる必要があります。これはオプションではありません。それを修正しようとせずに「限界に注目する」ことは方法論的な怠慢です。',
        principle: 2
      }
    ];

    function renderPracticeProblem(problemId, containerId) {
      const problem = practiceProblems.find(p => p.id === problemId);
      if (!problem) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="practice-problem" id="problem-${problem.id}">
          <div class="practice-header">
            <span class="practice-category">${problem.category}</span>
            <span class="practice-title">${problem.title}</span>
          </div>
          <div class="practice-scenario">${problem.scenario}</div>
          <div class="practice-question"><strong>${problem.question}</strong></div>
          <div class="practice-options">
            ${problem.options.map(opt => `
              <button class="practice-option" onclick="answerPracticeProblem('${problem.id}', '${opt.id}')">
                <span class="option-letter">${opt.id.toUpperCase()}</span>
                <span class="option-text">${opt.text}</span>
              </button>
            `).join('')}
          </div>
          <div class="practice-feedback" id="feedback-${problem.id}"></div>
        </div>
      `;
    }

    function answerPracticeProblem(problemId, answerId) {
      const problem = practiceProblems.find(p => p.id === problemId);
      if (!problem) return;

      const selectedOption = problem.options.find(o => o.id === answerId);
      const correctOption = problem.options.find(o => o.correct);
      const isCorrect = selectedOption.correct;

      // Disable all buttons and show correct/incorrect
      const buttons = document.querySelectorAll(`#problem-${problemId} .practice-option`);
      buttons.forEach(btn => {
        btn.disabled = true;
        const letter = btn.querySelector('.option-letter').textContent.toLowerCase();
        if (letter === correctOption.id) {
          btn.classList.add('correct');
        } else if (letter === answerId) {
          btn.classList.add('incorrect');
        }
      });

      // Show feedback
      const feedbackDiv = document.getElementById(`feedback-${problemId}`);
      feedbackDiv.className = `practice-feedback visible ${isCorrect ? 'correct' : 'incorrect'}`;
      feedbackDiv.innerHTML = `
        <strong>${isCorrect ? '✓ Correct!' : '✗ Not quite.'}</strong>
        <p>${problem.explanation}</p>
        <p class="principle-link"><em>Principle ${problem.principle + 1}: ${sevenPrinciples[problem.principle]?.text || ''}</em></p>
      `;

      // Award points
      if (isCorrect) {
        awardPoints(25, 'Practice problem correct');
      } else {
        awardPoints(5, 'Practice problem attempted');
      }
      saveProgress();
    }

    // ============================================================
    // INVESTIGATION EXERCISES
    // ============================================================

    function revealAnswer(elementId) {
      const el = document.getElementById(elementId);
      if (el) {
        el.classList.add('visible');
        // Scroll into view
        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function generateMiniForest(containerId, studies, pooled, showAfter = false) {
      const container = document.getElementById(containerId);
      if (!container) return;

      const minE = Math.min(...studies.map(s => s.lo), pooled.lo, 0.3);
      const maxE = Math.max(...studies.map(s => s.hi), pooled.hi, 3);
      const range = maxE - minE;
      const scale = (v) => ((v - minE) / range) * 240 + 30;
      const height = (studies.length + 1) * 24 + 30;

      container.innerHTML = `
        <svg viewBox="0 0 320 ${height}" style="width: 100%; height: ${height}px; font-family: sans-serif;">
          <line x1="${scale(1)}" y1="5" x2="${scale(1)}" y2="${height - 15}" stroke="#999" stroke-width="1" stroke-dasharray="3"/>
          ${studies.map((s, i) => {
            const y = 18 + i * 24;
            const color = showAfter && s.excluded ? '#ccc' : '#1E2761';
            return `
              <text x="2" y="${y + 3}" font-size="9" fill="${color}" ${s.excluded ? 'text-decoration="line-through"' : ''}>${s.name}</text>
              <line x1="${scale(s.lo)}" y1="${y}" x2="${scale(s.hi)}" y2="${y}" stroke="${color}" stroke-width="1.5"/>
              <rect x="${scale(s.effect) - 4}" y="${y - 4}" width="8" height="8" fill="${color}"/>
              <text x="280" y="${y + 3}" font-size="8" fill="${color}">${s.effect.toFixed(2)}</text>
            `;
          }).join('')}
          <polygon points="${scale(pooled.effect)},${height - 20} ${scale(pooled.lo)},${height - 13} ${scale(pooled.effect)},${height - 6} ${scale(pooled.hi)},${height - 13}" fill="${showAfter ? '#C53030' : '#D4AF37'}"/>
          <text x="2" y="${height - 10}" font-size="9" font-weight="bold" fill="${showAfter ? '#C53030' : '#1E2761'}">Pooled</text>
          <text x="280" y="${height - 10}" font-size="8" font-weight="bold">${pooled.effect.toFixed(2)}</text>
          <text x="${scale(0.5)}" y="${height}" font-size="7" fill="#666">Favors Tx</text>
          <text x="${scale(2)}" y="${height}" font-size="7" fill="#666">Favors Ctrl</text>
        </svg>
      `;
    }

    // CAST Investigation Data
    const castStudiesPublished = [
      { name: 'Obs Study 1', effect: 0.45, lo: 0.28, hi: 0.72 },
      { name: 'Obs Study 2', effect: 0.52, lo: 0.35, hi: 0.77 },
      { name: 'Obs Study 3', effect: 0.38, lo: 0.22, hi: 0.65 },
    ];
    const castPooledBefore = { effect: 0.45, lo: 0.33, hi: 0.61 };
    const castPooledAfter = { effect: 2.50, lo: 1.60, hi: 4.50 };

    // Rosiglitazone data (real from Nissen 2007)
    const rosiStudies = [
      { name: 'ADOPT', effect: 1.25, lo: 0.78, hi: 2.01 },
      { name: 'DREAM', effect: 1.36, lo: 0.68, hi: 2.71 },
      { name: 'Trial 49653/020', effect: 1.81, lo: 0.59, hi: 5.55 },
      { name: 'Trial 49653/024', effect: 2.67, lo: 0.50, hi: 14.3 },
      { name: 'Trial 49653/093', effect: 1.50, lo: 0.25, hi: 8.98 },
    ];
    const rosiPooled = { effect: 1.43, lo: 1.03, hi: 1.98 };

    // DECREASE data (before/after fraud removal)
    const decreaseStudies = [
      { name: 'DECREASE-I', effect: 0.09, lo: 0.02, hi: 0.37, excluded: true },
      { name: 'DECREASE-IV', effect: 0.65, lo: 0.24, hi: 1.74, excluded: true },
      { name: 'POISE', effect: 1.33, lo: 1.03, hi: 1.74 },
      { name: 'DIPOM', effect: 1.11, lo: 0.66, hi: 1.87 },
      { name: 'MaVS', effect: 0.92, lo: 0.46, hi: 1.84 },
    ];
    const decreasePooledBefore = { effect: 0.56, lo: 0.35, hi: 0.89 };
    const decreasePooledAfter = { effect: 1.27, lo: 1.01, hi: 1.60 };

    // Magnesium ISIS-4 data
    const magnesiumSmallTrials = [
      { name: 'Rasmussen', effect: 0.23, lo: 0.05, hi: 1.01 },
      { name: 'Smith', effect: 0.31, lo: 0.09, hi: 1.10 },
      { name: 'Ceremuzynski', effect: 0.48, lo: 0.17, hi: 1.34 },
      { name: 'Schechter 1', effect: 0.52, lo: 0.20, hi: 1.35 },
      { name: 'Schechter 2', effect: 0.35, lo: 0.13, hi: 0.94 },
    ];
    const magPooledSmall = { effect: 0.44, lo: 0.27, hi: 0.71 };
    const isis4Result = { effect: 1.06, lo: 0.99, hi: 1.13 };

    // Complete magnesium trial data with sample sizes for visualization
    const magnesiumTrialsComplete = [
      { name: 'Morton 1984', n: 40, effect: 0.10, lo: 0.01, hi: 0.87, se: 0.55 },
      { name: 'Rasmussen 1986', n: 273, effect: 0.35, lo: 0.13, hi: 0.94, se: 0.25 },
      { name: 'Smith 1986', n: 400, effect: 0.48, lo: 0.21, hi: 1.09, se: 0.21 },
      { name: 'Abraham 1987', n: 94, effect: 0.87, lo: 0.33, hi: 2.30, se: 0.35 },
      { name: 'Shechter 1990', n: 103, effect: 0.27, lo: 0.08, hi: 0.95, se: 0.42 },
      { name: 'Ceremuzynski 1989', n: 48, effect: 0.22, lo: 0.03, hi: 1.50, se: 0.68 },
      { name: 'LIMIT-2', n: 2316, effect: 0.74, lo: 0.57, hi: 0.97, se: 0.09 },
    ];
    const isis4Complete = { name: 'ISIS-4', n: 58050, effect: 1.06, lo: 0.99, hi: 1.13, se: 0.025 };

    function drawMagnesiumForest(mode) {
      const containerId = mode === 'small' ? 'magnesium-forest-small' : 'magnesium-forest-full';
      const container = document.getElementById(containerId);
      if (!container) return;

      let trials = [...magnesiumTrialsComplete];
      let pooled = { effect: 0.44, lo: 0.27, hi: 0.71, label: 'Pooled (small trials)' };

      if (mode === 'full') {
        trials.push(isis4Complete);
        pooled = { effect: 1.02, lo: 0.95, hi: 1.09, label: 'Pooled (all trials)' };
      }

      const width = 800;
      const height = trials.length * 35 + 100;
      const margin = { left: 150, right: 50, top: 30, bottom: 50 };
      const plotWidth = width - margin.left - margin.right;

      // Log scale for OR
      const minLog = Math.log(0.05);
      const maxLog = Math.log(3);
      const xScale = (logVal) => margin.left + ((logVal - minLog) / (maxLog - minLog)) * plotWidth;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="max-width: 100%; height: auto;">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Forest Plot: Magnesium in MI${mode === 'full' ? ' (with ISIS-4)' : ' (small trials only)'}
      </text>`;

      // Grid lines and axis
      const ticks = [0.1, 0.25, 0.5, 1.0, 2.0];
      ticks.forEach(tick => {
        const x = xScale(Math.log(tick));
        svg += `<line x1="${x}" y1="${margin.top}" x2="${x}" y2="${height - margin.bottom}" stroke="#e2e8f0" stroke-width="1"/>`;
        svg += `<text x="${x}" y="${height - margin.bottom + 15}" text-anchor="middle" font-size="11" fill="#64748b">${tick}</text>`;
      });

      // Null line
      const nullX = xScale(0);
      svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="2"/>`;

      // Studies
      trials.forEach((trial, i) => {
        const y = margin.top + 20 + i * 35;
        const x = xScale(Math.log(trial.effect));
        const xLo = xScale(Math.log(Math.max(0.05, trial.lo)));
        const xHi = xScale(Math.log(Math.min(3, trial.hi)));

        // Weight based on sample size
        const weight = Math.sqrt(trial.n) / Math.sqrt(isis4Complete.n) * 10;
        const boxSize = Math.max(4, Math.min(12, weight + 4));

        const color = trial.name === 'ISIS-4' ? '#C53030' : (trial.effect < 1 ? '#22c55e' : '#64748b');

        // Label
        svg += `<text x="${margin.left - 10}" y="${y + 4}" text-anchor="end" font-size="11" fill="#1a365d">${trial.name} (n=${trial.n.toLocaleString()})</text>`;

        // CI line
        svg += `<line x1="${xLo}" y1="${y}" x2="${xHi}" y2="${y}" stroke="${color}" stroke-width="2"/>`;

        // Effect point
        svg += `<rect x="${x - boxSize/2}" y="${y - boxSize/2}" width="${boxSize}" height="${boxSize}" fill="${color}"/>`;

        // CI caps
        svg += `<line x1="${xLo}" y1="${y - 4}" x2="${xLo}" y2="${y + 4}" stroke="${color}" stroke-width="1"/>`;
        svg += `<line x1="${xHi}" y1="${y - 4}" x2="${xHi}" y2="${y + 4}" stroke="${color}" stroke-width="1"/>`;
      });

      // Pooled diamond
      const poolY = height - margin.bottom - 20;
      const poolX = xScale(Math.log(pooled.effect));
      const poolXLo = xScale(Math.log(pooled.lo));
      const poolXHi = xScale(Math.log(pooled.hi));
      const diamondColor = pooled.effect < 1 ? '#22c55e' : '#C53030';

      svg += `<polygon points="${poolXLo},${poolY} ${poolX},${poolY - 8} ${poolXHi},${poolY} ${poolX},${poolY + 8}" fill="${diamondColor}" stroke="${diamondColor}"/>`;
      svg += `<text x="${margin.left - 10}" y="${poolY + 4}" text-anchor="end" font-size="11" font-weight="bold" fill="#1a365d">${pooled.label}</text>`;

      // Axis label
      svg += `<text x="${width/2}" y="${height - 5}" text-anchor="middle" font-size="12" fill="#1a365d">Odds Ratio (log scale)</text>`;

      // Favors labels
      svg += `<text x="${xScale(Math.log(0.2))}" y="${height - margin.bottom + 30}" text-anchor="middle" font-size="10" fill="#22c55e">← Favors Magnesium</text>`;
      svg += `<text x="${xScale(Math.log(2))}" y="${height - margin.bottom + 30}" text-anchor="middle" font-size="10" fill="#C53030">Favors Placebo →</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    function drawMagnesiumFunnel(mode) {
      const container = document.getElementById('magnesium-funnel-small');
      if (!container) return;

      const trials = magnesiumTrialsComplete;
      const width = 600;
      const height = 400;
      const margin = { left: 80, right: 40, top: 40, bottom: 60 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Pooled effect (log scale)
      const pooledLog = Math.log(0.44);

      // X axis: log(OR)
      const minLogOR = -2.5;
      const maxLogOR = 1;
      const xScale = (logOR) => margin.left + ((logOR - minLogOR) / (maxLogOR - minLogOR)) * plotWidth;

      // Y axis: SE (inverted - high precision at top)
      const maxSE = 0.75;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="max-width: 100%; height: auto;">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Funnel Plot: Magnesium in MI (small trials)
      </text>`;

      // Funnel shape (95% CI bounds)
      const funnelPoints = [];
      for (let se = 0; se <= maxSE; se += 0.01) {
        const ciWidth = 1.96 * se;
        const xLeft = xScale(pooledLog - ciWidth);
        const xRight = xScale(pooledLog + ciWidth);
        const y = yScale(se);
        funnelPoints.push({ xLeft, xRight, y });
      }

      // Draw funnel
      let leftPath = `M ${xScale(pooledLog)} ${yScale(0)}`;
      let rightPath = `M ${xScale(pooledLog)} ${yScale(0)}`;
      funnelPoints.forEach(p => {
        leftPath += ` L ${p.xLeft} ${p.y}`;
        rightPath += ` L ${p.xRight} ${p.y}`;
      });
      svg += `<path d="${leftPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;
      svg += `<path d="${rightPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;

      // Vertical line at pooled effect
      svg += `<line x1="${xScale(pooledLog)}" y1="${margin.top}" x2="${xScale(pooledLog)}" y2="${height - margin.bottom}" stroke="#22c55e" stroke-width="2" stroke-dasharray="4"/>`;

      // Null line at OR = 1
      svg += `<line x1="${xScale(0)}" y1="${margin.top}" x2="${xScale(0)}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="2"/>`;

      // Plot studies
      trials.forEach(trial => {
        const x = xScale(Math.log(trial.effect));
        const y = yScale(trial.se);
        const color = trial.effect < 1 ? '#22c55e' : '#64748b';
        svg += `<circle cx="${x}" cy="${y}" r="6" fill="${color}" stroke="#fff" stroke-width="1"/>`;
        svg += `<text x="${x + 8}" y="${y + 3}" font-size="9" fill="#1a365d">${trial.name}</text>`;
      });

      // Axes
      svg += `<line x1="${margin.left}" y1="${height - margin.bottom}" x2="${width - margin.right}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;
      svg += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;

      // X axis ticks
      [-2, -1, 0, 0.5].forEach(logOR => {
        const x = xScale(logOR);
        const or = Math.exp(logOR).toFixed(2);
        svg += `<line x1="${x}" y1="${height - margin.bottom}" x2="${x}" y2="${height - margin.bottom + 5}" stroke="#1a365d"/>`;
        svg += `<text x="${x}" y="${height - margin.bottom + 18}" text-anchor="middle" font-size="10" fill="#1a365d">${or}</text>`;
      });

      // Y axis ticks
      [0, 0.25, 0.5, 0.75].forEach(se => {
        const y = yScale(se);
        svg += `<line x1="${margin.left - 5}" y1="${y}" x2="${margin.left}" y2="${y}" stroke="#1a365d"/>`;
        svg += `<text x="${margin.left - 10}" y="${y + 3}" text-anchor="end" font-size="10" fill="#1a365d">${se.toFixed(2)}</text>`;
      });

      // Axis labels
      svg += `<text x="${width/2}" y="${height - 10}" text-anchor="middle" font-size="12" fill="#1a365d">Odds Ratio</text>`;
      svg += `<text x="15" y="${height/2}" text-anchor="middle" transform="rotate(-90, 15, ${height/2})" font-size="12" fill="#1a365d">Standard Error</text>`;

      // Annotations
      svg += `<text x="${xScale(-1.5)}" y="${height - margin.bottom + 40}" text-anchor="middle" font-size="10" fill="#f59e0b" font-weight="bold">
        ⚠️ Asymmetric: Small trials cluster left
      </text>`;

      svg += '</svg>';
      container.innerHTML = svg;

      // Show interpretation
      document.getElementById('mag-funnel-interpretation').style.display = 'block';
    }

    // Reboxetine funnel plot data (published trials only - showing bias)
    function drawReboxetineFunnel() {
      const container = document.getElementById('reboxetine-funnel');
      if (!container) return;

      // Published trials (all showing benefit - biased)
      const publishedTrials = [
        { name: 'Trial 1', smd: 0.72, se: 0.18 },
        { name: 'Trial 2', smd: 0.58, se: 0.22 },
        { name: 'Trial 3', smd: 0.45, se: 0.20 },
        { name: 'Trial 4', smd: 0.61, se: 0.25 },
        { name: 'Trial 5', smd: 0.52, se: 0.19 },
        { name: 'Trial 6', smd: 0.68, se: 0.28 },
        { name: 'Trial 7', smd: 0.41, se: 0.16 },
      ];

      // Where the missing trials likely were (shown as ghost points)
      const missingTrials = [
        { name: 'Hidden 1', smd: -0.12, se: 0.22 },
        { name: 'Hidden 2', smd: 0.05, se: 0.19 },
        { name: 'Hidden 3', smd: -0.08, se: 0.25 },
        { name: 'Hidden 4', smd: 0.11, se: 0.20 },
        { name: 'Hidden 5', smd: -0.15, se: 0.28 },
      ];

      const width = 600;
      const height = 400;
      const margin = { left: 80, right: 40, top: 40, bottom: 60 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Pooled effect (published)
      const pooledSMD = 0.56;

      // X axis: SMD
      const minSMD = -0.5;
      const maxSMD = 1.0;
      const xScale = (smd) => margin.left + ((smd - minSMD) / (maxSMD - minSMD)) * plotWidth;

      // Y axis: SE (inverted)
      const maxSE = 0.35;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="max-width: 100%; height: auto;">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Funnel Plot: Reboxetine vs Placebo (Published Only)
      </text>`;

      // Funnel shape
      const funnelPoints = [];
      for (let se = 0.01; se <= maxSE; se += 0.01) {
        const ciWidth = 1.96 * se;
        const xLeft = xScale(pooledSMD - ciWidth);
        const xRight = xScale(pooledSMD + ciWidth);
        const y = yScale(se);
        funnelPoints.push({ xLeft, xRight, y });
      }

      let leftPath = `M ${xScale(pooledSMD)} ${yScale(0.01)}`;
      let rightPath = `M ${xScale(pooledSMD)} ${yScale(0.01)}`;
      funnelPoints.forEach(p => {
        leftPath += ` L ${p.xLeft} ${p.y}`;
        rightPath += ` L ${p.xRight} ${p.y}`;
      });
      svg += `<path d="${leftPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;
      svg += `<path d="${rightPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;

      // Pooled effect line
      svg += `<line x1="${xScale(pooledSMD)}" y1="${margin.top}" x2="${xScale(pooledSMD)}" y2="${height - margin.bottom}" stroke="#22c55e" stroke-width="2" stroke-dasharray="4"/>`;

      // Null line at SMD = 0
      svg += `<line x1="${xScale(0)}" y1="${margin.top}" x2="${xScale(0)}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="2"/>`;

      // Plot missing trials (ghost points)
      missingTrials.forEach(trial => {
        const x = xScale(trial.smd);
        const y = yScale(trial.se);
        svg += `<circle cx="${x}" cy="${y}" r="8" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="3"/>`;
      });

      // Plot published trials
      publishedTrials.forEach(trial => {
        const x = xScale(trial.smd);
        const y = yScale(trial.se);
        svg += `<circle cx="${x}" cy="${y}" r="6" fill="#22c55e" stroke="#fff" stroke-width="1"/>`;
      });

      // Axes
      svg += `<line x1="${margin.left}" y1="${height - margin.bottom}" x2="${width - margin.right}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;
      svg += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;

      // X axis ticks
      [-0.4, -0.2, 0, 0.2, 0.4, 0.6, 0.8].forEach(smd => {
        const x = xScale(smd);
        svg += `<line x1="${x}" y1="${height - margin.bottom}" x2="${x}" y2="${height - margin.bottom + 5}" stroke="#1a365d"/>`;
        svg += `<text x="${x}" y="${height - margin.bottom + 18}" text-anchor="middle" font-size="10" fill="#1a365d">${smd.toFixed(1)}</text>`;
      });

      // Y axis ticks
      [0.05, 0.15, 0.25, 0.35].forEach(se => {
        const y = yScale(se);
        svg += `<line x1="${margin.left - 5}" y1="${y}" x2="${margin.left}" y2="${y}" stroke="#1a365d"/>`;
        svg += `<text x="${margin.left - 10}" y="${y + 3}" text-anchor="end" font-size="10" fill="#1a365d">${se.toFixed(2)}</text>`;
      });

      // Axis labels
      svg += `<text x="${width/2}" y="${height - 10}" text-anchor="middle" font-size="12" fill="#1a365d">Standardized Mean Difference</text>`;
      svg += `<text x="15" y="${height/2}" text-anchor="middle" transform="rotate(-90, 15, ${height/2})" font-size="12" fill="#1a365d">Standard Error</text>`;

      // Legend
      svg += `<circle cx="${width - 120}" cy="${margin.top + 10}" r="5" fill="#22c55e"/>`;
      svg += `<text x="${width - 110}" y="${margin.top + 14}" font-size="10" fill="#1a365d">Published</text>`;
      svg += `<circle cx="${width - 120}" cy="${margin.top + 28}" r="6" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="3"/>`;
      svg += `<text x="${width - 110}" y="${margin.top + 32}" font-size="10" fill="#C53030">Missing?</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    // ============================================================
    // ACCESSIBILITY & UI HELPERS
    // ============================================================

    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('open');
      var btn = document.querySelector('.sidebar-toggle, .hamburger, .mobile-menu-btn'); if (btn) btn.setAttribute('aria-expanded', btn.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
    }

    function toggleGlossary() {
      const panel = document.getElementById('glossaryPanel');
      panel.classList.toggle('open');
      if (panel.classList.contains('open')) {
        document.getElementById('glossarySearch').focus();
      }
    }

    function filterGlossary() {
      const query = document.getElementById('glossarySearch').value.toLowerCase();
      const terms = document.querySelectorAll('.glossary-term');
      terms.forEach(term => {
        const text = term.textContent.toLowerCase();
        term.style.display = text.includes(query) ? 'block' : 'none';
      });
    }

    function toggleKeyboardHelp() {
      const help = document.getElementById('keyboardHelp');
      help.classList.toggle('open');
    }

    // Enhanced keyboard navigation
    document.addEventListener('keydown', (e) => {
      // Don't trigger shortcuts when typing in inputs
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
        if (e.key === 'Escape') {
          e.target.blur();
        }
        return;
      }

      switch(e.key) {
        case 'ArrowRight':
        case ' ':
          if (!e.shiftKey) {
            e.preventDefault();
            nextSlide();
          }
          break;
        case 'ArrowLeft':
        case 'Backspace':
          e.preventDefault();
          prevSlide();
          break;
        case 'ArrowDown':
        case 'n':
        case 'N':
          if (currentModule < modules.length - 1) {
            e.preventDefault();
            goToModule(currentModule + 1);
          }
          break;
        case 'ArrowUp':
        case 'p':
        case 'P':
          if (currentModule > 0) {
            e.preventDefault();
            goToModule(currentModule - 1);
          }
          break;
        case 't':
        case 'T':
          e.preventDefault();
          toggleToolsPanel();
          break;
        case 'g':
        case 'G':
          e.preventDefault();
          toggleGlossary();
          break;
        case '?':
          e.preventDefault();
          toggleKeyboardHelp();
          break;
        case 'Escape':
          document.getElementById('glossaryPanel').classList.remove('open');
          document.getElementById('keyboardHelp').classList.remove('open');
          document.querySelector('.sidebar').classList.remove('open');
          document.getElementById('sidebarOverlay').classList.remove('open');
          break;
      }
    });

    // ============================================================
    // QUIZ SYSTEM
    // ============================================================

    function checkQuizAnswer(questionId, selectedIdx, correctIdx, explanations) {
      const options = document.querySelectorAll(`#${questionId} .quiz-option`);
      options.forEach((opt, i) => {
        opt.classList.remove('selected');
        opt.onclick = null; // Disable further clicks
        if (i === correctIdx) {
          opt.classList.add('correct');
        } else if (i === selectedIdx && selectedIdx !== correctIdx) {
          opt.classList.add('incorrect');
        }
      });

      // Show explanation
      const feedbackEl = document.getElementById(`${questionId}-feedback`);
      if (feedbackEl) {
        const isCorrect = selectedIdx === correctIdx;
        feedbackEl.style.display = 'block';
        feedbackEl.innerHTML = `
          <div style="padding: 0.75rem; margin-top: 0.5rem; border-radius: 6px; background: ${isCorrect ? 'rgba(34,197,94,0.1)' : 'rgba(197,48,48,0.1)'}; border-left: 3px solid ${isCorrect ? 'var(--green)' : 'var(--red)'};">
            <strong>${isCorrect ? 'Correct!' : 'Not quite.'}</strong> ${explanations[correctIdx]}
          </div>
        `;
      }
    }

    // ============================================================
    // INITIALIZE
    // ============================================================

    document.addEventListener('DOMContentLoaded', () => {
      initModuleList();

      // Restore saved tier
      try {
        const savedTier = localStorage.getItem('synthesis_course_tier');
        if (savedTier && ['foundation','researcher','methodologist'].includes(savedTier)) {
          setTier(savedTier);
        }
      } catch(e) {}

      // Load saved progress
      const savedProgress = loadProgress();
      if (savedProgress) {
        goToModule(savedProgress.module);
        if (savedProgress.slide > 0) {
          setTimeout(() => goToSlide(savedProgress.slide), 100);
        }
      } else {
        goToModule(0);
      }

      // Initialize spaced repetition
      initSpacedRepetition();
      updateReviewButtonStatus();

      // Check for daily review badge
      if (spacedRepetitionState.dailyReviewsCompleted >= 7) {
        earnBadge('daily_dedication');
      }

      // Show daily review prompt if due (with slight delay for UX)
      if (shouldShowDailyReview()) {
        setTimeout(() => {
          // Only auto-prompt if they've completed at least one module
          const completedModules = document.querySelectorAll('.module-item.completed').length;
          if (completedModules >= 1) {
            openDailyReview();
          }
        }, 2000);
      }

      // Auto-save on navigation
      const originalGoToModule = goToModule;
      goToModule = function(moduleId) {
        // Mark previous module as complete if we're progressing
        if (moduleId > currentModule) {
          markModuleComplete(currentModule);
        }
        originalGoToModule(moduleId);
        saveProgress();
      };

      const originalGoToSlide = goToSlide;
      goToSlide = function(index) {
        originalGoToSlide(index);
        saveProgress();
      };
    });
  </script>
</body>
</html>
