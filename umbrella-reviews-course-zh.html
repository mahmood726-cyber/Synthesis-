<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ä¼è¯„è®ºï¼šè¯„è®ºä¸­çš„è¯„è®º</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&amp;family=Source+Sans+Pro:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
<style>
    :root {
      --navy: #1E2761;
      --deep-navy: #141B3D;
      --gold: #D4AF37;
      --cream: #FAF8F5;
      --light-cream: #FFFFFF;
      --text: #2D3748;
      --light-text: #718096;
      --red: #C53030;
      --green: #22c55e;
      --teal: #0f766e;
      --purple: #7c3aed;
      --orange: #f59e0b;
      --transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      height: 100%;
      font-family: 'Source Sans Pro', sans-serif;
      background: var(--deep-navy);
      color: var(--cream);
    }

    .course-container { display: flex; height: 100vh; overflow: hidden; }

    /* Skip Link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--gold);
      color: var(--navy);
      padding: 8px 16px;
      z-index: 10000;
      text-decoration: none;
      font-weight: 600;
    }
    .skip-link:focus { top: 0; }

    /* Sidebar */
    .sidebar {
      width: 300px;
      background: linear-gradient(180deg, var(--deep-navy) 0%, #0a0f1a 100%);
      border-right: 1px solid rgba(212,175,55,0.2);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .sidebar-header {
      padding: 1.25rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
      text-align: center;
    }
    .sidebar-header h1 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--gold);
    }
    .sidebar-header p {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    .stats-panel {
      padding: 1rem;
      background: rgba(212,175,55,0.1);
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }
    .level-display {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .level-badge {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--gold), #f0c040);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 2px 8px rgba(212,175,55,0.4);
    }
    .level-info { flex: 1; }
    .level-title { font-weight: 700; font-size: 0.9rem; color: var(--gold); }
    .level-subtitle { font-size: 0.7rem; color: rgba(255,255,255,0.6); }
    .xp-bar {
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 0.5rem;
    }
    .xp-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--gold), var(--orange));
      border-radius: 4px;
      transition: width 0.5s ease;
      position: relative;
      overflow: hidden;
    }
    .xp-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }
    @keyframes shimmer {
      to { left: 100%; }
    }
    .xp-text {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.5);
      text-align: right;
      margin-top: 0.25rem;
    }
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-top: 0.75rem;
    }
    .quick-stat {
      background: rgba(0,0,0,0.2);
      padding: 0.5rem;
      border-radius: 6px;
      text-align: center;
    }
    .quick-stat-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--gold);
    }
    .quick-stat-label {
      font-size: 0.6rem;
      color: rgba(255,255,255,0.5);
    }

    .course-progress {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
      background: rgba(0,0,0,0.2);
    }
    .course-progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
      margin-bottom: 0.35rem;
    }
    .course-progress-bar {
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      overflow: hidden;
    }
    .course-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--green), #22d3ee);
      border-radius: 3px;
      transition: width 0.5s ease;
      position: relative;
      overflow: hidden;
    }
    .course-progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    .module-list { flex: 1; overflow-y: auto; padding: 0.5rem 0; }
    .module-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.6rem 1rem;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }
    .module-item:hover { background: rgba(212,175,55,0.1); }
    .module-item.active { background: rgba(212,175,55,0.15); border-left-color: var(--gold); }
    .module-item.completed .module-number { background: var(--green); color: white; }
    .module-item.locked { opacity: 0.5; cursor: not-allowed; }
    .module-number {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
      flex-shrink: 0;
    }
    .module-item.active .module-number { background: var(--gold); color: var(--navy); }
    .module-info { flex: 1; min-width: 0; }
    .module-title { font-size: 0.8rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .module-subtitle { font-size: 0.65rem; color: rgba(255,255,255,0.5); }
    .module-xp { font-size: 0.6rem; color: var(--gold); }
    .module-time { font-size: 0.55rem; color: rgba(255,255,255,0.4); display: flex; align-items: center; gap: 0.25rem; margin-top: 0.15rem; }

    .badges-panel {
      padding: 1rem;
      border-top: 1px solid rgba(212,175,55,0.2);
    }
    .badges-title { font-size: 0.75rem; font-weight: 600; color: var(--gold); margin-bottom: 0.5rem; }
    .badges-grid { display: flex; flex-wrap: wrap; gap: 0.35rem; }
    .badge-item {
      width: 32px;
      height: 32px;
      min-width: 44px;
      min-height: 44px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-family: inherit;
      color: inherit;
      padding: 0;
      opacity: 0.3;
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
    }
    .badge-item.earned { opacity: 1; background: rgba(212,175,55,0.2); border-color: var(--gold); }
    .badge-item:hover::after,
    .badge-item:focus::after,
    .badge-item:focus-visible::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--navy);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.6rem;
      white-space: nowrap;
      z-index: 100;
    }
    .badge-item:focus-visible { outline: 2px solid var(--gold); outline-offset: 2px; }

    /* Main Content */
    .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .content-header {
      padding: 0.75rem 1.5rem;
      background: rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(212,175,55,0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .breadcrumb { font-size: 0.85rem; color: rgba(255,255,255,0.6); }
    .breadcrumb span { color: var(--gold); }
    .header-actions { display: flex; gap: 0.5rem; align-items: center; }
    .streak-display {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      background: rgba(239,68,68,0.2);
      border: 1px solid rgba(239,68,68,0.4);
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
    }
    .streak-display.active {
      background: rgba(249,115,22,0.2);
      border-color: var(--orange);
      animation: flamePulse 1.5s ease-in-out infinite;
    }
    @keyframes flamePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    .streak-flame { font-size: 1rem; }
    .streak-count { font-weight: 700; color: var(--orange); }

    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn:hover { background: rgba(212,175,55,0.2); border-color: var(--gold); }
    .btn.primary { background: var(--gold); color: var(--navy); border-color: var(--gold); font-weight: 600; }

    .content-body { flex: 1; overflow: hidden; display: flex; }

    /* Slides */
    .slides-container { flex: 1; position: relative; overflow: hidden; touch-action: pan-x pan-y; }
    .module-slides { display: none; width: 100%; height: 100%; }
    .module-slides.active { display: block; }

    .slide {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 2rem 2rem 4rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition), visibility var(--transition);
      overflow-y: auto;
    }
    .slide.active { opacity: 1; visibility: visible; }
    .slide.dark { background: var(--deep-navy); }
    .slide.light { background: var(--cream); color: var(--text); }
    .slide.black { background: #000; }
    .slide.red-bg { background: linear-gradient(135deg, #7f1d1d, #450a0a); }
    .slide.green-bg { background: linear-gradient(135deg, #14532d, #052e16); }
    .slide.purple-bg { background: linear-gradient(135deg, #4c1d95, #2e1065); }
    .slide.orange-bg { background: linear-gradient(135deg, #9a3412, #431407); }
    .slide.teal-bg { background: linear-gradient(135deg, #0f766e, #042f2e); }
    .slide.gold-bg { background: linear-gradient(135deg, #92702a 0%, #5c4520 100%); }

    .slide-progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--gold), var(--orange));
      transition: width 0.3s ease;
      z-index: 50;
    }

    .serif { font-family: 'Cormorant Garamond', Georgia, serif; }
    .title {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.8rem, 4vw, 3rem);
      font-weight: 700;
      margin-bottom: 1rem;
      line-height: 1.2;
      text-align: center;
    }
    .title.gold { color: var(--gold); }
    .title.navy { color: var(--navy); }
    .subtitle {
      font-size: clamp(0.9rem, 2vw, 1.3rem);
      color: rgba(255,255,255,0.7);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .slide.light .subtitle { color: var(--light-text); }

    .big-number {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(4rem, 12vw, 8rem);
      font-weight: 700;
      line-height: 1;
    }
    .big-number.gold { color: var(--gold); }
    .big-number.red { color: var(--red); }

    .refrain {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.3rem, 3vw, 2rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      max-width: 700px;
    }

    .content { display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 850px; }

    /* Cards */
    .card {
      background: var(--light-cream);
      border: 1px solid var(--gold);
      padding: 1.25rem 1.5rem;
      margin: 0.5rem 0;
      max-width: 750px;
      width: 100%;
      border-radius: 8px;
    }
    .card.navy-bg { background: var(--navy); color: var(--cream); }
    .card-label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.05em;
      margin-bottom: 0.4rem;
      text-transform: uppercase;
    }
    .card-text { font-size: 0.95rem; line-height: 1.6; }
    .card.navy-bg .card-text { color: var(--cream); }

    /* Story box */
    .story-box {
      background: linear-gradient(135deg, rgba(197,48,48,0.15), rgba(30,39,97,0.2));
      border-left: 4px solid var(--red);
      padding: 1.25rem;
      margin: 0.75rem 0;
      max-width: 750px;
      width: 100%;
      border-radius: 0 8px 8px 0;
    }
    .story-box.success { background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(30,39,97,0.2)); border-left-color: #4CAF50; }
    .story-box.warning { background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(30,39,97,0.2)); border-left-color: var(--gold); }
    .story-box.teal { background: linear-gradient(135deg, rgba(15,118,110,0.15), rgba(30,39,97,0.2)); border-left-color: var(--teal); }
    .story-label {
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      color: var(--red);
      margin-bottom: 0.4rem;
      text-transform: uppercase;
    }
    .story-box.success .story-label { color: var(--green); }
    .story-box.warning .story-label { color: var(--orange); }
    .story-box.teal .story-label { color: var(--teal); }
    .story-text { font-size: 0.95rem; line-height: 1.6; }

    /* Stats */
    .stats-grid {
      display: flex;
      gap: 0.75rem;
      margin: 1rem 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    .stat-box {
      background: var(--navy);
      color: var(--cream);
      padding: 1rem 1.25rem;
      text-align: center;
      min-width: 120px;
      border-radius: 8px;
    }
    .stat-value {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(1.3rem, 2.5vw, 2rem);
      font-weight: 700;
    }
    .stat-value.gold { color: var(--gold); }
    .stat-value.red { color: var(--red); }
    .stat-value.green { color: var(--green); }
    .stat-label { font-size: 0.75rem; opacity: 0.8; margin-top: 0.2rem; }

    /* Timeline */
    .timeline { display: flex; flex-direction: column; gap: 0.4rem; width: 100%; max-width: 650px; }
    .timeline-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.6rem 0.75rem;
      background: rgba(255,255,255,0.05);
      border-radius: 6px;
      border-left: 4px solid var(--gold);
    }
    .timeline-days { font-weight: 700; font-size: 0.8rem; min-width: 70px; color: var(--gold); }
    .timeline-content { flex: 1; }
    .timeline-title { font-weight: 600; font-size: 0.9rem; }
    .timeline-desc { font-size: 0.75rem; opacity: 0.7; }

    /* Checklist */
    .checklist { display: flex; flex-direction: column; gap: 0.4rem; width: 100%; max-width: 650px; }
    .checklist-item {
      display: flex;
      align-items: flex-start;
      gap: 0.6rem;
      padding: 0.6rem 0.75rem;
      background: rgba(255,255,255,0.05);
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .check-icon {
      width: 20px;
      height: 20px;
      background: var(--green);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: white;
      flex-shrink: 0;
    }
    .checklist-text { font-size: 0.9rem; }

    /* Decision Tree */
    .decision-tree {
      background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(30,39,97,0.2));
      border: 2px solid var(--purple);
      border-radius: 12px;
      padding: 1.25rem;
      width: 100%;
      max-width: 700px;
    }
    .decision-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    .decision-icon {
      width: 40px;
      height: 40px;
      background: var(--purple);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }
    .decision-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.2rem;
      font-weight: 700;
    }
    .decision-xp {
      margin-left: auto;
      background: rgba(212,175,55,0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      color: var(--gold);
      font-weight: 600;
    }
    .decision-scenario {
      background: rgba(0,0,0,0.2);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .decision-question {
      font-weight: 600;
      color: var(--gold);
      margin-bottom: 0.75rem;
      font-size: 1rem;
    }
    .decision-options { display: flex; flex-direction: column; gap: 0.5rem; }
    .decision-option {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.15);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .decision-option:hover {
      background: rgba(124,58,237,0.2);
      border-color: var(--purple);
      transform: translateX(4px);
    }
    .decision-option:active {
      transform: scale(0.98);
    }
    .decision-option.selected { background: rgba(124,58,237,0.3); border-color: var(--purple); }
    .decision-option.correct { background: rgba(34,197,94,0.2); border-color: var(--green); }
    .decision-option.incorrect { background: rgba(239,68,68,0.15); border-color: var(--red); }
    .decision-option.disabled { pointer-events: none; opacity: 0.7; }
    .decision-option:focus-visible { outline: 3px solid var(--gold); outline-offset: 2px; }
    .option-letter {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.8rem;
      flex-shrink: 0;
    }
    .decision-option.correct .option-letter { background: var(--green); color: white; }
    .decision-option.incorrect .option-letter { background: var(--red); color: white; }
    .option-text { font-size: 0.9rem; }
    .decision-feedback {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      display: none;
    }
    .decision-feedback.show { display: block; }
    .decision-feedback.correct { background: rgba(34,197,94,0.2); border: 1px solid var(--green); }
    .decision-feedback.incorrect { background: rgba(239,68,68,0.15); border: 1px solid var(--red); }
    .feedback-title { font-weight: 700; margin-bottom: 0.5rem; }
    .feedback-text { font-size: 0.9rem; line-height: 1.5; }

    /* Learning Objectives */
    .objectives-box {
      background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(30,39,97,0.25));
      border: 2px solid #3b82f6;
      border-radius: 12px;
      padding: 1.25rem;
      margin: 0.75rem 0;
      max-width: 700px;
      width: 100%;
    }
    .objectives-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .objectives-icon {
      width: 36px;
      height: 36px;
      background: #3b82f6;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }
    .objectives-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: #60a5fa;
    }
    .objectives-list { list-style: none; padding: 0; }
    .objectives-list li {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.4rem 0;
      font-size: 0.9rem;
    }
    .objectives-list li::before { content: 'o'; color: #3b82f6; font-weight: bold; }

    /* Animation */
    .slide.active .animate { animation: fadeUp 0.5s ease-out forwards; }
    .slide.active .animate.delay-1 { animation-delay: 0.1s; }
    .slide.active .animate.delay-2 { animation-delay: 0.2s; }
    .slide.active .animate.delay-3 { animation-delay: 0.3s; }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate { opacity: 0; }

    /* XP Popup */
    .xp-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: linear-gradient(135deg, var(--gold), #f0c040);
      color: var(--navy);
      padding: 1.5rem 2.5rem;
      border-radius: 12px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 2rem;
      font-weight: 700;
      z-index: 1000;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      transition: transform 0.3s ease;
    }
    .xp-popup.show { transform: translate(-50%, -50%) scale(1); }
    .xp-popup .xp-amount { font-size: 3rem; display: block; }

    /* Badge Modal */
    .badge-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
    }
    .badge-modal.show { display: flex; }
    @keyframes badgeBounce {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }
    .badge-modal.show .badge-modal-icon {
      animation: badgeBounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    .badge-modal-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 2px solid var(--gold);
      border-radius: 16px;
      padding: 2rem;
      text-align: center;
      max-width: 350px;
    }
    .badge-modal-icon { font-size: 4rem; margin-bottom: 1rem; }
    .badge-modal-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.5rem;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }
    .badge-modal-desc { font-size: 0.9rem; opacity: 0.8; margin-bottom: 1rem; }
    .badge-modal-close {
      padding: 0.5rem 1.5rem;
      background: var(--gold);
      color: var(--navy);
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }

    /* Confetti */
    .confetti-container {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 999;
      overflow: hidden;
    }
    .confetti {
      position: absolute;
      width: 10px; height: 10px;
      opacity: 0;
      animation: confetti-fall 3s ease-out forwards;
    }
    @keyframes confetti-fall {
      0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      .confetti { display: none; }
    }

    /* Nav */
    .slide-nav {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      padding: 0.75rem 1rem 1.25rem;
      z-index: 100;
      pointer-events: none;
    }
    .nav-btn {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 1.1rem;
      cursor: pointer;
      opacity: 0.6;
      transition: all 0.2s;
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      pointer-events: auto;
    }
    .nav-btn:hover { opacity: 1; background: rgba(0,0,0,0.7); border-color: var(--gold); }
    .nav-btn:active { transform: scale(0.95); }
    .nav-btn:disabled { opacity: 0.2; cursor: not-allowed; }
    .nav-btn:focus-visible { outline: 3px solid var(--gold); outline-offset: 2px; }
    .nav-center { display: flex; flex-direction: column; align-items: center; gap: 0.2rem; pointer-events: auto; }
    .slide-counter { font-size: 0.7rem; opacity: 0.5; }
    .progress-dots { display: flex; gap: 6px; flex-wrap: wrap; justify-content: center; max-width: 280px; }
    .progress-dot {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: transparent;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      padding: 0;
      appearance: none;
      position: relative;
    }
    .progress-dot::after {
      content: '';
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255,255,255,0.25);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.2s;
    }
    .progress-dot.active::after { width: 14px; height: 14px; background: var(--gold); transform: translate(-50%, -50%); }
    .progress-dot:focus-visible { outline: 2px solid var(--gold); outline-offset: 2px; }

    /* Mobile */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -300px;
        top: 0;
        bottom: 0;
        z-index: 1000;
        transition: left 0.3s ease;
      }
      .sidebar.open { left: 0; }
      .sidebar-toggle {
        display: flex;
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 1001;
        width: 40px;
        height: 40px;
        background: var(--gold);
        color: var(--navy);
        border: none;
        border-radius: 8px;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        cursor: pointer;
      }
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
      }
      .sidebar-overlay.show { display: block; }
    }
    @media (min-width: 769px) {
      .sidebar-toggle { display: none; }
      .sidebar-overlay { display: none !important; }
    }

    /* Combo Counter */
    .combo-display {
      position: fixed;
      top: 80px;
      right: 20px;
      background: linear-gradient(135deg, var(--orange), #ef4444);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.9rem;
      z-index: 500;
      transform: scale(0);
      transition: transform 0.3s ease;
      box-shadow: 0 4px 15px rgba(239,68,68,0.4);
    }
    .combo-display.show { transform: scale(1); }

    /* Quote Block */
    .quote-block {
      background: linear-gradient(135deg, rgba(15,118,110,0.2), rgba(30,39,97,0.2));
      border-left: 4px solid var(--teal);
      padding: 1.25rem;
      margin: 0.75rem 0;
      max-width: 700px;
      width: 100%;
      border-radius: 0 8px 8px 0;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      font-style: italic;
    }
    .quote-attribution {
      margin-top: 0.75rem;
      font-size: 0.85rem;
      font-style: normal;
      color: var(--teal);
    }

    /* Course Completion Overlay */
    .completion-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1002;
    }
    .completion-overlay.show { display: flex; }
    .completion-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 2px solid var(--gold);
      border-radius: 16px;
      padding: 2.5rem;
      text-align: center;
      max-width: 450px;
      width: 90%;
    }
    .completion-icon { font-size: 3rem; margin-bottom: 1rem; color: var(--gold); }
    .completion-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 2rem;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }
    .completion-subtitle {
      font-size: 1rem;
      color: rgba(255,255,255,0.7);
      margin-bottom: 1.5rem;
    }
    .completion-stats {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .completion-stat {
      text-align: center;
    }
    .completion-stat-value {
      font-family: 'Cormorant Garamond', serif;
      font-size: 2rem;
      font-weight: 700;
      color: var(--gold);
    }
    .completion-stat-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }
    .completion-actions { display: flex; gap: 0.75rem; justify-content: center; }

    /* Level Up Modal */
    .level-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1003;
    }
    .level-modal.show { display: flex; }
    .level-modal-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 2px solid var(--gold);
      border-radius: 16px;
      padding: 2.5rem;
      text-align: center;
      max-width: 380px;
      width: 90%;
      animation: levelModalPop 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    @keyframes levelModalPop {
      0% { transform: scale(0); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .level-modal-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      animation: levelIconPulse 1s ease-in-out infinite;
    }
    @keyframes levelIconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    .level-modal-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.8rem;
      color: var(--gold);
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    .level-modal-level {
      font-family: 'Cormorant Garamond', serif;
      font-size: 3rem;
      font-weight: 700;
      color: var(--cream);
      margin-bottom: 0.25rem;
    }
    .level-modal-name {
      font-size: 1.2rem;
      color: var(--gold);
      margin-bottom: 1.5rem;
      font-weight: 600;
    }

    /* Tablet breakpoint */
    @media (max-width: 1024px) and (min-width: 769px) {
      .sidebar { width: 280px; }
    }

    /* Small mobile improvements */
    @media (max-width: 480px) {
      .decision-option {
        padding: 1rem 1.25rem;
        font-size: 0.95rem;
      }
    }

    /* Landscape orientation handling */
    @media (orientation: landscape) and (max-height: 500px) {
      .slide-content { padding: 1rem; }
      .slide .title { font-size: 1.5rem; }
      .slide-nav { padding: 0.5rem; }
    }

    /* Safe area insets for notched devices */
    @supports (padding-bottom: env(safe-area-inset-bottom)) {
      .sidebar {
        padding-bottom: max(1rem, env(safe-area-inset-bottom));
      }
      .slide-nav {
        padding-bottom: max(1rem, env(safe-area-inset-bottom));
      }
    }
  </style>
</head>
<body>
<a class="skip-link" href="#main-content">Skip to main content</a>
<div class="course-container">
<!-- Sidebar -->
<nav aria-label="è¯¾ç¨‹å¯¼èˆª" class="sidebar" role="navigation">
<div class="sidebar-header">
<a href="index.html" onmouseout="this.style.color='rgba(212,175,55,0.7)'" onmouseover="this.style.color='#D4AF37'" style="display:block;font-size:0.7rem;color:rgba(212,175,55,0.7);text-decoration:none;margin-bottom:0.5rem;">â† Course Library</a>
<h1>Umbrella Reviews</h1>
<p>è¯„è®ºä¸­çš„è¯„è®º</p>
</div>
<div class="stats-panel">
<div class="level-display">
<div class="level-badge" id="levelIcon">RR</div>
<div class="level-info">
<div class="level-title" id="levelTitle">Review Reader</div>
<div class="level-subtitle">Level <span id="levelNum">1</span></div>
</div>
</div>
<div class="xp-bar"><div class="xp-fill" id="xpFill" style="width: 0%"></div></div>
<div class="xp-text"><span id="xpCurrent">0</span> / <span id="xpNeeded">100</span> XP</div>
<div class="quick-stats">
<div class="quick-stat">
<div class="quick-stat-value" id="correctCount">0</div>
<div class="quick-stat-label">Correct</div>
</div>
<div class="quick-stat">
<div class="quick-stat-value" id="decisionCount">0</div>
<div class="quick-stat-label">Decisions</div>
</div>
<div class="quick-stat">
<div class="quick-stat-value" id="synthesisCount">0</div>
<div class="quick-stat-label">Reviews</div>
</div>
</div>
</div>
<div class="course-progress">
<div class="course-progress-label">
<span>Course Progress</span>
<span id="courseProgressPct">0%</span>
</div>
<div class="course-progress-bar">
<div class="course-progress-fill" id="courseProgressFill" style="width: 0%"></div>
</div>
</div>
<div class="module-list" id="moduleList" role="list"></div>
<div class="badges-panel">
<div class="badges-title">Achievements</div>
<div class="badges-grid" id="badgesGrid"></div>
</div>
</nav>
<!-- Main Content -->
<main class="main-content" id="main-content">
<header class="content-header">
<div class="breadcrumb">Umbrella Reviews / <span id="currentModule">Module 1</span></div>
<div class="header-actions">
<div class="streak-display" id="streakDisplay">
<span aria-hidden="true" class="streak-flame">ğŸ”¥</span>
<span class="streak-count" id="streakCount">0</span>
<span>day streak</span>
</div>
<button class="btn" onclick="resetProgress()">Reset</button>
</div>
</header>
<div class="content-body">
<div class="slides-container" id="slidesContainer"></div>
</div>
</main>
</div>
<!-- XP Popup -->
<div aria-atomic="true" aria-live="polite" class="xp-popup" id="xpPopup" role="status">
<span class="xp-amount" id="xpAmount">+25</span>
    XP
  </div>
<!-- Badge Modal -->
<div aria-labelledby="badgeModalTitle" aria-modal="true" class="badge-modal" id="badgeModal" role="dialog">
<div class="badge-modal-content">
<div class="badge-modal-icon" id="badgeModalIcon">AW</div>
<div class="badge-modal-title" id="badgeModalTitle">Badge Earned!</div>
<div class="badge-modal-desc" id="badgeModalDesc">æ‚¨è§£é”äº†ä¸€é¡¹æ–°æˆå°±</div>
<button class="badge-modal-close" onclick="closeBadgeModal()">Awesome!</button>
</div>
</div>
<!-- Confetti Container -->
<div class="confetti-container" id="confettiContainer"></div>
<!-- Combo Counter -->
<div aria-live="polite" class="combo-display" id="comboDisplay" role="status">COMBO <span id="comboCount">0</span>x</div>
 è¯¾ç¨‹å®Œæˆè¦†ç›– 
<div class="completion-overlay" id="completionOverlay">
<div class="completion-content">
<div class="completion-icon">ğŸ†</div>
<div class="completion-title">Course Complete!</div>
<div class="completion-subtitle">You have mastered umbrella reviews.</div>
<div class="completion-stats">
<div class="completion-stat">
<div class="completion-stat-value" id="completionXP">0</div>
<div class="completion-stat-label">Total XP</div>
</div>
<div class="completion-stat">
<div class="completion-stat-value" id="completionBadges">0</div>
<div class="completion-stat-label">Badges Earned</div>
</div>
<div class="completion-stat">
<div class="completion-stat-value" id="completionLevel">1</div>
<div class="completion-stat-label">Final Level</div>
</div>
</div>
<div class="completion-actions">
<button class="btn primary" onclick="downloadCertificate()">Download Certificate</button>
<button class="btn" onclick="reviewBadges()">Review Badges</button>
<button class="btn" onclick="closeCompletion()">Close</button>
</div>
</div>
</div>
<!-- Level Up Modal -->
<div aria-hidden="true" aria-labelledby="levelModalTitle" aria-modal="true" class="level-modal" id="levelModal" role="dialog">
<div class="level-modal-content">
<div class="level-modal-icon">ğŸ–ï¸</div>
<div class="level-modal-title" id="levelModalTitle">Level Up!</div>
<div class="level-modal-level" id="levelModalLevel">Level 2</div>
<div class="level-modal-name" id="levelModalName">Search Scout</div>
<button class="btn primary" onclick="closeLevelModal()">Continue</button>
</div>
</div>
<!-- Mobile Sidebar Toggle -->
<button aria-expanded="false" aria-label="Toggle menu" class="sidebar-toggle" onclick="toggleSidebar()">MENU</button>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
<script>
// ===== GAMIFICATION STATE =====
const DEFAULT_STATE = {
  xp: 0,
  level: 1,
  streak: 0,
  lastActive: null,
  correctAnswers: 0,
  decisionsCompleted: 0,
  synthesisCount: 0,
  badges: [],
  completedModules: [],
  answeredQuestions: {},
  consecutiveCorrect: 0,
  courseCompleted: false
};

function safeGetStorage(key, fallback) {
  try {
    const item = localStorage.getItem(key);
    return item ? JSON.parse(item) : fallback;
  } catch (e) {
    return fallback;
  }
}

function safeSetStorage(key, value) {
  try {
    localStorage.setItem(key, JSON.stringify(value));
  } catch (e) {}
}

// Migration from old storage key to versioned key
(function migrateStorage() {
  try {
    const oldData = localStorage.getItem('umbrellaReviewGame');
    if (oldData && !localStorage.getItem('umbrellaReviewGame_v1')) {
      localStorage.setItem('umbrellaReviewGame_v1', oldData);
      localStorage.removeItem('umbrellaReviewGame');
    }
  } catch (e) {}
})();

let gameState = safeGetStorage('umbrellaReviewGame_v1', DEFAULT_STATE);

const LEVELS = [
  { level: 1, title: "Review Reader", icon: "RR", xp: 0 },
  { level: 2, title: "Search Scout", icon: "SS", xp: 120 },
  { level: 3, title: "Quality Assessor", icon: "QA", xp: 300 },
  { level: 4, title: "Overlap Analyst", icon: "OA", xp: 520 },
  { level: 5, title: "Evidence Synthesizer", icon: "ES", xp: 780 },
  { level: 6, title: "Gap Mapper", icon: "GM", xp: 1050 },
  { level: 7, title: "Reporting Expert", icon: "RE", xp: 1350 },
  { level: 8, title: "Umbrella Master", icon: "UM", xp: 1700 }
];

const BADGES = [
  { id: "canopy_explorer", icon: "\u{1F333}", name: "Canopy Explorer", desc: "å®Œæˆæ¨¡å— 1ï¼šå¤©ç¯·" },
  { id: "first_scenario", icon: "\u{1F3AF}", name: "First Scenario", desc: "å®Œæˆæ‚¨çš„ç¬¬ä¸€ä¸ªå†³ç­–åœºæ™¯" },
  { id: "harvest_expert", icon: "\u{1F33E}", name: "Harvest Expert", desc: "å®Œæˆæ”¶è·æ¨¡å—" },
  { id: "quality_judge", icon: "\u{1F50D}", name: "Quality Judge", desc: "å®Œæˆé€é•œæ¨¡å—" },
  { id: "overlap_detective", icon: "\u{1F50E}", name: "Overlap Detective", desc: "å®Œæˆé‡å æ¨¡å—" },
  { id: "evidence_weaver", icon: "\u{1F9F5}", name: "Evidence Weaver", desc: "å®Œæˆåˆæˆæ¨¡å—" },
  { id: "gap_finder", icon: "\u{1F5FA}", name: "Gap Finder", desc: "å®Œæˆåœ°å›¾æ¨¡å—" },
  { id: "report_champion", icon: "\u{1F4DC}", name: "Report Champion", desc: "å®ŒæˆæŠ¥å‘Šæ¨¡å—" },
  { id: "perfect_5", icon: "\u{2B50}", name: "Five Star", desc: "Get 5 correct answers in a row" },
  { id: "decision_maker", icon: "\u{1F9E0}", name: "Decision Maker", desc: "å®Œæˆæ‰€æœ‰ 21 ä¸ªå†³ç­–åœºæ™¯" },
  { id: "finisher", icon: "\u{1F3C6}", name: "Course Complete", desc: "å®Œæˆæ•´ä¸ªè¯¾ç¨‹" },
  { id: "streak_3", icon: "\u{1F525}", name: "On Fire", desc: "Maintain a 3-day streak" },
  { id: "streak_7", icon: "\u{1F4AA}", name: "Weekly Warrior", desc: "Maintain a 7-day streak" }
];

// ===== MODULES DATA =====
const MODULES = [
  {
    id: 1, title: "The Canopy", subtitle: "ä¸ºä»€ä¹ˆä¸€é¡¹è¯„å®¡è¿˜ä¸å¤Ÿ", xp: 160,
    slides: [
      { type: "title", theme: "teal-bg", content: { title: "Umbrella Reviews", subtitle: "å½“ä¸€é¡¹ç³»ç»Ÿè¯„å®¡ä¸å¤Ÿæ—¶" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Explain why multiple systematic reviews on the same topic create confusion",
          "å®šä¹‰æ€»ä½“è¯„å®¡åŠå…¶ä¸æ ‡å‡†ç³»ç»Ÿè¯„å®¡çš„åŒºåˆ«è¯„å®¡",
          "ç¡®å®šä¼å¼è¯„å®¡ä½•æ—¶æ˜¯æ­£ç¡®çš„è®¾è®¡é€‰æ‹©",
          "è¯†åˆ«ä¼å¼è¯„å®¡å·¥ä½œæµç¨‹ä¸­çš„æ ¸å¿ƒæ­¥éª¤"
        ],
        tip: "ä¼å¼è¯„å®¡ä¸ä¼šæ±‡é›†ä¸»è¦ç ”ç©¶ã€‚å®ƒæ±‡é›†äº†ç³»ç»Ÿè¯„ä»·çš„ç»“è®ºã€‚"
      }},
      { type: "story", theme: "red-bg", content: {
        label: "THE FLOOD", title: "When five reviews gave five answers",
        text: "æŒ‡å—å°ç»„å‘ç°äº†é’ˆå¯¹åŒä¸€å¹²é¢„æªæ–½çš„äº”é¡¹ç³»ç»Ÿè¯„ä»·ã€‚ä¸‰äººè¯´å®ƒæœ‰æ•ˆï¼Œä¸€åä¸ç¡®å®šï¼Œä¸€åè­¦å‘Šè¯´ä¼šé€ æˆä¼¤å®³ã€‚æ¯ä¸ªéƒ½ä½¿ç”¨ä¸åŒçš„æœç´¢æ—¥æœŸã€çº³å…¥æ ‡å‡†å’Œè´¨é‡å·¥å…·ã€‚ä¸“å®¶ç»„æ— æ³•å†³å®šä¿¡ä»»å“ªä¸€ä¸ªã€‚",
        followup: "ä¼å¼å®¡æŸ¥æ­£æ˜¯åœ¨æ­¤æ—¶æ­¤åˆ»å­˜åœ¨çš„ï¼šç«™åœ¨å„ä¸ªå®¡æŸ¥ä¹‹ä¸Šå¹¶è¯„ä¼°æ•´ä¸ªæƒ…å†µã€‚"
      }},
      { type: "story", theme: "gold-bg", content: {
        label: "THE PAIR", title: "Two teams, two strategies",
        text: "Team A conducted a sixth systematic review on the same topic, adding to the noise. Team B conducted an umbrella review: they mapped all existing reviews, assessed their quality, checked for overlap, and synthesized conclusions across them.",
        followup: "B å›¢é˜Ÿåˆ¶ä½œäº†ä¸€ä»½æ–‡ä»¶ï¼Œè§£é‡Šäº†å®¡æŸ¥ä¸åŒæ„çš„åŸå› ä»¥åŠå“ªäº›ç»“è®ºå€¼å¾—ä¿¡èµ–ã€‚",
        warning: true
      }},
      { type: "stats", theme: "dark", content: {
        title: "è¯æ®æ™¯è§‚",
        stats: [
          { value: "8000+", label: "Systematic reviews published yearly" },
          { value: "multiple", label: "æ¯ä¸ªä¸´åºŠé—®é¢˜çš„è¯„è®º" },
          { value: "30-50%", label: "Overlap in primary studies across SRs" },
          { value: "growing", label: "éœ€è¦å¤§è§„æ¨¡çš„è¯æ®ç»¼åˆ" }
        ],
        caption: "æ¥è‡ªæ–‡çŒ®è®¡é‡ç ”ç©¶çš„è¿‘ä¼¼æ•°å­—ã€‚"
      }},
      { type: "concept", theme: "dark", content: {
        title: "ä»€ä¹ˆæ˜¯æ€»ä½“å®¡æŸ¥",
        subtitle: "ç³»ç»Ÿè¯„ä»·è¯„è®º",
        text: "ä¼å¼è¯„è®ºï¼ˆä¹Ÿç§°ä¸ºè¯„è®ºæ¦‚è¿°æˆ–å…ƒè¯„è®ºï¼‰ç³»ç»Ÿåœ°è¯†åˆ«ã€è¯„ä¼°å’Œç»¼åˆç›¸å…³ä¸»é¢˜çš„å¤šä¸ªç³»ç»Ÿè¯„è®ºçš„å‘ç°ã€‚åˆ†æå•ä½æ˜¯ç³»ç»Ÿç»¼è¿°æœ¬èº«ï¼Œè€Œä¸æ˜¯ä¸»è¦ç ”ç©¶ã€‚",
        highlight: "ä¼å¼ç»¼è¿°ä¸ä¼šé‡åšåŸå§‹å·¥ä½œã€‚å®ƒä¼šå¯¹å…¶è¿›è¡Œè¯„ä¼°ã€æ¯”è¾ƒå’Œæ˜ å°„ã€‚"
      }},
      { type: "checklist", theme: "dark", content: {
        title: "ä½•æ—¶é€‰æ‹©æ€»ä½“å®¡æŸ¥",
        items: [
          "Multiple systematic reviews already exist on the topic",
          "Reviews reach discordant conclusions",
          "Decision makers need a single trustworthy summary",
          "æ‚¨éœ€è¦åœ¨ä¸€ä¸ªå¹¿æ³›çš„é—®é¢˜ä¸Šæ‰¾å‡ºè¯æ®å·®è·",
          "èµ„æºä¸è¶³ä»¥é‡åšæ‰€æœ‰åˆæ­¥ç ”ç©¶"
        ]
      }},
      { type: "decision", theme: "dark", content: {
        icon: "RR", title: "Scenario: Design Choice", xp: 25,
        scenario: "å«ç”Ÿéƒ¨è¦æ±‚æä¾›æœ‰å…³ç»´ç”Ÿç´  D å’Œå‘¼å¸é“æ„ŸæŸ“çš„è¯æ®ã€‚å·²ç»å­˜åœ¨åäºŒé¡¹ç³»ç»Ÿè¯„ä»·ï¼Œç»“è®ºå„å¼‚ã€‚",
        question: "æœ€åˆé€‚çš„ç ”ç©¶è®¾è®¡æ˜¯ä»€ä¹ˆï¼Ÿ",
        options: [
          { letter: "A", text: "è¿›è¡Œç¬¬åä¸‰æ¬¡ç³»ç»Ÿè¯„ä»·", correct: false },
          { letter: "B", text: "å¯¹åäºŒé¡¹è¿›è¡Œæ€»ä½“è¯„ä»·", correct: true },
          { letter: "C", text: "é€‰æ‹©æœ€æ–°çš„è¯„ä»· only", correct: false },
          { letter: "D", text: "Narrative opinion piece", correct: false }
        ],
        feedback: {
          correct: "Correct.å½“å¤šä¸ª SR å­˜åœ¨ä¸åŒçš„ç»“è®ºæ—¶ï¼Œä¼å¼å®¡æŸ¥ä¼šç³»ç»Ÿåœ°ç»¼åˆå’Œè¯„ä¼°å®ƒä»¬ã€‚",
          incorrect: "å‘æ‹¥æŒ¤çš„é¢†åŸŸæ·»åŠ å¦ä¸€ä¸ª SR ä¼šå¢åŠ å™ªéŸ³ã€‚ä¼å¼å®¡æŸ¥å¯¹ç°æœ‰è¯æ®è¿›è¡Œç»„ç»‡ã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "RR", title: "åœºæ™¯ï¼šåˆ†æå•å…ƒ", xp: 25,
        scenario: "ç ”ç©¶äººå‘˜è®¡åˆ’è¿›è¡Œä¼å¼å®¡æŸ¥ã€‚ä»–ä»¬ä»åŒ…å«çš„ç³»ç»Ÿè¯„ä»·ä¸­æ‰¾åˆ°çš„æ¯ä¸ª RCT ä¸­æå–æ•°æ®ã€‚",
        question: "é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ",
        options: [
          { letter: "A", text: "æ²¡ä»€ä¹ˆï¼Œè¿™æ˜¯æ­£ç¡®çš„ç¨‹åº", correct: false },
          { letter: "B", text: "åˆ†æå•ä½åº”è¯¥æ˜¯ SRï¼Œè€Œä¸æ˜¯ RCT", correct: true },
          { letter: "C", text: "They should only include meta-analyses", correct: false },
          { letter: "D", text: "They need more RCTs", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®çš„ã€‚åœ¨æ€»ä½“è¯„ä»·ä¸­ï¼Œç³»ç»Ÿè¯„ä»·æ˜¯åˆ†æå•ä½ã€‚æå–ä¸»è¦ç ”ç©¶æ•°æ®äº¤å‰åˆ°ä¸åŒçš„è®¾è®¡ä¸­ã€‚",
          incorrect: "ä¼å½¢è¯„è®ºå°†ç³»ç»Ÿè¯„ä»·ä½œä¸ºå…¶å•ä½è¿›è¡Œåˆ†æã€‚è¿”å›åˆ°åˆæ­¥ç ”ç©¶ï¼Œå°†è®¾è®¡æ›´æ”¹ä¸ºä¼ ç»Ÿçš„ SR æˆ–é‡æ–°åˆ†æã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "RR", title: "Scenario: Too Few Reviews", xp: 25,
        scenario: "Only one systematic review exists on a rare disease intervention.",
        question: "æ‚¨åº”è¯¥è¿›è¡Œæ€»ä½“å®¡æŸ¥å—ï¼Ÿ",
        options: [
          { letter: "A", text: "Yes, any topic can have an umbrella review", correct: false },
          { letter: "B", text: "No, an umbrella review requires multiple SRs to compare", correct: true },
          { letter: "C", text: "Only if the single SR is low quality", correct: false },
          { letter: "D", text: "Only if the disease is common enough", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚ä¼å¼è¯„è®ºæ—¨åœ¨æ¯”è¾ƒå’Œç»¼åˆå¤šä¸ª SRã€‚å¦‚æœåªæœ‰ä¸€ä¸ªï¼Œè¯·æ›´æ–°æˆ–å¤åˆ¶ SRã€‚",
          incorrect: "An umbrella review needs multiple systematic reviews to fulfill its purpose of cross-review synthesis."
        }
      }},
      { type: "refrain", theme: "black", content: { text: "When reviews multiply, the umbrella gathers them." }}
    ]
  },
  {
    id: 2, title: "The Harvest", subtitle: "æŸ¥æ‰¾å’Œé€‰æ‹©è¯„è®º", xp: 150,
    slides: [
      { type: "title", theme: "gold-bg", content: { title: "The Harvest", subtitle: "æ”¶é›†æ¯æ¡ç›¸å…³è¯„è®º" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Design a search strategy targeting systematic reviews",
          "Apply eligibility criteria specific to umbrella reviews",
          "Handle borderline study designs (scoping reviews, rapid reviews)",
          "Document selection with a modified PRISMA flow"
        ],
        tip: "ä¼å¼è¯„è®ºçš„æ”¶è·å¹¶ä¸æ˜¯å¯»æ‰¾è¯•éªŒã€‚è¿™æ˜¯å…³äºæŸ¥æ‰¾å·²ç»æ‰¾åˆ°è¯•éªŒçš„ç»¼è¿°ã€‚"
      }},
      { type: "story", theme: "gold-bg", content: {
        label: "THE NET", title: "å½“æœç´¢é”™è¿‡äº†ä¸€åŠçš„ç»¼è¿°æ—¶",
        text: "ä¼å¼ç»¼è¿°ä»…æœç´¢äº† MEDLINEï¼Œé”™è¿‡äº†åœ¨åŒºåŸŸæ•°æ®åº“ã€Cochrane å’Œ PROSPERO æ³¨å†Œçš„ç»¼è¿°ä¸­å‘è¡¨çš„ç³»ç»Ÿç»¼è¿°åŠå…¶ç»“æœã€‚æœ€ç»ˆçš„ç»¼åˆç»“æœä¸å®Œæ•´ï¼Œå¹¶ä¸”åå‘è‹±æ–‡æœŸåˆŠã€‚",
        followup: "Searching for systematic reviews requires the same rigor as searching for primary studies: multiple databases, grey literature, and hand-searching reference lists of included reviews.",
        warning: true
      }},
      { type: "stats", theme: "dark", content: {
        title: "Search Sources for Systematic Reviews",
        stats: [
          { value: "MEDLINE", label: "Core biomedical database" },
          { value: "Cochrane", label: "Largest SR repository" },
          { value: "Epistemonikos", label: "SR-specific database" },
          { value: "PROSPERO", label: "SR protocol registry" }
        ],
        caption: "Key sources; additional databases depend on the topic."
      }},
      { type: "concept", theme: "dark", content: {
        title: "ç»¼è¿°æœç´¢ç­–ç•¥",
        subtitle: "è¿‡æ»¤æ­£ç¡®çš„ç ”ç©¶è®¾è®¡",
        text: "ä½¿ç”¨ç»è¿‡éªŒè¯çš„æœç´¢è¿‡æ»¤å™¨è¿›è¡Œç³»ç»Ÿè¯„ä»·å’ŒèŸèƒåˆ†æã€‚å°†ä¸»é¢˜æœ¯è¯­ä¸æ–¹æ³•è¿‡æ»¤å™¨ç›¸ç»“åˆã€‚æ£€æŸ¥ SR ç‰¹å®šçš„æ•°æ®åº“ï¼Œä¾‹å¦‚ Epistemonikos å’Œ Cochrane ç³»ç»Ÿè¯„ä»·æ•°æ®åº“ã€‚ç­›é€‰ PROSPERO ä»¥è·å–å·²å®Œæˆä½†æœªå‘è¡¨çš„è¯„è®ºã€‚",
        highlight: "é”™è¿‡çš„è¯„è®ºå°±æ˜¯é”™è¿‡çš„è§‚ç‚¹ã€‚å…¨é¢æ£€ç´¢ä¸æ˜¯å¯é€‰çš„ã€‚"
      }},
      { type: "checklist", theme: "dark", content: {
        title: "Harvest Checklist",
        items: [
          "Search at least three major databases with SR filters",
          "åŒ…æ‹¬ Cochrane å›¾ä¹¦é¦†å’Œ Epistemonikos",
          "Check PROSPERO for registered reviews",
          "Hand-search reference lists of included reviews",
          "Define clear eligibility criteria before screening"
        ]
      }},
      { type: "decision", theme: "dark", content: {
        icon: "SS", title: "åœºæ™¯ï¼šèŒƒå›´ç•Œå®šå®¡æŸ¥", xp: 25,
        scenario: "åœ¨ç­›é€‰è¿‡ç¨‹ä¸­ï¼Œæ‚¨ä¼šå‘ç°ä¸€ä¸ªè¿›è¡Œè‰¯å¥½çš„èŒƒå›´ç•Œå®šå®¡æŸ¥ï¼Œå®ƒæ˜ å°„äº†æ‚¨çš„ä¸»é¢˜çš„è¯æ®ï¼Œä½†æ²¡æœ‰æ±‡é›†æ•ˆåº”å¤§å°ã€‚",
        question: "åº”è¯¥æ‚¨å°†å…¶çº³å…¥æ‚¨çš„æ€»ä½“è¯„è®ºä¸­å—ï¼Ÿ",
        options: [
          { letter: "A", text: "Yes, include all review types", correct: false },
          { letter: "B", text: "Exclude it; umbrella reviews include only systematic reviews", correct: true },
          { letter: "C", text: "Include it but label it differently", correct: false },
          { letter: "D", text: "Include only its reference list", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚æ€»ä½“è¯„ä»·é€šå¸¸ä»…åŒ…æ‹¬ç³»ç»Ÿè¯„ä»·ï¼ˆæœ‰æˆ–æ²¡æœ‰èŸèƒåˆ†æï¼‰ã€‚èŒƒå›´å®¡æŸ¥ä½¿ç”¨ä¸åŒçš„æ–¹æ³•å’Œè´¨é‡æ ‡å‡†ã€‚",
          incorrect: "èŒƒå›´å®¡æŸ¥éµå¾ªä¸åŒçš„æ–¹æ³•ï¼Œä¸èƒ½ä½¿ç”¨ AMSTAR 2 ç­‰ SR è´¨é‡å·¥å…·è¿›è¡Œè¯„ä¼°ã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "SS", title: "åœºæ™¯ï¼šè¿‡æ—¶çš„å®¡æŸ¥", xp: 25,
        scenario: "2008 å¹´çš„ç³»ç»Ÿå®¡æŸ¥ç¬¦åˆæ‚¨çš„èµ„æ ¼æ ‡å‡†ï¼Œä½†å·²è¢« 2008 å¹´çš„æ›´æ–°ç‰ˆæœ¬æ‰€å–ä»£2022.",
        question: "æ‚¨åº”è¯¥å¦‚ä½•å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Ÿ",
        options: [
          { letter: "A", text: "Include both versions as separate entries", correct: false },
          { letter: "B", text: "Include only the most recent version", correct: true },
          { letter: "C", text: "Exclude both to avoid double counting", correct: false },
          { letter: "D", text: "Merge them into one entry", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚å½“ç»¼è¿°æ­£å¼æ›´æ–°åï¼Œä»…åŒ…å«æœ€æ–°ç‰ˆæœ¬ï¼Œä»¥é¿å…é‡å¤è®¡ç®—ç›¸åŒçš„è¯æ®åŸºç¡€ã€‚",
          incorrect: "åŒ…å«ä¸¤ä¸ªç‰ˆæœ¬å°†ä¼šé‡å¤è®¡ç®—ç›¸åŒçš„ä¸»è¦ç ”ç©¶ã€‚æ›´æ–°ç‰ˆæœ¬å–ä»£åŸå§‹ç‰ˆæœ¬ã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "SS", title: "Scenario: Protocol Screening", xp: 25,
        scenario: "æ‚¨å‘ç° PROSPERO æ³¨å†Œçš„ç³»ç»Ÿç»¼è¿°ä¸æ‚¨çš„ä¸»é¢˜å®Œå…¨åŒ¹é…ï¼Œä½†æ²¡æœ‰å·²å‘è¡¨çš„ç»“æœã€‚",
        question: "ä½ åº”è¯¥åšä»€ä¹ˆï¼Ÿ",
        options: [
          { letter: "A", text: "å°†åè®®ä½œä¸ºå·²å®Œæˆçš„ç»¼è¿°çº³å…¥", correct: false },
          { letter: "B", text: "è”ç³»ä½œè€…ä»¥æ£€æŸ¥æœªå‘å¸ƒçš„ç»“æœ", correct: true },
          { letter: "C", text: "Ignore it entirely", correct: false },
          { letter: "D", text: "ç­‰å¾…æ— é™æœŸå‘å¸ƒ", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚è”ç³»ä½œè€…å¯ä»¥é€éœ²å·²å®Œæˆä½†æœªå‘è¡¨çš„è¯„è®ºï¼Œä»è€Œå‡å°‘æ€»ä½“è¯„è®ºä¸­çš„å‘è¡¨åè§ã€‚",
          incorrect: "Registered but unpublished reviews may contain important evidence. Author contact is a standard step to reduce bias."
        }
      }},
      { type: "refrain", theme: "black", content: { text: "é”™è¿‡è¯„è®ºçš„æ”¶è·å°±é”™è¿‡äº†çœŸç›¸ã€‚" }}
    ]
  },
  {
    id: 3, title: "The Lens", subtitle: "AMSTAR 2 çš„è´¨é‡è¯„ä¼°", xp: 160,
    slides: [
      { type: "title", theme: "purple-bg", content: { title: "The Lens", subtitle: "Not all reviews deserve equal trust" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Apply AMSTAR 2 to assess the methodological quality of included SRs",
          "Distinguish critical from non-critical domains",
          "Assign overall confidence ratings: high, moderate, low, critically low",
          "Use quality assessment to weight conclusions, not just exclude reviews"
        ],
        tip: "AMSTAR 2 ä¸æ˜¯åˆ†æ•°ã€‚è¿™æ˜¯ä¸€ç§ç»“æ„åŒ–çš„åˆ¤æ–­ï¼Œå¯¹è¯„å®¡ç»“æœçš„ç½®ä¿¡åº¦è¿›è¡Œåˆ†ç±»ã€‚"
      }},
      { type: "story", theme: "red-bg", content: {
        label: "THE FLAW", title: "When a flawed review drove policy",
        text: "å›½å®¶æŒ‡å—å¼•ç”¨äº†æ— åå€šè¯„ä¼°é£é™©å’Œä¸å®Œæ•´æ£€ç´¢çš„ç³»ç»Ÿè¯„å®¡ã€‚åæ¥çš„æ€»ä½“å®¡æŸ¥æ˜¾ç¤ºï¼Œè¯¥å®¡æŸ¥å¯¹ AMSTAR 2 çš„ä¿¡å¿ƒæä½ï¼Œè€Œä¸‰ä¸ªè¾ƒé«˜è´¨é‡çš„å®¡æŸ¥å¾—å‡ºäº†ç›¸åçš„ç»“è®ºã€‚",
        followup: "å¦‚æœæ²¡æœ‰è´¨é‡è¯„ä¼°ï¼Œå£°éŸ³æœ€å¤§çš„å®¡æŸ¥è·èƒœã€‚æœ‰äº†å®ƒï¼Œæœ€å€¼å¾—ä¿¡èµ–çš„è¯„è®ºå°±ä¼šé¢†å…ˆã€‚"
      }},
      { type: "concept", theme: "dark", content: {
        title: "AMSTAR 2ï¼šæ ‡å‡†å·¥å…·",
        subtitle: "16 items, 7 critical domains",
        text: "AMSTAR 2 evaluates systematic review methodology across 16 items. Seven are designated critical: protocol registration, comprehensive search, justification for exclusions, risk of bias assessment, appropriate meta-analytic methods, consideration of risk of bias in interpreting results, and assessment of publication bias.",
        highlight: "A single critical flaw drops the overall rating. Two or more critical flaws means critically low confidence."
      }},
      { type: "checklist", theme: "dark", content: {
        title: "AMSTAR 2 Critical Domains",
        items: [
          "å®¡æŸ¥å¼€å§‹å‰æ³¨å†Œçš„æ–¹æ¡ˆ",
          "Comprehensive literature search performed",
          "æ’é™¤ä¸ªåˆ«ç ”ç©¶çš„ç†ç”±",
          "çº³å…¥ç ”ç©¶çš„åå€šé£é™©è¯„ä¼°",
          "ç”¨äºèŸèƒåˆ†æçš„é€‚å½“æ–¹æ³•",
          "Risk of bias considered when interpreting results",
          "Publication bias assessed and discussed"
        ]
      }},
      { type: "amstar16", theme: "dark", content: {
        title: "AMSTAR 2: All 16 Items",
        subtitle: "7 Critical (starred) and 9 Non-critical items",
        critical: [
          { num: 2, text: "å®¡æŸ¥å¼€å§‹å‰æ³¨å†Œçš„æ–¹æ¡ˆ" },
          { num: 4, text: "Comprehensive literature search strategy" },
          { num: 7, text: "æ’é™¤ä¸ªåˆ«ç ”ç©¶çš„ç†ç”±ç ”ç©¶" },
          { num: 9, text: "Satisfactory technique for assessing risk of bias" },
          { num: 11, text: "é€‚å½“çš„èŸèƒåˆ†ææ–¹æ³•" },
          { num: 13, text: "Risk of bias considered when interpreting results" },
          { num: 15, text: "Publication bias assessed and discussed" }
        ],
        nonCritical: [
          { num: 1, text: "Research questions include PICO components" },
          { num: 3, text: "å®¡æŸ¥åœ¨è¿›è¡Œä¹‹å‰å»ºç«‹çš„æ–¹æ³•" },
          { num: 5, text: "ä¸€å¼ä¸¤ä»½è¿›è¡Œç ”ç©¶é€‰æ‹©" },
          { num: 6, text: "ä¸€å¼ä¸¤ä»½è¿›è¡Œæ•°æ®æå–" },
          { num: 8, text: "æ‰€å«å†…å®¹çš„å……åˆ†æè¿°ç ”ç©¶" },
          { num: 10, text: "æŠ¥å‘Šçš„çº³å…¥ç ”ç©¶çš„èµ„é‡‘æ¥æº" },
          { num: 12, text: "Impact of risk of bias on meta-analysis assessed" },
          { num: 14, text: "å¼‚è´¨æ€§è®¨è®ºå’Œè§£é‡Š" },
          { num: 16, text: "Conflicts of interest reported and managed" }
        ]
      }},
      { type: "stats", theme: "dark", content: {
        title: "Confidence Rating Scale",
        stats: [
          { value: "High", label: "No or one non-critical weakness" },
          { value: "Moderate", label: "More than one non-critical weakness" },
          { value: "Low", label: "One critical flaw with/without non-critical" },
          { value: "Crit. Low", label: "More than one critical flaw" }
        ],
        caption: "Based on the AMSTAR 2 classification scheme by Shea et al. 2017."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "QA", title: "Scenario: Missing Risk of Bias", xp: 25,
        scenario: "æ‚¨çš„æ€»ä½“è¯„ä»·ä¸­åŒ…å«çš„ç³»ç»Ÿè¯„ä»·æœªè¯„ä¼°å…¶ä»»ä½•ä¸»è¦ç ”ç©¶çš„åå€šé£é™©ã€‚",
        question: "ä»€ä¹ˆæ˜¯ AMSTAR 2",
        options: [
          { letter: "A", text: "Non-critical weakness only", correct: false },
          { letter: "B", text: "Critical flaw, drops confidence to low or critically low", correct: true },
          { letter: "C", text: "å¦‚æœèŸèƒåˆ†ææ­£ç¡®å®Œæˆï¼Œåˆ™ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“", correct: false },
          { letter: "D", text: "å®Œå…¨æ’é™¤è¯„è®º", correct: false }
        ],
        feedback: {
          correct: "Correct. Risk of bias assessment is a critical domain. Its absence constitutes a critical flaw.",
          incorrect: "Risk of bias assessment is one of the seven critical domains in AMSTAR 2. Missing it is a critical flaw."
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "QA", title: "Scenario: Quality Exclusion", xp: 25,
        scenario: "é™¤å…¶ä¸­ä¸€ç¯‡è¯„è®ºå¤–ï¼Œæ‰€æœ‰è¯„è®ºåœ¨ AMSTAR 2 ä¸Šçš„è¯„çº§éƒ½éå¸¸ä½ã€‚å…¶ä½™çš„è¯„çº§ä¸ºé«˜ã€‚",
        question: "æ‚¨åº”è¯¥å¦‚ä½•åœ¨æ‚¨çš„å¸æˆ·ä¸­å¤„ç†æ­¤é—®é¢˜",
        options: [
          { letter: "A", text: "Exclude all critically low reviews", correct: false },
          { letter: "B", text: "Include all but weight conclusions by quality rating", correct: true },
          { letter: "C", text: "å¹³å‡æ‰€æœ‰ç»“æœ", correct: false },
          { letter: "D", text: "ä»…æŠ¥å‘Šé«˜è´¨é‡ç»¼è¿°", correct: false }
        ],
        feedback: {
          correct: "Correct. Umbrella reviews should include all eligible reviews but use quality ratings to contextualize findings and weight conclusions.",
          incorrect: "Excluding low-quality reviews risks bias. Include them but clearly note how quality affects the strength of conclusions."
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "QA", title: "Scenario: Dual Assessment", xp: 25,
        scenario: "ä¸¤ä½å®¡ç¨¿äººå¯¹äºç³»ç»Ÿç»¼è¿°æ˜¯å¦ç¬¦åˆ AMSTAR 2 ç»¼åˆæ£€ç´¢æ ‡å‡†å­˜åœ¨åˆ†æ­§ã€‚",
        question: "ä»€ä¹ˆæ˜¯æœ€å¥½çš„å†³è®®ï¼Ÿ",
        options: [
          { letter: "A", text: "Accept the more generous rating", correct: false },
          { letter: "B", text: "è®¨è®ºã€åº”ç”¨å†³ç­–è§„åˆ™å¹¶è®°å½•å†³è®®", correct: true },
          { letter: "C", text: "æ’é™¤å®¡æ ¸ä»¥é¿å…åˆ†æ­§", correct: false },
          { letter: "D", text: "Let a third person decide without seeing the assessments", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚åº”é€šè¿‡ä¸é¢„å…ˆæŒ‡å®šçš„å†³ç­–è§„åˆ™è¿›è¡Œè®¨è®ºæ¥è§£å†³åˆ†æ­§ï¼Œå¹¶è®°å½•è§£å†³æ–¹æ¡ˆã€‚",
          incorrect: "å¸¦æœ‰æ–‡æ¡£çš„é€æ˜è§£å†³æ–¹æ¡ˆå¯ä¿æŒè´¨é‡è¯„ä¼°çš„å®Œæ•´æ€§ã€‚"
        }
      }},
      { type: "refrain", theme: "black", content: { text: "å¿½ç•¥è´¨é‡çš„é•œå¤´ä¼šæ”¾å¤§è¯¯å·®ã€‚" }}
    ]
  },
  {
    id: 4, title: "The Overlap", subtitle: "å½“è¯„å®¡å…±äº«ç›¸åŒçš„ç ”ç©¶æ—¶", xp: 160,
    slides: [
      { type: "title", theme: "green-bg", content: { title: "The Overlap", subtitle: "The hidden problem of double counting" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Explain why primary study overlap matters in umbrella reviews",
          "Calculate the Corrected Covered Area to quantify overlap",
          "Apply strategies to manage moderate and high overlap",
          "Report overlap transparently"
        ],
        tip: "å¦‚æœæœ‰äº”ä¸ªè¯„å®¡æ¯ä¸ªéƒ½åŒ…å«ç›¸åŒçš„ä¸‰ä¸ªéšæœºå¯¹ç…§è¯•éªŒï¼Œæ‚¨æ²¡æœ‰äº”ä¸ªç‹¬ç«‹çš„è¯æ®ã€‚æ‚¨çš„ä¸€ä¸ªè¯æ®åŸºç¡€è¢«è®¡æ•°äº†äº”æ¬¡ã€‚"
      }},
      { type: "story", theme: "red-bg", content: {
        label: "THE ECHO", title: "å½“åŒä¸€æ‚£è€…è¢«è®¡æ•°äº†ä¸‰æ¬¡",
        text: "ä¸€é¡¹ä¼å¼ç»¼è¿°æ±‡é›†äº†å››æ¬¡ç³»ç»Ÿè¯„ä»·çš„ç»“æœã€‚ä½œè€…ä¸çŸ¥é“çš„æ˜¯ï¼Œå››ç¯‡ç»¼è¿°ä¸­çš„ä¸‰ç¯‡åŒ…å«ç›¸åŒçš„å¤§å‹éšæœºå¯¹ç…§è¯•éªŒã€‚ The pooled result was driven almost entirely by a single trial counted multiple times, creating a false sense of precision.",
        followup: "Overlap detection is not optional.å¦‚æœæ²¡æœ‰å®ƒï¼Œä¼å¼è¯„è®ºåªä¼šæ”¾å¤§å›å£°è€Œä¸æ˜¯è¯æ®ã€‚"
      }},
      { type: "stats", theme: "dark", content: {
        title: "Overlap Thresholds (CCA)",
        stats: [
          { value: "0-5%", label: "Slight overlap" },
          { value: "6-10%", label: "Moderate overlap" },
          { value: "11-15%", label: "High overlap" },
          { value: ">15%", label: "Very high overlap" }
        ],
        caption: "Corrected Covered Area thresholds by Pieper et al. 2014."
      }},
      { type: "concept", theme: "dark", content: {
        title: "Corrected Covered Area (CCA)",
        subtitle: "ä¸»è¦ç ”ç©¶é‡å çš„æŒ‡æ ‡",
        text: "The CCA measures the degree to which the same primary studies appear across multiple systematic reviews. Build a citation matrix listing all primary studies (rows) against all included SRs (columns). Formula: CCA = (N &minus; r) / (r &times; c &minus; r), where N = total citations across all SRs, r = number of unique primary studies, and c = number of included SRs.",
        highlight: "é«˜åº¦é‡å æ„å‘³ç€æ‚¨çš„è¯„è®ºä¸æ˜¯ç‹¬ç«‹çš„ã€‚å°†å®ƒä»¬çš„ç»“æœè§†ä¸ºç›¸å…³çš„ï¼Œè€Œä¸æ˜¯ç´¯åŠ çš„ã€‚"
      }},
      { type: "checklist", theme: "dark", content: {
        title: "Overlap Management",
        items: [
          "Build a citation matrix of primary studies across SRs",
          "Calculate the Corrected Covered Area",
          "æŠ¥å‘Šé‡å ç¨‹åº¦åŠå…¶å½±å“",
          "Consider using only the most comprehensive or most recent SR per comparison",
          "åˆ‡å‹¿å°†é«˜åº¦é‡å çš„ SR çš„ç»“æœè§†ä¸ºç‹¬ç«‹"
        ]
      }},
      { type: "decision", theme: "dark", content: {
        icon: "OA", title: "Scenario: Very High Overlap", xp: 25,
        scenario: "æ‚¨çš„å¼•æ–‡çŸ©é˜µæ˜¾ç¤º 22% çš„ CCAã€‚å¤§å¤šæ•°è¯„è®ºå…±äº«ç›¸åŒçš„äº”ä¸ªæ ¸å¿ƒ RCTã€‚",
        question: "ç»¼åˆçš„æœ€ä½³æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ",
        options: [
          { letter: "A", text: "å°†æ‰€æœ‰è¯„è®ºç»“æœåˆå¹¶ä¸ºç‹¬ç«‹ä¼°è®¡", correct: false },
          { letter: "B", text: "Select the most comprehensive SR or conduct a de novo meta-analysis", correct: true },
          { letter: "C", text: "å¿½ç•¥é‡å å¹¶ç»§ç»­", correct: false },
          { letter: "D", text: "ä»æ‰€æœ‰è¯„è®ºä¸­åˆ é™¤é‡å ç ”ç©¶", correct: false }
        ],
        feedback: {
          correct: "Correct. With very high overlap, pooling is misleading. Select the most comprehensive review or return to primary data.",
          incorrect: "éå¸¸é«˜çš„é‡å æ„å‘³ç€è¯„è®ºä¸æ˜¯ç‹¬ç«‹æ¥æºã€‚åˆå¹¶ä¼šäº§ç”Ÿé”™è¯¯çš„ç²¾åº¦ã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "OA", title: "åœºæ™¯ï¼šæ„å»ºçŸ©é˜µ", xp: 25,
        scenario: "æ‚¨çº³å…¥çš„ä¸¤ç¯‡è¯„è®ºæœªåœ¨å…¶æ£®æ—å›¾æˆ–è¡¨æ ¼ä¸­åˆ—å‡ºå•ä¸ªç ”ç©¶å‚è€ƒæ–‡çŒ®ã€‚",
        question: "æ‚¨åº”è¯¥å¦‚ä½•å¤„ç†å¼•æ–‡çŸ©é˜µï¼Ÿ",
        options: [
          { letter: "A", text: "å‡è®¾è¿™äº›æ²¡æœ‰é‡å è¯„è®º", correct: false },
          { letter: "B", text: "Extract references from reference lists or contact authors", correct: true },
          { letter: "C", text: "ä»æ€»ä½“è¯„è®ºä¸­æ’é™¤è¿™äº›è¯„è®º", correct: false },
          { letter: "D", text: "Skip the citation matrix entirely", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚åº”åŠªåŠ›ä»å‚è€ƒæ–‡çŒ®åˆ—è¡¨ä¸­æˆ–é€šè¿‡è”ç³»ä½œè€…æ¥è¯†åˆ«çº³å…¥çš„ç ”ç©¶ã€‚",
          incorrect: "å¼•æ–‡çŸ©é˜µéœ€è¦äº†è§£æ¯ä¸ª SR åŒ…å«å“ªäº›ç ”ç©¶ã€‚åº”å¯»æ‰¾ç¼ºå¤±æ•°æ®ï¼Œè€Œä¸æ˜¯å‡è®¾ã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "OA", title: "Scenario: Slight Overlap", xp: 25,
        scenario: "æ‚¨çš„ CCA ä¸º 3%ã€‚ç”±äºæ£€ç´¢æ—¥æœŸå’Œçº³å…¥æ ‡å‡†ä¸åŒï¼Œæ¯ç¯‡ç»¼è¿°éƒ½ä½¿ç”¨äº†ä¸€ç»„å¾ˆå¤§ç¨‹åº¦ä¸Šç‹¬ç‰¹çš„ä¸»è¦ç ”ç©¶ã€‚",
        question: "è¿™å¯¹æ‚¨çš„ç»¼åˆæœ‰ä½•å½±å“ï¼Ÿ",
        options: [
          { letter: "A", text: "æ‚¨å¯ä»¥å°†è¿™äº›ç»¼è¿°è§†ä¸ºå¾ˆå¤§ç¨‹åº¦ä¸Šç‹¬ç«‹çš„", correct: true },
          { letter: "B", text: "æ‚¨ä»ç„¶å¿…é¡»ä»…é€‰æ‹©ä¸€é¡¹ç»¼è¿°", correct: false },
          { letter: "C", text: "Overlap is always a fatal problem", correct: false },
          { letter: "D", text: "æ‚¨åº”è¯¥åˆå¹¶æ‰€æœ‰ä¸»è¦ç ”ç©¶ç›¸å", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚è½»å¾®çš„é‡å æ„å‘³ç€è¯„è®ºæä¾›äº†å¾ˆå¤§ç¨‹åº¦ä¸Šç‹¬ç«‹çš„è¯æ®ã€‚åˆæˆå¯ä»¥é€‚å½“è°¨æ…åœ°è¿›è¡Œã€‚",
          incorrect: "è½»å¾®é‡å æ˜¯å¯ä»¥æ¥å—çš„ã€‚å…³é”®æ˜¯æµ‹é‡ã€æŠ¥å‘Šå¹¶ç›¸åº”åœ°è§£é‡Šç»“æœã€‚"
        }
      }},
      { type: "refrain", theme: "black", content: { text: "è®¡ç®—è¯æ®ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯å›å£°ã€‚" }}
    ]
  },
  {
    id: 5, title: "The Synthesis", subtitle: "åœ¨è¯„è®ºä¹‹é—´ç¼–ç»‡è¯æ®", xp: 170,
    slides: [
      { type: "title", theme: "red-bg", content: { title: "The Synthesis", subtitle: "ä»è®¸å¤šè¯„è®ºåˆ°ä¸€ä¸ªç­”æ¡ˆ" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Choose between narrative and quantitative synthesis approaches",
          "Understand when re-analysis of primary data is justified",
          "å‘ˆç°ä¸ä¸€è‡´çš„ç»“æœé€æ˜åœ°",
          "Apply GRADE or a similar framework to rate certainty across reviews"
        ],
        tip: "ç»¼åˆæ˜¯ä¼å¼è¯„ä»·çš„ä»·å€¼æ‰€åœ¨ï¼šå°†ç›¸äº’å†²çªçš„ä¿¡å·è½¬åŒ–ä¸ºç»“æ„åŒ–åˆ¤æ–­ã€‚"
      }},
      { type: "story", theme: "gold-bg", content: {
        label: "THE WEAVE", title: "When three meta-analyses disagreed",
        text: "ä¸‰é¡¹ç³»ç»Ÿè¯„ä»·å‡å¯¹åŒä¸€å¹²é¢„æªæ–½è¿›è¡Œäº†èŸèƒåˆ†æã€‚ä¸€ä½å‘ç°äº†æ˜¾ç€çš„å¥½å¤„ï¼Œä¸€ä½å‘ç°æ²¡æœ‰å½±å“ï¼Œä¸€ä½å‘ç°äº†æœ‰å®³çš„è¶‹åŠ¿ã€‚æ€»ä½“å®¡æŸ¥è¿½è¸ªäº†ä¸åŒçº³å…¥æ ‡å‡†ã€åå·®å¤„ç†é£é™©å’Œç»Ÿè®¡æ¨¡å‹çš„ä¸ä¸€è‡´ã€‚",
        followup: "ç»¼åˆå¹¶æœªé€‰å‡ºè·èƒœè€…ã€‚å®ƒè§£é‡Šäº†ä»–ä»¬ä¸åŒæ„çš„åŸå› ä»¥åŠå“ªäº›æ–¹æ³•é€‰æ‹©å¯¼è‡´äº†å·®å¼‚ã€‚",
        warning: true
      }},
      { type: "concept", theme: "dark", content: {
        title: "Synthesis Approaches",
        subtitle: "å°†æ–¹æ³•ä¸æ•°æ®ç›¸åŒ¹é…",
        text: "å™è¿°ç»¼åˆä½¿ç”¨ç»“æ„åŒ–è¡¨æ ¼æ¯”è¾ƒä¸åŒè¯„è®ºçš„å‘ç°ã€‚å½“é‡å åº¦è¾ƒä½ä¸”æ•°æ®å¯è®¿é—®æ—¶ï¼Œå®šé‡å†åˆ†æä¼šæ±‡é›†ä¸»è¦ç ”ç©¶æ•°æ®ã€‚æ··åˆæ–¹æ³•å°†å®¡é˜…çº§åˆ«çš„ç»“æœåˆ¶æˆè¡¨æ ¼ï¼Œå¹¶ä½¿ç”¨æ£®æ—å›¾ç›´è§‚åœ°æ˜¾ç¤ºä¸€è‡´æ€§å’Œä¸ä¸€è‡´æ€§ã€‚",
        highlight: "åˆ‡å‹¿å°†é‡å å®¡é˜…çš„ç»“æœåˆå¹¶ä¸ºç‹¬ç«‹ç ”ç©¶ã€‚"
      }},
      { type: "checklist", theme: "dark", content: {
        title: "Synthesis Checklist",
        items: [
          "å°†æ‰€æœ‰å®¡é˜…ç»“æœä¸è´¨é‡è¯„çº§å¹¶æ’åˆ¶æˆè¡¨æ ¼",
          "Identify sources of discordance (scope, methods, dates, bias handling)",
          "æŠ¥å‘Šæ¯ä¸ªå®¡é˜…çš„æ–¹å‘ã€å¹…åº¦å’Œç²¾åº¦å®¡æŸ¥",
          "Apply GRADE or equivalent to assess certainty of evidence",
          "Present both concordant and discordant findings transparently"
        ]
      }},
      { type: "stats", theme: "dark", content: {
        title: "Discordance Drivers",
        stats: [
          { value: "scope", label: "Different PICO definitions" },
          { value: "search", label: "Different databases or dates" },
          { value: "bias", label: "ä¸åŒçš„è´¨é‡å·¥å…·" },
          { value: "analysis", label: "Different statistical models" }
        ],
        caption: "Common reasons reviews on the same topic disagree."
      }},
      { type: "grade5", theme: "dark", content: {
        title: "ç­‰çº§ï¼šäº”ä¸ªé¢†åŸŸ",
        subtitle: "Rate certainty by assessing each domain",
        domains: [
          { name: "Risk of Bias", desc: "ç ”ç©¶è®¾è®¡æˆ–æ‰§è¡Œçš„å±€é™æ€§å¯èƒ½ä¼šå¯¼è‡´ç»“æœå‡ºç°åå·®" },
          { name: "Inconsistency", desc: "ç ”ç©¶ç»“æœä¸­æ— æ³•è§£é‡Šçš„å¼‚è´¨æ€§" },
          { name: "Indirectness", desc: "è¯æ®å¹¶ä¸ç›´æ¥é€‚ç”¨é’ˆå¯¹é—®é¢˜ï¼ˆäººç¾¤ã€å¹²é¢„æªæ–½ã€æ¯”è¾ƒå™¨ã€ç»“æœï¼‰" },
          { name: "Imprecision", desc: "Wide confidence intervals due to small sample size or few events" },
          { name: "Publication Bias", desc: "æ ¹æ®ç»“æœé€‰æ‹©æ€§å‘è¡¨ç ”ç©¶" }
        ],
        note: "Each domain can downgrade certainty from high to moderate, low, or very low."
      }},
      { type: "decision", theme: "dark", content: {
        icon: "ES", title: "Scenario: Pooling Decision", xp: 25,
        scenario: "æ‚¨çº³å…¥äº† 6 ä¸ªå…·æœ‰ä¸­ç­‰é‡å çš„ SRï¼ˆCCA 9%ï¼‰ã€‚å››ä¸ªä½¿ç”¨äº†å…·æœ‰ç±»ä¼¼ PICO æ ‡å‡†çš„éšæœºæ•ˆåº”èŸèƒåˆ†æã€‚",
        question: "æ‚¨å¯ä»¥æ±‡æ€»ä»–ä»¬çš„èŸèƒåˆ†æç»“æœå—ï¼Ÿ",
        options: [
          { letter: "A", text: "Yes, pool all six review-level estimates", correct: false },
          { letter: "B", text: "No, use narrative synthesis with a structured comparison table", correct: true },
          { letter: "C", text: "ä»…æ±‡æ€»å››ä¸ªå…·æœ‰ç±»ä¼¼æ–¹æ³•çš„ç»“æœï¼Œå¿½ç•¥é‡å ", correct: false },
          { letter: "D", text: "Conduct a meta-analysis of meta-analyses without checking overlap", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚ç”±äºå­˜åœ¨é€‚åº¦çš„é‡å ï¼Œåˆå¹¶å®¡æŸ¥çº§åˆ«çš„ä¼°è®¡å¯èƒ½ä¼šå­˜åœ¨é‡å¤è®¡ç®—çš„é£é™©ã€‚å…·æœ‰ç»“æ„åŒ–æ¯”è¾ƒçš„å™äº‹ç»¼åˆæ›´å®‰å…¨ã€‚",
          incorrect: "é€‚åº¦é‡å æ„å‘³ç€è¯„è®ºå…±äº«ä¸»è¦ç ”ç©¶ã€‚æ±‡é›†ä»–ä»¬çš„ç»“æœä¼šè¶…é‡é‚£äº›å…±äº«çš„ç ”ç©¶ã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "ES", title: "Scenario: Discordance Explained", xp: 25,
        scenario: "Two high-quality SRs disagree: one finds benefit, the other no effect. You trace the discordance to a single large trial included in one but not the other.",
        question: "æ‚¨åº”è¯¥å¦‚ä½•æŠ¥å‘Šæ­¤é—®é¢˜ï¼Ÿ",
        options: [
          { letter: "A", text: "åœ¨æ²¡æœ‰è¯•éªŒçš„æƒ…å†µä¸‹é©³å›å®¡æ ¸", correct: false },
          { letter: "B", text: "è§£é‡Šä¸ä¸€è‡´çš„æ¥æºå¹¶åœ¨ä¸Šä¸‹æ–‡ä¸­å‘ˆç°ä¸¤ä¸ªç»“æœ", correct: true },
          { letter: "C", text: "å¯¹ä¸¤ä¸ªç»“æœè¿›è¡Œå¹³å‡", correct: false },
          { letter: "D", text: "Exclude both reviews", correct: false }
        ],
        feedback: {
          correct: "Correct. Transparent reporting of discordance sources is a core function of umbrella reviews.",
          incorrect: "ä¼å¼è¯„è®ºé€šè¿‡è§£é‡Šè¯„è®ºä¸åŒçš„åŸå› è€Œä¸æ˜¯éšè—è¯„è®ºæ¥å¢åŠ ä»·å€¼ä¸åŒæ„ã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "ES", title: "Scenario: GRADE in Umbrella Reviews", xp: 25,
        scenario: "æ‚¨æƒ³è¦å¯¹çº³å…¥çš„è¯„è®ºä¸­è¯æ®çš„æ€»ä½“ç¡®å®šæ€§è¿›è¡Œè¯„çº§ã€‚å¤šæ¡è¯„è®ºä½¿ç”¨äº†ä¸åŒçš„ GRADE æ–¹æ³•ã€‚",
        question: "æ¨èçš„æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ",
        options: [
          { letter: "A", text: "å¹³å‡æ¯æ¡è¯„è®ºçš„ GRADE è¯„åˆ†", correct: false },
          { letter: "B", text: "æ ¹æ®æœ€ä½³å¯ç”¨ä¸»è¦æ•°æ®ç‹¬ç«‹åº”ç”¨ GRADE", correct: true },
          { letter: "C", text: "ä½¿ç”¨ä»»ä½•è¯„è®ºä¸­çš„æœ€é«˜ GRADE è¯„åˆ†æŸ¥çœ‹", correct: false },
          { letter: "D", text: "Skip certainty assessment in umbrella reviews", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚è€ƒè™‘åˆ°æœ€å¯é çš„è¯æ®åŸºç¡€å’Œæ‰€åŒ…å«è¯„è®ºçš„è´¨é‡ï¼Œä¼å¼è¯„è®ºåº”ç‹¬ç«‹åº”ç”¨ GRADE æˆ–åŒç­‰å†…å®¹ã€‚",
          incorrect: "å¹³å‡æˆ–æŒ‘é€‰ GRADE è¯„çº§æ— æ•ˆã€‚ä¼å¼å®¡æŸ¥å›¢é˜Ÿåº”è¯¥åšå‡ºè‡ªå·±çš„ç¡®å®šæ€§åˆ¤æ–­ã€‚"
        }
      }},
      { type: "refrain", theme: "black", content: { text: "ç»¼åˆæ­ç¤ºäº†å™ªéŸ³ä¹‹ä¸‹çš„ä¿¡å·ã€‚" }}
    ]
  },
  {
    id: 6, title: "The Map", subtitle: "å·®è·ã€ä¸€è‡´æ€§å’Œå¯è§†åŒ–", xp: 170,
    slides: [
      { type: "title", theme: "gold-bg", content: { title: "The Map", subtitle: "See what is known and what is missing" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "åˆ›å»ºä¸€ä¸ªè¯æ®å›¾ï¼Œæ˜¾ç¤ºè¯æ®çš„å¼ºé¡¹æˆ–å¼±é¡¹",
          "Identify research gaps that future reviews or trials should address",
          "Visualize concordance and discordance across reviews",
          "Use structured tables and harvest plots to communicate findings"
        ],
        tip: "ä»…æ€»ç»“ç»“æœçš„ä¼å¼å®¡æŸ¥ä¼šé”™è¿‡å…¶æœ€å¤§çš„ä¼˜åŠ¿ï¼šæ­ç¤ºäº†è¯æ®æ™¯è§‚çš„å½¢çŠ¶ã€‚"
      }},
      { type: "story", theme: "gold-bg", content: {
        label: "THE BLANK", title: "å½“åœ°å›¾æ­ç¤ºäº†å·®è·æ—¶",
        text: "ä¸€é¡¹å…³äºè¿åŠ¨å’Œå¿ƒç†å¥åº·çš„ç»¼åˆç»¼è¿°å‘ç°äº† 12 æ¡å…³äºæŠ‘éƒç—‡çš„è¯„è®ºï¼Œä½†æ²¡æœ‰ä¸€ç¯‡å…³äºåŒç›¸æƒ…æ„Ÿéšœç¢çš„è¯„è®ºã€‚è¯æ®å›¾ä½¿è¿™ä¸€å·®è·åœ¨ä¸€ä¸ªå›¾ä¸­å¯è§ï¼Œä¿ƒä½¿ç ”ç©¶èµ„åŠ©å‘¼åï¼Œä»è€Œå¯¼è‡´äº†ä¸‰é¡¹æ–°çš„è¯•éªŒã€‚",
        followup: "ç¼ºä¹è¯æ®æœ¬èº«å°±æ˜¯ä¸€ä¸ªå‘ç°ã€‚åœ°å›¾ä½¿å…¶å¯è§ã€‚",
        warning: true
      }},
      { type: "concept", theme: "dark", content: {
        title: "Evidence Mapping",
        subtitle: "æ„å»ºæ™¯è§‚",
        text: "An evidence map cross-tabulates populations, interventions, comparisons, and outcomes against the number and quality of available reviews. Cells with many high-quality reviews show strong evidence; empty cells reveal gaps. Harvest plots display direction and strength of effects across reviews at a glance.",
        highlight: "åœ°å›¾ä¸æ˜¯è£…é¥°ã€‚å®ƒæ˜¯å†³ç­–å·¥å…·ã€‚"
      }},
      { type: "checklist", theme: "dark", content: {
        title: "Mapping Checklist",
        items: [
          "Define the matrix dimensions (population, intervention, outcome)",
          "ç”¨è¯„è®ºçš„æ•°é‡å’Œè´¨é‡å¡«å……æ¯ä¸ªå•å…ƒæ ¼",
          "Mark cells with discordant findings",
          "Highlight empty cells as research gaps",
          "ä½¿ç”¨å¯è§†åŒ–å·¥å…·ï¼ˆæ”¶è·å›¾ã€æ°”æ³¡å›¾ï¼‰è¿›è¡Œäº¤æµ"
        ]
      }},
      { type: "decision", theme: "dark", content: {
        icon: "GM", title: "Scenario: Priority Setting", xp: 25,
        scenario: "æ‚¨çš„è¯æ®å›¾æ˜¾ç¤ºä¸€ä¸ªå•å…ƒæ ¼æœ‰å››ä¸ªæä½è´¨é‡çš„è¯„è®ºï¼Œå¹¶ä¸”æ²¡æœ‰é«˜è´¨é‡çš„è¯„è®ºã€‚ä¸´åºŠé—®é¢˜å¾ˆé‡è¦ã€‚",
        question: "ä¼˜å…ˆå»ºè®®æ˜¯ä»€ä¹ˆï¼Ÿ",
        options: [
          { letter: "A", text: "æ¥å—æä½çš„è¯æ®ä½œä¸ºå……åˆ†", correct: false },
          { letter: "B", text: "æ¨èé«˜è´¨é‡çš„ç³»ç»Ÿè¯„ä»·æ¥å¡«è¡¥ç©ºç™½", correct: true },
          { letter: "C", text: "Recommend more umbrella reviews", correct: false },
          { letter: "D", text: "å®Œå…¨å¿½ç•¥ç»†èƒ", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚ä»…å…·æœ‰ä½è´¨é‡è¯„è®ºçš„å•å…ƒä»£è¡¨å­˜åœ¨ä½†ä¸å¯ä¿¡çš„è¯æ®ã€‚ä¸¥æ ¼çš„æ–° SR æ˜¯é¦–è¦ä»»åŠ¡ã€‚",
          incorrect: "æä½è´¨é‡çš„è¯„è®ºæ— æ³•å¯é åœ°å›ç­”é—®é¢˜ã€‚å·®è·åœ¨äºè´¨é‡ï¼Œè€Œä¸æ˜¯æ•°é‡ã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "GM", title: "Scenario: Concordance Display", xp: 25,
        scenario: "å…­ç¯‡è¯„è®ºéƒ½å‘ç°åŒä¸€å¹²é¢„ç»“æœå¯¹å…·æœ‰æ˜¾ç€ç›Šå¤„ï¼Œä½†å®ƒä»¬çš„æ•ˆåº”å¤§å°ä»å°åˆ°å¤§ä¸åŒã€‚",
        question: "æ‚¨åº”è¯¥å¦‚ä½•åœ¨è¯æ®å›¾ä¸­æ˜¾ç¤ºè¿™ä¸€ç‚¹ï¼Ÿ",
        options: [
          { letter: "A", text: "å°†å•å…ƒæ ¼æ ‡è®°ä¸ºä¸æ•ˆåº”å¤§å°æ³¨é‡Šä¸€è‡´ range", correct: true },
          { letter: "B", text: "Mark it as discordant because effect sizes differ", correct: false },
          { letter: "C", text: "Report only the median effect size", correct: false },
          { letter: "D", text: "å°†å•å…ƒæ ¼ç•™ç©º", correct: false }
        ],
        feedback: {
          correct: "Correct.æ–¹å‘ä¸å¹…åº¦å˜åŒ–çš„ä¸€è‡´æ€§æ˜¯ä¸€ä¸ªå¸¸è§ä¸”é‡è¦çš„å‘ç°ã€‚æŠ¥å‘Šä¸€è‡´æ€§å’ŒèŒƒå›´ã€‚",
          incorrect: "æ–¹å‘ä¸€è‡´ä½†å¹…åº¦ä¸åŒçš„è¯„è®ºåœ¨å…³é”®é—®é¢˜ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œç²¾åº¦å› æ–¹æ³•è€Œå¼‚ã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "GM", title: "Scenario: Empty Cell", xp: 25,
        scenario: "æ‚¨çš„è¯æ®å›¾æœ‰æ•´ä¸ªäººå£åˆ—ï¼Œæ²¡æœ‰ç³»ç»Ÿè¯„è®ºï¼šäº”å²ä»¥ä¸‹çš„å„¿ç«¥ã€‚",
        question: "æ‚¨åº”è¯¥å¾—å‡ºä»€ä¹ˆç»“è®ºï¼Ÿ",
        options: [
          { letter: "A", text: "å¹²é¢„åœ¨æ­¤æƒ…å†µä¸‹ä¸èµ·ä½œç”¨äººå£", correct: false },
          { letter: "B", text: "Evidence is absent, flag as a research gap, avoid making effectiveness claims", correct: true },
          { letter: "C", text: "ä»æˆäººæ•°æ®æ¨æ–­", correct: false },
          { letter: "D", text: "ä»åœ°å›¾ä¸­åˆ é™¤äººå£", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®çš„ã€‚æ²¡æœ‰è¯æ®å¹¶ä¸ç­‰äºä¸å­˜åœ¨çš„è¯æ®ã€‚æ ‡è®°å·®è·å¹¶å»ºè®®æœªæ¥çš„ç ”ç©¶ã€‚",
          incorrect: "ç©ºå•å…ƒæ ¼æ„å‘³ç€é—®é¢˜å°šæœªå¾—åˆ°è§£ç­”ï¼Œè€Œä¸æ˜¯ç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚"
        }
      }},
      { type: "refrain", theme: "black", content: { text: "åœ°å›¾ä¸ä»…æ˜¾ç¤ºäº†æˆ‘ä»¬å·²çŸ¥çš„å†…å®¹ï¼Œè¿˜æ˜¾ç¤ºäº†æˆ‘ä»¬å°šæœªå­¦ä¹ çš„å†…å®¹ã€‚" }}
    ]
  },
  {
    id: 7, title: "The Report", subtitle: "æ ‡å‡†ã€é™·é˜±å’Œå°é—­", xp: 200,
    slides: [
      { type: "title", theme: "teal-bg", content: { title: "The Report", subtitle: "å…³é—­å…·æœ‰é€æ˜æŠ¥å‘Šçš„å¾ªç¯" }},
      { type: "objectives", theme: "dark", content: {
        objectives: [
          "Apply reporting guidelines for umbrella reviews (PRIOR, PRISMA adaptations)",
          "Avoid the most common pitfalls in published umbrella reviews",
          "Decide when an umbrella review adds value versus when a new SR is needed",
          "ä½¿ç”¨ç»“æ„åŒ–ç­”æ¡ˆè¿”å›å¼€å¤´åœºæ™¯"
        ],
        tip: "Ring structure: we return to the five conflicting reviews from Module 1. Now you have the tools to resolve them."
      }},
      { type: "story", theme: "green-bg", content: {
        label: "THE RETURN", title: "é‡æ–°è®¿é—®æŒ‡å—é¢æ¿",
        text: "The panel that faced five conflicting reviews now has an umbrella review. It shows that three of the five reviews had critically low quality, overlap was high, and the two trustworthy reviews agreed on a moderate benefit with low certainty. The panel has a clear, justified basis for its recommendation.",
        followup: "æ€»ä½“å®¡æŸ¥æ²¡æœ‰äº§ç”Ÿæ–°æ•°æ®ã€‚å®ƒå°†ç°æœ‰è¯æ®ç»„ç»‡æˆå€¼å¾—ä¿¡èµ–çš„åˆ¤æ–­ã€‚",
        success: true
      }},
      { type: "concept", theme: "dark", content: {
        title: "Reporting Standards",
        subtitle: "PRIOR å’Œæ”¹ç¼–çš„ PRISMA",
        text: "The Preferred Reporting Items for Overviews of Reviews (PRIOR) statement provides a checklist for transparent reporting of umbrella reviews. Key items include explicit description of overlap assessment, quality appraisal methods, synthesis approach, and certainty of evidence assessment. When PRIOR is unavailable, a PRISMA adaptation with umbrella-specific modifications is acceptable.",
        highlight: "A well-reported umbrella review enables others to judge its trustworthiness. Poor reporting defeats its purpose."
      }},
      { type: "checklist", theme: "dark", content: {
        title: "Common Pitfalls to Avoid",
        items: [
          "Failing to assess or report primary study overlap",
          "Using AMSTAR 2 as a numeric score instead of a confidence classification",
          "æ±‡é›†é‡å å®¡ç¨¿çš„ç»“æœè€Œä¸è¿›è¡Œè°ƒæ•´",
          "Ignoring discordance or reporting only concordant findings",
          "çœç•¥ç»“æ„åŒ–è¯æ®å›¾æˆ–å·®è·åˆ†æ"
        ]
      }},
      { type: "decision", theme: "dark", content: {
        icon: "RE", title: "Scenario: Missing Overlap Report", xp: 35,
        scenario: "å®¡ç¨¿äººå»ºè®®ä»æ‰‹ç¨¿ä¸­åˆ é™¤å¼•æ–‡çŸ©é˜µå’Œ CCA ä»¥èŠ‚çœç©ºé—´ã€‚ç¼–è¾‘åŒæ„ã€‚",
        question: "æ­£ç¡®çš„å›ç­”æ˜¯ä»€ä¹ˆï¼Ÿ",
        options: [
          { letter: "A", text: "Agree, overlap is minor detail", correct: false },
          { letter: "B", text: "Keep the overlap assessment, move to supplement if needed", correct: true },
          { letter: "C", text: "Remove it and mention overlap in one sentence", correct: false },
          { letter: "D", text: "ç”¨é‡å åº¦è¾ƒä½çš„è¯­å¥æ›¿æ¢å®ƒ", correct: false }
        ],
        feedback: {
          correct: "Correct. Overlap assessment is a core methodological requirement. If space is limited, move it to a supplement but never omit it.",
          incorrect: "é‡å è¯„ä¼°æ˜¯ä¼å¼å®¡æŸ¥æœ‰æ•ˆæ€§çš„åŸºç¡€ã€‚å¿…é¡»æŠ¥å‘Šï¼Œè‡³å°‘åœ¨è¡¥å……ææ–™ä¸­æŠ¥å‘Šã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "RE", title: "Scenario: Umbrella vs. New SR", xp: 35,
        scenario: "ä¸€ä¸ªç ”ç©¶å°ç»„æƒ³è¦ç ”ç©¶ä¸€ç§æ–°è¯ç‰©çš„æ•ˆæœã€‚å­˜åœ¨ä¸¤ä¸ªä½è´¨é‡ SRï¼Œä¸”æ£€ç´¢å‡ä¸å®Œæ•´ã€‚",
        question: "ä»–ä»¬åº”è¯¥è¿›è¡Œä¼å¼å®¡æŸ¥è¿˜æ˜¯æ–°çš„ç³»ç»Ÿå®¡æŸ¥ï¼Ÿ",
        options: [
          { letter: "A", text: "å¯¹ä¸¤ä¸ªç°æœ‰ SR è¿›è¡Œä¼å¼å®¡æŸ¥", correct: false },
          { letter: "B", text: "æ–°çš„ä¸¥æ ¼ç³»ç»Ÿå®¡æŸ¥", correct: true },
          { letter: "C", text: "Both simultaneously", correct: false },
          { letter: "D", text: "ä¸¤è€…éƒ½ä¸æ˜¯ï¼Œè¯æ®ä¹Ÿä¸æ˜¯è¶³å¤Ÿ", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚ç”±äºåªæœ‰ä¸¤ä¸ªä½è´¨é‡çš„ SRï¼Œä¼å¼å®¡æŸ¥å°†å»ºç«‹åœ¨è–„å¼±çš„åŸºç¡€ä¸Šã€‚ä¸€ä¸ªæ–°çš„ã€å®æ–½è‰¯å¥½çš„ SR æ›´æœ‰ä»·å€¼ã€‚",
          incorrect: "æ€»æ‹¬è¯„è®ºçš„å¼ºåº¦å–å†³äºå…¶æ‰€åŒ…å«çš„è¯„è®ºã€‚å½“ç°æœ‰è¯æ®åŸºç¡€å°ä¸”è–„å¼±æ—¶ï¼Œæ–°çš„ SR æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚"
        }
      }},
      { type: "decision", theme: "dark", content: {
        icon: "RE", title: "Scenario: Final Judgment", xp: 35,
        scenario: "Your umbrella review includes ten SRs. Seven are concordant (moderate benefit), two are discordant (no benefit), and one reports harm. Overlap is moderate. The seven concordant reviews are mostly high quality; the discordant ones are critically low quality.",
        question: "é€‚å½“çš„ç»“è®ºæ˜¯ä»€ä¹ˆï¼Ÿ",
        options: [
          { letter: "A", text: "Definitive benefit, ignore the discordant reviews", correct: false },
          { letter: "B", text: "å¯èƒ½æœ‰ä¸­ç­‰ç›Šå¤„ï¼Œä½†å…·æœ‰ä¸­ç­‰ç¡®å®šæ€§ï¼Œæ³¨æ„åˆ°ä¸è¾ƒä½è´¨é‡è¯„ä»·çš„ä¸ä¸€è‡´", correct: true },
          { letter: "C", text: "No conclusion possible due to discordance", correct: false },
          { letter: "D", text: "Harm signal overrides all other findings", correct: false }
        ],
        feedback: {
          correct: "æ­£ç¡®ã€‚ç»¼åˆæƒè¡¡è´¨é‡ã€ä¸€è‡´æ€§å’Œé‡å æ€§ã€‚é«˜è´¨é‡çš„ä¸€è‡´è¯æ®æ”¯æŒç»“è®ºï¼ŒåŒæ—¶é€æ˜åœ°æ‰¿è®¤ä¸ä¸€è‡´ã€‚",
          incorrect: "ä¼å¼è¯„è®ºæ•´åˆäº†è´¨é‡ã€ä¸€è‡´æ€§å’Œé‡å æ€§ï¼Œå½¢æˆç»“æ„åŒ–åˆ¤æ–­ï¼Œè€Œä¸æ˜¯ç®€å•çš„è®¡ç¥¨ã€‚"
        }
      }},
      { type: "refrain", theme: "black", content: { text: "When reviews multiply, the umbrella gathers them." }}
    ]
  }
];

// ===== NAVIGATION STATE =====
let currentModule = 0;
let currentSlide = 0;
let consecutiveCorrect = gameState.consecutiveCorrect || 0;

// ===== SAVE/LOAD =====
function saveGame() {
  safeSetStorage('umbrellaReviewGame_v1', gameState);
}

function resetProgress() {
  if (confirm('Reset all progress and achievements?')) {
    gameState = { ...DEFAULT_STATE, answeredQuestions: {}, badges: [], completedModules: [], consecutiveCorrect: 0 };
    saveGame();
    currentModule = 0;
    currentSlide = 0;
    renderAll();
  }
}

// ===== COURSE PROGRESS =====
function updateCourseProgress() {
  const totalModules = MODULES.length;
  const completedCount = gameState.completedModules.length;
  const pct = Math.round((completedCount / totalModules) * 100);
  const fillEl = document.getElementById('courseProgressFill');
  const pctEl = document.getElementById('courseProgressPct');
  if (fillEl) fillEl.style.width = pct + '%';
  if (pctEl) pctEl.textContent = pct + '%';
}

// ===== XP & LEVELING =====
function addXP(amount) {
  gameState.xp += amount;
  checkLevelUp();
  saveGame();
  updateStatsDisplay();
  showXPPopup(amount);
}

function checkLevelUp() {
  for (let i = LEVELS.length - 1; i >= 0; i--) {
    if (gameState.xp >= LEVELS[i].xp && gameState.level < LEVELS[i].level) {
      gameState.level = LEVELS[i].level;
      showLevelUp(LEVELS[i]);
      break;
    }
  }
}

function showXPPopup(amount) {
  const popup = document.getElementById('xpPopup');
  document.getElementById('xpAmount').textContent = `+${amount}`;
  popup.classList.add('show');
  setTimeout(() => popup.classList.remove('show'), 1500);
}

function showLevelUp(levelData) {
  triggerConfetti();
  const modal = document.getElementById('levelModal');
  document.getElementById('levelModalLevel').textContent = `Level ${levelData.level}`;
  document.getElementById('levelModalName').textContent = levelData.title;
  modal.classList.add('show');
  modal.setAttribute('aria-hidden', 'false');

  // Auto-close after 3 seconds
  setTimeout(() => {
    closeLevelModal();
  }, 3000);
}

function closeLevelModal() {
  const modal = document.getElementById('levelModal');
  if (modal) {
    modal.classList.remove('show');
    modal.setAttribute('aria-hidden', 'true');
  }
}

// ===== BADGES =====
function awardBadge(badgeId) {
  if (gameState.badges.includes(badgeId)) return;
  gameState.badges.push(badgeId);
  saveGame();
  const badge = BADGES.find(b => b.id === badgeId);
  if (badge) showBadgeModal(badge);
  updateBadges();
}

function showBadgeModal(badge, celebrate = true) {
  document.getElementById('badgeModalIcon').textContent = badge.icon;
  document.getElementById('badgeModalTitle').textContent = badge.name;
  document.getElementById('badgeModalDesc').textContent = badge.desc;
  const modal = document.getElementById('badgeModal');
  modal.classList.add('show');
  if (celebrate) triggerConfetti();

  // Focus trap
  const focusableElements = modal.querySelectorAll('button, [tabindex]:not([tabindex="-1"])');
  if (focusableElements.length > 0) {
    const firstFocusable = focusableElements[0];
    const lastFocusable = focusableElements[focusableElements.length - 1];
    firstFocusable.focus();

    // Remove any existing focus trap listener
    if (modal._focusTrapHandler) {
      modal.removeEventListener('keydown', modal._focusTrapHandler);
    }

    modal._focusTrapHandler = function(e) {
      if (e.key === 'Tab') {
        if (e.shiftKey && document.activeElement === firstFocusable) {
          e.preventDefault();
          lastFocusable.focus();
        } else if (!e.shiftKey && document.activeElement === lastFocusable) {
          e.preventDefault();
          firstFocusable.focus();
        }
      }
      if (e.key === 'Escape') {
        closeBadgeModal();
      }
    };
    modal.addEventListener('keydown', modal._focusTrapHandler);
  }
}

function showBadgeDetails(badgeId) {
  const badge = BADGES.find(b => b.id === badgeId);
  if (!badge) return;
  const earned = gameState.badges.includes(badgeId);
  const desc = earned ? badge.desc : `${badge.desc} (Locked)`;
  showBadgeModal({ ...badge, desc }, earned);
}

function closeBadgeModal() {
  const modal = document.getElementById('badgeModal');
  if (modal._focusTrapHandler) {
    modal.removeEventListener('keydown', modal._focusTrapHandler);
    modal._focusTrapHandler = null;
  }
  modal.classList.remove('show');
}

// ===== STREAK =====
function updateStreak() {
  const today = new Date().toDateString();
  if (gameState.lastActive !== today) {
    const yesterday = new Date(Date.now() - 86400000).toDateString();
    if (gameState.lastActive === yesterday) {
      gameState.streak++;
      if (gameState.streak >= 3) awardBadge('streak_3');
      if (gameState.streak >= 7) awardBadge('streak_7');
    } else if (gameState.lastActive) {
      gameState.streak = 1;
    } else {
      gameState.streak = 1;
    }
    gameState.lastActive = today;
    saveGame();
  }
}

// ===== CONFETTI =====
function triggerConfetti() {
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
  const container = document.getElementById('confettiContainer');
  const colors = ['#D4AF37', '#22c55e', '#3b82f6', '#f59e0b', '#ef4444', '#0f766e'];
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDelay = Math.random() * 0.5 + 's';
    container.appendChild(confetti);
    setTimeout(() => confetti.remove(), 3500);
  }
}

// ===== COMBO =====
function updateComboDisplay() {
  const comboEl = document.getElementById('comboDisplay');
  const countEl = document.getElementById('comboCount');
  if (consecutiveCorrect >= 2) {
    countEl.textContent = consecutiveCorrect;
    comboEl.classList.add('show');
  } else {
    comboEl.classList.remove('show');
  }
}

// ===== MOBILE SIDEBAR =====
function toggleSidebar() {
  document.querySelector('.sidebar').classList.toggle('open');
  document.getElementById('sidebarOverlay').classList.toggle('show');
  var btn = document.querySelector('.sidebar-toggle'); if (btn) btn.setAttribute('aria-expanded', btn.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
}

// ===== RENDER =====
function renderAll() {
  updateStreak();
  renderSidebar();
  renderSlides();
  updateStatsDisplay();
  updateBadges();
  updateCourseProgress();
}

function updateStatsDisplay() {
  const levelData = LEVELS.find(l => l.level === gameState.level) || LEVELS[0];
  const nextLevel = LEVELS.find(l => l.level === gameState.level + 1);

  document.getElementById('levelIcon').textContent = levelData.icon;
  document.getElementById('levelTitle').textContent = levelData.title;
  document.getElementById('levelNum').textContent = gameState.level;

  const currentXP = gameState.xp - levelData.xp;
  const neededXP = nextLevel ? (nextLevel.xp - levelData.xp) : 500;
  const pct = Math.min(100, (currentXP / neededXP) * 100);

  document.getElementById('xpFill').style.width = pct + '%';
  document.getElementById('xpCurrent').textContent = currentXP;
  document.getElementById('xpNeeded').textContent = neededXP;

  document.getElementById('correctCount').textContent = gameState.correctAnswers;
  document.getElementById('decisionCount').textContent = gameState.decisionsCompleted;
  document.getElementById('synthesisCount').textContent = gameState.completedModules.length;
  document.getElementById('streakCount').textContent = gameState.streak;

  const streakEl = document.getElementById('streakDisplay');
  streakEl.classList.toggle('active', gameState.streak > 0);
}

function updateBadges() {
  const grid = document.getElementById('badgesGrid');
  grid.innerHTML = BADGES.map(b => {
    const earned = gameState.badges.includes(b.id);
    const label = `${b.name}: ${b.desc}`;
    return `<button class="badge-item ${earned ? 'earned' : ''}" type="button" data-tooltip="${label}" aria-label="${label}" title="${label}" onclick="showBadgeDetails('${b.id}')">${b.icon}</button>`;
  }).join('');
}

function renderSidebar() {
  const list = document.getElementById('moduleList');
  list.innerHTML = MODULES.map((mod, i) => {
    const completed = gameState.completedModules.includes(mod.id);
    const locked = i > 0 && !gameState.completedModules.includes(MODULES[i-1].id);
    const estMins = Math.round(mod.slides.length * 1.5);
    return `
      <div class="module-item ${i === currentModule ? 'active' : ''} ${completed ? 'completed' : ''} ${locked ? 'locked' : ''}"
           onclick="${locked ? '' : `goToModule(${i})`}"
           tabindex="${locked ? -1 : 0}"
           role="button"
           aria-disabled="${locked ? 'true' : 'false'}">
        <div class="module-number">${completed ? 'OK' : (locked ? 'LK' : mod.id)}</div>
        <div class="module-info">
          <div class="module-title">${mod.title}</div>
          <div class="module-subtitle">${mod.subtitle}</div>
          <div class="module-xp">+${mod.xp} XP</div>
          <div class="module-time">Time ~${estMins} min</div>
        </div>
      </div>
    `;
  }).join('');
}

function renderSlides() {
  const container = document.getElementById('slidesContainer');
  container.innerHTML = MODULES.map((mod, mi) => {
    const progressPct = ((currentSlide + 1) / mod.slides.length) * 100;
    return `
    <div class="module-slides ${mi === currentModule ? 'active' : ''}" data-module="${mi}">
      <div class="slide-progress-bar" style="width: ${mi === currentModule ? progressPct : 0}%"></div>
      ${mod.slides.map((slide, si) => renderSlide(slide, si, mi)).join('')}
      <div class="slide-nav">
        <button class="nav-btn prev" onclick="prevSlide()" ${currentSlide === 0 ? 'disabled' : ''} aria-label="Previous slide">&lt;</button>
        <div class="nav-center">
          <div class="slide-counter">${currentSlide + 1} / ${mod.slides.length}</div>
          <div class="progress-dots">
            ${mod.slides.map((_, i) => `<button class="progress-dot ${i === currentSlide ? 'active' : ''}" type="button" onclick="goToSlide(${i})" aria-label="Go to slide ${i + 1}" ${i === currentSlide ? 'aria-current="true"' : ''}></button>`).join('')}
          </div>
        </div>
        <button class="nav-btn next" onclick="nextSlide()" aria-label="Next slide">&gt;</button>
      </div>
      <div class="keyboard-hint" style="position:absolute;bottom:5px;left:50%;transform:translateX(-50%);font-size:0.6rem;opacity:0.4;">Left / Right arrows or swipe to navigate</div>
    </div>
  `;
  }).join('');
  document.getElementById('currentModule').textContent = MODULES[currentModule].title;
  updateSlideVisibility();
}

function renderSlide(slide, index, moduleIndex) {
  const theme = slide.theme || 'dark';
  let html = `<div class="slide ${theme} ${index === currentSlide ? 'active' : ''}" data-slide="${index}">`;

  switch(slide.type) {
    case 'title':
      html += `<div class="content"><h1 class="title gold animate">${slide.content.title}</h1><p class="subtitle animate delay-1">${slide.content.subtitle}</p></div>`;
      break;

    case 'objectives':
      html += `<div class="content">
        <div class="objectives-box animate">
          <div class="objectives-header">
            <div class="objectives-icon">GOAL</div>
            <div class="objectives-title">Learning Objectives</div>
          </div>
          <ul class="objectives-list">
            ${slide.content.objectives.map(obj => `<li>${obj}</li>`).join('')}
          </ul>
        </div>
        ${slide.content.tip ? `<p class="subtitle animate delay-1" style="font-size:0.85rem;max-width:600px">${slide.content.tip}</p>` : ''}
      </div>`;
      break;

    case 'story':
      html += `<div class="content">
        <article class="story-box ${slide.content.success ? 'success' : ''} ${slide.content.warning ? 'warning' : ''} ${slide.content.teal ? 'teal' : ''} animate" role="article">
          <div class="story-label">${slide.content.label}</div>
          ${slide.content.title ? `<h2 class="title gold" style="font-size:1.8rem;margin-bottom:0.75rem">${slide.content.title}</h2>` : ''}
          <p class="story-text">${slide.content.text}</p>
          ${slide.content.followup ? `<p class="story-text" style="margin-top:0.75rem;font-style:italic;opacity:0.9">${slide.content.followup}</p>` : ''}
        </article>
      </div>`;
      break;

    case 'stats':
      html += `<div class="content">
        ${slide.content.title ? `<h2 class="title gold animate">${slide.content.title}</h2>` : ''}
        ${slide.content.subtitle ? `<p class="subtitle animate delay-1">${slide.content.subtitle}</p>` : ''}
        <div class="stats-grid animate delay-2">
          ${slide.content.stats.map(s => `<div class="stat-box"><div class="stat-value gold">${s.value}</div><div class="stat-label">${s.label}</div></div>`).join('')}
        </div>
        ${slide.content.caption ? `<p class="subtitle animate delay-3" style="font-size:0.85rem;margin-top:0.75rem">${slide.content.caption}</p>` : ''}
      </div>`;
      break;

    case 'refrain':
      html += `<div class="content" style="justify-content:center;height:100%"><p class="refrain animate">"${slide.content.text}"</p></div>`;
      break;

    case 'concept':
      html += `<div class="content">
        <h2 class="title ${theme === 'light' ? 'navy' : 'gold'} animate">${slide.content.title}</h2>
        ${slide.content.subtitle ? `<p class="subtitle animate delay-1">${slide.content.subtitle}</p>` : ''}
        ${slide.content.text ? `<div class="card ${theme === 'light' ? '' : 'navy-bg'} animate delay-2"><p class="card-text">${slide.content.text}</p></div>` : ''}
        ${slide.content.highlight ? `<div class="story-box warning animate delay-3"><div class="story-label">Key Insight</div><p class="story-text">${slide.content.highlight}</p></div>` : ''}
        ${slide.content.checkpoints ? `
          <div class="timeline animate delay-2" style="margin-top:0.75rem">
            ${slide.content.checkpoints.map(cp => `
              <div class="timeline-item"><div class="timeline-days">${cp.day}</div><div class="timeline-content"><div class="timeline-title">${cp.event}</div></div></div>
            `).join('')}
          </div>
        ` : ''}
      </div>`;
      break;

    case 'checklist':
      html += `<div class="content">
        <h2 class="title gold animate">${slide.content.title}</h2>
        <div class="checklist animate delay-1">
          ${slide.content.items.map(item => `
            <div class="checklist-item">
              <div class="check-icon">OK</div>
              <div class="checklist-text">${item}</div>
            </div>
          `).join('')}
        </div>
      </div>`;
      break;

    case 'amstar16':
      html += `<div class="content">
        <h2 class="title gold animate">${slide.content.title}</h2>
        <p class="subtitle animate delay-1">${slide.content.subtitle}</p>
        <div style="display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;max-width:900px;margin-top:1rem" class="animate delay-2">
          <div style="flex:1;min-width:280px;background:rgba(239,68,68,0.15);border:2px solid var(--red);border-radius:8px;padding:1rem">
            <h3 style="color:var(--red);font-size:0.9rem;margin-bottom:0.75rem;font-weight:700">CRITICAL ITEMS (7)</h3>
            ${slide.content.critical.map(item => `
              <div style="display:flex;align-items:flex-start;gap:0.5rem;padding:0.35rem 0;font-size:0.85rem">
                <span style="color:var(--red);font-weight:700;min-width:24px">${item.num}*</span>
                <span>${item.text}</span>
              </div>
            `).join('')}
          </div>
          <div style="flex:1;min-width:280px;background:rgba(34,197,94,0.1);border:2px solid var(--green);border-radius:8px;padding:1rem">
            <h3 style="color:var(--green);font-size:0.9rem;margin-bottom:0.75rem;font-weight:700">NON-CRITICAL ITEMS (9)</h3>
            ${slide.content.nonCritical.map(item => `
              <div style="display:flex;align-items:flex-start;gap:0.5rem;padding:0.35rem 0;font-size:0.85rem">
                <span style="color:var(--green);font-weight:700;min-width:24px">${item.num}</span>
                <span>${item.text}</span>
              </div>
            `).join('')}
          </div>
        </div>
      </div>`;
      break;

    case 'grade5':
      html += `<div class="content">
        <h2 class="title gold animate">${slide.content.title}</h2>
        <p class="subtitle animate delay-1">${slide.content.subtitle}</p>
        <div style="display:flex;flex-direction:column;gap:0.6rem;max-width:700px;margin-top:1rem" class="animate delay-2">
          ${slide.content.domains.map((domain, idx) => `
            <div style="display:flex;align-items:flex-start;gap:0.75rem;background:rgba(124,58,237,0.15);border-left:4px solid var(--purple);border-radius:0 8px 8px 0;padding:0.75rem 1rem">
              <div style="width:28px;height:28px;background:var(--purple);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.85rem;flex-shrink:0">${idx + 1}</div>
              <div>
                <div style="font-weight:700;color:var(--gold);font-size:0.95rem">${domain.name}</div>
                <div style="font-size:0.85rem;opacity:0.9">${domain.desc}</div>
              </div>
            </div>
          `).join('')}
        </div>
        <p class="subtitle animate delay-3" style="font-size:0.85rem;margin-top:1rem;max-width:600px">${slide.content.note}</p>
      </div>`;
      break;

    case 'decision':
      const did = `dec_${moduleIndex}_${index}`;
      const answered = gameState.answeredQuestions[did];
      html += `<div class="content">
        <div class="decision-tree animate">
          <div class="decision-header">
            <div class="decision-icon">${slide.content.icon}</div>
            <div class="decision-title">${slide.content.title}</div>
            <div class="decision-xp">+${slide.content.xp} XP</div>
          </div>
          <div class="decision-scenario">${slide.content.scenario}</div>
          <div class="decision-question">${slide.content.question}</div>
          <div class="decision-options">
            ${slide.content.options.map(opt => {
              const isSelected = answered === opt.letter;
              const showCorrect = answered && opt.correct;
              const showIncorrect = answered && isSelected && !opt.correct;
              return `
                <div class="decision-option ${isSelected ? 'selected' : ''} ${showCorrect ? 'correct' : ''} ${showIncorrect ? 'incorrect' : ''} ${answered ? 'disabled' : ''}"
                     onclick="answerDecision('${did}', '${opt.letter}', ${opt.correct}, ${slide.content.xp})"
                     tabindex="0"
                     role="button"
                     aria-pressed="${isSelected ? 'true' : 'false'}"
                     aria-disabled="${answered ? 'true' : 'false'}">
                  <div class="option-letter">${opt.letter}</div>
                  <div class="option-text">${opt.text}</div>
                </div>
              `;
            }).join('')}
          </div>
          <div class="decision-feedback ${answered ? 'show' : ''} ${answered && slide.content.options.find(o => o.letter === answered)?.correct ? 'correct' : 'incorrect'}" role="alert" aria-live="polite">
            <div class="feedback-title">${answered && slide.content.options.find(o => o.letter === answered)?.correct ? 'Correct!' : 'Not quite'}</div>
            <div class="feedback-text">${answered && slide.content.options.find(o => o.letter === answered)?.correct ? slide.content.feedback.correct : slide.content.feedback.incorrect}</div>
            ${answered && !(slide.content.options.find(o => o.letter === answered)?.correct) ? `<div style="margin-top:0.5rem;font-size:0.8rem;color:var(--orange);font-weight:600;">Partial credit: +${Math.floor(slide.content.xp * 0.2)} XP</div>` : ''}
          </div>
        </div>
      </div>`;
      break;

    default:
      html += '<div class="slide-content"><p>Unknown slide type</p></div>';
      break;
  }

  html += '</div>';
  return html;
}

function updateSlideVisibility() {
  const container = document.querySelector('.module-slides.active');
  if (!container) return;

  container.querySelectorAll('.slide').forEach((slide, i) => {
    slide.classList.toggle('active', i === currentSlide);
  });

  const progressBar = container.querySelector('.slide-progress-bar');
  if (progressBar) {
    const pct = ((currentSlide + 1) / MODULES[currentModule].slides.length) * 100;
    progressBar.style.width = pct + '%';
  }

  container.querySelector('.slide-counter').textContent = `${currentSlide + 1} / ${MODULES[currentModule].slides.length}`;
  container.querySelectorAll('.progress-dot').forEach((dot, i) => {
    const isActive = i === currentSlide;
    dot.classList.toggle('active', isActive);
    if (isActive) {
      dot.setAttribute('aria-current', 'true');
    } else {
      dot.removeAttribute('aria-current');
    }
  });
  const prevBtn = container.querySelector('.nav-btn.prev');
  const nextBtn = container.querySelector('.nav-btn.next');
  if (prevBtn) prevBtn.disabled = currentSlide === 0;
  if (nextBtn) {
    const onLastSlide = currentSlide === MODULES[currentModule].slides.length - 1;
    nextBtn.disabled = onLastSlide && gameState.completedModules.includes(MODULES[currentModule].id);
  }
}

// ===== ANSWERS =====
function answerDecision(did, letter, correct, xp) {
  if (gameState.answeredQuestions[did] !== undefined) return;
  gameState.answeredQuestions[did] = letter;
  gameState.decisionsCompleted++;

  if (gameState.decisionsCompleted === 1) awardBadge('first_scenario');

  if (correct) {
    gameState.correctAnswers++;
    consecutiveCorrect++;
    addXP(xp);
    if (consecutiveCorrect >= 5) awardBadge('perfect_5');
    if (gameState.decisionsCompleted >= 21) awardBadge('decision_maker');
  } else {
    consecutiveCorrect = 0;
    addXP(Math.floor(xp * 0.2));
  }
  gameState.consecutiveCorrect = consecutiveCorrect;
  saveGame();
  renderSlides();
  updateComboDisplay();
  updateStatsDisplay();
}

// ===== NAVIGATION =====
function goToModule(index) {
  if (index > 0 && !gameState.completedModules.includes(MODULES[index-1].id)) return;
  currentModule = index;
  currentSlide = 0;
  renderSlides();
  renderSidebar();
}

function goToSlide(index) {
  currentSlide = index;
  updateSlideVisibility();
}

function nextSlide() {
  const mod = MODULES[currentModule];
  if (currentSlide < mod.slides.length - 1) {
    currentSlide++;
    updateSlideVisibility();
  } else {
    completeModule();
  }
}

function prevSlide() {
  if (currentSlide > 0) {
    currentSlide--;
    updateSlideVisibility();
  }
}

function completeModule() {
  const mod = MODULES[currentModule];
  if (!gameState.completedModules.includes(mod.id)) {
    gameState.completedModules.push(mod.id);
    addXP(mod.xp);

    // Module-specific badges
    if (mod.id === 1) awardBadge('canopy_explorer');
    if (mod.id === 2) awardBadge('harvest_expert');
    if (mod.id === 3) awardBadge('quality_judge');
    if (mod.id === 4) awardBadge('overlap_detective');
    if (mod.id === 5) awardBadge('evidence_weaver');
    if (mod.id === 6) awardBadge('gap_finder');
    if (mod.id === 7) awardBadge('report_champion');
    if (gameState.completedModules.length === MODULES.length) awardBadge('finisher');

    saveGame();
    triggerConfetti();
    updateCourseProgress();
  }

  if (currentModule < MODULES.length - 1) {
    goToModule(currentModule + 1);
  } else if (gameState.completedModules.length === MODULES.length && !gameState.courseCompleted) {
    gameState.courseCompleted = true;
    saveGame();
    showCourseCompletion();
  }
}

function showCourseCompletion() {
  document.getElementById('completionXP').textContent = gameState.xp;
  document.getElementById('completionBadges').textContent = gameState.badges.length;
  document.getElementById('completionLevel').textContent = gameState.level;
  document.getElementById('completionOverlay').classList.add('show');
  triggerConfetti();
}

function closeCompletion() {
  document.getElementById('completionOverlay').classList.remove('show');
}

function reviewBadges() {
  document.getElementById('completionOverlay').classList.remove('show');
  // Scroll to badges panel and highlight it
  const badgesPanel = document.querySelector('.badges-panel');
  if (badgesPanel) {
    badgesPanel.scrollIntoView({ behavior: 'smooth', block: 'center' });
    badgesPanel.style.transition = 'box-shadow 0.3s ease';
    badgesPanel.style.boxShadow = '0 0 20px 5px rgba(212,175,55,0.6)';
    setTimeout(() => {
      badgesPanel.style.boxShadow = '';
    }, 2000);
  }
}

function downloadCertificate() {
  const courseName = 'Umbrella Reviews: Synthesis of Syntheses';
  const completionDate = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  const level = LEVELS[gameState.level - 1] || LEVELS[0];
  const badgeCount = gameState.badges.length;
  const totalXP = gameState.xp;

  const certHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Certificate of Completion - ${courseName}</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Source+Sans+Pro:wght@400;600&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Source Sans Pro', sans-serif; background: #f5f5f5; padding: 20px; }
    .certificate {
      max-width: 800px; margin: 0 auto; background: linear-gradient(135deg, #1E2761 0%, #141B3D 100%);
      border: 8px solid #D4AF37; border-radius: 12px; padding: 60px 50px; text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .cert-header { font-family: 'Cormorant Garamond', serif; color: #D4AF37; font-size: 1rem; letter-spacing: 0.3em; text-transform: uppercase; margin-bottom: 10px; }
    .cert-title { font-family: 'Cormorant Garamond', serif; color: #FAF8F5; font-size: 3rem; font-weight: 700; margin-bottom: 30px; }
    .cert-subtitle { color: rgba(255,255,255,0.8); font-size: 1.1rem; margin-bottom: 40px; }
    .cert-course { font-family: 'Cormorant Garamond', serif; color: #D4AF37; font-size: 2rem; font-weight: 600; margin-bottom: 15px; padding: 20px; border-top: 1px solid rgba(212,175,55,0.3); border-bottom: 1px solid rgba(212,175,55,0.3); }
    .cert-stats { display: flex; justify-content: center; gap: 40px; margin: 30px 0; }
    .cert-stat { text-align: center; }
    .cert-stat-value { font-family: 'Cormorant Garamond', serif; font-size: 2rem; color: #D4AF37; font-weight: 700; }
    .cert-stat-label { font-size: 0.8rem; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 0.1em; }
    .cert-date { color: rgba(255,255,255,0.7); font-size: 0.95rem; margin-top: 40px; }
    .cert-footer { margin-top: 40px; padding-top: 30px; border-top: 1px solid rgba(212,175,55,0.2); }
    .cert-issuer { color: rgba(255,255,255,0.5); font-size: 0.85rem; }
    .cert-badge { display: inline-block; margin-top: 15px; padding: 8px 20px; background: rgba(212,175,55,0.2); border: 1px solid rgba(212,175,55,0.4); border-radius: 20px; color: #D4AF37; font-size: 0.9rem; }
    @media print {
      body { background: white; padding: 0; }
      .certificate { box-shadow: none; }
    }
  </style>
</head>
<body>
  <div class="certificate">
    <div class="cert-header">Synthesis Course Collection</div>
    <div class="cert-title">Certificate of Completion</div>
    <div class="cert-subtitle">This certifies successful completion of</div>
    <div class="cert-course">${courseName}</div>
    <div class="cert-stats">
      <div class="cert-stat">
        <div class="cert-stat-value">${totalXP.toLocaleString()}</div>
        <div class="cert-stat-label">Total XP Earned</div>
      </div>
      <div class="cert-stat">
        <div class="cert-stat-value">${badgeCount}</div>
        <div class="cert-stat-label">Badges Earned</div>
      </div>
      <div class="cert-stat">
        <div class="cert-stat-value">${level.title}</div>
        <div class="cert-stat-label">Final Level</div>
      </div>
    </div>
    <div class="cert-date">Completed on ${completionDate}</div>
    <div class="cert-footer">
      <div class="cert-issuer">Synthesis Course Collection â€” Evidence Synthesis & Meta-Analysis Training</div>
      <div class="cert-badge">Verified Completion</div>
    </div>
  </div>
  <script>window.onload = () => window.print();<\/script>
</body>
</html>`;

  const blob = new Blob([certHTML], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Certificate-Umbrella-Reviews-Course.html';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// ===== KEYBOARD =====
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeBadgeModal();
    document.getElementById('completionOverlay').classList.remove('show');
    closeLevelModal();
    document.querySelector('.sidebar').classList.remove('open');
    document.getElementById('sidebarOverlay').classList.remove('show');
    return;
  }

  if ((e.target.classList.contains('module-item') || e.target.classList.contains('decision-option')) && (e.key === 'Enter' || e.key === ' ')) {
    e.preventDefault();
    e.target.click();
    return;
  }

  const isRoleButton = e.target && e.target.getAttribute && e.target.getAttribute('role') === 'button';
  const isFormControl = e.target && e.target.closest && e.target.closest('button, a, input, textarea, select');
  if (isRoleButton || isFormControl) {
    if (e.key === ' ' && isRoleButton) {
      e.preventDefault();
      e.target.click();
    }
    return;
  }

  if (e.key === 'ArrowRight' || e.key === ' ') {
    e.preventDefault();
    const mod = MODULES[currentModule];
    const onLastSlide = currentSlide === mod.slides.length - 1;
    if (onLastSlide && gameState.completedModules.includes(mod.id)) return;
    nextSlide();
  } else if (e.key === 'ArrowLeft') {
    e.preventDefault();
    prevSlide();
  }
});

// ===== TOUCH =====
let touchStartX = 0;
document.addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].screenX; }, { passive: true });
document.addEventListener('touchend', (e) => {
  const diff = touchStartX - e.changedTouches[0].screenX;
  if (Math.abs(diff) > 50) {
    if (diff > 0) {
      const mod = MODULES[currentModule];
      const onLastSlide = currentSlide === mod.slides.length - 1;
      if (onLastSlide && gameState.completedModules.includes(mod.id)) return;
      nextSlide();
    } else {
      prevSlide();
    }
  }
}, { passive: true });

// ===== INIT =====
renderAll();
</script>
</body>
</html>
