<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>출판편향탐정: 빛을 보지 못한 증거</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&amp;family=Source+Sans+Pro:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<script>
if (typeof Plotly === 'undefined') {
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('[id*="plot"], [id*="chart"], .plotly-graph-div, .js-plotly-plot').forEach(function(el) {
      el.innerHTML = '<div style="padding:2rem;text-align:center;background:#2a2a4a;border:1px dashed #D4AF37;border-radius:8px;color:#FAF8F5;margin:1rem 0;"><p style="font-size:1.1rem;margin-bottom:0.5rem;">Interactive chart unavailable offline</p><p style="font-size:0.85rem;opacity:0.7;">Connect to the internet to load interactive Plotly.js visualizations</p></div>';
    });
  });
}
</script>
<style>
    :root {
      --navy: #1E2761;
      --deep-navy: #141B3D;
      --gold: #D4AF37;
      --cream: #FAF8F5;
      --red: #dc2626;
      --green: #16a34a;
      --purple: #7c3aed;
      --amber: #f59e0b;
      --teal: #0d9488;
      --detective-blue: #1e3a5f;
      --evidence-red: #991b1b;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      height: 100%;
      font-family: 'Source Sans Pro', sans-serif;
      background: var(--deep-navy);
      color: var(--cream);
    }
    .course-container { display: flex; height: 100vh; overflow: hidden; }

    /* Sidebar */
    .sidebar {
      width: 320px;
      background: linear-gradient(180deg, var(--detective-blue) 0%, var(--deep-navy) 100%);
      border-right: 1px solid rgba(212,175,55,0.2);
      display: flex; flex-direction: column; flex-shrink: 0;
    }
    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
      background: rgba(0,0,0,0.2);
    }
    .sidebar-header h1 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem; font-weight: 700; color: var(--gold); margin-bottom: 0.25rem;
    }
    .sidebar-header p { font-size: 0.75rem; color: rgba(255,255,255,0.6); }
    .sidebar-badge {
      display: inline-block; padding: 0.25rem 0.5rem;
      background: linear-gradient(135deg, var(--evidence-red), #b91c1c);
      border-radius: 4px; font-size: 0.65rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: 0.05em; margin-top: 0.5rem;
    }
    .module-list { flex: 1; overflow-y: auto; padding: 1rem 0; }
    .module-item {
      display: flex; align-items: center; gap: 0.75rem;
      padding: 0.65rem 1.25rem; cursor: pointer; transition: all 0.2s;
      border-left: 3px solid transparent;
    }
    .module-item:hover { background: rgba(212,175,55,0.1); }
    .module-item.active { background: rgba(212,175,55,0.15); border-left-color: var(--gold); }
    .module-item.completed .module-number { background: var(--green); color: white; }
    .module-number {
      width: 26px; height: 26px; border-radius: 50%;
      background: rgba(255,255,255,0.1); display: flex;
      align-items: center; justify-content: center;
      font-size: 0.75rem; font-weight: 600; flex-shrink: 0;
    }
    .module-info { flex: 1; min-width: 0; }
    .module-title { font-size: 0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .module-subtitle { font-size: 0.7rem; color: rgba(255,255,255,0.5); }
    .sidebar-footer { padding: 1rem; border-top: 1px solid rgba(212,175,55,0.2); }
    .progress-bar-container { margin-top: 0.75rem; }
    .progress-label { font-size: 0.75rem; color: rgba(255,255,255,0.6); margin-bottom: 0.25rem; }
    .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--evidence-red), var(--gold)); border-radius: 3px; transition: width 0.3s; }

    /* Main Content */
    .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .top-bar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 1rem 2rem; background: rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(212,175,55,0.15);
    }
    .module-indicator { font-size: 0.9rem; color: rgba(255,255,255,0.7); }
    .slide-counter { font-size: 0.8rem; color: var(--gold); margin-left: 1rem; }
    .top-bar-actions { display: flex; gap: 0.75rem; }
    .top-bar-btn {
      padding: 0.5rem 1rem; background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2); border-radius: 6px;
      color: var(--cream); font-size: 0.85rem; cursor: pointer; transition: all 0.2s;
    }
    .top-bar-btn:hover { background: rgba(255,255,255,0.15); }
    .top-bar-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .slide-container { flex: 1; overflow-y: auto; padding: 2rem; }
    .slide { display: none; max-width: 1000px; margin: 0 auto; }
    .slide.active { display: block; }

    /* Storytelling Styles */
    .rhetoric-question {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.8rem; font-style: italic; color: var(--gold);
      text-align: center; padding: 3rem 2rem; line-height: 1.5;
      border-left: 4px solid var(--evidence-red);
      background: linear-gradient(135deg, rgba(153,27,27,0.1), transparent);
      margin: 1rem 0;
    }
    .case-file {
      background: linear-gradient(135deg, rgba(30,58,95,0.4), rgba(15,15,26,0.6));
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 12px; padding: 2rem; margin: 1.5rem 0;
    }
    .case-file-header {
      display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;
      padding-bottom: 1rem; border-bottom: 1px solid rgba(212,175,55,0.2);
    }
    .case-number {
      background: var(--evidence-red); color: white;
      padding: 0.5rem 1rem; border-radius: 4px;
      font-weight: 700; font-size: 0.8rem; text-transform: uppercase;
    }
    .case-title { font-size: 1.3rem; font-weight: 700; color: var(--gold); }
    .case-source { font-size: 0.8rem; color: rgba(255,255,255,0.5); margin-top: 0.25rem; }
    .evidence-timeline { margin: 1.5rem 0; }
    .timeline-event {
      display: flex; gap: 1rem; padding: 1rem 0;
      border-left: 2px solid rgba(212,175,55,0.3); margin-left: 1rem; padding-left: 1.5rem;
      position: relative;
    }
    .timeline-event::before {
      content: ''; position: absolute; left: -6px; top: 1.2rem;
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--gold); border: 2px solid var(--deep-navy);
    }
    .timeline-event.buried::before { background: var(--evidence-red); }
    .timeline-event.revealed::before { background: var(--green); }
    .timeline-year {
      font-weight: 700; color: var(--gold); min-width: 80px;
      font-family: 'Cormorant Garamond', serif; font-size: 1.1rem;
    }
    .timeline-text { color: rgba(255,255,255,0.85); line-height: 1.6; }

    .evidence-box {
      background: rgba(153,27,27,0.15); border: 1px solid rgba(153,27,27,0.4);
      border-radius: 8px; padding: 1.5rem; margin: 1rem 0;
    }
    .evidence-box.found {
      background: rgba(22,163,74,0.15); border-color: rgba(22,163,74,0.4);
    }
    .evidence-header {
      display: flex; align-items: center; gap: 0.75rem;
      font-weight: 700; margin-bottom: 1rem; font-size: 1.1rem;
    }
    .evidence-icon { font-size: 1.5rem; }

    .statistic-card {
      background: linear-gradient(135deg, rgba(124,58,237,0.2), rgba(124,58,237,0.05));
      border: 1px solid rgba(124,58,237,0.3);
      border-radius: 12px; padding: 1.5rem; text-align: center; margin: 1rem 0;
    }
    .statistic-value {
      font-size: 3rem; font-weight: 700; color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
    }
    .statistic-label { font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem; }
    .statistic-context { font-size: 0.8rem; color: var(--evidence-red); margin-top: 0.5rem; font-weight: 600; }

    /* Tool Panel */
    .tool-panel {
      background: linear-gradient(135deg, rgba(13,148,136,0.1), rgba(13,148,136,0.02));
      border: 1px solid rgba(13,148,136,0.3);
      border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0;
    }
    .tool-header {
      display: flex; align-items: center; gap: 0.75rem;
      margin-bottom: 1rem; padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(13,148,136,0.2);
    }
    .tool-icon { font-size: 1.5rem; }
    .tool-title { font-size: 1.1rem; font-weight: 700; color: var(--teal); }
    .tool-description { font-size: 0.85rem; color: rgba(255,255,255,0.6); margin-bottom: 1rem; }
    .tool-controls {
      display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem;
      padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;
    }
    .tool-control { display: flex; flex-direction: column; gap: 0.25rem; }
    .tool-control label { font-size: 0.8rem; color: rgba(255,255,255,0.6); }
    .tool-control input, .tool-control select {
      padding: 0.5rem; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1); color: var(--cream); font-size: 0.9rem;
    }
    .plot-area {
      background: rgba(0,0,0,0.3); border-radius: 8px;
      min-height: 400px; margin: 1rem 0;
    }

    /* Decision Tree */
    .decision-tree {
      background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(245,158,11,0.02));
      border: 1px solid rgba(245,158,11,0.3);
      border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0;
    }
    .decision-title {
      font-size: 1.2rem; font-weight: 700; color: var(--amber); margin-bottom: 0.5rem;
    }
    .decision-situation {
      font-size: 0.95rem; color: rgba(255,255,255,0.8);
      padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;
      margin-bottom: 1.5rem; line-height: 1.6;
    }
    .decision-node { margin: 1rem 0; }
    .decision-question {
      font-weight: 600; color: var(--cream); margin-bottom: 1rem;
      padding: 1rem; background: rgba(245,158,11,0.1); border-radius: 8px;
    }
    .decision-branches { display: flex; flex-direction: column; gap: 0.5rem; }
    .decision-branch {
      width: 100%; text-align: left; font-family: inherit; font-size: inherit;
      color: var(--cream); padding: 1rem; background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
      cursor: pointer; transition: all 0.2s;
    }
    .decision-branch:hover {
      background: rgba(255,255,255,0.1); border-color: var(--gold);
    }
    .decision-branch:focus {
      outline: 3px solid var(--gold); outline-offset: 2px;
    }
    .decision-outcome {
      padding: 1.5rem; border-radius: 8px; margin-top: 1rem;
    }
    .decision-outcome.good {
      background: rgba(22,163,74,0.15); border: 1px solid rgba(22,163,74,0.4);
    }
    .decision-outcome.bad {
      background: rgba(220,38,38,0.15); border: 1px solid rgba(220,38,38,0.4);
    }
    .decision-outcome.neutral {
      background: rgba(245,158,11,0.15); border: 1px solid rgba(245,158,11,0.4);
    }
    .outcome-title { font-weight: 700; font-size: 1.1rem; margin-bottom: 0.75rem; }
    .outcome-text { line-height: 1.6; margin-bottom: 0.75rem; }
    .outcome-case { font-size: 0.85rem; color: rgba(255,255,255,0.6); font-style: italic; }

    /* Method Box */
    .method-box {
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; padding: 1.5rem; margin: 1rem 0;
    }
    .method-box h3 { color: var(--gold); margin-bottom: 0.75rem; }
    .method-box ul { padding-left: 1.5rem; }
    .method-box li { margin: 0.5rem 0; line-height: 1.5; }

    /* Quiz */
    .quiz-container { margin: 1.5rem 0; }
    .quiz-question {
      font-size: 1.1rem; font-weight: 600; margin-bottom: 1.5rem;
      padding: 1rem; background: rgba(124,58,237,0.1); border-radius: 8px;
    }
    .quiz-options { display: flex; flex-direction: column; gap: 0.75rem; }
    .quiz-option {
      padding: 1rem; background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
      cursor: pointer; transition: all 0.2s;
    }
    .quiz-option:hover { background: rgba(255,255,255,0.1); }
    .quiz-option.correct { background: rgba(22,163,74,0.2); border-color: var(--green); }
    .quiz-option.incorrect { background: rgba(220,38,38,0.2); border-color: var(--red); }
    .quiz-explanation {
      margin-top: 1rem; padding: 1rem; background: rgba(124,58,237,0.1);
      border-radius: 8px; display: none;
    }
    .quiz-explanation.visible { display: block; }

    /* Slide Title */
    .slide-title {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 2rem; color: var(--gold); margin-bottom: 1.5rem;
      border-bottom: 2px solid rgba(212,175,55,0.3); padding-bottom: 0.75rem;
    }

    /* Principle Display */
    .principle-display {
      text-align: center; padding: 3rem;
      background: linear-gradient(135deg, rgba(212,175,55,0.1), transparent);
      border-radius: 12px; margin: 1rem 0;
    }
    .principle-number {
      font-size: 4rem; font-weight: 700; color: var(--gold); opacity: 0.3;
      font-family: 'Cormorant Garamond', serif;
    }
    .principle-text {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.8rem; font-style: italic; color: var(--cream);
      max-width: 700px; margin: 0 auto; line-height: 1.5;
    }

    /* Cycle Return */
    .cycle-return {
      background: linear-gradient(135deg, rgba(212,175,55,0.1), transparent);
      border-left: 4px solid var(--gold);
      padding: 1.5rem; margin: 1.5rem 0; border-radius: 0 8px 8px 0;
    }
    .cycle-return .principle-recall {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.2rem; font-style: italic; color: var(--gold);
    }

    /* Clinical Guide */
    .clinical-guide {
      background: rgba(13,148,136,0.1); border: 1px solid rgba(13,148,136,0.3);
      border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0;
    }
    .clinical-guide h3 { color: var(--teal); margin-bottom: 1rem; }
    .clinical-guide ul { padding-left: 1.5rem; }
    .clinical-guide li { margin: 0.75rem 0; line-height: 1.5; }

    /* Glossary Overlay */
    .glossary-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9); z-index: 1000;
      display: none; justify-content: center; align-items: center;
    }
    .glossary-overlay.open { display: flex; }
    .glossary-panel {
      background: var(--navy); border: 1px solid rgba(212,175,55,0.3);
      border-radius: 12px; width: 90%; max-width: 600px; max-height: 80vh;
      overflow: hidden; display: flex; flex-direction: column;
    }
    .glossary-header {
      padding: 1rem 1.5rem; border-bottom: 1px solid rgba(212,175,55,0.2);
      display: flex; justify-content: space-between; align-items: center;
    }
    .glossary-close {
      background: none; border: none; color: var(--cream);
      font-size: 1.5rem; cursor: pointer;
    }
    .glossary-search {
      padding: 0.75rem 1rem; margin: 1rem;
      background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px; color: var(--cream); font-size: 1rem; width: calc(100% - 2rem);
    }
    .glossary-content { flex: 1; overflow-y: auto; padding: 1rem; }
    .glossary-term { padding: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); }

    /* Contrast Box - Two-path comparison style */
    .contrast-box {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
      margin: 1.5rem 0;
      border-radius: 12px;
      overflow: hidden;
    }
    .contrast-side {
      padding: 1.5rem;
    }
    .contrast-side.dark {
      background: linear-gradient(135deg, rgba(153,27,27,0.3), rgba(153,27,27,0.1));
      border: 1px solid rgba(153,27,27,0.4);
    }
    .contrast-side.light {
      background: linear-gradient(135deg, rgba(22,163,74,0.3), rgba(22,163,74,0.1));
      border: 1px solid rgba(22,163,74,0.4);
    }
    .contrast-header {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .contrast-side.dark .contrast-header { color: #fca5a5; }
    .contrast-side.light .contrast-header { color: #86efac; }
    .contrast-items { list-style: none; padding: 0; }
    .contrast-items li {
      padding: 0.5rem 0;
      padding-left: 1.5rem;
      position: relative;
      line-height: 1.5;
    }
    .contrast-side.dark .contrast-items li::before {
      content: '✗';
      position: absolute;
      left: 0;
      color: #ef4444;
    }
    .contrast-side.light .contrast-items li::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: #22c55e;
    }
    .contrast-consequence {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      font-style: italic;
    }

    /* Oath/Emphatic Statement */
    .oath-box {
      background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.05));
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 2rem;
      margin: 1.5rem 0;
      text-align: center;
    }
    .oath-header {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      color: var(--gold);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: 1rem;
    }
    .oath-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.4rem;
      line-height: 1.8;
      color: var(--cream);
    }
    .oath-text strong {
      color: var(--gold);
    }

    /* Death Toll Counter */
    .death-toll {
      background: linear-gradient(135deg, rgba(153,27,27,0.4), rgba(0,0,0,0.3));
      border: 1px solid rgba(153,27,27,0.6);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      margin: 1rem 0;
    }
    .death-toll-number {
      font-size: 3.5rem;
      font-weight: 700;
      color: #ef4444;
      font-family: 'Cormorant Garamond', serif;
    }
    .death-toll-label {
      font-size: 1rem;
      color: rgba(255,255,255,0.8);
      margin-top: 0.5rem;
    }
    .death-toll-source {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.5);
      margin-top: 0.5rem;
      font-style: italic;
    }

    /* Learning Objectives Box */
    .learning-objectives {
      background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(59,130,246,0.05));
      border: 1px solid rgba(59,130,246,0.4);
      border-left: 4px solid #3b82f6;
      border-radius: 0 12px 12px 0;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .learning-objectives-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      color: #60a5fa;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    .learning-objectives ul {
      padding-left: 1.5rem;
      margin: 0;
    }
    .learning-objectives li {
      margin: 0.5rem 0;
      line-height: 1.5;
      color: rgba(255,255,255,0.9);
    }

    /* Key Takeaways Box */
    .key-takeaways {
      background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.05));
      border: 1px solid rgba(34,197,94,0.4);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .key-takeaways-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      color: #4ade80;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    .key-takeaways ul {
      padding-left: 1.5rem;
      margin: 0;
    }
    .key-takeaways li {
      margin: 0.5rem 0;
      line-height: 1.5;
    }

    /* Common Mistakes Warning */
    .common-mistakes {
      background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.05));
      border: 1px solid rgba(239,68,68,0.4);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .common-mistakes-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      color: #f87171;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    .common-mistakes ul {
      padding-left: 1.5rem;
      margin: 0;
    }
    .common-mistakes li {
      margin: 0.5rem 0;
      line-height: 1.5;
    }

    /* Patient Communication Box */
    .patient-communication {
      background: linear-gradient(135deg, rgba(168,85,247,0.15), rgba(168,85,247,0.05));
      border: 1px solid rgba(168,85,247,0.4);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .patient-communication-header {
      font-weight: 700;
      color: #c084fc;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    .dialogue-box {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 1rem;
      margin: 0.75rem 0;
    }
    .dialogue-speaker {
      font-weight: 600;
      color: var(--gold);
      margin-bottom: 0.25rem;
    }
    .dialogue-text {
      font-style: italic;
      line-height: 1.6;
      color: rgba(255,255,255,0.85);
    }

    /* Protagonist Story Box */
    .protagonist-story {
      background: linear-gradient(135deg, rgba(212,175,55,0.1), transparent);
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .protagonist-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }
    .protagonist-title {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.6);
      margin-bottom: 1rem;
    }
    .protagonist-quote {
      font-style: italic;
      border-left: 3px solid var(--gold);
      padding-left: 1rem;
      margin: 1rem 0;
      color: rgba(255,255,255,0.9);
    }

    /* Legal Disclaimer */
    .legal-disclaimer {
      background: rgba(245,158,11,0.1);
      border: 1px solid rgba(245,158,11,0.3);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      font-size: 0.85rem;
      color: rgba(255,255,255,0.7);
    }
    .legal-disclaimer strong {
      color: var(--amber);
    }

    /* Printable Checklist */
    .printable-checklist {
      background: rgba(255,255,255,0.05);
      border: 2px dashed rgba(255,255,255,0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .printable-checklist-header {
      text-align: center;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    .checklist-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .checklist-box {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.4);
      border-radius: 3px;
      flex-shrink: 0;
      margin-top: 2px;
    }

    /* Additional Patient Communication Styles */
    .communication-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      color: #c084fc;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    .scenario {
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      font-style: italic;
    }
    .script-box {
      background: rgba(168,85,247,0.2);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
    }
    .script-label {
      font-weight: 600;
      color: #c084fc;
      margin-bottom: 0.5rem;
    }
    .script-text {
      font-size: 1.05rem;
      line-height: 1.7;
      color: rgba(255,255,255,0.95);
    }
    .key-points {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(168,85,247,0.3);
    }
    .key-points ul {
      padding-left: 1.5rem;
      margin: 0.5rem 0 0 0;
    }

    /* Additional Protagonist Story Styles */
    .protagonist-header {
      margin-bottom: 1rem;
    }
    .protagonist-role {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.6);
    }
    .protagonist-narrative {
      line-height: 1.7;
      margin-bottom: 1rem;
    }
    .protagonist-impact {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(212,175,55,0.3);
      color: rgba(255,255,255,0.9);
    }

    /* Additional Legal Disclaimer Styles */
    .disclaimer-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      color: #fbbf24;
      margin-bottom: 0.75rem;
    }
    .disclaimer-text {
      line-height: 1.6;
    }
    .disclaimer-resources {
      margin-top: 1rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(245,158,11,0.3);
    }
    .disclaimer-resources ul {
      padding-left: 1.5rem;
      margin: 0.5rem 0 0 0;
    }
    .disclaimer-resources a {
      color: #fbbf24;
    }

    /* Additional Printable Checklist Styles */
    .checklist-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.5rem;
      font-size: 1.2rem;
    }
    .print-instruction {
      color: rgba(255,255,255,0.6);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    .checklist-section {
      margin: 1rem 0;
    }
    .checklist-section h4 {
      color: #60a5fa;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }
    .checklist-section ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .checklist-section li {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.4rem 0;
    }
    .print-btn {
      display: block;
      width: 100%;
      margin-top: 1.5rem;
      padding: 0.75rem;
      background: var(--gold);
      color: #1a1a2e;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 1rem;
    }
    .print-btn:hover {
      background: #e6c847;
    }

    /* Key Takeaways Action Item */
    .action-item {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(34,197,94,0.2);
      border-radius: 8px;
      border-left: 4px solid #4ade80;
    }

    /* Common Mistakes Header */
    .mistakes-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      color: #f87171;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    /* Practice Case Styles */
    .practice-case {
      background: linear-gradient(135deg, rgba(6,182,212,0.15), rgba(6,182,212,0.05));
      border: 1px solid rgba(6,182,212,0.4);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .practice-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      color: #22d3ee;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    .case-scenario {
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      line-height: 1.6;
    }
    .sample-data {
      margin: 1rem 0;
    }
    .sample-data h4 {
      color: #22d3ee;
      margin-bottom: 0.5rem;
    }
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    .data-table th, .data-table td {
      padding: 0.5rem;
      border: 1px solid rgba(6,182,212,0.3);
      text-align: center;
    }
    .data-table th {
      background: rgba(6,182,212,0.2);
      color: #22d3ee;
      font-weight: 600;
    }
    .practice-questions {
      margin-top: 1rem;
    }
    .practice-questions h4 {
      color: #22d3ee;
      margin-bottom: 0.5rem;
    }
    .practice-questions ol {
      padding-left: 1.5rem;
    }
    .practice-questions li {
      margin: 0.5rem 0;
      line-height: 1.5;
    }
    .answers-reveal {
      margin-top: 1rem;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 1rem;
    }
    .answers-reveal summary {
      cursor: pointer;
      color: #22d3ee;
      font-weight: 600;
    }
    .answers-reveal ol {
      padding-left: 1.5rem;
      margin-top: 0.75rem;
    }

    /* Pre-Assessment Styles */
    .pre-assessment {
      background: linear-gradient(135deg, rgba(249,115,22,0.15), rgba(249,115,22,0.05));
      border: 1px solid rgba(249,115,22,0.4);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .assessment-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      color: #fb923c;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    /* Redemption Story Styles */
    .redemption-story {
      background: linear-gradient(135deg, rgba(52,211,153,0.15), rgba(52,211,153,0.05));
      border: 1px solid rgba(52,211,153,0.4);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .redemption-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      color: #34d399;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    .redemption-narrative {
      line-height: 1.7;
      margin-bottom: 1rem;
    }
    .redemption-lesson {
      background: rgba(52,211,153,0.2);
      border-radius: 8px;
      padding: 1rem;
      border-left: 4px solid #34d399;
    }

    /* Real-World Story Styles */
    .story-container {
      background: linear-gradient(135deg, rgba(30,58,95,0.5), rgba(15,15,26,0.7));
      border: 1px solid rgba(212,175,55,0.4);
      border-radius: 16px;
      padding: 2rem;
      margin: 1.5rem 0;
      position: relative;
    }
    .story-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--evidence-red), var(--gold));
      border-radius: 16px 16px 0 0;
    }
    .story-opening {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.6rem;
      font-style: italic;
      color: var(--gold);
      text-align: center;
      padding: 2rem 1.5rem;
      line-height: 1.6;
      border-left: 4px solid var(--evidence-red);
      background: linear-gradient(135deg, rgba(153,27,27,0.15), transparent);
      margin: -2rem -2rem 1.5rem -2rem;
      border-radius: 16px 16px 0 0;
    }
    .stats-box {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      background: rgba(124,58,237,0.15);
      border: 1px solid rgba(124,58,237,0.4);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .stats-box-header {
      grid-column: 1 / -1;
      font-weight: 700;
      color: #a78bfa;
      font-size: 1.1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(124,58,237,0.3);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .stat-item {
      text-align: center;
      padding: 1rem;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
    }
    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
    }
    .stat-label {
      font-size: 0.85rem;
      color: rgba(255,255,255,0.7);
      margin-top: 0.25rem;
    }
    .interactive-decision-tree {
      background: linear-gradient(135deg, rgba(245,158,11,0.12), rgba(245,158,11,0.03));
      border: 1px solid rgba(245,158,11,0.4);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .decision-scenario {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      border-left: 4px solid var(--amber);
    }
    .decision-scenario-title {
      font-weight: 700;
      color: var(--amber);
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    .decision-path {
      margin: 1rem 0;
      padding: 1.25rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    .decision-path.path-a {
      background: linear-gradient(135deg, rgba(220,38,38,0.15), rgba(220,38,38,0.05));
      border-color: rgba(220,38,38,0.4);
    }
    .decision-path.path-a:hover {
      background: linear-gradient(135deg, rgba(220,38,38,0.25), rgba(220,38,38,0.1));
      border-color: rgba(220,38,38,0.6);
      transform: translateX(5px);
    }
    .decision-path.path-b {
      background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.05));
      border-color: rgba(34,197,94,0.4);
    }
    .decision-path.path-b:hover {
      background: linear-gradient(135deg, rgba(34,197,94,0.25), rgba(34,197,94,0.1));
      border-color: rgba(34,197,94,0.6);
      transform: translateX(5px);
    }
    .decision-path:focus {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }
    .path-header {
      font-weight: 700;
      font-size: 1.05rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .path-a .path-header { color: #fca5a5; }
    .path-b .path-header { color: #86efac; }
    .path-arrow {
      display: inline-block;
      margin-left: 0.5rem;
      transition: transform 0.2s;
    }
    .decision-path:hover .path-arrow {
      transform: translateX(5px);
    }
    .path-consequence {
      padding-top: 0.75rem;
      border-top: 1px dashed rgba(255,255,255,0.2);
      margin-top: 0.75rem;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .revelation-box {
      background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(212,175,55,0.08));
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
      text-align: center;
    }
    .revelation-header {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--gold);
      margin-bottom: 1rem;
    }
    .revelation-text {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem;
      line-height: 1.7;
      color: var(--gold);
      font-style: italic;
    }
    .revelation-detail {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: rgba(255,255,255,0.8);
      font-family: 'Source Sans Pro', sans-serif;
      font-style: normal;
    }
    .story-refrain {
      text-align: center;
      padding: 1.5rem;
      margin: 1.5rem 0;
      background: linear-gradient(90deg, transparent, rgba(212,175,55,0.1), transparent);
      border-top: 1px solid rgba(212,175,55,0.3);
      border-bottom: 1px solid rgba(212,175,55,0.3);
    }
    .story-refrain p {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.4rem;
      font-style: italic;
      color: var(--gold);
      margin: 0;
    }
    .story-timeline {
      position: relative;
      padding-left: 2rem;
      margin: 1.5rem 0;
    }
    .story-timeline::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, var(--gold), var(--evidence-red), var(--green));
    }
    .timeline-step {
      position: relative;
      padding: 1rem 0 1rem 1.5rem;
    }
    .timeline-step::before {
      content: '';
      position: absolute;
      left: -1.5rem;
      top: 1.25rem;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--gold);
      border: 2px solid var(--deep-navy);
    }
    .timeline-step.danger::before { background: var(--evidence-red); }
    .timeline-step.success::before { background: var(--green); }
    .step-label {
      font-weight: 700;
      color: var(--gold);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }
    .step-content {
      line-height: 1.6;
      color: rgba(255,255,255,0.9);
    }

    /* Print styles */
    @media print {
      .course-nav, .progress-bar, .nav-buttons {
        display: none !important;
      }
      .printable-checklist {
        border: 2px solid #333;
        page-break-inside: avoid;
      }
      .checklist-box {
        border: 2px solid #333;
      }
    }

    /* Mobile Responsiveness */
    @media (max-width: 900px) {
      .course-container {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        height: auto;
        max-height: 200px;
        border-right: none;
        border-bottom: 1px solid rgba(212,175,55,0.2);
      }
      .module-list {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        padding: 0.5rem;
        gap: 0.5rem;
      }
      .module-item {
        flex-shrink: 0;
        padding: 0.5rem 0.75rem;
        border-left: none;
        border-bottom: 3px solid transparent;
      }
      .module-item.active {
        border-left: none;
        border-bottom-color: var(--gold);
      }
      .sidebar-footer {
        padding: 0.5rem 1rem;
      }
      .main-content {
        height: calc(100vh - 200px);
      }
      .slide-container {
        padding: 1rem;
      }
      .rhetoric-question {
        font-size: 1.4rem;
        padding: 1.5rem 1rem;
      }
      .principle-text {
        font-size: 1.4rem;
      }
      .tool-controls {
        flex-direction: column;
      }
      .contrast-box {
        flex-direction: column;
      }
    }

    @media (max-width: 600px) {
      .sidebar {
        max-height: 150px;
      }
      .module-info {
        display: none;
      }
      .module-number {
        width: 32px;
        height: 32px;
        font-size: 0.9rem;
      }
      .slide-title {
        font-size: 1.5rem;
      }
      .case-file-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .decision-branches {
        gap: 0.5rem;
      }
      .decision-branch {
        padding: 0.75rem;
      }
      .data-table {
        font-size: 0.75rem;
      }
      .data-table th, .data-table td {
        padding: 0.25rem;
      }
    }

    /* Floating Glossary Button */
    .floating-glossary {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--gold);
      color: var(--deep-navy);
      border: none;
      cursor: pointer;
      font-size: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .floating-glossary:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
    }
    @media (min-width: 901px) {
      .floating-glossary {
        display: none;
      }
    }

    /* Reading Level Indicator */
    .reading-level {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: rgba(124,58,237,0.2);
      border: 1px solid rgba(124,58,237,0.4);
      border-radius: 20px;
      font-size: 0.75rem;
      color: #a78bfa;
      margin-top: 0.5rem;
    }

    /* Module Time Estimate */
    .module-time {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.4);
      margin-top: 0.15rem;
    }

    /* Chart Accessibility Description */
    .chart-description {
      position: absolute;
      left: -9999px;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .chart-description-visible {
      position: static;
      width: auto;
      height: auto;
      background: rgba(0,0,0,0.3);
      padding: 0.75rem;
      margin-top: 0.5rem;
      border-radius: 8px;
      font-size: 0.85rem;
      color: rgba(255,255,255,0.7);
    }

    /* Animation */
    .animate-in {
      animation: fadeSlideIn 0.4s ease-out;
    }
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ============================================
       ACCESSIBILITY FEATURES
       ============================================ */

    /* Skip to Content Link */
    .skip-link {
      position: absolute;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--gold);
      color: var(--deep-navy);
      padding: 0.75rem 1.5rem;
      border-radius: 0 0 8px 8px;
      font-weight: 600;
      text-decoration: none;
      z-index: 10000;
      transition: top 0.3s ease;
    }
    .skip-link:focus {
      top: 0;
      outline: 3px solid var(--evidence-red);
      outline-offset: 2px;
    }

    /* Visible Focus States */
    *:focus {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }
    *:focus:not(:focus-visible) {
      outline: none;
    }
    *:focus-visible {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }
    button:focus-visible,
    .top-bar-btn:focus-visible,
    .module-item:focus-visible {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
      box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.3);
    }
    input:focus-visible,
    textarea:focus-visible,
    select:focus-visible {
      outline: 3px solid var(--gold);
      outline-offset: 0;
      border-color: var(--gold);
    }
    a:focus-visible {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
      text-decoration: underline;
    }

    /* ============================================
       DARK/LIGHT MODE TOGGLE
       ============================================ */

    /* Light Mode Variables */
    .light-mode {
      --navy: #e8e8f0;
      --deep-navy: #f5f5fa;
      --gold: #b8860b;
      --cream: #1a1a2e;
      --detective-blue: #d0dbe8;
      --evidence-red: #dc2626;
    }
    .light-mode .course-container {
      background: #f5f5fa;
    }
    .light-mode .sidebar {
      background: linear-gradient(180deg, #e8eef5 0%, #f5f5fa 100%);
      border-right-color: rgba(184, 134, 11, 0.3);
    }
    .light-mode .sidebar-header {
      background: rgba(0, 0, 0, 0.05);
    }
    .light-mode .main-content {
      background: #ffffff;
    }
    .light-mode .top-bar {
      background: rgba(0, 0, 0, 0.05);
      border-bottom-color: rgba(184, 134, 11, 0.2);
    }
    .light-mode .slide-container {
      background: #ffffff;
    }
    .light-mode .case-file {
      background: linear-gradient(135deg, rgba(208, 219, 232, 0.6), rgba(245, 245, 250, 0.8));
      border-color: rgba(184, 134, 11, 0.4);
    }
    .light-mode .evidence-box {
      background: rgba(220, 38, 38, 0.1);
      border-color: rgba(220, 38, 38, 0.3);
    }
    .light-mode .evidence-box.found {
      background: rgba(22, 163, 74, 0.1);
      border-color: rgba(22, 163, 74, 0.3);
    }
    .light-mode .top-bar-btn {
      background: rgba(0, 0, 0, 0.08);
      border-color: rgba(0, 0, 0, 0.15);
      color: #1a1a2e;
    }
    .light-mode .top-bar-btn:hover {
      background: rgba(0, 0, 0, 0.12);
    }
    .light-mode .glossary-overlay .glossary-panel {
      background: #ffffff;
      border-color: rgba(184, 134, 11, 0.3);
    }
    .light-mode .glossary-search {
      background: #f5f5fa;
      border-color: rgba(0, 0, 0, 0.2);
      color: #1a1a2e;
    }

    /* Theme Toggle Button */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--detective-blue);
      border: 2px solid var(--gold);
      color: var(--gold);
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }
    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    }
    .light-mode .theme-toggle {
      background: #ffffff;
    }

    /* ============================================
       CERTIFICATE OF COMPLETION
       ============================================ */

    .certificate-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }
    .certificate-overlay.open {
      display: flex;
    }
    .certificate-container {
      background: linear-gradient(135deg, #fdf6e3 0%, #fff8dc 50%, #fdf6e3 100%);
      border: 8px double var(--gold);
      border-radius: 12px;
      padding: 3rem;
      max-width: 700px;
      width: 100%;
      text-align: center;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }
    .certificate-seal {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--gold), #c5a028);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.5);
    }
    .certificate-title {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--detective-blue);
      margin-top: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
    }
    .certificate-subtitle {
      font-size: 1rem;
      color: #666;
      margin-bottom: 1.5rem;
    }
    .certificate-body {
      font-size: 1.1rem;
      color: #333;
      line-height: 1.8;
      margin: 1.5rem 0;
    }
    .certificate-name {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 2rem;
      font-weight: 700;
      color: var(--evidence-red);
      border-bottom: 2px solid var(--gold);
      display: inline-block;
      padding: 0 2rem 0.5rem;
      margin: 1rem 0;
    }
    .certificate-date {
      font-size: 0.9rem;
      color: #666;
      margin-top: 1.5rem;
    }
    .certificate-id {
      font-size: 0.75rem;
      color: #999;
      margin-top: 0.5rem;
      font-family: monospace;
    }
    .certificate-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 2rem;
    }
    .certificate-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .certificate-btn.primary {
      background: var(--gold);
      color: var(--deep-navy);
      border: none;
    }
    .certificate-btn.secondary {
      background: transparent;
      color: #666;
      border: 2px solid #ccc;
    }
    .certificate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    .certificate-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: #eee;
      color: #666;
      font-size: 1.2rem;
      cursor: pointer;
    }

    /* Certificate Name Input Modal */
    .name-input-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10001;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .name-input-modal.open {
      display: flex;
    }
    .name-input-box {
      background: var(--deep-navy);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      text-align: center;
    }
    .name-input-box h3 {
      color: var(--gold);
      margin-bottom: 1rem;
    }
    .name-input-box input {
      width: 100%;
      padding: 0.75rem;
      font-size: 1.1rem;
      border: 2px solid rgba(212, 175, 55, 0.3);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--cream);
      margin-bottom: 1rem;
    }
    .name-input-box button {
      padding: 0.75rem 2rem;
      background: var(--gold);
      color: var(--deep-navy);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }

    /* Reduced Motion */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    .mobile-menu-toggle{display:none;position:fixed;top:12px;left:12px;z-index:1001;background:#1E2761;border:1px solid #D4AF37;color:#D4AF37;width:40px;height:40px;border-radius:8px;font-size:1.2rem;cursor:pointer;align-items:center;justify-content:center;}
    @media(max-width:768px){.mobile-menu-toggle{display:flex;}.sidebar{transform:translateX(-100%);transition:transform 0.3s ease;position:fixed;z-index:1000;height:100vh;}.sidebar.open{transform:translateX(0);}.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:999;}.sidebar-overlay.show{display:block;}}
  </style>
</head>
<body>
<!-- Skip to Content Link (Accessibility) -->
<a class="skip-link" href="#main-content" id="skipLink">Skip to main content</a>
<button aria-expanded="false" aria-label="Toggle navigation menu" class="mobile-menu-toggle" onclick="toggleSidebar()">☰</button>
<div class="sidebar-overlay" onclick="document.querySelector('.sidebar').classList.remove('open');this.classList.remove('show');"></div>
<div class="course-container">
<!-- Sidebar -->
<nav aria-label="코스 탐색" class="sidebar">
<div class="sidebar-header">
<a href="index.html" onmouseout="this.style.color='rgba(212,175,55,0.7)'" onmouseover="this.style.color='#D4AF37'" style="display:block;font-size:0.7rem;color:rgba(212,175,55,0.7);text-decoration:none;margin-bottom:0.5rem;">← Course Library</a>
<h1>Publication Bias Detective</h1>
<p>빛을 보지 못한 증거</p>
<span class="sidebar-badge">Investigation Unit</span>
</div>
<div class="module-list" id="moduleList"></div>
<div class="sidebar-footer">
<button class="top-bar-btn" onclick="openGlossary()" style="width:100%;margin-bottom:0.5rem;">
          Investigator's Glossary
        </button>
<div class="progress-bar-container">
<div class="progress-label">Case Progress: <span id="progressPercent">0%</span></div>
<div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
</div>
</div>
</nav>
<!-- Main Content -->
<div class="main-content">
<div class="top-bar">
<div>
<span class="module-indicator" id="moduleIndicator">Case File 0</span>
<span class="slide-counter" id="slideCounter">1 / 1</span>
</div>
<div class="top-bar-actions">
<button class="top-bar-btn" id="prevBtn" onclick="prevSlide()">Previous</button>
<button class="top-bar-btn" id="nextBtn" onclick="nextSlide()">Next</button>
</div>
</div>
<div class="slide-container" id="main-content"></div>
</div>
</div>
<!-- Glossary Overlay -->
<div class="glossary-overlay" id="glossaryOverlay">
<div class="glossary-panel">
<div class="glossary-header">
<h3 style="color:var(--gold)">Investigator's Glossary</h3>
<button class="glossary-close" onclick="closeGlossary()">×</button>
</div>
<input class="glossary-search" id="glossarySearch" oninput="filterGlossary()" placeholder="Search terms..." type="text"/>
<div class="glossary-content" id="glossaryContent"></div>
</div>
</div>
<!-- Theme Toggle Button -->
<button aria-label="Toggle dark/light mode" class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle dark/light mode">
    🌙
  </button>
<!-- Certificate Overlay -->
<div aria-labelledby="certTitle" class="certificate-overlay" id="certificateOverlay" role="dialog">
<div class="certificate-container" id="certificateContainer">
<button aria-label="인증서 닫기" class="certificate-close" onclick="closeCertificate()">×</button>
<div class="certificate-seal">🏆</div>
<h1 class="certificate-title" id="certTitle">Certificate of Completion</h1>
<p class="certificate-subtitle">Publication Bias Detective Training Program</p>
<div class="certificate-body">
<p>출판편향탐정</p>
<div class="certificate-name" id="certName">Investigator Name</div>
<p>을 성공적으로 마쳤음을 인증하는 것입니다</p>
<p><strong style="color: var(--detective-blue); font-size: 1.2rem;">체계적 검토 및 메타 분석에서 출판 편향을 식별, 평가 및 완화하는 능력을 보여주는 과정</strong></p>
<p>체계적인 검토 및 메타 분석에서 출판 편견을 식별, 평가 및 완화하는 데 능숙함을 입증합니다.</p>
</div>
<div class="certificate-date" id="certDate">Completed on: January 1, 2025</div>
<div class="certificate-id" id="certId">Certificate ID: PBD-000000</div>
<div class="certificate-actions">
<button class="certificate-btn primary" onclick="printCertificate()">Print Certificate</button>
<button class="certificate-btn secondary" onclick="closeCertificate()">Close</button>
</div>
</div>
</div>
 인증서 이름 입력 모드 
<div aria-labelledby="nameInputTitle" class="name-input-modal" id="nameInputModal" role="dialog">
<div class="name-input-box">
<h3 id="nameInputTitle">Congratulations, Investigator!</h3>
<p style="color: rgba(255,255,255,0.7); margin-bottom: 1rem;">모든 모듈을 완료했습니다. 인증서 이름을 입력하세요:</p>
<input aria-label="당신의 이름" id="investigatorName" placeholder="당신의 이름" type="text"/>
<button onclick="generateCertificate()">Generate Certificate</button>
</div>
</div>
<script>
// ============================================================
// SIDEBAR TOGGLE
// ============================================================
function toggleSidebar() {
  var sidebar = document.querySelector('.sidebar');
  var overlay = document.querySelector('.sidebar-overlay');
  var btn = document.querySelector('.mobile-menu-toggle');
  if (sidebar) sidebar.classList.toggle('open');
  if (overlay) overlay.classList.toggle('show');
  if (btn) btn.setAttribute('aria-expanded', btn.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
}

// ============================================================
// GLOSSARY TERMS
// ============================================================
const glossaryTerms = [
  { term: "Publication Bias", def: "긍정적/유의한 결과가 있는 연구가 부정적/무결과가 있는 연구보다 더 자주 게시되는 경향이 있어 증거 기반이 왜곡됩니다." },
  { term: "Funnel Plot", def: "A scatter plot of effect size vs. precision (or sample size). Asymmetry suggests possible publication bias or other small-study effects." },
  { term: "Egger's Test", def: "A statistical test for funnel plot asymmetry. Regresses standardized effect on precision. Significant result (p<0.10) suggests bias." },
  { term: "Begg's Test", def: "Rank correlation test between effect size and variance. Less powerful than Egger's but makes fewer assumptions." },
  { term: "다듬기 및 채우기", def: "깔때기의 비대칭 부분을 '트리밍'하고 실제 중심을 추정한 다음 대치된 부분을 '채워서' 누락된 연구를 추정하는 방법 연구." },
  { term: "Contour-Enhanced Funnel Plot", def: "Funnel plot with significance contours (p=0.05, 0.01) overlaid. Helps distinguish publication bias from other causes of asymmetry." },
  { term: "File Drawer Problem", def: "게시되지 않은 null 연구에 대한 Rosenthal의 용어는 연구원 서랍에 '파일로 보관'되어 출판의 빛을 보지 못했습니다." },
  { term: "Fail-Safe N", def: "Number of null studies that would need to exist to reduce a significant meta-analytic result to non-significance. Higher = more robust." },
  { term: "Selection Model", def: "p-값 또는 효과 크기의 함수로 출판 확률을 명시적으로 모델링하는 통계 모델." },
  { term: "P-Curve", def: "Distribution of significant p-values. A right-skewed p-curve (many p<0.025) suggests true effect; left-skewed or flat suggests p-hacking or no effect." },
  { term: "Small-Study Effects", def: "Phenomenon where smaller studies show larger effects. Publication bias is one cause; others include genuine heterogeneity or methodological differences." },
  { term: "Trial Registry", def: "시작하기 전에 시험이 등록되는 데이터베이스 (예: ClinicalTrials.gov). 미발표 완료된 임상시험을 탐지할 수 있습니다." },
  { term: "FOIA Request", def: "FDA와 같은 규제 기관으로부터 미발표 데이터를 얻기 위한 정보자유법 요청" },
  { term: "Outcome Reporting Bias", def: "결과를 기반으로 연구 내 일부 결과만 선택적으로 보고합니다." },
  { term: "Spin", def: "데이터 없이도 데이터 보증보다 결과를 더 호의적으로 제시하는 오해의 소지가 있는 보고 제작." },
  { term: "Grey Literature", def: "Research not published in peer-reviewed journals: dissertations, conference abstracts, government reports, etc." },
  { term: "PET-PEESE", def: "정밀 효과 테스트 및 표준 오차를 사용한 정밀 효과 추정. 출판 편향을 수정하기 위한 회귀 기반 방법." },
  { term: "3PSM", def: "Three-Parameter Selection Model. Models selection probability as a step function at p=0.05." }
];

// ============================================================
// COURSE MODULES
// ============================================================
const modules = [
  // MODULE 0: THE GATEWAY
  {
    id: 0,
    title: "The Gateway",
    subtitle: "케이스 열기",
    estimatedMinutes: 15,
    slides: [
      {
        type: 'title',
        content: {
          title: "Publication Bias Detective",
          subtitle: "빛을 보지 못한 증거",
          text: "환영합니다, 조사관님. 당신은 이제 막 숨겨진 증거, 억압된 임상시험, 의학적 진실의 체계적 왜곡이 있는 숨겨진 세계로 들어가려고 합니다."
        }
      },
      {
        type: 'quiz',
        content: {
          question: "PRE-ASSESSMENT: Before we begin, what do you think publication bias typically does to meta-analytic effect estimates?",
          options: [
            { id: 'a', text: "Makes them more accurate by filtering out low-quality studies", correct: false },
            { id: 'b', text: "Inflates them by selectively publishing positive results", correct: true },
            { id: 'c', text: "Has no systematic effect — biases cancel out", correct: false },
            { id: 'd', text: "Deflates them by suppressing the most dramatic findings", correct: false }
          ],
          explanation: "Correct! Publication bias typically INFLATES effect estimates. Positive and statistically significant results are more likely to be published, while negative, null, or inconvenient findings often remain hidden. This creates a systematic overestimate of treatment effects in the published literature. By the end of this course, you'll understand exactly how this happens and what you can do about it."
        }
      },
      {
        type: 'learning-objectives',
        content: {
          intro: "By the end of this module, you will be able to:",
          objectives: [
            "Define publication bias and explain why it occurs",
            "실제 데이터를 사용하여 의학계의 출판 편향의 크기를 설명",
            "Identify 3 high-profile cases where publication bias caused patient harm",
            "Recognize why systematic reviews without bias assessment are incomplete",
            "긍정적 결과, 부정적 결과, 무효 결과의 차이를 설명합니다"
          ]
        }
      },
      {
        type: 'rhetoric',
        content: {
          question: "FDA, 출판된 문헌에 따르면 94%가 긍정적인 것으로 나타났습니다. FDA 자체 기록에서는 51%만이 긍정적인 것으로 나타났습니다."
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE ZERO",
          title: "문제의 심각성",
          source: "Turner 외, NEJM 2008 — 업계를 노출시킨 연구",
          timeline: [
            { year: "The Question", text: "Erick Turner, an FDA reviewer turned researcher, asked: What if we could see ALL the antidepressant trials — not just the published ones?", type: "normal" },
            { year: "The Method", text: "He obtained FDA records for 74 trials of 12 antidepressants. Then compared what FDA saw vs. what journals published.", type: "normal" },
            { year: "The Discovery", text: "Of 38 FDA-positive trials: 37 published (97%). Of 36 FDA-negative/questionable trials: only 14 published (39%). And of those 14, 11 were SPUN to appear positive.", type: "buried" },
            { year: "The Impact", text: "Published literature effect size: 0.41. Including unpublished: 0.31. A 32% INFLATION of apparent efficacy. Millions prescribed based on distorted evidence.", type: "revealed" }
          ],
          realData: {
            totalTrials: "74 trials submitted to FDA",
            publishedPositive: "94% appeared positive in literature",
            actualPositive: "51%가 긍정적인 것으로 나타났습니다. FDA",
            effectInflation: "32% overestimate in published literature"
          }
        }
      },
      {
        type: 'content',
        content: {
          title: "조사 툴킷",
          sections: [
            {
              heading: "Case File 1: The Buried Bodies",
              items: [
                "Reboxetine — 환자 데이터의 74%가 숨겨진 약",
                "Neurontin — 4억 3천만 달러 규모의 사기",
                "Vioxx — 알려졌으나 알려지지 않은 죽음 말함"
              ]
            },
            {
              heading: "Case File 2: The Funnel of Truth",
              items: [
                "Reading funnel plots — the detective's X-ray",
                "비대칭과 그 결과",
                "Contour-enhanced plots — seeing significance boundaries"
              ]
            },
            {
              heading: "Case File 3: The Statistical Tests",
              items: [
                "Egger's regression — the mathematical detector",
                "Begg's rank correlation — the non-parametric approach",
                "When tests fail and why"
              ]
            },
            {
              heading: "사례 파일 4: 수정 방법",
              items: [
                "자르기 및 채우기 — 누락된 부분 추정",
                "Selection models — modeling the censorship",
                "P-곡선 — 진실"
              ]
            },
            {
              heading: "사례 파일 5: 추적",
              items: [
                "Trial registries — finding what was started",
                "FDA 및 EMA 요청 — 규제 문서 추적",
                "Grey literature — the unpublished frontier"
              ]
            }
          ]
        }
      },
      {
        type: 'principle',
        content: {
          number: "I",
          text: "증거가 없다는 것은 부재의 증거가 아니라 억제의 증거일 수 있습니다."
        }
      },
      {
        type: 'key-takeaways',
        content: {
          takeaways: [
            "Publication bias inflates apparent treatment effects by ~30% on average",
            "Turner 항우울제 연구에서는 94%가 게시된 긍정적인 실험과 실제 긍정적인 실험 간의 51% 불일치",
            "누락된 데이터는 중립적이라고 가정할 수 없습니다. 데이터는 체계적으로 null/negative 결과 쪽으로 편향되어 있습니다.",
            "Every meta-analysis without bias assessment may be overestimating treatment effects",
            "Publication bias is not random error — it is systematic distortion"
          ],
          actionItem: "Before accepting any meta-analysis conclusion, ask: 'What efforts were made to find unpublished data?'"
        }
      }
    ]
  },

  // MODULE 1: THE BURIED BODIES
  {
    id: 1,
    title: "매장된 시체",
    subtitle: "억제에 대한 사례 연구",
    estimatedMinutes: 25,
    slides: [
      {
        type: 'learning-objectives',
        content: {
          intro: "By the end of this module, you will be able to:",
          objectives: [
            "Analyze 3 landmark cases of publication bias and their patient impact",
            "Reboxetine 사건에서 숨겨진 데이터의 비율",
            "억제를 가능하게 하는 재정 및 규제 메커니즘 설명",
            "공개된 증거가 불완전할 수 있다는 경고 신호 식별",
            "사망 및 장애로 인한 증거 억제로 인한 인적 비용 설명"
          ]
        }
      },
      {
        type: 'principle',
        content: {
          number: "I",
          text: "What is hidden shapes belief as powerfully as what is shown."
        }
      },
      {
        type: 'rhetoric',
        content: {
          question: "본 적이 없습니까? 화이자는 어떻게 가바펜틴이 자신들이 홍보한 조건에 효과가 없다는 증거를 묻고 시체가 발굴되었을 때 4억 3천만 달러를 지불했습니까?"
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 1A",
          title: "레복세틴: 74% 솔루션",
          source: "Eyding et al., BMJ 2010 — IQWiG's Systematic Investigation",
          timeline: [
            { year: "2000s", text: "Reboxetine marketed as an effective antidepressant. Published trials showed it worked. Doctors prescribed it. Patients took it.", type: "normal" },
            { year: "The Hunt", text: "독일 품질 효율성 연구소(IQWiG)는 게시된 것과 게시되지 않은 모든 시험 데이터를 화이자에게 요구했습니다.", type: "normal" },
            { year: "The Exhumation", text: "They found: 74% of patient data had NEVER been published. 8 trials, 2,256 patients — buried.", type: "buried" },
            { year: "The Truth", text: "공개된 데이터: 레복세틴은 위약보다 훨씬 더 좋습니다. 모든 데이터: 유의미한 차이가 없습니다. 출판된 문헌은 선별된 거짓말이었습니다.", type: "revealed" },
            { year: "The Verdict", text: "IQWiG는 레복세틴의 이점을 '증명되지 않음'으로 평가했습니다. 여러 국가에서 철회되거나 제한되었습니다.", type: "revealed" }
          ],
          realData: {
            publishedPatients: "게시된 환자 데이터의 26%",
            hiddenPatients: "레복세틴 환자 데이터의 74%가 표시되지 않음",
            publishedEffect: "Significant benefit vs placebo",
            trueEffect: "No significant benefit vs placebo",
            hiddenTrials: "8 trials with 2,256 patients never published"
          }
        }
      },
      {
        type: 'statistic-card',
        content: {
          value: "74%",
          label: "출판에서 숨겨졌습니다",
          context: "게시된 문헌은 26%의 증거"
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 1B",
          title: "Neurontin: 라벨 오프 기계",
          source: "Steinman et al., JAMA 2006 + DOJ Settlement 2004",
          timeline: [
            { year: "1994", text: "Gabapentin (Neurontin) approved by FDA for epilepsy. Limited market.", type: "normal" },
            { year: "The Strategy", text: "Parke-Davis/Pfizer promoted it for off-label uses: pain, bipolar, migraine. But trials for these uses were negative.", type: "normal" },
            { year: "The Burial", text: "공개된 내부 문서: 부정적인 임상시험이 억제되었습니다. 긍정적으로 보이는 분석이 선별되었습니다. 의학 저술가들이 호의적인 논문을 대필했습니다.", type: "buried" },
            { year: "The Evidence", text: "한 내부 이메일: '우리가 출판하는 내용에 주의해야 합니다. 데이터가 좋아 보이지 않습니다.' 또 다른 사항: 데이터가 '긍정적'이어야 하는' 용도에 대한 간행물 초안.", type: "buried" },
            { year: "The Settlement", text: "2004: Pfizer paid $430 million in criminal and civil penalties. But by then, Neurontin had generated $2.7 billion in off-label sales.", type: "revealed" }
          ],
          realData: {
            approvedUse: "Epilepsy only",
            offLabelSales: "매출의 90%가 라벨을 벗어난 홍보였습니다",
            settlement: "$430 million (criminal + civil)",
            revenue: "오프 라벨 프로모션에서 27억 달러",
            ratio: "6:1 profit to penalty ratio"
          }
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 1C",
          title: "Vioxx: The Deaths They Knew",
          source: "Krumholz et al., JAMA 2007 + Congressional Testimony",
          timeline: [
            { year: "1999", text: "Vioxx (rofecoxib) launched. Merck's blockbuster painkiller. Marketed as safer for stomach than older NSAIDs.", type: "normal" },
            { year: "2000", text: "VIGOR trial finds 5-fold increase in heart attacks vs. naproxen. Merck's interpretation: Naproxen is cardioprotective. Not: Vioxx is cardiotoxic.", type: "normal" },
            { year: "2000-2004", text: "Internal documents show Merck knew of cardiovascular signal. Training materials taught sales reps to 'DODGE' questions about CV safety.", type: "buried" },
            { year: "The Revelation", text: "APPROVe trial stopped: 2x heart attacks. Vioxx withdrawn. FDA scientist David Graham estimates: 88,000-140,000 excess heart attacks, ~30% fatal.", type: "revealed" },
            { year: "The Reckoning", text: "Merck settles for $4.85 billion. Internal documents revealed systematic suppression of safety signals.", type: "revealed" }
          ],
          realData: {
            yearsOnMarket: "5 years (1999-2004)",
            estimatedHeartAttacks: "88,000-140,000 excess cases",
            estimatedDeaths: "26,000-55,000",
            settlement: "$4.85 billion",
            internalKnowledge: "Cardiovascular signal known internally by 2000"
          }
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 1D",
          title: "연구 329: The Children They 멸종 위기에 처한",
          source: "Jureidini et al., BMJ 2015 — RIAT Reanalysis of GlaxoSmithKline Data",
          timeline: [
            { year: "2001", text: "연구 329가 JAACAP에 발표되었습니다. 주장: '파록세틴은 일반적으로 청소년의 주요 우울증에 잘 견디고 효과적입니다.' 저자에는 저명한 학자들이 포함되어 있습니다.", type: "normal" },
            { year: "The Hidden", text: "GSK 내부 문서에 따르면 파록세틴 그룹에서는 자살 관련 사건이 8건, 위약에서는 1건이었습니다. 약물의 자살 행동이 증가했습니다. 이는 출판물에서 숨겨졌습니다.", type: "buried" },
            { year: "The Spin", text: "출판된 논문은 자살 사건을 '정서적 불안'으로 재분류했습니다. 사전에 명시되지 않은 결과로 전환함으로써 유효성이 주장되었습니다. 논문은 대필되었습니다.", type: "buried" },
            { year: "2004", text: "FDA는 소아용 항우울제에 대해 블랙박스 경고를 발행했습니다. GSK는 연구 329를 포함한 사기 혐의로 30억 달러(2012)의 벌금을 부과했습니다. 이 약은 수백만 명의 어린이에게 처방되었습니다.", type: "revealed" },
            { year: "2015", text: "RIAT reanalysis using actual trial data: 'Paroxetine is neither safe nor effective.' The opposite of the original conclusion. Same data, honest analysis.", type: "revealed" }
          ],
          realData: {
            originalClaim: "효과적이고 잘 견디는",
            realityAfterReanalysis: "Neither safe nor effective",
            suicidalEvents: "8 in paroxetine vs 1 in placebo",
            settlement: "$3 billion (GSK total fraud settlement)",
            childrenExposed: "Millions prescribed worldwide before warning"
          }
        }
      },
      {
        type: 'death-toll',
        content: {
          number: "26,000–55,000",
          label: "Estimated excess deaths from Vioxx alone",
          source: "FDA scientist David Graham's congressional testimony, 2004"
        }
      },
      {
        type: 'oath',
        content: {
          header: "그들이 묻어둔 증거에 따르면",
          text: "By the trials that were hidden, and the patients who were harmed —<br><strong>the cost of suppression is measured in lives.</strong><br><br>Every buried study is a betrayal. Every spin is a deception.<br>The detective does not look away. The detective counts the cost."
        }
      },
      {
        type: 'contrast',
        content: {
          title: "부정적인 상황에 직면한 두 가지 경로 데이터",
          darkSide: {
            header: "은폐의 길",
            items: [
              "부정적 시도 숨기기",
              "언어를 돌리다('자살'이 아닌 '감정적 불안')",
              "Ghostwrite favorable papers",
              "Promote off-label use despite evidence",
              "Pay the fine as cost of doing business"
            ],
            consequence: "Result: Reboxetine prescribed as effective (it wasn't). Vioxx killed tens of thousands. Study 329 endangered children."
          },
          lightSide: {
            header: "의 길 투명성",
            items: [
              "Publish all trials regardless of outcome",
              "Report adverse events accurately",
              "독립적인 데이터 액세스 허용",
              "시장이 아닌 증거를 따르십시오",
              "Accept reduced profits for patient safety"
            ],
            consequence: "Result: Doctors can make informed decisions. Patients receive treatments that actually work. Trust in medicine is preserved."
          }
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "검토자의 딜레마",
          situation: "You're conducting a meta-analysis of a pain medication. You find 12 published trials — all positive, effect size d=0.45. A colleague mentions rumors of unpublished negative trials. The manufacturer won't share data. What do you do?",
          nodes: [
            {
              id: 'start',
              question: "12개의 긍정적인 시험이 게시되었습니다. 메타 분석을 진행하시겠습니까?",
              branches: [
                { id: 'a', text: "예 — 사용 가능한 데이터를 게시하고 제한 사항을 참고하세요", nextNode: 'publish' },
                { id: 'b', text: "계속하기 전에 게시되지 않은 데이터를 검색하세요", nextNode: 'hunt' },
                { id: 'c', text: "Apply statistical tests for publication bias", nextNode: 'test' }
              ]
            },
            {
              id: 'publish',
              type: 'outcome',
              consequence: 'bad',
              title: "Reboxetine 재생",
              text: "Your meta-analysis shows strong efficacy (d=0.45). Guidelines cite it. Prescriptions increase. Two years later, regulatory investigation reveals 8 unpublished negative trials. True effect: d=0.15, non-significant. Your published meta-analysis contributed to patients receiving ineffective treatment.",
              realCase: "이것이 바로 reboxetine에서 발생한 일입니다. IQWiG가 미공개 데이터를 획득하고 효과가 사라질 때까지 여러 게시된 메타 분석에서 이점이 나타났습니다."
            },
            {
              id: 'hunt',
              question: "ClinicalTrials.gov를 검색하여 게시된 결과가 없는 완료된 시험 6개를 찾았습니다. 시험 참가자에게 연락하고 FOIA 요청을 제출합니다. 무슨 일이 발생합니까?",
              branches: [
                { id: 'd', text: "시험 데이터 세트 6개 중 4개를 얻었습니다. 3개는 음성입니다.", nextNode: 'found' },
                { id: 'e', text: "요청이 거부되거나 무시되었습니다. 새로운 데이터가 없습니다.", nextNode: 'blocked' }
              ]
            },
            {
              id: 'found',
              type: 'outcome',
              consequence: 'good',
              title: "진실이 드러납니다",
              text: "Including the unpublished data: effect drops to d=0.22, barely significant. Your meta-analysis reports BOTH estimates, notes the discrepancy, and warns about likely publication bias. Clinicians can make informed decisions. Your work prevents another reboxetine.",
              realCase: "이것이 Turner가 항우울제를 사용하여 한 일이고 Eyding이 사용한 일입니다. reboxetine — 실제 상황을 밝히기 위해 규제 데이터를 수집합니다."
            },
            {
              id: 'blocked',
              question: "미공개 데이터는 얻을 수 없습니다. 유입경로 플롯이 의심스러워 보입니다. 무엇을 보고합니까?",
              branches: [
                { id: 'f', text: "강력한 경고와 편견 평가를 통해 효과를 보고합니다.", nextNode: 'cautious' },
                { id: 'g', text: "Use trim-and-fill to estimate adjusted effect", nextNode: 'adjust' }
              ]
            },
            {
              id: 'cautious',
              type: 'outcome',
              consequence: 'neutral',
              title: "정직한 무명",
              text: "You report: 'Published trials suggest d=0.45, but funnel plot asymmetry and registry search indicate likely missing negative trials. We located 6 unpublished trials that could not be obtained. True effect is likely smaller.' GRADE assessment: downgrade for publication bias. You've flagged the problem even without solving it.",
              realCase: "GRADE는 의심되는 출판 편견에 대해 명시적으로 다운그레이드를 허용합니다. 불확실성에 대한 투명성은 잘못된 정밀도보다 더 중요합니다."
            },
            {
              id: 'adjust',
              type: 'outcome',
              consequence: 'neutral',
              title: "통계적 수정",
              text: "Trim-and-fill imputes 5 missing studies. Adjusted effect: d=0.28. You report both estimates with explanation. Caveat: Trim-and-fill assumes publication bias is the ONLY cause of asymmetry, and doesn't recover the actual missing data. It's an approximation, not a solution.",
              realCase: "자르기 및 채우기는 널리 사용되지만 제한 사항이 있습니다. 지나치게 교정되거나 과소 교정될 수 있습니다. 선택 모델은 더 정확할 수 있지만 선택 메커니즘에 대한 가정이 필요합니다."
            },
            {
              id: 'test',
              question: "Egger's test: p=0.03 (significant asymmetry). Begg's test: p=0.08 (borderline). Funnel plot shows gap in bottom-left. What do you conclude?",
              branches: [
                { id: 'h', text: "Publication bias is confirmed — adjust the estimate", nextNode: 'confirmed' },
                { id: 'i', text: "테스트는 암시적이지만 확정적이지는 않습니다. 추가 조사", nextNode: 'investigate' }
              ]
            },
            {
              id: 'confirmed',
              type: 'outcome',
              consequence: 'bad',
              title: "과신한 결론",
              text: "You state 'publication bias confirmed' and apply trim-and-fill. But Egger's test has high false positive rate with few studies and high heterogeneity. The asymmetry might be due to genuine effect modification (smaller trials in sicker patients). You've made a statistical inference that requires clinical verification.",
              realCase: "Funnel plot asymmetry has many causes beyond publication bias: heterogeneity, methodological differences in small studies, true biology. Tests can't distinguish these."
            },
            {
              id: 'investigate',
              type: 'outcome',
              consequence: 'good',
              title: "종합 평가",
              text: "You use contour-enhanced funnel plots: missing studies are in non-significant regions (suggests publication bias, not heterogeneity). You check if smaller studies differ methodologically (they don't). You search registries (find unpublished trials). You report: 'Multiple lines of evidence suggest publication bias' with GRADE downgrade. Full transparency, appropriate uncertainty.",
              realCase: "Modern guidance recommends multiple approaches: visual assessment, statistical tests, registry searches, and clinical judgment. No single method is sufficient."
            }
          ]
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 1E",
          title: "Avandia: The 83,000 Heart Attacks",
          source: "Nissen & Wolski, NEJM 2007 + Senate Finance Committee Investigation",
          timeline: [
            { year: "1999", text: "Rosiglitazone (Avandia) approved for diabetes. GlaxoSmithKline's blockbuster drug.", type: "normal" },
            { year: "숨겨진 신호", text: "2000년까지 GSK 내부 메타 분석에서는 심장 질환 위험이 30% 증가한 것으로 나타났습니다. 그들은 더 많은 분석을 의뢰했는데 모두 동일한 신호를 보여주었습니다. 게시된 내용은 없습니다.", type: "buried" },
            { year: "2007", text: "Cardiologist Steven Nissen obtains 42 trial datasets through legal discovery. His meta-analysis: 43% increased MI risk (OR 1.43, p=0.03). Published in NEJM.", type: "revealed" },
            { year: "The Toll", text: "FDA estimates: 83,000 excess heart attacks from 1999-2007. GSK had known since 2000. Seven years of silence. Seven years of prescriptions.", type: "revealed" },
            { year: "The Reckoning", text: "GSK는 합의금 30억 달러를 지불합니다(2012). Avandia 제한. 그러나 피해는 이미 발생했고 출판된 문헌에서는 이를 숨겼습니다.", type: "revealed" }
          ],
          realData: {
            approvalYear: "1999",
            internalSignalYear: "2000",
            publicRevelationYear: "2007",
            yearsOfSuppression: "7 years",
            estimatedExcessMIs: "83,000",
            settlement: "$3 billion"
          }
        }
      },
      {
        type: 'rhetoric',
        content: {
          question: "한 회사가 지난 7년 동안 자사의 약물이 심장마비를 일으킨다는 사실을 알고도 아무 말도 하지 않았다는 사실을 생각해 보지 않으셨나요? 증거가 기업 파일에 저장되어 있는 동안 83,000명의 심장이 손상되었다고요?"
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 1F",
          title: "감소 사기: 데이터가 발명되었을 때",
          source: "Erasmus MC Investigation 2012 + Bouri et al. BMJ 2014 Reanalysis",
          timeline: [
            { year: "Background", text: "Don Poldermans는 수술 전 베타 차단제 분야의 세계 최고의 전문가였습니다. 그의 DECREASE 실험에서는 극적인 사망률 감소가 나타났습니다. 그의 연구에 따라 전 세계적으로 지침이 변경되었습니다.", type: "normal" },
            { year: "The Suspicion", text: "다른 연구자들은 그의 결과를 복제할 수 없었습니다. 그의 효과 크기는 엄청나게 컸습니다. 데이터 패턴이 너무 깨끗한 것 같습니다.", type: "normal" },
            { year: "2012", text: "Erasmus Medical Center 조사: Poldermans는 여러 연구에서 데이터를 조작했습니다. 그는 환자를 발명했습니다. 그는 결과를 조작했습니다.", type: "buried" },
            { year: "The Reanalysis", text: "Bouri et al. reanalyzed all beta-blocker trials EXCLUDING Poldermans' data. Without his studies: NO mortality benefit, possible HARM. Guidelines had been based on fraud.", type: "revealed" },
            { year: "The Cost", text: "European guidelines caused an estimated 10,000 excess deaths per year by recommending routine beta-blockers. Based on fabricated evidence.", type: "revealed" }
          ],
          realData: {
            fraudulentTrials: "DECREASE I, II, IV",
            originalClaim: "34% mortality reduction",
            truthWithoutFraud: "No benefit, possible harm",
            estimatedAnnualDeaths: "~10,000 excess deaths/year in Europe",
            guidelineImpact: "ESC guidelines changed worldwide practice"
          }
        }
      },
      {
        type: 'death-toll',
        content: {
          number: "10,000/year",
          label: "Estimated excess deaths in Europe from guidelines based on DECREASE fraud",
          source: "Bouri et al., Heart 2014"
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "내부고발자의 갈림길",
          situation: "You're a junior researcher at a pharmaceutical company. You've discovered that your company has 5 unpublished trials showing the drug increases cardiovascular events. The drug is already approved and generating $2 billion/year. Your supervisor tells you to focus on other projects and 'let the medical affairs team handle regulatory issues.' What do you do?",
          nodes: [
            {
              id: 'start',
              question: "숨겨진 피해의 증거를 발견했습니다. 당신의 경력이 위태로워졌습니다. 무엇을 하시나요?",
              branches: [
                { id: 'a', text: "Stay silent — it's above your pay grade", nextNode: 'silent' },
                { id: 'b', text: "Report internally through compliance channels", nextNode: 'internal' },
                { id: 'c', text: "Become a whistleblower — contact FDA or journalists", nextNode: 'whistleblow' }
              ]
            },
            {
              id: 'silent',
              type: 'outcome',
              consequence: 'bad',
              title: "침묵의 무게",
              text: "침묵을 유지하세요. 약은 계속 판매됩니다. 심장 마비가 계속 발생합니다. 몇 년 후, 소송을 통해 진실이 ​​드러납니다. 수천 명이 피해를 입었다는 내용을 읽었습니다. 당신은 알고 있었습니다. 당신은 아무 말도 하지 않았습니다. 당신이 번 돈은 피의 돈이었습니다. 귀하가 보호한 경력은 공모를 기반으로 구축되었습니다.",
              realCase: "많은 제약 직원들이 Vioxx, Avandia 및 기타 스캔들에 대해 알고 있었습니다. 대부분은 침묵을 지켰다. 일부는 나중에 죄책감이 결코 떠나지 않았다고 증언했습니다."
            },
            {
              id: 'internal',
              question: "내부 규정 준수 보고서를 제출합니다. 몇 주가 지났습니다. 준법감시인은 감사 인사를 전하며 '현재 처리 중입니다'라고 말했습니다. 다음에는 무엇을 하시겠습니까?",
              branches: [
                { id: 'd', text: "Trust the process — compliance will handle it", nextNode: 'trust' },
                { id: 'e', text: "후속 조치 및 조치 증거 요구", nextNode: 'followup' },
                { id: 'f', text: "Document everything and prepare external escalation", nextNode: 'document' }
              ]
            },
            {
              id: 'trust',
              type: 'outcome',
              consequence: 'bad',
              title: "잘못된 보증",
              text: "아무것도 변하지 않습니다. 몇 달 후, 당신은 조용히 다른 부서로 이동하게 되었습니다. 약은 계속됩니다. '규정 준수 처리'는 환자를 보호하는 방법이 아니라 향후 소송을 방어하는 방법에 대한 법적 검토를 의미한다는 것을 알게 됩니다. 귀하의 보고서는 제출되었으며 임상시험과 함께 묻혀졌습니다.",
              realCase: "내부 규정 준수는 환자가 아닌 회사를 보호하는 경우가 많습니다. GSK의 Cheryl Eckard는 연방 내부 고발자가 되기 전 수년간 내부적으로 제조 문제를 보고했습니다."
            },
            {
              id: 'followup',
              type: 'outcome',
              consequence: 'neutral',
              title: "문서 추적",
              text: "회의 메모, 조치 항목, 규제 서류 제출을 요구합니다. '특권 정보'라고 합니다. 귀하의 끈기는 긍정적이지 않지만 주목됩니다. 당신은 '팀 플레이어가 아닙니다.'라는 라벨이 붙어 있습니다. 하지만 당신은 기록을 만들었습니다. 스캔들이 결국 밝혀지면 문서화된 우려 사항이 증거가 됩니다.",
              realCase: "Documentation protects whistleblowers legally. Peter Rost at Pfizer kept meticulous records that later proved invaluable in legal proceedings."
            },
            {
              id: 'document',
              type: 'outcome',
              consequence: 'good',
              title: "준비된 경로",
              text: "You keep copies of everything. You consult a whistleblower attorney. You understand the False Claims Act and qui tam provisions. When internal channels fail, you're ready. Your documentation becomes the foundation for a federal case. You face retaliation — but you're protected by law, and you sleep at night.",
              realCase: "Successful whistleblowers like Cheryl Eckard and John Kopchinski prepared extensively before going external. Eckard received $96 million; Kopchinski received $51 million."
            },
            {
              id: 'whistleblow',
              question: "You decide to go external. But how?",
              branches: [
                { id: 'g', text: "Contact a journalist at a major newspaper", nextNode: 'journalist' },
                { id: 'h', text: "문서와 함께 비공개 소송 제기", nextNode: 'quitam' },
                { id: 'i', text: "Report directly to FDA's MedWatch", nextNode: 'fda' }
              ]
            },
            {
              id: 'journalist',
              type: 'outcome',
              consequence: 'neutral',
              title: "공개 폭로",
              text: "기자가 조사합니다. 이야기가 깨집니다. 하지만 법적 보호가 없으면 즉시 해고됩니다. 회사는 귀하가 기밀을 위반했다고 주장합니다. 값비싼 소송에 직면하게 됩니다. 진실은 밝혀졌지만 귀하의 경력과 재정은 파괴되었습니다. 저널리즘은 폭로하지만 폭로자를 보호하지는 않습니다.",
              realCase: "Many whistleblowers who went to media first faced devastating retaliation. Legal protection requires following specific procedures."
            },
            {
              id: 'quitam',
              type: 'outcome',
              consequence: 'good',
              title: "보호되는 경로",
              text: "A qui tam lawyer files under seal. The government investigates with your evidence. Years later, the case resolves: the company pays billions, patients are warned, and you receive 15-25% of the recovery. The process was long and stressful, but you're protected by law and rewarded for integrity.",
              realCase: "1986년 이후 허위청구법으로 회수된 금액은 700억 달러가 넘습니다. 의약품 사건이 큰 비중을 차지합니다. 내부고발자는 복구에 참여합니다."
            },
            {
              id: 'fda',
              type: 'outcome',
              consequence: 'neutral',
              title: "규제 경로",
              text: "FDA는 귀하의 신고를 진지하게 받아들입니다. 회사에 서류를 요구합니다. 회사 변호사가 일어섰습니다. 그 과정은 수년이 걸립니다. 결국에는 레이블에 경고가 추가됩니다. 하지만 재정적 보호나 법적 보호가 없습니다. 귀하는 옳은 일을 했으나 시스템은 귀하를 보호하지 않았습니다.",
              realCase: "FDA는 자발적인 보고에 의존하며 집행 권한이 제한되어 있습니다. FDA 과학자인 David Graham은 Vioxx 분석으로 인해 내부 보복에 직면했습니다."
            }
          ]
        }
      },
      {
        type: 'legal-disclaimer',
        content: {
          text: "This educational content about whistleblowing is provided for informational purposes only and does NOT constitute legal advice. Whistleblower protections vary SIGNIFICANTLY by country, jurisdiction, employer type (government vs. private), and type of misconduct. The consequences of disclosure can be severe, including termination, blacklisting, and personal liability. INTERNATIONAL NOTE: The resources below are primarily US-focused. Many countries have different (often weaker) protections. EU Directive 2019/1937 provides baseline protections in Europe, but implementation varies. BEFORE taking any action on suspected misconduct, consult with a qualified attorney who specializes in whistleblower protection law in YOUR jurisdiction.",
          resources: [
            { name: "Government Accountability Project (US)", url: "https://whistleblower.org/" },
            { name: "National Whistleblower Center (US)", url: "https://www.whistleblowers.org/" },
            { name: "OSHA Whistleblower Protection Program (US)", url: "https://www.osha.gov/whistleblower" },
            { name: "Whistleblower Network News (International)", url: "https://whistleblowersblog.org/" },
            { name: "EU Whistleblower Directive Info", url: "https://ec.europa.eu/info/aid-development-cooperation-fundamental-rights/your-rights-eu/whistleblower-protection_en" }
          ]
        }
      },
      {
        type: 'contrast',
        content: {
          title: "Two Scientists Discover Hidden Harm",
          darkSide: {
            header: "침묵의 증인",
            items: [
              "미발표 임상시험 보기",
              "Raises concern once, is dismissed",
              "Accepts 'it's being handled'",
              "Focuses on other projects",
              "몇 년 후, 사망에 대해 읽음",
              "그들이 하지 않은 일"
            ],
            consequence: "Result: Career preserved. Conscience damaged. When the scandal breaks, they weren't part of the cover-up — but they weren't part of the solution either."
          },
          lightSide: {
            header: "지속적인 목소리",
            items: [
              "Sees the same unpublished trials",
              "Documents everything meticulously",
              "Escalates through proper channels",
              "When channels fail, consults attorney",
              "Files protected disclosure",
              "Faces retaliation but persists"
            ],
            consequence: "Result: Career disrupted but rebuilt. Patients protected. Years later, receives recognition and compensation. Sleeps soundly knowing they acted when it mattered."
          }
        }
      },
      {
        type: 'clinical-guide',
        content: {
          title: "Red Flags for Publication Bias",
          items: [
            "발표된 모든 시험은 긍정적입니다(특히 주관적 결과의 경우)",
            "Effect sizes are implausibly large compared to mechanism",
            "Industry-sponsored trials have larger effects than independent trials",
            "Conference abstracts never became full publications",
            "Registered trials on ClinicalTrials.gov have no published results",
            "결과는 회의에서 발표된 후 '사라졌습니다'",
            "Internal documents (litigation, FOIA) reveal suppressed trials",
            "Funnel plot shows asymmetric gap in bottom-left quadrant"
          ]
        }
      },
      {
        type: 'cycle-return',
        content: {
          principle: "숨겨진 것은 보이는 것만큼 강력하게 믿음을 형성합니다. 형사의 첫 번째 임무는 뭔가가 숨겨져 있는지 알아내는 것입니다."
        }
      },
      {
        type: 'quiz',
        content: {
          question: "레복세틴 사례에서 환자 데이터 중 몇 퍼센트가 전혀 공개되지 않았나요?",
          options: [
            { id: 'a', text: "26%", correct: false },
            { id: 'b', text: "51%", correct: false },
            { id: 'c', text: "74%", correct: true },
            { id: 'd', text: "94%", correct: false }
          ],
          explanation: "레복세틴 임상시험에서 나온 환자 데이터의 74%가 전혀 공개되지 않았습니다. 단 26%만이 출판된 문헌에 포함되었습니다. IQWiG가 모든 데이터를 확보했을 때, 약물의 겉보기 효능은 사라졌습니다. 이 사례는 출판되지 않은 데이터가 출판된 데이터의 양보다 더 중요한 이유를 보여줍니다."
        }
      },
      {
        type: 'protagonist-story',
        content: {
          name: "Dr. Erick Turner",
          role: "FDA Reviewer turned Whistleblower Researcher",
          narrative: "As an FDA medical reviewer, Erick Turner saw something troubling: antidepressant trials submitted to the FDA often had different results than what appeared in published journals. After leaving the FDA, he conducted the landmark 2008 study comparing FDA records to published literature for 74 antidepressant trials. What he found shocked medicine: while published literature suggested 94% of trials were positive, FDA records showed only 51% were truly positive.",
          quote: "문헌은 모든 어린이가 평균 이상인 Wobegon 호수에서 나온 것처럼 보였습니다.",
          impact: "NEJM에 출판된 그의 연구는 출판 편견에 대한 우리의 이해 방식을 근본적으로 바꾸었습니다. 이는 출판된 의학 문헌이 체계적으로 치료 효능을 과장한다는 가장 명확한 증거를 제공했습니다."
        }
      },
      {
        type: 'key-takeaways',
        content: {
          takeaways: [
            "Reboxetine case: 74% of patient data hidden, drug approval revoked when full data emerged",
            "Vioxx case: 88,000-140,000 excess heart attacks, company knew early",
            "Paroxetine Study 329: Suicide risk hidden, ghostwritten, led to $3 billion settlement",
            "Financial incentives powerfully drive selective publication",
            "Regulatory submissions often tell a different story than published papers"
          ],
          actionItem: "정기적으로 처방하는 약물에 대해 FDA 리뷰 또는 규제 문서를 검색하여 규제 당국이 본 것과 출판된 것을 비교하십시오."
        }
      }
    ]
  },

  // MODULE 2: THE FUNNEL OF TRUTH
  {
    id: 2,
    title: "진실의 깔때기",
    subtitle: "Visual Detection",
    estimatedMinutes: 20,
    slides: [
      {
        type: 'learning-objectives',
        content: {
          intro: "By the end of this module, you will be able to:",
          objectives: [
            "Explain the statistical principles behind funnel plot asymmetry",
            "Interpret funnel plots and identify patterns suggesting publication bias",
            "Distinguish between small-study effects and true publication bias",
            "대화형 깔때기 도표 도구를 사용하여 자신의 평가 메타 분석",
            "Recognize limitations and confounders of funnel plot interpretation"
          ]
        }
      },
      {
        type: 'principle',
        content: {
          number: "II",
          text: "퍼널은 숲이 숨기고 있는 것, 즉 출판된 것의 형태와 그렇지 않은 것의 그림자를 드러냅니다."
        }
      },
      {
        type: 'rhetoric',
        content: {
          question: "대칭 퍼널 플롯이 '출판은 모든 결과에 공평했습니다'라고 선언하는 반면 비대칭 퍼널 플롯은 '누군가가 당신이 원하는 것을 선택했습니다'라고 속삭이는 것을 본 적이 있습니까? 참조'?"
        }
      },
      {
        type: 'content',
        content: {
          title: "깔때기의 논리",
          sections: [
            {
              heading: "Why a Funnel Shape?",
              items: [
                "Large studies (top): precise estimates, cluster tightly around true effect",
                "Small studies (bottom): imprecise, scatter widely around true effect",
                "결과에 관계없이 모든 연구가 게시되는 경우: 대칭 분산",
                "중요한 결과만 게시되는 경우: 비대칭 분산"
              ]
            },
            {
              heading: "Reading the X-Axis (Effect Size)",
              items: [
                "Horizontal position shows each study's effect estimate",
                "Pooled estimate typically shown as vertical line",
                "중심으로부터의 거리는 중심으로부터의 편차를 나타냅니다. 평균"
              ]
            },
            {
              heading: "Y축 읽기(정밀도)",
              items: [
                "Standard error (inverted: 0 at top, larger SE at bottom)",
                "OR sample size (larger at top)",
                "OR precision (1/SE, larger at top)",
                "Top = more precise = more confident estimates"
              ]
            }
          ]
        }
      },
      {
        type: 'tool-funnel',
        content: {
          id: 'funnel-basic',
          title: "Interactive Funnel Plot",
          description: "게시 편향이 퍼널 모양을 어떻게 왜곡하는지 살펴보세요. 효과를 확인하려면 편향 켜짐/꺼짐을 전환하세요."
        }
      },
      {
        type: 'content',
        content: {
          title: "비대칭: 편향의 지문",
          sections: [
            {
              heading: "누락된 모서리",
              items: [
                "Bottom-left gap: Small, non-significant, negative studies missing",
                "이것은 전형적인 출판 편향 패턴입니다",
                "결과가 null인 소규모 연구 → 보관되지 않음 출판",
                "Large studies published regardless (too big to bury)"
              ]
            },
            {
              heading: "But Asymmetry Has Other Causes",
              items: [
                "TRUE HETEROGENEITY: Small studies in sicker patients → larger effects (real)",
                "METHODOLOGICAL DIFFERENCES: Small studies less rigorous → inflated effects",
                "CHANCE: With few studies, asymmetry can occur randomly",
                "ARTEFACT: Some effect measures (OR) create asymmetry naturally"
              ]
            }
          ]
        }
      },
      {
        type: 'tool-contour',
        content: {
          id: 'contour-funnel',
          title: "Contour-Enhanced Funnel Plot",
          description: "Contours show significance boundaries. If missing studies fall in non-significant regions, publication bias is likely. If they fall in significant regions, other explanations apply."
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 2A",
          title: "The HRT Reversal: When Observation Deceived",
          source: "WHI Trial, JAMA 2002 + Decades of Observational Studies",
          timeline: [
            { year: "1980s-90s", text: "관찰 연구에 따르면 HRT를 받는 여성은 심장 질환 위험이 40-50% 더 낮습니다. 메타 분석을 통해 이를 확인했습니다. 심장 보호를 위한 가이드라인에서는 HRT를 권장합니다.", type: "normal" },
            { year: "The Logic", text: "왜 효과가 없을까요? 에스트로겐은 지질 프로필을 개선합니다. 생물학이 의미가있었습니다. 일관된 관찰 데이터가 이를 '증명'했습니다.", type: "normal" },
            { year: "2002", text: "WHI(Women's Health Initiative) — 최초의 대규모 무작위 시험 — 조기 중단되었습니다. HRT는 심혈관 사건을 29% 증가시켰습니다. 모두가 믿었던 것과 정반대입니다.", type: "revealed" },
            { year: "The Explanation", text: "Healthy user bias: Women who took HRT were healthier, more educated, more health-conscious. The 'protection' was confounding, not causation. And unpublished negative observational studies? Nobody looked for them.", type: "revealed" }
          ],
          realData: {
            observationalEstimate: "40-50% risk reduction",
            rctResult: "29% risk INCREASE",
            discrepancy: "Complete reversal",
            yearsOfWrongPractice: "20+ years",
            cause: "Healthy user bias + possible publication bias in observational studies"
          }
        }
      },
      {
        type: 'rhetoric',
        content: {
          question: "의학계가 20년 동안 어떻게 '강력한 증거'를 가지고 호르몬 요법이 심장을 보호한다고 믿었는지 보지 못하셨나요? 그리고 단일 무작위 시험을 통해 관찰이 모두를 속였다는 사실이 어떻게 밝혀졌습니까?"
        }
      },
      {
        type: 'oath',
        content: {
          header: "깔때기의 증언",
          text: "The funnel plot does not lie — <strong>but it can be misread.</strong><br><br>Asymmetry is a witness, not a verdict.<br>It testifies that something is unusual.<br>It does not testify WHY.<br><br>The detective who sees asymmetry and cries 'bias!'<br>is no better than the one who sees symmetry and cries 'truth!'<br><br><strong>Both must investigate. Both must verify. Both must doubt.</strong>"
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "저널 편집자의 딜레마",
          situation: "You're the editor of a major medical journal. A researcher submits a well-conducted trial showing NO effect of a popular supplement on cognitive function (null result, p=0.67). Three positive trials have been published elsewhere. The methods are rigorous. The sample size is adequate. Your reviewers are split — some say 'not novel enough,' others say 'important null finding.' What do you do?",
          nodes: [
            {
              id: 'start',
              question: "엄격한 널 재판이 당신의 책상에 도착합니다. 어떻게 결정하시겠습니까?",
              branches: [
                { id: 'a', text: "거부 — null 결과는 우리 저널에 충분히 흥미롭지 않습니다", nextNode: 'reject' },
                { id: 'b', text: "Accept — null findings are scientifically important", nextNode: 'accept' },
                { id: 'c', text: "Request additional analyses to find 'something interesting'", nextNode: 'fish' }
              ]
            },
            {
              id: 'reject',
              type: 'outcome',
              consequence: 'bad',
              title: "편향을 만드는 결정",
              text: "You reject the null study. The researcher, demoralized, files it away. The published literature now contains 3 positive trials and 0 negative trials. Future meta-analysts will see only the positives. Your decision — multiplied across thousands of editors — IS publication bias. You didn't suppress evidence maliciously. You just found it boring.",
              realCase: "연구에 따르면 null 결과가 게시될 가능성이 50% 낮습니다. 대부분의 저널 편집자들은 그 이유로 '참신성 부족'을 꼽습니다. 누적 효과는 증거 기반을 왜곡합니다."
            },
            {
              id: 'accept',
              type: 'outcome',
              consequence: 'good',
              title: "반문화적 선택",
              text: "You accept the null study with an editorial on the importance of publishing negative results. Meta-analysts now have a more complete picture: 3 positive trials and 1 negative. The effect estimate shrinks. Clinicians make better-informed decisions. You've contributed to truth — even though it won't boost your impact factor.",
              realCase: "PLOS ONE 및 기타 저널은 이제 명시적으로 null 결과를 환영합니다. 일부 전문 저널은 부정적인 결과에 초점을 맞춥니다. 문화는 천천히 변화하고 있습니다."
            },
            {
              id: 'fish',
              type: 'outcome',
              consequence: 'bad',
              title: "p-해킹 초대",
              text: "You ask: 'Did you check subgroups? Any secondary outcomes significant?' The researcher re-analyzes. In men over 65 with baseline cognitive impairment, there's a hint of effect (p=0.04). The paper is revised to emphasize this 'finding.' You've published — but you've also taught the researcher that fishing for significance is how to get published.",
              realCase: "편집자들이 '흥미로운' 재분석을 요청하는 이 역학은 p-해킹과 선택적 보고의 주요 원동력입니다. 실제 결과처럼 보이는 오탐지를 생성합니다."
            }
          ]
        }
      },
      {
        type: 'contrast',
        content: {
          title: "Two Funnels, Two Truths",
          darkSide: {
            header: "대칭으로 나타나는 깔때기",
            items: [
              "15 studies form a beautiful symmetric cone",
              "Egger's test: p=0.45 (not significant)",
              "결론: '출판 편향의 증거 없음'",
              "BUT: Registry search not performed",
              "하지만: 모든 연구는 업계 자금 지원",
              "BUT: 8 registered trials have no published results"
            ],
            consequence: "발표되지 않은 연구는 결코 음모를 꾸미지 않았습니다. 그래프의 부재 ≠ 현실의 부재."
          },
          lightSide: {
            header: "비대칭으로 나타난 깔때기",
            items: [
              "12개의 연구에서 명확한 비대칭성이 나타났습니다",
              "Egger's test: p=0.02 (significant)",
              "Initial conclusion: 'Publication bias!'",
              "그러나 소규모 연구에서는 더 아픈 환자를 대상으로 했습니다",
              "BUT: Larger effects in severe disease is expected",
              "BUT: Stratified analysis shows no bias within severity groups"
            ],
            consequence: "진짜 때문에 깔때기가 편향된 것처럼 보였습니다. 이질성. 비대칭성은 억압이 아니라 생물학이었습니다. 조사 결과 진실이 밝혀졌습니다."
          }
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "Interpreting Funnel Asymmetry",
          situation: "깔때기형 도표는 명확한 비대칭성을 보여줍니다. 왼쪽 하단에 연구가 누락되어 있습니다. 메타 분석에는 15개의 연구가 있습니다. 이를 어떻게 해석하십니까?",
          nodes: [
            {
              id: 'start',
              question: "작은 부정적인 연구가 누락되어 깔때기 도표 비대칭이 보입니다. 당신의 해석은 무엇입니까?",
              branches: [
                { id: 'a', text: "Publication bias is confirmed — small negative studies weren't published", nextNode: 'bias_confirmed' },
                { id: 'b', text: "Check where missing studies fall relative to significance contours", nextNode: 'contours' },
                { id: 'c', text: "소규모 연구가 대규모 연구와 체계적으로 다른지 조사하십시오.", nextNode: 'heterogeneity' }
              ]
            },
            {
              id: 'bias_confirmed',
              type: 'outcome',
              consequence: 'bad',
              title: "성급한 결론",
              text: "You conclude publication bias without considering alternatives. But asymmetry can have multiple causes. If small studies enrolled sicker patients (common in proof-of-concept trials), larger effects are EXPECTED. Your 'bias' may be biology. Always consider: Is there a clinical reason small studies might differ?",
              realCase: "Sterne et al. (BMJ 2011)에서는 원인이 다양하기 때문에 '소규모 연구 효과'가 '출판 편향'보다 더 나은 용어라고 문서화했습니다."
            },
            {
              id: 'contours',
              question: "You add contour enhancement. Missing studies fall clearly in the p>0.05 region (non-significant). What does this suggest?",
              branches: [
                { id: 'd', text: "Publication bias is the most likely explanation", nextNode: 'bias_likely' },
                { id: 'e', text: "Could still be heterogeneity — need more investigation", nextNode: 'more_check' }
              ]
            },
            {
              id: 'bias_likely',
              type: 'outcome',
              consequence: 'good',
              title: "정보 기반 평가",
              text: "Contour-enhanced plots show the 'missing' studies would have been non-significant. This pattern specifically suggests publication bias — studies weren't published BECAUSE they weren't significant. This doesn't prove bias exists, but it's the most parsimonious explanation. Report this finding with appropriate caveats.",
              realCase: "Peters et al. (JAMA 2008) introduced contour-enhanced funnel plots specifically to distinguish publication bias from heterogeneity."
            },
            {
              id: 'more_check',
              type: 'outcome',
              consequence: 'good',
              title: "철저한 조사",
              text: "You're right to be cautious. You also: (1) Check if small studies used different interventions/populations, (2) Run Egger's test (p=0.02), (3) Search registries for unpublished trials (find 3), (4) Compare industry vs. independent funding. Multiple lines of evidence strengthen your conclusion.",
              realCase: "코크란 지침에서는 단일 방법에만 의존하지 말 것을 권장합니다. 시각적, 통계적, 경험적(레지스트리 검색) 접근 방식을 결합해야 합니다."
            },
            {
              id: 'heterogeneity',
              question: "You examine study characteristics. Small studies enrolled patients from specialty clinics; large studies enrolled from primary care. Severity differs. What now?",
              branches: [
                { id: 'f', text: "이는 비대칭성을 설명합니다. 이는 편향이 아니라 이질성입니다.", nextNode: 'heterogeneity_explains' },
                { id: 'g', text: "두 가지 모두 사실일 수 있습니다. 하위 그룹 분석 및 편향 평가가 필요합니다", nextNode: 'both_true' }
              ]
            },
            {
              id: 'heterogeneity_explains',
              type: 'outcome',
              consequence: 'neutral',
              title: "임상 설명",
              text: "Specialty clinics enroll sicker patients who may respond more to treatment (higher baseline = more room to improve). The 'asymmetry' reflects genuine effect modification, not suppression. You should do subgroup analysis by setting and report effects separately. The funnel wasn't lying — you were asking it the wrong question.",
              realCase: "집중 치료 중재 시험에서 소규모 단일 센터 연구는 종종 다기관 시험보다 더 큰 효과를 보여줍니다. 이는 편향이 아니라 사례 혼합 차이입니다."
            },
            {
              id: 'both_true',
              type: 'outcome',
              consequence: 'good',
              title: "미묘한 진실",
              text: "Heterogeneity AND publication bias can coexist. You stratify by setting and STILL see asymmetry within strata. You report: 'Effect modification by setting accounts for SOME asymmetry; residual asymmetry suggests possible publication bias.' You've separated the explainable from the suspicious.",
              realCase: "이 계층적 분석이 최적의 표준입니다. 먼저 임상적으로 무엇을 할 수 있는지 설명하고 편향에 대한 잔여 비대칭성을 평가합니다."
            }
          ]
        }
      },
      {
        type: 'clinical-guide',
        content: {
          title: "Funnel Plot Interpretation Checklist",
          items: [
            "LOOK: Is there asymmetry? Which direction? Which corner is 'missing'?",
            "CONTOUR: Do missing studies fall in significant or non-significant regions?",
            "COUNT: Do you have at least 10 studies? (Fewer = unreliable assessment)",
            "CHECK: Do small and large studies differ systematically (population, setting, quality)?",
            "TEST: Run Egger's test — but remember it's suggestive, not definitive",
            "SEARCH: Are there unpublished registered trials?",
            "비교: 업계가 후원하는 연구는 독립적인 연구와 다릅니까?",
            "REPORT: Describe the assessment process, not just the conclusion"
          ]
        }
      },
      {
        type: 'cycle-return',
        content: {
          principle: "깔때기에서는 숲이 무엇을 숨기고 있는지 드러냅니다. 모양을 읽는 방법을 배우십시오. 그러나 비대칭성은 여러 용의자에 속할 수 있는 지문입니다."
        }
      },
      {
        type: 'quiz',
        content: {
          question: "In a contour-enhanced funnel plot, if 'missing' studies would fall in the p>0.05 (non-significant) region, this most strongly suggests:",
          options: [
            { id: 'a', text: "연구 간 이질성", correct: false },
            { id: 'b', text: "Publication bias — non-significant studies weren't published", correct: true },
            { id: 'c', text: "메타 분석에는 연구가 너무 적습니다.", correct: false },
            { id: 'd', text: "효과 측정이 부적절합니다", correct: false }
          ],
          explanation: "When missing studies fall in non-significant regions, it suggests they weren't published BECAUSE they weren't significant — the hallmark of publication bias. If missing studies fell in significant regions, other explanations (heterogeneity, different populations) would be more likely. Contour enhancement helps make this distinction."
        }
      },
      {
        type: 'key-takeaways',
        content: {
          takeaways: [
            "깔때기 도표는 다음과 같아야 합니다. 출판 편향이 없는 경우 대칭(대형 연구는 클러스터링되고 소규모 연구는 분산됨)",
            "Contour-enhanced funnel plots add significance regions to help distinguish bias from heterogeneity",
            "Missing studies in non-significant regions strongly suggest publication bias",
            "Missing studies in significant regions suggest other explanations (heterogeneity, true effect variation)",
            "Visual inspection is subjective — always combine with statistical tests"
          ],
          actionItem: "대화형 도구를 사용하여 퍼널 도표 읽기를 연습합니다. 누락된 연구가 어디에 속하는지 격차 패턴 식별을 시작하십시오."
        }
      }
    ]
  },

  // MODULE 3: THE STATISTICAL TESTS
  {
    id: 3,
    title: "The Tests",
    subtitle: "Statistical Detection",
    estimatedMinutes: 30,
    slides: [
      {
        type: 'learning-objectives',
        content: {
          intro: "By the end of this module, you will be able to:",
          objectives: [
            "깔때기 플롯 비대칭성에 대한 Egger의 회귀 테스트를 계산하고 해석합니다",
            "Explain when to use Begg's test vs Egger's test",
            "Recognize the limitations of statistical tests with <10 studies",
            "Interpret discordant test results (Egger's positive, Begg's negative)",
            "Apply appropriate thresholds (p<0.10) and understand why they differ from conventional p<0.05"
          ]
        }
      },
      {
        type: 'principle',
        content: {
          number: "III",
          text: "눈으로 의심하지만 테스트를 통해 정량화됩니다. 그러나 실제로 무슨 일이 일어났는지 확인할 수 있는 테스트는 없으며, 데이터가 시사하는 바만 알 수 있습니다."
        }
      },
      {
        type: 'rhetoric',
        content: {
          question: "Egger의 회귀 분석이 숨겨진 증거에 대한 복잡한 질문을 강력하지만 위험하고 암시적이지만 결론적이지 않은 단일 p-값으로 축소한다는 점을 고려하지 않으셨나요?"
        }
      },
      {
        type: 'content',
        content: {
          title: "Egger's Regression Test",
          sections: [
            {
              heading: "The Logic",
              items: [
                "Regress effect size (standardized by SE) against precision (1/SE)",
                "If NO bias: intercept should be near zero",
                "If bias toward positive results: positive intercept",
                "기울기는 실제 기본 효과를 반영합니다"
              ]
            },
            {
              heading: "The Equation",
              items: [
                "Effect/SE = intercept + slope × (1/SE)",
                "Test whether intercept differs from 0",
                "Significant p-value (typically p<0.10) suggests asymmetry",
                "More liberal threshold (0.10 vs 0.05) because test has low power"
              ]
            },
            {
              heading: "Limitations",
              items: [
                "Low power with <10 studies — may miss real bias",
                "High false positive rate with heterogeneity",
                "Assumes linear relationship between effect and precision",
                "Different variants exist (Egger, Peters, Harbord) for different outcomes"
              ]
            }
          ]
        }
      },
      {
        type: 'tool-egger',
        content: {
          id: 'egger-test',
          title: "Egger's Test Calculator",
          description: "깔때기 도표에 대한 Egger의 회귀 테스트를 계산하려면 연구 데이터를 입력하세요. 비대칭."
        }
      },
      {
        type: 'content',
        content: {
          title: "Begg's Rank Correlation",
          sections: [
            {
              heading: "The Method",
              items: [
                "Correlate effect size ranks with variance ranks",
                "Uses Kendall's tau correlation",
                "If NO bias: no correlation (tau near 0)",
                "If bias: positive correlation (large effects with large variance)"
              ]
            },
            {
              heading: "Egger의 테스트와 비교",
              items: [
                "Less powerful than Egger's (rank-based loses information)",
                "But makes fewer parametric assumptions",
                "Better for non-normally distributed effects",
                "Often reported alongside Egger's for completeness"
              ]
            }
          ]
        }
      },
      {
        type: 'content',
        content: {
          title: "Harbord's Test for Binary Outcomes",
          sections: [
            {
              heading: "이진 데이터에 대해 다른 테스트가 필요한 이유는 무엇입니까?",
              items: [
                "Egger's test has inflated Type I error with binary outcomes (OR, RR)",
                "효과와 정밀도 사이의 관계는 비율에 대해 수학적으로 제한됩니다.",
                "Harbord의 테스트는 다음을 설명하는 점수 기반 통계를 사용합니다. 이",
                "Peters' test is an alternative using sample size rather than SE"
              ]
            },
            {
              heading: "When to Use Harbord's vs Egger's",
              items: [
                "BINARY outcomes (OR, RR, RD): Use Harbord's or Peters' test",
                "CONTINUOUS outcomes (MD, SMD): Use Egger's test",
                "SURVIVAL outcomes (HR): Harbord's or modified tests",
                "규칙: 테스트를 효과 측정에 일치시키세요"
              ]
            },
            {
              heading: "Peters' Test (Alternative)",
              items: [
                "Regress effect on 1/n (inverse sample size) instead of SE",
                "Less prone to false positives than Egger's for OR",
                "Recommended by Cochrane for meta-analyses of odds ratios",
                "Similar interpretation: significant intercept suggests asymmetry"
              ]
            }
          ]
        }
      },
      {
        type: 'content',
        content: {
          title: "Newer Alternatives: Doi Plot and LFK Index",
          sections: [
            {
              heading: "Doi Plot",
              items: [
                "Plots Z-scores against a normal quantile (|Z|) axis",
                "Creates an asymmetric pattern that's easier to read than funnel plots",
                "주요 비대칭: 선의 명백한 편차",
                "More sensitive to asymmetry patterns than traditional funnel"
              ]
            },
            {
              heading: "LFK Index",
              items: [
                "Quantifies Doi plot asymmetry as a single number",
                "LFK > 1 or < -1: Minor asymmetry",
                "LFK > 2 or < -2: Major asymmetry",
                "Provides objective measure rather than relying on visual assessment"
              ]
            },
            {
              heading: "When to Use",
              items: [
                "Consider as supplement to funnel plot + Egger's",
                "Particularly useful when visual assessment is ambiguous",
                "Available in some meta-analysis software (R metafor, Stata)",
                "Not yet universally adopted — mention if used"
              ]
            }
          ]
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 3A",
          title: "When Tests Disagree: The Statin Example",
          source: "Naci et al., BMJ 2013 — Meta-analysis of statins for mortality",
          timeline: [
            { year: "The Data", text: "29 trials of statins vs placebo/usual care for all-cause mortality. Forest plot shows significant benefit (RR 0.86). Funnel plot shows... some asymmetry.", type: "normal" },
            { year: "Egger's Test", text: "p = 0.12. Not significant at 0.10 threshold. Suggests no publication bias.", type: "normal" },
            { year: "Begg's Test", text: "p = 0.08. Borderline significant. Suggests possible publication bias.", type: "normal" },
            { year: "The Dilemma", text: "Tests disagree. Visual inspection shows some gap in bottom-left. What to conclude?", type: "buried" },
            { year: "The Resolution", text: "Authors report BOTH tests, note discordance, state 'some evidence of small-study effects.' Transparency > certainty.", type: "revealed" }
          ],
          realData: {
            eggerP: "p = 0.12 (not significant)",
            beggP: "p = 0.08 (borderline)",
            studies: "29 trials",
            visualAssessment: "Mild asymmetry visible",
            conclusion: "불확실함 — 주의 사항과 함께 보고됨"
          }
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "Interpreting Discordant Tests",
          situation: "Your meta-analysis has 18 studies. Egger's test: p=0.04 (significant). Begg's test: p=0.21 (not significant). Visual inspection shows mild asymmetry. Your funnel has moderate heterogeneity (I²=55%). What do you conclude?",
          nodes: [
            {
              id: 'start',
              question: "Egger는 유의미하고 Begg는 그렇지 않습니다. 시각적으로 약간의 비대칭이 나타납니다. 귀하의 해석은 무엇입니까?",
              branches: [
                { id: 'a', text: "Egger's is more powerful — publication bias is present", nextNode: 'egger_rules' },
                { id: 'b', text: "테스트 결과가 일치하지 않음 - 증거가 확실하지 않음", nextNode: 'inconclusive' },
                { id: 'c', text: "Check if heterogeneity could explain the discordance", nextNode: 'heterogeneity' }
              ]
            },
            {
              id: 'egger_rules',
              type: 'outcome',
              consequence: 'bad',
              title: "The Oversimplification",
              text: "While Egger's IS more powerful, it's also more prone to false positives when heterogeneity exists. Your I²=55% is substantial. The 'asymmetry' Egger's detected may be effect modification, not bias. Concluding 'bias present' without addressing heterogeneity is premature.",
              realCase: "Sterne et al. Egger의 테스트는 이질성이 존재할 때 제1종 오류율을 부풀렸다는 것을 보여주었습니다. 이 테스트는 특히 편향이 아닌 비대칭성을 감지합니다."
            },
            {
              id: 'inconclusive',
              type: 'outcome',
              consequence: 'neutral',
              title: "정직한 평가",
              text: "You report: 'Evidence for publication bias is mixed. Egger's test was significant (p=0.04) but Begg's was not (p=0.21). Visual asymmetry is mild. In the presence of moderate heterogeneity (I²=55%), these tests have limited reliability. We cannot confidently assess publication bias.' This is honest but unhelpful for decision-making.",
              realCase: "많은 메타 분석이 이러한 불편한 중간 지점에 도달합니다. 불확실성에 대한 투명성은 중요하지만 독자에게는 지침이 필요합니다."
            },
            {
              id: 'heterogeneity',
              question: "더 자세히 조사해 보세요. 소규모 연구는 아시아(다른 인구)에서 이루어졌고, 대규모 연구는 유럽/미국에서 이루어졌습니다. 질병의 심각도는 지역마다 달랐습니다. 이제 어떻게 해야 할까요?",
              branches: [
                { id: 'd', text: "이질성은 비대칭성을 설명합니다. 이는 출판 편향이 아닙니다.", nextNode: 'explained' },
                { id: 'e', text: "지역별로 계층화된 분석을 수행하고 계층 내에서 테스트", nextNode: 'stratify' }
              ]
            },
            {
              id: 'explained',
              type: 'outcome',
              consequence: 'good',
              title: "임상적 통찰력",
              text: "The apparent 'asymmetry' reflects genuine regional differences in populations and disease. Asian populations had more severe disease (baseline risk 25% vs 15%), explaining larger effects in smaller trials. This is heterogeneity, not suppression. You report this finding — it's clinically important and explains the discordant tests.",
              realCase: "In cardiovascular trials, regional differences in baseline risk routinely cause heterogeneity that can mimic publication bias on funnel plots."
            },
            {
              id: 'stratify',
              type: 'outcome',
              consequence: 'good',
              title: "층화된 평가",
              text: "Within Asian studies (8 trials): no asymmetry, Egger p=0.45. Within European studies (10 trials): no asymmetry, Egger p=0.38. The POOLED asymmetry was confounded by region. Publication bias is now considered unlikely — the heterogeneity between regions created the apparent funnel asymmetry.",
              realCase: "Stratified funnel plots (by subgroup) can reveal that apparent bias is actually confounding by a third variable."
            }
          ]
        }
      },
      {
        type: 'clinical-guide',
        content: {
          title: "Statistical Test Interpretation Guide",
          items: [
            "SAMPLE SIZE: With <10 studies, tests have very low power — don't trust a negative result",
            "CONCORDANCE: If Egger's, Begg's, AND visual all agree, confidence is higher",
            "HETEROGENEITY: High I² inflates false positives for Egger's — interpret cautiously",
            "효과 측정: OR에 대해 Peters의 테스트를 사용합니다(이진 결과에 대해 Egger의 테스트보다 더 나은 속성)",
            "REPORT BOTH: Always report Egger's AND visual assessment, note any discordance",
            "THRESHOLD: p<0.10 is conventional (not 0.05) because of low power",
            "NEVER CONCLUDE 'NO BIAS': A non-significant test doesn't prove absence of bias"
          ]
        }
      },
      {
        type: 'content',
        content: {
          title: "When Publication Bias Is Less of a Concern",
          sections: [
            {
              heading: "우려를 줄이는 징후",
              items: [
                "HARD OUTCOMES: Mortality, hospitalization — harder to manipulate or spin than 'quality of life'",
                "LARGE TRIALS: Fewer small studies means less selective publishing opportunity",
                "PROSPECTIVE REGISTRATION: All trials registered before starting, with pre-specified outcomes",
                "INDEPENDENT REPLICATION: Non-industry trials confirm industry findings",
                "SYMMETRIC FUNNEL: Visual inspection shows no gap, tests negative, registry search finds no missing trials"
              ]
            },
            {
              heading: "균형 잡힌 관점",
              items: [
                "Not every asymmetric funnel means suppression",
                "Not every meta-analysis of drug trials is biased",
                "Publication bias is ONE threat to validity — consider others too",
                "목표는 최대가 아닌 정확한 평가입니다. 회의론"
              ]
            }
          ]
        }
      },
      {
        type: 'contrast',
        content: {
          title: "Two Meta-Analyses: Different Risk Profiles",
          darkSide: {
            header: "HIGH RISK for Publication Bias",
            items: [
              "Subjective outcome (pain scores, depression scales)",
              "All trials industry-funded",
              "Multiple small trials, few large confirmatory",
              "No prospective registration",
              "Asymmetric funnel, all published trials positive",
              "Registry shows unpublished completed trials"
            ],
            consequence: "Interpretation: Treat effect estimates with high suspicion. Apply corrections, search for unpublished data, downgrade GRADE for bias."
          },
          lightSide: {
            header: "LOW RISK for Publication Bias",
            items: [
              "Objective outcome (all-cause mortality)",
              "Mix of industry and government-funded trials",
              "Includes large multicenter confirmatory trials",
              "Most trials prospectively registered",
              "대칭 깔대기, 긍정적인 결과와 null 결과의 혼합",
              "Registry search finds no missing completed trials"
            ],
            consequence: "Interpretation: Publication bias is a lesser concern (not zero, but modest). Focus assessment on other biases: allocation concealment, attrition, etc."
          }
        }
      },
      {
        type: 'cycle-return',
        content: {
          principle: "The eye suspects, but the test quantifies. Yet remember: the test detects asymmetry, not bias. Asymmetry is a clue; bias is a conclusion that requires judgment."
        }
      },
      {
        type: 'quiz',
        content: {
          question: "Your meta-analysis has 8 studies. Egger's test gives p=0.23. You should conclude:",
          options: [
            { id: 'a', text: "No publication bias is present", correct: false },
            { id: 'b', text: "출판 편향이 존재할 수도 있고 존재하지 않을 수도 있습니다. 테스트는 8개 연구에서 낮은 검정력을 갖습니다.", correct: true },
            { id: 'c', text: "메타 분석은 타당하고 편견이 없습니다", correct: false },
            { id: 'd', text: "You need to use Begg's test instead", correct: false }
          ],
          explanation: "With only 8 studies, Egger's test has very low power to detect publication bias even when it exists. A non-significant result does NOT mean no bias — it means the test couldn't detect it. Cochrane recommends at least 10 studies for meaningful interpretation of these tests. You should report the test result but not over-interpret a negative finding."
        }
      },
      {
        type: 'common-mistakes',
        content: {
          mistakes: [
            { mistake: "Concluding 'no bias' from non-significant test", correction: "Non-significant tests may lack power — especially with <10 studies. Say 'insufficient evidence to detect bias.'" },
            { mistake: "Ignoring heterogeneity when interpreting Egger's", correction: "높은 I²는 위양성률을 높입니다. 에거를 위해. 편향을 결론짓기 전에 교란 요소를 확인하십시오." },
            { mistake: "Only using one test", correction: "Report Egger's AND visual assessment. Note concordance or discordance. Neither alone is sufficient." },
            { mistake: "Using standard p<0.05 threshold", correction: "Convention uses p<0.10 for publication bias tests because of low power. Adjust your interpretation." }
          ]
        }
      },
      {
        type: 'key-takeaways',
        content: {
          takeaways: [
            "Egger's test: regression-based, more powerful but sensitive to heterogeneity",
            "Begg's test: rank-based, less powerful but more robust to distributional assumptions",
            "Use p<0.10 threshold (not 0.05) due to low power of these tests",
            "With <10 studies, tests have very limited value — rely more on visual assessment and external evidence",
            "Discordant tests often indicate heterogeneity is confounding the assessment"
          ],
          actionItem: "For your next meta-analysis, plan to report: visual funnel plot, Egger's test with p-value, sample size, and heterogeneity (I²) to contextualize findings."
        }
      }
    ]
  },

  // MODULE 4: THE CORRECTION
  {
    id: 4,
    title: "The Correction",
    subtitle: "편향 조정",
    estimatedMinutes: 35,
    slides: [
      {
        type: 'learning-objectives',
        content: {
          intro: "By the end of this module, you will be able to:",
          objectives: [
            "자르기 및 채우기 방법을 적용 및 해석하고 해당 가정을 이해하십시오.",
            "Explain PET-PEESE regression and when it outperforms Trim-and-Fill",
            "고장 안전 N을 사용하여 견고성을 평가합니다(적절한 주의 사항 포함)",
            "설명 선택 모델(Copas, 3PSM) 및 민감도 분석에서의 역할",
            "데이터 특성을 기반으로 적절한 수정 방법 선택"
          ]
        }
      },
      {
        type: 'principle',
        content: {
          number: "IV",
          text: "숨겨진 내용을 추정하려면 그림자를 추측해야 합니다. 하지만 추정치를 진실로 착각하지 마십시오."
        }
      },
      {
        type: 'rhetoric',
        content: {
          question: "절대로 존재했습니다 — 묻힌 증거의 복구가 아니라 통계적 추측입니까?"
        }
      },
      {
        type: 'content',
        content: {
          title: "자르기 및 채우기 방법",
          sections: [
            {
              heading: "The Logic",
              items: [
                "1. TRIM: 비대칭 측면에서 가장 극단적인 작은 연구를 제거합니다",
                "2. 추정: 나머지(대칭) 연구에서 통합 효과 계산",
                "3. FILL: Add imputed mirror-image studies to create symmetry",
                "4. RE-ESTIMATE: Calculate adjusted pooled effect including imputed studies"
              ]
            },
            {
              heading: "The Assumption",
              items: [
                "Asymmetry is ENTIRELY due to suppression of small negative studies",
                "'실제' 깔때기는 실제 효과를 중심으로 대칭입니다.",
                "누락된 연구는 관찰된 비대칭 연구의 거울 이미지입니다."
              ]
            },
            {
              heading: "The Limitations",
              items: [
                "If asymmetry is due to heterogeneity (not bias), trim-and-fill OVERCORRECTS",
                "귀속된 연구는 허구입니다. 실제 미발표 시험을 나타낼 수 없습니다.",
                "실제 누락된 데이터를 복구하지 않습니다. 단지 표시될 내용을 추정합니다.",
                "Performance varies; can under- or over-correct depending on true mechanism"
              ]
            }
          ]
        }
      },
      {
        type: 'tool-trimfill',
        content: {
          id: 'trim-fill-tool',
          title: "자르고 채우기 시각화 도구",
          description: "Trim-and-fill이 누락된 연구를 대치하고 풀링된 데이터를 조정하는 방법을 알아보세요. 효과."
        }
      },
      {
        type: 'content',
        content: {
          title: "PET-PEESE: Precision-Effect Testing",
          sections: [
            {
              heading: "What is PET-PEESE?",
              items: [
                "An alternative to trim-and-fill that estimates bias-corrected effects via regression",
                "PET = Precision-Effect Test: regress effect on SE, intercept estimates bias-corrected effect",
                "PEESE = Precision-Effect Estimate with Standard Error: regress effect on SE², better when true effect exists",
                "Two-step conditional estimator: Use PET to test if effect exists, then PEESE to estimate it"
              ]
            },
            {
              heading: "2단계 프로세스",
              items: [
                "STEP 1 (PET): Regress effect sizes on standard errors (effect = β₀ + β₁×SE)",
                "If PET intercept β₀ is significant (p<0.10): True effect likely exists → use PEESE",
                "STEP 2 (PEESE): Regress effect sizes on variance (effect = β₀ + β₁×SE²)",
                "PEESE intercept provides bias-corrected effect estimate",
                "PET가 중요하지 않은 경우: 편향을 넘어서는 실제 효과에 대한 증거가 없다고 결론을 내립니다."
              ]
            },
            {
              heading: "자르기 및 채우기보다 장점",
              items: [
                "Better performance in simulations when publication bias is moderate to severe",
                "Provides explicit test of whether true effect exists after accounting for bias",
                "Less assumption-dependent than selection models",
                "Works with meta-regression framework — can include moderators"
              ]
            },
            {
              heading: "Limitations",
              items: [
                "신뢰할 수 있으려면 10개 이상의 연구가 필요합니다. 추정치",
                "Assumes linear relationship between effect and SE/variance",
                "Can over-correct when heterogeneity explains small-study effects",
                "PET can have low power to detect true effects"
              ]
            }
          ]
        }
      },
      {
        type: 'tool-petpeese',
        content: {
          id: 'pet-peese-tool',
          title: "PET-PEESE Calculator",
          description: "PET 및 PEESE 편향 보정 추정치를 계산하려면 메타 분석 데이터를 입력하세요."
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 4A",
          title: "Trim-and-Fill vs Reality: The Antidepressant Test",
          source: "Turner et al. NEJM 2008 — Comparing estimate to FDA truth",
          timeline: [
            { year: "The Opportunity", text: "Turner는 출판된 문헌과 FDA의 전체 시험 등록을 모두 갖고 있었습니다. 이를 통해 드문 테스트가 가능해졌습니다. 다듬기 및 채우기가 게시되지 않은 데이터를 올바르게 추정합니까?", type: "normal" },
            { year: "Published Only", text: "Meta-analysis of published trials: effect size = 0.41 (strongly effective)", type: "normal" },
            { year: "Trim-and-Fill", text: "Applied to published data: imputes 6 studies, adjusted effect = 0.34. A 17% reduction.", type: "normal" },
            { year: "FDA Truth", text: "Including ALL FDA trials (published + unpublished): effect size = 0.31. True reduction was 24%.", type: "revealed" },
            { year: "The Verdict", text: "자르고 채우기 편향을 과소평가했습니다. 어느 정도 수정되었으나 충분하지 않습니다. 없는 것보다는 낫지만 실제 데이터를 대체하지는 않습니다.", type: "revealed" }
          ],
          realData: {
            publishedEffect: "d = 0.41",
            trimFillEffect: "d = 0.34 (17% reduction)",
            trueEffect: "d = 0.31 (24% reduction)",
            trimFillAccuracy: "편향의 최대 70% 수정"
          }
        }
      },
      {
        type: 'content',
        content: {
          title: "Selection Models",
          sections: [
            {
              heading: "The Concept",
              items: [
                "Explicitly model the PROBABILITY of publication",
                "P(published) depends on p-value, effect direction, or statistical significance",
                "관측 데이터에서 선택 함수 매개변수 추정",
                "Adjust effect estimate accounting for estimated selection"
              ]
            },
            {
              heading: "Common Selection Models",
              items: [
                "3PSM: Three-parameter selection model — step function at p=0.05",
                "Copas model: Continuous selection probability based on effect and variance",
                "Weight-function models: Flexible specification of selection weights"
              ]
            },
            {
              heading: "자르기 및 채우기보다 장점",
              items: [
                "Explicitly models the selection mechanism",
                "Can accommodate more complex selection patterns",
                "선택 불확실성을 설명하는 불확실성 구간 제공"
              ]
            },
            {
              heading: "Disadvantages",
              items: [
                "선택에 대한 가정 필요 기능",
                "연구 수가 적으므로 불안정할 수 있음",
                "Multiple models can give different answers"
              ]
            }
          ]
        }
      },
      {
        type: 'content',
        content: {
          title: "P-Curve Analysis",
          sections: [
            {
              heading: "The Logic",
              items: [
                "Examine the DISTRIBUTION of significant p-values (p<0.05)",
                "If true effect exists: p-curve should be RIGHT-SKEWED (many p<0.01)",
                "If no effect + selective reporting: p-curve is FLAT or LEFT-SKEWED",
                "If p-hacking: spikes just below 0.05"
              ]
            },
            {
              heading: "Interpretation",
              items: [
                "오른쪽으로 치우친 p-곡선: 실제 효과에 대한 증거",
                "Flat p-curve: Suggests no true effect (or underpowered studies)",
                "Left-skewed: Suggests selective reporting or p-hacking",
                "Spike at 0.04-0.05: Classic p-hacking signature"
              ]
            }
          ]
        }
      },
      {
        type: 'tool-pcurve',
        content: {
          id: 'pcurve-tool',
          title: "P-Curve Analyzer",
          description: "증거 가치를 평가하려면 중요한 연구의 p-값을 입력하세요."
        }
      },
      {
        type: 'content',
        content: {
          title: "Fail-Safe N(Rosenthal의 방법)",
          sections: [
            {
              heading: "The Concept",
              items: [
                "결과를 중요하지 않게 만들려면 출판되지 않은 null 연구가 몇 개나 존재해야 합니까?",
                "숫자가 크면 결과가 출판 편향에 '견고한' 것입니다.",
                "숫자가 작으면 몇 개의 파일 서랍 연구로 인해 귀하의 결과가 무효화될 수 있습니다. 결론"
              ]
            },
            {
              heading: "The Formula",
              items: [
                "N = (ΣZ / 1.645)² - k, where k = number of studies",
                "Alternatively: N = k × (mean Z / 1.645)² - k",
                "Rule of thumb: N > 5k + 10 suggests robustness"
              ]
            },
            {
              heading: "Limitations (Important!)",
              items: [
                "Assumes missing studies have EXACTLY zero effect (unrealistic)",
                "Doesn't account for systematic bias in effect direction",
                "Can give misleadingly large N when effects are inflated",
                "현대적인 방법(선택 모델, 다듬기 및 채우기)이 선호됩니다"
              ]
            }
          ]
        }
      },
      {
        type: 'tool-failsafe',
        content: {
          id: 'failsafe-tool',
          title: "Fail-Safe N Calculator",
          description: "메타 분석 결과를 무효화하려면 얼마나 많은 null 연구가 존재해야 하는지 계산하세요."
        }
      },
      {
        type: 'contrast',
        content: {
          title: "Two Approaches to Bias Correction",
          darkSide: {
            header: "과신한 분석가",
            items: [
              "Runs trim-and-fill once",
              "Reports adjusted estimate as 'true effect'",
              "Ignores model assumptions",
              "일치하는 내용을 무시합니다. 방법",
              "Claims bias has been 'corrected'"
            ],
            consequence: "Result: False precision. Readers believe the adjusted number. If assumptions wrong, they're misled. The overconfidence perpetuates poor practice."
          },
          lightSide: {
            header: "겸손한 분석가",
            items: [
              "Runs multiple methods (trim-fill, selection models, PET-PEESE)",
              "Reports a RANGE of plausible effects",
              "States assumptions explicitly",
              "Notes when methods disagree (that's informative!)",
              "Acknowledges uncertainty in all corrections"
            ],
            consequence: "결과: 정직한 불확실성. 독자는 한계를 봅니다. 의사결정자는 위험을 이해합니다. 과학은 인정된 한계를 통해 발전합니다."
          }
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "수정 방법 선택",
          situation: "Your meta-analysis shows significant funnel asymmetry (Egger p=0.02). You want to estimate a bias-adjusted effect. Which method should you use?",
          nodes: [
            {
              id: 'start',
              question: "출판 편향 가능성이 감지되었습니다. 추정치를 어떻게 조정합니까?",
              branches: [
                { id: 'a', text: "Use trim-and-fill — it's the most widely recognized", nextNode: 'trimfill' },
                { id: 'b', text: "Use a selection model — it models the mechanism", nextNode: 'selection' },
                { id: 'c', text: "주의 사항과 함께 조정되지 않은 추정치를 보고합니다. 수정 사항은 신뢰할 수 없습니다.", nextNode: 'noadjust' }
              ]
            },
            {
              id: 'trimfill',
              question: "Trim-and-fill 대치 4개 연구. 조정된 효과는 OR 0.65에서 OR 0.78로 떨어집니다. 이것을 '참' 효과로 보고하십니까?",
              branches: [
                { id: 'd', text: "예 — 조정된 추정치가 편향을 수정합니다", nextNode: 'overclaim' },
                { id: 'e', text: "Report both estimates as sensitivity analysis", nextNode: 'sensitivity' }
              ]
            },
            {
              id: 'overclaim',
              type: 'outcome',
              consequence: 'bad',
              title: "잘못된 확실성",
              text: "자르기 및 채우기가 ASSUMED 메커니즘을 수정합니다. 비대칭이 부분적으로 이질성(편향이 아님)인 경우 과도하게 수정한 것입니다. 심한 편견이었다면 과소수정한 것입니다. 조정된 추정치를 '진실'로 제시하면 정밀도가 잘못됩니다. 어떤 시나리오가 적용되는지 알 수 없습니다.",
              realCase: "Turner의 항우울제 분석에서는 다듬기 및 채우기가 실제 편향의 ~70%만 포착한 것으로 나타났습니다. 여전히 상당한 잔여 인플레이션입니다."
            },
            {
              id: 'sensitivity',
              type: 'outcome',
              consequence: 'good',
              title: "정직한 범위",
              text: "귀하의 보고: '조정되지 않은 OR 0.65 (0.55-0.77). 다듬기 및 채우기 조정된 OR 0.78(0.65-0.94). 실제 효과는 아마도 이 범위 내에 있을 것입니다.' 불확실성을 적절하게 전달하셨습니다. 독자는 결론이 편향된 가정에 민감하다는 것을 알 수 있습니다.",
              realCase: "이 접근 방식(조정되지 않고 경계로 조정된 보고)은 여러 방법론자가 권장합니다."
            },
            {
              id: 'selection',
              question: "3-매개변수 선택 모델을 실행합니다. 이는 OR 0.82(0.68-0.99)를 제공하며 다듬기 및 채우기보다 더 많은 편향을 나타냅니다. Copas 모델은 OR 0.75(0.60-0.93)를 제공하며 더 적은 것을 제안합니다. 당신은 무엇을합니까?",
              branches: [
                { id: 'f', text: "모델 평균화", nextNode: 'average' },
                { id: 'g', text: "Report all models as sensitivity analyses showing range of plausible adjustments", nextNode: 'range' }
              ]
            },
            {
              id: 'average',
              type: 'outcome',
              consequence: 'bad',
              title: "잘못된 합성",
              text: "다양한 가정을 사용하여 모델을 평균화하는 것은 '진실'을 제공하지 않습니다. 의미 있는 수량에 해당하지 않을 수 있는 숫자를 제공합니다. 모델은 서로 다른 가정을 하기 때문에 동의하지 않습니다. 의견 불일치는 평균을 내는 것이 아니라 정보입니다.",
              realCase: "편향 보정의 모델 평균화는 적절한 가중치를 적용하는 데 적합할 수 있지만 점 추정치의 단순한 평균화는 핵심 결과인 모델 불확실성을 모호하게 합니다."
            },
            {
              id: 'range',
              type: 'outcome',
              consequence: 'good',
              title: "전체 그림",
              text: "You report: 'Adjustments range from OR 0.75 (Copas) to OR 0.82 (3PSM). All adjusted estimates remain significant but are attenuated from the unadjusted OR 0.65. We cannot determine which selection model best represents the true mechanism, but results suggest the unadjusted estimate is inflated by approximately 15-25%.'",
              realCase: "이러한 모델의 투명한 보고는 민감도에 대한 불확실성 모범 사례를 따릅니다. 분석."
            },
            {
              id: 'noadjust',
              type: 'outcome',
              consequence: 'neutral',
              title: "보수적인 선택",
              text: "You report the unadjusted effect with a clear warning: 'Funnel plot asymmetry suggests publication bias (Egger p=0.02). The reported effect (OR 0.65) is likely inflated. Bias-adjusted estimates vary depending on assumptions. Interpret with caution.' This is honest but may frustrate readers wanting a 'corrected' number.",
              realCase: "일부 방법론자들은 이것이 유일하게 방어 가능한 접근 방식이라고 주장합니다. 수정은 모델에 너무 의존적이어서 신뢰할 수 없습니다."
            }
          ]
        }
      },
      {
        type: 'clinical-guide',
        content: {
          title: "Bias Correction Best Practices",
          items: [
            "절대 조정된 추정치가 '진정한' 효과라고 주장하지 마세요. 민감도 분석입니다.",
            "REPORT BOTH: Original estimate AND adjusted estimate(s) as bounding scenarios",
            "TRY MULTIPLE METHODS: If they all agree, more confidence; if they disagree, that's important",
            "SEEK 실제 데이터: 통계 수정보다 레지스트리 검색 및 FOIA가 더 좋습니다",
            "CONSIDER THE MECHANISM: Is asymmetry likely bias, heterogeneity, or both?",
            "STATE ASSUMPTIONS: Make clear what assumptions each correction method requires",
            "DOWNGRADE GRADE: If substantial bias likely, reduce certainty regardless of adjustment"
          ]
        }
      },
      {
        type: 'cycle-return',
        content: {
          principle: "숨겨진 내용을 추정하려면 그림자를 추측하는 것이 좋습니다. 통계적 수정은 진실 복구가 아닌 민감도 분석을 위한 도구입니다. 진실을 향한 유일한 확실한 길은 실제 숨겨진 데이터를 찾는 것입니다."
        }
      },
      {
        type: 'quiz',
        content: {
          question: "잘라내기 및 채우기는 풀링 효과를 OR 0.60에서 OR 0.75로 조정합니다. 어떤 결론을 내릴 수 있습니까?",
          options: [
            { id: 'a', text: "실제 효과는 OR 0.75입니다.", correct: false },
            { id: 'b', text: "실제 효과는 OR 0.60과 OR 0.75 사이에 있습니다.", correct: false },
            { id: 'c', text: "출판 편향이 비대칭의 원인인 경우 효과는 OR 0.75에 가까울 수 있지만 이 수정은 다음과 같습니다. 불확실함", correct: true },
            { id: 'd', text: "메타 분석은 신뢰할 수 없으므로 발표해서는 안 됩니다.", correct: false }
          ],
          explanation: "Trim-and-fill provides a plausible adjustment IF publication bias is the true cause of asymmetry AND IF the missing studies would be mirror-images of observed studies. These are strong assumptions. The adjusted estimate is a sensitivity analysis, not a definitive correction. Turner's comparison showed trim-and-fill only partially corrected for actual bias."
        }
      },
      {
        type: 'patient-communication',
        content: {
          scenario: "환자가 새로운 약물에 대해 문의합니다. 최근 메타 분석이 이를 뒷받침한다는 사실을 알고 계시지만 출판 편향 우려도 알고 계십니다.",
          script: "The research generally supports this medication, but I want to be honest with you — studies with positive results are more likely to get published than negative ones. The overall evidence suggests benefit, but the true effect might be somewhat smaller than the published studies show. Based on your specific situation, I think the potential benefits still outweigh the risks, but let's monitor closely and adjust if needed.",
          keyPoints: [
            "Acknowledge uncertainty without causing undue alarm",
            "Explain publication bias in accessible terms",
            "Frame in context of patient's individual risk-benefit",
            "Emphasize shared decision-making and monitoring"
          ]
        }
      },
      {
        type: 'key-takeaways',
        content: {
          takeaways: [
            "Trim-and-Fill은 거울 이미지 연구를 대치합니다 — 검증 연구에서 편향의 최대 70%를 수정합니다",
            "PET-PEESE uses regression to estimate bias-corrected effects — two-step conditional estimator",
            "Selection models (3PSM, Copas) explicitly model publication probability — more flexible but complex",
            "P-curve analyzes distribution of p-values to detect p-hacking or evidential value",
            "모든 수정은 진실 복구가 아닌 민감도 분석입니다. 실제 데이터를 찾는 것이 항상 더 좋습니다"
          ],
          actionItem: "다음 번에는 메타 분석에서는 민감도 분석으로 다듬기 및 채우기 및 PET-PEESE를 모두 실행합니다. 주요 추정치와 함께 두 가지 모두 보고하십시오."
        }
      }
    ]
  },

  // MODULE 5: THE HUNT
  {
    id: 5,
    title: "The Hunt",
    subtitle: "숨겨진 증거 찾기",
    estimatedMinutes: 25,
    slides: [
      {
        type: 'learning-objectives',
        content: {
          intro: "By the end of this module, you will be able to:",
          objectives: [
            "미발표 연구에 대한 ClinicalTrials.gov 및 기타 레지스트리 검색",
            "File FOIA requests and navigate regulatory document access",
            "회색 문헌 출처의 품질 및 유용성을 평가",
            "Contact trialists systematically to request unpublished data",
            "Build a comprehensive search strategy that goes beyond published literature"
          ]
        }
      },
      {
        type: 'principle',
        content: {
          number: "V",
          text: "Better to find one buried study than to impute ten imaginary ones."
        }
      },
      {
        type: 'rhetoric',
        content: {
          question: "본 적이 없으십니까? ClinicalTrials.gov가 시작된 내용을 어떻게 기록하고 게시된 내용과 비교하면 포기된 결과의 무덤이 드러납니까?"
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 5A",
          title: "The Registry Detective: Ross's Investigation",
          source: "Ross et al., JAMA 2009 — Tracking trials from registration to publication",
          timeline: [
            { year: "The Method", text: "Ross identified all trials registered on ClinicalTrials.gov in 2002. Followed them for 5 years. Did they get published?", type: "normal" },
            { year: "The Findings", text: "Of 677 registered trials, only 46% published within 5 years. Positive trials: 61% published. Negative/null trials: 34% published.", type: "buried" },
            { year: "The Gap", text: "Industry-funded trials: 40% published. NIH-funded: 56%. Academic non-profit: 56%. Industry was worst at publishing.", type: "buried" },
            { year: "The Implication", text: "등록소에서는 누락된 출판물이 무엇인지 드러냅니다. 의사가 볼 수 있는 증거 기반은 존재하는 증거 기반의 절반 미만입니다.", type: "revealed" }
          ],
          realData: {
            registered: "677 trials in 2002",
            published5yr: "46% published within 5 years",
            positivePublished: "61%",
            negativePublished: "34%",
            industryPublished: "40%",
            academicPublished: "56%"
          }
        }
      },
      {
        type: 'content',
        content: {
          title: "Trial Registry Searching",
          sections: [
            {
              heading: "Key Registries",
              items: [
                "ClinicalTrials.gov — Largest, US-based, required for many trials",
                "ISRCTN — International, especially European trials",
                "EU Clinical Trials Register — European Medicines Agency database",
                "WHO ICTRP — Search portal for multiple registries worldwide",
                "Disease-specific registries (e.g., oncology, cardiovascular)"
              ]
            },
            {
              heading: "찾을 대상",
              items: [
                "발표된 결과가 없는 완료된 임상시험",
                "Trials where 'completion date' was years ago",
                "Trials listed as 'terminated' — why?",
                "Discrepancies: registered primary outcome ≠ published primary outcome"
              ]
            },
            {
              heading: "Search Strategy",
              items: [
                "Search your drug/intervention in registry",
                "완료/종료된 임상시험 필터링",
                "메타 분석과의 상호 참조: 어떤 임상시험이 놓치셨나요?",
                "미공개 데이터는 시험 참가자에게 문의하세요"
              ]
            }
          ]
        }
      },
      {
        type: 'tool-registry',
        content: {
          id: 'registry-tracker',
          title: "Registry Gap Finder",
          description: "Compare registered vs. published trials to identify potentially missing studies."
        }
      },
      {
        type: 'rhetoric',
        content: {
          question: "지금까지 시작된 모든 시험 중 거의 절반이 게시되지 않았다는 점을 고려하지 않으셨나요? 과학의 무덤이 도서관만큼 많은 연구를 보유하고 있다는 것인가요?"
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 5B",
          title: "AllTrials: 금고 열기 운동",
          source: "AllTrials Campaign + Goldacre, Bad Pharma, 2012",
          timeline: [
            { year: "2012", text: "Ben Goldacre가 'Bad Pharma'를 출판했습니다. 업계 전반에 걸쳐 체계적인 억제를 문서화합니다. 투명성 요구.", type: "normal" },
            { year: "2013", text: "AllTrials campaign launches: 'All trials registered, all results reported.' Within months, 85,000 individuals and 600 organizations sign on.", type: "normal" },
            { year: "The Resistance", text: "Industry initially resists. Argues: proprietary data, competitive advantage, patient privacy. But pressure mounts.", type: "buried" },
            { year: "2015", text: "EMA는 정책 0070을 채택합니다. 임상 시험 데이터가 공개됩니다. GSK는 시험 데이터 공유를 약속합니다. 흐름이 바뀌기 시작합니다.", type: "revealed" },
            { year: "The Progress", text: "ClinicalTrials.gov는 이제 1년 이내에 결과 보고를 요구합니다. 하지만 집행력은 약하다. 2023년 현재 약 30%의 임상시험이 여전히 결과를 제때 보고하지 않습니다.", type: "revealed" }
          ],
          realData: {
            campaignSignatures: "85,000+ individuals, 600+ organizations",
            currentCompliance: "~70% of trials report results within required timeframe",
            remainingGap: "~30% still don't comply",
            enforcement: "Limited — fines rarely applied",
            progress: "Significant but incomplete"
          }
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "The Stonewalled 연구원",
          situation: "You're conducting a Cochrane review. You've identified 5 unpublished industry trials on ClinicalTrials.gov. You've emailed the company three times over 6 months. No response. The company's published trials show strong efficacy. You strongly suspect the unpublished trials are negative. What do you do?",
          nodes: [
            {
              id: 'start',
              question: "회사는 데이터를 공유하지 않습니다. 어떻게 진행하나요?",
              branches: [
                { id: 'a', text: "게시된 데이터만 사용하여 리뷰 게시", nextNode: 'publish_incomplete' },
                { id: 'b', text: "Escalate — formal data request through Cochrane", nextNode: 'escalate' },
                { id: 'c', text: "Try alternative routes — FOIA, EMA, litigation documents", nextNode: 'alternatives' }
              ]
            },
            {
              id: 'publish_incomplete',
              type: 'outcome',
              consequence: 'bad',
              title: "불완전한 진실",
              text: "Your review shows strong efficacy based on published trials. But you know 5 unpublished trials exist. You mention them in 'Limitations' but proceed anyway. Your review is cited by guidelines. The drug is widely adopted. Years later, when the unpublished data emerges, your review is discredited. You contributed to the distortion you were trying to assess.",
              realCase: "몇몇 Cochrane 리뷰는 알려진 미발표 시험에도 불구하고 진행되는 것에 대해 비판을 받았습니다. 출판에 대한 압력은 과학적 주의보다 우선시될 수 있습니다."
            },
            {
              id: 'escalate',
              question: "Cochrane의 공식 채널을 통해 에스컬레이션합니다. 회사는 '요약 데이터'로 응답하지만 개별 환자 데이터는 아닙니다. 요약에는 '공개된 시험과 유사한 결과'가 표시됩니다. 그것을 신뢰하십니까?",
              branches: [
                { id: 'd', text: "Accept the summary — it's better than nothing", nextNode: 'accept_summary' },
                { id: 'e', text: "전체 데이터를 요구하거나 거부 문서를 기록하세요", nextNode: 'demand_full' }
              ]
            },
            {
              id: 'accept_summary',
              type: 'outcome',
              consequence: 'neutral',
              title: "제한된 승리",
              text: "You include the company's summary data. It shows modest effects, smaller than published trials. Your review now has more data — but you can't verify the company's summary. You note: 'Unpublished data provided by manufacturer; individual patient data not available for independent analysis.' You've documented the limitation transparently.",
              realCase: "많은 리뷰가 제조업체의 요약 데이터를 받아들입니다. 없는 것보다는 낫지만 독립적인 검증이 불가능합니다."
            },
            {
              id: 'demand_full',
              type: 'outcome',
              consequence: 'good',
              title: "문서화된 거부",
              text: "The company refuses full data. You document every request, every refusal. Your review states: 'Manufacturer declined to provide individual patient data for 5 trials despite repeated requests. Summary data offered but not independently verifiable. Published evidence may overestimate efficacy.' This transparency is scientifically honest and puts the burden where it belongs.",
              realCase: "Cochrane의 Tamiflu 리뷰에는 수년간 Roche의 거부가 기록되어 있습니다. 이 문서는 결국 데이터 공개에 대한 규제 압력에 기여했습니다."
            },
            {
              id: 'alternatives',
              question: "FDA에 FOIA 요청을 제출합니다. 6개월 후 귀하는 일부 수정 사항이 포함된 임상 연구 보고서를 받게 됩니다. 무엇을 발견했습니까?",
              branches: [
                { id: 'f', text: "미발표된 임상시험은 실제로 부정적이었습니다. 의심이 확인되었습니다", nextNode: 'confirmed_negative' },
                { id: 'g', text: "미발표된 임상시험은 긍정적이었습니다. 의심한 것은 틀렸습니다", nextNode: 'wrong_suspicion' }
              ]
            },
            {
              id: 'confirmed_negative',
              type: 'outcome',
              consequence: 'good',
              title: "다시 발견된 진실",
              text: "The FDA data reveals: 3 of 5 unpublished trials showed no significant effect. Combined with published trials, the pooled effect drops from d=0.45 to d=0.22. Your review now reflects reality, not marketing. You've demonstrated why persistence in data hunting matters. The extra 6 months of work prevented years of overestimation.",
              realCase: "이것이 바로 Turner가 항우울제에서 발견한 것과 Jefferson이 발견한 것입니다. 타미플루와 함께. 끈기가 결실을 맺었습니다."
            },
            {
              id: 'wrong_suspicion',
              type: 'outcome',
              consequence: 'neutral',
              title: "정직한 확신",
              text: "The FDA data shows the unpublished trials were actually positive, similar to published results. Your suspicion was wrong. But you've now verified this independently. Your review is STRONGER because you checked. You report: 'Unpublished trials obtained via FOIA; results consistent with published trials.' Skepticism that's verified is still valuable skepticism.",
              realCase: "발표되지 않은 임상시험이 모두 부정적인 것은 아닙니다. 하지만 알 수 있는 유일한 방법은 데이터를 얻는 것입니다. 검증은 언제나 가치가 있습니다."
            }
          ]
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "CASE 5D",
          title: "FOIA 경로: FDA 데이터 획득",
          source: "다양한 사례 — Turner, Jureidini 등으로부터 학습",
          timeline: [
            { year: "The Problem", text: "제조업체는 완전한 시험 데이터를 FDA에 제출합니다. 그러나 FDA는 이를 공개할 의무가 없습니다. 대부분의 데이터는 기밀로 유지됩니다.", type: "normal" },
            { year: "The Strategy", text: "Freedom of Information Act (FOIA) requests can pry open FDA files. Request clinical study reports (CSRs), medical reviews, statistical reviews.", type: "normal" },
            { year: "The Reality", text: "FOIA 요청에는 6~24개월이 소요됩니다. 데이터가 수정되는 경우가 많습니다. 그러나 끈질긴 요청자들은 미공개 중요한 데이터를 발견했습니다.", type: "normal" },
            { year: "Turner's Approach", text: "Turner는 12개 항우울제에 대한 FDA 약물 승인 패키지를 획득했습니다. 여기에는 게시되거나 게시되지 않은 모든 제출된 시험 데이터가 포함되어 있습니다. 이것이 그의 획기적인 NEJM 연구를 가능하게 했습니다.", type: "revealed" },
            { year: "The Lesson", text: "규제 데이터가 최고의 표준입니다. 선택적으로 게시된 내용이 아니라 승인을 위해 제출된 내용을 캡처합니다.", type: "revealed" }
          ],
          realData: {
            typicalFOIAtime: "6-24 months",
            successRate: "Variable — depends on request specificity",
            dataQuality: "CSRs contain far more detail than publications",
            alternatives: "EMA provides some data proactively; Canada, Australia have similar processes"
          }
        }
      },
      {
        type: 'content',
        content: {
          title: "Grey Literature Sources",
          sections: [
            {
              heading: "Conference Abstracts",
              items: [
                "Many studies present at conferences but never publish in full",
                "주제에 대한 회의 진행 자료 검색",
                "회의에서 긍정적인 결과와 부정적인 결과가 모두 나타날 수 있습니다.",
                "Watch out: abstracts may have limited data quality"
              ]
            },
            {
              heading: "학위 논문 및 논문",
              items: [
                "ProQuest Dissertations — extensive database",
                "OpenDOAR — repository search",
                "학생은 그렇지 않은 null 결과를 게시할 수 있습니다. 동료 검토에서 살아남기",
                "Often contain pilot studies or unpublished substudies"
              ]
            },
            {
              heading: "Regulatory Documents",
              items: [
                "FDA approval packages (drugs.fda.gov)",
                "EMA public assessment reports (ema.europa.eu)",
                "NICE technology appraisals (UK)",
                "PBAC public summary documents (Australia)"
              ]
            },
            {
              heading: "Litigation Documents",
              items: [
                "Drug litigation (Vioxx, Neurontin, SSRIs) unsealed internal documents",
                "Drug Industry Document Archive (DIDA) at UCSF",
                "PLoS Medicine often publishes analyses of litigation documents"
              ]
            }
          ]
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "누락된 데이터 딜레마",
          situation: "Your meta-analysis finds 15 published trials. A registry search reveals 8 more completed trials with no publications. You contact the trialists: 3 respond with 'negative results, not interesting enough to publish.' 5 don't respond. What do you do?",
          nodes: [
            {
              id: 'start',
              question: "You've found 8 unpublished trials. How do you proceed?",
              branches: [
                { id: 'a', text: "공개된 15개의 시험을 진행합니다. 게시되지 않은 데이터는 사용할 수 없습니다.", nextNode: 'ignore' },
                { id: 'b', text: "미공개 데이터를 얻기 위해 더 노력하세요", nextNode: 'pursue' },
                { id: 'c', text: "Report both analyses: with 15 trials, and with imputation for the 8 missing", nextNode: 'dual' }
              ]
            },
            {
              id: 'ignore',
              type: 'outcome',
              consequence: 'bad',
              title: "The Willful 실명",
              text: "이제 귀하는 8개의 미발표 임상시험이 존재하며 최소 3개는 음성일 가능성이 있다는 것을 알고 있습니다. 발표된 15개의 임상시험만 게시하면 편향이 지속됩니다. 당신은 묘지를 확인했지만 떠났습니다. 귀하의 메타 분석은 효능을 과대평가하여 잠재적으로 환자에게 해를 끼칠 수 있습니다.",
              realCase: "발표되지 않은 임상시험을 확인하고 이를 무시하는 검토자는 무지하다고 주장할 수 없습니다. 모범 사례에서는 이러한 시도와 예상되는 영향을 문서화해야 합니다."
            },
            {
              id: 'pursue',
              question: "응답하지 않은 사람에게 후속 이메일을 보냅니다. 귀하는 FDA 규제를 받은 2개의 임상시험에 대해 FOIA 요청을 제출했습니다. 컨퍼런스 초록을 검색합니다. 무엇을 얻나요?",
              branches: [
                { id: 'd', text: "2개 임상시험에 대한 전체 데이터, 3개 이상의 학회 요약", nextNode: 'partial' },
                { id: 'e', text: "Nothing after 6 months of effort", nextNode: 'nothing' }
              ]
            },
            {
              id: 'partial',
              type: 'outcome',
              consequence: 'good',
              title: "확장된 증거 기반",
              text: "You now have 17 trials with full data + 3 with abstract-level data. Primary analysis uses 17. Sensitivity analysis adds 3 abstract-level estimates. You report: 'Of 23 known trials, 15 were published. We obtained data for 5 additional trials (3 negative). Effect reduced from 0.45 to 0.34.' You've documented the bias and partially corrected it.",
              realCase: "이러한 수준의 노력(시험자에게 연락, FOIA, 학회 검색)은 중요한 항목에 대한 Cochrane 검토의 모범 사례로 간주됩니다. 질문."
            },
            {
              id: 'nothing',
              type: 'outcome',
              consequence: 'neutral',
              title: "문서화된 실패",
              text: "You've exhausted reasonable options. Your review reports: 'We identified 8 unpublished completed trials (33% of known evidence base). Despite multiple contacts and FOIA requests, data could not be obtained. Three trialists confirmed negative results. Our effect estimate is likely inflated.' This is transparent and appropriately cautious.",
              realCase: "실패한 데이터 획득 시도를 문서화하는 것은 가치 있는 일입니다. 이는 독자에게 편견을 알리고 향후 조사자를 위한 기록을 생성합니다."
            },
            {
              id: 'dual',
              type: 'outcome',
              consequence: 'neutral',
              title: "민감도 접근 방식",
              text: "You report published analysis (15 trials, effect=0.45) and a 'worst case' sensitivity analysis assuming the 8 missing trials had null effects (23 trials, effect=0.28). This bounds the plausible effect. You note: 'True effect likely lies between these estimates, probably closer to lower bound given evidence that missing trials had negative results.'",
              realCase: "누락된 데이터에 대한 민감도 분석은 유효한 접근 방식이지만 이는 데이터 복구가 아닌 시뮬레이션이라는 점에 유의해야 합니다."
            }
          ]
        }
      },
      {
        type: 'clinical-guide',
        content: {
          title: "Evidence Hunter의 체크리스트",
          items: [
            "REGISTRIES: Search ClinicalTrials.gov, ISRCTN, WHO ICTRP for completed unpublished trials",
            "CONTACT TRIALISTS: Email corresponding authors of missing trials — many will share data",
            "REGULATORY DATA: FOIA requests to FDA, EMA public assessment reports",
            "CONFERENCES: Search society meeting abstracts (often on Embase)",
            "DISSERTATIONS: ProQuest, institutional repositories",
            "LITIGATION: Drug Industry Document Archive for specific drugs",
            "DOCUMENT EVERYTHING: Record what you searched, what you found, what you couldn't get",
            "간격 보고: 실패한 검색도 유익합니다. 발견한 누락된 임상시험을 보고하세요"
          ]
        }
      },
      {
        type: 'contrast',
        content: {
          title: "두 연구원이 동일한 누락 데이터에 직면함",
          darkSide: {
            header: "연구원 A: 실용주의자",
            items: [
              "Finds 8 unpublished trials on registry",
              "Sends one email to each trialist",
              "Waits 2 weeks, gets no response",
              "게시된 데이터로 진행 only",
              "Reports 'comprehensive search performed'"
            ],
            consequence: "Result: Meta-analysis published showing strong effect (d=0.45). Guidelines cite it. Two years later, unpublished trials surface showing true effect d=0.22. Guidelines have to be revised."
          },
          lightSide: {
            header: "연구원 B: 형사",
            items: [
              "Finds same 8 unpublished trials",
              "Sends 3 follow-up emails over 3 months",
              "Files FOIA requests for FDA-regulated trials",
              "Searches conference abstracts manually",
              "Obtains 5 of 8 datasets (3 negative)"
            ],
            consequence: "Result: Meta-analysis published showing modest effect (d=0.28) with full transparency about missing data. Guidelines cite conservative estimate. No future revision needed."
          }
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "가이드라인 작성자의 딜레마",
          situation: "You're writing clinical guidelines for a treatment. The meta-analysis shows benefit (OR 0.70, p=0.001), but Egger's test is significant (p=0.03) and you've identified 6 unpublished trials on registries. The treatment is already widely used. What do you recommend?",
          nodes: [
            {
              id: 'start',
              question: "증거는 유효성을 보여주지만 출판 편향 가능성이 높습니다. 가이드라인에는 어떤 내용이 포함되나요?",
              branches: [
                { id: 'a', text: "Strong recommendation — the meta-analysis shows clear benefit", nextNode: 'strong' },
                { id: 'b', text: "편향 우려에 대한 주의 사항이 포함된 조건부 권장 사항", nextNode: 'conditional' },
                { id: 'c', text: "추가 증거를 기다리세요. 현재 증거는 신뢰할 수 없습니다.", nextNode: 'await' }
              ]
            },
            {
              id: 'strong',
              type: 'outcome',
              consequence: 'bad',
              title: "오버 커밋된 가이드라인",
              text: "귀하의 강력한 권장 사항이 널리 채택되도록 유도합니다. 그러나 실제 효과(미공개 데이터 포함)는 제안된 공개 증거보다 훨씬 약합니다. 환자는 미미한 이익만 받는 치료를 받지만 실제로는 해를 끼칩니다. 진실이 밝혀지면 지침의 신뢰성이 손상됩니다.",
              realCase: "이 패턴은 타미플루에서 나타났습니다. 편향된 출판 증거, 비축량에 지출된 수십억 달러, Cochrane의 전체 데이터 분석을 기반으로 한 강력한 지침 권장 사항은 최소한의 이점을 보여주었습니다."
            },
            {
              id: 'conditional',
              question: "조건부 권장 사항을 작성합니다. 불확실성을 어떻게 전달합니까?",
              branches: [
                { id: 'd', text: "Note 'low certainty evidence' using GRADE, mention bias concerns briefly", nextNode: 'grade' },
                { id: 'e', text: "Full transparency: report both published and bias-adjusted estimates, explain missing trials", nextNode: 'transparent' }
              ]
            },
            {
              id: 'grade',
              type: 'outcome',
              consequence: 'neutral',
              title: "표준 접근 방식",
              text: "You downgrade for publication bias per GRADE. Your recommendation reads: 'Conditional recommendation, low certainty evidence.' But many readers don't understand what this means. Clinicians may still interpret it as 'probably works.' The nuance is lost.",
              realCase: "연구에 따르면 GRADE 확실성 등급이 종종 잘못 해석되는 것으로 나타났습니다. '낮은 확실성'은 우려 정도를 적절하게 전달하지 않습니다."
            },
            {
              id: 'transparent',
              type: 'outcome',
              consequence: 'good',
              title: "완전한 정보 제공 지침",
              text: "Your guideline states: 'Published trials suggest OR 0.70. However, we identified 6 unpublished trials and funnel plot asymmetry suggests the true effect may be weaker. Adjusted estimates range from OR 0.70-0.85. Until full data are available, benefits should not be overstated.' Clinicians can make informed decisions.",
              realCase: "이러한 투명한 접근 방식이 점점 더 권장되고 있습니다. 2023 PRISMA-P 지침은 모든 편견 평가와 그 영향을 보고하는 것을 강조합니다."
            },
            {
              id: 'await',
              type: 'outcome',
              consequence: 'neutral',
              title: "보수적 입장",
              text: "Your guideline states: 'Insufficient evidence due to likely publication bias.' But the treatment is already widely used. Clinicians continue prescribing without guidance. Your conservative stance may be scientifically correct but practically unhelpful. Sometimes imperfect guidance is better than no guidance.",
              realCase: "완벽한 증거를 기다리는 것과 시기적절한 지침을 제공하는 것 사이에는 긴장이 있습니다. 핵심은 침묵이 아니라 투명한 불확실성 의사소통입니다."
            }
          ]
        }
      },
      {
        type: 'oath',
        content: {
          header: "증거 사냥꾼의 맹세",
          text: "I will not stop at the published literature.<br><strong>I will search the registries, contact the trialists, petition the regulators.</strong><br><br>I will document my search — what I found and what I could not find.<br>For the studies I cannot obtain are as important as those I can.<br><br>The buried evidence has a voice.<br><strong>I will be the one who listens.</strong>"
        }
      },
      {
        type: 'cycle-return',
        content: {
          principle: "가상적인 열 개의 연구를 전가하는 것보다 묻혀 있는 연구 하나를 찾는 것이 더 낫습니다. 레지스트리를 검색하는 형사는 통계만 실행하는 백 명의 가치가 있습니다."
        }
      },
      {
        type: 'quiz',
        content: {
          question: "You find that 40% of registered trials for your intervention have no published results 5 years after completion. This most likely indicates:",
          options: [
            { id: 'a', text: "재판은 여전히 진행 중입니다", correct: false },
            { id: 'b', text: "결과가 부정적이거나 흥미롭지 않아 게시되지 않았습니다.", correct: true },
            { id: 'c', text: "레지스트리 정보가 잘못되었습니다", correct: false },
            { id: 'd', text: "재판이 다른 이름으로 게시되었습니다. 이름", correct: false }
          ],
          explanation: "Ross et al. found that non-publication 5 years after trial completion is strongly associated with negative/null results. Positive trials are published faster and more often. While some explanation (name changes, delayed publication) may apply to individual trials, systematic non-publication at this rate indicates publication bias. The published literature for this intervention is likely inflated."
        }
      },
      {
        type: 'protagonist-story',
        content: {
          name: "Dr. Tom Jefferson",
          role: "Cochrane 연구원 및 증거 수집기",
          narrative: "Tom Jefferson spent years trying to get the complete clinical trial data for Tamiflu (oseltamivir). Despite Roche's claims of efficacy, when Jefferson and the Cochrane team finally obtained the full clinical study reports (35,000+ pages) through regulatory requests and persistent advocacy, they found the drug's benefits were far more modest than published papers suggested, and harms were understated.",
          quote: "우리는 여러 국가의 규제 기관에 67개의 개별 요청을 제출해야 했습니다. 회사는 매 순간 우리와 싸웠습니다. 그러나 그들이 우리에게 보여주고 싶지 않은 데이터는 그들이 게시한 데이터와는 매우 다른 이야기를 들려줍니다.",
          impact: "Cochrane oseltamivir 검토는 글로벌 비축 권장 사항을 변경하고 임상 시험 투명성의 개혁을 촉발했습니다. 지속적인 증거 수집이 확립된 의학적 합의를 뒤집을 수 있다는 것이 입증되었습니다."
        }
      },
      {
        type: 'key-takeaways',
        content: {
          takeaways: [
            "ClinicalTrials.gov 및 WHO ICTRP는 시작된 것과 게시된 것을 공개합니다.",
            "FOIA/EMA 요청은 저널 초록뿐만 아니라 전체 임상 연구 보고서에 액세스할 수 있습니다.",
            "시험자에게 직접 연락하세요. 질문 시 응답률은 ~50%입니다. 미출판 데이터에 대해서는 정중하게",
            "Grey literature (conference abstracts, dissertations, regulatory documents) contains valuable hidden evidence",
            "검색 전략을 문서화하세요. 찾지 못한 것이 찾은 것만큼 중요합니다."
          ],
          actionItem: "다음 번 체계적 검토 전에 '레지스트리 검색'과 '시험의자 연락처'를 프로토콜의 필수 단계로 추가하세요. 규제 요청에 대한 예산 시간."
        }
      }
    ]
  },

  // MODULE 6: THE CAPSTONE
  {
    id: 6,
    title: "The Capstone",
    subtitle: "Integration",
    estimatedMinutes: 30,
    slides: [
      {
        type: 'learning-objectives',
        content: {
          intro: "By the end of this module, you will be able to:",
          objectives: [
            "모든 출판 편견 탐지 방법을 일관된 평가에 통합",
            "출판 편견 탐지의 5가지 원칙 적용",
            "Make ethical decisions when encountering evidence of suppression",
            "출판 편견에 대한 불확실성을 환자와 동료에게 전달",
            "출판 편견을 해결하기 위한 개인 실행 계획 개발 작업"
          ]
        }
      },
      {
        type: 'title',
        content: {
          title: "The Capstone",
          subtitle: "전체 조사",
          text: "숨겨진 것을 보고, 의심스러운 것을 테스트하고, 추정치를 조정하고, 묻힌 것을 사냥하는 방법을 배웠습니다. 이제 이 기술들을 하나로 모아 보세요."
        }
      },
      {
        type: 'content',
        content: {
          title: "출판 편향 탐정의 5가지 원칙",
          sections: [
            {
              heading: "I. 부재원리",
              items: ["증거가 없다는 것은 부재의 증거가 아니라 억제의 증거일 수 있습니다."]
            },
            {
              heading: "II. 가시성 원칙",
              items: ["What is hidden shapes belief as powerfully as what is shown."]
            },
            {
              heading: "III. 비대칭 원리",
              items: ["퍼널은 숲이 숨기고 있는 것, 즉 출판된 것의 형태와 그렇지 않은 것의 그림자를 드러냅니다."]
            },
            {
              heading: "IV. 불확정성 원리",
              items: ["눈으로 의심하지만 테스트를 통해 정량화됩니다. 그러나 실제로 무슨 일이 일어났는지 확인할 수 있는 테스트는 없으며, 데이터가 시사하는 바만 알 수 있습니다."]
            },
            {
              heading: "V. 복구 원칙",
              items: ["Better to find one buried study than to impute ten imaginary ones."]
            }
          ]
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "FINAL CASE",
          title: "완전한 조사: Oseltamivir(타미플루)",
          source: "Jefferson 외, Cochrane 2014 — 숨겨진 데이터를 위한 4년간의 전투",
          timeline: [
            { year: "2009", text: "Cochrane begins review of neuraminidase inhibitors (Tamiflu, Relenza). Published trials suggest efficacy. Governments stockpile $billions worth.", type: "normal" },
            { year: "The Suspicion", text: "Cochrane 저자 공지: 환자 데이터의 60%는 미공개 제조업체에서 나왔습니다. 시련. 출판된 논문은 대필되었습니다. 데이터 요청이 거부되었습니다.", type: "normal" },
            { year: "2009-2012", text: "BMJ 캠페인: '데이터 공개' Roche에 임상 연구 보고서를 반복적으로 요청했습니다. 수년간의 거부와 협상.", type: "buried" },
            { year: "2013", text: "EMA grants access to regulatory documents. Roche finally releases 77 clinical study reports — 22,000 pages.", type: "revealed" },
            { year: "The Truth", text: "전체 데이터에 따르면 타미플루는 증상 기간을 최대 17시간('일'이 아님)까지 줄였습니다. 폐렴 예방에 대한 증거가 없습니다(주장된 병원 혜택). 메스꺼움/구토가 증가합니다. WHO는 '필수'에서 '보완'으로 등급을 낮췄습니다.", type: "revealed" }
          ],
          realData: {
            publishedClaim: "폐렴 및 입원 감소",
            fullDataReality: "폐렴 예방에 대한 증거 없음",
            symptomBenefit: "~17 hours symptom reduction",
            harms: "Increased nausea, vomiting, headache",
            stockpileWaste: "Billions in government stockpiles of overstated benefit"
          }
        }
      },
      {
        type: 'statistic-card',
        content: {
          value: "4 Years",
          label: "공개되어야 하는 임상 연구 보고서 얻기",
          context: "The delay cost billions in misallocated pandemic preparedness"
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "Reading a Meta-Analysis: The Bias Detective's Checklist",
          situation: "A colleague sends you a meta-analysis showing that a new intervention significantly reduces mortality (OR 0.65, 95% CI 0.52-0.81, p<0.001). They want to change clinical practice based on this. Before agreeing, what do you check?",
          nodes: [
            {
              id: 'start',
              question: "메타 분석은 인상적인 결과를 보여줍니다. 첫 번째 질문은 무엇입니까?",
              branches: [
                { id: 'a', text: "포함된 연구 수는 몇 개입니까?", nextNode: 'studies' },
                { id: 'b', text: "출판 편향이 평가되었습니까?", nextNode: 'bias_check' },
                { id: 'c', text: "미발표 시험에 대해 시험 등록소를 검색했습니까?", nextNode: 'registry' }
              ]
            },
            {
              id: 'studies',
              question: "메타 분석에는 8개의 연구가 포함됩니다. 이것이 편향 평가에 의미하는 바는 무엇입니까?",
              branches: [
                { id: 'd', text: "Too few for reliable Egger's test — visual assessment only", nextNode: 'few_studies' },
                { id: 'e', text: "Enough for full bias assessment", nextNode: 'wrong_enough' }
              ]
            },
            {
              id: 'few_studies',
              type: 'outcome',
              consequence: 'good',
              title: "제한 사항을 올바르게 식별했습니다",
              text: "With only 8 studies, statistical tests for publication bias (Egger's, Begg's) have very low power. A non-significant test does NOT mean no bias. You should rely more on: (1) Visual funnel plot assessment, (2) Registry searches for unpublished trials, (3) Assessment of whether all studies are positive (suspicious). Statistical tests can neither confirm nor rule out bias.",
              realCase: "코크란 지침에 따르면 연구가 10개 미만인 경우 깔때기 플롯 비대칭 테스트를 사용해서는 안 됩니다."
            },
            {
              id: 'wrong_enough',
              type: 'outcome',
              consequence: 'bad',
              title: "Overconfident in Tests",
              text: "8개의 연구가 Egger 테스트에 권장되는 최소 10개보다 적습니다. 연구가 너무 적기 때문에 이 테스트는 위음성 비율이 높습니다. 즉, 실제 편향을 놓치는 경우가 많습니다. 8개 연구를 대상으로 한 중요하지 않은 테스트에서 '편향 없음'이라는 결론을 내리는 것은 타당하지 않습니다. 다른 방법을 사용해야 합니다.",
              realCase: "시뮬레이션에 따르면 Egger의 테스트는 10개의 연구에서 중간 정도의 편향을 탐지할 수 있는 검정력이 ~50%에 불과하고, 그 수가 적을 경우에는 더 적은 검정력을 가집니다."
            },
            {
              id: 'bias_check',
              question: "The methods section says 'Publication bias was assessed using Egger's test (p=0.34)'. What's your concern?",
              branches: [
                { id: 'f', text: "좋습니다. 편향을 테스트했지만 아무 것도 발견하지 못했습니다.", nextNode: 'false_assurance' },
                { id: 'g', text: "A non-significant test doesn't prove no bias — what else did they do?", nextNode: 'deeper' }
              ]
            },
            {
              id: 'false_assurance',
              type: 'outcome',
              consequence: 'bad',
              title: "잘못된 보증",
              text: "A non-significant Egger's test does NOT prove absence of bias. It means the test failed to detect asymmetry — which could be because there's no bias, OR because the test lacked power, OR because bias exists but isn't reflected in asymmetry. You need additional information: funnel plot inspection, registry search, assessment of study characteristics.",
              realCase: "많은 메타 분석에서는 깔때기 없이 Egger의 p-값만 보고합니다. 플롯 또는 레지스트리 검색. 이는 편향 평가에 충분하지 않습니다."
            },
            {
              id: 'deeper',
              type: 'outcome',
              consequence: 'good',
              title: "적절한 회의론",
              text: "You ask the right follow-up questions: Did they search trial registries? Did they show the funnel plot? Did they compare industry vs. independent trials? Did they contact authors of conference abstracts that never became papers? A single statistical test is the minimum, not the full assessment.",
              realCase: "Best practice includes: visual funnel plot, statistical tests, registry search, comparison by funding source, and contact with trialists."
            },
            {
              id: 'registry',
              type: 'outcome',
              consequence: 'good',
              title: "탐정의 첫 번째 질문",
              text: "Registry searches are the most direct way to identify missing evidence. You check: Did the authors search ClinicalTrials.gov? Did they report how many registered trials had no published results? Did they try to obtain unpublished data? If they didn't search registries, the bias assessment is incomplete regardless of statistical tests.",
              realCase: "Turner의 획기적인 연구에 따르면 레지스트리 검색을 통해 통계 테스트에서는 탐지할 수 없는 상당한 미공개 증거를 식별할 수 있다는 사실이 밝혀졌습니다."
            }
          ]
        }
      },
      {
        type: 'contrast',
        content: {
          title: "Two Readers of the Same Meta-Analysis",
          darkSide: {
            header: "비비판적 Reader",
            items: [
              "Sees: 'OR 0.65, p<0.001, significant'",
              "Checks: 'Egger's p=0.34, no bias detected'",
              "Concludes: 'Strong evidence, change practice'",
              "Skips: Funnel plot, registry section, limitations",
              "Tells colleagues: 'The meta-analysis proves it works'"
            ],
            consequence: "결과: 부풀려진 증거에 기초한 치료법을 채택했습니다. 나중에 미발표 시험에서 무효 효과가 나타났다는 사실을 알게 되었습니다. '입증된' 치료법이 왜 도움이 되지 않았는지 환자에게 설명해야 합니다."
          },
          lightSide: {
            header: "출판 편향 탐정",
            items: [
              "Sees same numbers, asks: 'What's missing?'",
              "Examines funnel plot: 'Gap in bottom-left'",
              "Checks registry search: 'None reported'",
              "Notes: 'All 8 trials industry-funded, all positive'",
              "Tells colleagues: 'Likely inflated, await independent data'"
            ],
            consequence: "Result: Maintains appropriate uncertainty. When full data emerge showing weaker effect, no surprise. Patients received honest communication about uncertainty from the start."
          }
        }
      },
      {
        type: 'oath',
        content: {
          header: "증거를 신뢰하는 환자에 의해",
          text: "For every inflated effect size, there was a patient who expected more benefit than they received.<br><br>For every buried negative trial, there was a patient who received a treatment that did not work.<br><br>For every spin, there was a doctor who believed what they read.<br><br><strong>The detective remembers: Numbers are not abstractions. They guide treatment. They shape lives.</strong><br><br>Vigilance in evidence assessment is not pedantry — it is care."
        }
      },
      {
        type: 'case-file',
        content: {
          caseNumber: "MEMORIAL CASE",
          title: "숫자 뒤에 숨겨진 얼굴",
          source: "Multiple sources — The Human Cost of Publication Bias",
          timeline: [
            { year: "Reboxetine", text: "환자가 복용한 약 출판물에서는 효과적인 것으로 나타났지만 전체 데이터에서는 아무런 이점도 보이지 않았습니다. 위약 효과와 부작용으로 수년간 치료를 받았지만 더 나은 옵션이 존재했습니다.", type: "buried" },
            { year: "Vioxx", text: "26,000-55,000명의 초과 사망자. 안전 신호가 누락된 의사, 출판된 문헌을 믿었던 사람들의 심장마비.", type: "buried" },
            { year: "Study 329", text: "안전하다고 주장하는 대필 문서를 바탕으로 어린이에게 파록세틴을 투여했습니다. 자살 사건이 8배 증가했지만 이는 숨겨져 있었습니다. 거짓말을 한 신문으로 인해 청소년이 피해를 입습니다.", type: "buried" },
            { year: "DECREASE", text: "조작된 데이터를 기반으로 한 지침에 따르면 유럽에서는 연간 최대 10,000명의 사망자가 발생합니다. 사기성 연구자가 증거를 발명했기 때문에 수술 전에 환자에게 베타 차단제를 투여했습니다.", type: "buried" },
            { year: "Avandia", text: "83,000건의 초과 심장마비. 회사가 심혈관 위험을 알고 있는 동안 7년 동안 처방을 했습니다. 출판된 문헌에는 아무 문제가 없었습니다.", type: "buried" }
          ],
          realData: {
            totalEstimatedDeaths: "이 과정에서만 100,000건 이상의 사례",
            commonThread: "체계적으로 불완전한 증거가 공개되었습니다",
            responsibility: "Distributed — companies, journals, regulators, researchers",
            prevention: "Vigilant detection, transparency demands, systematic searching"
          }
        }
      },
      {
        type: 'death-toll',
        content: {
          number: "100,000+",
          label: "이 과정에서 다루는 사례의 보수적인 사망 추정치",
          source: "Vioxx (26-55k) + DECREASE (~10k/yr × several years) + Avandia (unknown fraction of 83k MIs) + others"
        }
      },
      {
        type: 'decision-tree',
        content: {
          title: "다음 단계: 어떻게 하시겠습니까? 하시겠습니까?",
          situation: "이 과정을 완료했습니다. 이제 출판 편견을 확인하고, 테스트하고, 조정하고, 숨겨진 증거를 찾을 수 있습니다. 그러나 행동이 없는 지식은 아무것도 바꾸지 못합니다. 배운 내용으로 무엇을 하시겠습니까?",
          nodes: [
            {
              id: 'start',
              question: "출판 편향 탐정의 기술을 배웠습니다. 이를 어떻게 사용하시겠습니까?",
              branches: [
                { id: 'a', text: "In my own research — I'll be more vigilant about bias in literature I read", nextNode: 'personal' },
                { id: 'b', text: "As a reviewer — I'll demand better bias assessment in papers I review", nextNode: 'reviewer' },
                { id: 'c', text: "As an advocate — I'll push for transparency in my institution/field", nextNode: 'advocate' }
              ]
            },
            {
              id: 'personal',
              question: "개인적으로 경계할 것을 약속합니다. 이를 어떻게 구현하시겠습니까?",
              branches: [
                { id: 'd', text: "Check funnel plots and bias assessments in every meta-analysis I read", nextNode: 'personal_good' },
                { id: 'e', text: "Search registries when making treatment decisions based on published evidence", nextNode: 'personal_great' }
              ]
            },
            {
              id: 'personal_good',
              type: 'outcome',
              consequence: 'good',
              title: "정보가 풍부한 소비자",
              text: "You become a critical reader of evidence. When a meta-analysis claims strong effects, you check: How many studies? Funnel plot shape? Registry search? This protects your patients from inflated claims. One alert clinician at a time, the distortion loses power.",
              realCase: "개인의 경계가 중요합니다. 더 많은 독자가 레복세틴 메타 분석에 의문을 제기했다면 해당 약물은 더 일찍 면밀히 조사되었을 것입니다."
            },
            {
              id: 'personal_great',
              type: 'outcome',
              consequence: 'good',
              title: "활동적인 조사자",
              text: "진료 방식을 변경하기 전에 ClinicalTrials.gov를 직접 검색하십시오. 메타 분석에서 누락된 미출판 시험을 발견했습니다. 데이터를 얻기 위해 시험 참가자에게 이메일을 보냅니다. 당신은 이 과정을 통해 훈련받은 형사가 됩니다. 귀하의 환자는 게시된 부분뿐만 아니라 완전한 증거를 기반으로 치료를 받습니다.",
              realCase: "Clinicians who check registries before adopting new treatments are rare but invaluable. They catch problems before guidelines do."
            },
            {
              id: 'reviewer',
              question: "동료 검토자로서 귀하는 게시할 내용을 결정할 수 있습니다. 무엇이 필요합니까?",
              branches: [
                { id: 'f', text: "Demand funnel plots and Egger's tests in all meta-analyses", nextNode: 'reviewer_minimum' },
                { id: 'g', text: "Require registry searches and documentation of unpublished trials", nextNode: 'reviewer_thorough' }
              ]
            },
            {
              id: 'reviewer_minimum',
              type: 'outcome',
              consequence: 'neutral',
              title: "통계 관리자",
              text: "검토하는 모든 메타 분석에는 편향 평가가 필요합니다. 작성자는 이제 퍼널 플롯을 포함합니다. 그러나 레지스트리 검색이 없으면 통계 테스트에서는 문제의 일부만 감지할 수 있습니다. 최소한의 기준(의미 있는 기여)을 높였지만 더 깊은 문제는 여전히 남아 있습니다.",
              realCase: "Many journals now require bias assessment. Compliance has improved. But quality of assessment varies widely."
            },
            {
              id: 'reviewer_thorough',
              type: 'outcome',
              consequence: 'good',
              title: "철저한 게이트키퍼",
              text: "You require: (1) Registry search with documentation of found/not found trials, (2) Contact attempts with trialists, (3) Comparison of published vs. registry-reported outcomes, (4) GRADE assessment incorporating bias risk. You reject meta-analyses that claim 'no publication bias' based on Egger's test alone. Standards rise.",
              realCase: "Cochrane의 표준은 전 세계적으로 체계적인 검토에 대한 기준을 높였습니다. 높은 기준을 적용하는 개별 검토자는 체계적 변화를 만들어냅니다."
            },
            {
              id: 'advocate',
              question: "체계적 투명성을 추구합니다. 옹호 활동에 중점을 두시겠습니까?",
              branches: [
                { id: 'h', text: "AllTrials 및 필수 결과 보고 지원", nextNode: 'advocate_policy' },
                { id: 'i', text: "Push my institution to adopt data sharing policies", nextNode: 'advocate_local' },
                { id: 'j', text: "다른 사람들을 교육하여 동료와 학생들에게 이러한 기술을 전파하십시오", nextNode: 'advocate_teach' }
              ]
            },
            {
              id: 'advocate_policy',
              type: 'outcome',
              consequence: 'good',
              title: "정책 옹호자",
              text: "AllTrials에 서명하십시오. 재판 투명성에 대해 의원들에게 편지를 보냅니다. 귀하는 FDAAA 시행을 지지합니다. 여러분은 수천 명의 목소리 중 하나입니다. 하지만 수천 명의 목소리가 정치적 의지를 만들어냅니다. 결과 보고를 요구하는 2007년 법률은 옹호자들의 요구로 인해 발생했습니다. 다음 개선에는 여러분이 필요합니다.",
              realCase: "AllTrials는 90,000개 이상의 서명을 수집하고 EMA 정책에 영향을 미쳤습니다. 개인의 목소리가 합쳐져 ​​정치적 힘이 됩니다."
            },
            {
              id: 'advocate_local',
              type: 'outcome',
              consequence: 'good',
              title: "기관 챔피언",
              text: "You push your hospital/university to require data sharing for all trials conducted there. You advocate for pre-registration policies. You work with the IRB to include transparency requirements. One institution at a time, the culture shifts. When everyone around you expects transparency, suppression becomes harder.",
              realCase: "이제 많은 학술 의료 센터에서 사전 등록과 결과 보고를 요구합니다. 이러한 정책은 내부 옹호에서 나왔습니다."
            },
            {
              id: 'advocate_teach',
              type: 'outcome',
              consequence: 'good',
              title: "The Multiplier",
              text: "You teach this course to your residents. You present at grand rounds. You write blog posts explaining funnel plots. Every person you train becomes another detective. The skills spread exponentially. One teacher creates hundreds of vigilant readers. This is how paradigms shift — one learner at a time, until critical mass is reached.",
              realCase: "근거 기반 의학 운동은 교육을 통해 확산되었습니다. 출판 편견에 대한 인식도 같은 방식으로 확산되고 있습니다. 가속화할 수 있습니다."
            }
          ]
        }
      },
      {
        type: 'contrast',
        content: {
          title: "Two Futures",
          darkSide: {
            header: "지속적인 침묵의 미래",
            items: [
              "Researchers continue hiding negative trials",
              "Journals continue rejecting null results",
              "Meta-analyses continue to inflate effects",
              "Guidelines continue to be based on incomplete evidence",
              "Patients continue receiving treatments that don't work",
              "다음 Vioxx가 일어나고, 다음, 다음이 발생합니다."
            ],
            consequence: "아무것도 변하지 않으면 미래. 억압과 피해의 악순환이 계속됩니다. 출판 편향에 대한 지식은 학문적이며 실행 가능하지 않습니다."
          },
          lightSide: {
            header: "경계 탐지의 미래",
            items: [
              "Detectives check every meta-analysis for bias",
              "Reviewers demand registry searches before acceptance",
              "Clinicians verify evidence before changing practice",
              "Advocates push for transparency at every level",
              "Teachers spread the skills of detection",
              "억제 비용은 이익을 초과할 때까지 증가합니다"
            ],
            consequence: "행동하는 경우의 미래. 각 형사, 각 검토자, 각 옹호자는 균형을 바꿉니다. 출판 편향은 점점 더 어려워지고, 위험해지고, 수익성이 낮아집니다. 진실은 빛을 찾습니다."
          }
        }
      },
      {
        type: 'oath',
        content: {
          header: "최종 약속",
          text: "I have learned to see what is hidden.<br>I have learned to test my suspicions.<br>I have learned to hunt for buried evidence.<br><br><strong>I will not let this knowledge remain unused.</strong><br><br>I will check the funnels. I will search the registries.<br>I will ask the questions no one wants asked.<br>I will document what I find and what I cannot find.<br><br><strong>I will be the detective the evidence needs.</strong>"
        }
      },
      {
        type: 'principle',
        content: {
          number: "OATH",
          text: "I will not accept the published literature as truth without investigation.\n\nI will look for what is hidden as carefully as I examine what is shown.\n\nI will test my suspicions statistically, but never mistake the test for certainty.\n\nI will hunt for buried evidence rather than impute imaginary studies.\n\nI will report what I find and what I cannot find — both are evidence.\n\nI will remember that behind every missing study are patients whose treatment was decided on incomplete evidence."
        }
      },
      {
        type: 'rhetoric',
        content: {
          question: "그리고 이 모든 것을 배웠을 때 — 퍼널의 비대칭성을 볼 수 있고, 통계 테스트의 속삭임을 듣고, 아카이브를 통해 탐정처럼 레지스트리를 검색할 수 있을 때 — 이 지식으로 무엇을 하시겠습니까? 침묵하시겠습니까, 아니면 말하시겠습니까?"
        }
      },
      {
        type: 'cycle-return',
        content: {
          principle: "당신은 탐지를 배우러 왔습니다. 당신은 탐지가 시작에 불과하다는 것을 알고 떠납니다. 진실을 찾는 탐정은 진실을 알리기 위해 싸워야 합니다. 결코 빛을 보지 못한 증거는 그것을 현실로 가져올 때만 치유될 수 있습니다."
        }
      },
      {
        type: 'redemption-story',
        content: {
          title: "Johnson & Johnson's DePuy Hip Implant Recall",
          narrative: "Not all stories of hidden data end in regulatory punishment. In 2010, Johnson & Johnson voluntarily recalled its DePuy ASR hip replacement system after internal analysis revealed higher-than-expected failure rates. While critics noted the recall came late (after ~93,000 implants), the company ultimately shared its internal data, funded revision surgeries, and established a patient monitoring registry. The DePuy case shows that companies CAN choose transparency when internal evidence shows harm — and that this path, while costly, is less destructive than prolonged concealment.",
          lesson: "불완전하더라도 피해를 발견한 후의 투명성은 피해를 제한하고 신뢰를 회복하기 시작합니다. Vioxx(머크가 수년 동안 데이터를 은폐했다고 주장함)와의 대조는 불편한 증거에 대한 기업의 두 가지 가능한 대응을 보여줍니다. 둘 다 비용이 많이 들지만 하나는 과학적 무결성을 유지합니다."
        }
      },
      {
        type: 'practice-case',
        content: {
          title: "기술 적용",
          scenario: "You're reviewing a meta-analysis of a new diabetes drug. The authors report OR = 0.65 (95% CI: 0.52-0.81) for cardiovascular events, based on 12 trials. They state 'Egger's test was non-significant (p=0.34), indicating no publication bias.' The funnel plot shows slight asymmetry in the lower-left. Registry search shows 18 trials were registered for this drug.",
          data: {
            headers: ["Study", "Effect (log OR)", "SE", "Published"],
            rows: [
              ["ADVANCE-1", "-0.52", "0.15", "Yes"],
              ["CARDIO-2", "-0.48", "0.18", "Yes"],
              ["SAFE-3", "-0.35", "0.22", "Yes"],
              ["TRIAL-4", "-0.61", "0.12", "Yes"],
              ["MULTI-5", "-0.28", "0.25", "Yes"],
              ["PILOT-6", "-0.41", "0.20", "Yes"],
              ["REG-7 to REG-18", "???", "???", "No (6 registered, no results)"]
            ]
          },
          questions: [
            "What concerns does the registry search raise?",
            "왜 중요하지 않은 Egger의 테스트가 안심할 수 없는 이유는 무엇입니까?",
            "이 효과 추정을 수락하기 전에 무엇을 권장하시겠습니까?"
          ],
          answers: [
            "18 registered trials but only 12 published = 33% missing. This gap strongly suggests selective publication. The 6 missing trials likely had less favorable results.",
            "Egger의 테스트 12개 연구로 검정력이 낮습니다. 중요하지 않은 결과는 편향을 배제하지 않습니다. 이는 테스트에서 이를 감지할 수 없다는 의미입니다. 시각적 비대칭이 존재합니다. 시각적 비대칭 + 등록 공백의 조합은 Egger의 테스트가 안심시키는 것보다 더 우려스럽습니다.",
            "발표되지 않은 6개 임상시험의 연구자에게 문의하세요. 규제 데이터에 대한 요청을 제출하세요. 민감도 분석으로 다듬기 및 채우기 및 PET-PEESE를 실행합니다. GRADE 평가의 확실성을 다운그레이드합니다. 점추정을 신뢰할 수 있는 것으로 받아들이지 마십시오."
          ]
        }
      },
      {
        type: 'printable-checklist',
        content: {
          title: "Publication Bias Assessment Checklist",
          sections: [
            {
              heading: "1. Visual Assessment",
              items: [
                "Examine funnel plot for symmetry",
                "Note location of any gaps (significance regions?)",
                "Check if small studies cluster on one side",
                "Consider contour-enhanced funnel if available"
              ]
            },
            {
              heading: "2. Statistical Tests",
              items: [
                "Report Egger's test with p-value (threshold: p<0.10)",
                "Note number of studies (tests unreliable with <10)",
                "Report Begg's test if available",
                "Check if visual and statistical findings agree"
              ]
            },
            {
              heading: "3. Registry Search",
              items: [
                "Search ClinicalTrials.gov for intervention",
                "Search WHO ICTRP for international trials",
                "Compare registered vs. published trial count",
                "Document completion dates of unpublished trials"
              ]
            },
            {
              heading: "4. Additional Investigation",
              items: [
                "미공개 데이터는 시험 참가자에게 문의하세요",
                "Search conference abstracts and grey literature",
                "Check regulatory documents (FDA, EMA)",
                "Compare published outcomes to registered outcomes"
              ]
            },
            {
              heading: "5. Sensitivity Analysis",
              items: [
                "Run trim-and-fill and report adjusted estimate",
                "10개 이상의 연구를 이용할 수 있는 경우 PET-PEES 실행",
                "Calculate Fail-Safe N as heuristic",
                "Consider selection model if appropriate"
              ]
            },
            {
              heading: "6. Interpretation & Reporting",
              items: [
                "Document all searches (dates, terms, results)",
                "발견되지 않은 것과 발견된 것을 보고하십시오.",
                "Adjust GRADE certainty based on bias assessment",
                "State conclusions cautiously if bias suspected"
              ]
            }
          ]
        }
      },
      {
        type: 'content',
        content: {
          title: "Reporting Standards: PRISMA-PB and PROSPERO",
          sections: [
            {
              heading: "PRISMA Extension for Publication Bias (PRISMA-PB)",
              items: [
                "체크리스트 항목 15: 누락으로 인한 편향 위험을 평가하는 데 사용되는 방법을 설명하십시오. 결과",
                "Checklist item 22: Present assessments of risk of bias due to missing results",
                "Requires explicit statement about registry searches conducted",
                "발견된 연구 수와 이유가 포함된 수를 보고해야 합니다"
              ]
            },
            {
              heading: "PROSPERO Registration",
              items: [
                "검색을 시작하기 전에 체계적인 검토를 등록하세요",
                "출판 편향 평가 방법을 미리 지정하세요",
                "Prevents selective reporting of bias assessments (ironic!)",
                "Available free at: crd.york.ac.uk/prospero"
              ]
            },
            {
              heading: "GRADE Assessment for Publication Bias",
              items: [
                "Rate DOWN one level if publication bias strongly suspected",
                "Consider: funnel asymmetry, registry gaps, industry funding pattern",
                "Document reasoning in GRADE evidence profile",
                "Even with bias-corrected estimates, uncertainty warrants downgrade"
              ]
            }
          ]
        }
      },
      {
        type: 'patient-communication',
        content: {
          scenario: "환자가 온라인에서 연구가 '숨겨졌다'고 읽은 후 약물 치료를 중단하고 싶어합니다. '편향됨'.",
          script: "I understand your concern — you've read that some studies may not have been published, and that's a real issue in medicine. Let me explain what we know: while publication bias can inflate how well drugs appear to work, it doesn't mean treatments don't work at all. For your medication specifically, we have [X evidence]. The benefits we've seen in your case — [specific improvements] — are real. Let's review together whether continuing makes sense for you, but I wouldn't recommend stopping abruptly based on general concerns about bias.",
          keyPoints: [
            "Validate the concern — publication bias IS real",
            "Distinguish between inflated effects vs. no effects",
            "Ground discussion in patient's specific experience",
            "Avoid dismissing patient's research efforts",
            "Offer shared decision-making, not paternalism"
          ]
        }
      },
      {
        type: 'patient-communication',
        content: {
          scenario: "동료가 메타 분석을 바탕으로 새로운 치료법을 추천했습니다. 깔때기 도표가 비대칭이고 레지스트리에 누락된 임상시험이 표시되는 것을 발견했습니다.",
          script: "Thanks for sharing this — it's an interesting option. I took a look at the meta-analysis and noticed a few things that give me pause. The funnel plot shows some asymmetry in the lower-left, and when I checked ClinicalTrials.gov, I found [X] registered trials that don't appear in the analysis. That pattern often indicates publication bias. The effect might be real, but probably smaller than the 40% reduction they report. Want to look at the registry data together? I think we should be cautious about changing our practice based on this until we understand what's missing.",
          keyPoints: [
            "비판이 아닌 감사의 마음으로 진행하세요",
            "발견한 내용을 구체적으로 설명하세요(모호한 회의론 아님)",
            "증거를 함께 검토하겠다고 제안하세요(협력)",
            "'연구가 틀렸다' — '효과가 부풀려질 수 있다'라고 말합니다",
            "Suggest appropriate caution, not rejection"
          ]
        }
      },
      {
        type: 'content',
        content: {
          title: "Questions Patients Can Ask Their Doctor",
          sections: [
            {
              heading: "치료 증거 정보",
              items: [
                "이 치료를 뒷받침하는 연구는 얼마나 됩니까? 모두 출판되었나요?",
                "제약회사에서 연구 자금을 지원했습니까? 독립적인 임상시험이 있었나요?",
                "이 권장 사항은 체계적인 검토를 기반으로 합니까? 출판 편향을 확인했나요?",
                "치료해야 할 숫자는 얼마나 되나요? 모든 연구를 기반으로 한 것입니까, 아니면 방금 발표된 연구를 기반으로 한 것입니까?"
              ]
            },
            {
              heading: "About Uncertainty",
              items: [
                "이 권장 사항에 대해 얼마나 확신하십니까?",
                "연구에서 제안한 것보다 이익이 작을 수 있습니까?",
                "근거 품질이 더 나은 치료법이 있습니까?",
                "What would change your recommendation?"
              ]
            },
            {
              heading: "공유 정보 의사결정",
              items: [
                "불확실한 상황에서 내가 선택할 수 있는 것은 무엇입니까?",
                "당신이 나와 같은 상황이라면 어떻게 하시겠습니까?",
                "Can we try this and reassess in [timeframe]?",
                "작동하지 않는다는 것을 알려면 무엇을 관찰해야 합니까?"
              ]
            }
          ]
        }
      },
      {
        type: 'quiz',
        content: {
          question: "POST-ASSESSMENT: A meta-analysis shows Drug X reduces mortality by 35% (OR 0.65, p<0.001). Egger's test is non-significant (p=0.28) with 8 studies. Registry shows 12 trials were registered. What's your assessment?",
          options: [
            { id: 'a', text: "강력한 증거 - 상당한 효과가 있고 출판 편견이 발견되지 않음", correct: false },
            { id: 'b', text: "Uncertain — Egger's test underpowered, registry gap concerning, effect may be inflated", correct: true },
            { id: 'c', text: "Invalid — the meta-analysis should be rejected entirely", correct: false },
            { id: 'd', text: "More studies needed before any conclusion", correct: false }
          ],
          explanation: "Correct! Multiple red flags here: (1) Egger's test with only 8 studies has very low power — non-significant doesn't mean no bias; (2) 12 registered trials but only 8 published = 33% missing, suggesting selective publication; (3) The 35% effect may be inflated. You should: search for the 4 missing trials, run sensitivity analyses (trim-and-fill, PET-PEESE), and interpret with caution. Compare your answer to the pre-assessment — you've learned to see beyond p-values!"
        }
      },
      {
        type: 'key-takeaways',
        content: {
          takeaways: [
            "The Five Principles: Absence, Visibility, Asymmetry, Uncertainty, Action",
            "탐지만으로는 충분하지 않습니다. 증거에 따라 조치를 취하고 공유해야 합니다.",
            "Every role matters: reader, reviewer, advocate, teacher",
            "Systemic change happens through accumulated individual actions",
            "The detective who finds truth must also fight to make it known"
          ],
          actionItem: "Before leaving this course, choose ONE concrete action: will you check funnel plots, demand registry searches, advocate for transparency, or teach others? Make a commitment and follow through."
        }
      }
    ]
  },

  // MODULE 7: CHRONICLES OF HIDDEN EVIDENCE
  {
    id: 7,
    title: "숨겨진 증거 연대기",
    subtitle: "Real Cases, Real Decisions",
    estimatedMinutes: 35,
    slides: [
      {
        type: 'learning-objectives',
        content: {
          intro: "By the end of this module, you will be able to:",
          objectives: [
            "Analyze 5 landmark cases of publication bias using real data",
            "Make clinical decisions when facing incomplete evidence",
            "Recognize patterns of data suppression across different therapeutic areas",
            "Apply the two-path framework to evaluate consequences of action vs. inaction",
            "내부화 후렴: 퍼널은 어떤 단어가 숨겨져 있는지 확인합니다"
          ]
        }
      },
      {
        type: 'title',
        content: {
          title: "숨겨진 증거 연대기",
          subtitle: "기록 보관소의 다섯 가지 이야기",
          text: "각 이야기는 질문으로 시작됩니다. 각각 선택 사항을 제시합니다. 각각은 숨겨진 내용을 드러냅니다. 이것은 가설이 아닙니다. 그런 일이 일어났습니다. 환자들은 진짜였습니다. 데이터가 묻혔습니다. 깔때기는 진실을 말했을 것입니다."
        }
      },
      {
        type: 'principle',
        content: {
          number: "VI",
          text: "The funnel sees what words conceal."
        }
      },

      // STORY 1: THE PAROXETINE DECEPTION (Study 329)
      {
        type: 'story',
        content: {
          storyNumber: 1,
          title: "파록세틴의 속임수",
          caseId: "Study 329",
          opening: "게시된 기록이 거짓일 경우 어떤 일이 일어날지 생각해 보셨나요?",
          stats: {
            header: "숨겨진 데이터",
            items: [
              { value: "275", label: "Adolescents enrolled" },
              { value: "11", label: "Suicide events on paroxetine" },
              { value: "2", label: "Suicide events on placebo" },
              { value: "14", label: "Years until truth emerged" }
            ]
          },
          scenario: {
            title: "결정 포인트",
            text: "The year is 2002. You are a prescribing physician. A depressed teenager sits before you. The journal article on your desk — published in the prestigious Journal of the American Academy of Child & Adolescent Psychiatry — concludes that paroxetine is 'generally well tolerated and effective' for adolescent depression. You have two paths before you."
          },
          pathA: {
            header: "Path A: Trust the Published Paper",
            action: "동료 검토를 거친 증거를 바탕으로 파록세틴을 처방합니다",
            steps: [
              "The published paper shows efficacy on some measures",
              "Safety section mentions some events but appears reassuring",
              "처방전을 작성하는 방법 자신감",
              "Three weeks later, the patient attempts suicide"
            ],
            consequence: "증거를 따랐습니다. 그러나 증거는 불완전했습니다. 당신이 신뢰한 신문은 대필된 것이었습니다. 수석 '저자'는 원시 데이터를 보지 못했습니다. 파록세틴의 5.5배 높은 자살 신호는 작은 글씨와 통계에 숨겨져 있었습니다."
          },
          pathB: {
            header: "경로 B: 누락된 데이터에 대한 질문",
            action: "불일치를 발견하고 더 자세히 조사합니다",
            steps: [
              "시험 등록부를 확인합니다. 즉 주요 결과 변경됨",
              "저자가 제조업체의 컨설턴트임을 확인했습니다.",
              "FDA에 임상 연구 보고서를 요청했습니다.",
              "You discover 11 suicide-related events vs. 2 on placebo"
            ],
            consequence: "주의를 선택했습니다. 대안을 처방하셨습니다. 몇 년 후, 진실이 드러났을 때 당신은 당신의 회의주의가 왜 생명을 구했는지 이해하게 되었습니다. 그러나 2002년에 이 경로에는 특별한 경계가 필요했습니다. 시스템은 숨기도록 설계되었습니다."
          },
          revelation: {
            header: "The Revelation",
            text: "It took 14 years for the full data to emerge. The paper was ghostwritten by a medical communications company. The named 'author' — a prominent academic — had not analyzed the data. The study actually showed paroxetine was neither safe nor effective. The restoring of Study 329 by RIAT researchers in 2015 exposed one of the greatest publication frauds in psychiatric history.",
            detail: "Source: Le Noury et al. BMJ 2015; Restoring Study 329"
          },
          refrain: "The funnel sees what words conceal."
        }
      },

      // STORY 2: THE REBOXETINE FUNNEL
      {
        type: 'story',
        content: {
          storyNumber: 2,
          title: "레복세틴 깔때기",
          caseId: "NICE Submission / Eyding 2010",
          opening: "What appears when you plot effect against precision?",
          stats: {
            header: "억제 규모",
            items: [
              { value: "0.56", label: "Published effect size (SMD)" },
              { value: "0.07", label: "True effect size (with unpublished)" },
              { value: "74%", label: "환자 데이터 억제" },
              { value: "8", label: "Trials never published" }
            ]
          },
          scenario: {
            title: "결정 포인트",
            text: "You are a health technology assessment analyst reviewing reboxetine for national reimbursement. The published meta-analysis shows a standardized mean difference of 0.56 — a moderate-to-large effect. The manufacturer wants approval. Millions in revenue depend on your recommendation. But something bothers you about the funnel plot."
          },
          pathA: {
            header: "Path A: Accept the Published Literature",
            action: "사용 가능한 기준에 따라 승인을 권장합니다. 증거",
            steps: [
              "Published trials consistently show benefit",
              "The effect size appears clinically meaningful",
              "긍정적인 평가를 작성합니다",
              "Reboxetine is approved and widely prescribed"
            ],
            consequence: "환자는 뒷받침되는 증거를 발표한 약을 받았습니다. 그러나 그 환자들은 실제적인 이점을 경험하지 못했습니다. 왜냐하면 발표된 증거가 전체의 26%에 불과했기 때문입니다. 효과가 없는 74%는 회사 파일에 숨겨졌습니다."
          },
          pathB: {
            header: "경로 B: 미공개 데이터 요구",
            action: "모든 임상시험 데이터를 요구하도록 권한을 요청합니다",
            steps: [
              "게시된 모든 임상시험이 업계 후원을 받는 것을 확인했습니다",
              "공식적으로 요청합니다 화이자의 미발표 시험 데이터",
              "퍼널에 모든 데이터를 표시하면 비대칭성이 나타납니다.",
              "The true effect is 0.07: clinically meaningless"
            ],
            consequence: "투명성에 대한 귀하의 요구는 속임수를 드러냅니다. 약물의 이점은 입증되지 않았습니다. 귀하의 권고사항은 효과 없는 치료로부터 환자를 보호합니다. 이것이 바로 IQWiG가 한 일이며, 이후 여러 국가에서 레복세틴이 철회되거나 제한되었습니다."
          },
          revelation: {
            header: "The Revelation",
            text: "When Eyding and colleagues obtained all trial data, the truth was stark: 2,256 patients in 8 trials had been hidden. The published literature — the 'evidence' — was a curated selection designed to show what did not exist. The funnel plot of all data showed what the published plot concealed: a symmetric distribution around zero.",
            detail: "Source: Eyding et al. BMJ 2010"
          },
          refrain: "The funnel sees what words conceal."
        }
      },

      // STORY 3: THE GABAPENTIN GHOST
      {
        type: 'story',
        content: {
          storyNumber: 3,
          title: "가바펜틴 유령",
          caseId: "Pfizer's Hidden Trials",
          opening: "How many trials can hide in plain sight?",
          stats: {
            header: "등록 공백",
            items: [
              { value: "12", label: "Trials registered" },
              { value: "8", label: "Trials published" },
              { value: "4", label: "혜택이 없는 시험 — 숨김" },
              { value: "$430M", label: "합의 사기" }
            ]
          },
          scenario: {
            title: "결정 포인트",
            text: "You are writing a systematic review on gabapentin for neuropathic pain. Your literature search returns 8 published trials, all showing benefit. The Cochrane methodology is clear: you must also search trial registries. When you do, you find 12 trials were registered. Four trials have vanished."
          },
          pathA: {
            header: "Path A: Review Only Published Literature",
            action: "귀하는 8개의 사용 가능한 임상시험으로 검토를 완료했습니다.",
            steps: [
              "Your meta-analysis shows gabapentin is effective",
              "The forest plot shows consistent benefit across trials",
              "가바펜틴이 신경병증성 통증에 효과가 있다고 결론을 내렸습니다.",
              "Guidelines cite your review; prescriptions increase"
            ],
            consequence: "귀하의 검토는 증거 기반의 일부가 됩니다. 그러나 그것은 모래 위에 세워졌습니다. 시험의 33%가 누락되었습니다. 4개의 미발표 임상시험에서는 아무런 이점도 나타나지 않았습니다. 게시된 기록을 완전한 것으로 받아들였기 때문에 귀하의 정직한 작업은 왜곡된 진실을 영속시킵니다."
          },
          pathB: {
            header: "Path B: Hunt the Missing Trials",
            action: "모든 채널을 통해 누락된 4가지 임상시험을 추구합니다.",
            steps: [
              "화이자에 연락하여 임상시험 데이터를 요청했지만 거부되었습니다.",
              "You file a Freedom of Information request to FDA",
              "소송 검색에서 내부 문서를 찾았습니다.",
              "4개의 누락된 임상시험에서는 아무런 이점도 나타나지 않았습니다. 효과가 사라졌습니다."
            ],
            consequence: "Your persistence reveals the publication bias. Your review includes a prominent warning about missing data. Your conclusions are appropriately uncertain. When the Pfizer settlement documents later emerge, your caution is vindicated. The 4 trials showed exactly what you suspected: nothing."
          },
          revelation: {
            header: "The Revelation",
            text: "Internal Pfizer documents revealed explicit suppression strategy. One email stated: 'We have to be careful about what we publish.' Draft manuscripts were prepared only for trials where data 'should be positive.' The company paid $430 million in settlements — but had already earned $2.7 billion from off-label promotion. The penalty was the cost of doing business.",
            detail: "Source: Steinman et al. JAMA 2006; DOJ Settlement 2004"
          },
          refrain: "The funnel sees what words conceal."
        }
      },

      // STORY 4: THE TAMIFLU BILLIONS
      {
        type: 'story',
        content: {
          storyNumber: 4,
          title: "타미플루 수십억",
          caseId: "Cochrane Oseltamivir 리뷰",
          opening: "숨겨진 데이터의 비용은 얼마입니까?",
          stats: {
            header: "규모 투자",
            items: [
              { value: "$9B", label: "Global stockpile spending" },
              { value: "61%", label: "Published reduction in complications" },
              { value: "22,000", label: "Pages of hidden CSRs" },
              { value: "5", label: "데이터 획득 기간" }
            ]
          },
          scenario: {
            title: "결정 포인트",
            text: "팬데믹 대비에 대해 보건부에 조언합니다. 2009년이다. 돼지독감이 퍼지고 있다. 발표된 메타 분석에 따르면 타미플루는 인플루엔자 합병증을 61% 감소시킵니다. 전세계 정부는 비축하고 있습니다. 장관이 묻습니다. 타미플루에 수십억 달러를 지출해야 합니까? 증거는 분명한 것 같습니다."
          },
          pathA: {
            header: "Path A: Trust the Published Meta-Analyses",
            action: "발표된 증거를 바탕으로 비축하는 것이 좋습니다",
            steps: [
              "메타 분석은 권위 있는 저널에 게시됩니다.",
              "61% 감소는 상당한 것으로 보입니다",
              "You recommend $500 million in stockpile purchases",
              "The drugs sit in warehouses; the pandemic wanes"
            ],
            consequence: "Your recommendation followed the evidence that was available. But that evidence was based on published trials — and 60% of patient data came from unpublished manufacturer trials. The real effect on hospitalizations? Not significant. Your country spent hundreds of millions on drugs of uncertain benefit while other health needs went unfunded."
          },
          pathB: {
            header: "Path B: Demand Clinical Study Reports",
            action: "모든 것을 확인할 때까지 결정을 연기합니다. 데이터",
            steps: [
              "발표된 임상시험에서 미발표 제조업체 데이터를 인용한 것을 발견했습니다.",
              "전체 데이터 공개를 위한 BMJ 캠페인을 지지합니다",
              "You wait as Cochrane spends 5 years pursuing Roche",
              "Finally: 77 clinical study reports, 22,000 pages"
            ],
            consequence: "Your patience is rewarded with truth. Tamiflu reduces symptom duration by 17 hours — not 'days' as marketed. No evidence it prevents pneumonia or hospitalization. It causes nausea and vomiting. Your recommendation: do not stockpile at pandemic scale. WHO downgrades it from 'essential' to 'complementary' medicine."
          },
          revelation: {
            header: "The Revelation",
            text: "The Cochrane review took 5 years because Roche refused to release Clinical Study Reports. When finally obtained through regulatory channels, 22,000 pages revealed what 10 years of published papers concealed: the benefit was marginal, the harms understated, the hospitalization claim unfounded. Billions in public money had been allocated based on incomplete evidence.",
            detail: "Source: Jefferson et al. Cochrane 2014; BMJ Open Data Campaign"
          },
          refrain: "The funnel sees what words conceal."
        }
      },

      // STORY 5: THE ANTIDEPRESSANT LANDSCAPE
      {
        type: 'story',
        content: {
          storyNumber: 5,
          title: "항우울제 현황",
          caseId: "Turner et al. NEJM 2008",
          opening: "FDA가 보셨나요?",
          stats: {
            header: "게시된 기록과 실제 기록",
            items: [
              { value: "74", label: "Trials in FDA database" },
              { value: "94%", label: "Published as positive" },
              { value: "51%", label: "Actually positive per FDA" },
              { value: "0.15", label: "True effect size (vs. 0.37 published)" }
            ]
          },
          scenario: {
            title: "결정 포인트",
            text: "You are updating national depression treatment guidelines. The published literature overwhelmingly supports antidepressant efficacy — 94% of published trials are positive. Effect sizes appear substantial. But you have access to something rare: the FDA's internal review documents. You can see what the journals did not print."
          },
          pathA: {
            header: "Path A: Follow the Published Literature",
            action: "You write guidelines based on journal publications",
            steps: [
              "문헌 검토를 통해 강력한 증거를 찾았습니다.",
              "Effect size meta-analysis shows d = 0.37",
              "You recommend antidepressants as first-line treatment",
              "Patients and clinicians expect substantial benefit"
            ],
            consequence: "Your guidelines set expectations that often are not met. Patients try antidepressants expecting the large effects the literature suggests. When improvement is modest, they feel like failures. Clinicians question their skills. The mismatch between published promise and lived reality creates confusion, non-adherence, and therapeutic nihilism."
          },
          pathB: {
            header: "경로 B: FDA 검토 데이터 통합",
            action: "발표된 모든 시험과 미출판",
            steps: [
              "귀하는 12개 항우울제에 대한 FDA 검토 문서를 얻었습니다",
              "36개의 임상시험이 부정적이거나 의심스러웠다는 사실을 발견했습니다.",
              "그 36개 중 14개만 발표되었고 11개는 양성으로 판명되었습니다.",
              "True effect size: 0.15 (small, not 0.37)"
            ],
            consequence: "Your guidelines are honest about modest efficacy. They recommend antidepressants while acknowledging that benefits are real but smaller than published literature suggests. Patients have accurate expectations. Shared decision-making is possible because the truth is known. When improvement occurs, it is recognized; when it doesn't, alternatives are discussed without shame."
          },
          revelation: {
            header: "The Revelation",
            text: "Erick Turner's landmark study did what no one before had done: compare the FDA's complete record to the published literature. The result was devastating: selective publication inflated apparent efficacy by 32%. The published literature was not the evidence — it was a filtered, biased selection of the evidence. Turner's paper changed how we understand psychiatric drug trials forever.",
            detail: "Source: Turner et al. NEJM 2008"
          },
          refrain: "The funnel sees what words conceal."
        }
      },

      // SYNTHESIS SLIDE
      {
        type: 'content',
        content: {
          title: "The Pattern Across All Five Stories",
          sections: [
            {
              heading: "무엇이었나? 숨겨진",
              items: [
                "청소년 자살 사건(연구 329)",
                "74% of patient data showing no benefit (Reboxetine)",
                "4 negative trials out of 12 registered (Gabapentin)",
                "22,000 pages of clinical study reports (Tamiflu)",
                "36 negative or questionable trials out of 74 (Antidepressants)"
              ]
            },
            {
              heading: "Who Hid It",
              items: [
                "Pharmaceutical companies with financial interests",
                "Medical communication firms ghostwriting papers",
                "Academic 'authors' who lent their names without seeing data",
                "긍정적인 결과를 우선적으로 발표하는 저널",
                "데이터를 보유하고 있지만 공개를 요구하지 않는 규제 기관"
              ]
            },
            {
              heading: "What Would Have Revealed It",
              items: [
                "Trial registry searches comparing registered to published",
                "Funnel plots showing asymmetric distributions",
                "Freedom of Information requests to regulatory agencies",
                "Comparison of published outcomes to pre-registered outcomes",
                "임상 연구에 대한 지속적인 요구 보고서"
              ]
            }
          ]
        }
      },

      // DECISION TREE SYNTHESIS
      {
        type: 'decision-tree',
        content: {
          title: "The Two Paths: A Universal Pattern",
          situation: "In each story, someone faced a choice. The evidence before them seemed clear. The published record pointed one way. But the complete truth pointed another. The detective asks: What would I have done?",
          nodes: [
            {
              id: 'start',
              question: "치료를 뒷받침하는 공개된 증거를 발견했습니다. 눈에 보이는 모든 시도는 긍정적입니다. 효과 크기가 인상적입니다. 귀하의 첫 번째 반응은 무엇입니까?",
              branches: [
                { id: 'a', text: "Accept the evidence and act on it — published = peer-reviewed = reliable", nextNode: 'naive' },
                { id: 'b', text: "Ask: What might be missing? Check registries, request unpublished data", nextNode: 'vigilant' }
              ]
            },
            {
              id: 'naive',
              type: 'outcome',
              consequence: 'bad',
              title: "신뢰의 길",
              text: "You acted on what was visible. In the five cases you studied: you would have prescribed paroxetine to suicidal adolescents; recommended reboxetine that doesn't work; endorsed gabapentin for conditions it doesn't help; stockpiled billions in marginally effective Tamiflu; and set unrealistic expectations for antidepressants. Every published record seemed solid. Every one was incomplete.",
              realCase: "이것은 수십 년 동안 의학이 기본적으로 걸어온 길이었습니다. 대부분의 지침, 대부분의 처방 결정, 대부분의 환자 기대는 체계적으로 혜택을 과장한 출판된 문헌을 기반으로 했습니다."
            },
            {
              id: 'vigilant',
              type: 'outcome',
              consequence: 'good',
              title: "탐정의 길",
              text: "You questioned what was missing. In each case, the answer was the same: hidden data that reversed or substantially weakened the conclusion. Your skepticism was not cynicism — it was protection. The patients whose lives depended on your decisions were served by your vigilance. The funnel plot, the registry search, the FOIA request — these are not academic exercises. They are shields.",
              realCase: "출판 편견의 모든 주요 사례는 결국 출판된 기록을 완전한 것으로 받아들이기를 거부한 개인에 의해 드러났습니다. 나머지 데이터는 어디에 있습니까?"
            }
          ]
        }
      },

      // THE REFRAIN
      {
        type: 'oath',
        content: {
          header: "출판 편향 탐정 자제",
          text: "In Paroxetine, the paper said 'safe' — <strong>the funnel sees what words conceal.</strong><br><br>In Reboxetine, the published effect was 0.56 — <strong>the funnel sees what words conceal.</strong><br><br>In Gabapentin, four trials vanished — <strong>the funnel sees what words conceal.</strong><br><br>In Tamiflu, billions were spent on hidden data — <strong>the funnel sees what words conceal.</strong><br><br>In antidepressants, 94% positive became 51% — <strong>the funnel sees what words conceal.</strong><br><br>What words conceal, the detective reveals."
        }
      },

      // KEY TAKEAWAYS
      {
        type: 'key-takeaways',
        content: {
          takeaways: [
            "Publication bias is not an abstract statistical concept — it has body counts",
            "Every case followed the same pattern: financial incentive → selective publication → patient harm",
            "탐지 도구(레지스트리 검색, 퍼널 플롯, FOIA)는 모든 경우에서 진실을 드러냈을 것입니다.",
            "모든 결정 지점에서의 선택은 신뢰 대 신뢰였습니다. verify",
            "퍼널은 어떤 단어가 숨겨져 있는지 확인합니다. 그러나"
          ],
          actionItem: "The next time you read a meta-analysis showing impressive effects, ask yourself: Which of the five stories does this most resemble? Then check the registry. Then look at the funnel. Then decide."
        }
      },

      // FINAL PRINCIPLE
      {
        type: 'cycle-return',
        content: {
          principle: "You have now walked through five chronicles of hidden evidence. In each, the published record lied — not through fabrication, but through omission. In each, patients were harmed by treatments that appeared effective but were not. In each, the funnel plot — that simple scatter of effect against precision — would have shown the asymmetry, the gap, the missing mass of hidden truth. Remember: The funnel sees what words conceal. See what it shows you."
        }
      }
    ]
  }
];

// ============================================================
// INTERACTIVE TOOLS
// ============================================================

// Basic Funnel Plot Tool
function renderFunnelTool(containerId) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = `
    <div class="tool-controls">
      <div class="tool-control">
        <label>True Effect Size</label>
        <input type="range" id="trueEffect" min="-1" max="1" step="0.1" value="0.3" oninput="updateFunnelPlot()">
        <span id="trueEffectVal">0.3</span>
      </div>
      <div class="tool-control">
        <label>Publication Bias</label>
        <select id="biasLevel" onchange="updateFunnelPlot()">
          <option value="none">None</option>
          <option value="mild">Mild</option>
          <option value="moderate" selected>Moderate</option>
          <option value="severe">Severe</option>
        </select>
      </div>
      <div class="tool-control">
        <label>Number of Studies</label>
        <input type="range" id="numStudies" min="10" max="50" step="5" value="25" oninput="updateFunnelPlot()">
        <span id="numStudiesVal">25</span>
      </div>
    </div>
    <div id="funnelPlotArea" class="plot-area"></div>
    <div id="funnelStats" style="margin-top:1rem;padding:1rem;background:rgba(0,0,0,0.2);border-radius:8px;"></div>
  `;

  updateFunnelPlot();
}

function updateFunnelPlot() {
  const trueEffect = parseFloat(document.getElementById('trueEffect').value);
  const biasLevel = document.getElementById('biasLevel').value;
  const numStudies = parseInt(document.getElementById('numStudies').value);

  document.getElementById('trueEffectVal').textContent = trueEffect.toFixed(1);
  document.getElementById('numStudiesVal').textContent = numStudies;

  // Generate studies
  const studies = [];
  const biasProb = { none: 0, mild: 0.3, moderate: 0.5, severe: 0.7 };
  const suppressProb = biasProb[biasLevel];

  for (let i = 0; i < numStudies * 2; i++) {
    const se = 0.1 + Math.random() * 0.4; // SE between 0.1 and 0.5
    const effect = trueEffect + (Math.random() - 0.5) * se * 4; // scatter around true effect
    const z = effect / se;
    const pval = 2 * (1 - normalCDF(Math.abs(z)));

    // Publication bias: suppress non-significant negative small studies
    const isNegative = effect < trueEffect * 0.5;
    const isSmall = se > 0.25;
    const isNonSig = pval > 0.05;

    const suppress = isNegative && isSmall && isNonSig && Math.random() < suppressProb;

    if (!suppress && studies.length < numStudies) {
      studies.push({ effect, se, pval, suppressed: false });
    }
  }

  // Calculate pooled effect
  const weights = studies.map(s => 1 / (s.se * s.se));
  const sumW = weights.reduce((a, b) => a + b, 0);
  const pooledEffect = studies.reduce((sum, s, i) => sum + weights[i] * s.effect, 0) / sumW;

  // Max SE for contours
  const maxSE = Math.max(...studies.map(s => s.se)) * 1.1;
  const z_05 = 1.96;

  // Create traces
  const studyTrace = {
    x: studies.map(s => s.effect),
    y: studies.map(s => s.se),
    mode: 'markers',
    type: 'scatter',
    marker: {
      size: 10,
      color: studies.map(s => s.pval < 0.05 ? '#3b82f6' : '#94a3b8'),
      line: { color: '#ffffff', width: 1 }
    },
    text: studies.map((s, i) => `Study ${i+1}<br>Effect: ${s.effect.toFixed(2)}<br>SE: ${s.se.toFixed(2)}<br>p: ${s.pval.toFixed(3)}`),
    hoverinfo: 'text',
    name: 'Studies'
  };

  const pooledLine = {
    x: [pooledEffect, pooledEffect],
    y: [0, maxSE],
    mode: 'lines',
    line: { color: '#d4af37', width: 2, dash: 'dash' },
    name: 'Pooled Effect'
  };

  const trueLine = {
    x: [trueEffect, trueEffect],
    y: [0, maxSE],
    mode: 'lines',
    line: { color: '#22c55e', width: 2, dash: 'dot' },
    name: 'True Effect'
  };

  // Contour lines
  const leftContour = {
    x: [pooledEffect, pooledEffect - z_05 * maxSE],
    y: [0, maxSE],
    mode: 'lines',
    line: { color: 'rgba(124,58,237,0.5)', width: 1, dash: 'dot' },
    showlegend: false
  };

  const rightContour = {
    x: [pooledEffect, pooledEffect + z_05 * maxSE],
    y: [0, maxSE],
    mode: 'lines',
    line: { color: 'rgba(124,58,237,0.5)', width: 1, dash: 'dot' },
    showlegend: false
  };

  Plotly.newPlot('funnelPlotArea', [studyTrace, pooledLine, trueLine, leftContour, rightContour], {
    title: 'Funnel Plot',
    xaxis: { title: 'Effect Size', zeroline: true },
    yaxis: { title: 'Standard Error', autorange: 'reversed' },
    showlegend: true,
    legend: { x: 1.02, y: 1 },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0.2)',
    font: { color: '#f5f5f0' }
  }, { responsive: true });

  // Stats
  const inflation = trueEffect !== 0 ? ((pooledEffect - trueEffect) / trueEffect * 100).toFixed(1) : 'N/A';
  const biasDesc = biasLevel === 'none' ? 'no' : biasLevel;
  const asymmetryDesc = biasLevel === 'none' ? 'symmetric (no gaps)' :
    biasLevel === 'mild' ? 'slightly asymmetric with minor gap in lower-left' :
    biasLevel === 'moderate' ? 'moderately asymmetric with visible gap in lower-left' :
    '왼쪽 하단에 큰 간격이 있는 심각한 비대칭(작은 부정적 연구 누락)';

  document.getElementById('funnelStats').innerHTML = `
    <div class="chart-description" aria-live="polite">
      Funnel plot showing ${numStudies} studies. True effect: ${trueEffect.toFixed(2)}.
      Observed pooled effect: ${pooledEffect.toFixed(2)} (${inflation === 'N/A' ? 'true effect is zero' : inflation > 0 ? inflation + '% inflation' : 'no inflation'}).
      Publication bias level: ${biasDesc}. Plot appears ${asymmetryDesc}.
    </div>
    <button onclick="this.previousElementSibling.classList.toggle('chart-description-visible')"
            style="font-size:0.75rem;padding:0.25rem 0.5rem;margin-bottom:0.75rem;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:4px;color:var(--cream);cursor:pointer;">
      Toggle Chart Description (Screen Reader)
    </button>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;text-align:center;">
      <div>
        <div style="color:#22c55e;font-size:1.5rem;font-weight:bold;">${trueEffect.toFixed(2)}</div>
        <div style="font-size:0.8rem;color:rgba(255,255,255,0.6);">True Effect</div>
      </div>
      <div>
        <div style="color:#d4af37;font-size:1.5rem;font-weight:bold;">${pooledEffect.toFixed(2)}</div>
        <div style="font-size:0.8rem;color:rgba(255,255,255,0.6);">Observed (Pooled)</div>
      </div>
      <div>
        <div style="color:${inflation === 'N/A' ? '#888' : inflation > 10 ? '#dc2626' : '#16a34a'};font-size:1.5rem;font-weight:bold;">${inflation === 'N/A' ? 'N/A' : (inflation > 0 ? '+' : '') + inflation + '%'}</div>
        <div style="font-size:0.8rem;color:rgba(255,255,255,0.6);">Inflation</div>
      </div>
    </div>
  `;
}

// Contour-Enhanced Funnel Plot
function renderContourTool(containerId) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = `
    <div class="tool-controls">
      <div class="tool-control">
        <label>Show Contours</label>
        <select id="showContours" onchange="updateContourPlot()">
          <option value="yes" selected>Yes</option>
          <option value="no">No</option>
        </select>
      </div>
      <div class="tool-control">
        <label>Bias Pattern</label>
        <select id="biasPattern" onchange="updateContourPlot()">
          <option value="none">No Bias (Symmetric)</option>
          <option value="pubBias" selected>Publication Bias</option>
          <option value="heterogeneity">Heterogeneity</option>
        </select>
      </div>
    </div>
    <div id="contourPlotArea" class="plot-area"></div>
    <div id="contourInterpret" style="margin-top:1rem;padding:1rem;background:rgba(0,0,0,0.2);border-radius:8px;"></div>
  `;

  updateContourPlot();
}

function updateContourPlot() {
  const showContours = document.getElementById('showContours').value === 'yes';
  const biasPattern = document.getElementById('biasPattern').value;

  // Generate data based on pattern
  const studies = [];
  const trueEffect = 0.3;

  for (let i = 0; i < 30; i++) {
    let se, effect;

    if (biasPattern === 'none') {
      se = 0.1 + Math.random() * 0.35;
      effect = trueEffect + (Math.random() - 0.5) * se * 3;
    } else if (biasPattern === 'pubBias') {
      se = 0.1 + Math.random() * 0.35;
      effect = trueEffect + (Math.random() - 0.5) * se * 3;
      const z = effect / se;
      const pval = 2 * (1 - normalCDF(Math.abs(z)));
      if (effect < 0 && se > 0.2 && pval > 0.05 && Math.random() < 0.7) continue;
    } else { // heterogeneity
      se = 0.1 + Math.random() * 0.35;
      // Small studies have larger effects
      effect = trueEffect + (se > 0.25 ? 0.2 : 0) + (Math.random() - 0.5) * se * 2;
    }

    studies.push({ effect, se });
  }

  const maxSE = Math.max(...studies.map(s => s.se)) * 1.1;
  const pooledEffect = studies.reduce((s, st) => s + st.effect, 0) / studies.length;

  const traces = [];

  // Contour shading
  if (showContours) {
    // p > 0.05 region (non-significant)
    traces.push({
      x: [pooledEffect - 1.96 * maxSE, pooledEffect, pooledEffect + 1.96 * maxSE, pooledEffect - 1.96 * maxSE],
      y: [maxSE, 0, maxSE, maxSE],
      fill: 'toself',
      fillcolor: 'rgba(124,58,237,0.1)',
      line: { color: 'rgba(124,58,237,0.3)' },
      name: 'p < 0.05',
      showlegend: true
    });
  }

  // Studies
  traces.push({
    x: studies.map(s => s.effect),
    y: studies.map(s => s.se),
    mode: 'markers',
    type: 'scatter',
    marker: { size: 10, color: '#3b82f6', line: { color: '#fff', width: 1 } },
    name: 'Studies'
  });

  // Pooled line
  traces.push({
    x: [pooledEffect, pooledEffect],
    y: [0, maxSE],
    mode: 'lines',
    line: { color: '#d4af37', width: 2, dash: 'dash' },
    name: 'Pooled'
  });

  Plotly.newPlot('contourPlotArea', traces, {
    title: 'Contour-Enhanced Funnel Plot',
    xaxis: { title: 'Effect Size' },
    yaxis: { title: 'Standard Error', autorange: 'reversed' },
    showlegend: true,
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0.2)',
    font: { color: '#f5f5f0' }
  }, { responsive: true });

  const interpretations = {
    none: "Symmetric funnel. No evidence of publication bias or small-study effects.",
    pubBias: "왼쪽 하단(유의하지 않은 영역)에 간격이 있는 비대칭 깔때기를 보도록 선택한 경우에만 해당합니다. 이 패턴은 출판 편향을 암시합니다. 작은 부정적인 연구는 출판되지 않았습니다.",
    heterogeneity: "작은 연구에서 더 큰 효과를 보여주는 비대칭 유입경로입니다. 출판 편향 또는 실제 차이(소규모 연구에서 더 아픈 환자)일 수 있습니다. 임상 조사가 필요합니다."
  };

  document.getElementById('contourInterpret').innerHTML = `<strong>Interpretation:</strong> ${interpretations[biasPattern]}`;
}

// Egger's Test Tool
function renderEggerTool(containerId) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = `
    <div class="tool-description">Enter effect sizes and standard errors to calculate Egger's regression test.</div>
    <div class="tool-controls" style="flex-direction:column;">
      <textarea id="eggerData" rows="8" style="width:100%;background:rgba(0,0,0,0.3);color:#f5f5f0;border:1px solid rgba(255,255,255,0.2);border-radius:8px;padding:1rem;font-family:monospace;"># Effect, SE (one per line)
0.45, 0.12
0.32, 0.15
0.28, 0.18
0.51, 0.14
0.15, 0.22
0.38, 0.16
0.42, 0.13
0.55, 0.11
0.25, 0.19
0.33, 0.17</textarea>
      <button onclick="runEggerTest()" style="margin-top:1rem;padding:0.75rem 1.5rem;background:var(--teal);border:none;border-radius:8px;color:white;cursor:pointer;font-weight:600;">Run Egger's Test</button>
    </div>
    <div id="eggerResults" style="margin-top:1.5rem;"></div>
  `;
}

function runEggerTest() {
  const dataText = document.getElementById('eggerData').value;
  const lines = dataText.split('\n').filter(l => l.trim() && !l.startsWith('#'));

  const yi = [], sei = [];
  lines.forEach(line => {
    const parts = line.split(',').map(p => parseFloat(p.trim()));
    if (parts.length >= 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
      yi.push(parts[0]);
      sei.push(parts[1]);
    }
  });

  if (yi.length < 3) {
    document.getElementById('eggerResults').innerHTML = '<p style="color:#dc2626;">Need at least 3 studies for Egger\'s test.</p>';
    return;
  }

  // Weighted least squares regression
  const vi = sei.map(s => s * s);
  const wi = vi.map(v => 1 / v);
  const precision = sei.map(s => 1 / s);
  const zi = yi.map((y, i) => y / sei[i]);

  const k = yi.length;
  const sumW = wi.reduce((a, b) => a + b, 0);
  const sumWx = precision.reduce((sum, x, i) => sum + wi[i] * x, 0);
  const sumWy = zi.reduce((sum, y, i) => sum + wi[i] * y, 0);
  const sumWxy = precision.reduce((sum, x, i) => sum + wi[i] * x * zi[i], 0);
  const sumWx2 = precision.reduce((sum, x, i) => sum + wi[i] * x * x, 0);

  const det = sumW * sumWx2 - sumWx * sumWx;
  const b0 = (sumWx2 * sumWy - sumWx * sumWxy) / det; // intercept
  const b1 = (sumW * sumWxy - sumWx * sumWy) / det;   // slope

  const residuals = zi.map((z, i) => z - (b0 + b1 * precision[i]));
  const sse = residuals.reduce((sum, r, i) => sum + wi[i] * r * r, 0);
  const mse = sse / (k - 2);

  const var_b0 = mse * sumWx2 / det;
  const se_b0 = Math.sqrt(var_b0);
  const t_val = b0 / se_b0;
  const p_val = 2 * (1 - tCDF(Math.abs(t_val), k - 2));

  const significant = p_val < 0.1;

  document.getElementById('eggerResults').innerHTML = `
    <div class="statistic-card" style="background:${significant ? 'rgba(220,38,38,0.2)' : 'rgba(22,163,74,0.2)'};border-color:${significant ? 'rgba(220,38,38,0.4)' : 'rgba(22,163,74,0.4)'};">
      <div style="font-size:1.5rem;font-weight:bold;color:${significant ? '#dc2626' : '#22c55e'};">
        ${significant ? 'Significant Asymmetry Detected' : 'No Significant Asymmetry'}
      </div>
      <div style="margin-top:1rem;display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;">
        <div>
          <div style="font-size:1.2rem;font-weight:bold;">${b0.toFixed(3)}</div>
          <div style="font-size:0.8rem;color:rgba(255,255,255,0.6);">Intercept (b0)</div>
        </div>
        <div>
          <div style="font-size:1.2rem;font-weight:bold;">${t_val.toFixed(2)}</div>
          <div style="font-size:0.8rem;color:rgba(255,255,255,0.6);">t-statistic</div>
        </div>
        <div>
          <div style="font-size:1.2rem;font-weight:bold;">${p_val.toFixed(4)}</div>
          <div style="font-size:0.8rem;color:rgba(255,255,255,0.6);">p-value</div>
        </div>
      </div>
    </div>
    <div style="margin-top:1rem;padding:1rem;background:rgba(0,0,0,0.2);border-radius:8px;">
      <strong>Interpretation:</strong> ${significant
        ? 'p < 0.10 suggests funnel plot asymmetry. This MAY indicate publication bias, but could also reflect heterogeneity or other small-study effects. Investigate further.'
        : 'p >= 0.10 does not suggest asymmetry. However, with ' + k + '연구, 테스트의 힘은 제한적입니다. 증거가 없다고 해서 부재의 증거는 아닙니다.'}
    </div>
  `;
}

// Trim and Fill Tool
function renderTrimFillTool(containerId) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = `
    <div class="tool-controls">
      <div class="tool-control">
        <label>Show Original Only</label>
        <input type="checkbox" id="originalOnly" onchange="updateTrimFill()">
      </div>
      <div class="tool-control">
        <label>Asymmetry Level</label>
        <select id="asymLevel" onchange="updateTrimFill()">
          <option value="low">Low</option>
          <option value="moderate" selected>Moderate</option>
          <option value="high">High</option>
        </select>
      </div>
    </div>
    <div id="trimFillPlotArea" class="plot-area"></div>
    <div id="trimFillResults" style="margin-top:1rem;padding:1rem;background:rgba(0,0,0,0.2);border-radius:8px;"></div>
  `;

  updateTrimFill();
}

function updateTrimFill() {
  const originalOnly = document.getElementById('originalOnly').checked;
  const asymLevel = document.getElementById('asymLevel').value;

  const trueEffect = 0.25;
  const suppressProb = { low: 0.2, moderate: 0.5, high: 0.8 }[asymLevel];

  const observed = [];
  for (let i = 0; i < 40; i++) {
    const se = 0.08 + Math.random() * 0.35;
    const effect = trueEffect + (Math.random() - 0.5) * se * 3.5;
    const z = effect / se;
    const pval = 2 * (1 - normalCDF(Math.abs(z)));

    if (effect < 0.1 && se > 0.2 && pval > 0.05 && Math.random() < suppressProb) continue;
    observed.push({ effect, se });
  }

  // Simple trim-and-fill simulation
  const weights = observed.map(s => 1 / (s.se * s.se));
  const sumW = weights.reduce((a, b) => a + b, 0);
  const pooledObs = observed.reduce((sum, s, i) => sum + weights[i] * s.effect, 0) / sumW;

  // Find asymmetric studies and create mirror images
  const imputed = [];
  if (!originalOnly) {
    observed.forEach(s => {
      if (s.effect < pooledObs - 0.1 && s.se > 0.2) return; // keep these
      if (s.effect > pooledObs + 0.15 && s.se > 0.2) {
        // Impute mirror image
        const mirrorEffect = 2 * pooledObs - s.effect;
        imputed.push({ effect: mirrorEffect, se: s.se });
      }
    });
  }

  const allStudies = [...observed, ...imputed];
  const allWeights = allStudies.map(s => 1 / (s.se * s.se));
  const sumAllW = allWeights.reduce((a, b) => a + b, 0);
  const pooledAdj = allStudies.reduce((sum, s, i) => sum + allWeights[i] * s.effect, 0) / sumAllW;

  const maxSE = Math.max(...allStudies.map(s => s.se)) * 1.1;

  const traces = [
    {
      x: observed.map(s => s.effect),
      y: observed.map(s => s.se),
      mode: 'markers',
      marker: { size: 10, color: '#3b82f6', line: { color: '#fff', width: 1 } },
      name: 'Observed'
    }
  ];

  if (!originalOnly && imputed.length > 0) {
    traces.push({
      x: imputed.map(s => s.effect),
      y: imputed.map(s => s.se),
      mode: 'markers',
      marker: { size: 10, color: 'rgba(212,175,55,0)', symbol: 'circle-open', line: { color: '#d4af37', width: 2 } },
      name: 'Imputed (Trim-Fill)'
    });
  }

  traces.push({
    x: [pooledObs, pooledObs],
    y: [0, maxSE],
    mode: 'lines',
    line: { color: '#3b82f6', width: 2, dash: 'dash' },
    name: 'Original Pooled'
  });

  if (!originalOnly) {
    traces.push({
      x: [pooledAdj, pooledAdj],
      y: [0, maxSE],
      mode: 'lines',
      line: { color: '#d4af37', width: 2 },
      name: 'Adjusted Pooled'
    });
  }

  Plotly.newPlot('trimFillPlotArea', traces, {
    title: '자르기 및 채우기 분석',
    xaxis: { title: 'Effect Size' },
    yaxis: { title: 'Standard Error', autorange: 'reversed' },
    showlegend: true,
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0.2)',
    font: { color: '#f5f5f0' }
  }, { responsive: true });

  const change = ((pooledAdj - pooledObs) / pooledObs * 100).toFixed(1);
  document.getElementById('trimFillResults').innerHTML = `
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;text-align:center;">
      <div>
        <div style="font-size:1.3rem;font-weight:bold;color:#3b82f6;">${pooledObs.toFixed(3)}</div>
        <div style="font-size:0.8rem;color:rgba(255,255,255,0.6);">Original Effect</div>
      </div>
      <div>
        <div style="font-size:1.3rem;font-weight:bold;color:#d4af37;">${pooledAdj.toFixed(3)}</div>
        <div style="font-size:0.8rem;color:rgba(255,255,255,0.6);">Adjusted Effect</div>
      </div>
      <div>
        <div style="font-size:1.3rem;font-weight:bold;">${imputed.length}</div>
        <div style="font-size:0.8rem;color:rgba(255,255,255,0.6);">Imputed Studies</div>
      </div>
    </div>
    <div style="margin-top:1rem;font-size:0.9rem;color:rgba(255,255,255,0.7);">
      Effect changed by ${change}% after trim-and-fill adjustment.
      <em>Note: Imputed studies are statistical estimates, not real recovered data.</em>
    </div>
  `;
}

// P-Curve Tool
function renderPCurveTool(containerId) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = `
    <div class="tool-description">Enter p-values from significant studies (p < 0.05) to analyze the p-curve.</div>
    <div class="tool-controls" style="flex-direction:column;">
      <textarea id="pcurveData" rows="6" style="width:100%;background:rgba(0,0,0,0.3);color:#f5f5f0;border:1px solid rgba(255,255,255,0.2);border-radius:8px;padding:1rem;font-family:monospace;"># Enter p-values (p < 0.05), one per line
0.001
0.012
0.003
0.045
0.028
0.015
0.008
0.041
0.022
0.009</textarea>
      <button onclick="runPCurve()" style="margin-top:1rem;padding:0.75rem 1.5rem;background:var(--teal);border:none;border-radius:8px;color:white;cursor:pointer;font-weight:600;">Analyze P-Curve</button>
    </div>
    <div id="pcurvePlotArea" class="plot-area" style="min-height:300px;"></div>
    <div id="pcurveResults" style="margin-top:1rem;"></div>
  `;
}

function runPCurve() {
  const dataText = document.getElementById('pcurveData').value;
  const pvals = dataText.split('\n')
    .map(l => parseFloat(l.trim()))
    .filter(p => !isNaN(p) && p > 0 && p < 0.05);

  if (pvals.length < 5) {
    document.getElementById('pcurveResults').innerHTML = '<p style="color:#dc2626;">Need at least 5 significant p-values.</p>';
    return;
  }

  // Bin p-values
  const bins = [0, 0.01, 0.02, 0.03, 0.04, 0.05];
  const counts = [0, 0, 0, 0, 0];
  pvals.forEach(p => {
    for (let i = 0; i < 5; i++) {
      if (p > bins[i] && p <= bins[i + 1]) counts[i]++;
    }
  });

  // Expected under null (uniform)
  const expected = pvals.length / 5;

  const trace = {
    x: ['0-.01', '.01-.02', '.02-.03', '.03-.04', '.04-.05'],
    y: counts,
    type: 'bar',
    marker: { color: '#3b82f6' },
    name: 'Observed'
  };

  const expectedTrace = {
    x: ['0-.01', '.01-.02', '.02-.03', '.03-.04', '.04-.05'],
    y: [expected, expected, expected, expected, expected],
    type: 'scatter',
    mode: 'lines',
    line: { color: '#dc2626', dash: 'dash', width: 2 },
    name: 'Expected (Null)'
  };

  Plotly.newPlot('pcurvePlotArea', [trace, expectedTrace], {
    title: 'P-Curve Distribution',
    xaxis: { title: 'P-value Range' },
    yaxis: { title: 'Count' },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0.2)',
    font: { color: '#f5f5f0' }
  }, { responsive: true });

  // Simple skewness assessment
  const below025 = pvals.filter(p => p < 0.025).length;
  const above025 = pvals.filter(p => p >= 0.025).length;
  const isRightSkewed = below025 > above025 * 1.5;
  const isFlat = Math.abs(below025 - above025) < pvals.length * 0.2;
  const isLeftSkewed = above025 > below025 * 1.5;

  let interpretation, color;
  if (isRightSkewed) {
    interpretation = "RIGHT-SKEWED: Many p-values well below 0.025. This suggests TRUE evidential value — a real effect exists.";
    color = '#22c55e';
  } else if (isLeftSkewed) {
    interpretation = "LEFT-SKEWED: Excess p-values near 0.05. This suggests P-HACKING or selective reporting.";
    color = '#dc2626';
  } else {
    interpretation = "FLAT: P-값이 거의 균일합니다. 이는 진정한 효과가 없거나 심각하게 힘이 부족한 연구를 의미합니다.";
    color = '#f59e0b';
  }

  document.getElementById('pcurveResults').innerHTML = `
    <div class="statistic-card" style="border-color:${color}40;background:${color}20;">
      <div style="font-size:1.2rem;font-weight:bold;color:${color};">${interpretation}</div>
      <div style="margin-top:1rem;font-size:0.9rem;">
        P < 0.025: ${below025} studies (${(below025/pvals.length*100).toFixed(0)}%) |
        P >= 0.025: ${above025} studies (${(above025/pvals.length*100).toFixed(0)}%)
      </div>
    </div>
  `;
}

// Utility functions
function normalCDF(x) {
  const a1 =  0.254829592, a2 = -0.284496736, a3 = 1.421413741;
  const a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911;
  const sign = x < 0 ? -1 : 1;
  x = Math.abs(x) / Math.sqrt(2);
  const t = 1.0 / (1.0 + p * x);
  const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
  return 0.5 * (1.0 + sign * y);
}

// First set of tCDF/incompleteBeta/betaCF/lgamma removed (duplicate of lines below with different arg order)
// The canonical versions with correct negative-t handling are defined after the Failsafe N tool.

// Failsafe N Calculator Tool
function renderFailsafeTool(containerId) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = `
    <div class="tool-description">Calculate Rosenthal's Fail-Safe N — the number of null studies needed to make your result non-significant.</div>
    <div class="tool-controls" style="flex-direction:column;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
        <div class="tool-control">
          <label>Number of Studies (k)</label>
          <input type="number" id="failsafeK" value="15" min="2" max="200" style="width:100%;">
        </div>
        <div class="tool-control">
          <label>Mean Z-score (or enter individual z below)</label>
          <input type="number" id="failsafeMeanZ" value="2.5" step="0.1" style="width:100%;">
        </div>
      </div>
      <div class="tool-control" style="margin-top:1rem;">
        <label>OR enter individual Z-scores (comma-separated):</label>
        <input type="text" id="failsafeZscores" placeholder="2.1, 3.4, 1.8, 2.9, ..." style="width:100%;">
      </div>
      <button onclick="runFailsafeN()" style="margin-top:1rem;padding:0.75rem 1.5rem;background:var(--teal);border:none;border-radius:8px;color:white;cursor:pointer;font-weight:600;">Calculate Fail-Safe N</button>
    </div>
    <div id="failsafeResults" style="margin-top:1.5rem;"></div>
  `;
}

function runFailsafeN() {
  let k, sumZ, meanZ;

  const zScoresInput = document.getElementById('failsafeZscores').value.trim();

  if (zScoresInput) {
    const zScores = zScoresInput.split(',').map(z => parseFloat(z.trim())).filter(z => !isNaN(z));
    k = zScores.length;
    sumZ = zScores.reduce((a, b) => a + b, 0);
    meanZ = sumZ / k;
  } else {
    k = parseInt(document.getElementById('failsafeK').value);
    meanZ = parseFloat(document.getElementById('failsafeMeanZ').value);
    sumZ = k * meanZ;
  }

  if (k < 2) {
    document.getElementById('failsafeResults').innerHTML = '<p style="color:#dc2626;">Need at least 2 studies.</p>';
    return;
  }

  // Rosenthal's Fail-Safe N formula: N = (sum(Z) / 1.645)^2 - k
  // Or equivalently: N = k * (meanZ / 1.645)^2 - k
  const criticalZ = 1.645; // one-tailed p = 0.05
  const failsafeN = Math.max(0, Math.pow(sumZ / criticalZ, 2) - k);
  const roundedN = Math.ceil(failsafeN);

  // Interpretation thresholds
  const threshold5k1 = 5 * k + 10; // Rosenthal's rule: N > 5k + 10 is robust
  const isRobust = roundedN > threshold5k1;

  const robustColor = isRobust ? '#22c55e' : '#dc2626';
  const robustText = isRobust
    ? `ROBUST: Fail-Safe N (${roundedN}) exceeds 5k + 10 (${threshold5k1}). Would need ${roundedN} null studies to nullify the effect.`
    : `FRAGILE: Fail-Safe N (${roundedN}) is less than 5k + 10 (${threshold5k1}). Result may be vulnerable to publication bias.`;

  document.getElementById('failsafeResults').innerHTML = `
    <div class="statistic-card" style="border-color:${robustColor}40;background:${robustColor}20;">
      <div style="font-size:3rem;font-weight:bold;color:${robustColor};">${roundedN}</div>
      <div style="font-size:1rem;margin-top:0.5rem;">Fail-Safe N (Rosenthal)</div>
    </div>
    <div style="margin-top:1rem;padding:1rem;background:rgba(0,0,0,0.2);border-radius:8px;">
      <strong style="color:${robustColor};">${robustText}</strong>
      <div style="margin-top:1rem;font-size:0.9rem;color:rgba(255,255,255,0.7);">
        <strong>Interpretation:</strong> ${roundedN} unpublished null studies would need to exist in file drawers to reduce your meta-analytic effect to non-significance.
      </div>
      <div style="margin-top:0.75rem;font-size:0.85rem;color:rgba(255,255,255,0.5);">
        <strong>Caveat:</strong> Fail-Safe N is criticized for assuming missing studies have exactly zero effect. Modern methods (selection models, trim-and-fill) are preferred. Use Fail-Safe N as a quick heuristic, not definitive evidence.
      </div>
    </div>
    <div style="margin-top:1rem;padding:1rem;background:rgba(124,58,237,0.1);border-radius:8px;font-size:0.85rem;">
      <strong>Formula:</strong> N = (ΣZ / 1.645)² - k = (${sumZ.toFixed(2)} / 1.645)² - ${k} = ${failsafeN.toFixed(1)}
    </div>
  `;
}

// PET-PEESE Calculator Tool
function renderPetPeeseTool(containerId) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = `
    <div class="tool-description">Calculate PET-PEESE bias-corrected effect estimates from your meta-analysis data.</div>
    <div style="margin:1rem 0;">
      <label style="display:block;margin-bottom:0.5rem;color:var(--gold);">Enter study data (one per line: effect, SE)</label>
      <textarea id="petpeeseData" rows="8" placeholder="0.45, 0.12
0.32, 0.15
0.58, 0.18
0.21, 0.22
0.67, 0.11" style="width:100%;padding:0.75rem;background:rgba(0,0,0,0.3);border:1px solid var(--gold);border-radius:8px;color:white;font-family:monospace;"></textarea>
      <p style="font-size:0.8rem;color:rgba(255,255,255,0.5);margin-top:0.5rem;">Format: effect size, standard error (comma separated, one study per line)</p>
    </div>
    <button onclick="runPetPeese()" style="padding:0.75rem 1.5rem;background:var(--purple);border:none;border-radius:8px;color:white;cursor:pointer;font-weight:600;">Calculate PET-PEESE</button>
    <div id="petpeeseResults" style="margin-top:1.5rem;"></div>
  `;
}

function runPetPeese() {
  const dataText = document.getElementById('petpeeseData').value.trim();
  const lines = dataText.split('\n').filter(l => l.trim());

  if (lines.length < 5) {
    document.getElementById('petpeeseResults').innerHTML = '<p style="color:#dc2626;">Need at least 5 studies for reliable PET-PEESE estimates.</p>';
    return;
  }

  // Parse data
  const studies = [];
  for (const line of lines) {
    const [effect, se] = line.split(',').map(v => parseFloat(v.trim()));
    if (!isNaN(effect) && !isNaN(se) && se > 0) {
      studies.push({ effect, se, var: se * se });
    }
  }

  if (studies.length < 5) {
    document.getElementById('petpeeseResults').innerHTML = '<p style="color:#dc2626;">Could not parse enough valid data. Check format.</p>';
    return;
  }

  const k = studies.length;

  // Calculate weighted means for reference
  const weights = studies.map(s => 1 / s.var);
  const sumW = weights.reduce((a, b) => a + b, 0);
  const naiveEffect = studies.reduce((sum, s, i) => sum + weights[i] * s.effect, 0) / sumW;

  // PET: effect = b0 + b1 * SE (weighted by 1/variance)
  // Simple weighted least squares
  const meanSE = studies.reduce((sum, s, i) => sum + weights[i] * s.se, 0) / sumW;
  const ssxx_pet = studies.reduce((sum, s, i) => sum + weights[i] * Math.pow(s.se - meanSE, 2), 0);
  const ssxy_pet = studies.reduce((sum, s, i) => sum + weights[i] * (s.se - meanSE) * (s.effect - naiveEffect), 0);
  const b1_pet = ssxy_pet / ssxx_pet;
  const b0_pet = naiveEffect - b1_pet * meanSE;

  // Calculate SE of intercept for PET (proper WLS: Var(b0) = MSE * sum(w*x^2) / det)
  const residuals_pet = studies.map(s => s.effect - (b0_pet + b1_pet * s.se));
  const mse_pet = residuals_pet.reduce((sum, r, i) => sum + weights[i] * r * r, 0) / (k - 2);
  const sumWx2_pet = studies.reduce((sum, s, i) => sum + weights[i] * s.se * s.se, 0);
  const sumWx_pet = studies.reduce((sum, s, i) => sum + weights[i] * s.se, 0);
  const det_pet = sumW * sumWx2_pet - sumWx_pet * sumWx_pet;
  const se_b0_pet = Math.sqrt(mse_pet * sumWx2_pet / det_pet);
  const t_pet = b0_pet / se_b0_pet;
  const p_pet = 2 * (1 - tCDF(Math.abs(t_pet), k - 2));

  // PEESE: effect = b0 + b1 * variance
  const meanVar = studies.reduce((sum, s, i) => sum + weights[i] * s.var, 0) / sumW;
  const ssxx_peese = studies.reduce((sum, s, i) => sum + weights[i] * Math.pow(s.var - meanVar, 2), 0);
  const ssxy_peese = studies.reduce((sum, s, i) => sum + weights[i] * (s.var - meanVar) * (s.effect - naiveEffect), 0);
  const b1_peese = ssxy_peese / ssxx_peese;
  const b0_peese = naiveEffect - b1_peese * meanVar;

  // Calculate SE of intercept for PEESE (proper WLS)
  const residuals_peese = studies.map(s => s.effect - (b0_peese + b1_peese * s.var));
  const mse_peese = residuals_peese.reduce((sum, r, i) => sum + weights[i] * r * r, 0) / (k - 2);
  const sumWx2_peese = studies.reduce((sum, s, i) => sum + weights[i] * s.var * s.var, 0);
  const sumWx_peese = studies.reduce((sum, s, i) => sum + weights[i] * s.var, 0);
  const det_peese = sumW * sumWx2_peese - sumWx_peese * sumWx_peese;
  const se_b0_peese = Math.sqrt(mse_peese * sumWx2_peese / det_peese);

  // Conditional estimator: Use PET to test, PEESE to estimate
  const petSignificant = p_pet < 0.10;
  const conditionalEffect = petSignificant ? b0_peese : b0_pet;
  const conditionalLabel = petSignificant ? 'PEESE (true effect likely exists)' : 'PET (no evidence for true effect)';

  // Calculate percent reduction
  const reduction = ((naiveEffect - conditionalEffect) / naiveEffect * 100).toFixed(1);

  document.getElementById('petpeeseResults').innerHTML = `
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem;">
      <div style="padding:1rem;background:rgba(59,130,246,0.2);border-radius:8px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:bold;color:#3b82f6;">${naiveEffect.toFixed(3)}</div>
        <div style="font-size:0.85rem;">Naive (Uncorrected)</div>
      </div>
      <div style="padding:1rem;background:rgba(168,85,247,0.2);border-radius:8px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:bold;color:#a855f7;">${b0_pet.toFixed(3)}</div>
        <div style="font-size:0.85rem;">PET Intercept</div>
        <div style="font-size:0.75rem;color:rgba(255,255,255,0.5);">p = ${p_pet.toFixed(3)}</div>
      </div>
      <div style="padding:1rem;background:rgba(236,72,153,0.2);border-radius:8px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:bold;color:#ec4899;">${b0_peese.toFixed(3)}</div>
        <div style="font-size:0.85rem;">PEESE Intercept</div>
      </div>
    </div>

    <div style="padding:1.5rem;background:rgba(34,197,94,0.2);border:2px solid rgba(34,197,94,0.4);border-radius:12px;margin-bottom:1.5rem;">
      <div style="font-size:0.9rem;color:#4ade80;margin-bottom:0.5rem;">CONDITIONAL ESTIMATE (Recommended)</div>
      <div style="font-size:2.5rem;font-weight:bold;color:#22c55e;">${conditionalEffect.toFixed(3)}</div>
      <div style="font-size:0.9rem;margin-top:0.5rem;">${conditionalLabel}</div>
      <div style="font-size:0.85rem;color:rgba(255,255,255,0.6);margin-top:0.5rem;">
        Bias correction: ${reduction > 0 ? reduction + '% reduction' : Math.abs(reduction) + '% increase'} from naive estimate
      </div>
    </div>

    <div style="padding:1rem;background:rgba(0,0,0,0.2);border-radius:8px;font-size:0.9rem;">
      <strong>Interpretation:</strong><br>
      ${petSignificant
        ? `PET intercept is significant (p=${p_pet.toFixed(3)} < 0.10), suggesting a true effect exists after accounting for bias. Use PEESE estimate (${b0_peese.toFixed(3)}) as the bias-corrected effect.`
        : `PET intercept is not significant (p=${p_pet.toFixed(3)} >= 0.10), suggesting no reliable evidence for a true effect after accounting for publication bias. The apparent effect may be largely due to bias.`
      }
    </div>

    <div style="margin-top:1rem;padding:1rem;background:rgba(124,58,237,0.1);border-radius:8px;font-size:0.8rem;color:rgba(255,255,255,0.6);">
      <strong>Technical notes:</strong> PET-PEESE uses weighted least squares with inverse-variance weights. The two-step conditional estimator tests for true effect with PET (threshold p<0.10), then uses PEESE if effect exists. With ${k} studies, these estimates have ${k < 10 ? 'limited' : 'moderate'} reliability.
    </div>
  `;
}

// Simple t-distribution CDF approximation
function tCDF(t, df) {
  const x = df / (df + t * t);
  const a = df / 2;
  const b = 0.5;
  // Incomplete beta function approximation
  if (t < 0) return 0.5 * incompleteBeta(x, a, b);
  return 1 - 0.5 * incompleteBeta(x, a, b);
}

function incompleteBeta(x, a, b) {
  // Simple approximation using continued fraction
  const bt = Math.exp(
    lgamma(a + b) - lgamma(a) - lgamma(b) + a * Math.log(x) + b * Math.log(1 - x)
  );
  if (x < (a + 1) / (a + b + 2)) {
    return bt * betacf(x, a, b) / a;
  }
  return 1 - bt * betacf(1 - x, b, a) / b;
}

function betacf(x, a, b) {
  const maxIt = 100;
  const eps = 1e-8;
  let qab = a + b;
  let qap = a + 1;
  let qam = a - 1;
  let c = 1;
  let d = 1 - qab * x / qap;
  if (Math.abs(d) < 1e-30) d = 1e-30;
  d = 1 / d;
  let h = d;
  for (let m = 1; m <= maxIt; m++) {
    let m2 = 2 * m;
    let aa = m * (b - m) * x / ((qam + m2) * (a + m2));
    d = 1 + aa * d;
    if (Math.abs(d) < 1e-30) d = 1e-30;
    c = 1 + aa / c;
    if (Math.abs(c) < 1e-30) c = 1e-30;
    d = 1 / d;
    h *= d * c;
    aa = -(a + m) * (qab + m) * x / ((a + m2) * (qap + m2));
    d = 1 + aa * d;
    if (Math.abs(d) < 1e-30) d = 1e-30;
    c = 1 + aa / c;
    if (Math.abs(c) < 1e-30) c = 1e-30;
    d = 1 / d;
    let del = d * c;
    h *= del;
    if (Math.abs(del - 1) < eps) break;
  }
  return h;
}

function lgamma(x) {
  const c = [76.18009172947146, -86.50532032941677, 24.01409824083091,
    -1.231739572450155, 0.001208650973866179, -0.000005395239384953];
  let y = x;
  let tmp = x + 5.5;
  tmp -= (x + 0.5) * Math.log(tmp);
  let ser = 1.000000000190015;
  for (let j = 0; j < 6; j++) ser += c[j] / ++y;
  return -tmp + Math.log(2.5066282746310005 * ser / x);
}

// Registry Gap Tool (placeholder visualization)
function renderRegistryTool(containerId) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = `
    <div style="text-align:center;padding:2rem;">
      <div style="font-size:4rem;margin-bottom:1rem;">🔍</div>
      <h3 style="color:var(--gold);margin-bottom:1rem;">Registry Gap Analysis</h3>
      <p style="color:rgba(255,255,255,0.7);margin-bottom:2rem;">Compare registered vs. published trials to identify evidence gaps.</p>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:2rem;text-align:center;">
        <div style="padding:1.5rem;background:rgba(59,130,246,0.2);border-radius:12px;border:1px solid rgba(59,130,246,0.4);">
          <div style="font-size:2.5rem;font-weight:bold;color:#3b82f6;">23</div>
          <div>Registered Trials</div>
        </div>
        <div style="padding:1.5rem;background:rgba(22,163,74,0.2);border-radius:12px;border:1px solid rgba(22,163,74,0.4);">
          <div style="font-size:2.5rem;font-weight:bold;color:#22c55e;">15</div>
          <div>Published Results</div>
        </div>
      </div>
      <div style="margin-top:2rem;padding:1.5rem;background:rgba(220,38,38,0.2);border-radius:12px;border:1px solid rgba(220,38,38,0.4);">
        <div style="font-size:2rem;font-weight:bold;color:#dc2626;">8 Missing</div>
        <div>Trials completed but never published (35%)</div>
      </div>
      <p style="margin-top:1.5rem;font-size:0.9rem;color:rgba(255,255,255,0.5);">
        Search ClinicalTrials.gov for your intervention to identify potential missing studies.
      </p>
    </div>
  `;
}

// ============================================================
// CORE COURSE FUNCTIONALITY
// ============================================================
const STORAGE_KEY = 'publicationBiasDetective_v1';

let state = {
  currentModule: 0,
  currentSlide: 0,
  completedModules: [],
  certificateShown: false
};

function loadState() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) state = { ...state, ...JSON.parse(saved) };
  } catch (e) {
    console.warn('Corrupt state, using defaults');
  }
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function initCourse() {
  loadState();
  renderModuleList();
  renderSlide();
  updateProgress();

  // Keyboard navigation handled by setupKeyboardNavigation() — no duplicate listener here
}

function renderModuleList() {
  const list = document.getElementById('moduleList');
  list.innerHTML = modules.map((m, i) => `
    <div class="module-item ${i === state.currentModule ? 'active' : ''} ${state.completedModules.includes(i) ? 'completed' : ''}"
         onclick="goToModule(${i})">
      <div class="module-number">${i}</div>
      <div class="module-info">
        <div class="module-title">${m.title}</div>
        <div class="module-subtitle">${m.subtitle}</div>
        ${m.estimatedMinutes ? `<div class="module-time">${m.estimatedMinutes} min</div>` : ''}
      </div>
    </div>
  `).join('');
}

function renderSlide() {
  const module = modules[state.currentModule];
  const slide = module.slides[state.currentSlide];
  const container = document.getElementById('main-content');

  document.getElementById('moduleIndicator').textContent = `Case File ${module.id}: ${module.title}`;
  document.getElementById('slideCounter').textContent = `${state.currentSlide + 1} / ${module.slides.length}`;

  container.innerHTML = `<div class="slide active animate-in">${renderSlideContent(slide)}</div>`;

  document.getElementById('prevBtn').disabled = state.currentSlide === 0;
  document.getElementById('nextBtn').disabled = state.currentSlide === module.slides.length - 1;

  // Initialize tools
  setTimeout(() => {
    if (slide.type === 'tool-funnel') renderFunnelTool(slide.content.id);
    if (slide.type === 'tool-contour') renderContourTool(slide.content.id);
    if (slide.type === 'tool-egger') renderEggerTool(slide.content.id);
    if (slide.type === 'tool-trimfill') renderTrimFillTool(slide.content.id);
    if (slide.type === 'tool-petpeese') renderPetPeeseTool(slide.content.id);
    if (slide.type === 'tool-pcurve') renderPCurveTool(slide.content.id);
    if (slide.type === 'tool-registry') renderRegistryTool(slide.content.id);
    if (slide.type === 'tool-failsafe') renderFailsafeTool(slide.content.id);
  }, 100);
}

function renderSlideContent(slide) {
  switch(slide.type) {
    case 'title':
      const isMainTitle = slide.content.title === "Publication Bias Detective";
      const readingLevelHtml = isMainTitle ? `
        <div style="margin-top:1.5rem;">
          <span class="reading-level">Reading Level: Graduate/Professional</span>
        </div>
        <p style="font-size:0.85rem;color:rgba(255,255,255,0.5);margin-top:0.75rem;">
          Total Course Time: ~3 hours | Best for: Researchers, Clinicians, Systematic Reviewers
        </p>
      ` : '';
      return `<div style="text-align:center;padding:3rem;">
        <h1 class="slide-title" style="font-size:2.5rem;border:none;">${slide.content.title}</h1>
        <p style="font-size:1.3rem;color:var(--gold);margin-bottom:1.5rem;">${slide.content.subtitle}</p>
        <p style="font-size:1.1rem;opacity:0.8;max-width:600px;margin:0 auto;">${slide.content.text}</p>
        ${readingLevelHtml}
      </div>`;

    case 'principle':
      return `<div class="principle-display">
        <div class="principle-number">${slide.content.number}</div>
        <p class="principle-text">"${slide.content.text}"</p>
      </div>`;

    case 'rhetoric':
      return `<div class="rhetoric-question">${slide.content.question}</div>`;

    case 'case-file':
      return `<div class="case-file">
        <div class="case-file-header">
          <span class="case-number">${slide.content.caseNumber}</span>
          <div>
            <div class="case-title">${slide.content.title}</div>
            <div class="case-source">${slide.content.source}</div>
          </div>
        </div>
        <div class="evidence-timeline">
          ${slide.content.timeline.map(e => `
            <div class="timeline-event ${e.type || ''}">
              <div class="timeline-year">${e.year}</div>
              <div class="timeline-text">${e.text}</div>
            </div>
          `).join('')}
        </div>
        ${slide.content.realData ? `
          <div style="margin-top:1.5rem;padding:1rem;background:rgba(0,0,0,0.2);border-radius:8px;">
            <strong style="color:var(--gold);">Evidence Summary:</strong>
            <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:0.5rem;margin-top:0.75rem;">
              ${Object.entries(slide.content.realData).map(([k,v]) => `
                <div><span style="color:rgba(255,255,255,0.6);">${k}:</span> ${v}</div>
              `).join('')}
            </div>
          </div>
        ` : ''}
      </div>`;

    case 'statistic-card':
      return `<div class="statistic-card">
        <div class="statistic-value">${slide.content.value}</div>
        <div class="statistic-label">${slide.content.label}</div>
        <div class="statistic-context">${slide.content.context}</div>
      </div>`;

    case 'death-toll':
      return `<div class="death-toll">
        <div class="death-toll-number">${slide.content.number}</div>
        <div class="death-toll-label">${slide.content.label}</div>
        <div class="death-toll-source">${slide.content.source}</div>
      </div>`;

    case 'oath':
      return `<div class="oath-box">
        <div class="oath-header">${slide.content.header}</div>
        <div class="oath-text">${slide.content.text}</div>
      </div>`;

    case 'contrast':
      return `<div>
        <h2 class="slide-title">${slide.content.title}</h2>
        <div class="contrast-box">
          <div class="contrast-side dark">
            <div class="contrast-header">${slide.content.darkSide.header}</div>
            <ul class="contrast-items">
              ${slide.content.darkSide.items.map(i => `<li>${i}</li>`).join('')}
            </ul>
            <div class="contrast-consequence">${slide.content.darkSide.consequence}</div>
          </div>
          <div class="contrast-side light">
            <div class="contrast-header">${slide.content.lightSide.header}</div>
            <ul class="contrast-items">
              ${slide.content.lightSide.items.map(i => `<li>${i}</li>`).join('')}
            </ul>
            <div class="contrast-consequence">${slide.content.lightSide.consequence}</div>
          </div>
        </div>
      </div>`;

    case 'content':
      return `<div>
        <h2 class="slide-title">${slide.content.title}</h2>
        ${slide.content.sections.map(s => `
          <div class="method-box">
            <h3>${s.heading}</h3>
            ${s.items ? `<ul>${s.items.map(i => `<li>${i}</li>`).join('')}</ul>` : ''}
          </div>
        `).join('')}
      </div>`;

    case 'decision-tree':
      return renderDecisionTree(slide.content);

    case 'clinical-guide':
      return `<div class="clinical-guide">
        <h3>${slide.content.title}</h3>
        <ul>${slide.content.items.map(i => `<li>${i}</li>`).join('')}</ul>
      </div>`;

    case 'cycle-return':
      return `<div class="cycle-return">
        <p style="font-size:0.8rem;color:var(--gold);text-transform:uppercase;margin-bottom:0.5rem;">Return to the Principle</p>
        <p class="principle-recall">"${slide.content.principle}"</p>
      </div>`;

    case 'quiz':
      return renderQuiz(slide.content);

    case 'tool-funnel':
    case 'tool-contour':
    case 'tool-egger':
    case 'tool-trimfill':
    case 'tool-pcurve':
    case 'tool-registry':
    case 'tool-failsafe':
    case 'tool-petpeese':
      return `<div class="tool-panel">
        <div class="tool-header">
          <span class="tool-icon">🔧</span>
          <span class="tool-title">${slide.content.title}</span>
        </div>
        <p class="tool-description">${slide.content.description}</p>
        <div id="${slide.content.id}"></div>
      </div>`;

    case 'learning-objectives':
      return `<div class="learning-objectives">
        <div class="learning-objectives-header">
          <span class="objectives-icon">🎯</span>
          <span>Learning Objectives</span>
        </div>
        <p style="margin-bottom:1rem;opacity:0.9;">${slide.content.intro || 'By the end of this module, you will be able to:'}</p>
        <ul>
          ${slide.content.objectives.map(obj => `<li>${obj}</li>`).join('')}
        </ul>
      </div>`;

    case 'key-takeaways':
      return `<div class="key-takeaways">
        <div class="key-takeaways-header">
          <span class="takeaways-icon">✅</span>
          <span>Key Takeaways</span>
        </div>
        <ul>
          ${slide.content.takeaways.map(t => `<li>${t}</li>`).join('')}
        </ul>
        ${slide.content.actionItem ? `
          <div class="action-item">
            <strong>Action Item:</strong> ${slide.content.actionItem}
          </div>
        ` : ''}
      </div>`;

    case 'common-mistakes':
      return `<div class="common-mistakes">
        <div class="mistakes-header">
          <span class="mistakes-icon">⚠️</span>
          <span>Common Mistakes to Avoid</span>
        </div>
        <ul>
          ${slide.content.mistakes.map(m => `<li><strong>${m.mistake}:</strong> ${m.correction}</li>`).join('')}
        </ul>
      </div>`;

    case 'patient-communication':
      return `<div class="patient-communication">
        <div class="communication-header">
          <span class="communication-icon">💬</span>
          <span>Patient Communication Script</span>
        </div>
        <div class="scenario">${slide.content.scenario}</div>
        <div class="script-box">
          <div class="script-label">What to say:</div>
          <div class="script-text">"${slide.content.script}"</div>
        </div>
        ${slide.content.keyPoints ? `
          <div class="key-points">
            <strong>Key communication points:</strong>
            <ul>${slide.content.keyPoints.map(p => `<li>${p}</li>`).join('')}</ul>
          </div>
        ` : ''}
      </div>`;

    case 'protagonist-story':
      return `<div class="protagonist-story">
        <div class="protagonist-header">
          <div class="protagonist-name">${slide.content.name}</div>
          <div class="protagonist-role">${slide.content.role}</div>
        </div>
        <div class="protagonist-narrative">${slide.content.narrative}</div>
        ${slide.content.quote ? `
          <blockquote class="protagonist-quote">"${slide.content.quote}"</blockquote>
        ` : ''}
        ${slide.content.impact ? `
          <div class="protagonist-impact">
            <strong>Impact:</strong> ${slide.content.impact}
          </div>
        ` : ''}
      </div>`;

    case 'legal-disclaimer':
      return `<div class="legal-disclaimer">
        <div class="disclaimer-header">
          <span class="disclaimer-icon">⚖️</span>
          <span>Important Legal Notice</span>
        </div>
        <div class="disclaimer-text">${slide.content.text}</div>
        ${slide.content.resources ? `
          <div class="disclaimer-resources">
            <strong>Resources:</strong>
            <ul>${slide.content.resources.map(r => `<li><a href="${r.url}" target="_blank">${r.name}</a></li>`).join('')}</ul>
          </div>
        ` : ''}
      </div>`;

    case 'printable-checklist':
      return `<div class="printable-checklist">
        <div class="checklist-header">
          <span class="checklist-icon">📋</span>
          <span>${slide.content.title}</span>
        </div>
        <p class="print-instruction">Print this checklist to use when reading meta-analyses</p>
        ${slide.content.sections.map(section => `
          <div class="checklist-section">
            <h4>${section.heading}</h4>
            <ul>
              ${section.items.map(item => `<li><input type="checkbox" class="checklist-box"> ${item}</li>`).join('')}
            </ul>
          </div>
        `).join('')}
        <button class="print-btn" onclick="window.print()">🖨️ Print Checklist</button>
      </div>`;

    case 'practice-case':
      return `<div class="practice-case">
        <div class="practice-header">
          <span class="practice-icon">🔬</span>
          <span>Practice Case: ${slide.content.title}</span>
        </div>
        <div class="case-scenario">${slide.content.scenario}</div>
        ${slide.content.data ? `
          <div class="sample-data">
            <h4>Sample Data:</h4>
            <table class="data-table">
              <thead><tr>${slide.content.data.headers.map(h => `<th>${h}</th>`).join('')}</tr></thead>
              <tbody>${slide.content.data.rows.map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`).join('')}</tbody>
            </table>
          </div>
        ` : ''}
        <div class="practice-questions">
          <h4>Questions to consider:</h4>
          <ol>${slide.content.questions.map(q => `<li>${q}</li>`).join('')}</ol>
        </div>
        ${slide.content.answers ? `
          <details class="answers-reveal">
            <summary>Reveal Answers</summary>
            <ol>${slide.content.answers.map(a => `<li>${a}</li>`).join('')}</ol>
          </details>
        ` : ''}
      </div>`;

    case 'pre-assessment':
      return `<div class="pre-assessment">
        <div class="assessment-header">
          <span class="assessment-icon">📝</span>
          <span>Pre-Assessment: Test Your Current Knowledge</span>
        </div>
        <p>${slide.content.intro}</p>
        <div id="preAssessmentQuiz"></div>
      </div>`;

    case 'redemption-story':
      return `<div class="redemption-story">
        <div class="redemption-header">
          <span class="redemption-icon">🌟</span>
          <span>A Different Path: ${slide.content.title}</span>
        </div>
        <div class="redemption-narrative">${slide.content.narrative}</div>
        <div class="redemption-lesson">
          <strong>The Lesson:</strong> ${slide.content.lesson}
        </div>
      </div>`;

    case 'story':
      return `<div class="story-container">
        <div class="story-opening">${slide.content.opening}</div>

        <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;">
          <span style="background:var(--evidence-red);color:white;padding:0.5rem 1rem;border-radius:4px;font-weight:700;font-size:0.8rem;text-transform:uppercase;">Story ${slide.content.storyNumber}</span>
          <div>
            <h2 style="font-family:'Cormorant Garamond',serif;font-size:1.8rem;color:var(--gold);margin:0;">${slide.content.title}</h2>
            <p style="font-size:0.85rem;color:rgba(255,255,255,0.6);margin:0;">${slide.content.caseId}</p>
          </div>
        </div>

        <div class="stats-box">
          <div class="stats-box-header">
            <span style="font-size:1.2rem;">📊</span>
            ${slide.content.stats.header}
          </div>
          ${slide.content.stats.items.map(item => `
            <div class="stat-item">
              <div class="stat-value">${item.value}</div>
              <div class="stat-label">${item.label}</div>
            </div>
          `).join('')}
        </div>

        <div class="interactive-decision-tree">
          <div class="decision-scenario">
            <div class="decision-scenario-title">${slide.content.scenario.title}</div>
            <p style="margin:0;line-height:1.7;">${slide.content.scenario.text}</p>
          </div>

          <div class="decision-path path-a" tabindex="0" role="button" onclick="this.classList.toggle('expanded')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.classList.toggle('expanded');}">
            <div class="path-header">
              <span style="font-size:1.2rem;">❌</span>
              ${slide.content.pathA.header}
              <span class="path-arrow">→</span>
            </div>
            <p style="margin:0.5rem 0;font-style:italic;color:rgba(255,255,255,0.8);">${slide.content.pathA.action}</p>
            <div class="story-timeline" style="margin:1rem 0;">
              ${slide.content.pathA.steps.map((step, i) => `
                <div class="timeline-step ${i === slide.content.pathA.steps.length - 1 ? 'danger' : ''}">
                  <div class="step-label">Step ${i + 1}</div>
                  <div class="step-content">${step}</div>
                </div>
              `).join('')}
            </div>
            <div class="path-consequence">
              <strong style="color:#fca5a5;">Consequence:</strong> ${slide.content.pathA.consequence}
            </div>
          </div>

          <div class="decision-path path-b" tabindex="0" role="button" onclick="this.classList.toggle('expanded')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.classList.toggle('expanded');}">
            <div class="path-header">
              <span style="font-size:1.2rem;">✓</span>
              ${slide.content.pathB.header}
              <span class="path-arrow">→</span>
            </div>
            <p style="margin:0.5rem 0;font-style:italic;color:rgba(255,255,255,0.8);">${slide.content.pathB.action}</p>
            <div class="story-timeline" style="margin:1rem 0;">
              ${slide.content.pathB.steps.map((step, i) => `
                <div class="timeline-step ${i === slide.content.pathB.steps.length - 1 ? 'success' : ''}">
                  <div class="step-label">Step ${i + 1}</div>
                  <div class="step-content">${step}</div>
                </div>
              `).join('')}
            </div>
            <div class="path-consequence">
              <strong style="color:#86efac;">Consequence:</strong> ${slide.content.pathB.consequence}
            </div>
          </div>
        </div>

        <div class="revelation-box">
          <div class="revelation-header">✦ ${slide.content.revelation.header} ✦</div>
          <p class="revelation-text">${slide.content.revelation.text}</p>
          <p class="revelation-detail">${slide.content.revelation.detail}</p>
        </div>

        <div class="story-refrain">
          <p>"${slide.content.refrain}"</p>
        </div>
      </div>`;

    default:
      return `<p>Unknown slide type: ${slide.type}</p>`;
  }
}

// Store current decision tree nodes to avoid XSS risk from inline JSON
let currentDecisionNodes = [];

function renderDecisionTree(content) {
  // Store nodes in module-level variable for safe access
  currentDecisionNodes = content.nodes;
  return `<div class="decision-tree">
    <div class="decision-title">${content.title}</div>
    <div class="decision-situation">${content.situation}</div>
    <div id="decisionContent" aria-live="polite" aria-atomic="true">${renderDecisionNode(content.nodes[0])}</div>
  </div>`;
}

function renderDecisionNode(node) {
  if (node.type === 'outcome') {
    return `<div class="decision-outcome ${node.consequence}">
      <div class="outcome-title">${node.title}</div>
      <div class="outcome-text">${node.text}</div>
      <div class="outcome-case">${node.realCase}</div>
    </div>`;
  }

  return `<div class="decision-node">
    <div class="decision-question">${node.question}</div>
    <div class="decision-branches">
      ${node.branches.map(b => `
        <button class="decision-branch" data-next-node="${b.nextNode}" onclick="selectDecisionBranch(this.dataset.nextNode)" tabindex="0">
          ${b.text}
        </button>
      `).join('')}
    </div>
  </div>`;
}

function selectDecisionBranch(nodeId) {
  const node = currentDecisionNodes.find(n => n.id === nodeId);
  if (node) {
    document.getElementById('decisionContent').innerHTML = renderDecisionNode(node);
  }
}

function renderQuiz(content) {
  const quizKey = `${state.currentModule}-${state.currentSlide}`;
  return `<div class="quiz-container">
    <div class="quiz-question">${content.question}</div>
    <div class="quiz-options">
      ${content.options.map(opt => `
        <div class="quiz-option" data-id="${opt.id}" onclick="selectQuizOption('${opt.id}', ${opt.correct}, this)">
          ${opt.text}
        </div>
      `).join('')}
    </div>
    <div class="quiz-explanation">${content.explanation}</div>
  </div>`;
}

function selectQuizOption(id, correct, element) {
  document.querySelectorAll('.quiz-option').forEach(o => {
    o.style.pointerEvents = 'none';
    const module = modules[state.currentModule];
    const slide = module.slides[state.currentSlide];
    const opt = slide.content.options.find(op => op.id === o.dataset.id);
    if (opt?.correct) o.classList.add('correct');
  });
  if (!correct) element.classList.add('incorrect');
  document.querySelector('.quiz-explanation').classList.add('visible');
}

function prevSlide() {
  if (state.currentSlide > 0) {
    state.currentSlide--;
    renderSlide();
    saveState();
  }
}

function nextSlide() {
  const module = modules[state.currentModule];
  if (state.currentSlide < module.slides.length - 1) {
    state.currentSlide++;
    renderSlide();
    saveState();
    checkCourseCompletion();
  }
}

function goToModule(index) {
  if (index !== state.currentModule) {
    if (state.currentSlide === modules[state.currentModule].slides.length - 1 &&
        !state.completedModules.includes(state.currentModule)) {
      state.completedModules.push(state.currentModule);
    }
    state.currentModule = index;
    state.currentSlide = 0;
    renderModuleList();
    renderSlide();
    updateProgress();
    saveState();
  }
}

function updateProgress() {
  const percent = Math.round((state.completedModules.length / modules.length) * 100);
  document.getElementById('progressPercent').textContent = `${percent}%`;
  document.getElementById('progressFill').style.width = `${percent}%`;
}

function openGlossary() {
  document.getElementById('glossaryOverlay').classList.add('open');
  renderGlossary();
}

function closeGlossary() {
  document.getElementById('glossaryOverlay').classList.remove('open');
}

function renderGlossary(filter = '') {
  const filtered = glossaryTerms.filter(t =>
    t.term.toLowerCase().includes(filter.toLowerCase()) ||
    t.def.toLowerCase().includes(filter.toLowerCase())
  );
  document.getElementById('glossaryContent').innerHTML = filtered.map(t => `
    <div class="glossary-term">
      <strong style="color:var(--gold);">${t.term}</strong><br>
      <span style="color:rgba(255,255,255,0.7);">${t.def}</span>
    </div>
  `).join('');
}

function filterGlossary() {
  renderGlossary(document.getElementById('glossarySearch').value);
}

// ============================================================
// THEME TOGGLE (Dark/Light Mode)
// ============================================================
function toggleTheme() {
  const body = document.body;
  const toggle = document.getElementById('themeToggle');
  const isLight = body.classList.toggle('light-mode');
  toggle.textContent = isLight ? '☀️' : '🌙';
  toggle.setAttribute('aria-label', isLight ? 'Switch to dark mode' : 'Switch to light mode');
  localStorage.setItem('pubBiasTheme', isLight ? 'light' : 'dark');
}

function loadTheme() {
  const saved = localStorage.getItem('pubBiasTheme');
  if (saved === 'light') {
    document.body.classList.add('light-mode');
    document.getElementById('themeToggle').textContent = '☀️';
  }
}

// ============================================================
// CERTIFICATE OF COMPLETION
// ============================================================
function checkCourseCompletion() {
  // Check if all modules are completed
  if (state.completedModules.length >= modules.length - 1) {
    // Check if on last slide of last module
    const lastModule = modules[modules.length - 1];
    if (state.currentModule === modules.length - 1 &&
        state.currentSlide === lastModule.slides.length - 1 &&
        !state.certificateShown) {
      state.certificateShown = true;
      saveState();
      setTimeout(() => {
        document.getElementById('nameInputModal').classList.add('open');
        document.getElementById('investigatorName').focus();
      }, 1000);
    }
  }
}

function generateCertificate() {
  const name = document.getElementById('investigatorName').value.trim();
  if (!name) {
    alert('Please enter your name to generate the certificate.');
    return;
  }

  // Close name input modal
  document.getElementById('nameInputModal').classList.remove('open');

  // Generate certificate ID
  const certId = 'PBD-' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substr(2, 4).toUpperCase();

  // Format date
  const date = new Date().toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  // Update certificate
  document.getElementById('certName').textContent = name;
  document.getElementById('certDate').textContent = `Completed on: ${date}`;
  document.getElementById('certId').textContent = `Certificate ID: ${certId}`;

  // Show certificate
  document.getElementById('certificateOverlay').classList.add('open');
}

function closeCertificate() {
  document.getElementById('certificateOverlay').classList.remove('open');
}

function printCertificate() {
  const cert = document.getElementById('certificateContainer');
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Publication Bias Detective - Certificate</title>
      <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Source+Sans+Pro:wght@400;600&display=swap" rel="stylesheet">
      <style>
        body {
          margin: 0; padding: 2rem;
          font-family: 'Source Sans Pro', sans-serif;
          display: flex; justify-content: center; align-items: center;
          min-height: 100vh; background: #f5f5f5;
        }
        .cert {
          background: linear-gradient(135deg, #fdf6e3 0%, #fff8dc 50%, #fdf6e3 100%);
          border: 8px double #d4af37;
          border-radius: 12px;
          padding: 3rem;
          max-width: 700px;
          text-align: center;
          position: relative;
        }
        .seal {
          position: absolute; top: -30px; left: 50%;
          transform: translateX(-50%);
          width: 60px; height: 60px;
          background: linear-gradient(135deg, #d4af37, #c5a028);
          border-radius: 50%;
          display: flex; align-items: center; justify-content: center;
          font-size: 1.8rem;
        }
        h1 {
          font-family: 'Cormorant Garamond', serif;
          font-size: 2.5rem; color: #1e3a5f;
          text-transform: uppercase; letter-spacing: 0.15em;
          margin-top: 1rem;
        }
        .subtitle { color: #666; margin-bottom: 1.5rem; }
        .body { font-size: 1.1rem; color: #333; line-height: 1.8; margin: 1.5rem 0; }
        .name {
          font-family: 'Cormorant Garamond', serif;
          font-size: 2rem; font-weight: 700; color: #991b1b;
          border-bottom: 2px solid #d4af37;
          display: inline-block; padding: 0 2rem 0.5rem; margin: 1rem 0;
        }
        .date { font-size: 0.9rem; color: #666; margin-top: 1.5rem; }
        .id { font-size: 0.75rem; color: #999; margin-top: 0.5rem; font-family: monospace; }
        @media print {
          body { background: white; }
          .cert { box-shadow: none; }
        }
      </style>
    </head>
    <body>
      <div class="cert">
        <div class="seal">🏆</div>
        <h1>Certificate of Completion</h1>
        <p class="subtitle">Publication Bias Detective Training Program</p>
        <div class="body">
          <p>This is to certify that</p>
          <div class="name">${document.getElementById('certName').textContent}</div>
          <p>has successfully completed the</p>
          <p><strong style="color: #1e3a5f; font-size: 1.2rem;">Publication Bias Detective Course</strong></p>
          <p>demonstrating proficiency in identifying, assessing, and mitigating publication bias in systematic reviews and meta-analyses.</p>
        </div>
        <div class="date">${document.getElementById('certDate').textContent}</div>
        <div class="id">${document.getElementById('certId').textContent}</div>
      </div>
    </body>
    </html>
  `);
  printWindow.document.close();
  setTimeout(() => printWindow.print(), 500);
}

// ============================================================
// PDF EXPORT FOR CHECKLIST
// ============================================================
function exportChecklistPDF() {
  const checklistContent = `
PUBLICATION BIAS DETECTION CHECKLIST
=====================================

BEFORE STARTING
[ ] Registered protocol (PROSPERO) with bias assessment plan
[ ] Pre-specified primary outcome
[ ] Comprehensive search strategy including grey literature

SEARCH EXECUTION
[ ] Multiple databases (PubMed, Embase, Cochrane, etc.)
[ ] ClinicalTrials.gov + WHO ICTRP for registered trials
[ ] Conference abstracts and dissertations
[ ] Contact authors for unpublished data
[ ] No language restrictions (or justify if restricted)

VISUAL ASSESSMENT
[ ] Funnel plot (if ≥10 studies)
[ ] Contour-enhanced funnel plot
[ ] Doi plot with LFK index

STATISTICAL TESTS
[ ] Egger's test (continuous outcomes)
[ ] Harbord's or Peters' test (binary outcomes)
[ ] Begg's rank correlation
[ ] Document: k = ___, Egger p = ___

SENSITIVITY ANALYSES
[ ] Trim-and-fill (report adjusted estimate)
[ ] PET-PEESE (report conditional estimate)
[ ] Selection models (3PSM if available)
[ ] Compare with registered trial results

REPORTING
[ ] PRISMA flow diagram with reasons for exclusion
[ ] Table comparing published vs. unpublished studies
[ ] GRADE assessment for publication bias
[ ] Plain-language summary of bias impact

INTERPRETATION TEMPLATE
"Publication bias assessment: [Visual inspection / Statistical tests]
[suggested / did not suggest] the presence of small-study effects.
Sensitivity analyses [adjusted the pooled estimate from X to Y /
did not substantially change the results]. The certainty of evidence
was [downgraded / not downgraded] for publication bias."
`;

  // Create and download text file
  const blob = new Blob([checklistContent], { type: 'text/plain' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'publication-bias-checklist.txt';
  link.click();
  URL.revokeObjectURL(link.href);
}

// ============================================================
// SERVICE WORKER FOR OFFLINE ACCESS
// ============================================================
function registerServiceWorker() {
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      // Create inline service worker
      const swCode = `
const CACHE_NAME = 'pub-bias-detective-v1';
const urlsToCache = [
  './',
  './publication-bias-detective.html'
];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(urlsToCache))
  );
});

self.addEventListener('fetch', event => {
  event.respondWith(
    caches.match(event.request)
      .then(response => {
        if (response) return response;
        return fetch(event.request).then(response => {
          if (!response || response.status !== 200) return response;
          const responseToCache = response.clone();
          caches.open(CACHE_NAME).then(cache => {
            cache.put(event.request, responseToCache);
          });
          return response;
        });
      })
  );
});
`;

      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);

      navigator.serviceWorker.register(swUrl)
        .then(reg => console.log('Service Worker registered for offline access'))
        .catch(err => console.log('Service Worker registration skipped:', err.message));
    });
  }
}

// ============================================================
// KEYBOARD NAVIGATION ENHANCEMENT
// ============================================================
function setupKeyboardNavigation() {
  document.addEventListener('keydown', (e) => {
    // Arrow key navigation for slides
    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
      if (!e.target.matches('input, textarea, select')) {
        nextSlide();
      }
    } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
      if (!e.target.matches('input, textarea, select')) {
        prevSlide();
      }
    } else if (e.key === 'Escape') {
      closeGlossary();
      closeCertificate();
      document.getElementById('nameInputModal').classList.remove('open');
    }
  });

  // Make module items keyboard focusable
  document.querySelectorAll('.module-item').forEach((item, index) => {
    item.setAttribute('tabindex', '0');
    item.setAttribute('role', 'button');
    item.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        goToModule(index);
      }
    });
  });
}

// ============================================================
// SCORM/LMS COMPATIBILITY WRAPPER
// ============================================================
const SCORM = {
  initialized: false,

  init: function() {
    // Check for SCORM API
    if (typeof window.API !== 'undefined' || typeof window.API_1484_11 !== 'undefined') {
      const api = window.API_1484_11 || window.API;
      if (api) {
        api.Initialize('');
        this.initialized = true;
        // SCORM API initialized
      }
    }
    return this.initialized;
  },

  setProgress: function(percent) {
    if (!this.initialized) return;
    const api = window.API_1484_11 || window.API;
    if (api) {
      api.SetValue('cmi.progress_measure', (percent / 100).toFixed(2));
      api.Commit('');
    }
  },

  setComplete: function() {
    if (!this.initialized) return;
    const api = window.API_1484_11 || window.API;
    if (api) {
      api.SetValue('cmi.completion_status', 'completed');
      api.SetValue('cmi.success_status', 'passed');
      api.Commit('');
    }
  },

  terminate: function() {
    if (!this.initialized) return;
    const api = window.API_1484_11 || window.API;
    if (api) {
      api.Terminate('');
    }
  }
};

// Hook SCORM into progress updates
const originalUpdateProgress = updateProgress;
updateProgress = function() {
  originalUpdateProgress();
  const percent = Math.round((state.completedModules.length / modules.length) * 100);
  SCORM.setProgress(percent);
  if (percent >= 100) {
    SCORM.setComplete();
  }
};

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
  loadTheme();
  SCORM.init();
  registerServiceWorker();
  setTimeout(setupKeyboardNavigation, 100);
});

// Terminate SCORM on page unload
window.addEventListener('beforeunload', () => {
  SCORM.terminate();
});

document.addEventListener('DOMContentLoaded', initCourse);
</script>
<!-- Floating Glossary Button (visible on mobile) -->
<button aria-label="Open Glossary" class="floating-glossary" onclick="openGlossary()">
  📖
</button>
</body>
</html>
