<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Hidden Patient: A Course on Individual Participant Data Meta-Analysis</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Fallback fonts for offline use */
    @font-face {
      font-family: 'Cormorant Garamond';
      src: local('Cormorant Garamond'), local('Georgia'), local('Times New Roman');
      font-display: swap;
    }
    @font-face {
      font-family: 'Source Sans Pro';
      src: local('Source Sans Pro'), local('Segoe UI'), local('Arial');
      font-display: swap;
    }

    :root {
      --navy: #1E2761;
      --deep-navy: #141B3D;
      --gold: #D4AF37;
      --cream: #FAF8F5;
      --light-cream: #FFFFFF;
      --text: #2D3748;
      --light-text: #718096;
      --red: #C53030;
      --green: #22c55e;
      --teal: #00D4AA;
      --purple: #A855F7;
      --orange: #F97316;
      --blue: #3B82F6;
      --blood-red: #8B0000;
      --transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* Accessibility: Skip link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--gold);
      color: var(--navy);
      padding: 8px 16px;
      z-index: 1000;
      font-weight: 600;
      text-decoration: none;
      border-radius: 0 0 4px 0;
    }
    .skip-link:focus {
      top: 0;
    }

    /* Accessibility: Focus indicators */
    *:focus {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }
    *:focus:not(:focus-visible) {
      outline: none;
    }
    *:focus-visible {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }

    /* Accessibility: Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      .slide { transition: none; }
    }

    /* Accessibility: Screen reader only */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Accessibility: Live region for announcements */
    .aria-live-region {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    html, body {
      height: 100%;
      font-family: 'Source Sans Pro', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--deep-navy);
      color: var(--cream);
    }

    .course-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar */
    .sidebar {
      width: 300px;
      background: linear-gradient(180deg, var(--deep-navy) 0%, #0a0f1a 100%);
      border-right: 1px solid rgba(212,175,55,0.2);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    /* mobile sidebar handled by hamburger toggle below */

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .sidebar-header h1 {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.25rem;
    }

    .sidebar-header p {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
    }

    .module-list {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
    }

    .module-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .module-item:hover { background: rgba(212,175,55,0.1); }
    .module-item.active { background: rgba(212,175,55,0.15); border-left-color: var(--gold); }
    .module-item.completed .module-number { background: var(--green); color: white; }

    .module-number {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .module-item.active .module-number { background: var(--gold); color: var(--navy); }

    .module-info { flex: 1; min-width: 0; }
    .module-title { font-size: 0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .module-subtitle { font-size: 0.7rem; color: rgba(255,255,255,0.7); }

    .sidebar-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(212,175,55,0.2);
      font-size: 0.7rem;
      color: rgba(255,255,255,0.4);
      line-height: 1.4;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .content-header {
      padding: 1rem 2rem;
      background: rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(212,175,55,0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .breadcrumb { font-size: 0.85rem; color: rgba(255,255,255,0.6); }
    .breadcrumb span { color: var(--gold); }

    .header-actions { display: flex; gap: 0.5rem; }

    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover { background: rgba(212,175,55,0.2); border-color: var(--gold); }
    .btn:focus-visible { box-shadow: 0 0 0 3px rgba(212,175,55,0.5); }
    .btn.primary { background: var(--gold); color: var(--navy); border-color: var(--gold); font-weight: 600; }
    .btn.primary:focus-visible { box-shadow: 0 0 0 3px rgba(212,175,55,0.7); }

    .content-body { flex: 1; overflow: hidden; display: flex; }

    /* Slides */
    .slides-container { flex: 1; position: relative; overflow: hidden; }

    .module-slides { display: none; width: 100%; height: 100%; }
    .module-slides.active { display: block; }

    .slide {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 2rem 2rem 4rem 2rem;
      padding-top: 3rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition), visibility var(--transition);
      overflow-y: auto;
      overflow-x: hidden;
    }

    .slide .content { margin-top: auto; margin-bottom: auto; }
    .slide > * { max-width: 100%; word-wrap: break-word; }
    .slide.active { opacity: 1; visibility: visible; }

    .slide.dark { background: var(--deep-navy); color: var(--cream); }
    .slide.light { background: var(--cream); color: var(--text); }
    .slide.black { background: #000; color: var(--cream); }
    .slide.gradient { background: linear-gradient(135deg, var(--deep-navy) 0%, #2a1a4a 100%); color: var(--cream); }
    .slide.blood { background: linear-gradient(135deg, #1a0a0a 0%, #2d1515 100%); color: var(--cream); }
    .slide.hope { background: linear-gradient(135deg, #0a1a0a 0%, #152d15 100%); color: var(--cream); }
    .slide.ipd { background: linear-gradient(135deg, #0a1a2d 0%, #152d3d 100%); color: var(--cream); }
    .slide.precision { background: linear-gradient(135deg, #1a0a2d 0%, #2d153d 100%); color: var(--cream); }

    /* Typography */
    .serif { font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif; }

    .title {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: clamp(1.8rem, 5vw, 3.5rem);
      font-weight: 700;
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .title.navy { color: var(--navy); }
    .title.gold { color: var(--gold); }
    .title.cream { color: var(--cream); }
    .title.red { color: var(--red); }
    .title.green { color: var(--green); }
    .title.blue { color: var(--blue); }
    .title.purple { color: var(--purple); }

    .subtitle {
      font-size: clamp(1rem, 2vw, 1.5rem);
      color: var(--light-text);
      margin-bottom: 2rem;
    }

    .slide.dark .subtitle { color: rgba(255,255,255,0.7); }

    .big-number {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: clamp(4rem, 15vw, 10rem);
      font-weight: 700;
      line-height: 1;
    }

    .big-number.navy { color: var(--navy); }
    .big-number.gold { color: var(--gold); }
    .big-number.red { color: var(--red); }
    .big-number.green { color: var(--green); }
    .big-number.blue { color: var(--blue); }

    /* Refrain */
    .refrain {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: clamp(1.4rem, 4vw, 2.5rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      max-width: 800px;
      line-height: 1.4;
    }

    .refrain.warning {
      color: var(--red);
      border-left: 4px solid var(--red);
      padding-left: 1.5rem;
      text-align: left;
    }

    .refrain.hope { color: var(--green); }
    .refrain.insight { color: var(--blue); }

    /* Rhetorical */
    .rhetorical {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: clamp(1.2rem, 3vw, 2rem);
      color: rgba(255,255,255,0.9);
      text-align: center;
      max-width: 700px;
      line-height: 1.5;
    }

    .rhetorical em { color: var(--gold); font-style: normal; }

    /* Simple explanation box */
    .simple-box {
      background: linear-gradient(135deg, rgba(0,212,170,0.1), rgba(0,0,0,0.2));
      border: 2px solid var(--teal);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 600px;
      margin: 1rem 0;
    }

    .simple-box.blue {
      background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(0,0,0,0.2));
      border-color: var(--blue);
    }

    .simple-box.purple {
      background: linear-gradient(135deg, rgba(168,85,247,0.1), rgba(0,0,0,0.2));
      border-color: var(--purple);
    }

    .simple-box .simple-title {
      color: var(--teal);
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      margin-bottom: 0.75rem;
    }

    .simple-box.blue .simple-title { color: var(--blue); }
    .simple-box.purple .simple-title { color: var(--purple); }

    .simple-box .simple-text {
      font-size: 1.1rem;
      line-height: 1.6;
    }

    .simple-box .simple-text strong { color: var(--gold); }

    /* Story card */
    .story-card {
      background: rgba(0,0,0,0.3);
      border-left: 4px solid var(--gold);
      padding: 1.5rem 2rem;
      max-width: 700px;
      margin: 1rem 0;
    }

    .story-card .place {
      font-size: 0.75rem;
      color: var(--gold);
      letter-spacing: 0.1em;
      margin-bottom: 0.5rem;
    }

    .story-card .narrative {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.1rem;
      line-height: 1.6;
      color: rgba(255,255,255,0.9);
    }

    .story-card .source {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.5);
      margin-top: 1rem;
      font-style: italic;
    }

    /* Decision Tree */
    .decision-tree {
      background: rgba(0,0,0,0.3);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 800px;
      width: 100%;
    }

    .decision-tree h4 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.1rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .tree-level {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin: 0.5rem 0;
      position: relative;
      flex-wrap: wrap;
    }

    .tree-node {
      background: var(--navy);
      border: 2px solid var(--gold);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      text-align: center;
      min-width: 120px;
      font-size: 0.8rem;
    }

    .tree-node.root { background: var(--gold); color: var(--navy); font-weight: 700; }
    .tree-node.question { background: rgba(168,85,247,0.3); border-color: var(--purple); }
    .tree-node.yes { background: rgba(34,197,94,0.3); border-color: var(--green); }
    .tree-node.no { background: rgba(197,48,48,0.3); border-color: var(--red); }
    .tree-node.ipd { background: rgba(59,130,246,0.3); border-color: var(--blue); }
    .tree-node.aggregate { background: rgba(249,115,22,0.3); border-color: var(--orange); }
    .tree-node.action { background: var(--teal); color: var(--navy); font-weight: 600; }

    .tree-arrow {
      color: var(--gold);
      font-size: 1.5rem;
      text-align: center;
    }

    .tree-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.7);
      text-align: center;
      margin-top: 0.25rem;
    }

    /* Comparison boxes */
    .compare-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      max-width: 800px;
      width: 100%;
    }

    @media (max-width: 600px) { .compare-grid { grid-template-columns: 1fr; } }

    .compare-box {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 1.5rem;
      border: 2px solid;
    }

    .compare-box.aggregate { border-color: var(--orange); }
    .compare-box.ipd { border-color: var(--blue); }

    .compare-box h4 {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
    }

    .compare-box.aggregate h4 { color: var(--orange); }
    .compare-box.ipd h4 { color: var(--blue); }

    .compare-box ul {
      list-style: none;
      font-size: 0.85rem;
      line-height: 1.8;
    }

    .compare-box li::before {
      content: "‚Ä¢ ";
      color: var(--gold);
    }

    /* Stats */
    .stats-grid {
      display: flex;
      gap: 1rem;
      margin: 1.5rem 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .stat-box {
      background: var(--navy);
      color: var(--cream);
      padding: 1rem 1.5rem;
      text-align: center;
      min-width: 130px;
      border-radius: 8px;
    }

    .stat-value {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: clamp(1.4rem, 3vw, 2rem);
      font-weight: 700;
    }

    .stat-label { font-size: 0.7rem; opacity: 0.8; margin-top: 0.25rem; }

    /* Death toll */
    .death-toll {
      background: linear-gradient(135deg, rgba(197,48,48,0.3), rgba(0,0,0,0.5));
      border: 2px solid var(--red);
      padding: 2rem;
      text-align: center;
      max-width: 400px;
      border-radius: 12px;
    }

    .death-toll .number {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 4rem;
      font-weight: 700;
      color: var(--red);
    }

    .death-toll .label {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      margin-top: 0.5rem;
    }

    /* Discovery box */
    .discovery-box {
      background: linear-gradient(135deg, rgba(59,130,246,0.3), rgba(0,0,0,0.5));
      border: 2px solid var(--blue);
      padding: 2rem;
      text-align: center;
      max-width: 450px;
      border-radius: 12px;
    }

    .discovery-box .insight {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 2rem;
      font-weight: 700;
      color: var(--blue);
    }

    .discovery-box .label {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      margin-top: 0.5rem;
    }

    /* Lesson items */
    .lesson-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin: 0.6rem 0;
      max-width: 800px;
      text-align: left;
    }

    .lesson-number {
      background: var(--gold);
      color: var(--navy);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
      border-radius: 4px;
    }

    .lesson-content h4 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--cream);
      margin-bottom: 0.2rem;
    }

    .lesson-content p { font-size: 0.85rem; color: rgba(255,255,255,0.7); }

    /* Formula box */
    .formula-box {
      background: rgba(0,0,0,0.4);
      border: 1px solid var(--purple);
      border-radius: 8px;
      padding: 1rem 1.5rem;
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.2rem;
      text-align: center;
      max-width: 600px;
      margin: 1rem 0;
    }

    .formula-box .formula {
      color: var(--gold);
      margin: 0.5rem 0;
      font-size: 1.1rem;
    }

    .formula-box .label {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
      font-family: 'Source Sans Pro', sans-serif;
    }

    /* Patient silhouettes */
    .patient-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      max-width: 400px;
      justify-content: center;
      padding: 1rem;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
    }

    .patient-icon {
      font-size: 1.2rem;
      opacity: 0.7;
    }

    .patient-icon.highlighted {
      opacity: 1;
      filter: drop-shadow(0 0 4px var(--gold));
    }

    .patient-icon.responder { color: var(--green); }
    .patient-icon.non-responder { color: var(--red); }
    .patient-icon.hidden { color: var(--orange); opacity: 0.4; }

    /* Timeline */
    .timeline {
      max-width: 600px;
      width: 100%;
    }

    .timeline-item {
      display: flex;
      gap: 1rem;
      margin: 1rem 0;
      padding-left: 1rem;
      border-left: 3px solid var(--gold);
    }

    .timeline-year {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--gold);
      min-width: 60px;
    }

    .timeline-content {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
    }

    /* Gold line */
    .gold-line { width: 150px; height: 2px; background: var(--gold); margin: 1.5rem auto; }

    /* Content wrapper */
    .content {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 1000px;
    }

    /* Animation */
    .slide.active .animate { animation: fadeUp 0.6s ease-out forwards; }
    .slide.active .animate.delay-1 { animation-delay: 0.1s; }
    .slide.active .animate.delay-2 { animation-delay: 0.2s; }
    .slide.active .animate.delay-3 { animation-delay: 0.3s; }
    .slide.active .animate.delay-4 { animation-delay: 0.4s; }
    .slide.active .animate.delay-5 { animation-delay: 0.5s; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate { opacity: 0; }

    /* Slide Nav */
    .slide-nav {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      padding: 1rem 1rem 1.5rem 1rem;
      z-index: 100;
      pointer-events: none;
    }

    .nav-btn {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 1.25rem;
      cursor: pointer;
      opacity: 0.6;
      transition: all 0.2s;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      pointer-events: auto;
    }

    .nav-btn:hover { opacity: 1; background: rgba(0,0,0,0.7); border-color: var(--gold); }

    .nav-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      pointer-events: auto;
    }

    .slide-counter { color: rgba(255,255,255,0.6); font-size: 0.85rem; min-width: 50px; text-align: center; }
    .progress { display: flex; gap: 4px; flex-wrap: wrap; justify-content: center; max-width: 200px; }

    .progress-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: rgba(255,255,255,0.25);
      cursor: pointer;
      transition: all 0.2s;
    }

    .progress-dot.active { background: var(--gold); transform: scale(1.3); }
    .progress-dot:hover { background: rgba(255,255,255,0.6); }

    /* Quiz */
    .quiz-container {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(212,175,55,0.3);
      padding: 1.5rem;
      max-width: 700px;
      width: 100%;
      border-radius: 8px;
    }

    .quiz-question {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: var(--gold);
      line-height: 1.4;
    }

    .quiz-options { display: flex; flex-direction: column; gap: 0.5rem; }

    .quiz-option {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      border-radius: 6px;
      font-size: 0.9rem;
    }

    .quiz-option:hover { background: rgba(212,175,55,0.1); border-color: var(--gold); }
    .quiz-option.correct { background: rgba(34,197,94,0.2); border-color: var(--green); }
    .quiz-option.incorrect { background: rgba(197,48,48,0.2); border-color: var(--red); }

    .quiz-feedback {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      display: none;
      font-size: 0.9rem;
    }

    .quiz-feedback.show { display: block; }
    .quiz-feedback.correct { background: rgba(34,197,94,0.2); border: 1px solid var(--green); }
    .quiz-feedback.incorrect { background: rgba(197,48,48,0.2); border: 1px solid var(--red); }

    /* Branching Scenario */
    .scenario-panel {
      background: rgba(0,0,0,0.3);
      border: 2px solid var(--purple);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 750px;
      width: 100%;
    }

    .scenario-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .scenario-icon { font-size: 1.5rem; }

    .scenario-title {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.3rem;
      color: var(--gold);
    }

    .scenario-situation {
      font-size: 0.95rem;
      line-height: 1.6;
      margin-bottom: 1rem;
      color: rgba(255,255,255,0.9);
    }

    .scenario-question {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.1rem;
      color: var(--gold);
      margin-bottom: 1rem;
    }

    .scenario-choices {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .scenario-choice {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: all 0.2s;
      border-radius: 6px;
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .scenario-choice:hover { background: rgba(212,175,55,0.1); border-color: var(--gold); }
    .scenario-choice.answered { pointer-events: none; opacity: 0.6; }
    .scenario-choice.correct { background: rgba(34,197,94,0.2); border-color: var(--green); opacity: 1; }
    .scenario-choice.incorrect { background: rgba(197,48,48,0.2); border-color: var(--red); opacity: 1; }

    .choice-letter {
      background: var(--navy);
      color: var(--gold);
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-weight: 700;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .choice-text { font-size: 0.9rem; line-height: 1.4; }

    .scenario-consequence {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      display: none;
    }

    .scenario-consequence.visible { display: block; }
    .scenario-consequence.good { background: rgba(34,197,94,0.15); border: 1px solid var(--green); }
    .scenario-consequence.bad { background: rgba(197,48,48,0.15); border: 1px solid var(--red); }
    .scenario-consequence.neutral { background: rgba(249,115,22,0.15); border: 1px solid var(--orange); }

    .consequence-title {
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .scenario-consequence.good .consequence-title { color: var(--green); }
    .scenario-consequence.bad .consequence-title { color: var(--red); }
    .scenario-consequence.neutral .consequence-title { color: var(--orange); }

    .consequence-text { font-size: 0.9rem; line-height: 1.5; margin-bottom: 0.75rem; }
    .consequence-lesson { font-style: italic; color: var(--gold); font-size: 0.85rem; }

    /* References */
    .references {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 8px;
      padding: 1.5rem;
      max-width: 700px;
      text-align: left;
      font-size: 0.75rem;
      line-height: 1.8;
    }

    .references h4 {
      color: var(--gold);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .references ol { padding-left: 1.5rem; }
    .references li { margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); }
    .references .journal { font-style: italic; }

    .text-center { text-align: center; }
    .mb-1 { margin-bottom: 1rem; }
    .mb-2 { margin-bottom: 2rem; }
    .mt-1 { margin-top: 1rem; }
    .mt-2 { margin-top: 2rem; }

    /* Interactive element focus states */
    .module-item:focus-visible {
      background: rgba(212,175,55,0.2);
      outline: 2px solid var(--gold);
      outline-offset: -2px;
    }
    .nav-btn:focus-visible {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
      opacity: 1;
    }
    .progress-dot:focus-visible {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
      transform: scale(1.5);
    }
    .quiz-option:focus-visible,
    .scenario-choice:focus-visible {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
      background: rgba(212,175,55,0.15);
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
      :root {
        --gold: #FFD700;
        --cream: #FFFFFF;
        --text: #000000;
      }
      .btn { border-width: 2px; }
      .slide.dark, .slide.black { background: #000; }
    }

    /* Print stylesheet */
    @media print {
      .sidebar, .content-header, .slide-nav, .header-actions { display: none !important; }
      .course-container { display: block; height: auto; }
      .main-content { overflow: visible; }
      .content-body { overflow: visible; }
      .slides-container { overflow: visible; position: static; }
      .module-slides { display: block !important; }
      .slide {
        position: static !important;
        opacity: 1 !important;
        visibility: visible !important;
        page-break-inside: avoid;
        page-break-after: always;
        min-height: 100vh;
        background: white !important;
        color: black !important;
      }
      .slide * { color: black !important; }
      .title { color: #1E2761 !important; }
      .refrain, .gold-line { color: #8B7500 !important; }
      .simple-box, .story-card, .decision-tree, .compare-box {
        border: 2px solid #333 !important;
        background: #f5f5f5 !important;
      }
    }

    /* Light theme */
    body.light-theme {
      --deep-navy: #f5f5f5;
      --navy: #e8e8e8;
      --cream: #1a1a2e;
      --text: #2D3748;
      --light-text: #4a5568;
    }
    body.light-theme .sidebar {
      background: linear-gradient(180deg, #f0f0f0 0%, #e0e0e0 100%);
      border-right-color: rgba(30,39,97,0.2);
    }
    body.light-theme .sidebar-header h1 { color: var(--navy); }
    body.light-theme .module-item:hover { background: rgba(30,39,97,0.1); }
    body.light-theme .module-item.active { background: rgba(30,39,97,0.15); border-left-color: #1E2761; }
    body.light-theme .module-number { background: rgba(30,39,97,0.1); color: #1E2761; }
    body.light-theme .module-item.active .module-number { background: #1E2761; color: white; }
    body.light-theme .module-title { color: #1a1a2e; }
    body.light-theme .module-subtitle { color: #4a5568; }
    body.light-theme .content-header { background: rgba(0,0,0,0.05); border-bottom-color: rgba(30,39,97,0.2); }
    body.light-theme .breadcrumb { color: #4a5568; }
    body.light-theme .breadcrumb span { color: #1E2761; }
    body.light-theme .btn { background: rgba(30,39,97,0.05); color: #1a1a2e; border-color: rgba(30,39,97,0.3); }
    body.light-theme .btn:hover { background: rgba(30,39,97,0.15); }
    body.light-theme .btn.primary { background: #1E2761; color: white; }
    body.light-theme .slide.dark,
    body.light-theme .slide.black,
    body.light-theme .slide.gradient,
    body.light-theme .slide.blood,
    body.light-theme .slide.hope,
    body.light-theme .slide.ipd,
    body.light-theme .slide.precision {
      background: #fafafa;
      color: #1a1a2e;
    }
    body.light-theme .title.gold { color: #1E2761; }
    body.light-theme .title.cream { color: #1a1a2e; }
    body.light-theme .refrain { color: #1E2761; }
    body.light-theme .refrain.warning { color: #C53030; border-left-color: #C53030; }
    body.light-theme .refrain.hope { color: #166534; }
    body.light-theme .refrain.insight { color: #1E40AF; }
    body.light-theme .rhetorical { color: #1a1a2e; }
    body.light-theme .rhetorical em { color: #1E2761; }
    body.light-theme .simple-box { background: linear-gradient(135deg, rgba(0,212,170,0.1), rgba(240,240,240,0.8)); }
    body.light-theme .story-card { background: rgba(0,0,0,0.03); }
    body.light-theme .story-card .narrative { color: #2D3748; }
    body.light-theme .decision-tree { background: rgba(0,0,0,0.03); }
    body.light-theme .nav-btn { background: rgba(0,0,0,0.1); color: #1a1a2e; border-color: rgba(0,0,0,0.2); }
    body.light-theme .slide-counter { color: #4a5568; }
    body.light-theme .progress-dot { background: rgba(0,0,0,0.2); }
    body.light-theme .progress-dot.active { background: #1E2761; }
    body.light-theme .sidebar-footer { color: #4a5568; }
    body.light-theme .gold-line { background: #1E2761; }

    /* Certificate Modal */
    .certificate-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }
    .certificate-modal.visible { display: flex; }
    .certificate {
      background: linear-gradient(135deg, #faf8f5 0%, #fff 100%);
      border: 8px solid #D4AF37;
      border-radius: 12px;
      padding: 3rem;
      max-width: 700px;
      width: 90%;
      text-align: center;
      position: relative;
      box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    }
    .certificate-header {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 2.5rem;
      color: #1E2761;
      margin-bottom: 0.5rem;
    }
    .certificate-subtitle {
      font-size: 1rem;
      color: #718096;
      margin-bottom: 2rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }
    .certificate-body {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.2rem;
      color: #2D3748;
      line-height: 1.8;
      margin-bottom: 2rem;
    }
    .certificate-name {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 2rem;
      font-weight: 700;
      color: #1E2761;
      border-bottom: 2px solid #D4AF37;
      display: inline-block;
      padding: 0 2rem 0.5rem;
      margin: 1rem 0;
    }
    .certificate-date {
      font-size: 0.9rem;
      color: #718096;
      margin-top: 1.5rem;
    }
    .certificate-seal {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #D4AF37, #B8860B);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 1.5rem auto 0;
      color: white;
      font-size: 2rem;
      box-shadow: 0 4px 15px rgba(212,175,55,0.4);
    }
    .certificate-actions {
      margin-top: 2rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
    }
    .certificate-actions button {
      padding: 0.75rem 1.5rem;
      border: 2px solid #1E2761;
      border-radius: 6px;
      background: white;
      color: #1E2761;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .certificate-actions button:hover {
      background: #1E2761;
      color: white;
    }
    .certificate-actions button.primary {
      background: #1E2761;
      color: white;
    }
    .certificate-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #718096;
    }
    .certificate-close:hover { color: #1E2761; }

    /* Name input for certificate */
    .certificate-input {
      font-family: 'Cormorant Garamond', Georgia, 'Times New Roman', serif;
      font-size: 1.5rem;
      text-align: center;
      border: none;
      border-bottom: 2px solid #D4AF37;
      background: transparent;
      padding: 0.5rem 1rem;
      width: 80%;
      max-width: 300px;
      color: #1E2761;
    }
    .certificate-input:focus {
      outline: none;
      border-bottom-color: #1E2761;
    }
    .mobile-menu-toggle{display:none;position:fixed;top:12px;left:12px;z-index:1001;background:#1E2761;border:1px solid #D4AF37;color:#D4AF37;width:40px;height:40px;border-radius:8px;font-size:1.2rem;cursor:pointer;align-items:center;justify-content:center;}
    @media(max-width:768px){.mobile-menu-toggle{display:flex;}.sidebar{transform:translateX(-100%);transition:transform 0.3s ease;position:fixed;z-index:1000;height:100vh;}.sidebar.open{transform:translateX(0);}.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:999;}.sidebar-overlay.show{display:block;}}
  </style>
</head>
<body>
  <!-- Skip link for keyboard navigation -->
  <a href="#main-content" class="skip-link">Skip to content</a>
  <button class="mobile-menu-toggle" aria-expanded="false" onclick="toggleSidebar()" aria-label="Toggle navigation menu">&#9776;</button>
  <div class="sidebar-overlay" onclick="document.querySelector('.sidebar').classList.remove('open');this.classList.remove('show');"></div>

  <!-- Live region for screen reader announcements -->
  <div id="ariaLiveRegion" class="aria-live-region" aria-live="polite" aria-atomic="true"></div>

  <!-- Certificate Modal -->
  <div class="certificate-modal" id="certificateModal" role="dialog" aria-labelledby="certTitle" aria-modal="true">
    <div class="certificate" id="certificateContent">
      <button class="certificate-close" onclick="closeCertificate()" aria-label="Close certificate">&times;</button>
      <div class="certificate-header" id="certTitle">Certificate of Completion</div>
      <div class="certificate-subtitle">Individual Participant Data Meta-Analysis</div>
      <div class="certificate-body">
        This certifies that<br>
        <input type="text" class="certificate-input" id="certName" placeholder="Enter your name" aria-label="Your name for certificate">
        <br><br>
        has successfully completed the course<br>
        <strong>"The Hidden Patient: IPD Meta-Analysis"</strong><br>
        demonstrating understanding of individual participant data<br>
        synthesis methods and their clinical applications.
      </div>
      <div class="certificate-date" id="certDate"></div>
      <div class="certificate-seal">‚úì</div>
      <div class="certificate-actions">
        <button onclick="printCertificate()" aria-label="Print certificate">üñ®Ô∏è Print</button>
        <button onclick="downloadCertificate()" class="primary" aria-label="Download certificate as image">üì• Download</button>
      </div>
    </div>
  </div>

  <div class="course-container" aria-label="IPD Meta-Analysis Course">
    <!-- Sidebar Navigation -->
    <nav class="sidebar" role="navigation" aria-label="Course modules">
      <div class="sidebar-header">
        <a href="index.html" style="display:block;font-size:0.7rem;color:rgba(212,175,55,0.7);text-decoration:none;margin-bottom:0.5rem;" onmouseover="this.style.color='#D4AF37'" onmouseout="this.style.color='rgba(212,175,55,0.7)'">&larr; Course Library</a>
        <h1>The Hidden Patient</h1>
        <p>Individual Participant Data Meta-Analysis</p>
      </div>
      <div class="module-list" id="moduleList" role="list" aria-label="Module list"></div>
      <div class="sidebar-footer">
        <div id="progressPercent" aria-live="polite" style="color:var(--gold);margin-bottom:0.5rem;font-weight:600;"></div>
        "In the aggregate, the individual disappears."
        <br><br>
        Every patient has a story. IPD lets you hear it.
        <br><br>
        <details style="font-size:0.65rem;opacity:0.7;">
          <summary style="cursor:pointer;">Keyboard shortcuts</summary>
          <div style="margin-top:0.5rem;">
            ‚Üí / Space: Next slide<br>
            ‚Üê: Previous slide<br>
            Home: First module<br>
            End: Last module
          </div>
        </details>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" role="main">
      <header class="content-header">
        <div class="breadcrumb">
          IPD Course &gt; <span id="currentModule">The Vanishing</span>
        </div>
        <div class="header-actions" role="toolbar" aria-label="Course actions">
          <button class="btn" onclick="toggleTheme()" title="Toggle light/dark mode" aria-label="Toggle theme" id="themeToggle">‚òÄÔ∏è</button>
          <button class="btn" onclick="resetProgress()" title="Start over from the beginning" aria-label="Reset course progress">Reset</button>
          <button class="btn" onclick="goToModule(16)" aria-label="Go to references module">References</button>
          <button class="btn primary" onclick="nextSlide()" aria-label="Continue to next slide">Continue</button>
        </div>
      </header>

      <div class="content-body">
        <div class="slides-container" id="main-content" role="region" aria-label="Course slides" tabindex="-1">

          <!-- ==================== MODULE 1: THE VANISHING (WHY IPD MATTERS) ==================== -->
          <div class="module-slides active" data-module="1">

            <!-- Slide 1.1: Opening -->
            <div class="slide black active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  Have you not seen how a thousand patients<br>
                  can be <em>reduced to a single number</em>,<br>
                  and in that number, <em>lives are erased</em>?
                </div>
              </div>
            </div>

            <!-- Slide 1.2: The Aggregate Illusion -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Aggregate Illusion</div>
                <div class="story-card animate delay-1">
                  <div class="place">EVERY META-ANALYSIS YOU'VE EVER READ</div>
                  <div class="narrative">
                    A meta-analysis reports: "Treatment reduces mortality by 15%."
                    <br><br>
                    But which patients benefited? The young or the old?
                    Those with mild disease or severe? Men or women?
                    <br><br>
                    <strong>The aggregate cannot answer.</strong>
                    <br><br>
                    For within the average, some patients were saved&mdash;and some were harmed.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 1.3: The Hidden Heterogeneity -->
            <div class="slide blood">
              <div class="content text-center">
                <div class="title red animate">What Aggregates Hide</div>
                <div class="patient-grid animate delay-1">
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon non-responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon non-responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon non-responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon non-responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon non-responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon non-responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                  <span class="patient-icon non-responder">&#9679;</span>
                  <span class="patient-icon responder">&#9679;</span>
                </div>
                <p class="animate delay-2" style="margin-top:1rem;font-size:0.9rem;">
                  <span style="color:var(--green);">&#9679; Responders</span> &nbsp;
                  <span style="color:var(--red);">&#9679; Non-responders</span>
                </p>
                <div class="simple-box animate delay-3">
                  <div class="simple-title">THE TRAGEDY</div>
                  <div class="simple-text">
                    "Overall benefit: 30%"<br><br>
                    But <strong>who</strong> are the 30%? Without individual data,
                    we cannot identify the responders from the non-responders.
                    We cannot practice <strong>precision medicine</strong>.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 1.4: The Breast Cancer Revelation -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">Oxford, 1985</div>
                <div class="story-card animate delay-1">
                  <div class="place">EARLY BREAST CANCER TRIALISTS' COLLABORATIVE GROUP</div>
                  <div class="narrative">
                    Richard Peto gathered something unprecedented: the <strong>raw data</strong>
                    on every woman in every tamoxifen trial.
                    <br><br>
                    Not summaries. Not averages. <strong>Each patient, each tumor, each outcome.</strong>
                    <br><br>
                    What he discovered changed breast cancer treatment forever.
                  </div>
                  <div class="source">Early Breast Cancer Trialists' Collaborative Group. Lancet 1988;2:61-72</div>
                </div>
              </div>
            </div>

            <!-- Slide 1.5: The Discovery -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="rhetorical animate">
                  The published trials said:<br>
                  "Tamoxifen works."
                  <br><br>
                  But the <em>individual data</em> revealed:
                </div>
                <div class="discovery-box animate delay-2">
                  <div class="insight">ER+ vs ER&minus;</div>
                  <div class="label">Tamoxifen only worked in estrogen receptor positive tumors</div>
                </div>
                <div class="simple-box animate delay-3">
                  <div class="simple-title">WHAT WAS HIDDEN</div>
                  <div class="simple-text">
                    No single trial was large enough to detect this interaction.
                    Only by combining <strong>individual patient data</strong> from all trials
                    could the truth emerge:<br><br>
                    <strong>Giving tamoxifen to ER&minus; patients was useless.</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 1.6: The Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain insight animate">
                  "In the aggregate, the individual disappears.<br>
                  In the individual, the truth appears.<br>
                  This is why we seek the hidden patient."
                </div>
                <div class="gold-line animate delay-2"></div>
                <p class="animate delay-3" style="color:rgba(255,255,255,0.6);font-style:italic;">
                  This is Individual Participant Data Meta-Analysis.
                </p>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 2: AGGREGATE VS IPD ==================== -->
          <div class="module-slides" data-module="2">

            <!-- Slide 2.1: Opening -->
            <div class="slide dark active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  What is lost when we summarize?<br>
                  What is found when we look closer?
                </div>
              </div>
            </div>

            <!-- Slide 2.2: The Two Approaches -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Two Ways to Synthesize</div>
                <div class="compare-grid animate delay-1">
                  <div class="compare-box aggregate">
                    <h4>Aggregate Data (AD)</h4>
                    <ul>
                      <li>Study-level summaries</li>
                      <li>Effect sizes from publications</li>
                      <li>Mean age, % male, etc.</li>
                      <li>Quick and accessible</li>
                      <li>Cannot see within-study variation</li>
                    </ul>
                  </div>
                  <div class="compare-box ipd">
                    <h4>Individual Participant Data (IPD)</h4>
                    <ul>
                      <li>Patient-level raw data</li>
                      <li>Every participant's characteristics</li>
                      <li>Actual ages, actual outcomes</li>
                      <li>Time-intensive to obtain</li>
                      <li>Can see who responds and who doesn't</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 2.3: The Ecological Fallacy -->
            <div class="slide blood">
              <div class="content text-center">
                <div class="title red animate">The Ecological Fallacy</div>
                <div class="story-card animate delay-1">
                  <div class="place">THE DANGER OF AGGREGATE THINKING</div>
                  <div class="narrative">
                    Imagine two trials of a drug for heart failure.
                    <br><br>
                    Trial A: Mean age 55 years, Effect size 0.70 (benefit)<br>
                    Trial B: Mean age 75 years, Effect size 0.90 (less benefit)
                    <br><br>
                    <strong>Tempting conclusion:</strong> "The drug works better in younger patients."
                    <br><br>
                    <strong>But this could be completely wrong.</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 2.4: Why It's Wrong -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Trap</div>
                <div class="simple-box animate delay-1">
                  <div class="simple-title">ECOLOGICAL FALLACY</div>
                  <div class="simple-text">
                    Within each trial, the relationship between age and treatment effect
                    might be <strong>completely different</strong> from the between-trial relationship.
                    <br><br>
                    Perhaps in Trial A, <em>older</em> patients within that trial responded better.
                    Perhaps in Trial B, <em>younger</em> patients within that trial responded better.
                    <br><br>
                    <strong>You cannot know without individual data.</strong>
                  </div>
                </div>
                <div class="formula-box animate delay-2">
                  <div class="label">THE RULE</div>
                  <div class="formula">Between-study relationships &#8800; Within-study relationships</div>
                  <div class="label">Aggregate data can only show between-study patterns</div>
                </div>
              </div>
            </div>

            <!-- Slide 2.5: What IPD Enables -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">What IPD Enables</div>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number" style="background:var(--blue);">1</div>
                  <div class="lesson-content">
                    <h4>True Effect Modification</h4>
                    <p>Test whether treatment effect varies by patient characteristics (age, biomarkers, disease severity)</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background:var(--blue);">2</div>
                  <div class="lesson-content">
                    <h4>Time-to-Event Analysis</h4>
                    <p>Use actual survival curves, not just hazard ratios. Handle censoring properly.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background:var(--blue);">3</div>
                  <div class="lesson-content">
                    <h4>Consistent Definitions</h4>
                    <p>Standardize outcome definitions, exposure timing, covariate categories across studies</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background:var(--blue);">4</div>
                  <div class="lesson-content">
                    <h4>Subgroup Credibility</h4>
                    <p>Test interactions within studies, avoiding the ecological fallacy</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 2.6: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain animate">
                  "Aggregate data shows the forest.<br>
                  Individual data shows each tree.<br>
                  If you need to know which trees are sick&mdash;<br>
                  you must walk among them."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 3: THE CTT REVELATION (STATINS) ==================== -->
          <div class="module-slides" data-module="3">

            <!-- Slide 3.1: Opening -->
            <div class="slide black active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  Have you not seen how <em>one collaboration</em><br>
                  gathered data on <em>170,000 patients</em><br>
                  and answered questions no single trial could ask?
                </div>
              </div>
            </div>

            <!-- Slide 3.2: The CTT -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">Oxford, 1994-Present</div>
                <div class="story-card animate delay-1">
                  <div class="place">CHOLESTEROL TREATMENT TRIALISTS' COLLABORATION</div>
                  <div class="narrative">
                    The CTT gathered individual data from <strong>every major statin trial</strong>.
                    <br><br>
                    27 trials. 174,149 patients. Every baseline characteristic.
                    Every cardiovascular event. Every death.
                    <br><br>
                    The published trials asked: "Do statins work?"
                    <br><br>
                    The CTT asked: <strong>"For whom do statins work?"</strong>
                  </div>
                  <div class="source">CTT Collaboration. Lancet 2010;376:1670-81</div>
                </div>
              </div>
            </div>

            <!-- Slide 3.3: The Numbers -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Scale of IPD</div>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box">
                    <div class="stat-value" style="color:var(--blue);">27</div>
                    <div class="stat-label">Trials Combined</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value" style="color:var(--gold);">174,149</div>
                    <div class="stat-label">Individual Patients</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value" style="color:var(--teal);">5</div>
                    <div class="stat-label">Years of Data Gathering</div>
                  </div>
                </div>
                <div class="simple-box blue animate delay-2">
                  <div class="simple-title">THE INVESTMENT</div>
                  <div class="simple-text">
                    Gathering IPD takes years of negotiation, data transfer, cleaning, and harmonization.
                    <br><br>
                    But the questions you can answer are <strong>worth the investment</strong>.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 3.4: The Discovery -->
            <div class="slide precision">
              <div class="content text-center">
                <div class="title purple animate">What CTT Discovered</div>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number" style="background:var(--green);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>Benefit Proportional to LDL Reduction</h4>
                    <p>Every 1 mmol/L LDL reduction = 22% lower CV events. True across all subgroups.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background:var(--green);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>No Age Threshold</h4>
                    <p>Benefit continues even in patients >75 years (contradicting earlier AD analyses)</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background:var(--green);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>Primary Prevention Works</h4>
                    <p>Patients without prior CVD benefit proportionally to their baseline risk</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background:var(--red);">&#10007;</div>
                  <div class="lesson-content">
                    <h4>No Cancer Signal</h4>
                    <p>Concerns about statins causing cancer were definitively refuted with IPD follow-up</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 3.5: Why AD Couldn't Answer -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Why Aggregate Data Failed</div>
                <div class="story-card animate delay-1">
                  <div class="place">THE LIMITATION</div>
                  <div class="narrative">
                    Published trials categorized patients differently.
                    <br><br>
                    Trial A: "High risk" = 10-year CVD risk >20%<br>
                    Trial B: "High risk" = Prior MI<br>
                    Trial C: "High risk" = Diabetes
                    <br><br>
                    You cannot compare or combine what is defined differently.
                    <br><br>
                    <strong>IPD allowed the CTT to redefine everyone consistently.</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 3.6: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain hope animate">
                  "When trials speak different languages,<br>
                  IPD provides the translation.<br>
                  What seemed contradictory becomes clear:<br>
                  the same truth, measured differently."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 4: WHEN TO PURSUE IPD (DECISION TREE) ==================== -->
          <div class="module-slides" data-module="4">

            <!-- Slide 4.1: Opening -->
            <div class="slide dark active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  IPD takes <em>years</em> to gather.<br>
                  Aggregate data takes <em>weeks</em>.<br>
                  <br>
                  When is the investment worth it?
                </div>
              </div>
            </div>

            <!-- Slide 4.2: The Decision Framework -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Decision Tree</div>
                <div class="decision-tree animate delay-1">
                  <h4>Should You Pursue IPD?</h4>
                  <div class="tree-level">
                    <div class="tree-node root">Is your question about treatment effect modification?</div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 2rem;">
                    <div>
                      <div class="tree-node yes">YES</div>
                      <div class="tree-label">"Who benefits most?"</div>
                    </div>
                    <div>
                      <div class="tree-node no">NO</div>
                      <div class="tree-label">"Does it work overall?"</div>
                    </div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 2rem;">
                    <div class="tree-node ipd">IPD likely needed</div>
                    <div class="tree-node aggregate">AD may suffice</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 4.3: More Criteria -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">When IPD Is Essential</div>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Time-to-Event Outcomes</h4>
                    <p>When survival curves matter, not just final hazard ratios. When you need to handle censoring properly.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Continuous Effect Modifiers</h4>
                    <p>Testing whether treatment effect varies by age, BMI, biomarker level (not just "high" vs "low")</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Outcome Definition Problems</h4>
                    <p>When trials define outcomes differently and you need to standardize</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Longer Follow-Up Available</h4>
                    <p>When trialists have unpublished follow-up data you want to include</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 4.4: Branching Scenario -->
            <div class="slide gradient">
              <div class="content text-center">
                <div class="scenario-panel animate" id="scenario-ipd-decision">
                  <div class="scenario-header">
                    <span class="scenario-icon">&#x1F500;</span>
                    <span class="scenario-title">The Research Strategy Decision</span>
                  </div>
                  <div class="scenario-situation">
                    You're planning a meta-analysis of corticosteroids for COVID-19 pneumonia. You have 10 eligible RCTs with published data. A colleague asks: "Should we try to get IPD, or just do an aggregate analysis?"
                    <br><br>
                    Your key question is: "Does benefit vary by disease severity and timing of treatment?"
                  </div>
                  <div class="scenario-question">What do you recommend?</div>
                  <div class="scenario-choices">
                    <div class="scenario-choice" onclick="selectScenarioChoice('ipd-decision', 'a')">
                      <span class="choice-letter">A</span>
                      <span class="choice-text">Just do AD - we need results quickly and IPD takes too long</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('ipd-decision', 'b')">
                      <span class="choice-letter">B</span>
                      <span class="choice-text">Pursue IPD - our question is about effect modification by patient characteristics</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('ipd-decision', 'c')">
                      <span class="choice-letter">C</span>
                      <span class="choice-text">Do subgroup analysis by trial-level severity categories from publications</span>
                    </div>
                  </div>
                  <div class="scenario-consequence" id="consequence-ipd-decision"></div>
                </div>
              </div>
            </div>

            <!-- Slide 4.5: When AD Is Enough -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">When Aggregate Data Suffices</div>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number" style="background:var(--orange);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>Overall Treatment Effect</h4>
                    <p>When your only question is "Does it work?" not "For whom?"</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background:var(--orange);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>Homogeneous Population</h4>
                    <p>When trials enrolled similar patients and effect modification is unlikely</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background:var(--orange);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>Binary Outcomes, Short Follow-up</h4>
                    <p>When censoring isn't an issue and outcomes are simple yes/no</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background:var(--orange);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>IPD Unobtainable</h4>
                    <p>When trialists won't share, data is lost, or resources are unavailable</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 4.6: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain animate">
                  "Not every question requires the individual.<br>
                  But every question about <em>which</em> individuals<br>
                  demands their presence in your data."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 5: ONE-STAGE VS TWO-STAGE ==================== -->
          <div class="module-slides" data-module="5">

            <!-- Slide 5.1: Opening -->
            <div class="slide dark active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  You have gathered the individual data.<br>
                  <br>
                  Now: do you analyze it as <em>one combined dataset</em><br>
                  or <em>trial by trial, then combine</em>?
                </div>
              </div>
            </div>

            <!-- Slide 5.2: Two Approaches -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Two Analytical Approaches</div>
                <div class="compare-grid animate delay-1">
                  <div class="compare-box aggregate">
                    <h4>Two-Stage Approach</h4>
                    <ul>
                      <li>Stage 1: Analyze each trial separately</li>
                      <li>Stage 2: Meta-analyze the results</li>
                      <li>Preserves trial structure</li>
                      <li>Familiar (like standard MA)</li>
                      <li>Cannot handle sparse data well</li>
                    </ul>
                  </div>
                  <div class="compare-box ipd">
                    <h4>One-Stage Approach</h4>
                    <ul>
                      <li>Analyze all data simultaneously</li>
                      <li>Mixed-effects regression model</li>
                      <li>Random effects for clustering</li>
                      <li>Better for sparse data</li>
                      <li>More flexible modeling</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 5.3: Two-Stage Explained -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Two-Stage: The Familiar Path</div>
                <div class="formula-box animate delay-1">
                  <div class="label">STAGE 1 (Within Each Trial)</div>
                  <div class="formula">Estimate treatment effect for trial k: &#x3B8;<sub>k</sub></div>
                  <div class="label">Using individual patient data from that trial</div>
                </div>
                <div class="formula-box animate delay-2">
                  <div class="label">STAGE 2 (Across Trials)</div>
                  <div class="formula">Meta-analyze &#x3B8;<sub>1</sub>, &#x3B8;<sub>2</sub>, ... &#x3B8;<sub>K</sub></div>
                  <div class="label">Using standard random-effects methods</div>
                </div>
                <div class="simple-box animate delay-3">
                  <div class="simple-title">ADVANTAGE</div>
                  <div class="simple-text">
                    Easy to understand. Easy to explain.
                    <br>
                    Each trial's estimate is transparent.
                    <br>
                    Familiar forest plots and I<sup>2</sup> statistics.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 5.4: One-Stage Explained -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">One-Stage: The Powerful Path</div>
                <div class="formula-box animate delay-1">
                  <div class="label">MIXED-EFFECTS MODEL</div>
                  <div class="formula">Y<sub>ij</sub> = &#x3B2;<sub>0</sub> + &#x3B2;<sub>1</sub>Treatment<sub>ij</sub> + u<sub>j</sub> + &#x3B5;<sub>ij</sub></div>
                  <div class="label">i = patient, j = trial, u<sub>j</sub> = random trial effect</div>
                </div>
                <div class="simple-box blue animate delay-2">
                  <div class="simple-title">ADVANTAGES</div>
                  <div class="simple-text">
                    <strong>1.</strong> Handles trials with zero events (no continuity corrections)<br>
                    <strong>2.</strong> More powerful for detecting interactions<br>
                    <strong>3.</strong> Can model complex covariate relationships<br>
                    <strong>4.</strong> Exact likelihood (no normal approximations)
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 5.5: Decision Tree -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Choosing Your Approach</div>
                <div class="decision-tree animate delay-1">
                  <h4>One-Stage or Two-Stage?</h4>
                  <div class="tree-level">
                    <div class="tree-node question">Do trials have sparse events (rare outcomes)?</div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 2rem;">
                    <div>
                      <div class="tree-node yes">YES (sparse)</div>
                      <div class="tree-arrow">&#8595;</div>
                      <div class="tree-node ipd">One-stage preferred</div>
                      <div class="tree-label">Avoids zero-cell problems</div>
                    </div>
                    <div>
                      <div class="tree-node no">NO (common events)</div>
                      <div class="tree-arrow">&#8595;</div>
                      <div class="tree-node aggregate">Either works</div>
                      <div class="tree-label">Results should be similar</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 5.6: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain animate">
                  "The two-stage preserves each trial's voice.<br>
                  The one-stage hears all voices at once.<br>
                  When data is sparse and events are rare&mdash;<br>
                  the one-stage catches what the two-stage misses."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 6: THE CORTICOSTEROID TIMING STORY ==================== -->
          <div class="module-slides" data-module="6">

            <!-- Slide 6.1: Opening -->
            <div class="slide black active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  Have you not heard the tale of the drug<br>
                  that saved babies' lives&mdash;<br>
                  <em>but only if given at the right time</em>?
                </div>
              </div>
            </div>

            <!-- Slide 6.2: Preterm Birth -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">The Preterm Paradox</div>
                <div class="story-card animate delay-1">
                  <div class="place">NEONATAL INTENSIVE CARE UNITS WORLDWIDE</div>
                  <div class="narrative">
                    Antenatal corticosteroids reduce mortality in preterm infants.
                    This was established in the 1970s.
                    <br><br>
                    But a puzzle remained: <strong>When should they be given?</strong>
                    <br><br>
                    24 hours before birth? 48 hours? A week?
                    <br><br>
                    Published trials couldn't answer&mdash;they didn't report timing consistently.
                  </div>
                  <div class="source">Roberts D, et al. Cochrane Database Syst Rev 2017</div>
                </div>
              </div>
            </div>

            <!-- Slide 6.3: The IPD Solution -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">IPD Revealed the Window</div>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box" style="border: 2px solid var(--green);">
                    <div class="stat-value" style="color:var(--green);">24h-7d</div>
                    <div class="stat-label">Optimal Window</div>
                  </div>
                  <div class="stat-box" style="border: 2px solid var(--red);">
                    <div class="stat-value" style="color:var(--red);">>7 days</div>
                    <div class="stat-label">Benefit Wanes</div>
                  </div>
                </div>
                <div class="simple-box animate delay-2">
                  <div class="simple-title">THE DISCOVERY</div>
                  <div class="simple-text">
                    By examining each baby's exact time from steroid to delivery,
                    IPD meta-analysis showed:
                    <br><br>
                    <strong>Maximum benefit:</strong> 24 hours to 7 days before birth<br>
                    <strong>Reduced benefit:</strong> >7 days (lung maturity effect fades)<br>
                    <strong>No benefit:</strong> <24 hours (not enough time to work)
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 6.4: Clinical Impact -->
            <div class="slide hope">
              <div class="content text-center">
                <div class="title green animate">Lives Saved, Practice Changed</div>
                <div class="story-card animate delay-1">
                  <div class="place">THE CLINICAL IMPACT</div>
                  <div class="narrative">
                    Before IPD: Clinicians gave steroids and hoped for the best.
                    <br><br>
                    After IPD: Guidelines now recommend <strong>repeat dosing</strong>
                    if delivery hasn't occurred within 7 days of the first course.
                    <br><br>
                    This precision&mdash;impossible without individual data&mdash;
                    has <strong>saved thousands of premature babies</strong>.
                  </div>
                </div>
                <div class="discovery-box animate delay-2">
                  <div class="insight">Timing is Treatment</div>
                  <div class="label">The same drug, given at the wrong time, may as well be placebo</div>
                </div>
              </div>
            </div>

            <!-- Slide 6.5: Why AD Failed -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Why Aggregate Data Couldn't Show This</div>
                <div class="simple-box animate delay-1">
                  <div class="simple-title">THE PROBLEM</div>
                  <div class="simple-text">
                    Trial A reported: "Steroid given within 48 hours"<br>
                    Trial B reported: "Steroid given antenatally"<br>
                    Trial C reported: "Steroid-to-delivery interval: median 3 days"
                    <br><br>
                    Different categories. Different definitions. <strong>Incompatible summaries.</strong>
                    <br><br>
                    Only by examining each baby's actual steroid-to-delivery time
                    could the optimal window be identified.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 6.6: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain hope animate">
                  "The drug was known to work.<br>
                  But <em>when</em> to give it was unknown.<br>
                  IPD turned 'sometime' into 'the right time'&mdash;<br>
                  and in that precision, children lived."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 7: OBTAINING IPD (THE QUEST) ==================== -->
          <div class="module-slides" data-module="7">

            <!-- Slide 7.1: Opening -->
            <div class="slide dark active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  The data exists.<br>
                  Somewhere, in files and databases,<br>
                  <em>each patient's story is recorded</em>.<br>
                  <br>
                  The question is: will they share it?
                </div>
              </div>
            </div>

            <!-- Slide 7.2: The Quest -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Quest for Data</div>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box">
                    <div class="stat-value" style="color:var(--green);">60-80%</div>
                    <div class="stat-label">Typical IPD Retrieval Rate</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value" style="color:var(--red);">6-24</div>
                    <div class="stat-label">Months to Gather</div>
                  </div>
                </div>
                <div class="simple-box animate delay-2">
                  <div class="simple-title">REALITY CHECK</div>
                  <div class="simple-text">
                    You will likely <strong>not</strong> get 100% of trials.
                    Some investigators will refuse. Some data is lost.
                    Some companies won't share.
                    <br><br>
                    <strong>This is expected.</strong> Plan for it.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 7.3: Data Sources -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Where IPD Lives</div>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Trialist Collaboration</h4>
                    <p>Direct contact with trial investigators. Build relationships. Offer co-authorship.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Data Sharing Platforms</h4>
                    <p>YODA Project, ClinicalStudyDataRequest.com, Vivli, ICPSR</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Regulatory Agencies</h4>
                    <p>EMA Policy 0070, FDA (limited), Health Canada</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Journal Requirements</h4>
                    <p>Many journals now require data sharing; check supplementary materials</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 7.4: The Collaboration Letter -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">The Approach</div>
                <div class="story-card animate delay-1">
                  <div class="place">HOW TO ASK</div>
                  <div class="narrative">
                    <strong>1. Lead with your question</strong>&mdash;explain why IPD is essential
                    <br><br>
                    <strong>2. Offer co-authorship</strong>&mdash;make sharing worthwhile
                    <br><br>
                    <strong>3. Describe data security</strong>&mdash;how you'll protect their patients
                    <br><br>
                    <strong>4. Provide data dictionaries</strong>&mdash;specify exactly what you need
                    <br><br>
                    <strong>5. Set clear timelines</strong>&mdash;respect their time
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 7.5: Missing IPD Problem -->
            <div class="slide blood">
              <div class="content text-center">
                <div class="title red animate">The Availability Bias Trap</div>
                <div class="simple-box animate delay-1">
                  <div class="simple-title">THE DANGER</div>
                  <div class="simple-text">
                    What if trials that <strong>share data</strong> are systematically different
                    from trials that <strong>don't share</strong>?
                    <br><br>
                    Industry trials: less likely to share<br>
                    Negative trials: less likely to share<br>
                    Older trials: data may be lost
                    <br><br>
                    <strong>Your IPD sample may be biased.</strong>
                  </div>
                </div>
                <div class="formula-box animate delay-2">
                  <div class="label">THE RULE</div>
                  <div class="formula">Always compare: IPD trials vs. non-IPD trials</div>
                  <div class="label">Do they differ in effect size, sample size, funding source?</div>
                </div>
              </div>
            </div>

            <!-- Slide 7.6: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain animate">
                  "The data exists. The question is trust.<br>
                  Will they share what they have guarded?<br>
                  Build the bridge carefully&mdash;<br>
                  for on that bridge, patients' futures cross."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 8: DATA HARMONIZATION ==================== -->
          <div class="module-slides" data-module="8">

            <!-- Slide 8.1: Opening -->
            <div class="slide dark active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  You have gathered the data<br>
                  from twelve trials, five countries, three decades.<br>
                  <br>
                  But Trial A calls it <em>"cardiovascular death"</em><br>
                  and Trial B calls it <em>"cardiac mortality"</em>.<br>
                  <br>
                  Are they the same?
                </div>
              </div>
            </div>

            <!-- Slide 8.2: The Harmonization Challenge -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Tower of Babel Problem</div>
                <div class="story-card animate delay-1">
                  <div class="place">EVERY IPD META-ANALYSIS</div>
                  <div class="narrative">
                    Trial from Japan: Age in years since 1900 (e.g., "54" = 1954 birth)<br>
                    Trial from USA: Age in decimal years (e.g., 65.7)<br>
                    Trial from UK: Age bands ("65-74")<br><br>
                    Diabetes: HbA1c &#8805; 6.5% vs. fasting glucose &#8805; 126 vs. "physician diagnosis"<br><br>
                    Outcome: "Major adverse cardiac event" (one trial includes stroke, another doesn't)<br><br>
                    <strong>Before analysis: harmonize everything.</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 8.3: The Process -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Harmonization Process</div>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Create a Master Data Dictionary</h4>
                    <p>Define every variable you need: name, type, permitted values, derivation rules</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Map Each Trial's Variables</h4>
                    <p>Document how each trial's coding maps to your standardized definitions</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Check with Trialists</h4>
                    <p>Verify your interpretations. They know their data better than you.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Validate Transformations</h4>
                    <p>Reproduce published results from the IPD. If they don't match, investigate.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 8.4: Branching Scenario -->
            <div class="slide gradient">
              <div class="content text-center">
                <div class="scenario-panel animate" id="scenario-harmonization">
                  <div class="scenario-header">
                    <span class="scenario-icon">&#x1F500;</span>
                    <span class="scenario-title">The Definition Dilemma</span>
                  </div>
                  <div class="scenario-situation">
                    You're harmonizing IPD from 8 diabetes trials. Your primary outcome is "cardiovascular death."
                    <br><br>
                    Six trials used a standard definition (ICD codes). Two trials from the 1990s used "investigator-assessed cardiac death" with no standardized criteria. These two trials show larger treatment effects.
                  </div>
                  <div class="scenario-question">How do you handle this?</div>
                  <div class="scenario-choices">
                    <div class="scenario-choice" onclick="selectScenarioChoice('harmonization', 'a')">
                      <span class="choice-letter">A</span>
                      <span class="choice-text">Include all 8 trials - more data is better and definitions are "close enough"</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('harmonization', 'b')">
                      <span class="choice-letter">B</span>
                      <span class="choice-text">Exclude the 2 non-standardized trials to maintain outcome consistency</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('harmonization', 'c')">
                      <span class="choice-letter">C</span>
                      <span class="choice-text">Primary analysis with 6 consistent trials; sensitivity analysis adding the 2 others</span>
                    </div>
                  </div>
                  <div class="scenario-consequence" id="consequence-harmonization"></div>
                </div>
              </div>
            </div>

            <!-- Slide 8.5: The Validation Step -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Crucial Validation</div>
                <div class="simple-box animate delay-1">
                  <div class="simple-title">THE TEST</div>
                  <div class="simple-text">
                    <strong>Before any new analysis:</strong>
                    <br><br>
                    Reproduce each trial's published results from the IPD.
                    <br><br>
                    If your analysis gives RR = 0.78 but the publication says RR = 0.85,
                    <br>
                    <strong>something is wrong.</strong>
                    <br><br>
                    Find the discrepancy. Fix it. Then proceed.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 8.6: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain animate">
                  "Different languages, different rulers,<br>
                  different ways to name the same disease.<br>
                  Before you can combine, you must translate.<br>
                  Before you translate, you must understand."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 9: TESTING INTERACTIONS ==================== -->
          <div class="module-slides" data-module="9">

            <!-- Slide 9.1: Opening -->
            <div class="slide dark active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  The treatment works <em>on average</em>.<br>
                  <br>
                  But does it work the same for the young and the old?<br>
                  For the mild and the severe?<br>
                  For the one with the biomarker and the one without?
                </div>
              </div>
            </div>

            <!-- Slide 9.2: The Tamoxifen Discovery Revisited -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">The Interaction That Changed Oncology</div>
                <div class="story-card animate delay-1">
                  <div class="place">EBCTCG, 1985-1998</div>
                  <div class="narrative">
                    The Early Breast Cancer Trialists' Group didn't just ask "Does tamoxifen work?"
                    <br><br>
                    They asked: <strong>"Does the effect differ by estrogen receptor status?"</strong>
                    <br><br>
                    The interaction was massive:
                    <br><br>
                    ER-positive: 47% reduction in recurrence<br>
                    ER-negative: <strong>No benefit at all</strong>
                  </div>
                  <div class="source">EBCTCG. Lancet 1998;351:1451-67</div>
                </div>
                <div class="discovery-box animate delay-2">
                  <div class="insight">p<sub>interaction</sub> < 0.00001</div>
                  <div class="label">The most important interaction in cancer medicine</div>
                </div>
              </div>
            </div>

            <!-- Slide 9.3: How to Test Interactions -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Testing Treatment-Covariate Interactions</div>
                <div class="formula-box animate delay-1">
                  <div class="label">THE MODEL</div>
                  <div class="formula">Outcome = &#946;<sub>1</sub>Treatment + &#946;<sub>2</sub>Covariate + &#946;<sub>3</sub>(Treatment &times; Covariate)</div>
                  <div class="label">&#946;<sub>3</sub> is the interaction term - does treatment effect vary by covariate?</div>
                </div>
                <div class="simple-box animate delay-2">
                  <div class="simple-title">INTERPRETATION</div>
                  <div class="simple-text">
                    If &#946;<sub>3</sub> is statistically significant:
                    <br><br>
                    The treatment effect <strong>differs</strong> between subgroups defined by the covariate.
                    <br><br>
                    If not: the treatment effect is <strong>similar</strong> across subgroups
                    (or you lack power to detect a difference).
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 9.4: Within vs Between Study Interactions -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Critical Distinction</div>
                <div class="compare-grid animate delay-1">
                  <div class="compare-box aggregate">
                    <h4>Between-Study Interaction</h4>
                    <ul>
                      <li>Compares trial-level averages</li>
                      <li>Ecological fallacy risk</li>
                      <li>Confounded by trial design</li>
                      <li>Low statistical power</li>
                      <li>Can do with aggregate data</li>
                    </ul>
                  </div>
                  <div class="compare-box ipd">
                    <h4>Within-Study Interaction</h4>
                    <ul>
                      <li>Compares patients within each trial</li>
                      <li>No ecological fallacy</li>
                      <li>Randomization preserved</li>
                      <li>Much higher power</li>
                      <li>Requires IPD</li>
                    </ul>
                  </div>
                </div>
                <div class="simple-box animate delay-2">
                  <div class="simple-title">THE KEY INSIGHT</div>
                  <div class="simple-text">
                    IPD allows you to test <strong>within-study interactions</strong>,
                    where randomization ensures the comparison is fair.
                    <br><br>
                    This is the gold standard for effect modification.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 9.5: Branching Scenario -->
            <div class="slide gradient">
              <div class="content text-center">
                <div class="scenario-panel animate" id="scenario-interaction">
                  <div class="scenario-header">
                    <span class="scenario-icon">&#x1F500;</span>
                    <span class="scenario-title">The Age Interaction Question</span>
                  </div>
                  <div class="scenario-situation">
                    Your IPD meta-analysis of anticoagulation for atrial fibrillation includes 12,000 patients. You test for age interaction and find p=0.03. Patients &#8805;75 years show larger benefit (RR 0.55) than patients <75 years (RR 0.72).
                    <br><br>
                    You tested 8 potential effect modifiers in your analysis.
                  </div>
                  <div class="scenario-question">How do you interpret this finding?</div>
                  <div class="scenario-choices">
                    <div class="scenario-choice" onclick="selectScenarioChoice('interaction', 'a')">
                      <span class="choice-letter">A</span>
                      <span class="choice-text">Report that anticoagulation works better in older patients - the interaction is significant</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('interaction', 'b')">
                      <span class="choice-letter">B</span>
                      <span class="choice-text">Apply multiple testing correction; with 8 tests, p=0.03 is likely a false positive</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('interaction', 'c')">
                      <span class="choice-letter">C</span>
                      <span class="choice-text">Report as hypothesis-generating, note the multiple comparisons, request external validation</span>
                    </div>
                  </div>
                  <div class="scenario-consequence" id="consequence-interaction"></div>
                </div>
              </div>
            </div>

            <!-- Slide 9.6: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain animate">
                  "The average hides the interaction.<br>
                  The interaction reveals who benefits.<br>
                  Test it within studies, not between&mdash;<br>
                  for that is where the truth is found."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 10: PROGNOSIS AND PREDICTION ==================== -->
          <div class="module-slides" data-module="10">

            <!-- Slide 10.1: Opening -->
            <div class="slide dark active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  IPD is not only for treatments.<br>
                  <br>
                  When you seek to <em>predict</em> who will die,<br>
                  who will recover, who will relapse&mdash;<br>
                  <em>the individual is everything</em>.
                </div>
              </div>
            </div>

            <!-- Slide 10.2: The IMPACT Story -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">Predicting Recovery After Brain Injury</div>
                <div class="story-card animate delay-1">
                  <div class="place">IMPACT CONSORTIUM, 2005-PRESENT</div>
                  <div class="narrative">
                    After traumatic brain injury, families ask the devastating question:
                    <br><br>
                    <strong>"Will they ever wake up?"</strong>
                    <br><br>
                    Individual trials were too small to develop accurate prediction models.
                    <br><br>
                    IMPACT gathered IPD from 11 studies, 9,205 patients, and built a model
                    that predicts 6-month outcomes from initial clinical features.
                  </div>
                  <div class="source">IMPACT Study Group. PLoS Med 2008;5:e165</div>
                </div>
              </div>
            </div>

            <!-- Slide 10.3: Why IPD for Prognosis -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Why Prognosis Demands IPD</div>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>External Validation Across Populations</h4>
                    <p>Develop in some studies, validate in others. True test of generalizability.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Non-linear Relationships</h4>
                    <p>Explore how predictors relate to outcome: linear? threshold? U-shaped?</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Multiple Predictor Interactions</h4>
                    <p>Age + GCS + pupil reactivity may interact in ways aggregate data cannot reveal</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Proper Handling of Missing Predictors</h4>
                    <p>Multiple imputation at the patient level, not at the study level</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 10.4: The TRIPOD+PRISMA-IPD Framework -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Reporting Standards</div>
                <div class="compare-grid animate delay-1">
                  <div class="compare-box aggregate">
                    <h4>TRIPOD</h4>
                    <ul>
                      <li>Prediction model reporting</li>
                      <li>Development and validation</li>
                      <li>Calibration and discrimination</li>
                      <li>22 item checklist</li>
                    </ul>
                  </div>
                  <div class="compare-box ipd">
                    <h4>PRISMA-IPD</h4>
                    <ul>
                      <li>IPD meta-analysis reporting</li>
                      <li>Data acquisition details</li>
                      <li>Harmonization process</li>
                      <li>Integrity checking</li>
                    </ul>
                  </div>
                </div>
                <div class="simple-box animate delay-2">
                  <div class="simple-title">FOR IPD PROGNOSTIC MODELS</div>
                  <div class="simple-text">
                    You need <strong>both</strong>: TRIPOD for the model itself,
                    PRISMA-IPD for the data synthesis process.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 10.5: Clinical Impact -->
            <div class="slide hope">
              <div class="content text-center">
                <div class="title green animate">When Prediction Saves Lives</div>
                <div class="story-card animate delay-1">
                  <div class="place">THE CLINICAL IMPACT</div>
                  <div class="narrative">
                    The IMPACT model is now embedded in clinical decision support systems worldwide.
                    <br><br>
                    When a patient arrives with traumatic brain injury,
                    the model provides a <strong>probability of survival</strong>
                    and <strong>probability of favorable outcome</strong>.
                    <br><br>
                    This guides conversations with families.
                    This informs treatment intensity.
                    This helps allocate ICU resources.
                    <br><br>
                    <strong>Built from individual data. Serving individual patients.</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 10.6: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain hope animate">
                  "To predict one patient's future,<br>
                  you must learn from thousands of pasts.<br>
                  IPD holds those stories&mdash;<br>
                  each one a teacher, if you will listen."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 11: THE ASPIRIN PARADOX (ATT) ==================== -->
          <div class="module-slides" data-module="11">

            <!-- Slide 11.1: Opening Sign -->
            <div class="slide black active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  Have you not considered the small white tablet<br>
                  that has been given to <em>millions</em> for their hearts?<br>
                  <br>
                  They were told: <em>"Take this, and you shall be protected."</em><br>
                  <br>
                  But was every heart equally in need of protection?
                </div>
              </div>
            </div>

            <!-- Slide 11.2: The Story of the Netflix Prize -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Story of the Netflix Prize</div>
                <div class="story-card animate delay-1">
                  <div class="place">A TRUE STORY</div>
                  <div class="narrative">
                    In 2006, Netflix released 100 million "anonymized" movie ratings for a $1 million prize.
                    <br><br>
                    Researchers quickly re-identified users by matching ratings with public IMDb reviews.
                    <br><br>
                    One lawsuit alleged a closeted lesbian was outed through her viewing patterns.
                    <br><br>
                    <strong>The lesson: removing names isn't anonymization.</strong>
                    <br><br>
                    IPD contains enough combinations of age, diagnosis, treatment response, and dates to uniquely identify individuals. Privacy requires more than deleting the name column&mdash;it requires understanding how data combinations become fingerprints.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 11.3: The ATT Collaboration -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">Oxford, 2009</div>
                <div class="story-card animate delay-1">
                  <div class="place">ANTITHROMBOTIC TRIALISTS' COLLABORATION</div>
                  <div class="narrative">
                    The ATT gathered individual data from <strong>95,000 patients</strong>
                    across 6 primary prevention trials of aspirin.
                    <br><br>
                    The published trials said: "Aspirin prevents heart attacks."
                    <br><br>
                    But the ATT asked the forbidden question:
                    <br><br>
                    <strong>"At what cost? And for whom?"</strong>
                  </div>
                  <div class="source">ATT Collaboration. Lancet 2009;373:1849-60</div>
                </div>
              </div>
            </div>

            <!-- Slide 11.4: The Revelation -->
            <div class="slide blood">
              <div class="content text-center">
                <div class="title red animate">The Numbers Revealed</div>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box" style="border: 2px solid var(--green);">
                    <div class="stat-value" style="color:var(--green);">-12%</div>
                    <div class="stat-label">Heart Attacks Prevented</div>
                  </div>
                  <div class="stat-box" style="border: 2px solid var(--red);">
                    <div class="stat-value" style="color:var(--red);">+32%</div>
                    <div class="stat-label">Major Bleeds Caused</div>
                  </div>
                </div>
                <div class="simple-box animate delay-2">
                  <div class="simple-title">THE BALANCE</div>
                  <div class="simple-text">
                    For every <strong>1,000 low-risk patients</strong> taking aspirin for 5 years:
                    <br><br>
                    <span style="color:var(--green);">2-3 heart attacks prevented</span><br>
                    <span style="color:var(--red);">2-3 major bleeds caused</span>
                    <br><br>
                    <strong>The benefit and harm cancel out.</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 11.5: The Decision Tree -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Risk-Based Decision</div>
                <div class="decision-tree animate delay-1">
                  <h4>Should This Patient Take Aspirin for Primary Prevention?</h4>
                  <div class="tree-level">
                    <div class="tree-node root">10-Year CVD Risk?</div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 1rem;">
                    <div>
                      <div class="tree-node yes" style="background:rgba(34,197,94,0.3);">&gt;20%</div>
                      <div class="tree-label">High Risk</div>
                    </div>
                    <div>
                      <div class="tree-node question">10-20%</div>
                      <div class="tree-label">Intermediate</div>
                    </div>
                    <div>
                      <div class="tree-node no" style="background:rgba(197,48,48,0.3);">&lt;10%</div>
                      <div class="tree-label">Low Risk</div>
                    </div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 1rem;">
                    <div class="tree-node action">Consider aspirin<br>(benefit &gt; harm)</div>
                    <div class="tree-node aggregate">Shared decision<br>(benefit ‚âà harm)</div>
                    <div class="tree-node" style="background:rgba(197,48,48,0.5);border-color:var(--red);">Avoid aspirin<br>(harm &gt; benefit)</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 11.6: Why Aggregate Failed -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="rhetorical animate">
                  Why did published meta-analyses miss this?
                </div>
                <div class="simple-box animate delay-1">
                  <div class="simple-title">THE BLINDNESS OF AGGREGATES</div>
                  <div class="simple-text">
                    Published trials reported <strong>average benefits</strong>.
                    <br><br>
                    They could not show that high-risk patients gained<br>
                    while low-risk patients lost.
                    <br><br>
                    Only by examining each patient's baseline risk,<br>
                    each patient's outcomes,<br>
                    could the <strong>interaction</strong> be revealed.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 11.7: Branching Scenario -->
            <div class="slide gradient">
              <div class="content text-center">
                <div class="scenario-panel animate" id="scenario-aspirin">
                  <div class="scenario-header">
                    <span class="scenario-icon">&#x1F500;</span>
                    <span class="scenario-title">The Primary Prevention Dilemma</span>
                  </div>
                  <div class="scenario-situation">
                    A 52-year-old man asks about aspirin for heart attack prevention. He has no prior CVD, cholesterol is borderline, BP is controlled, non-smoker. His 10-year CVD risk is 8%.
                    <br><br>
                    He read online that "aspirin prevents heart attacks" and wants your advice.
                  </div>
                  <div class="scenario-question">What do you tell him?</div>
                  <div class="scenario-choices">
                    <div class="scenario-choice" onclick="selectScenarioChoice('aspirin', 'a')">
                      <span class="choice-letter">A</span>
                      <span class="choice-text">"Yes, take aspirin daily - it's proven to prevent heart attacks"</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('aspirin', 'b')">
                      <span class="choice-letter">B</span>
                      <span class="choice-text">"At your risk level, aspirin's bleeding risk roughly equals its heart benefit - I'd recommend against it"</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('aspirin', 'c')">
                      <span class="choice-letter">C</span>
                      <span class="choice-text">"Take baby aspirin - the lower dose is safer"</span>
                    </div>
                  </div>
                  <div class="scenario-consequence" id="consequence-aspirin"></div>
                </div>
              </div>
            </div>

            <!-- Slide 11.8: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain warning animate">
                  "The medicine that saves the endangered<br>
                  may harm the secure.<br>
                  <br>
                  Know your patient's risk before you prescribe.<br>
                  This is what the individual data taught us."
                </div>
                <div class="gold-line animate delay-2"></div>
                <p class="animate delay-3" style="color:rgba(255,255,255,0.6);font-style:italic;">
                  95,000 patients. One truth: risk determines benefit.
                </p>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 12: THE BLOOD PRESSURE REVELATION (BPLTTC) ==================== -->
          <div class="module-slides" data-module="12">

            <!-- Slide 12.1: Opening -->
            <div class="slide black active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  Have you not seen how they debated for decades:<br>
                  <em>"Should the old be treated the same as the young?"</em><br>
                  <br>
                  Some said: "Lower is always better."<br>
                  Others said: "The old are fragile. Be cautious."<br>
                  <br>
                  Who was right?
                </div>
              </div>
            </div>

            <!-- Slide 12.2: The Debate -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The J-Curve Controversy</div>
                <div class="story-card animate delay-1">
                  <div class="place">CARDIOLOGY CONFERENCES, 1980s-2000s</div>
                  <div class="narrative">
                    For years, doctors argued:
                    <br><br>
                    <strong>The Aggressive Camp:</strong> "Every mmHg of BP reduction saves lives.<br>
                    Treat everyone to target 120/80."
                    <br><br>
                    <strong>The Conservative Camp:</strong> "In the elderly, low BP causes falls, strokes, death.<br>
                    There's a J-curve&mdash;too low is dangerous."
                    <br><br>
                    Individual trials were too small to settle it.
                    <strong>Until the BPLTTC gathered the individual data.</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 12.3: The Collaboration -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">The Blood Pressure Lowering Treatment Trialists</div>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box">
                    <div class="stat-value" style="color:var(--blue);">48</div>
                    <div class="stat-label">Trials Combined</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value" style="color:var(--gold);">344,716</div>
                    <div class="stat-label">Individual Patients</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value" style="color:var(--teal);">15+</div>
                    <div class="stat-label">Years of Follow-up</div>
                  </div>
                </div>
                <div class="simple-box blue animate delay-2">
                  <div class="simple-title">THE QUESTION</div>
                  <div class="simple-text">
                    Does the benefit of BP lowering vary by age?
                    <br>
                    Is there a J-curve at very low pressures?
                    <br>
                    Do the very old (>80 years) still benefit?
                  </div>
                </div>
                <div class="source animate delay-3" style="color:rgba(255,255,255,0.5);font-size:0.8rem;margin-top:1rem;">
                  BPLTTC. Lancet 2021;397:1625-36
                </div>
              </div>
            </div>

            <!-- Slide 12.4: The Answer -->
            <div class="slide hope">
              <div class="content text-center">
                <div class="title green animate">The Answer, At Last</div>
                <div class="discovery-box animate delay-1">
                  <div class="insight">Benefit at Every Age</div>
                  <div class="label">Proportional risk reduction was consistent from age 55 to 85+</div>
                </div>
                <div class="simple-box animate delay-2">
                  <div class="simple-title">WHAT IPD SHOWED</div>
                  <div class="simple-text">
                    <strong>Every 5 mmHg BP reduction:</strong>
                    <br><br>
                    Age 55-64: 10% lower major CV events<br>
                    Age 65-74: 10% lower major CV events<br>
                    Age 75-84: 10% lower major CV events<br>
                    Age ‚â•85: <strong>Still 10% lower</strong>
                    <br><br>
                    <em>p</em><sub>interaction</sub> = 0.85. No evidence of age modification.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 12.5: The J-Curve Myth -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">What About the J-Curve?</div>
                <div class="story-card animate delay-1">
                  <div class="place">THE RESOLUTION</div>
                  <div class="narrative">
                    The BPLTTC tested for a J-curve by examining patients<br>
                    who achieved very low blood pressures.
                    <br><br>
                    <strong>Result:</strong> No J-curve in randomized comparisons.
                    <br><br>
                    The apparent J-curve in observational data was <em>reverse causation</em>&mdash;
                    sick patients have low BP because they're sick,
                    not sick because their BP is low.
                    <br><br>
                    <strong>Only IPD from RCTs could untangle this.</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 12.6: Decision Tree -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Treating Hypertension by Age</div>
                <div class="decision-tree animate delay-1">
                  <h4>Should This Elderly Patient Get BP Treatment?</h4>
                  <div class="tree-level">
                    <div class="tree-node root">Patient Age?</div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 2rem;">
                    <div class="tree-node yes" style="min-width:80px;">55-74</div>
                    <div class="tree-node yes" style="min-width:80px;">75-84</div>
                    <div class="tree-node yes" style="min-width:80px;">85+</div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level">
                    <div class="tree-node action" style="background:var(--green);min-width:300px;">
                      Treat if BP elevated<br>
                      <span style="font-size:0.75rem;">Proportional benefit maintained across all ages</span>
                    </div>
                  </div>
                </div>
                <div class="simple-box animate delay-2" style="margin-top:1.5rem;">
                  <div class="simple-title">THE LESSON</div>
                  <div class="simple-text">
                    Age alone is not a reason to withhold treatment.
                    <br>
                    Consider frailty, life expectancy, patient preference&mdash;but not age.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 12.7: Branching Scenario -->
            <div class="slide gradient">
              <div class="content text-center">
                <div class="scenario-panel animate" id="scenario-elderly-bp">
                  <div class="scenario-header">
                    <span class="scenario-icon">&#x1F500;</span>
                    <span class="scenario-title">The 82-Year-Old's Blood Pressure</span>
                  </div>
                  <div class="scenario-situation">
                    An 82-year-old woman has BP 158/88. She's independent, cognitively intact, and has no history of falls. A colleague says: "She's too old for aggressive BP treatment. The J-curve, you know."
                    <br><br>
                    You remember the BPLTTC IPD meta-analysis.
                  </div>
                  <div class="scenario-question">What do you do?</div>
                  <div class="scenario-choices">
                    <div class="scenario-choice" onclick="selectScenarioChoice('elderly-bp', 'a')">
                      <span class="choice-letter">A</span>
                      <span class="choice-text">Agree with your colleague - accept higher BP targets for the elderly</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('elderly-bp', 'b')">
                      <span class="choice-letter">B</span>
                      <span class="choice-text">Cite the BPLTTC evidence that benefit continues in the very elderly and initiate treatment</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('elderly-bp', 'c')">
                      <span class="choice-letter">C</span>
                      <span class="choice-text">Wait for a cardiovascular event before treating</span>
                    </div>
                  </div>
                  <div class="scenario-consequence" id="consequence-elderly-bp"></div>
                </div>
              </div>
            </div>

            <!-- Slide 12.8: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain hope animate">
                  "They said the old were too fragile for medicine.<br>
                  But the individual data showed otherwise:<br>
                  <br>
                  At every age, the benefit endures.<br>
                  Do not let age alone deny protection."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 13: THE STROKE TIME WINDOW ==================== -->
          <div class="module-slides" data-module="13">

            <!-- Slide 13.1: Opening Sign -->
            <div class="slide black active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  Have you not witnessed the race against time<br>
                  when a clot blocks the brain?<br>
                  <br>
                  Every minute, <em>two million neurons die</em>.<br>
                  <br>
                  But when does the window close?<br>
                  When is it too late to intervene?
                </div>
              </div>
            </div>

            <!-- Slide 13.2: The Stakes -->
            <div class="slide blood">
              <div class="content text-center">
                <div class="title red animate">Time Is Brain</div>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box" style="border: 2px solid var(--red);">
                    <div class="stat-value" style="color:var(--red);">1.9M</div>
                    <div class="stat-label">Neurons Lost Per Minute</div>
                  </div>
                  <div class="stat-box" style="border: 2px solid var(--orange);">
                    <div class="stat-value" style="color:var(--orange);">14B</div>
                    <div class="stat-label">Synapses Lost Per Minute</div>
                  </div>
                </div>
                <div class="story-card animate delay-2">
                  <div class="place">THE QUESTION</div>
                  <div class="narrative">
                    Thrombolysis can dissolve the clot and restore blood flow.
                    <br><br>
                    But given too late, it causes bleeding into dying brain tissue.
                    <br><br>
                    <strong>What is the time window? 3 hours? 4.5 hours? 6 hours?</strong>
                    <br><br>
                    Individual trials disagreed. Guidelines were uncertain.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 13.3: The IPD Solution -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">The Stroke Thrombolysis Trialists</div>
                <div class="story-card animate delay-1">
                  <div class="place">STT COLLABORATIVE GROUP, 2014</div>
                  <div class="narrative">
                    The STT gathered individual data from <strong>6,756 patients</strong>
                    across 9 major alteplase trials.
                    <br><br>
                    They knew <em>exactly</em> when each patient's stroke began.
                    They knew <em>exactly</em> when thrombolysis was given.
                    They knew <em>exactly</em> who lived, who died, who recovered.
                    <br><br>
                    <strong>They could map benefit against time, minute by minute.</strong>
                  </div>
                  <div class="source">STT Collaborative Group. Lancet 2014;384:1929-35</div>
                </div>
              </div>
            </div>

            <!-- Slide 13.4: The Time Curve -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Fading Window</div>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box" style="border: 2px solid var(--green);">
                    <div class="stat-value" style="color:var(--green);">0-3h</div>
                    <div class="stat-label">OR 1.75 for good outcome</div>
                  </div>
                  <div class="stat-box" style="border: 2px solid var(--teal);">
                    <div class="stat-value" style="color:var(--teal);">3-4.5h</div>
                    <div class="stat-label">OR 1.26 for good outcome</div>
                  </div>
                  <div class="stat-box" style="border: 2px solid var(--orange);">
                    <div class="stat-value" style="color:var(--orange);">4.5-6h</div>
                    <div class="stat-label">OR 1.15 (not significant)</div>
                  </div>
                </div>
                <div class="simple-box animate delay-2">
                  <div class="simple-title">THE DECAY OF BENEFIT</div>
                  <div class="simple-text">
                    Every 15 minutes of delay reduced the benefit.
                    <br><br>
                    Treated at 90 min: <strong>1 in 4</strong> achieve excellent outcome<br>
                    Treated at 180 min: <strong>1 in 7</strong> achieve excellent outcome<br>
                    Treated at 270 min: <strong>1 in 14</strong> achieve excellent outcome
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 13.5: Decision Tree -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Thrombolysis Decision</div>
                <div class="decision-tree animate delay-1">
                  <h4>Acute Ischemic Stroke: Give Thrombolysis?</h4>
                  <div class="tree-level">
                    <div class="tree-node root">Time Since Symptom Onset?</div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 0.75rem;">
                    <div>
                      <div class="tree-node yes" style="background:rgba(34,197,94,0.5);min-width:90px;">0-3h</div>
                      <div class="tree-label">Strong benefit</div>
                    </div>
                    <div>
                      <div class="tree-node yes" style="background:rgba(0,212,170,0.4);min-width:90px;">3-4.5h</div>
                      <div class="tree-label">Moderate benefit</div>
                    </div>
                    <div>
                      <div class="tree-node question" style="min-width:90px;">4.5-6h</div>
                      <div class="tree-label">Uncertain</div>
                    </div>
                    <div>
                      <div class="tree-node no" style="background:rgba(197,48,48,0.5);min-width:90px;">&gt;6h</div>
                      <div class="tree-label">Harm likely</div>
                    </div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 0.75rem;">
                    <div class="tree-node action" style="font-size:0.7rem;padding:0.5rem;">TREAT<br>URGENTLY</div>
                    <div class="tree-node action" style="font-size:0.7rem;padding:0.5rem;">TREAT<br>if eligible</div>
                    <div class="tree-node aggregate" style="font-size:0.7rem;padding:0.5rem;">Consider<br>imaging</div>
                    <div class="tree-node" style="background:rgba(197,48,48,0.5);font-size:0.7rem;padding:0.5rem;">Generally<br>avoid</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 13.6: Why AD Couldn't Answer -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="rhetorical animate">
                  Why did we need individual data?
                </div>
                <div class="simple-box animate delay-1">
                  <div class="simple-title">THE LIMITATION OF AVERAGES</div>
                  <div class="simple-text">
                    Trial A: "Patients treated within 3 hours" (average: 2.1 hours)<br>
                    Trial B: "Patients treated within 6 hours" (average: 4.2 hours)
                    <br><br>
                    These <em>overlapping, inconsistent windows</em> couldn't be compared.
                    <br><br>
                    Only by knowing <strong>each patient's exact time</strong><br>
                    could the continuous decay of benefit be mapped.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 13.7: Branching Scenario -->
            <div class="slide gradient">
              <div class="content text-center">
                <div class="scenario-panel animate" id="scenario-stroke">
                  <div class="scenario-header">
                    <span class="scenario-icon">&#x1F500;</span>
                    <span class="scenario-title">The 4-Hour Stroke</span>
                  </div>
                  <div class="scenario-situation">
                    A 68-year-old presents with acute stroke. Symptom onset was 4 hours ago. CT shows no hemorrhage, NIHSS score is 12 (moderate). The family asks: "Is it too late for the clot-busting drug?"
                    <br><br>
                    Door-to-needle time will add 30 minutes, making total time ~4.5 hours.
                  </div>
                  <div class="scenario-question">What do you do?</div>
                  <div class="scenario-choices">
                    <div class="scenario-choice" onclick="selectScenarioChoice('stroke', 'a')">
                      <span class="choice-letter">A</span>
                      <span class="choice-text">"It's too late - the 3-hour window has passed"</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('stroke', 'b')">
                      <span class="choice-letter">B</span>
                      <span class="choice-text">"We're still within the 4.5-hour window - proceed with thrombolysis urgently"</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('stroke', 'c')">
                      <span class="choice-letter">C</span>
                      <span class="choice-text">"Wait for MRI to see if there's salvageable tissue"</span>
                    </div>
                  </div>
                  <div class="scenario-consequence" id="consequence-stroke"></div>
                </div>
              </div>
            </div>

            <!-- Slide 13.8: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain warning animate">
                  "Every minute the clot remains,<br>
                  two million neurons perish.<br>
                  <br>
                  The IPD showed us the fading window.<br>
                  Act quickly, or the window closes forever."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 14: MISSING DATA IN IPD ==================== -->
          <div class="module-slides" data-module="14">

            <!-- Slide 14.1: Opening -->
            <div class="slide black active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  You have gathered the individual data.<br>
                  You open the files with hope.<br>
                  <br>
                  And then you see it: <em>empty cells</em>.<br>
                  <br>
                  Age: 67. Sex: Male. Smoking status: <em>missing</em>.<br>
                  Outcome at 1 year: <em>missing</em>.<br>
                  <br>
                  What now?
                </div>
              </div>
            </div>

            <!-- Slide 14.2: The Three Types -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Three Kinds of Missingness</div>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number" style="background:var(--green);">1</div>
                  <div class="lesson-content">
                    <h4>Missing Completely at Random (MCAR)</h4>
                    <p>Lab machine broke randomly. No relation to patient characteristics. <strong>Safe to ignore (but wasteful).</strong></p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background:var(--orange);">2</div>
                  <div class="lesson-content">
                    <h4>Missing at Random (MAR)</h4>
                    <p>Older patients more likely to miss follow-up. Missingness related to <em>observed</em> variables. <strong>Imputation can help.</strong></p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background:var(--red);">3</div>
                  <div class="lesson-content">
                    <h4>Missing Not at Random (MNAR)</h4>
                    <p>Patients with poor outcomes drop out. Missingness related to the <em>missing value itself</em>. <strong>Dangerous. Requires sensitivity analysis.</strong></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 14.3: The Decision Tree -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Handling Missing Data</div>
                <div class="decision-tree animate delay-1">
                  <h4>What To Do With Missing Values?</h4>
                  <div class="tree-level">
                    <div class="tree-node root">How much is missing?</div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 1.5rem;">
                    <div>
                      <div class="tree-node yes" style="background:rgba(34,197,94,0.3);">&lt;5%</div>
                      <div class="tree-label">Minor</div>
                    </div>
                    <div>
                      <div class="tree-node question">5-20%</div>
                      <div class="tree-label">Moderate</div>
                    </div>
                    <div>
                      <div class="tree-node no" style="background:rgba(197,48,48,0.3);">&gt;20%</div>
                      <div class="tree-label">Substantial</div>
                    </div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 1.5rem;">
                    <div class="tree-node action" style="font-size:0.75rem;">Complete case<br>may suffice</div>
                    <div class="tree-node ipd" style="font-size:0.75rem;">Multiple<br>imputation</div>
                    <div class="tree-node aggregate" style="font-size:0.75rem;">Impute +<br>sensitivity</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 14.4: Multiple Imputation -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">Multiple Imputation: The Standard</div>
                <div class="formula-box animate delay-1">
                  <div class="label">THE PROCESS</div>
                  <div class="formula">1. Impute ‚Üí 2. Analyze ‚Üí 3. Pool</div>
                  <div class="label">Create M imputed datasets, analyze each, combine using Rubin's rules</div>
                </div>
                <div class="simple-box blue animate delay-2">
                  <div class="simple-title">WHY MULTIPLE?</div>
                  <div class="simple-text">
                    Single imputation pretends you know the missing value.
                    <br><br>
                    Multiple imputation (M=20-50 datasets) reflects <strong>uncertainty</strong>
                    about what the missing value might have been.
                    <br><br>
                    This preserves valid standard errors and p-values.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 14.5: IPD-Specific Issues -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">IPD-Specific Missing Data Challenges</div>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Systematically Missing Variables</h4>
                    <p>Trial A measured biomarker X. Trial B didn't. Can't impute what was never collected.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Multilevel Structure</h4>
                    <p>Patients nested within trials. Imputation model must account for clustering.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Different Follow-up Durations</h4>
                    <p>Trial A followed for 2 years. Trial B for 5 years. Survival analysis needs care.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 14.6: Decision Tree for Systematically Missing -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">When a Variable Is Missing Entirely</div>
                <div class="decision-tree animate delay-1">
                  <h4>Trial Didn't Collect Your Key Covariate</h4>
                  <div class="tree-level">
                    <div class="tree-node root">Is it an effect modifier or confounder?</div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 2rem;">
                    <div>
                      <div class="tree-node question">Effect Modifier</div>
                      <div class="tree-arrow">&#8595;</div>
                      <div class="tree-node aggregate" style="font-size:0.75rem;">Restrict interaction<br>analysis to trials<br>with the variable</div>
                    </div>
                    <div>
                      <div class="tree-node question">Confounder</div>
                      <div class="tree-arrow">&#8595;</div>
                      <div class="tree-node ipd" style="font-size:0.75rem;">Sensitivity analysis<br>varying assumptions<br>about unmeasured</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 14.7: Branching Scenario -->
            <div class="slide gradient">
              <div class="content text-center">
                <div class="scenario-panel animate" id="scenario-missing">
                  <div class="scenario-header">
                    <span class="scenario-icon">&#x1F500;</span>
                    <span class="scenario-title">The Missing Biomarker</span>
                  </div>
                  <div class="scenario-situation">
                    Your IPD-MA tests whether a new cancer drug works better in biomarker-positive patients. You have IPD from 8 trials. But 3 trials (40% of patients) didn't measure the biomarker at all.
                    <br><br>
                    These 3 trials tend to be older and smaller.
                  </div>
                  <div class="scenario-question">How do you analyze the interaction?</div>
                  <div class="scenario-choices">
                    <div class="scenario-choice" onclick="selectScenarioChoice('missing', 'a')">
                      <span class="choice-letter">A</span>
                      <span class="choice-text">Impute the biomarker status based on other patient characteristics</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('missing', 'b')">
                      <span class="choice-letter">B</span>
                      <span class="choice-text">Analyze interaction only in the 5 trials with biomarker data; sensitivity analysis including all trials for overall effect</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('missing', 'c')">
                      <span class="choice-letter">C</span>
                      <span class="choice-text">Exclude the 3 trials entirely from the meta-analysis</span>
                    </div>
                  </div>
                  <div class="scenario-consequence" id="consequence-missing"></div>
                </div>
              </div>
            </div>

            <!-- Slide 14.8: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain animate">
                  "The empty cell is not nothing.<br>
                  It is a question: <em>Why is this unknown?</em><br>
                  <br>
                  Answer that question before you fill the gap&mdash;<br>
                  for the reason for absence shapes the solution."
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 15: THE AVAILABILITY TRAP ==================== -->
          <div class="module-slides" data-module="15">

            <!-- Slide 15.1: Opening -->
            <div class="slide black active">
              <div class="content text-center">
                <div class="rhetorical animate">
                  Have you not seen the researcher<br>
                  who gathered data from <em>willing</em> trialists<br>
                  and declared victory?<br>
                  <br>
                  But the <em>unwilling</em> held secrets.<br>
                  And those secrets changed everything.
                </div>
              </div>
            </div>

            <!-- Slide 15.2: The Story of Tamiflu -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Story of Tamiflu</div>
                <div class="story-card animate delay-1">
                  <div class="place">A TRUE STORY</div>
                  <div class="narrative">
                    For years, governments stockpiled Tamiflu for pandemic flu, spending billions.
                    <br><br>
                    Cochrane reviewers requested trial data to verify efficacy. Roche refused, citing confidentiality.
                    <br><br>
                    For five years, the BMJ campaigned for transparency. When full Clinical Study Reports were finally released in 2014, the picture changed: Tamiflu reduced symptom duration by less than a day and didn't prevent complications.
                    <br><br>
                    <strong>Billions spent on a drug whose full evidence was locked away.</strong>
                    <br><br>
                    The Tamiflu saga transformed expectations&mdash;today, clinical trial transparency is becoming the norm, not the exception.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 15.3: The Evidence -->
            <div class="slide blood">
              <div class="content text-center">
                <div class="title red animate">When IPD Is Selectively Available</div>
                <div class="simple-box animate delay-1">
                  <div class="simple-title">THE EMPIRICAL FINDING</div>
                  <div class="simple-text">
                    Studies have compared trials that share IPD vs. those that don't:
                    <br><br>
                    <strong>Industry-sponsored trials:</strong> Less likely to share<br>
                    <strong>Trials with negative results:</strong> Less likely to share<br>
                    <strong>Older trials:</strong> Data often lost
                    <br><br>
                    If these trials systematically differ in effect size,<br>
                    <strong>your IPD-MA is biased.</strong>
                  </div>
                </div>
                <div class="source animate delay-2" style="color:rgba(255,255,255,0.5);font-size:0.8rem;margin-top:1rem;">
                  Ahmed I, et al. BMJ 2012;344:d7762
                </div>
              </div>
            </div>

            <!-- Slide 15.4: The Comparison -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">Always Compare: IPD vs. Non-IPD Trials</div>
                <div class="decision-tree animate delay-1">
                  <h4>Assessing Availability Bias</h4>
                  <div class="tree-level">
                    <div class="tree-node root">Compare AD effects: trials with IPD vs. without</div>
                  </div>
                  <div class="tree-arrow">&#8595;</div>
                  <div class="tree-level" style="gap: 2rem;">
                    <div>
                      <div class="tree-node yes">Similar Effects</div>
                      <div class="tree-arrow">&#8595;</div>
                      <div class="tree-node action" style="font-size:0.75rem;">Low concern<br>for bias</div>
                    </div>
                    <div>
                      <div class="tree-node no">Different Effects</div>
                      <div class="tree-arrow">&#8595;</div>
                      <div class="tree-node" style="background:rgba(197,48,48,0.5);font-size:0.75rem;">High concern<br>Sensitivity analysis needed</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 15.5: The Checklist -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">The Availability Bias Checklist</div>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number" style="background:var(--green);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>Report IPD retrieval rate</h4>
                    <p>"We obtained IPD from 12/15 trials (80%)"</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background:var(--green);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>Compare IPD vs. non-IPD trial characteristics</h4>
                    <p>Sample size, funding, publication date, effect size from aggregate data</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background:var(--green);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>Sensitivity analysis including non-IPD trials</h4>
                    <p>Two-stage analysis combining IPD + AD from non-sharing trials</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background:var(--green);">&#10003;</div>
                  <div class="lesson-content">
                    <h4>Discuss reasons for non-sharing</h4>
                    <p>Data lost? Refused? Never requested? Each has different implications.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 15.6: Branching Scenario -->
            <div class="slide gradient">
              <div class="content text-center">
                <div class="scenario-panel animate" id="scenario-availability">
                  <div class="scenario-header">
                    <span class="scenario-icon">&#x1F500;</span>
                    <span class="scenario-title">The Reluctant Trialists</span>
                  </div>
                  <div class="scenario-situation">
                    Your IPD-MA of a surgical intervention obtained data from 8 of 12 eligible trials (67%). The 4 non-sharing trials are all industry-funded and show smaller benefits in their publications (pooled OR 0.95) compared to the 8 IPD trials (pooled OR 0.72).
                    <br><br>
                    Your IPD analysis shows OR 0.70.
                  </div>
                  <div class="scenario-question">How do you report this?</div>
                  <div class="scenario-choices">
                    <div class="scenario-choice" onclick="selectScenarioChoice('availability', 'a')">
                      <span class="choice-letter">A</span>
                      <span class="choice-text">Report IPD result (OR 0.70) as the main finding - IPD is gold standard</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('availability', 'b')">
                      <span class="choice-letter">B</span>
                      <span class="choice-text">Report IPD result with prominent warning about availability bias and sensitivity analysis including AD from non-sharing trials</span>
                    </div>
                    <div class="scenario-choice" onclick="selectScenarioChoice('availability', 'c')">
                      <span class="choice-letter">C</span>
                      <span class="choice-text">Wait until you get 100% IPD before publishing</span>
                    </div>
                  </div>
                  <div class="scenario-consequence" id="consequence-availability"></div>
                </div>
              </div>
            </div>

            <!-- Slide 15.7: The Combined Approach -->
            <div class="slide ipd">
              <div class="content text-center">
                <div class="title blue animate">The Two-Stage Hybrid Solution</div>
                <div class="formula-box animate delay-1">
                  <div class="label">COMBINING IPD + AD</div>
                  <div class="formula">Stage 1: Analyze IPD trials ‚Üí get &#x3B8;<sub>IPD</sub></div>
                  <div class="formula">Stage 2: Meta-analyze &#x3B8;<sub>IPD</sub> + &#x3B8;<sub>AD</sub> from non-IPD trials</div>
                  <div class="label">Uses all available evidence, even when IPD incomplete</div>
                </div>
                <div class="simple-box blue animate delay-2">
                  <div class="simple-title">THE PRINCIPLE</div>
                  <div class="simple-text">
                    <strong>IPD is not all-or-nothing.</strong>
                    <br><br>
                    Use IPD where you have it (for interaction testing).<br>
                    Supplement with AD for overall effect estimation.<br>
                    Transparency about what came from where.
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide 15.8: Refrain -->
            <div class="slide black">
              <div class="content text-center">
                <div class="refrain warning animate">
                  "The willing may not represent the whole.<br>
                  The open doors may hide the truth behind locked ones.<br>
                  <br>
                  Always ask: Who refused to share?<br>
                  And what might they be hiding?"
                </div>
              </div>
            </div>

          </div>

          <!-- ==================== MODULE 16: QUIZ AND REFERENCES ==================== -->
          <div class="module-slides" data-module="16">

            <!-- Slide 11.1: Quiz 1 -->
            <div class="slide dark active">
              <div class="content text-center">
                <div class="quiz-container animate">
                  <div class="quiz-question">What did the Early Breast Cancer Trialists' Group discover that individual trials could not?</div>
                  <div class="quiz-options">
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">Tamoxifen works better than placebo</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, true)">Tamoxifen only works in estrogen receptor positive tumors</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">Tamoxifen has significant side effects</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">Tamoxifen works better in younger women</div>
                  </div>
                  <div class="quiz-feedback"></div>
                </div>
              </div>
            </div>

            <!-- Slide 11.2: Quiz 2 -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="quiz-container animate">
                  <div class="quiz-question">What is the "ecological fallacy" in meta-analysis?</div>
                  <div class="quiz-options">
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">Assuming environmental factors don't affect treatment</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, true)">Assuming between-study relationships apply to within-study (individual) relationships</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">Pooling studies from different ecological regions</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">Using outdated trials in modern meta-analyses</div>
                  </div>
                  <div class="quiz-feedback"></div>
                </div>
              </div>
            </div>

            <!-- Slide 11.3: Quiz 3 -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="quiz-container animate">
                  <div class="quiz-question">When is a one-stage IPD analysis preferred over two-stage?</div>
                  <div class="quiz-options">
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, true)">When trials have sparse events or rare outcomes</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">When you have many large trials</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">When you want to create forest plots</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">When outcomes are common and follow-up is short</div>
                  </div>
                  <div class="quiz-feedback"></div>
                </div>
              </div>
            </div>

            <!-- Slide 11.4: Quiz 4 -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="quiz-container animate">
                  <div class="quiz-question">What should you do before analyzing IPD from multiple trials?</div>
                  <div class="quiz-options">
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">Immediately pool all data and run the main analysis</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">Exclude trials with missing variables</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, true)">Reproduce each trial's published results from the IPD to verify data integrity</div>
                    <div class="quiz-option" tabindex="0" role="button" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}" onclick="checkAnswer(this, false)">Convert all continuous variables to categorical</div>
                  </div>
                  <div class="quiz-feedback"></div>
                </div>
              </div>
            </div>

            <!-- Slide 11.5: References -->
            <div class="slide dark">
              <div class="content text-center">
                <div class="title gold animate">References</div>
                <div class="references animate delay-1">
                  <h4>Key Sources Cited in This Course</h4>
                  <ol>
                    <li>Riley RD, et al. <span class="journal">Individual Participant Data Meta-Analysis: A Handbook for Healthcare Research.</span> Wiley, 2021.</li>
                    <li>Stewart LA, et al. PRISMA-IPD: Preferred reporting items for systematic reviews and meta-analyses of individual participant data. <span class="journal">JAMA</span> 2015;313:1657-65.</li>
                    <li>Early Breast Cancer Trialists' Collaborative Group. Tamoxifen for early breast cancer. <span class="journal">Cochrane Database Syst Rev</span> 2001.</li>
                    <li>Cholesterol Treatment Trialists' Collaboration. Efficacy and safety of LDL-lowering therapy. <span class="journal">Lancet</span> 2010;376:1670-81.</li>
                    <li>Roberts D, et al. Antenatal corticosteroids for accelerating fetal lung maturation. <span class="journal">Cochrane Database Syst Rev</span> 2017.</li>
                    <li>IMPACT Study Group. Predicting outcome after traumatic brain injury. <span class="journal">PLoS Med</span> 2008;5:e165.</li>
                    <li>Debray TPA, et al. Get real in individual participant data meta-analysis. <span class="journal">Int J Epidemiol</span> 2015;44:1287-97.</li>
                    <li>Burke DL, et al. Meta-analysis using individual participant data. <span class="journal">Stat Med</span> 2017;36:320-38.</li>
                  </ol>
                </div>
              </div>
            </div>

            <!-- Slide 11.6: Completion -->
            <div class="slide hope">
              <div class="content text-center">
                <div class="big-number green animate" style="font-size:5rem;">&#10004;</div>
                <div class="title green animate delay-1">Course Complete</div>
                <div class="gold-line animate delay-2"></div>
                <div class="refrain hope animate delay-3">
                  "In the aggregate, the individual disappears.<br>
                  But you have learned to find them.<br>
                  You have learned to ask: Who benefits? Who is harmed?<br>
                  <br>
                  Now go&mdash;and let no patient vanish in the average."
                </div>
                <p class="animate delay-4" style="color:var(--gold);font-family:'Cormorant Garamond',serif;font-size:1.2rem;margin-top:1.5rem;">
                  The Hidden Patient &mdash; Now You See Them.
                </p>
                <button class="btn primary animate delay-5" onclick="showCertificate()" style="margin-top:2rem;padding:1rem 2rem;font-size:1.1rem;" aria-label="Get your completion certificate">
                  üéì Get Your Certificate
                </button>
              </div>
            </div>

          </div>

          <!-- Navigation -->
          <nav class="slide-nav" role="navigation" aria-label="Slide navigation">
            <button class="nav-btn" onclick="prevSlide()" aria-label="Previous slide" title="Previous slide (Left arrow)">&#8592;</button>
            <div class="nav-center">
              <div class="slide-counter" id="slideCounter" aria-live="polite" aria-atomic="true">1 / 6</div>
              <div class="progress" id="progressDots" role="tablist" aria-label="Slide indicators"></div>
            </div>
            <button class="nav-btn" onclick="nextSlide()" aria-label="Next slide" title="Next slide (Right arrow or Space)">&#8594;</button>
          </nav>

        </div>
      </div>
    </main>
  </div>

  <script>
    function toggleSidebar() {
      document.querySelector('.sidebar').classList.toggle('open');
      var overlay = document.querySelector('.sidebar-overlay');
      if (overlay) overlay.classList.toggle('show');
      var btn = document.querySelector('.mobile-menu-toggle, .sidebar-toggle, .hamburger');
      if (btn) btn.setAttribute('aria-expanded', btn.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
    }

    const modules = [
      { id: 1, title: "The Vanishing", subtitle: "Why IPD matters", slides: 6 },
      { id: 2, title: "Aggregate vs IPD", subtitle: "The ecological fallacy", slides: 6 },
      { id: 3, title: "The CTT Revelation", subtitle: "Statins for 170,000", slides: 6 },
      { id: 4, title: "When to Pursue IPD", subtitle: "The decision tree", slides: 6 },
      { id: 5, title: "One-Stage vs Two-Stage", subtitle: "Analysis approaches", slides: 6 },
      { id: 6, title: "The Timing Discovery", subtitle: "Corticosteroids & preterm birth", slides: 6 },
      { id: 7, title: "Obtaining IPD", subtitle: "The quest for data", slides: 6 },
      { id: 8, title: "Data Harmonization", subtitle: "Speaking one language", slides: 6 },
      { id: 9, title: "Testing Interactions", subtitle: "Who benefits most?", slides: 6 },
      { id: 10, title: "Prognosis & Prediction", subtitle: "IMPACT and beyond", slides: 6 },
      { id: 11, title: "The Aspirin Paradox", subtitle: "ATT: Risk determines benefit", slides: 8 },
      { id: 12, title: "The BP Revelation", subtitle: "BPLTTC: Age is not a barrier", slides: 8 },
      { id: 13, title: "The Stroke Window", subtitle: "Time is brain", slides: 8 },
      { id: 14, title: "Missing Data", subtitle: "The empty cells", slides: 8 },
      { id: 15, title: "The Availability Trap", subtitle: "Who refused to share?", slides: 8 },
      { id: 16, title: "Quiz & Sources", subtitle: "Test your knowledge", slides: 6 }
    ];

    // State management with localStorage persistence
    const STORAGE_KEY = 'ipd-course-progress';

    function loadProgress() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          const data = JSON.parse(saved);
          return {
            currentModule: Math.min(Math.max(1, data.currentModule || 1), modules.length),
            currentSlide: Math.max(1, data.currentSlide || 1),
            completedModules: new Set(data.completedModules || [])
          };
        }
      } catch (e) {
        console.warn('Could not load progress:', e);
      }
      return { currentModule: 1, currentSlide: 1, completedModules: new Set() };
    }

    function saveProgress() {
      try {
        const data = {
          currentModule,
          currentSlide,
          completedModules: Array.from(completedModules)
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        console.warn('Could not save progress:', e);
      }
    }

    // Initialize state from localStorage or defaults
    const savedState = loadProgress();
    let currentModule = savedState.currentModule;
    let currentSlide = savedState.currentSlide;
    const completedModules = savedState.completedModules;

    // Branching scenarios
    const scenarios = {
      'ipd-decision': {
        correct: 'b',
        consequences: {
          'a': { type: 'bad', text: 'Dangerous shortcut! The WHO REACT Working Group pursued IPD for COVID steroids and discovered crucial interactions: benefit was clearest in patients requiring oxygen. Aggregate analysis would have missed this nuance that shaped clinical practice.', lesson: 'When the question is "who benefits," IPD is not optional.' },
          'b': { type: 'good', text: 'Correct! Your question about effect modification by severity and timing demands patient-level data. The REACT Group\'s IPD analysis showed dexamethasone benefit was concentrated in patients on oxygen, guiding targeted treatment.' , lesson: 'IPD is essential when testing treatment-covariate interactions.' },
          'c': { type: 'neutral', text: 'Tempting but flawed. Trial-level categories differ: Trial A\'s "severe" may be Trial B\'s "moderate." You\'d be comparing apples and oranges. Only IPD lets you apply consistent severity definitions across all patients.', lesson: 'Aggregate subgroup analysis suffers from the ecological fallacy.' }
        }
      },
      'harmonization': {
        correct: 'c',
        consequences: {
          'a': { type: 'bad', text: 'Risky! The different outcome definitions could explain the larger effects in those trials (looser definitions catch more events). Including them without acknowledgment could inflate your pooled estimate.', lesson: 'Definition heterogeneity is a form of bias. Acknowledge it.' },
          'b': { type: 'neutral', text: 'Conservative but may lose valuable information. The 1990s trials may have different populations worth studying. Complete exclusion should be justified, not reflexive.', lesson: 'Exclusion is a decision with consequences. Document your reasoning.' },
          'c': { type: 'good', text: 'Correct! This approach gives a clean primary estimate while exploring robustness. If results change substantially with the non-standardized trials, that\'s important information about sensitivity to outcome definition.', lesson: 'Sensitivity analyses reveal what depends on your assumptions.' }
        }
      },
      'interaction': {
        correct: 'c',
        consequences: {
          'a': { type: 'bad', text: 'Overinterpretation! With 8 tests at alpha=0.05, you expect ~0.4 false positives by chance. A single p=0.03 after multiple testing is not compelling evidence of true effect modification.', lesson: 'Multiple testing inflates false positive risk. Adjust or acknowledge.' },
          'b': { type: 'neutral', text: 'Statistically appropriate (Bonferroni: 0.05/8 = 0.006 threshold) but perhaps too rigid. Biological plausibility matters too - older patients have higher stroke risk, so larger relative benefit is mechanistically sensible.', lesson: 'Statistics and biology should inform each other.' },
          'c': { type: 'good', text: 'Correct! Transparent reporting of the exploratory nature, acknowledgment of multiple testing, and calling for external validation is the scientific approach. The finding is interesting but not definitive.', lesson: 'Subgroup findings require replication before changing practice.' }
        }
      },
      'aspirin': {
        correct: 'b',
        consequences: {
          'a': { type: 'bad', text: 'Dangerous oversimplification! The ATT IPD analysis of 95,000 patients showed that in low-risk individuals (like this patient with 8% 10-year risk), the bleeding harm roughly equals the cardiovascular benefit. You\'d be exposing him to bleeding risk for negligible net benefit.', lesson: 'Average benefit masks risk-stratified truth. Not everyone benefits equally.' },
          'b': { type: 'good', text: 'Correct! The ATT IPD-MA demonstrated that aspirin\'s benefit-harm balance depends on baseline CVD risk. At 8% 10-year risk, the number needed to treat and number needed to harm are similar. Current guidelines (AHA 2019) recommend against routine aspirin in low-risk primary prevention.', lesson: 'IPD revealed the risk-benefit interaction that aggregates hid.' },
          'c': { type: 'bad', text: 'The dose doesn\'t change the fundamental problem. Low-dose aspirin still increases bleeding. The ATT showed that benefit-harm balance depends on baseline risk, not dose. At low CVD risk, even baby aspirin causes more harm than good.', lesson: 'Changing the dose doesn\'t fix an indication problem.' }
        }
      },
      'elderly-bp': {
        correct: 'b',
        consequences: {
          'a': { type: 'bad', text: 'The J-curve myth has been debunked by IPD evidence. The BPLTTC meta-analysis of 344,716 patients showed that proportional benefit of BP lowering is maintained even in patients ‚â•85 years. Age-based treatment nihilism denies effective prevention to those who may benefit most (higher absolute risk).', lesson: 'The J-curve in observational data was reverse causation, not treatment harm.' },
          'b': { type: 'good', text: 'Correct! The BPLTTC IPD-MA found no interaction between age and treatment benefit (p=0.85). A fit 82-year-old with elevated BP stands to gain from treatment. Consider frailty and life expectancy, but not age alone.', lesson: 'IPD from RCTs trumps ecological associations from observational studies.' },
          'c': { type: 'bad', text: 'Waiting for a stroke or MI before treating defeats the purpose of prevention. The BPLTTC showed primary prevention works at all ages. Watchful waiting in a patient with clear indication is harmful.', lesson: 'Prevention means treating before the event, not after.' }
        }
      },
      'stroke': {
        correct: 'b',
        consequences: {
          'a': { type: 'bad', text: 'Outdated thinking! The STT IPD analysis showed benefit extends to 4.5 hours, and the 2018 guidelines expanded the window. The 3-hour cutoff was from earlier, smaller trials. Every minute counts, but 4 hours is not too late.', lesson: 'IPD allowed continuous modeling of time-benefit relationship.' },
          'b': { type: 'good', text: 'Correct! The STT IPD-MA demonstrated that thrombolysis benefit, though diminished, persists up to 4.5 hours. At 4-4.5 hours, OR for good outcome is still ~1.26. Proceed urgently - every minute of further delay reduces benefit.', lesson: 'IPD revealed the decay curve that discrete trial windows obscured.' },
          'c': { type: 'bad', text: 'Dangerous delay! MRI takes time you don\'t have. The STT showed benefit declines continuously with time. At 4 hours, you\'re already in the diminishing returns zone. Standard CT to rule out hemorrhage is sufficient; adding MRI delays treatment when every minute costs neurons.', lesson: 'Perfect is the enemy of good when time is brain.' }
        }
      },
      'missing': {
        correct: 'b',
        consequences: {
          'a': { type: 'bad', text: 'Risky imputation! You cannot reliably impute a biomarker that was never measured based on other characteristics. This is "systematically missing" data - imputation would be speculation dressed as analysis. The missingness mechanism is MNAR (trials that didn\'t measure it may have had reasons).', lesson: 'You cannot impute what was never collected. That\'s fabrication, not imputation.' },
          'b': { type: 'good', text: 'Correct! Interaction analysis should be restricted to trials with the data. For the overall effect, you can include all trials (two-stage: IPD from 5 trials + AD from 3 trials). This maximizes appropriate use of available data while maintaining validity for each analysis type.', lesson: 'Different questions may use different subsets of your data.' },
          'c': { type: 'neutral', text: 'Too aggressive! Those 3 trials contribute valid information about the overall treatment effect, even if they can\'t inform the biomarker interaction. Excluding them entirely wastes evidence and may introduce selection bias if they differ systematically.', lesson: 'Exclusion should be proportionate to the problem.' }
        }
      },
      'availability': {
        correct: 'b',
        consequences: {
          'a': { type: 'bad', text: 'Availability bias alert! The non-sharing trials show substantially smaller effects (OR 0.95 vs 0.70). Reporting only IPD results without acknowledging this discrepancy would overstate the treatment effect. Industry trials often don\'t share negative data.', lesson: 'Available IPD may be a biased sample of all evidence.' },
          'b': { type: 'good', text: 'Correct! Transparent reporting includes: (1) IPD retrieval rate, (2) comparison of IPD vs non-IPD trial characteristics and effects, (3) sensitivity analysis combining IPD + AD. This lets readers judge the impact of availability bias.', lesson: 'IPD quality cannot compensate for selection bias in which trials share.' },
          'c': { type: 'neutral', text: '100% IPD is ideal but rarely achievable. Waiting indefinitely means the evidence never gets synthesized. Better to proceed with appropriate caveats and sensitivity analyses than to let perfect be the enemy of good.', lesson: 'Some IPD with caveats beats no synthesis at all.' }
        }
      }
    };

    let scenarioState = {};

    function selectScenarioChoice(scenarioId, choice) {
      if (scenarioState[scenarioId]) return;

      scenarioState[scenarioId] = choice;
      const scenario = scenarios[scenarioId];
      const consequence = scenario.consequences[choice];
      const isCorrect = choice === scenario.correct;

      // Update choice styling
      const panel = document.getElementById(`scenario-${scenarioId}`);
      const choices = panel.querySelectorAll('.scenario-choice');
      choices.forEach(c => {
        c.classList.add('answered');
        const letter = c.querySelector('.choice-letter').textContent.toLowerCase();
        if (letter === scenario.correct) c.classList.add('correct');
        if (letter === choice && !isCorrect) c.classList.add('incorrect');
      });

      // Show consequence
      const conseqDiv = document.getElementById(`consequence-${scenarioId}`);
      conseqDiv.innerHTML = `
        <div class="consequence-title">${isCorrect ? '&#10003; Good decision!' : '&#10007; Problematic decision'}</div>
        <div class="consequence-text">${consequence.text}</div>
        <div class="consequence-lesson">"${consequence.lesson}"</div>
      `;
      conseqDiv.classList.add('visible', consequence.type);
    }

    function init() {
      // Restore saved progress - activate correct module and slide
      if (currentModule > 1 || currentSlide > 1) {
        // Deactivate default first module
        document.querySelectorAll('.module-slides').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.slide').forEach(el => el.classList.remove('active'));

        // Activate saved module
        const targetModuleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
        if (targetModuleEl) {
          targetModuleEl.classList.add('active');

          // Activate saved slide within module
          const slides = targetModuleEl.querySelectorAll('.slide');
          const targetSlideIndex = Math.min(currentSlide - 1, slides.length - 1);
          if (slides[targetSlideIndex]) {
            slides[targetSlideIndex].classList.add('active');
          }
        }

        // Update breadcrumb
        const moduleTitle = modules[currentModule - 1];
        if (moduleTitle) {
          document.getElementById('currentModule').textContent = moduleTitle.title;
        }

        // Progress restored: Module ${currentModule}, Slide ${currentSlide}
      }

      renderModuleList();
      updateSlideNav();

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        // Don't intercept if user is in an input/interactive field
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' ||
            e.target.tagName === 'SELECT' || e.target.tagName === 'BUTTON' ||
            e.target.tagName === 'A' ||
            (e.target.getAttribute && e.target.getAttribute('role') === 'button')) return;

        if (e.key === 'ArrowRight' || e.key === ' ') {
          e.preventDefault();
          nextSlide();
        } else if (e.key === 'ArrowLeft') {
          e.preventDefault();
          prevSlide();
        } else if (e.key === 'Home') {
          e.preventDefault();
          goToModule(1);
        } else if (e.key === 'End') {
          e.preventDefault();
          goToModule(modules.length);
        }
      });

      // Touch swipe support for mobile
      let touchStartX = 0;
      let touchEndX = 0;
      const slidesContainer = document.getElementById('main-content');

      if (slidesContainer) {
        slidesContainer.addEventListener('touchstart', (e) => {
          touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });

        slidesContainer.addEventListener('touchend', (e) => {
          touchEndX = e.changedTouches[0].screenX;
          handleSwipe();
        }, { passive: true });
      }

      function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;
        if (Math.abs(diff) > swipeThreshold) {
          if (diff > 0) {
            nextSlide(); // Swipe left = next
          } else {
            prevSlide(); // Swipe right = prev
          }
        }
      }

      // Save progress before user leaves
      window.addEventListener('beforeunload', saveProgress);

      // Announce initial slide to screen readers
      announceSlide();

      // Show initial progress percentage
      updateProgressPercent();
    }

    // Accessibility: Announce slide changes to screen readers
    function announceSlide() {
      const module = modules[currentModule - 1];
      if (!module) return;

      const announcement = `Module ${currentModule}: ${module.title}. Slide ${currentSlide} of ${module.slides}.`;
      const liveRegion = document.getElementById('ariaLiveRegion');
      if (liveRegion) {
        liveRegion.textContent = announcement;
      }

      updateProgressPercent();
    }

    // Update completion percentage display
    function updateProgressPercent() {
      const totalSlides = modules.reduce((sum, m) => sum + m.slides, 0);
      let completedSlides = 0;

      // Count slides in completed modules
      completedModules.forEach(moduleId => {
        const mod = modules.find(m => m.id === moduleId);
        if (mod) completedSlides += mod.slides;
      });

      // Add current progress in current module
      completedSlides += currentSlide - 1;

      const percent = Math.round((completedSlides / totalSlides) * 100);
      const progressEl = document.getElementById('progressPercent');
      if (progressEl) {
        progressEl.textContent = `Progress: ${percent}%`;
      }
    }

    function renderModuleList() {
      const list = document.getElementById('moduleList');
      list.innerHTML = modules.map(m => `
        <div class="module-item ${m.id === currentModule ? 'active' : ''} ${completedModules.has(m.id) ? 'completed' : ''}"
             onclick="goToModule(${m.id})"
             onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();event.stopPropagation();goToModule(${m.id});}"
             role="listitem"
             tabindex="0"
             aria-label="Module ${m.id}: ${m.title}. ${m.subtitle}. ${completedModules.has(m.id) ? 'Completed.' : ''} ${m.id === currentModule ? 'Current module.' : ''}"
             aria-current="${m.id === currentModule ? 'true' : 'false'}">
          <div class="module-number" aria-hidden="true">${completedModules.has(m.id) ? '&#10003;' : m.id}</div>
          <div class="module-info">
            <div class="module-title">${m.title}</div>
            <div class="module-subtitle">${m.subtitle}</div>
          </div>
        </div>
      `).join('');
    }

    function goToModule(moduleId) {
      // Bounds checking
      if (moduleId < 1 || moduleId > modules.length) {
        console.warn(`Invalid module ID: ${moduleId}. Must be between 1 and ${modules.length}.`);
        return;
      }

      if (moduleId > currentModule) completedModules.add(currentModule);
      currentModule = moduleId;

      // Ensure slide is within bounds for new module
      const targetModule = modules[moduleId - 1];
      currentSlide = Math.min(Math.max(1, currentSlide), targetModule.slides);
      currentSlide = 1; // Start at first slide of new module

      document.querySelectorAll('.module-slides').forEach(el => el.classList.remove('active'));
      const targetModuleEl = document.querySelector(`.module-slides[data-module="${moduleId}"]`);
      if (targetModuleEl) {
        targetModuleEl.classList.add('active');
      }

      updateSlideVisibility();
      updateSlideNav();
      renderModuleList();

      const moduleTitle = modules[moduleId - 1];
      if (moduleTitle) {
        document.getElementById('currentModule').textContent = moduleTitle.title;
      }

      saveProgress();
      announceSlide();
    }

    function updateSlideVisibility() {
      const moduleSlides = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      if (!moduleSlides) {
        console.warn(`Module slides not found for module ${currentModule}`);
        return;
      }
      const slides = moduleSlides.querySelectorAll('.slide');
      slides.forEach((slide, index) => slide.classList.toggle('active', index + 1 === currentSlide));
    }

    function updateSlideNav() {
      const module = modules[currentModule - 1];
      if (!module) {
        console.warn(`Module data not found for index ${currentModule - 1}`);
        return;
      }
      const slideCounter = document.getElementById('slideCounter');
      const progressDots = document.getElementById('progressDots');
      if (slideCounter) {
        slideCounter.textContent = `${currentSlide} / ${module.slides}`;
      }
      if (progressDots) {
        progressDots.innerHTML = Array.from({ length: module.slides }, (_, i) =>
          `<div class="progress-dot ${i + 1 === currentSlide ? 'active' : ''}"
                onclick="goToSlide(${i + 1})"
                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();event.stopPropagation();goToSlide(${i + 1});}"
                role="tab"
                tabindex="${i + 1 === currentSlide ? '0' : '-1'}"
                aria-selected="${i + 1 === currentSlide ? 'true' : 'false'}"
                aria-label="Go to slide ${i + 1}"></div>`
        ).join('');
      }
    }

    // Reset progress function (can be called from console or UI)
    function resetProgress() {
      try {
        localStorage.removeItem(STORAGE_KEY);
        currentModule = 1;
        currentSlide = 1;
        completedModules.clear();

        // Reset UI
        document.querySelectorAll('.module-slides').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.slide').forEach(el => el.classList.remove('active'));

        const firstModule = document.querySelector('.module-slides[data-module="1"]');
        if (firstModule) {
          firstModule.classList.add('active');
          const firstSlide = firstModule.querySelector('.slide');
          if (firstSlide) firstSlide.classList.add('active');
        }

        document.getElementById('currentModule').textContent = modules[0].title;
        renderModuleList();
        updateSlideNav();
        updateProgressPercent();
        announceSlide();

        // Progress reset successfully
      } catch (e) {
        console.error('Failed to reset progress:', e);
      }
    }

    function goToSlide(slideNum) {
      // Bounds checking
      const module = modules[currentModule - 1];
      if (!module || slideNum < 1 || slideNum > module.slides) {
        console.warn(`Invalid slide number: ${slideNum}. Must be between 1 and ${module ? module.slides : '?'}.`);
        return;
      }

      currentSlide = slideNum;
      updateSlideVisibility();
      updateSlideNav();
      saveProgress();
      announceSlide();
    }

    function nextSlide() {
      // Bounds checking
      if (currentModule < 1 || currentModule > modules.length) {
        console.warn('Invalid current module state');
        currentModule = 1;
        currentSlide = 1;
        saveProgress();
        return;
      }

      const module = modules[currentModule - 1];
      if (!module) return;

      if (currentSlide < module.slides) {
        currentSlide++;
        updateSlideVisibility();
        updateSlideNav();
        saveProgress();
        announceSlide();
      } else if (currentModule < modules.length) {
        goToModule(currentModule + 1);
      }
      // If at last slide of last module, do nothing (already handled)
    }

    function prevSlide() {
      // Bounds checking
      if (currentModule < 1 || currentModule > modules.length) {
        console.warn('Invalid current module state');
        currentModule = 1;
        currentSlide = 1;
        saveProgress();
        return;
      }

      if (currentSlide > 1) {
        currentSlide--;
        updateSlideVisibility();
        updateSlideNav();
        saveProgress();
        announceSlide();
      } else if (currentModule > 1) {
        // Bounds check for previous module
        const prevModuleIndex = currentModule - 2;
        if (prevModuleIndex < 0 || prevModuleIndex >= modules.length) {
          console.warn('Invalid previous module index');
          return;
        }

        const prevModuleSlides = modules[prevModuleIndex].slides;
        currentModule--;
        currentSlide = prevModuleSlides;

        document.querySelectorAll('.module-slides').forEach(el => el.classList.remove('active'));
        const targetModuleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
        if (targetModuleEl) {
          targetModuleEl.classList.add('active');
        }

        updateSlideVisibility();
        updateSlideNav();
        renderModuleList();

        const moduleTitle = modules[currentModule - 1];
        if (moduleTitle) {
          document.getElementById('currentModule').textContent = moduleTitle.title;
        }

        saveProgress();
        announceSlide();
      }
      // If at first slide of first module, do nothing (already handled)
    }

    function checkAnswer(element, isCorrect) {
      const container = element.closest('.quiz-container');
      const options = container.querySelectorAll('.quiz-option');
      const feedback = container.querySelector('.quiz-feedback');

      options.forEach(opt => {
        opt.style.pointerEvents = 'none';
        if (opt === element) opt.classList.add(isCorrect ? 'correct' : 'incorrect');
      });

      feedback.classList.add('show', isCorrect ? 'correct' : 'incorrect');
      feedback.innerHTML = isCorrect
        ? '<strong>Correct!</strong> You understand the key concept.'
        : '<strong>Not quite.</strong> Review the module to understand why.';
    }

    // ==================== THEME TOGGLE ====================
    function toggleTheme() {
      const body = document.body;
      const themeBtn = document.getElementById('themeToggle');
      const isLight = body.classList.toggle('light-theme');

      // Update button icon
      if (themeBtn) {
        themeBtn.textContent = isLight ? 'üåô' : '‚òÄÔ∏è';
        themeBtn.setAttribute('aria-label', isLight ? 'Switch to dark mode' : 'Switch to light mode');
      }

      // Save preference
      try {
        localStorage.setItem('ipd-course-theme', isLight ? 'light' : 'dark');
      } catch (e) {
        console.warn('Could not save theme preference');
      }
    }

    function loadTheme() {
      try {
        const savedTheme = localStorage.getItem('ipd-course-theme');
        const themeBtn = document.getElementById('themeToggle');

        if (savedTheme === 'light') {
          document.body.classList.add('light-theme');
          if (themeBtn) {
            themeBtn.textContent = 'üåô';
            themeBtn.setAttribute('aria-label', 'Switch to dark mode');
          }
        }
      } catch (e) {
        console.warn('Could not load theme preference');
      }
    }

    // ==================== CERTIFICATE ====================
    function showCertificate() {
      const modal = document.getElementById('certificateModal');
      const dateEl = document.getElementById('certDate');

      if (modal) {
        modal.classList.add('visible');

        // Set current date
        if (dateEl) {
          const now = new Date();
          const options = { year: 'numeric', month: 'long', day: 'numeric' };
          dateEl.textContent = `Completed on ${now.toLocaleDateString('en-US', options)}`;
        }

        // Focus the name input
        const nameInput = document.getElementById('certName');
        if (nameInput) {
          setTimeout(() => nameInput.focus(), 100);
        }
      }
    }

    function closeCertificate() {
      const modal = document.getElementById('certificateModal');
      if (modal) {
        modal.classList.remove('visible');
      }
    }

    function printCertificate() {
      const name = document.getElementById('certName')?.value || 'Course Participant';
      const certContent = document.getElementById('certificateContent');

      if (!certContent) return;

      // Temporarily replace input with name text
      const nameInput = document.getElementById('certName');
      const originalHTML = nameInput?.outerHTML;
      if (nameInput) {
        const nameSpan = document.createElement('span');
        nameSpan.className = 'certificate-name';
        nameSpan.textContent = name;
        nameInput.replaceWith(nameSpan);
      }

      // Hide action buttons for print
      const actions = certContent.querySelector('.certificate-actions');
      const closeBtn = certContent.querySelector('.certificate-close');
      if (actions) actions.style.display = 'none';
      if (closeBtn) closeBtn.style.display = 'none';

      // Print
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Certificate - IPD Meta-Analysis Course</title>
          <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&display=swap" rel="stylesheet">
          <style>
            body { margin: 0; padding: 2rem; font-family: 'Cormorant Garamond', Georgia, serif; }
            .certificate {
              background: linear-gradient(135deg, #faf8f5 0%, #fff 100%);
              border: 8px solid #D4AF37;
              border-radius: 12px;
              padding: 3rem;
              max-width: 700px;
              margin: 0 auto;
              text-align: center;
            }
            .certificate-header { font-size: 2.5rem; color: #1E2761; margin-bottom: 0.5rem; }
            .certificate-subtitle { font-size: 1rem; color: #718096; margin-bottom: 2rem; letter-spacing: 0.2em; text-transform: uppercase; }
            .certificate-body { font-size: 1.2rem; color: #2D3748; line-height: 1.8; margin-bottom: 2rem; }
            .certificate-name { font-size: 2rem; font-weight: 700; color: #1E2761; border-bottom: 2px solid #D4AF37; display: inline-block; padding: 0 2rem 0.5rem; margin: 1rem 0; }
            .certificate-date { font-size: 0.9rem; color: #718096; margin-top: 1.5rem; }
            .certificate-seal { width: 80px; height: 80px; background: linear-gradient(135deg, #D4AF37, #B8860B); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 1.5rem auto 0; color: white; font-size: 2rem; }
          </style>
        </head>
        <body>
          ${certContent.innerHTML}
        </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();

      // Restore original state
      if (actions) actions.style.display = '';
      if (closeBtn) closeBtn.style.display = '';
      const nameSpan = certContent.querySelector('.certificate-name');
      if (nameSpan && originalHTML) {
        nameSpan.outerHTML = originalHTML;
      }
    }

    function downloadCertificate() {
      const name = document.getElementById('certName')?.value || 'Course Participant';
      const dateEl = document.getElementById('certDate')?.textContent || '';

      // Create a canvas-based certificate image
      const canvas = document.createElement('canvas');
      canvas.width = 1000;
      canvas.height = 700;
      const ctx = canvas.getContext('2d');

      // Background gradient
      const gradient = ctx.createLinearGradient(0, 0, 1000, 700);
      gradient.addColorStop(0, '#faf8f5');
      gradient.addColorStop(1, '#ffffff');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, 1000, 700);

      // Border
      ctx.strokeStyle = '#D4AF37';
      ctx.lineWidth = 16;
      ctx.strokeRect(20, 20, 960, 660);

      // Inner border
      ctx.strokeStyle = '#1E2761';
      ctx.lineWidth = 2;
      ctx.strokeRect(40, 40, 920, 620);

      // Header
      ctx.fillStyle = '#1E2761';
      ctx.font = 'bold 48px Georgia, serif';
      ctx.textAlign = 'center';
      ctx.fillText('Certificate of Completion', 500, 120);

      // Subtitle
      ctx.fillStyle = '#718096';
      ctx.font = '18px Arial, sans-serif';
      ctx.letterSpacing = '0.2em';
      ctx.fillText('INDIVIDUAL PARTICIPANT DATA META-ANALYSIS', 500, 160);

      // Body text
      ctx.fillStyle = '#2D3748';
      ctx.font = '22px Georgia, serif';
      ctx.fillText('This certifies that', 500, 240);

      // Name
      ctx.fillStyle = '#1E2761';
      ctx.font = 'bold 36px Georgia, serif';
      ctx.fillText(name, 500, 300);

      // Name underline
      const nameWidth = ctx.measureText(name).width;
      ctx.strokeStyle = '#D4AF37';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(500 - nameWidth/2 - 20, 315);
      ctx.lineTo(500 + nameWidth/2 + 20, 315);
      ctx.stroke();

      // More body text
      ctx.fillStyle = '#2D3748';
      ctx.font = '22px Georgia, serif';
      ctx.fillText('has successfully completed the course', 500, 380);
      ctx.font = 'bold 24px Georgia, serif';
      ctx.fillText('"The Hidden Patient: IPD Meta-Analysis"', 500, 420);
      ctx.font = '18px Georgia, serif';
      ctx.fillText('demonstrating understanding of individual participant data', 500, 460);
      ctx.fillText('synthesis methods and their clinical applications.', 500, 485);

      // Date
      ctx.fillStyle = '#718096';
      ctx.font = '16px Arial, sans-serif';
      ctx.fillText(dateEl, 500, 540);

      // Seal
      ctx.fillStyle = '#D4AF37';
      ctx.beginPath();
      ctx.arc(500, 610, 40, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = 'white';
      ctx.font = 'bold 36px Arial, sans-serif';
      ctx.fillText('‚úì', 500, 625);

      // Download
      const link = document.createElement('a');
      link.download = `IPD-Certificate-${name.replace(/[^a-zA-Z0-9\s-]/g, '').replace(/\s+/g, '-')}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
    }

    // Close certificate with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeCertificate();
      }
    });

    // Close certificate when clicking outside
    document.getElementById('certificateModal')?.addEventListener('click', (e) => {
      if (e.target.id === 'certificateModal') {
        closeCertificate();
      }
    });

    // ==================== INIT ====================
    init();
    loadTheme();
  </script>
</body>
</html>
