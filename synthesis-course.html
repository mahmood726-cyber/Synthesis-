<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Evidence Reversal: A Meta-Analysis Course</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --navy: #1E2761;
      --deep-navy: #141B3D;
      --gold: #D4AF37;
      --cream: #FAF8F5;
      --light-cream: #FFFFFF;
      --text: #2D3748;
      --light-text: #718096;
      --red: #C53030;
      --green: #22c55e;
      --transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
      font-family: 'Source Sans Pro', sans-serif;
      background: var(--deep-navy);
      color: var(--cream);
    }

    /* ====== COURSE SHELL ====== */
    .course-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* ====== SIDEBAR NAV ====== */
    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, var(--deep-navy) 0%, #0a0f1a 100%);
      border-right: 1px solid rgba(212,175,55,0.2);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .sidebar-header h1 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.25rem;
    }

    .sidebar-header p {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
    }

    .module-list {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
    }

    .module-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .module-item:hover {
      background: rgba(212,175,55,0.1);
    }

    .module-item.active {
      background: rgba(212,175,55,0.15);
      border-left-color: var(--gold);
    }

    .module-item.completed .module-number {
      background: var(--green);
      color: white;
    }

    .module-number {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .module-item.active .module-number {
      background: var(--gold);
      color: var(--navy);
    }

    .module-info {
      flex: 1;
      min-width: 0;
    }

    .module-title {
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .module-subtitle {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.7); /* Increased for WCAG AA contrast */
    }

    .sidebar-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(212,175,55,0.2);
      font-size: 0.75rem;
      color: rgba(255,255,255,0.4);
    }

    /* ====== MAIN CONTENT ====== */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .content-header {
      padding: 1rem 2rem;
      background: rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(212,175,55,0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .breadcrumb {
      font-size: 0.85rem;
      color: rgba(255,255,255,0.6);
    }

    .breadcrumb span {
      color: var(--gold);
    }

    .header-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      background: rgba(212,175,55,0.2);
      border-color: var(--gold);
    }

    .btn.primary {
      background: var(--gold);
      color: var(--navy);
      border-color: var(--gold);
      font-weight: 600;
    }

    .content-body {
      flex: 1;
      overflow: hidden;
      display: flex;
    }

    /* ====== SLIDES AREA ====== */
    .slides-container {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .module-slides {
      display: none;
      width: 100%;
      height: 100%;
    }

    .module-slides.active {
      display: block;
    }

    .slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start; /* Changed from center - prevents content clipping */
      align-items: center;
      padding: 2rem 2rem 5rem 2rem; /* Extra bottom clearance for nav bar */
      padding-top: 3rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition), visibility var(--transition);
      overflow-y: auto; /* Allow scrolling if content is tall */
      overflow-x: hidden;
    }

    /* Center content vertically only when there's enough space */
    .slide .content,
    .slide .refrain,
    .slide .title {
      margin-top: auto;
      margin-bottom: auto;
    }

    /* Ensure content doesn't overflow horizontally */
    .slide > * {
      max-width: 100%;
      word-wrap: break-word;
    }

    .slide.active {
      opacity: 1;
      visibility: visible;
    }

    .slide.dark { background: var(--deep-navy); color: var(--cream); }
    .slide.light { background: var(--cream); color: var(--text); }
    .slide.black { background: #000; color: var(--cream); }

    /* Typography */
    .serif { font-family: 'Cormorant Garamond', Georgia, serif; }

    .title {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 700;
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .title.navy { color: var(--navy); }
    .title.gold { color: var(--gold); }
    .title.cream { color: var(--cream); }

    .subtitle {
      font-size: clamp(1rem, 2vw, 1.5rem);
      color: var(--light-text);
      margin-bottom: 2rem;
    }

    .slide.dark .subtitle { color: rgba(255,255,255,0.7); }

    .big-number {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(4rem, 15vw, 10rem);
      font-weight: 700;
      line-height: 1;
    }

    .big-number.navy { color: var(--navy); }
    .big-number.gold { color: var(--gold); }

    .refrain {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      max-width: 800px;
    }

    /* Cards */
    .card {
      background: var(--light-cream);
      border: 1px solid var(--gold);
      padding: 1.5rem 2rem;
      margin: 0.75rem 0;
      max-width: 800px;
      width: 100%;
    }

    .card.navy-bg {
      background: var(--navy);
      color: var(--cream);
    }

    .card.red-border { border: 2px solid var(--red); }

    .card-label {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .card-text {
      font-size: clamp(0.9rem, 1.8vw, 1.1rem);
    }

    .card.navy-bg .card-text { color: var(--cream); }

    /* Stats grid */
    .stats-grid {
      display: flex;
      gap: 1rem;
      margin: 1.5rem 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .stat-box {
      background: var(--navy);
      color: var(--cream);
      padding: 1rem 1.5rem;
      text-align: center;
      min-width: 140px;
    }

    .stat-value {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 700;
    }

    .stat-label {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-top: 0.25rem;
    }

    /* Design grid */
    .design-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      max-width: 900px;
      width: 100%;
    }

    @media (max-width: 768px) {
      .design-grid { grid-template-columns: repeat(2, 1fr); }
    }

    .design-item {
      background: var(--light-cream);
      border-left: 3px solid var(--gold);
      padding: 1rem;
    }

    .design-item-label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }

    .design-item-value {
      font-size: 0.85rem;
      color: var(--text);
      line-height: 1.4;
    }

    /* Results table */
    .results-table {
      width: 100%;
      max-width: 700px;
      border-collapse: collapse;
      margin: 1rem 0;
    }

    .results-table th {
      background: var(--navy);
      color: var(--cream);
      padding: 0.75rem 1rem;
      text-align: left;
      font-weight: 600;
    }

    .results-table th:not(:first-child) { text-align: center; }

    .results-table td {
      padding: 0.6rem 1rem;
      border-bottom: 1px solid #E2E8F0;
    }

    .results-table td:not(:first-child) { text-align: center; }
    .results-table .highlight { color: var(--red); font-weight: 700; }

    /* Result box */
    .result-box {
      background: var(--navy);
      padding: 1rem 2rem;
      text-align: center;
      margin: 1rem 0;
      max-width: 500px;
    }

    .result-box .value {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 700;
      color: var(--gold);
    }

    .result-box .label {
      font-size: 0.9rem;
      color: var(--cream);
      margin-top: 0.25rem;
    }

    /* Lesson items */
    .lesson-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin: 0.75rem 0;
      max-width: 800px;
    }

    .lesson-number {
      background: var(--gold);
      color: var(--navy);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }

    .lesson-content h4 {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .lesson-content p {
      font-size: 0.9rem;
      color: var(--light-text);
    }

    /* Gold line */
    .gold-line {
      width: 150px;
      height: 2px;
      background: var(--gold);
      margin: 1.5rem auto;
    }

    /* Closing lines */
    .closing-line {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.2rem, 2.5vw, 1.75rem);
      margin: 0.5rem 0;
      text-align: center;
    }

    .closing-line.gold { color: var(--gold); font-weight: 700; }
    .closing-line.italic { font-style: italic; opacity: 0.9; }

    /* Focus box */
    .focus-box {
      background: var(--navy);
      padding: 1rem 2rem;
      text-align: center;
      max-width: 600px;
    }

    .focus-box .main {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem;
      font-style: italic;
      color: var(--gold);
    }

    .focus-box .sub {
      font-size: 0.9rem;
      color: var(--cream);
      margin-top: 0.5rem;
    }

    /* Arrow */
    .arrow { color: var(--light-text); font-size: 1.2rem; margin: 0.25rem 0; }
    .footnote { font-size: 0.75rem; color: var(--light-text); font-style: italic; text-align: center; margin-top: 1rem; }
    .red { color: var(--red); }
    .text-center { text-align: center; }
    .mb-1 { margin-bottom: 1rem; }
    .mb-2 { margin-bottom: 2rem; }
    .mt-1 { margin-top: 1rem; }
    .mt-2 { margin-top: 2rem; }

    /* Content wrapper */
    .content {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 1000px;
    }

    /* Animation */
    .slide.active .animate { animation: fadeUp 0.6s ease-out forwards; }
    .slide.active .animate.delay-1 { animation-delay: 0.1s; }
    .slide.active .animate.delay-2 { animation-delay: 0.2s; }
    .slide.active .animate.delay-3 { animation-delay: 0.3s; }
    .slide.active .animate.delay-4 { animation-delay: 0.4s; }
    .slide.active .animate.delay-5 { animation-delay: 0.5s; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate { opacity: 0; }

    /* ====== SLIDE NAV ====== */
    /* Minimal floating arrows - no background strip */
    .slide-nav {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      padding: 1rem 1rem 1.5rem 1rem;
      z-index: 100;
      pointer-events: none; /* Allow clicks through to content */
    }

    .nav-btn {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 1.25rem;
      cursor: pointer;
      opacity: 0.6;
      transition: all 0.2s;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      pointer-events: auto; /* Buttons are clickable */
    }

    .nav-btn:hover {
      opacity: 1;
      background: rgba(0,0,0,0.7);
      border-color: var(--gold);
    }
    .nav-btn:disabled { opacity: 0.2; cursor: not-allowed; }

    /* Center info (counter + progress) - compact */
    .nav-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      pointer-events: none; /* Don't block quiz/content clicks beneath */
    }

    .slide-counter {
      font-size: 0.75rem;
      opacity: 0.6;
    }

    .progress { display: flex; gap: 4px; }

    .progress-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(255,255,255,0.25);
      cursor: pointer;
      transition: all 0.2s;
      pointer-events: auto; /* Only dots are clickable, not the whole nav-center */
    }

    .progress-dot.active {
      background: var(--gold);
      transform: scale(1.3);
    }

    .progress-dot:hover {
      background: rgba(255,255,255,0.5);
    }

    .progress-dot:hover { background: rgba(255,255,255,0.6); }

    .slide-counter {
      color: rgba(255,255,255,0.6);
      font-size: 0.85rem;
      min-width: 50px;
      text-align: center;
    }

    /* ====== TOOLS PANEL ====== */
    .tools-panel {
      width: 380px;
      max-width: 40vw; /* Limit to 40% of viewport so content isn't squeezed too much */
      background: var(--cream);
      border-left: 1px solid rgba(0,0,0,0.1);
      display: none; /* Hidden by default */
      flex-direction: column;
      flex-shrink: 0;
      overflow-y: auto;
    }

    .tools-panel.visible {
      display: flex;
    }

    .tools-panel.collapsed {
      width: 50px;
    }

    /* Adjust slide padding when tools panel is open */
    .content-body.tools-open .slide {
      padding-left: 1.5rem;
      padding-right: 1.5rem;
    }

    .content-body.tools-open .slide .content {
      max-width: 100%;
    }

    .tools-header {
      padding: 1rem;
      background: var(--navy);
      color: var(--cream);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tools-header h3 {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .tools-content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    /* Live Story Data Panel */
    .story-data-panel {
      background: linear-gradient(135deg, #1E2761 0%, #141B3D 100%);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      color: white;
    }

    .story-data-panel h4 {
      color: var(--gold);
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .story-toggle {
      display: flex;
      background: rgba(255,255,255,0.1);
      border-radius: 25px;
      padding: 4px;
      margin-bottom: 1rem;
    }

    .story-toggle button {
      flex: 1;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 20px;
      background: transparent;
      color: rgba(255,255,255,0.7);
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .story-toggle button.active {
      background: var(--gold);
      color: var(--navy);
    }

    .story-toggle button:hover:not(.active) {
      background: rgba(255,255,255,0.15);
      color: white;
    }

    .story-viz {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      min-height: 200px;
      transition: all 0.5s ease;
    }

    .story-viz svg {
      transition: all 0.5s ease;
    }

    .story-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }

    .story-metric {
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .story-metric.highlight-good {
      background: rgba(34, 197, 94, 0.3);
      border: 1px solid rgba(34, 197, 94, 0.5);
    }

    .story-metric.highlight-bad {
      background: rgba(197, 48, 48, 0.3);
      border: 1px solid rgba(197, 48, 48, 0.5);
    }

    .story-metric .value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
    }

    .story-metric .label {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.7);
      margin-top: 0.25rem;
    }

    .story-insight {
      background: rgba(212,175,55,0.2);
      border-left: 3px solid var(--gold);
      padding: 0.75rem;
      border-radius: 0 8px 8px 0;
      margin-top: 0.75rem;
      font-size: 0.75rem;
      line-height: 1.5;
    }

    /* ====== PREDICT FIRST INTERFACE ====== */
    .predict-first-panel {
      background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(30,39,97,0.3));
      border: 1px solid var(--gold);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      margin-top: 0.5rem;
    }

    .predict-first-panel .predict-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .predict-first-panel h4 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .predict-first-panel p {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.9);
      line-height: 1.4;
    }

    .predict-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .predict-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      border: 2px solid;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(0,0,0,0.2);
    }

    .predict-btn.benefit {
      border-color: #22c55e;
      color: #22c55e;
    }

    .predict-btn.benefit:hover {
      background: rgba(34,197,94,0.2);
    }

    .predict-btn.neutral {
      border-color: #94a3b8;
      color: #94a3b8;
    }

    .predict-btn.neutral:hover {
      background: rgba(148,163,184,0.2);
    }

    .predict-btn.harm {
      border-color: #ef4444;
      color: #ef4444;
    }

    .predict-btn.harm:hover {
      background: rgba(239,68,68,0.2);
    }

    .predict-icon-small {
      font-size: 1rem;
    }

    /* Prediction Feedback */
    .prediction-feedback {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .prediction-feedback.correct {
      background: rgba(34,197,94,0.2);
      border: 1px solid #22c55e;
      color: #22c55e;
    }

    .prediction-feedback.incorrect {
      background: rgba(239,68,68,0.15);
      border: 1px solid #ef4444;
      color: #fca5a5;
    }

    .feedback-icon {
      font-size: 1rem;
    }

    /* ====== PROGRESS DASHBOARD ====== */
    .progress-dashboard {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(5px);
      z-index: 2000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .progress-dashboard.open {
      display: flex;
    }

    .dashboard-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 1px solid var(--gold);
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(212,175,55,0.3);
    }

    .dashboard-header h2 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1.3rem;
    }

    .dashboard-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      opacity: 0.7;
    }

    .dashboard-close:hover { opacity: 1; }

    .level-display {
      background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(212,175,55,0.05));
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .level-badge {
      display: inline-block;
      background: var(--gold);
      color: var(--navy);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.8rem;
      margin-bottom: 0.5rem;
    }

    .points-display {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--gold);
    }

    .points-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .stat-card {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--gold);
    }

    .stat-label {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.6);
      margin-top: 0.25rem;
    }

    .principles-section h3, .badges-section h3, .streak-section h3 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .principle-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem;
      background: rgba(255,255,255,0.03);
      border-radius: 6px;
      margin-bottom: 0.35rem;
    }

    .principle-num {
      width: 20px;
      height: 20px;
      background: rgba(212,175,55,0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      color: var(--gold);
      flex-shrink: 0;
    }

    .principle-num.mastered {
      background: var(--gold);
      color: var(--navy);
    }

    .principle-text {
      flex: 1;
      font-size: 0.7rem;
      color: rgba(255,255,255,0.8);
    }

    .badges-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .badge {
      width: 44px;
      height: 44px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      opacity: 0.3;
      position: relative;
    }

    .badge.earned {
      opacity: 1;
      background: rgba(212,175,55,0.2);
      border-color: var(--gold);
    }

    .badge-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--navy);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.6rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .badge:hover .badge-tooltip {
      opacity: 1;
    }

    .streak-display {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 0.75rem;
    }

    .streak-flame { font-size: 2rem; }

    .streak-count {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--gold);
    }

    .streak-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
    }

    .dashboard-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.6rem 0.75rem;
      background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.05));
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      color: var(--gold);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 0.5rem;
    }

    .dashboard-btn:hover {
      background: linear-gradient(135deg, rgba(212,175,55,0.25), rgba(212,175,55,0.1));
      border-color: var(--gold);
    }

    /* ====== DAILY REVIEW MODAL ====== */
    .daily-review-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 1rem;
    }

    .daily-review-modal.open {
      display: flex;
    }

    .daily-review-content {
      background: linear-gradient(135deg, var(--deep-navy), #0a0f1a);
      border: 2px solid var(--gold);
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .daily-review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(212,175,55,0.3);
    }

    .daily-review-header h2 {
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
      font-size: 1.5rem;
      margin: 0;
    }

    .daily-review-close {
      background: none;
      border: none;
      color: rgba(255,255,255,0.6);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .daily-review-close:hover {
      color: white;
    }

    .review-timer {
      text-align: center;
      margin-bottom: 1rem;
    }

    .timer-display {
      font-size: 2rem;
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
    }

    .timer-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    .review-progress {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      transition: all 0.3s;
    }

    .progress-dot.current {
      background: var(--gold);
      transform: scale(1.2);
    }

    .progress-dot.completed {
      background: #22c55e;
    }

    .review-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(212,175,55,0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .review-principle-num {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(212,175,55,0.2);
      border-radius: 50%;
      color: var(--gold);
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .review-principle-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.25rem;
      color: var(--cream);
      font-style: italic;
      margin-bottom: 1rem;
    }

    .review-question {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
    }

    .review-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .review-option {
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      font-size: 0.85rem;
    }

    .review-option:hover {
      background: rgba(212,175,55,0.15);
      border-color: var(--gold);
    }

    .review-option.correct {
      background: rgba(34,197,94,0.2);
      border-color: #22c55e;
    }

    .review-option.incorrect {
      background: rgba(239,68,68,0.2);
      border-color: #ef4444;
    }

    .review-option.selected {
      border-width: 2px;
    }

    .review-feedback {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .review-feedback.correct {
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.3);
      color: #86efac;
    }

    .review-feedback.incorrect {
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.3);
      color: #fca5a5;
    }

    .review-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      margin-top: 1rem;
    }

    .review-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .review-btn.skip {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: rgba(255,255,255,0.6);
    }

    .review-btn.skip:hover {
      border-color: rgba(255,255,255,0.5);
      color: white;
    }

    .review-btn.next {
      background: var(--gold);
      border: none;
      color: var(--navy);
      font-weight: 600;
    }

    .review-btn.next:hover {
      background: #e6c94a;
    }

    .review-summary {
      text-align: center;
    }

    .summary-score {
      font-size: 3rem;
      font-family: 'Cormorant Garamond', serif;
      color: var(--gold);
    }

    .summary-text {
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
    }

    .summary-breakdown {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin: 1rem 0;
    }

    .summary-stat {
      text-align: center;
    }

    .summary-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .summary-stat-value.correct-val { color: #22c55e; }
    .summary-stat-value.incorrect-val { color: #ef4444; }

    .summary-stat-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    .review-streak-bonus {
      margin-top: 1rem;
      padding: 0.75rem;
      background: rgba(212,175,55,0.15);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .review-streak-bonus .flame { font-size: 1.5rem; }
    .review-streak-bonus .text { color: var(--gold); font-size: 0.9rem; }

    .daily-review-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.5rem 0.75rem;
      background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.05));
      border: 1px solid rgba(34,197,94,0.3);
      border-radius: 6px;
      color: #86efac;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 0.75rem;
    }

    .daily-review-btn:hover {
      background: linear-gradient(135deg, rgba(34,197,94,0.25), rgba(34,197,94,0.1));
      border-color: #22c55e;
    }

    .daily-review-btn.pending {
      animation: gentlePulse 2s infinite;
    }

    @keyframes gentlePulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(34,197,94,0.3); }
      50% { box-shadow: 0 0 0 6px rgba(34,197,94,0); }
    }

    /* ====== BRANCHING SCENARIOS ====== */
    .scenario-panel {
      background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(30,39,97,0.2));
      border: 2px solid rgba(124,58,237,0.4);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .scenario-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .scenario-icon { font-size: 1.5rem; }
    .scenario-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      color: #7C3AED;
      font-weight: 600;
    }

    .scenario-situation {
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--navy);
    }

    .scenario-question {
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--navy);
    }

    .scenario-choices {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .scenario-choice {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.8);
      border: 2px solid rgba(124,58,237,0.2);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .scenario-choice:hover:not(.answered) { background: rgba(124,58,237,0.1); border-color: rgba(124,58,237,0.5); }
    .scenario-choice.selected { border-color: #7C3AED; background: rgba(124,58,237,0.15); }
    .scenario-choice.correct { border-color: #22c55e; background: rgba(34,197,94,0.15); }
    .scenario-choice.incorrect { border-color: #ef4444; background: rgba(239,68,68,0.1); }

    .choice-letter {
      min-width: 24px; height: 24px; border-radius: 50%;
      background: rgba(124,58,237,0.2); color: #7C3AED;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 0.8rem;
    }
    .scenario-choice.correct .choice-letter { background: #22c55e; color: white; }
    .scenario-choice.incorrect .choice-letter { background: #ef4444; color: white; }
    .choice-text { flex: 1; font-size: 0.9rem; color: var(--navy); }

    .scenario-consequence {
      margin-top: 1rem; padding: 1rem; border-radius: 10px; display: none;
    }
    .scenario-consequence.visible { display: block; }
    .scenario-consequence.good { background: rgba(34,197,94,0.15); border: 1px solid rgba(34,197,94,0.3); }
    .scenario-consequence.bad { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); }
    .scenario-consequence.neutral { background: rgba(217,119,6,0.1); border: 1px solid rgba(217,119,6,0.3); }

    .consequence-title { font-weight: 700; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
    .scenario-consequence.good .consequence-title { color: #059669; }
    .scenario-consequence.bad .consequence-title { color: #dc2626; }
    .scenario-consequence.neutral .consequence-title { color: #d97706; }
    .consequence-text { font-size: 0.9rem; line-height: 1.5; }
    .consequence-lesson { margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed currentColor; font-style: italic; opacity: 0.9; }

    /* ====== CONFIDENCE CALIBRATION ====== */
    .confidence-section {
      margin-top: 1rem; padding: 0.75rem;
      background: rgba(212,175,55,0.1); border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);
    }
    .confidence-label { font-size: 0.8rem; color: var(--gold); margin-bottom: 0.5rem; }
    .confidence-slider-container { display: flex; align-items: center; gap: 0.75rem; }
    .confidence-slider {
      flex: 1; -webkit-appearance: none; height: 6px; border-radius: 3px;
      background: linear-gradient(to right, #ef4444, #eab308, #22c55e); outline: none;
    }
    .confidence-slider::-webkit-slider-thumb {
      -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: white; border: 2px solid var(--gold); cursor: pointer;
    }
    .confidence-value { min-width: 45px; font-size: 0.85rem; font-weight: 700; color: var(--gold); }
    .confidence-labels { display: flex; justify-content: space-between; font-size: 0.65rem; color: rgba(255,255,255,0.6); margin-top: 0.25rem; }

    /* ====== ANALOGY SYSTEM ====== */
    .analogy-card {
      background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(30,39,97,0.1));
      border: 1px solid rgba(212,175,55,0.4);
      border-radius: 12px;
      padding: 1rem;
      margin: 1rem 0;
    }
    .analogy-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
    .analogy-icon { font-size: 1.25rem; }
    .analogy-title { font-weight: 600; color: var(--gold); font-size: 0.9rem; }
    .analogy-concept { font-size: 0.75rem; color: rgba(255,255,255,0.6); }
    .analogy-text { font-size: 0.9rem; line-height: 1.5; font-style: italic; }

    /* ====== MISCONCEPTION CHALLENGE ====== */
    .misconception-challenge {
      background: linear-gradient(135deg, rgba(239,68,68,0.08), rgba(30,39,97,0.12));
      border: 2px solid rgba(239,68,68,0.25);
      border-radius: 12px;
      padding: 1.25rem;
      margin: 1rem 0;
    }
    .misconception-header { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: #dc2626; margin-bottom: 0.75rem; }
    .misconception-statement {
      font-size: 1rem; font-style: italic; color: var(--navy);
      margin-bottom: 1rem; padding: 0.75rem; background: rgba(255,255,255,0.85); border-radius: 8px;
    }
    .misconception-buttons { display: flex; gap: 0.75rem; justify-content: center; }
    .misconception-btn {
      padding: 0.6rem 1.5rem; border-radius: 8px; font-weight: 600;
      cursor: pointer; transition: all 0.2s; border: 2px solid;
    }
    .misconception-btn.true-btn { background: rgba(34,197,94,0.1); border-color: #22c55e; color: #059669; }
    .misconception-btn.false-btn { background: rgba(239,68,68,0.1); border-color: #ef4444; color: #dc2626; }
    .misconception-btn:hover { transform: scale(1.05); }
    .misconception-btn.correct { background: #22c55e; color: white; border-color: #22c55e; }
    .misconception-btn.wrong { background: #ef4444; color: white; border-color: #ef4444; }
    .misconception-result { margin-top: 1rem; padding: 0.75rem; border-radius: 8px; display: none; }
    .misconception-result.visible { display: block; }
    .misconception-result.correct { background: rgba(34,197,94,0.15); color: #059669; }
    .misconception-result.incorrect { background: rgba(239,68,68,0.1); color: #dc2626; }

    /* ====== PRACTICE PROBLEMS ====== */
    .practice-problem {
      background: linear-gradient(135deg, rgba(15,91,106,0.08), rgba(30,39,97,0.12));
      border: 2px solid rgba(15,91,106,0.3);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .practice-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .practice-category {
      background: rgba(15,91,106,0.2);
      color: #0f5b6a;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .practice-title {
      font-weight: 700;
      color: var(--navy);
      font-size: 1.1rem;
    }
    .practice-scenario {
      background: rgba(255,255,255,0.9);
      padding: 1rem;
      border-radius: 10px;
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--text);
      margin-bottom: 1rem;
    }
    .practice-question {
      color: var(--navy);
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    .practice-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .practice-option {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.95);
      border: 2px solid rgba(30,39,97,0.15);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      font-family: inherit;
      font-size: 0.9rem;
    }
    .practice-option:hover:not(:disabled) {
      border-color: var(--navy);
      transform: translateX(4px);
    }
    .practice-option .option-letter {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--navy);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.8rem;
      flex-shrink: 0;
    }
    .practice-option.correct {
      border-color: #22c55e;
      background: rgba(34,197,94,0.1);
    }
    .practice-option.correct .option-letter {
      background: #22c55e;
    }
    .practice-option.incorrect {
      border-color: #ef4444;
      background: rgba(239,68,68,0.08);
    }
    .practice-option.incorrect .option-letter {
      background: #ef4444;
    }
    .practice-option:disabled {
      cursor: default;
      opacity: 0.8;
    }
    .practice-feedback {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 10px;
      display: none;
      line-height: 1.6;
    }
    .practice-feedback.visible {
      display: block;
    }
    .practice-feedback.correct {
      background: rgba(34,197,94,0.12);
      border: 1px solid rgba(34,197,94,0.3);
      color: #047857;
    }
    .practice-feedback.incorrect {
      background: rgba(239,68,68,0.08);
      border: 1px solid rgba(239,68,68,0.2);
      color: #b91c1c;
    }
    .practice-feedback p {
      margin: 0.5rem 0;
    }
    .practice-feedback .principle-link {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(0,0,0,0.1);
      font-size: 0.85rem;
      color: var(--navy);
    }

    .story-insight strong {
      color: var(--gold);
    }

    .no-story-data {
      text-align: center;
      padding: 2rem 1rem;
      color: rgba(255,255,255,0.5);
      font-size: 0.8rem;
    }

    @keyframes pulseGold {
      0%, 100% { box-shadow: 0 0 0 0 rgba(212,175,55,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(212,175,55,0); }
    }

    .story-data-panel.updating {
      animation: pulseGold 0.5s ease;
    }

    .tool-section {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .tool-section-header {
      padding: 0.75rem 1rem;
      background: #f7fafc;
      border-bottom: 1px solid #e2e8f0;
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--navy);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tool-section-body {
      padding: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(212,175,55,0.2);
    }

    .btn-small {
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #e2e8f0;
      background: white;
      color: var(--text);
    }

    .btn-small.primary {
      background: var(--navy);
      color: white;
      border-color: var(--navy);
    }

    /* Study input table */
    .study-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .study-table th,
    .study-table td {
      padding: 0.4rem;
      border: 1px solid #e2e8f0;
      text-align: center;
    }

    .study-table th {
      background: #f7fafc;
      font-weight: 600;
    }

    .study-table input {
      width: 100%;
      padding: 0.25rem;
      border: 1px solid #e2e8f0;
      border-radius: 2px;
      font-size: 0.75rem;
      text-align: center;
    }

    /* Results display */
    .results-display {
      background: #f7fafc;
      border-radius: 6px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      padding: 0.4rem 0;
      font-size: 0.8rem;
      border-bottom: 1px solid #e2e8f0;
    }

    .result-row:last-child { border-bottom: none; }
    .result-row .label { color: var(--light-text); }
    .result-row .value { font-weight: 600; color: var(--navy); }

    /* Forest plot container */
    .forest-plot-container {
      margin-top: 1rem;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 1rem;
      overflow-x: auto;
    }

    /* Hide tools panel on small screens */
    @media (max-width: 1200px) {
      .tools-panel { display: none; }
      .sidebar { width: 60px; }
      .sidebar .module-info,
      .sidebar .sidebar-header p,
      .sidebar .sidebar-footer { display: none; }
      .sidebar .sidebar-header h1 { font-size: 1rem; }
    }

    /* Leap badge */
    .leap-badge {
      background: var(--red);
      color: white;
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      font-weight: 700;
      position: absolute;
      right: -10px;
      top: 50%;
      transform: translateY(-50%);
    }

    .card-wrapper {
      position: relative;
      max-width: 800px;
      width: 100%;
    }

    /* Wrong items */
    .wrong-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      background: var(--light-cream);
      padding: 1rem;
      margin: 0.5rem 0;
      max-width: 800px;
      width: 100%;
    }

    .wrong-number {
      background: var(--navy);
      color: var(--cream);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    /* Quiz styles */
    .quiz-container {
      max-width: 700px;
      width: 100%;
    }

    .quiz-question {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
    }

    .quiz-question h4 {
      font-size: 1rem;
      color: var(--navy);
      margin-bottom: 1rem;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .quiz-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      /* Accessibility: make focusable for keyboard nav */
      padding: 0.75rem 1rem;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quiz-option:hover {
      background: #f7fafc;
      border-color: var(--gold);
    }

    .quiz-option.selected {
      background: rgba(212,175,55,0.1);
      border-color: var(--gold);
    }

    .quiz-option.correct {
      background: rgba(34,197,94,0.1);
      border-color: var(--green);
    }

    .quiz-option.incorrect {
      background: rgba(197,48,48,0.1);
      border-color: var(--red);
    }

    /* RoB Domain Styles */
    .rob-domains {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .rob-domain {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .rob-domain label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text);
    }

    .rob-domain select {
      padding: 0.4rem;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 0.8rem;
    }

    /* GRADE factor styles */
    .grade-factors .form-group label {
      font-size: 0.75rem;
      color: var(--text);
    }

    .grade-factors select {
      font-size: 0.75rem;
    }

    /* Red text utility */
    .result-row .value.red {
      color: var(--red);
      font-weight: 700;
    }

    /* Interactive Investigation Exercises */
    .investigation-box {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 900px;
      width: 100%;
      margin: 1rem 0;
    }

    .investigation-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      color: var(--gold);
    }

    .investigation-header .icon {
      font-size: 1.5rem;
    }

    .investigation-header h3 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0;
    }

    .investigation-prompt {
      font-style: italic;
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
      font-size: 1.05rem;
      line-height: 1.5;
    }

    .data-table-investigation {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: 0.85rem;
    }

    .data-table-investigation th,
    .data-table-investigation td {
      padding: 0.5rem 0.75rem;
      border: 1px solid rgba(212,175,55,0.3);
      text-align: center;
      color: var(--cream);
    }

    .data-table-investigation th {
      background: rgba(212,175,55,0.2);
      color: var(--gold);
      font-weight: 600;
    }

    .data-table-investigation tr:nth-child(even) {
      background: rgba(255,255,255,0.05);
    }

    .reveal-btn {
      background: var(--gold);
      color: var(--navy);
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
      transition: all 0.2s;
    }

    .reveal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(212,175,55,0.3);
    }

    .hidden-reveal {
      display: none;
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(197,48,48,0.1);
      border-left: 3px solid var(--red);
      color: var(--cream);
    }

    .hidden-reveal.visible {
      display: block;
      animation: fadeUp 0.4s ease-out;
    }

    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 1rem 0;
    }

    .comparison-panel {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .comparison-panel h4 {
      color: var(--gold);
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .comparison-panel.after {
      border-color: var(--red);
    }

    .comparison-panel.after h4 {
      color: var(--red);
    }

    /* Rhetorical question styling */
    .rhetorical {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.3rem, 3vw, 1.8rem);
      font-style: italic;
      color: rgba(255,255,255,0.9);
      text-align: center;
      max-width: 700px;
      margin: 1rem 0;
    }

    /* Direct address styling */
    .direct-address {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.2rem;
      color: var(--gold);
      border-left: 3px solid var(--gold);
      padding-left: 1rem;
      margin: 1rem 0;
      font-style: italic;
    }

    /* Mini forest plot for exercises */
    .mini-forest {
      background: white;
      border-radius: 8px;
      padding: 0.75rem;
      margin-top: 0.5rem;
    }

    /* ============================================================
       ACCESSIBILITY IMPROVEMENTS
       ============================================================ */

    /* Focus states for keyboard navigation */
    *:focus {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }

    *:focus:not(:focus-visible) {
      outline: none;
    }

    *:focus-visible {
      outline: 2px solid var(--gold);
      outline-offset: 2px;
    }

    .quiz-option:focus-visible,
    .btn:focus-visible,
    .module-item:focus-visible,
    .nav-btn:focus-visible {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }

    /* Skip to content link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--gold);
      color: var(--navy);
      padding: 8px 16px;
      z-index: 1000;
      font-weight: 600;
      text-decoration: none;
      border-radius: 0 0 4px 0;
    }

    .skip-link:focus {
      top: 0;
    }

    /* Screen reader only text */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Improved color contrast for accessibility */
    .light-text-accessible {
      color: #a0aec0; /* Lighter for better contrast on dark */
    }

    /* ============================================================
       MOBILE RESPONSIVE (< 768px)
       ============================================================ */

    .mobile-menu-btn {
      display: none;
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1001;
      background: var(--gold);
      color: var(--navy);
      border: none;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      font-size: 1.2rem;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: block;
      }

      .sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        height: 100vh;
        z-index: 1000;
        transition: left 0.3s ease;
      }

      .sidebar.open {
        left: 0;
      }

      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
      }

      .sidebar-overlay.open {
        display: block;
      }

      .content-header {
        padding-left: 4rem;
      }

      .tools-panel {
        width: 100%;
        right: -100%;
      }

      .tools-panel.open {
        right: 0;
      }

      .slide .content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
    }

    /* ============================================================
       GLOSSARY PANEL
       ============================================================ */

    .glossary-btn {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      background: var(--navy);
      color: var(--gold);
      border: 2px solid var(--gold);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .glossary-btn:hover {
      background: var(--gold);
      color: var(--navy);
    }

    /* Story Data Indicator Button */
    .story-indicator-btn {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background: linear-gradient(135deg, #1E2761 0%, #141B3D 100%);
      color: var(--gold);
      border: 2px solid var(--gold);
      border-radius: 25px;
      padding: 0.5rem 1rem;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      z-index: 100;
      display: none;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .story-indicator-btn.visible {
      display: flex;
    }

    .story-indicator-btn:hover {
      background: var(--gold);
      color: var(--navy);
      transform: translateY(-2px);
    }

    .story-indicator-btn.pulse {
      animation: pulseBtn 2s infinite;
    }

    @keyframes pulseBtn {
      0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 0 0 rgba(212,175,55,0.4); }
      50% { box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 0 8px rgba(212,175,55,0); }
    }

    .story-indicator-dot {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .glossary-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 0;
      background: var(--deep-navy);
      border-top: 2px solid var(--gold);
      z-index: 999;
      overflow: hidden;
      transition: height 0.3s ease;
    }

    .glossary-panel.open {
      height: 50vh;
    }

    .glossary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .glossary-header h3 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
    }

    .glossary-close {
      background: none;
      border: none;
      color: var(--cream);
      font-size: 1.5rem;
      cursor: pointer;
    }

    .glossary-search {
      padding: 0.75rem 1.5rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }

    .glossary-search input {
      width: 100%;
      padding: 0.5rem 1rem;
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 6px;
      background: rgba(255,255,255,0.05);
      color: var(--cream);
      font-size: 0.9rem;
    }

    .glossary-content {
      padding: 1rem 1.5rem;
      overflow-y: auto;
      height: calc(50vh - 120px);
    }

    .glossary-term {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .glossary-term dt {
      color: var(--gold);
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
    }

    .glossary-term dd {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* ============================================================
       KEYBOARD SHORTCUTS HELP
       ============================================================ */

    .keyboard-help {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--deep-navy);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 2rem;
      z-index: 1001;
      display: none;
      min-width: 300px;
      max-width: 90vw;
    }

    .keyboard-help.open {
      display: block;
    }

    .keyboard-help h3 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      margin-bottom: 1rem;
      text-align: center;
    }

    .keyboard-help-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .keyboard-help-key {
      background: rgba(255,255,255,0.1);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.85rem;
    }

    /* ============================================================
       LEARNING OBJECTIVES BOX
       ============================================================ */

    .learning-objectives {
      background: rgba(212,175,55,0.1);
      border: 1px solid var(--gold);
      border-radius: 8px;
      padding: 1rem 1.5rem;
      margin: 1rem 0;
      max-width: 700px;
    }

    .learning-objectives h4 {
      color: var(--gold);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .learning-objectives ul {
      margin: 0;
      padding-left: 1.25rem;
    }

    .learning-objectives li {
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    /* ============================================================
       DECISION TREE STORIES (Quranic Storytelling)
       ============================================================ */

    .story-box {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid var(--gold);
      border-radius: 16px;
      padding: 2rem;
      max-width: 900px;
      width: 100%;
      margin: 1rem 0;
    }

    .story-opener {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.4rem, 3vw, 2rem);
      font-style: italic;
      color: var(--gold);
      text-align: center;
      margin-bottom: 1.5rem;
      line-height: 1.4;
    }

    .story-opener::before {
      content: '"';
      font-size: 1.5em;
      opacity: 0.5;
    }

    .story-opener::after {
      content: '"';
      font-size: 1.5em;
      opacity: 0.5;
    }

    .real-data-box {
      background: rgba(255,255,255,0.05);
      border-left: 4px solid #3b82f6;
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      border-radius: 0 8px 8px 0;
    }

    .real-data-box h4 {
      color: #60a5fa;
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .real-data-box h4::before {
      content: '';
    }

    .real-data-box p {
      color: var(--cream);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .real-data-box .data-highlight {
      color: var(--gold);
      font-weight: 700;
    }

    .decision-tree {
      background: rgba(212,175,55,0.1);
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .decision-tree-header {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.2rem;
      color: var(--gold);
      margin-bottom: 1rem;
      text-align: center;
      font-weight: 600;
    }

    .decision-scenario {
      background: rgba(0,0,0,0.3);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-style: italic;
      color: rgba(255,255,255,0.9);
      text-align: center;
    }

    .decision-paths {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    @media (max-width: 768px) {
      .decision-paths {
        grid-template-columns: 1fr;
      }
    }

    .decision-path {
      padding: 1.25rem;
      border-radius: 8px;
      position: relative;
    }

    .decision-path.path-a {
      background: rgba(197, 48, 48, 0.15);
      border: 2px solid rgba(197, 48, 48, 0.5);
    }

    .decision-path.path-b {
      background: rgba(34, 197, 94, 0.15);
      border: 2px solid rgba(34, 197, 94, 0.5);
    }

    .path-label {
      font-weight: 700;
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .decision-path.path-a .path-label {
      color: #f87171;
    }

    .decision-path.path-b .path-label {
      color: #4ade80;
    }

    .path-choice {
      font-size: 0.95rem;
      color: var(--cream);
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .path-arrow {
      color: rgba(255,255,255,0.5);
      text-align: center;
      margin: 0.5rem 0;
      font-size: 1.2rem;
    }

    .path-consequence {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      line-height: 1.5;
    }

    .path-outcome {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255,255,255,0.2);
      font-weight: 700;
    }

    .decision-path.path-a .path-outcome {
      color: #f87171;
    }

    .decision-path.path-b .path-outcome {
      color: #4ade80;
    }

    .decision-path:focus {
      outline: 3px solid var(--gold);
      outline-offset: 2px;
    }

    .story-revelation {
      background: linear-gradient(135deg, rgba(212,175,55,0.3), rgba(212,175,55,0.1));
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 1.5rem;
      text-align: center;
    }

    .revelation-label {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.15em;
      margin-bottom: 0.75rem;
    }

    .revelation-text {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(1.1rem, 2.5vw, 1.4rem);
      color: var(--cream);
      line-height: 1.5;
      font-weight: 600;
    }

    .story-timeline {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }

    .timeline-point {
      background: rgba(255,255,255,0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      color: rgba(255,255,255,0.8);
    }

    .timeline-point.critical {
      background: rgba(197, 48, 48, 0.3);
      border: 1px solid rgba(197, 48, 48, 0.5);
      color: #fca5a5;
    }

    .timeline-point.resolution {
      background: rgba(34, 197, 94, 0.3);
      border: 1px solid rgba(34, 197, 94, 0.5);
      color: #86efac;
    }

    /* ============================================================
       REDUCED MOTION (Accessibility)
       ============================================================ */

    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }

      .animate {
        animation: none !important;
        opacity: 1 !important;
      }

      .slide {
        transition: none !important;
      }
    }

    /* ============================================================
       PRINT STYLESHEET
       ============================================================ */

    @media print {
      .sidebar,
      .content-header,
      .slide-nav,
      .tools-panel,
      .glossary-btn,
      .glossary-panel,
      .mobile-menu-btn,
      .keyboard-help,
      .btn,
      .nav-btn,
      .reveal-btn {
        display: none !important;
      }

      .course-container {
        display: block;
        height: auto;
      }

      .main-content {
        display: block;
      }

      .content-body {
        display: block;
      }

      .slides-container {
        display: block;
        height: auto;
        overflow: visible;
      }

      .module-slides {
        display: block !important;
      }

      .slide {
        display: block !important;
        page-break-inside: avoid;
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #ccc;
      }

      .slide.dark,
      .slide.black {
        background: white !important;
        color: black !important;
      }

      .slide.dark *,
      .slide.black * {
        color: black !important;
      }

      .refrain,
      .title {
        color: #1E2761 !important;
      }

      .gold-line {
        background: #D4AF37 !important;
      }

      body {
        background: white;
        color: black;
      }
    }

    /* ============================================================
       TIER SYSTEM  Clinician | Researcher | Methodologist
       ============================================================ */
    .tier-selector {
      display: flex;
      gap: 2px;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(212,175,55,0.2);
    }
    .tier-btn {
      flex: 1;
      padding: 0.4rem 0.25rem;
      font-size: 0.65rem;
      font-weight: 600;
      text-align: center;
      border: 1px solid rgba(212,175,55,0.3);
      background: transparent;
      color: rgba(255,255,255,0.6);
      cursor: pointer;
      transition: all 0.2s;
      border-radius: 4px;
    }
    .tier-btn:hover { background: rgba(212,175,55,0.1); color: var(--cream); }
    .tier-btn.active {
      background: var(--gold);
      color: var(--navy);
      border-color: var(--gold);
    }
    .tier-btn .tier-icon { display: block; font-size: 1rem; margin-bottom: 2px; }

    /* Tier visibility: slides tagged data-tier="methods" or "mastery" */
    [data-tier="methods"],
    [data-tier="mastery"] {
      display: none;
    }
    body.tier-researcher [data-tier="methods"] { display: flex; }
    body.tier-methodologist [data-tier="methods"],
    body.tier-methodologist [data-tier="mastery"] { display: flex; }
    /* Foundation slides always visible  no data-tier attr needed */

    /* Tier badge shown on slides */
    .tier-badge {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      font-size: 0.65rem;
      font-weight: 700;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      z-index: 2;
    }
    .tier-badge.methods {
      background: rgba(59,130,246,0.2);
      color: #60a5fa;
      border: 1px solid rgba(59,130,246,0.3);
    }
    .tier-badge.mastery {
      background: rgba(168,85,247,0.2);
      color: #c084fc;
      border: 1px solid rgba(168,85,247,0.3);
    }
    .slide.light .tier-badge.methods {
      background: rgba(59,130,246,0.1);
      color: #2563eb;
      border-color: rgba(59,130,246,0.3);
    }
    .slide.light .tier-badge.mastery {
      background: rgba(168,85,247,0.1);
      color: #7c3aed;
      border-color: rgba(168,85,247,0.3);
    }
  </style>
</head>
<body>
  <!-- Skip to content link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to content</a>

  <!-- Mobile menu button -->
  <button class="mobile-menu-btn" onclick="toggleSidebar()" aria-label="Toggle navigation menu" aria-expanded="false"></button>

  <!-- Mobile sidebar overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

  <!-- Glossary button -->
  <!-- Story Data Indicator -->
  <button class="story-indicator-btn pulse" id="storyIndicatorBtn" onclick="openToolsWithStory()" aria-label="View story data">
    <span class="story-indicator-dot"></span>
    <span> Live Data Available</span>
  </button>

  <button class="glossary-btn" onclick="toggleGlossary()" aria-label="Open glossary" title="Glossary (press G)"></button>

  <!-- Glossary Panel -->
  <div class="glossary-panel" id="glossaryPanel" role="dialog" aria-label="Glossary">
    <div class="glossary-header">
      <h3>Glossary of Terms</h3>
      <button class="glossary-close" onclick="toggleGlossary()" aria-label="Close glossary">&times;</button>
    </div>
    <div class="glossary-search">
      <input type="text" id="glossarySearch" placeholder="Search terms..." onkeyup="filterGlossary()" aria-label="Search glossary">
    </div>
    <div class="glossary-content" id="glossaryContent">
      <dl>
        <div class="glossary-term" data-term="meta-analysis">
          <dt>Meta-Analysis</dt>
          <dd>A statistical method for combining results from multiple independent studies addressing the same question to produce a pooled estimate.</dd>
        </div>
        <div class="glossary-term" data-term="systematic review">
          <dt>Systematic Review</dt>
          <dd>A comprehensive, reproducible literature review that uses explicit methods to identify, select, appraise, and synthesize all relevant studies on a specific question.</dd>
        </div>
        <div class="glossary-term" data-term="pico">
          <dt>PICO</dt>
          <dd>Framework for formulating clinical questions: Population, Intervention, Comparator, Outcome.</dd>
        </div>
        <div class="glossary-term" data-term="heterogeneity">
          <dt>Heterogeneity</dt>
          <dd>Variability in study results beyond what would be expected by chance. Measured by I, , and Q statistics.</dd>
        </div>
        <div class="glossary-term" data-term="i-squared">
          <dt>I (I-squared)</dt>
          <dd>The percentage of variability in effect estimates that is due to heterogeneity rather than sampling error. Threshold bands (e.g., 25/50/75%) are rough heuristics, not hard rules; interpretation depends on effect metric, precision, and number of studies.</dd>
        </div>
        <div class="glossary-term" data-term="tau-squared">
          <dt> (Tau-squared)</dt>
          <dd>The between-study variance in a random-effects model. Measures the absolute magnitude of heterogeneity on the effect size scale.</dd>
        </div>
        <div class="glossary-term" data-term="fixed effect">
          <dt>Fixed Effect Model</dt>
          <dd>Assumes all studies estimate the same true effect. Weights studies by inverse variance (precision). Large studies dominate.</dd>
        </div>
        <div class="glossary-term" data-term="random effects">
          <dt>Random Effects Model</dt>
          <dd>Assumes studies estimate different but related effects from a distribution. Incorporates between-study variance () into weights.</dd>
        </div>
        <div class="glossary-term" data-term="forest plot">
          <dt>Forest Plot</dt>
          <dd>A graphical display of effect sizes from individual studies and the pooled estimate, with confidence intervals.</dd>
        </div>
        <div class="glossary-term" data-term="funnel plot">
          <dt>Funnel Plot</dt>
          <dd>A scatter plot of effect size vs. standard error. Asymmetry may indicate publication bias or small-study effects.</dd>
        </div>
        <div class="glossary-term" data-term="publication bias">
          <dt>Publication Bias</dt>
          <dd>The tendency for studies with positive/significant results to be published more than null/negative studies.</dd>
        </div>
        <div class="glossary-term" data-term="egger test">
          <dt>Egger's Test</dt>
          <dd>A regression test for funnel plot asymmetry (small-study effects). Usually requires about 10 or more studies to be informative. A low p-value suggests asymmetry, not publication bias alone.</dd>
        </div>
        <div class="glossary-term" data-term="trim and fill">
          <dt>Trim-and-Fill</dt>
          <dd>An exploratory sensitivity method that imputes potentially missing studies under strong assumptions. It can illustrate the impact of asymmetry but does not prove or fully correct publication bias.</dd>
        </div>
        <div class="glossary-term" data-term="risk of bias">
          <dt>Risk of Bias (RoB)</dt>
          <dd>Assessment of systematic errors in study design, conduct, or reporting that may affect results. RoB 2.0 is the Cochrane tool for RCTs.</dd>
        </div>
        <div class="glossary-term" data-term="robins-i">
          <dt>ROBINS-I</dt>
          <dd>Risk Of Bias In Non-randomized Studies of Interventions. Cochrane tool for assessing bias in observational studies.</dd>
        </div>
        <div class="glossary-term" data-term="grade">
          <dt>GRADE</dt>
          <dd>Grading of Recommendations, Assessment, Development and Evaluations. Framework for rating certainty of evidence (High, Moderate, Low, Very Low).</dd>
        </div>
        <div class="glossary-term" data-term="prediction interval">
          <dt>Prediction Interval</dt>
          <dd>The range of effects expected in a new study, accounting for between-study heterogeneity. Wider than confidence interval.</dd>
        </div>
        <!-- NNT defined in new glossary section below with fuller definition -->
        <div class="glossary-term" data-term="nnh">
          <dt>NNH (Number Needed to Harm)</dt>
          <dd>The number of patients who need to be treated for one additional patient to experience harm. NNH = 1/ARI.</dd>
        </div>
        <div class="glossary-term" data-term="hksj">
          <dt>HKSJ Adjustment</dt>
          <dd>Hartung-Knapp-Sidik-Jonkman adjustment. Uses t-distribution for confidence intervals in random-effects models, providing better coverage with few studies.</dd>
        </div>
        <div class="glossary-term" data-term="prospero">
          <dt>PROSPERO</dt>
          <dd>International prospective register of systematic reviews. Pre-registration prevents post-hoc methodological changes.</dd>
        </div>
        <div class="glossary-term" data-term="prisma">
          <dt>PRISMA</dt>
          <dd>Preferred Reporting Items for Systematic Reviews and Meta-Analyses. Reporting guideline with flow diagram and checklist.</dd>
        </div>
        <div class="glossary-term" data-term="nma">
          <dt>Network Meta-Analysis (NMA)</dt>
          <dd>Method to compare multiple treatments simultaneously using direct and indirect evidence through common comparators.</dd>
        </div>
        <div class="glossary-term" data-term="sucra">
          <dt>SUCRA</dt>
          <dd>Surface Under the Cumulative Ranking curve. Summarizes ranking probabilities in NMA (0% to 100%), but does not by itself show effect magnitude, certainty, or clinical relevance.</dd>
        </div>
        <div class="glossary-term" data-term="ipd">
          <dt>IPD Meta-Analysis</dt>
          <dd>Individual Patient Data meta-analysis. Uses raw patient-level data from trials rather than published summaries. Gold standard for subgroup analysis.</dd>
        </div>
        <div class="glossary-term" data-term="dta">
          <dt>DTA Meta-Analysis</dt>
          <dd>Diagnostic Test Accuracy meta-analysis. Synthesizes sensitivity and specificity using bivariate models.</dd>
        </div>
        <div class="glossary-term" data-term="sroc">
          <dt>SROC Curve</dt>
          <dd>Summary Receiver Operating Characteristic curve. Used in DTA meta-analysis to display pooled sensitivity/specificity.</dd>
        </div>
        <div class="glossary-term" data-term="iceman">
          <dt>ICEMAN</dt>
          <dd>Instrument for assessing Credibility of Effect Modification Analyses. Evaluates subgroup analysis credibility.</dd>
        </div>
        <div class="glossary-term" data-term="tsa">
          <dt>Trial Sequential Analysis (TSA)</dt>
          <dd>Method applying stopping boundaries to cumulative meta-analysis to determine when sufficient evidence has accumulated.</dd>
        </div>
        <div class="glossary-term" data-term="living review">
          <dt>Living Systematic Review</dt>
          <dd>A review that is continually updated as new evidence emerges, rather than being a fixed point-in-time publication.</dd>
        </div>
        <!-- Advanced module glossary terms -->
        <div class="glossary-term" data-term="bayesian"><dt>Bayesian Meta-Analysis</dt>
          <dd>Meta-analysis using Bayes' theorem: combines prior beliefs with data (likelihood) to produce posterior distributions for effect parameters.</dd></div>
        <div class="glossary-term" data-term="prior"><dt>Prior Distribution</dt>
          <dd>The probability distribution representing beliefs about a parameter before seeing the data. Can be vague, weakly informative, or informative.</dd></div>
        <div class="glossary-term" data-term="posterior"><dt>Posterior Distribution</dt>
          <dd>The updated probability distribution after combining the prior with the data likelihood. Basis for all Bayesian inference.</dd></div>
        <div class="glossary-term" data-term="credible interval"><dt>Credible Interval</dt>
          <dd>Bayesian analogue of a confidence interval. A 95% CrI can be read probabilistically as the parameter lying in that interval, conditional on the model and prior being appropriate.</dd></div>
        <div class="glossary-term" data-term="mcmc"><dt>MCMC (Markov Chain Monte Carlo)</dt>
          <dd>Computational method for drawing samples from posterior distributions when analytical solutions are unavailable. Tools: JAGS, Stan, PyMC.</dd></div>
        <div class="glossary-term" data-term="bayes factor"><dt>Bayes Factor</dt>
          <dd>Ratio of marginal likelihoods comparing two hypotheses. Common interpretation bands (e.g., BF10 &gt; 10) are conventions and can be prior-sensitive; report context and sensitivity analyses.</dd></div>
        <div class="glossary-term" data-term="transitivity"><dt>Transitivity</dt>
          <dd>Core NMA assumption: indirect comparisons are valid when effect modifiers are similarly distributed across comparisons in the network.</dd></div>
        <div class="glossary-term" data-term="consistency"><dt>Consistency (NMA)</dt>
          <dd>Agreement between direct and indirect evidence. Tested via node-splitting (local) or design-by-treatment interaction (global).</dd></div>
        <div class="glossary-term" data-term="p-score"><dt>P-score</dt>
          <dd>Frequentist analogue of SUCRA in NMA. Summarizes relative ranking performance, but should not be interpreted alone without absolute effects, uncertainty, and certainty of evidence.</dd></div>
        <div class="glossary-term" data-term="component nma"><dt>Component NMA</dt>
          <dd>Decomposes multi-component interventions to estimate individual component effects. Uses additive models.</dd></div>
        <div class="glossary-term" data-term="ecological bias"><dt>Ecological Bias</dt>
          <dd>Occurs when study-level associations differ from patient-level associations. Only IPD can separate within-study from between-study effects.</dd></div>
        <div class="glossary-term" data-term="one-stage"><dt>One-Stage IPD Model</dt>
          <dd>Single mixed-effects model fitted to all patient data simultaneously. More powerful for interactions and rare events than two-stage.</dd></div>
        <div class="glossary-term" data-term="two-stage"><dt>Two-Stage IPD Model</dt>
          <dd>Analyze each study separately, then combine estimates. Simpler but potentially loses information compared to one-stage.</dd></div>
        <div class="glossary-term" data-term="dose-response"><dt>Dose-Response Meta-Analysis</dt>
          <dd>Models the relationship between exposure dose and outcome across studies. Uses linear, polynomial, or spline regression.</dd></div>
        <div class="glossary-term" data-term="restricted cubic spline"><dt>Restricted Cubic Splines (RCS)</dt>
          <dd>Piecewise polynomial curves with knots at pre-specified dose points. Linear beyond boundary knots. Used for flexible dose-response modelling.</dd></div>
        <div class="glossary-term" data-term="fragility index"><dt>Fragility Index</dt>
          <dd>The minimum number of patient outcome changes needed to flip a statistically significant result to non-significant. Lower = more fragile.</dd></div>
        <div class="glossary-term" data-term="gosh"><dt>GOSH Plot</dt>
          <dd>Graphical Overview of Study Heterogeneity. Plots pooled effect vs I&sup2; for all possible study subsets to reveal influential studies and clusters.</dd></div>
        <div class="glossary-term" data-term="contour funnel"><dt>Contour-Enhanced Funnel Plot</dt>
          <dd>Funnel plot with shaded significance contours (p&lt;0.01, 0.05, 0.10). Helps distinguish publication bias from other causes of asymmetry.</dd></div>
        <div class="glossary-term" data-term="copas"><dt>Copas Selection Model</dt>
          <dd>Models the probability of study publication as a function of SE and effect size. Jointly estimates true effect and selection mechanism.</dd></div>
        <div class="glossary-term" data-term="pet-peese"><dt>PET-PEESE</dt>
          <dd>Precision-Effect Test / Precision-Effect Estimate with Standard Error. Regression-based test for small-study effects and publication bias.</dd></div>
        <div class="glossary-term" data-term="progress-plus"><dt>PROGRESS-Plus</dt>
          <dd>Framework for assessing equity: Place, Race, Occupation, Gender, Religion, Education, SES, Social capital, plus age, disability, orientation.</dd></div>
        <div class="glossary-term" data-term="prisma-equity"><dt>PRISMA-Equity</dt>
          <dd>Extension of PRISMA for equity-focused systematic reviews. Requires reporting on disadvantaged populations and applicability.</dd></div>
        <div class="glossary-term" data-term="transportability"><dt>Transportability</dt>
          <dd>Extent to which trial findings apply to a target population different from the trial sample. Methods exist to re-weight trial data.</dd></div>
        <div class="glossary-term" data-term="active learning"><dt>Active Learning (Screening)</dt>
          <dd>ML approach that iteratively selects the most informative citations for human review, learning from each decision to improve ranking.</dd></div>
        <div class="glossary-term" data-term="wss"><dt>WSS@95%</dt>
          <dd>Work Saved over Sampling at 95% recall. Measures screening automation efficiency: what percentage of citations can be safely skipped.</dd></div>
        <div class="glossary-term" data-term="meta-ethnography"><dt>Meta-Ethnography</dt>
          <dd>Qualitative synthesis method (Noblit &amp; Hare 1988) that translates concepts across studies to produce new interpretive frameworks.</dd></div>
        <div class="glossary-term" data-term="cerqual"><dt>CERQual</dt>
          <dd>Confidence in the Evidence from Reviews of Qualitative Research. Assesses confidence via methodological limitations, coherence, adequacy, and relevance.</dd></div>
        <div class="glossary-term" data-term="thematic synthesis"><dt>Thematic Synthesis</dt>
          <dd>Qualitative approach that codes findings across studies and generates analytical themes. Combines elements of meta-ethnography and grounded theory.</dd></div>
        <div class="glossary-term" data-term="rve"><dt>RVE (Robust Variance Estimation)</dt>
          <dd>Sandwich-type estimator providing valid standard errors for dependent effect sizes without knowing the true within-study correlation.</dd></div>
        <div class="glossary-term" data-term="three-level model"><dt>Three-Level Model</dt>
          <dd>Multilevel model partitioning variance into sampling (L1), within-study (L2), and between-study (L3) components for nested effect sizes.</dd></div>
        <div class="glossary-term" data-term="reproducibility"><dt>Reproducibility</dt>
          <dd>Same data + same code = same result. Minimum standard for any quantitative analysis. Distinguished from replicability (new data, same methods).</dd></div>
        <div class="glossary-term" data-term="proof-carrying number"><dt>Proof-Carrying Number</dt>
          <dd>A numerical result bundled with its full provenance chain: input data hash, transformation code, validator outcomes, and audit trail.</dd></div>
        <div class="glossary-term" data-term="evidence hashing"><dt>Evidence Hashing</dt>
          <dd>Cryptographic fingerprint (SHA-256) of input data and code that detects any change. Core component of proof-carrying numbers.</dd></div>
        <div class="glossary-term" data-term="bma"><dt>Bayesian Model Averaging (BMA)</dt>
          <dd>Weights multiple models (FE, RE, etc.) by their posterior probability rather than choosing one. Accounts for model uncertainty.</dd></div>
        <div class="glossary-term" data-term="half-cauchy"><dt>Half-Cauchy Prior</dt>
          <dd>Commonly used prior family for heterogeneity parameter tau. It allows large values while concentrating probability near zero, but scale choice should be justified for the effect metric and clinical context.</dd></div>
        <div class="glossary-term" data-term="league table"><dt>League Table</dt>
          <dd>NMA output showing all pairwise comparisons in a matrix. Upper/lower triangles show effect estimates and credible intervals.</dd></div>
        <div class="glossary-term" data-term="node-splitting"><dt>Node-Splitting</dt>
          <dd>Local inconsistency test in NMA comparing direct vs indirect evidence for each comparison. A difference suggests potential inconsistency and should trigger investigation of effect modifiers and network structure.</dd></div>
        <div class="glossary-term" data-term="sick-quitter bias"><dt>Sick-Quitter Bias</dt>
          <dd>Occurs when former users (who quit due to illness) are classified as non-users, making the non-user group appear sicker than it truly is.</dd></div>
        <div class="glossary-term" data-term="knots"><dt>Knots (Spline)</dt>
          <dd>Pre-specified dose points where polynomial segments join in restricted cubic splines. Typically 3-5 knots placed at dose distribution quantiles.</dd></div>
        <div class="glossary-term" data-term="scoping-review"><dt>Scoping Review</dt>
          <dd>A type of evidence synthesis that maps the extent, range, and nature of research activity in a field. Uses the PCC (Population, Concept, Context) framework. Reported with PRISMA-ScR. Does not assess quality or pool results.</dd></div>
        <div class="glossary-term" data-term="umbrella-review"><dt>Umbrella Review</dt>
          <dd>A review of existing systematic reviews on a topic. Uses AMSTAR 2 to assess review quality and ROBIS for risk of bias. Also called "overview of reviews." Corrects for study overlap using the Corrected Covered Area (CCA) method.</dd></div>
        <div class="glossary-term" data-term="cluster-rct"><dt>Cluster-Randomized Trial</dt>
          <dd>A trial that randomizes groups (hospitals, schools, communities) rather than individuals. Requires adjustment by the design effect = 1 + (m&minus;1) &times; ICC, where m is cluster size and ICC is the intra-cluster correlation. Ignoring clustering inflates precision.</dd></div>
        <div class="glossary-term" data-term="crossover-trial"><dt>Crossover Trial</dt>
          <dd>A trial where each participant receives both treatments in sequence (with a washout period). The paired analysis reduces variance. Requires within-patient correlation or paired SE for correct meta-analytic pooling.</dd></div>
        <div class="glossary-term" data-term="design-effect"><dt>Design Effect (DEFF)</dt>
          <dd>The ratio of variance under cluster sampling to variance under simple random sampling. DEFF = 1 + (m&minus;1) &times; ICC. Used to adjust sample size and standard errors from cluster-randomized trials before pooling in meta-analysis.</dd></div>
        <div class="glossary-term" data-term="hazard-ratio"><dt>Hazard Ratio (HR)</dt>
          <dd>The ratio of hazard rates between two groups in a time-to-event analysis. HR &lt; 1 favors treatment. Pooled on the log scale using inverse-variance weighting. SE derived from the 95% CI: SE = (ln(upper) &minus; ln(lower)) / 3.92.</dd></div>
        <div class="glossary-term" data-term="masem"><dt>MASEM (Meta-Analytic SEM)</dt>
          <dd>Meta-Analytic Structural Equation Modelling. A two-stage method: (1) pool correlation matrices across studies, (2) fit a structural equation model to the pooled matrix. Used to test theoretical path models across multiple studies.</dd></div>
        <div class="glossary-term" data-term="nnt"><dt>Number Needed to Treat (NNT)</dt>
          <dd>The number of patients who must be treated for one additional patient to benefit. NNT = 1 / Absolute Risk Reduction. Depends on baseline risk. Always report alongside OR or RR for clinical interpretability.</dd></div>
        <div class="glossary-term" data-term="power-ma"><dt>Power in Meta-Analysis</dt>
          <dd>The probability of detecting a true effect of a given size. Depends on number of studies, study sizes, heterogeneity (&#964;&sup2;), and effect size. Power calculators for meta-analysis exist (e.g., Valentine et al. 2010). Few studies with high heterogeneity dramatically reduces power.</dd></div>
      </dl>
    </div>
  </div>

  <!-- Keyboard shortcuts help -->
  <div class="keyboard-help" id="keyboardHelp" role="dialog" aria-label="Keyboard shortcuts">
    <h3>Keyboard Shortcuts</h3>
    <div class="keyboard-help-item">
      <span>Next slide</span>
      <span class="keyboard-help-key"> or Space</span>
    </div>
    <div class="keyboard-help-item">
      <span>Previous slide</span>
      <span class="keyboard-help-key"> or Backspace</span>
    </div>
    <div class="keyboard-help-item">
      <span>Next module</span>
      <span class="keyboard-help-key"> or N</span>
    </div>
    <div class="keyboard-help-item">
      <span>Previous module</span>
      <span class="keyboard-help-key"> or P</span>
    </div>
    <div class="keyboard-help-item">
      <span>Toggle tools panel</span>
      <span class="keyboard-help-key">T</span>
    </div>
    <div class="keyboard-help-item">
      <span>Toggle glossary</span>
      <span class="keyboard-help-key">G</span>
    </div>
    <div class="keyboard-help-item">
      <span>This help</span>
      <span class="keyboard-help-key">?</span>
    </div>
    <div class="keyboard-help-item">
      <span>Close dialogs</span>
      <span class="keyboard-help-key">Esc</span>
    </div>
    <button class="btn" onclick="toggleKeyboardHelp()" style="margin-top: 1rem; width: 100%;">Close</button>
  </div>

  <div class="course-container">
    <!-- Sidebar Navigation -->
    <nav class="sidebar" role="navigation" aria-label="Module navigation">
      <div class="sidebar-header">
        <a href="index.html" style="display:block;font-size:0.7rem;color:rgba(212,175,55,0.7);text-decoration:none;margin-bottom:0.5rem;" onmouseover="this.style.color='#D4AF37'" onmouseout="this.style.color='rgba(212,175,55,0.7)'">&larr; Course Library</a>
        <h1>Evidence Reversal Course</h1>
        <p>Meta-Analysis Methods</p>
      </div>
      <div class="module-list" id="moduleList">
        <!-- Module items generated by JS -->
      </div>
      <!-- Tier Selector -->
      <div class="tier-selector" role="radiogroup" aria-label="Content depth level">
        <button class="tier-btn active" data-tier="foundation" onclick="setTier('foundation')" role="radio" aria-checked="true">
          <span class="tier-icon"></span>Clinician
        </button>
        <button class="tier-btn" data-tier="researcher" onclick="setTier('researcher')" role="radio" aria-checked="false">
          <span class="tier-icon"></span>Researcher
        </button>
        <button class="tier-btn" data-tier="methodologist" onclick="setTier('methodologist')" role="radio" aria-checked="false">
          <span class="tier-icon"></span>Methodologist
        </button>
      </div>
      <div class="sidebar-footer">
        <button class="dashboard-btn" onclick="openDashboard()">
          <span></span>
          <span>Progress Dashboard</span>
          <span style="margin-left: auto; font-weight: 700;" id="sidebarPoints">0 pts</span>
        </button>
        <button class="daily-review-btn" id="dailyReviewBtn" onclick="openDailyReview()">
          <span></span>
          <span>Daily Review</span>
          <span style="margin-left: auto;" id="reviewStatus">Ready</span>
        </button>
        <p style="text-align: center; margin-bottom: 0.5rem;">Progress: <span id="progressPercent">0%</span></p>
        <button class="btn" style="padding: 0.25rem 0.5rem; font-size: 0.7rem; width: 100%;" onclick="resetProgress()">Reset Progress</button>
      </div>
    </nav>

    <!-- Progress Dashboard Modal -->
    <div class="progress-dashboard" id="progressDashboard">
      <div class="dashboard-content">
        <div class="dashboard-header">
          <h2>Your Progress</h2>
          <button class="dashboard-close" onclick="closeDashboard()">&times;</button>
        </div>

        <div class="level-display">
          <div class="level-badge" id="levelBadge">Level 1: Novice</div>
          <div class="points-display" id="totalPoints">0</div>
          <div class="points-label">Total Points</div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="modulesCompleted">0/25</div>
            <div class="stat-label">Modules</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="predictionsCorrect">0/0</div>
            <div class="stat-label">Predictions</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="quizzesCompleted">0</div>
            <div class="stat-label">Quizzes</div>
          </div>
        </div>

        <div class="principles-section">
          <h3>The Seven Principles</h3>
          <div id="principlesList"></div>
        </div>

        <div class="badges-section">
          <h3>Badges Earned</h3>
          <div class="badges-grid" id="badgesGrid"></div>
        </div>

        <div class="streak-section">
          <h3>Learning Streak</h3>
          <div class="streak-display">
            <div class="streak-flame" id="streakFlame"></div>
            <div class="streak-info">
              <div class="streak-count" id="streakCount">0 days</div>
              <div class="streak-label">Keep learning daily!</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Daily Review Modal -->
    <div class="daily-review-modal" id="dailyReviewModal" role="dialog" aria-label="Daily review">
      <div class="daily-review-content">
        <div class="daily-review-header">
          <h2> Daily Review</h2>
          <button class="daily-review-close" onclick="closeDailyReview()">&times;</button>
        </div>

        <div class="review-timer">
          <div class="timer-display" id="reviewTimer">2:00</div>
          <div class="timer-label">Strengthen your memory</div>
        </div>

        <div class="review-progress" id="reviewProgress">
          <!-- Progress dots inserted by JS -->
        </div>

        <div id="reviewCardContainer">
          <!-- Review cards inserted by JS -->
        </div>

        <div class="review-actions" id="reviewActions">
          <button class="review-btn skip" onclick="skipDailyReview()">Skip for Today</button>
          <button class="review-btn next" id="reviewNextBtn" onclick="nextReviewQuestion()" disabled>Continue</button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
      <header class="content-header">
        <div class="breadcrumb">
          Module <span id="currentModuleNum">0</span>: <span id="currentModuleName">The Opening</span>
        </div>
        <div class="header-actions">
          <button class="btn" onclick="toggleToolsPanel()">Tools</button>
          <button class="btn primary" onclick="nextModule()">Next Module</button>
        </div>
      </header>

      <div class="content-body">
        <!-- Accessibility: Screen reader announcements for slide changes -->
        <div id="slideAnnouncer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
        <!-- Slides Container -->
        <div class="slides-container" id="main-content" role="region" aria-label="Course slides">
          <!-- Module 0: The Opening -->
          <div class="module-slides active" data-module="0">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Not every signal is truth.</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 0: The Opening</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Define meta-analysis and explain its role in evidence synthesis</li>
                    <li>Identify when studies should NOT be pooled</li>
                    <li>Describe the evidence hierarchy and where systematic reviews sit</li>
                    <li>Recognize that meta-analysis can mislead when done poorly</li>
                    <li>Recall the Seven Principles that anchor this course</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">This course exists because</p>
              <p class="title gold animate delay-1 text-center">medicine was wrong.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                Not once. Not rarely. Repeatedly. In ways that killed patients who trusted that the evidence was sound.
              </p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">What is Meta-Analysis?</h2>
                <div class="card animate delay-1">
                  <p class="card-text text-center">
                    A statistical method for combining results from multiple independent studies addressing the same question.
                  </p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">1976</div>
                    <div class="stat-label">Term coined by Gene Glass</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">~50,000</div>
                    <div class="stat-label">Published per year</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">#1</div>
                    <div class="stat-label">Evidence hierarchy*</div>
                  </div>
                </div>
                <p class="footnote animate delay-3">*When well conducted. Quality of conduct matters more than study design alone  as GRADE recognizes.</p>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">Why Pool Studies?</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Increase Statistical Power</h4>
                    <p>Individual studies may be too small to detect effects.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Improve Precision</h4>
                    <p>Narrower confidence intervals around effect estimates.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Resolve Disagreement</h4>
                    <p>When studies conflict, pooling can clarify the signal.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Explore Heterogeneity</h4>
                    <p>Identify why effects differ across populations or settings.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="4">
              <p class="title cream animate text-center">But meta-analysis can also</p>
              <p class="big-number gold animate delay-1">MISLEAD</p>
              <p class="animate delay-2" style="font-size: 1.1rem; text-align: center; max-width: 600px; margin-top: 1rem;">
                When done poorly, it amplifies bias rather than truth.
              </p>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">When NOT to Pool</h2>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number">1</div>
                  <p>Studies measure fundamentally different things (apples and oranges)</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">2</div>
                  <p>Extreme heterogeneity that cannot be explained</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">3</div>
                  <p>One study dominates all others (megastudy problem)</p>
                </div>
                <div class="wrong-item animate delay-4">
                  <div class="wrong-number">4</div>
                  <p>Studies have high risk of bias that cannot be adjusted for</p>
                </div>
                <div class="focus-box animate delay-5 mt-2">
                  <p class="main">Pooling is a privilege, not a right.</p>
                  <p class="sub">The decision to combine must be defended.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="6">
              <div class="content">
                <h2 class="title navy animate">The Hierarchy of Evidence</h2>
                <div style="max-width: 600px; margin-top: 1.5rem;">
                  <div class="card animate delay-1" style="background: var(--gold); color: var(--navy);">
                    <p class="card-text text-center" style="font-weight: 700;">Systematic Reviews & Meta-Analyses of RCTs</p>
                  </div>
                  <div class="card animate delay-2">
                    <p class="card-text text-center">Randomized Controlled Trials</p>
                  </div>
                  <div class="card animate delay-3">
                    <p class="card-text text-center">Cohort Studies</p>
                  </div>
                  <div class="card animate delay-4">
                    <p class="card-text text-center">Case-Control Studies</p>
                  </div>
                  <div class="card animate delay-5">
                    <p class="card-text text-center">Case Series / Expert Opinion</p>
                  </div>
                </div>
                <p class="footnote animate delay-5">Position in hierarchy depends on methodology quality, not study type alone.</p>
              </div>
            </div>
            <div class="slide dark" data-index="7">
              <p class="title cream animate text-center">This course teaches through</p>
              <p class="title gold animate delay-1 text-center">evidence reversals.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1rem; text-align: center; max-width: 700px;">
                Each module opens with a story of how medicine got it wrong. Then we learn the method that would have prevented the harm.
              </p>
            </div>
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">The Seven Principles</h2>
                <p class="animate delay-1" style="font-style: italic; margin-bottom: 1.5rem;">
                  These phrases will return throughout your journey:
                </p>
                <div style="text-align: left; max-width: 700px;">
                  <p class="animate delay-1" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">1.</span> "Not every signal is truth."</p>
                  <p class="animate delay-2" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">2.</span> "Methods protect patients from our confidence."</p>
                  <p class="animate delay-3" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">3.</span> "What was hidden in plain sight?"</p>
                  <p class="animate delay-3" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">4.</span> "The number without provenance is not a number."</p>
                  <p class="animate delay-4" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">5.</span> "Heterogeneity is a message, not noise."</p>
                  <p class="animate delay-4" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">6.</span> "Absence of evidence is not evidence of absence."</p>
                  <p class="animate delay-5" style="margin: 0.75rem 0; font-size: 1.1rem;"><span style="color: var(--gold);">7.</span> "Certainty must be earned, not assumed."</p>
                </div>
              </div>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Module 0 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q0-1">
                    <h4>1. Why should you sometimes NOT pool studies in a meta-analysis?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q0-1', 0, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
                        <span>A.</span> Pooling is always better than single studies
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q0-1', 1, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
                        <span>B.</span> When heterogeneity is extreme or studies measure different things
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q0-1', 2, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
                        <span>C.</span> Pooling is always appropriate for RCTs
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q0-1', 3, 1, ['More is generally better but not always.', 'Correct! Extreme heterogeneity or comparing apples to oranges makes pooling misleading.', 'Pooling is always appropriate for clinical trials.', 'Statistical methods are powerful.'])">
                        <span>D.</span> Statistical methods handle any situation
                      </div>
                    </div>
                    <div id="q0-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q0-2" style="margin-top: 1.5rem;">
                    <h4>2. Where do systematic reviews of RCTs sit in the evidence hierarchy?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q0-2', 0, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
                        <span>A.</span> At the top
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q0-2', 1, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
                        <span>B.</span> Same level as individual RCTs
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q0-2', 2, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
                        <span>C.</span> Below cohort studies
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q0-2', 3, 0, ['Correct! Well-conducted SRs/MAs of RCTs are at the top of the evidence hierarchy.', 'RCTs are second to their systematic reviews.', 'Cohort studies are observational.', 'Expert opinion is at the bottom.'])">
                        <span>D.</span> Same as expert opinion
                      </div>
                    </div>
                    <div id="q0-2-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide black" data-index="10">
              <p class="refrain animate">Begin the journey.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 1: The Question</p>
            </div>
            <!-- Slide nav generated by JS -->
          </div>

          <!-- Module 1: The Question (CAST) -->
          <div class="module-slides" data-module="1">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Not every signal is truth.</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">This is not a story about error.</p>
              <p class="title gold animate delay-1 text-center">It is a story about certainty.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 1: The Question</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Formulate a focused PICO question for a systematic review</li>
                    <li>Distinguish surrogate outcomes from patient-important outcomes</li>
                    <li>Explain why biological plausibility alone is insufficient evidence</li>
                    <li>Describe the CAST trial and its implications for evidence-based medicine</li>
                    <li>Apply the principle: "Not every bright sign is guidance"</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <p class="big-number navy animate">~9,000</p>
              <p class="subtitle animate delay-1">excess deaths per year</p>
              <p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">From a treatment everyone believed worked.</p>
              <div class="gold-line animate delay-3"></div>
              <p class="animate delay-4" style="color: var(--light-text);">This is the story of how we believed - and how we were wrong.</p>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Observation</h2>
                <div class="card animate delay-1">
                  <p class="card-text text-center">Patients with frequent PVCs after MI had 2-5x higher mortality.</p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">400,000+</div>
                    <div class="stat-label">MI survivors/year</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">~40%</div>
                    <div class="stat-label">with significant PVCs</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">160,000</div>
                    <div class="stat-label">at elevated risk</div>
                  </div>
                </div>
                <p class="footnote animate delay-3">A massive clinical need. A clear target.</p>
              </div>
            </div>
            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">The Response</h2>
                <p class="animate delay-1" style="font-size: 1.2rem; text-align: center; margin: 1rem 0;">
                  Antiarrhythmic drugs were developed, FDA approved,<br>and prescribed to ~200,000 patients per year.
                </p>
                <div class="focus-box animate delay-2">
                  <p class="main">No villain appears in this story.</p>
                  <p class="sub">Everyone acted on the best evidence available.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">The Logic That Convinced Everyone</h2>
                <div class="card animate delay-1">
                  <div class="card-label">PREMISE 1</div>
                  <p class="card-text">PVCs after MI predict sudden cardiac death</p>
                </div>
                <div class="arrow animate delay-1"></div>
                <div class="card animate delay-2">
                  <div class="card-label">PREMISE 2</div>
                  <p class="card-text">Antiarrhythmic drugs suppress PVCs</p>
                </div>
                <div class="arrow animate delay-2"></div>
                <div class="card animate delay-3">
                  <div class="card-label">PREMISE 3</div>
                  <p class="card-text">Suppressing PVCs should prevent sudden death</p>
                </div>
                <div class="arrow animate delay-3"></div>
                <div class="card navy-bg animate delay-4">
                  <div class="card-label">CONCLUSION</div>
                  <p class="card-text">Antiarrhythmics save lives in post-MI patients</p>
                </div>
                <p class="footnote animate delay-5">The chain was logical. The conclusion felt inevitable.</p>
              </div>
            </div>
            <div class="slide light" data-index="6">
              <div class="content">
                <h2 class="title navy animate">CAST: The Cardiac Arrhythmia Suppression Trial</h2>
                <p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1.5rem;">
                  Finally, someone asked: "Does suppressing PVCs actually save lives?"
                </p>
                <div class="design-grid animate delay-2">
                  <div class="design-item">
                    <div class="design-item-label">Design</div>
                    <div class="design-item-value">Randomized, double-blind, placebo-controlled</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Population</div>
                    <div class="design-item-value">Post-MI patients with asymptomatic PVCs</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Intervention</div>
                    <div class="design-item-value">Encainide, flecainide, or moricizine vs placebo</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Run-in</div>
                    <div class="design-item-value">Only patients with 80% PVC suppression randomized</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Primary endpoint</div>
                    <div class="design-item-value">Death or cardiac arrest with resuscitation</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Sample size</div>
                    <div class="design-item-value">1,498 patients (encainide/flecainide arms)</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">The Results: April 1989</h2>
                <p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">
                  Data Safety Monitoring Board stops the trial early.
                </p>
                <table class="results-table animate delay-2">
                  <thead>
                    <tr>
                      <th>Outcome</th>
                      <th>Drug (n=755)</th>
                      <th>Placebo (n=743)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Arrhythmic deaths</td>
                      <td class="highlight">33</td>
                      <td>9</td>
                    </tr>
                    <tr>
                      <td>All cardiac deaths</td>
                      <td class="highlight">43</td>
                      <td>16</td>
                    </tr>
                    <tr>
                      <td>Total deaths</td>
                      <td class="highlight">56</td>
                      <td>22</td>
                    </tr>
                    <tr>
                      <td><strong>Death rate</strong></td>
                      <td class="highlight">7.4%</td>
                      <td><strong>3.0%</strong></td>
                    </tr>
                  </tbody>
                </table>
                <div class="result-box animate delay-3">
                  <div class="value">Relative Risk of Death: 2.5</div>
                  <div class="label">95% CI: 1.6 - 4.5 | p &lt; 0.001</div>
                </div>
                <p class="footnote animate delay-4">The drugs that perfectly suppressed arrhythmias increased mortality by 150%.</p>
              </div>
            </div>
            <div class="slide dark" data-index="8">
              <div class="content">
                <h2 class="title cream animate">The Human Cost</h2>
                <p class="animate delay-1" style="margin-bottom: 1rem;">Before CAST, ~200,000 Americans per year received these drugs.</p>
                <p class="big-number gold animate delay-2">~9,000</p>
                <p class="animate delay-2" style="font-size: 1.25rem;">excess deaths per year - possibly more</p>
                <div style="background: rgba(45,58,95,0.8); padding: 1rem 2rem; text-align: center; margin: 1rem 0;" class="animate delay-3">
                  <p style="color: var(--cream);">Vietnam War: ~6,000 US deaths/year &bull; These drugs: ~9,000+ deaths/year</p>
                </div>
                <p class="serif animate delay-4" style="font-style: italic; color: var(--gold); margin-top: 1.5rem; text-align: center;">
                  For every number, a name we will never know.
                </p>
              </div>
            </div>
            <div class="slide black" data-index="9">
              <p class="serif animate" style="font-size: clamp(2rem, 5vw, 3rem);">Look again.</p>
            </div>
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">The Logic - Revisited</h2>
                <div class="card animate delay-1">
                  <div class="card-label">PREMISE 1</div>
                  <p class="card-text">PVCs after MI predict sudden cardiac death</p>
                </div>
                <div class="arrow animate delay-1"></div>
                <div class="card-wrapper animate delay-2">
                  <div class="card">
                    <div class="card-label">PREMISE 2</div>
                    <p class="card-text">Antiarrhythmic drugs suppress PVCs</p>
                  </div>
                  <div class="leap-badge"> THE LEAP</div>
                </div>
                <div class="arrow animate delay-2"></div>
                <div class="card red-border animate delay-3">
                  <div class="card-label">PREMISE 3</div>
                  <p class="card-text">Suppressing PVCs should prevent sudden death</p>
                </div>
                <div class="arrow animate delay-3"></div>
                <div class="card navy-bg animate delay-4">
                  <div class="card-label">CONCLUSION</div>
                  <p class="card-text">Antiarrhythmics save lives in post-MI patients</p>
                </div>
                <p class="footnote animate delay-5">The assumption that suppressing the marker would fix the outcome was never tested.</p>
              </div>
            </div>
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">What Went Wrong: The Surrogate Trap</h2>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number">1</div>
                  <p>PVCs were a marker of damaged tissue, not a cause of death</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">2</div>
                  <p>The drugs had proarrhythmic effects - triggering deadlier rhythms</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">3</div>
                  <p>The surrogate improved while the outcome worsened - a dissociated surrogate</p>
                </div>
                <div class="focus-box animate delay-4 mt-2">
                  <p class="main">The surrogate did not lie. We asked it the wrong question.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="12">
              <div class="content">
                <h2 class="title navy animate">The PICO Framework</h2>
                <p class="animate delay-1" style="margin-bottom: 1.5rem; font-style: italic;">
                  Every answerable clinical question has four components:
                </p>
                <div class="design-grid" style="grid-template-columns: repeat(2, 1fr);">
                  <div class="design-item animate delay-1" style="border-left-color: var(--navy);">
                    <div class="design-item-label" style="color: var(--navy);">P - POPULATION</div>
                    <div class="design-item-value">Who are the patients? What are their characteristics?</div>
                  </div>
                  <div class="design-item animate delay-2" style="border-left-color: var(--green);">
                    <div class="design-item-label" style="color: var(--green);">I - INTERVENTION</div>
                    <div class="design-item-value">What treatment or exposure is being evaluated?</div>
                  </div>
                  <div class="design-item animate delay-3" style="border-left-color: var(--red);">
                    <div class="design-item-label" style="color: var(--red);">C - COMPARATOR</div>
                    <div class="design-item-value">What is the alternative? Placebo? Standard care?</div>
                  </div>
                  <div class="design-item animate delay-4" style="border-left-color: var(--gold);">
                    <div class="design-item-label" style="color: var(--gold);">O - OUTCOME</div>
                    <div class="design-item-value">What matters to patients? Hard endpoints vs surrogates.</div>
                  </div>
                </div>
                <div class="result-box animate delay-5" style="margin-top: 1.5rem;">
                  <div class="label">CAST PICO</div>
                  <div class="value" style="font-size: 1rem; line-height: 1.5;">
                    Post-MI patients with PVCs | Antiarrhythmics | Placebo | Mortality
                  </div>
                </div>
              </div>
            </div>
            <!-- CAST Investigation Exercise -->
            <div class="slide dark" data-index="13">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Investigation Exercise: The Evidence Before CAST</h3>
                </div>
                <p class="direct-address">You are a cardiologist in 1988. A patient has survived an MI but has frequent PVCs. The observational literature is clear...</p>
                <table class="data-table-investigation">
                  <thead>
                    <tr><th>Study</th><th>Patients with PVCs</th><th>Mortality Risk</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>Lown (1977)</td><td>High-grade PVCs</td><td>2.4x higher</td></tr>
                    <tr><td>Bigger (1984)</td><td>>10 PVCs/hour</td><td>3.1x higher</td></tr>
                    <tr><td>Mukharji (1984)</td><td>Complex PVCs</td><td>4.8x higher</td></tr>
                  </tbody>
                </table>
                <p class="rhetorical" style="margin-top: 1rem;">The signal is clear. The mechanism is plausible. Would you prescribe antiarrhythmics?</p>
                <button class="reveal-btn" onclick="revealAnswer('cast-reveal')">See What CAST Revealed </button>
                <div id="cast-reveal" class="hidden-reveal">
                  <div class="comparison-grid">
                    <div class="comparison-panel">
                      <h4>Before: Observational Logic</h4>
                      <p>PVCs  Higher mortality</p>
                      <p>Drugs suppress PVCs</p>
                      <p><strong> Drugs should reduce mortality</strong></p>
                    </div>
                    <div class="comparison-panel after">
                      <h4>After: CAST RCT (1989)</h4>
                      <p>Death rate on drug: <strong style="color: var(--red);">7.4%</strong></p>
                      <p>Death rate on placebo: <strong>3.0%</strong></p>
                      <p><strong style="color: var(--red);">RR = 2.5 (150% increase in deaths)</strong></p>
                    </div>
                  </div>
                  <p style="margin-top: 1rem; font-style: italic; color: var(--gold);">The surrogate improved. The patients died. This is why we ask: "What is the outcome that matters?"</p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="14">
              <div class="content">
                <h2 class="title navy animate">The Lessons for Evidence Synthesis</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Biological plausibility is not proof</h4>
                    <p>A logical mechanism doesn't guarantee the expected effect.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Surrogate endpoints can mislead</h4>
                    <p>Improving a biomarker doesn't prove improvement in outcomes.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Randomized trials provide the strongest causal evidence</h4>
                    <p>Observational data alone rarely establishes causation for interventions due to confounding.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Consensus is not evidence</h4>
                    <p>200,000 prescriptions, FDA approval, and guidelines were all wrong.</p>
                  </div>
                </div>
                <p class="serif animate delay-5" style="font-style: italic; color: var(--gold); margin-top: 1.5rem; text-align: center;">
                  This is why we do meta-analysis: to see past apparent truths.
                </p>
              </div>
            </div>
            <!-- STORY: The DES-II Surrogate Tragedy -->
            <div class="slide dark" data-index="14b">
              <div class="story-box animate">
                <p class="story-opener">What if the question you ask determines who lives and who dies?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    In 1989, cardiologists knew that <span class="data-highlight">PVC suppression was achievable</span> with encainide and flecainide.
                    The surrogate endpoint looked perfect: drugs suppressed PVCs by <span class="data-highlight">80%+</span>.
                    But CAST randomized <span class="data-highlight">1,498 patients</span> to active drug vs placebo.
                    The trial was stopped early: <span class="data-highlight">56 deaths in the drug group vs 22 in placebo</span>.
                    Mortality increased <span class="data-highlight">2.5-fold</span>.
                    An estimated <span class="data-highlight">~9,000 excess American deaths per year</span> were attributable to these drugs.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Cardiologist's Choice: 1987</div>
                  <div class="decision-scenario">
                    Your post-MI patient has frequent PVCs. You have drugs that suppress them completely. What do you do?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Treat the Surrogate</div>
                      <div class="path-choice">Prescribe encainide  PVCs vanish, the ECG looks clean</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">The biomarker improves. You feel confident. The patient dies.</div>
                      <div class="path-outcome">OUTCOME: An estimated 50,000+ excess deaths across the US during years of use</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Demand a Mortality Trial</div>
                      <div class="path-choice">Insist: "Show me that survival improves, not just the ECG"</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">The trial reveals harm. The drugs are withdrawn. Lives are saved.</div>
                      <div class="path-outcome">OUTCOME: The right PICO question prevents a catastrophe</div>
                    </div>
                  </div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    The question was never "Can we suppress PVCs?" It was "Does PVC suppression save lives?"
                    A surrogate endpoint answered the wrong question. The right PICO would have demanded mortality as the outcome from the start.
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="14">
              <p class="closing-line animate">What appears certain may be wrong.</p>
              <p class="closing-line animate delay-1">What everyone believes may be false.</p>
              <p class="closing-line gold animate delay-2">Methods exist so patients do not pay for our confidence.</p>
              <div class="gold-line animate delay-3"></div>
              <p class="closing-line italic animate delay-4">This is why you are here.</p>
            </div>
            <!-- Module 1 Quiz -->
            <div class="slide light" data-index="16">
              <div class="content">
                <h2 class="title navy animate">Module 1 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q1-1">
                    <h4>1. What was the fundamental error in the antiarrhythmic logic?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q1-1', 0, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
                        <span>A.</span> The trials were not randomized
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q1-1', 1, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
                        <span>B.</span> Treating a surrogate (PVCs) was assumed to improve outcomes
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q1-1', 2, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
                        <span>C.</span> The sample size was too small
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q1-1', 3, 1, ['The trials were conducted properly.', 'Correct! They assumed suppressing the marker (PVCs) would improve the outcome (mortality), but PVCs were just a marker, not a cause.', 'The sample size was large enough.', 'FDA approval followed proper procedures.'])">
                        <span>D.</span> The FDA approval was rushed
                      </div>
                    </div>
                    <div id="q1-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q1-2">
                    <h4>2. In PICO, what does the "O" stand for and why does it matter?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q1-2', 0, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
                        <span>A.</span> Observation - what researchers see
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q1-2', 1, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
                        <span>B.</span> Objective - the research goal
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q1-2', 2, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
                        <span>C.</span> Outcome - what matters to patients
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q1-2', 3, 2, ['O stands for Outcome, not Observation.', 'O stands for Outcome, not Objective.', 'Correct! The choice of outcome determines whether a treatment truly helps patients. CAST measured mortality (hard outcome) instead of just PVC suppression (surrogate).', 'O stands for Outcome, not Organization.'])">
                        <span>D.</span> Organization - study structure
                      </div>
                    </div>
                    <div id="q1-2-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide black" data-index="17">
              <p class="refrain animate">Not every signal is truth.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">
                Methods protect patients from our confidence.
              </p>
            </div>
          </div>

          <!-- Module 2: The Protocol (HRT) -->
          <div class="module-slides" data-module="2">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">What was hidden in plain sight?</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">This is a story about</p>
              <p class="title gold animate delay-1 text-center">observational evidence.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 2: The Protocol</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Explain why protocol pre-registration prevents bias</li>
                    <li>Identify key elements of a PROSPERO registration</li>
                    <li>Distinguish healthy user bias from true treatment effects</li>
                    <li>Describe why observational studies overestimated HRT benefits</li>
                    <li>Apply the principle: "Methods protect patients from our confidence"</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <p class="big-number navy animate">30+</p>
              <p class="subtitle animate delay-1">observational studies</p>
              <p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">
                All showing hormone replacement therapy protected postmenopausal women from heart disease.
              </p>
              <div class="gold-line animate delay-3"></div>
              <p class="animate delay-4" style="color: var(--light-text);">The evidence seemed overwhelming. The conclusion seemed certain.</p>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Nurses' Health Study</h2>
                <div class="card animate delay-1">
                  <p class="card-text text-center">122,000 nurses followed for decades. HRT users had 40-50% lower cardiovascular mortality.</p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">RR 0.56</div>
                    <div class="stat-label">Cardiovascular mortality</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">122,000</div>
                    <div class="stat-label">Women followed</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">20+ years</div>
                    <div class="stat-label">Follow-up</div>
                  </div>
                </div>
                <p class="footnote animate delay-3">Landmark study. Impeccable methodology. Wrong conclusion.</p>
              </div>
            </div>
            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">The Hidden Bias</h2>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number">1</div>
                  <p><strong>Healthy User Bias:</strong> Women who chose HRT were healthier, wealthier, better educated</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">2</div>
                  <p><strong>Compliance Bias:</strong> Women who took HRT consistently also took better care of themselves</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">3</div>
                  <p><strong>Prescriber Bias:</strong> Doctors gave HRT to healthier women with fewer risk factors</p>
                </div>
                <div class="focus-box animate delay-4 mt-2">
                  <p class="main">The treatment wasn't protecting them. They were already protected.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">WHI: The Women's Health Initiative</h2>
                <p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1.5rem;">
                  The largest randomized trial of HRT ever conducted.
                </p>
                <div class="design-grid animate delay-2">
                  <div class="design-item">
                    <div class="design-item-label">Design</div>
                    <div class="design-item-value">Randomized, double-blind, placebo-controlled</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Population</div>
                    <div class="design-item-value">Postmenopausal women aged 50-79</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Intervention</div>
                    <div class="design-item-value">Estrogen + Progestin vs Placebo</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Sample size</div>
                    <div class="design-item-value">16,608 women</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Primary endpoint</div>
                    <div class="design-item-value">Coronary heart disease</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Planned duration</div>
                    <div class="design-item-value">8.5 years</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="6">
              <div class="content">
                <h2 class="title navy animate">The Results: July 2002</h2>
                <p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">
                  Trial stopped early after 5.2 years. Harm exceeded benefits.
                </p>
                <table class="results-table animate delay-2">
                  <thead>
                    <tr>
                      <th>Outcome</th>
                      <th>Hazard Ratio</th>
                      <th>Direction</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Coronary heart disease</td>
                      <td class="highlight">1.29</td>
                      <td class="highlight">HARM</td>
                    </tr>
                    <tr>
                      <td>Stroke</td>
                      <td class="highlight">1.41</td>
                      <td class="highlight">HARM</td>
                    </tr>
                    <tr>
                      <td>Breast cancer</td>
                      <td class="highlight">1.26</td>
                      <td class="highlight">HARM</td>
                    </tr>
                    <tr>
                      <td>Pulmonary embolism</td>
                      <td class="highlight">2.13</td>
                      <td class="highlight">HARM</td>
                    </tr>
                  </tbody>
                </table>
                <div class="result-box animate delay-3">
                  <div class="value">Complete Reversal</div>
                  <div class="label">30 years of observational evidence overturned</div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="7">
              <p class="title cream animate">The Lesson</p>
              <p class="big-number gold animate delay-1" style="font-size: clamp(2rem, 8vw, 5rem);">PRE-SPECIFY</p>
              <p class="animate delay-2" style="font-size: 1.1rem; text-align: center; max-width: 600px; margin-top: 1rem;">
                A protocol written before the search begins prevents fishing, prevents bias, prevents hindsight distortion.
              </p>
            </div>
            <!-- STORY: The Hormone Timing Hypothesis -->
            <div class="slide dark" data-index="7b">
              <div class="story-box animate">
                <p class="story-opener">What if the treatment worksbut only for some?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    WHI showed HRT <span class="data-highlight">increased cardiovascular events overall</span>.
                    But later analyses revealed a critical pattern: women who started HRT
                    <span class="data-highlight">within 10 years of menopause</span> had
                    <span class="data-highlight">REDUCED cardiovascular risk</span>.
                    Women starting <span class="data-highlight">20+ years after menopause</span> had
                    <span class="data-highlight">INCREASED risk</span>.
                    The overall null/harm result hid a timing effect.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Analyst's Dilemma</div>
                  <div class="decision-scenario">
                    You are analyzing WHI subgroups. The overall result shows harm. Do you dig deeper?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Report Overall Only</div>
                      <div class="path-choice">Conclude HRT is harmful for all postmenopausal women</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Simple message. Guidelines recommend against HRT universally.</div>
                      <div class="path-outcome">OUTCOME: Deny potential benefit to younger menopausal women</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Pre-Specify Timing Subgroups</div>
                      <div class="path-choice">Analyze by years since menopause (biologically plausible)</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Discover the "timing window" for safe HRT initiation.</div>
                      <div class="path-outcome">OUTCOME: Enable personalized recommendations</div>
                    </div>
                  </div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    Subgroup analysis is dangerous when fishing. It is essential when biology predicts effect modification.
                    The timing hypothesis was biologically plausibleand should have been pre-specified.
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">PROSPERO Registration</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Register Before You Search</h4>
                    <p>PROSPERO: International prospective register of systematic reviews</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Lock Your Decisions</h4>
                    <p>PICO, search strategy, outcomes, analysis plan - all pre-specified</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Document Amendments</h4>
                    <p>Changes are allowed but must be transparent and justified</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Prevent Duplication</h4>
                    <p>Check if your review already exists before starting</p>
                  </div>
                </div>
              </div>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Module 2 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q2-1">
                    <h4>1. Why did the Nurses' Health Study show benefit from HRT that WHI did not?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q2-1', 0, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthierconfounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
                        <span>A.</span> Nurses' Health had too few patients
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q2-1', 1, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthierconfounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
                        <span>B.</span> Healthy user bias in observational studies
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q2-1', 2, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthierconfounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
                        <span>C.</span> Nurses' Health had shorter follow-up
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q2-1', 3, 1, ['Sample size was adequate in both.', 'Correct! Women who chose HRT were already healthierconfounding by indication.', 'Follow-up duration was similar.', 'The hormone formulations were the same.'])">
                        <span>D.</span> Different hormone formulations were used
                      </div>
                    </div>
                    <div id="q2-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q2-2" style="margin-top: 1.5rem;">
                    <h4>2. What is the primary purpose of PROSPERO registration?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q2-2', 0, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
                        <span>A.</span> To register clinical trials
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q2-2', 1, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
                        <span>B.</span> To speed up review completion
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q2-2', 2, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
                        <span>C.</span> To pre-specify methods and prevent bias
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q2-2', 3, 2, ['PROSPERO is for reviews, not trials.', 'Faster completion is not the goal.', 'Correct! Pre-specifying methods prevents post-hoc changes that bias results.', 'Funding is separate from registration.'])">
                        <span>D.</span> To obtain funding for reviews
                      </div>
                    </div>
                    <div id="q2-2-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="10">
              <p class="closing-line animate">Pre-specification is not bureaucracy.</p>
              <p class="closing-line animate delay-1">It is protection.</p>
              <p class="closing-line gold animate delay-2">Against our own tendency to find what we expect.</p>
              <div class="gold-line animate delay-3"></div>
              <p class="closing-line italic animate delay-4">Methods protect patients from our confidence.</p>
            </div>
            <div class="slide black" data-index="11">
              <p class="refrain animate">What was hidden in plain sight?</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 3: The Search</p>
            </div>
          </div>

          <!-- Module 3: The Search (Rosiglitazone) -->
          <div class="module-slides" data-module="3">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">What was hidden in plain sight?</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">This is a story about</p>
              <p class="title gold animate delay-1 text-center">what they didn't publish.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 3: The Search</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Develop a comprehensive search strategy using PRESS guidelines</li>
                    <li>Search multiple databases including grey literature sources</li>
                    <li>Identify trial registries and regulatory databases (ClinicalTrials.gov, FDA)</li>
                    <li>Explain how the rosiglitazone case exposed hidden cardiovascular harms</li>
                    <li>Apply the principle: "What was hidden in plain sight?"</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <p class="big-number navy animate">$3.2B</p>
              <p class="subtitle animate delay-1">annual sales at peak</p>
              <p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">Avandia (rosiglitazone) was one of the world's best-selling diabetes drugs.</p>
              <div class="gold-line animate delay-3"></div>
              <p class="animate delay-4" style="color: var(--light-text);">The published trials looked reassuring. The unpublished ones told a different story.</p>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Published Evidence (Pre-2007)</h2>
                <div class="card animate delay-1">
                  <p class="card-text text-center">Published trials showed rosiglitazone effectively lowered HbA1c. Cardiovascular outcomes were rarely reported.</p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">1999</div>
                    <div class="stat-label">FDA approval</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">6M+</div>
                    <div class="stat-label">Patients treated</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">~0.7%</div>
                    <div class="stat-label">HbA1c reduction</div>
                  </div>
                </div>
                <p class="footnote animate delay-3">The surrogate looked good. But what about actual cardiovascular events?</p>
              </div>
            </div>
            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">Nissen's Discovery: May 2007</h2>
                <p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1rem;">Dr. Steven Nissen obtained unpublished trial data from GSK's own website.</p>
                <div class="card animate delay-2">
                  <p class="card-text text-center">GSK had been required by legal settlement to post clinical trial results online. Nissen and Wolski analyzed 42 trials - many never published in journals.</p>
                </div>
                <div class="focus-box animate delay-3 mt-2">
                  <p class="main">The data was technically public.</p>
                  <p class="sub">No one had systematically searched for it.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">The Meta-Analysis Results</h2>
                <table class="results-table animate delay-1">
                  <thead>
                    <tr>
                      <th>Outcome</th>
                      <th>Odds Ratio</th>
                      <th>95% CI</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Myocardial Infarction</td>
                      <td class="highlight">1.43</td>
                      <td class="highlight">1.03 - 1.98</td>
                    </tr>
                    <tr>
                      <td>CV Death</td>
                      <td>1.64</td>
                      <td>0.98 - 2.74</td>
                    </tr>
                  </tbody>
                </table>
                <div class="result-box animate delay-2">
                  <div class="value">43% Increased Risk of Heart Attack</div>
                  <div class="label">p = 0.03 for myocardial infarction</div>
                </div>
                <p class="footnote animate delay-3">Published in NEJM. The FDA called an emergency advisory committee meeting.</p>
              </div>
            </div>
            <div class="slide dark" data-index="6">
              <div class="content">
                <h2 class="title cream animate">The FDA Advisory Committee: July 2007</h2>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box">
                    <div class="stat-value">22-1</div>
                    <div class="stat-label">Voted: CV risk exists</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">20-3</div>
                    <div class="stat-label">Keep on market with warnings</div>
                  </div>
                </div>
                <p class="animate delay-2" style="margin-top: 1.5rem; text-align: center;">The committee was divided. Some wanted it withdrawn. Some called the meta-analysis flawed.</p>
                <p class="animate delay-3" style="margin-top: 1rem; font-size: 1.1rem; text-align: center; color: var(--gold);">But the signal could not be unseen.</p>
              </div>
            </div>
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">The Aftermath</h2>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number">1</div>
                  <p><strong>Black box warning</strong> added for heart failure risk (2007)</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">2</div>
                  <p><strong>Severe restrictions</strong> on prescribing in the US (2010)</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">3</div>
                  <p><strong>Withdrawn</strong> from European market entirely (2010)</p>
                </div>
                <div class="wrong-item animate delay-4">
                  <div class="wrong-number">4</div>
                  <p><strong>FDA now requires</strong> cardiovascular outcome trials for all diabetes drugs</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">What a Comprehensive Search Requires</h2>
                <div class="design-grid animate delay-1">
                  <div class="design-item">
                    <div class="design-item-label">PUBLISHED</div>
                    <div class="design-item-value">PubMed, Embase, CENTRAL, Web of Science</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">GREY LITERATURE</div>
                    <div class="design-item-value">Conference abstracts, dissertations, regulatory docs</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">TRIAL REGISTRIES</div>
                    <div class="design-item-value">ClinicalTrials.gov, WHO ICTRP, EU CTR</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">REGULATORY</div>
                    <div class="design-item-value">FDA, EMA, Health Canada submissions</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">COMPANY DATA</div>
                    <div class="design-item-value">GSK, Pfizer, Roche clinical trial registries</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">HAND SEARCH</div>
                    <div class="design-item-value">Reference lists, contact authors, experts</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">The PRESS Checklist</h2>
                <p class="animate delay-1" style="font-style: italic; margin-bottom: 1rem;">Peer Review of Electronic Search Strategies</p>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Translation of Research Question</h4>
                    <p>Does the search reflect the PICO elements?</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Boolean and Proximity Operators</h4>
                    <p>Are AND, OR, NOT used correctly?</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Subject Headings</h4>
                    <p>Are MeSH/Emtree terms appropriate and exploded?</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Text Words</h4>
                    <p>Synonyms, spelling variants, truncation?</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">PRESS Checklist (continued)</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">5</div>
                  <div class="lesson-content">
                    <h4>Spelling, Syntax, Line Numbers</h4>
                    <p>Are there errors that would cause retrieval failures?</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">6</div>
                  <div class="lesson-content">
                    <h4>Limits and Filters</h4>
                    <p>Are date, language, study design limits appropriate?</p>
                  </div>
                </div>
                <div class="focus-box animate delay-3 mt-2">
                  <p class="main">Peer-reviewed searches substantially improve retrieval of key studies.</p>
                  <p class="sub">PRESS guideline: McGowan et al., 2016</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">Database Translation</h2>
                <p class="animate delay-1" style="margin-bottom: 1rem;">The same search must be adapted for each database:</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 700px;">
                  <div class="card animate delay-2">
                    <div class="card-label">PubMed</div>
                    <p class="card-text" style="font-family: monospace; font-size: 0.8rem;">"diabetes mellitus, type 2"[MeSH] OR "type 2 diabetes"[tiab]</p>
                  </div>
                  <div class="card animate delay-3">
                    <div class="card-label">Embase</div>
                    <p class="card-text" style="font-family: monospace; font-size: 0.8rem;">'non insulin dependent diabetes mellitus'/exp OR 'type 2 diabetes':ti,ab</p>
                  </div>
                </div>
                <p class="footnote animate delay-4">Subject headings, field tags, and operators differ between databases.</p>
              </div>
            </div>
            <!-- STORY: The Tamiflu Transparency Campaign -->
            <div class="slide dark" data-index="12b">
              <div class="story-box animate">
                <p class="story-opener">What happens when you search  and find nothing?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    Governments stockpiled <span class="data-highlight">$9 billion</span> of oseltamivir (Tamiflu) for pandemic flu.
                    The Cochrane Collaboration tried to review the evidence. Of <span class="data-highlight">77 clinical trials</span>,
                    full reports existed for only <span class="data-highlight">20</span>.
                    Roche refused to share data for <span class="data-highlight">5 years</span>.
                    When the BMJ and Cochrane finally obtained <span class="data-highlight">over 160,000 pages</span> of clinical study reports,
                    they found: Tamiflu reduced symptoms by <span class="data-highlight">less than 1 day</span>,
                    with <span class="data-highlight">no evidence</span> it prevented hospitalizations or complications.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Reviewer's Dilemma: 2009</div>
                  <div class="decision-scenario">
                    You are updating a Cochrane review of Tamiflu. Published trials look positive. But 57 trials have no accessible full reports. What do you do?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Analyze What's Published</div>
                      <div class="path-choice">Use the 20 available trials. Conclude Tamiflu is effective.</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Your review supports continued stockpiling. $9 billion spent on weak evidence.</div>
                      <div class="path-outcome">OUTCOME: Billions wasted, true efficacy unknown</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Demand Complete Data</div>
                      <div class="path-choice">Refuse to publish until all trial data is accessible</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">5-year campaign. 160,000+ pages finally obtained. Truth emerges.</div>
                      <div class="path-outcome">OUTCOME: Evidence policy changed; EMA now publishes all trial reports</div>
                    </div>
                  </div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    A search is only as good as what is findable. When the grey literature is hidden behind corporate walls,
                    even the most comprehensive PubMed search will miss the truth. The Tamiflu saga changed global policy:
                    the EMA now publishes clinical study reports for all medicines.
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="12">
              <p class="closing-line animate">If Nissen had searched only PubMed,</p>
              <p class="closing-line animate delay-1">the signal would have remained hidden.</p>
              <p class="closing-line gold animate delay-2">Comprehensive search is survival.</p>
              <div class="gold-line animate delay-3"></div>
              <p class="closing-line italic animate delay-4">What was hidden in plain sight?</p>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="13">
              <div class="content">
                <h2 class="title navy animate">Module 3 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q3-1">
                    <h4>1. What type of evidence source revealed the rosiglitazone cardiovascular signal?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q3-1', 0, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
                        <span>A.</span> Published journal articles
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q3-1', 1, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
                        <span>B.</span> Cochrane Library
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q3-1', 2, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
                        <span>C.</span> Company clinical trial registry
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q3-1', 3, 2, ['Published trials alone did not reveal the signal.', 'The Cochrane Library compiles existing reviews but did not contain this data.', 'Correct! GSK had posted trial data on their website as part of a legal settlement.', 'FDA approval documents did not contain this analysis.'])">
                        <span>D.</span> FDA approval documents
                      </div>
                    </div>
                    <div id="q3-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q3-2">
                    <h4>2. What does PRESS stand for?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q3-2', 0, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
                        <span>A.</span> Publication Review of Evidence Search Standards
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q3-2', 1, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
                        <span>B.</span> Peer Review of Electronic Search Strategies
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q3-2', 2, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
                        <span>C.</span> Protocol for Reporting Evidence Synthesis Studies
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q3-2', 3, 1, ['This is not what PRESS stands for.', 'Correct! PRESS is a guideline for having search strategies reviewed by a second expert.', 'This is not what PRESS stands for.', 'This is not what PRESS stands for.'])">
                        <span>D.</span> Primary Research Evidence Search System
                      </div>
                    </div>
                    <div id="q3-2-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide black" data-index="14">
              <p class="refrain animate">What was hidden in plain sight?</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 4: The Screening</p>
            </div>
          </div>

          <!-- Module 4: The Screening (Vioxx) -->
          <div class="module-slides" data-module="4">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">The number without provenance is not a number.</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">This is a story about</p>
              <p class="title gold animate delay-1 text-center">what they chose to report.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 4: The Screening</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Apply PRISMA flow diagram to document study selection</li>
                    <li>Implement dual-reviewer screening with conflict resolution</li>
                    <li>Identify selective outcome reporting and data manipulation</li>
                    <li>Calculate inter-rater reliability (Cohen's kappa)</li>
                    <li>Apply the principle: "The number without provenance is not a number"</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <p class="big-number navy animate">88,000</p>
              <p class="subtitle animate delay-1">heart attacks attributed to Vioxx</p>
              <p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">A blockbuster drug. A hidden signal. A preventable catastrophe.</p>
              <div class="gold-line animate delay-3"></div>
              <p class="animate delay-4" style="color: var(--light-text);">Between 1999 and 2004, millions took this painkiller. Some never came home.</p>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Rise of Vioxx</h2>
                <div class="card animate delay-1">
                  <p class="card-text text-center">Rofecoxib (Vioxx) was a COX-2 selective NSAID. Marketed as safer for the stomach than traditional painkillers.</p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">1999</div>
                    <div class="stat-label">FDA approval</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">$2.5B</div>
                    <div class="stat-label">Peak annual sales</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">80M+</div>
                    <div class="stat-label">Patients prescribed</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">The VIGOR Trial (2000)</h2>
                <p class="serif animate delay-1" style="font-style: italic; color: var(--gold); margin-bottom: 1rem;">Vioxx Gastrointestinal Outcomes Research</p>
                <div class="design-grid animate delay-2">
                  <div class="design-item">
                    <div class="design-item-label">Design</div>
                    <div class="design-item-value">Randomized, double-blind</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Comparison</div>
                    <div class="design-item-value">Vioxx vs Naproxen</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Population</div>
                    <div class="design-item-value">Rheumatoid arthritis</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Sample</div>
                    <div class="design-item-value">8,076 patients</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Primary Outcome</div>
                    <div class="design-item-value">GI events</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">Published</div>
                    <div class="design-item-value">NEJM, November 2000</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">What VIGOR Published</h2>
                <table class="results-table animate delay-1">
                  <thead>
                    <tr>
                      <th>GI Outcome</th>
                      <th>Vioxx</th>
                      <th>Naproxen</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Confirmed GI events</td>
                      <td style="color: var(--green);">2.1 per 100 pt-yrs</td>
                      <td>4.5 per 100 pt-yrs</td>
                    </tr>
                    <tr>
                      <td>Reduction</td>
                      <td colspan="2" style="color: var(--green); font-weight: 700;">54% fewer GI events</td>
                    </tr>
                  </tbody>
                </table>
                <div class="card navy-bg animate delay-2">
                  <p class="card-text text-center">The headline: Vioxx is safer for your stomach!</p>
                </div>
                <p class="footnote animate delay-3">This is what doctors were told. This is what patients believed.</p>
              </div>
            </div>
            <div class="slide light" data-index="6">
              <div class="content">
                <h2 class="title navy animate">What VIGOR Buried</h2>
                <table class="results-table animate delay-1">
                  <thead>
                    <tr>
                      <th>CV Outcome</th>
                      <th>Vioxx</th>
                      <th>Naproxen</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Myocardial Infarction</td>
                      <td class="highlight">20 events</td>
                      <td>4 events</td>
                    </tr>
                    <tr>
                      <td>Relative Risk</td>
                      <td colspan="2" class="highlight">5x higher in Vioxx group</td>
                    </tr>
                  </tbody>
                </table>
                <div class="result-box animate delay-2">
                  <div class="value">5-fold Increase in Heart Attacks</div>
                  <div class="label">Mentioned only briefly, attributed to naproxen being "cardioprotective"</div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">The Selective Reporting</h2>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number">1</div>
                  <p><strong>Data cutoff manipulation:</strong> 3 additional heart attacks occurred after the cutoff used in publication</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">2</div>
                  <p><strong>Spin:</strong> CV signal was explained away as naproxen being cardioprotective (no evidence)</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">3</div>
                  <p><strong>Outcome switching:</strong> CV events were pre-specified but not emphasized</p>
                </div>
                <div class="wrong-item animate delay-4">
                  <div class="wrong-number">4</div>
                  <p><strong>Internal knowledge:</strong> Merck emails show they knew about the signal</p>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="8">
              <div class="content">
                <h2 class="title cream animate">The APPROVe Trial (2004)</h2>
                <p class="animate delay-1">A trial for colorectal polyp prevention - stopped early for safety.</p>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">RR 1.92</div>
                    <div class="stat-label">CV events vs placebo</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Sept 2004</div>
                    <div class="stat-label">Vioxx withdrawn</div>
                  </div>
                </div>
                <p class="animate delay-3" style="margin-top: 1.5rem; color: var(--gold); font-style: italic; text-align: center;">
                  Four years after VIGOR showed a 5x risk. Four years too late.
                </p>
              </div>
            </div>
            <!-- STORY: The Vioxx Decision Tree -->
            <div class="slide dark" data-index="8b">
              <div class="story-box animate">
                <p class="story-opener">Have you considered what happens when a signal hides in the noise?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    Vioxx (rofecoxib) was approved in <span class="data-highlight">1999</span>.
                    By <span class="data-highlight">2004</span>, estimates suggest
                    <span class="data-highlight">88,000-140,000 excess heart attacks</span> and
                    <span class="data-highlight">30,000-40,000 deaths</span>.
                    Merck's own VIGOR trial showed <span class="data-highlight">5x cardiovascular risk</span> in 2000but
                    it was dismissed as a "naproxen cardioprotective effect."
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Fork in the Road</div>
                  <div class="decision-scenario">
                    You are an FDA reviewer in 2001. VIGOR data shows 5x heart attack risk with Vioxx vs naproxen.
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Accept the Explanation</div>
                      <div class="path-choice">Believe Merck's hypothesis: naproxen is cardioprotective</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">No additional safety studies required. Drug stays on market at full speed.</div>
                      <div class="path-outcome">OUTCOME: 40,000+ deaths over 4 years</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Demand Evidence</div>
                      <div class="path-choice">Require a dedicated CV safety trial before continued marketing</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Delay or restrict marketing until cardiovascular safety is established.</div>
                      <div class="path-outcome">OUTCOME: Signal detected early, lives saved</div>
                    </div>
                  </div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    The signal was there in 2000. The wrong explanation delayed action by 4 years.
                    An alternative hypothesisaccepted without evidencecost tens of thousands of lives.
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">The PRISMA Flow Diagram</h2>
                <p class="animate delay-1" style="font-style: italic; margin-bottom: 1rem;">Every step of screening must be documented and transparent.</p>
                <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                  <div class="stat-box animate delay-1" style="width: 300px;"><div class="stat-value">Identification</div><div class="stat-label">Records from databases + other sources</div></div>
                  <div class="arrow animate delay-1" style="font-size: 1.5rem;"></div>
                  <div class="stat-box animate delay-2" style="width: 300px;"><div class="stat-value">Screening</div><div class="stat-label">Title/abstract review (duplicates removed)</div></div>
                  <div class="arrow animate delay-2" style="font-size: 1.5rem;"></div>
                  <div class="stat-box animate delay-3" style="width: 300px;"><div class="stat-value">Eligibility</div><div class="stat-label">Full-text assessment (with exclusion reasons)</div></div>
                  <div class="arrow animate delay-3" style="font-size: 1.5rem;"></div>
                  <div class="stat-box animate delay-4" style="width: 300px; background: var(--gold); color: var(--navy);"><div class="stat-value">Included</div><div class="stat-label">Studies in synthesis</div></div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Dual Screening: Why Two Reviewers?</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Reduces Selection Bias</h4>
                    <p>One reviewer might unconsciously favor certain studies</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Catches Errors</h4>
                    <p>Fatigue, misreading, and mistakes are inevitable</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Forces Explicit Criteria</h4>
                    <p>Disagreements reveal ambiguity in inclusion rules</p>
                  </div>
                </div>
                <div class="focus-box animate delay-4 mt-2">
                  <p class="main">Typical agreement:  = 0.6-0.8</p>
                  <p class="sub">Disagreements resolved by discussion or third reviewer</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">Calibration: The Pilot Phase</h2>
                <div class="card animate delay-1">
                  <p class="card-text text-center">Before screening thousands of records, reviewers should calibrate on a sample of 50-100 records.</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">1</div>
                  <p>Screen the same set independently</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">2</div>
                  <p>Compare decisions and discuss disagreements</p>
                </div>
                <div class="wrong-item animate delay-4">
                  <div class="wrong-number">3</div>
                  <p>Refine inclusion criteria until  > 0.7</p>
                </div>
                <div class="wrong-item animate delay-5">
                  <div class="wrong-number">4</div>
                  <p>Document the calibration process and any rule changes</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="12">
              <div class="content">
                <h2 class="title navy animate">PRISMA 2020 Updates</h2>
                <div class="design-grid animate delay-1" style="grid-template-columns: 1fr 1fr;">
                  <div class="design-item">
                    <div class="design-item-label">New in 2020</div>
                    <div class="design-item-value">Separate reporting of database vs register searches</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">New in 2020</div>
                    <div class="design-item-value">Automation tools must be reported</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">New in 2020</div>
                    <div class="design-item-value">Citation searching documented separately</div>
                  </div>
                  <div class="design-item">
                    <div class="design-item-label">New in 2020</div>
                    <div class="design-item-value">Reasons for exclusion at full-text mandatory</div>
                  </div>
                </div>
                <p class="footnote animate delay-2">PRISMA 2020 substantially revised the checklist with expanded reporting on synthesis methods, certainty assessment, and protocol registration.</p>
              </div>
            </div>
            <div class="slide dark" data-index="13">
              <p class="closing-line animate">If Vioxx's cardiovascular data had been screened by independent reviewers,</p>
              <p class="closing-line animate delay-1">if all pre-specified outcomes had been required to be reported,</p>
              <p class="closing-line gold animate delay-2">88,000 heart attacks might have been prevented.</p>
              <div class="gold-line animate delay-3"></div>
              <p class="closing-line italic animate delay-4">The number without provenance is not a number.</p>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="14">
              <div class="content">
                <h2 class="title navy animate">Module 4 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q4-1">
                    <h4>1. In the VIGOR trial, what was the relative risk of MI in the Vioxx group compared to naproxen?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q4-1', 0, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
                        <span>A.</span> 1.5x higher
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q4-1', 1, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
                        <span>B.</span> 2x higher
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q4-1', 2, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
                        <span>C.</span> 5x higher
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q4-1', 3, 2, ['The risk was much higher than 1.5x.', 'The risk was higher than 2x.', 'Correct! 20 events vs 4 events = 5-fold higher risk.', 'The risk increase was substantial, not 10x.'])">
                        <span>D.</span> 10x higher
                      </div>
                    </div>
                    <div id="q4-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q4-2">
                    <h4>2. Why is dual screening (two independent reviewers) important?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q4-2', 0, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
                        <span>A.</span> It makes screening faster
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q4-2', 1, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
                        <span>B.</span> It reduces selection bias and catches errors
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q4-2', 2, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
                        <span>C.</span> It reduces the number of studies to review
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q4-2', 3, 1, ['Speed is not the primary goal of dual screening.', 'Correct! Dual screening reduces individual bias and catches errors.', 'Dual screening adds work, not reduces it.', 'This is backwards - dual screening improves quality.'])">
                        <span>D.</span> It allows reviewers to skip full-text review
                      </div>
                    </div>
                    <div id="q4-2-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide black" data-index="15">
              <p class="refrain animate">The number without provenance is not a number.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 5: The Extraction</p>
            </div>
          </div>

          <!-- Module 5: The Extraction (DECREASE) -->
          <div class="module-slides" data-module="5">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">The number without provenance is not a number.</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">This is a story about</p>
              <p class="title gold animate delay-1 text-center">numbers that never existed.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 5: The Extraction</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Design a standardized data extraction form with provenance fields</li>
                    <li>Calculate effect sizes from various reported statistics (OR, RR, HR, SMD)</li>
                    <li>Implement dual-extraction with discrepancy resolution</li>
                    <li>Identify red flags for data fabrication and misconduct</li>
                    <li>Explain how the DECREASE fraud affected clinical guidelines</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <p class="big-number navy animate">~10,000</p>
              <p class="subtitle animate delay-1">possible excess deaths in Europe</p>
              <p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">From guidelines based on fabricated clinical trial data.</p>
              <div class="gold-line animate delay-3"></div>
              <p class="animate delay-4" style="color: var(--light-text);">The DECREASE trials influenced perioperative care worldwide. The data was invented.</p>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">Don Poldermans: A Star Researcher</h2>
                <div class="card animate delay-1">
                  <p class="card-text text-center">Professor at Erasmus Medical Center, Rotterdam. Author of over 500 papers. Lead author of ESC guidelines on perioperative cardiac care.</p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">500+</div>
                    <div class="stat-label">Publications</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">DECREASE</div>
                    <div class="stat-label">Trial series I-VI</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">ESC</div>
                    <div class="stat-label">Guideline chair</div>
                  </div>
                </div>
                <p class="footnote animate delay-3">A seemingly unimpeachable source. Until someone looked at the data.</p>
              </div>
            </div>
            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">The DECREASE Trials: The Claim</h2>
                <table class="results-table animate delay-1">
                  <thead>
                    <tr>
                      <th>Trial</th>
                      <th>Finding</th>
                      <th>Impact</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>DECREASE-I (1999)</td>
                      <td>90% reduction in cardiac death</td>
                      <td>Changed guidelines</td>
                    </tr>
                    <tr>
                      <td>DECREASE-IV (2009)</td>
                      <td>Beta-blockers safe in low-risk</td>
                      <td>Expanded recommendations</td>
                    </tr>
                  </tbody>
                </table>
                <div class="focus-box animate delay-2 mt-2">
                  <p class="main">Effect sizes were implausibly large.</p>
                  <p class="sub">90% reduction? Almost nothing in medicine works that well.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">The Investigation: 2011</h2>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number">1</div>
                  <p>Erasmus MC investigated after whistleblower complaints</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">2</div>
                  <p><strong>Fabricated patient data:</strong> Patients who didn't exist or weren't enrolled</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">3</div>
                  <p><strong>No informed consent:</strong> Many "participants" never consented</p>
                </div>
                <div class="wrong-item animate delay-4">
                  <div class="wrong-number">4</div>
                  <p><strong>Poldermans dismissed:</strong> From Erasmus MC in 2011</p>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="6">
              <div class="content">
                <h2 class="title cream animate">The Cascade of Harm</h2>
                <p class="animate delay-1" style="margin-bottom: 1rem;">When DECREASE was removed from meta-analyses...</p>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">Benefit  Harm</div>
                    <div class="stat-label">Direction reversed</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">27% </div>
                    <div class="stat-label">Stroke risk increase</div>
                  </div>
                </div>
                <p class="animate delay-3" style="margin-top: 1.5rem; color: var(--gold); font-style: italic; text-align: center;">
                  The POISE trial (2008) had shown harm. It was dismissed because it conflicted with DECREASE.
                </p>
              </div>
            </div>
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">Why Wasn't This Caught?</h2>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number">1</div>
                  <p><strong>Trust in authority:</strong> Poldermans was the guideline author reviewing his own evidence</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">2</div>
                  <p><strong>No data verification:</strong> No one asked for individual patient data</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">3</div>
                  <p><strong>Publication prestige:</strong> Published in top journals, assumed valid</p>
                </div>
                <div class="wrong-item animate delay-4">
                  <div class="wrong-number">4</div>
                  <p><strong>Implausible effects accepted:</strong> 90% reductions should raise suspicion</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">Data Extraction: Defense Against Fraud</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Dual Extraction</h4>
                    <p>Two extractors independently - catches transcription errors and forces scrutiny</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Record Provenance</h4>
                    <p>Table, page, paragraph - every number traceable to source</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Verify Against Registry</h4>
                    <p>ClinicalTrials.gov results vs publication - discrepancies are red flags</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Request IPD</h4>
                    <p>Individual patient data reveals what aggregate summaries hide</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Effect Size Calculation</h2>
                <p class="animate delay-1" style="margin-bottom: 1rem;">During extraction, you calculate effect sizes from reported data:</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 700px;">
                  <div class="card animate delay-2">
                    <div class="card-label">BINARY OUTCOMES</div>
                    <p class="card-text" style="font-size: 0.85rem;">Odds Ratio, Risk Ratio, Risk Difference from 2x2 tables</p>
                  </div>
                  <div class="card animate delay-3">
                    <div class="card-label">CONTINUOUS OUTCOMES</div>
                    <p class="card-text" style="font-size: 0.85rem;">Mean Difference, Standardized Mean Difference from means and SDs</p>
                  </div>
                </div>
                <div class="focus-box animate delay-4 mt-2">
                  <p class="main">Always extract from the most reliable source.</p>
                  <p class="sub">Prefer: ITT results > per-protocol > subgroups</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Red Flags During Extraction</h2>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number">!</div>
                  <p><strong>Implausible effect sizes:</strong> 80-90% reductions should prompt scrutiny</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">!</div>
                  <p><strong>Baseline imbalances:</strong> Groups that are "too perfectly" matched</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">!</div>
                  <p><strong>Round numbers:</strong> "Exactly 50" or "exactly 100" patients per arm</p>
                </div>
                <div class="wrong-item animate delay-4">
                  <div class="wrong-number">!</div>
                  <p><strong>Registry discrepancies:</strong> Published N differs from registered N</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="11c" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Effect Size Conversions</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Studies report results in different metrics. To pool them, you often need conversions:
                  </p>
                </div>
                <table class="results-table animate delay-2" style="font-size: 0.9rem;">
                  <thead><tr><th>From</th><th>To</th><th>Formula</th></tr></thead>
                  <tbody>
                    <tr><td>SMD (d)</td><td>log-OR</td><td>log-OR = d &times; &pi; / &radic;3</td></tr>
                    <tr><td>log-OR</td><td>SMD (d)</td><td>d = log-OR &times; &radic;3 / &pi;</td></tr>
                    <tr><td>Correlation (r)</td><td>Fisher z</td><td>z = 0.5 &times; ln((1+r)/(1&minus;r))</td></tr>
                    <tr><td>OR</td><td>RR</td><td>RR = OR / (1 &minus; P + P &times; OR)</td></tr>
                    <tr><td>OR</td><td>NNT</td><td>NNT = 1 / (P &minus; OR&times;P / (1&minus;P+OR&times;P))</td></tr>
                  </tbody>
                </table>
                <p class="footnote animate delay-3">
                  P = baseline risk in the control group. These formulas assume approximate conditions;
                  see Borenstein et al. (Ch. 7) for exact derivations.
                </p>
              </div>
            </div>

            <div class="slide light" data-index="11d" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Time-to-Event (Survival) Data</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Many trials report time-to-event outcomes using <strong>hazard ratios</strong> (HR).
                    Pooling HRs in meta-analysis requires special handling:
                  </p>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>The log(HR) + SE Method</h4>
                    <p>
                      Extract log(HR) and its SE from the trial. If not reported, derive SE from the CI:
                      SE = (ln(upper) &minus; ln(lower)) / (2 &times; 1.96). Pool using standard inverse-variance methods.
                    </p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>When HR Is Not Reported</h4>
                    <p>
                      Methods exist to reconstruct IPD from Kaplan&ndash;Meier curves (Guyot et al. 2012)
                      or estimate HR from p-values and event counts (Parmar et al. 1998). Always
                      prefer the directly reported adjusted HR when available.
                    </p>
                  </div>
                </div>
                <p class="footnote animate delay-4">
                  HR &lt; 1 favors treatment; HR &gt; 1 favors control.
                  Do <strong>not</strong> convert HRs to ORs or RRs&mdash;they measure fundamentally different quantities.
                </p>
              </div>
            </div>

            <!-- STORY: The Boldt Colloid Scandal -->
            <div class="slide dark" data-index="11b">
              <div class="story-box animate">
                <p class="story-opener">What if the data you extract was never real?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    Joachim Boldt was the most prolific researcher in anesthesia fluid management.
                    Over <span class="data-highlight">180 of his publications were retracted</span>  one of the largest
                    retraction cases in medical history. His fabricated data showed hydroxyethyl starch (HES)
                    was safe. Meta-analyses that included his studies concluded HES was harmless.
                    When Boldt's studies were removed, <span class="data-highlight">the pooled effect reversed</span>:
                    HES increased <span class="data-highlight">kidney injury by 59%</span> (RR 1.59, 95% CI 1.26-2.00)
                    and <span class="data-highlight">mortality by ~9%</span> (RR 1.09). An estimated
                    <span class="data-highlight">thousands of patients</span> received a harmful fluid based on fabricated evidence.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Extractor's Vigilance: 2010</div>
                  <div class="decision-scenario">
                    You are extracting data for a fluid resuscitation meta-analysis. Boldt's studies dominate the literature (90+ papers). A whistleblower has raised concerns. What do you do?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Extract as Published</div>
                      <div class="path-choice">Trust peer-reviewed publications. Extract Boldt's data like any other.</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Your meta-analysis shows HES is safe. Guidelines recommend it.</div>
                      <div class="path-outcome">OUTCOME: Thousands receive a nephrotoxic fluid</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Verify Provenance</div>
                      <div class="path-choice">Cross-check ethics approvals, request source data, conduct sensitivity analysis excluding suspicious studies</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Discover missing ethics approvals. Flag studies. Re-analyze without them.</div>
                      <div class="path-outcome">OUTCOME: True signal emerges  HES causes harm</div>
                    </div>
                  </div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    Provenance is not bureaucracy. It is the difference between evidence and fiction.
                    Every extracted number must trace to an ethics-approved study, with verifiable patient data.
                    Without provenance, the number without an owner can become a weapon.
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="11">
              <p class="closing-line animate">Every number in your meta-analysis</p>
              <p class="closing-line animate delay-1">must trace back to a verifiable source.</p>
              <p class="closing-line gold animate delay-2">The number without provenance is not a number.</p>
              <div class="gold-line animate delay-3"></div>
              <p class="closing-line italic animate delay-4">Fraudulent data can kill as surely as fraudulent drugs.</p>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="12">
              <div class="content">
                <h2 class="title navy animate">Module 5 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q5-1">
                    <h4>1. What happened when DECREASE trial data was removed from beta-blocker meta-analyses?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q5-1', 0, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
                        <span>A.</span> The benefit became even larger
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q5-1', 1, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
                        <span>B.</span> No change in conclusions
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q5-1', 2, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
                        <span>C.</span> The direction reversed to show potential harm
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q5-1', 3, 2, ['DECREASE data inflated benefits, not reduced them.', 'The effect size changed substantially.', 'Correct! Without DECREASE, the remaining evidence showed potential harm, not benefit.', 'The findings were not unchanged.'])">
                        <span>D.</span> Results became inconclusive
                      </div>
                    </div>
                    <div id="q5-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q5-2">
                    <h4>2. Why should dual extraction be standard practice?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q5-2', 0, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
                        <span>A.</span> It catches transcription errors and forces scrutiny
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q5-2', 1, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
                        <span>B.</span> It makes extraction faster
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q5-2', 2, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
                        <span>C.</span> It helps find more studies
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q5-2', 3, 0, ['Correct! Dual extraction catches errors and forces careful scrutiny of each data point.', 'Dual extraction is about accuracy, not speed.', 'Dual extraction is about data quality, not detection.', 'Dual extraction adds work but improves quality.'])">
                        <span>D.</span> It reduces the amount of work needed
                      </div>
                    </div>
                    <div id="q5-2-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide black" data-index="13">
              <p class="refrain animate">The number without provenance is not a number.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 6: The Bias</p>
            </div>
          </div>

          <!-- Module 6: The Bias (Aprotinin/BART) -->
          <div class="module-slides" data-module="6">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Methods protect patients from our confidence.</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">This is a story about</p>
              <p class="title gold animate delay-1 text-center">the bias we cannot see.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 6: The Bias</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Apply Risk of Bias 2.0 (RoB 2) to randomized trials</li>
                    <li>Apply ROBINS-I to non-randomized studies</li>
                    <li>Assess all five RoB 2 domains (randomization, deviations, missing data, measurement, selection)</li>
                    <li>Distinguish confounding by indication from true treatment effects</li>
                    <li>Explain how BART revealed hidden harms of aprotinin</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <p class="big-number navy animate">20+</p>
              <p class="subtitle animate delay-1">years on the market</p>
              <p class="serif animate delay-2" style="font-size: 1.25rem; font-style: italic; color: var(--text);">Aprotinin was the gold standard for reducing surgical bleeding.</p>
              <div class="gold-line animate delay-3"></div>
              <p class="animate delay-4" style="color: var(--light-text);">Then someone ran an RCT. The truth was different.</p>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Hidden Bias: Confounding by Indication</h2>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number">1</div>
                  <p><strong>Sicker patients got aprotinin:</strong> Surgeons used it in complex, high-risk cases</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">2</div>
                  <p><strong>Survivors bias:</strong> Dead patients can't report complications</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">3</div>
                  <p><strong>Publication bias:</strong> Negative studies weren't published</p>
                </div>
                <div class="focus-box animate delay-4 mt-2">
                  <p class="main">Observational studies could not separate the drug's effect from the patient's baseline risk.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">BART: The Randomized Truth</h2>
                <p class="red animate delay-1" style="font-style: italic; margin-bottom: 1rem;">Blood Conservation Using Antifibrinolytics in a Randomized Trial</p>
                <table class="results-table animate delay-2">
                  <thead><tr><th>Outcome</th><th>Aprotinin</th><th>Alternatives</th></tr></thead>
                  <tbody>
                    <tr><td>30-day mortality</td><td class="highlight">6.0%</td><td>3.9%</td></tr>
                    <tr><td>Relative Risk</td><td colspan="2" class="highlight">1.53 (53% increased death)</td></tr>
                  </tbody>
                </table>
                <div class="result-box animate delay-3">
                  <div class="value">Trial Stopped Early for Harm</div>
                  <div class="label">Withdrawn from market November 2007</div>
                </div>
              </div>
            </div>
            <!-- Investigation Exercise -->
            <div class="slide dark" data-index="5">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Investigation: Assess the Bias</h3>
                </div>
                <p class="direct-address">You are reviewing the observational studies. Apply Risk of Bias thinking:</p>
                <table class="data-table-investigation">
                  <thead><tr><th>Question</th><th>Observational</th><th>BART (RCT)</th></tr></thead>
                  <tbody>
                    <tr><td>Random allocation?</td><td> Surgeon choice</td><td> Yes</td></tr>
                    <tr><td>Baseline comparable?</td><td> Sicker got drug</td><td> Balanced</td></tr>
                    <tr><td>Blinding?</td><td> Open label</td><td> Double-blind</td></tr>
                  </tbody>
                </table>
                <button class="reveal-btn" onclick="revealAnswer('bias-reveal')">See the Key Insight </button>
                <div id="bias-reveal" class="hidden-reveal">
                  <p><strong>Confounding by indication:</strong> Surgeons gave aprotinin to the sickest patients. The observational studies attributed survival to the drug, when they were measuring survivorship bias.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="6">
              <div class="content">
                <h2 class="title navy animate">Risk of Bias 2.0: The Five Domains</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">D1</div>
                  <div class="lesson-content"><h4>Randomization Process</h4></div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">D2</div>
                  <div class="lesson-content"><h4>Deviations from Intended Interventions</h4></div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">D3</div>
                  <div class="lesson-content"><h4>Missing Outcome Data</h4></div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">D4</div>
                  <div class="lesson-content"><h4>Measurement of the Outcome</h4></div>
                </div>
                <div class="lesson-item animate delay-5">
                  <div class="lesson-number">D5</div>
                  <div class="lesson-content"><h4>Selection of the Reported Result</h4></div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">ROBINS-I: For Non-Randomized Studies</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">When RCTs are unavailable, use ROBINS-I (Risk Of Bias In Non-randomized Studies of Interventions)</p>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #7c3aed;">1</div>
                  <div class="lesson-content"><h4>Confounding</h4><p>Baseline differences between groups</p></div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #7c3aed;">2</div>
                  <div class="lesson-content"><h4>Selection of Participants</h4><p>Exclusions related to intervention</p></div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background: #7c3aed;">3</div>
                  <div class="lesson-content"><h4>Classification of Interventions</h4><p>Misclassification of exposure status</p></div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background: #7c3aed;">4</div>
                  <div class="lesson-content"><h4>Deviations from Intended Interventions</h4><p>Co-interventions, contamination</p></div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background: #7c3aed;">5</div>
                  <div class="lesson-content"><h4>Missing Data</h4><p>Differential loss to follow-up</p></div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background: #7c3aed;">6</div>
                  <div class="lesson-content"><h4>Measurement of Outcomes</h4><p>Ascertainment bias</p></div>
                </div>
                <div class="lesson-item animate delay-5">
                  <div class="lesson-number" style="background: #7c3aed;">7</div>
                  <div class="lesson-content"><h4>Selection of Reported Result</h4><p>Selective reporting</p></div>
                </div>
                <p class="footnote animate delay-5" style="margin-top: 1rem;">Ratings: Low / Moderate / Serious / Critical / No information</p>
              </div>
            </div>
            <!-- STORY: The Aprotinin BART Trial -->
            <div class="slide dark" data-index="8b">
              <div class="story-box animate">
                <p class="story-opener">What happens when 64 studies agree  and they are all wrong?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    Aprotinin was used in cardiac surgery to reduce bleeding for <span class="data-highlight">20 years</span>.
                    <span class="data-highlight">64 small randomized trials</span> suggested it was safe and effective.
                    Meta-analyses confirmed benefit. Then the <span class="data-highlight">BART trial</span> (2008)
                    randomized <span class="data-highlight">2,331 patients</span>: aprotinin vs. tranexamic acid vs. aminocaproic acid.
                    Result: aprotinin increased <span class="data-highlight">mortality by 53%</span> (RR 1.53, 95% CI 1.06-2.22).
                    The trial was <span class="data-highlight">stopped early for harm</span>.
                    Bayer withdrew aprotinin from the market within months.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Surgeon's Evidence: 2006</div>
                  <div class="decision-scenario">
                    You are a cardiac surgeon choosing an antifibrinolytic. 64 small trials favor aprotinin, but none were powered to detect mortality. A large RCT (BART) is enrolling. Do you wait?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Trust the Meta-Analysis</div>
                      <div class="path-choice">64 trials can't all be wrong. Continue prescribing aprotinin.</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Small trials measured bleeding, not death. None had adequate power for mortality. The meta-analysis pooled underpowered surrogate results.</div>
                      <div class="path-outcome">OUTCOME: Excess deaths in cardiac surgery patients</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Assess Risk of Bias First</div>
                      <div class="path-choice">Rate all 64 trials with RoB. Notice they are small, use surrogate outcomes, and have high attrition. Wait for the adequately powered RCT.</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">BART reveals the truth. Switch to safer alternatives.</div>
                      <div class="path-outcome">OUTCOME: Lives saved by demanding adequately powered evidence</div>
                    </div>
                  </div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    The quantity of evidence does not equal quality. Sixty-four underpowered trials measuring the wrong outcome do not outweigh one adequately powered trial measuring mortality.
                    Risk of bias assessment is not a formality  it is the shield between patients and misleading conclusions from small, surrogate-driven evidence.
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="8">
              <p class="closing-line animate">Sixty-four small trials measured bleeding, not death.</p>
              <p class="closing-line animate delay-1">One adequately powered trial revealed 53% increased mortality.</p>
              <p class="closing-line gold animate delay-2">Quantity of evidence cannot substitute for quality and power.</p>
              <div class="gold-line animate delay-3"></div>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Module 6 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q6-1">
                    <h4>1. Why did 64 small trials miss aprotinin's harm?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q6-1', 0, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
                        <span>A.</span> Underpowered for mortality; used surrogate outcomes
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q6-1', 1, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
                        <span>B.</span> Confounding by indication
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q6-1', 2, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
                        <span>C.</span> Outcome measured incorrectly
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q6-1', 3, 0, ['Correct! Small trials measured surrogate outcomes (bleeding) without adequate power to detect mortality differences.', 'They were randomized, though too small for mortality. The issue was power and outcome choice.', 'Outcomes were measured, but the wrong ones for safety.', 'Duration was adequate for bleeding, not for detecting rare harms.'])">
                        <span>D.</span> Follow-up too short
                      </div>
                    </div>
                    <div id="q6-1-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide black" data-index="9">
              <p class="refrain animate">Methods protect patients from our confidence.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 7: The Synthesis</p>
            </div>
          </div>

          <!-- Module 7: The Synthesis (Magnesium/ISIS-4) -->
          <div class="module-slides" data-module="7">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Heterogeneity is a message, not noise.</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">The Magnesium Controversy: 1991-1995</p>
              <p class="title gold animate delay-1 text-center">When pooling leads us astray.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 7: The Synthesis</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Calculate pooled effect sizes using fixed-effect and random-effects models</li>
                    <li>Choose between DerSimonian-Laird and HKSJ estimators appropriately</li>
                    <li>Interpret forest plots including weights, confidence intervals, and diamonds</li>
                    <li>Explain why small-study effects can mislead meta-analyses</li>
                    <li>Apply the principle: "Heterogeneity is a message, not noise"</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Year: 1991</h2>
                <p class="direct-address animate delay-1">
                  "You stand at the crossroads of hope and evidence..."
                </p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    Heart disease kills more people worldwide than any other cause.
                    In 1991, a new hope emerges: Could something as simple and cheap as
                    <strong>intravenous magnesium</strong> save lives after myocardial infarction?
                  </p>
                </div>
                <div class="focus-box animate delay-3 mt-2">
                  <p class="main">The biological rationale was sound:</p>
                  <p class="sub">Magnesium stabilizes cardiac membranes, prevents arrhythmias, and vasodilates coronary arteries.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">LIMIT-2: The Landmark Trial</h2>
                <p class="animate delay-1" style="font-style: italic;">Leicester Intravenous Magnesium Intervention Trial, 1992</p>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">2,316</div>
                    <div class="stat-label">Patients enrolled</div>
                  </div>
                  <div class="stat-box" style="background: rgba(34, 197, 94, 0.2); border-color: #22c55e;">
                    <div class="stat-value">24%</div>
                    <div class="stat-label">Mortality reduction</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">p = 0.04</div>
                    <div class="stat-label">Statistically significant</div>
                  </div>
                </div>
                <div class="focus-box animate delay-3 mt-2">
                  <p class="main">A cheap, safe intervention that could save 250,000 lives per year globally.</p>
                  <p class="sub">The medical community was electrified.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">The Meta-Analysis: 1993</h2>
                <p class="animate delay-1">Researchers pooled <strong>seven randomized trials</strong> of IV magnesium in MI:</p>
                <table class="results-table animate delay-2">
                  <thead>
                    <tr>
                      <th>Trial</th>
                      <th>Year</th>
                      <th>N</th>
                      <th>Odds Ratio</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td>Morton 1984</td><td>1984</td><td>40</td><td style="color: var(--green);">0.10</td></tr>
                    <tr><td>Rasmussen 1986</td><td>1986</td><td>273</td><td style="color: var(--green);">0.35</td></tr>
                    <tr><td>Smith 1986</td><td>1986</td><td>400</td><td style="color: var(--green);">0.48</td></tr>
                    <tr><td>Abraham 1987</td><td>1987</td><td>94</td><td>0.87</td></tr>
                    <tr><td>Shechter 1990</td><td>1990</td><td>103</td><td style="color: var(--green);">0.27</td></tr>
                    <tr><td>Ceremuzynski 1989</td><td>1989</td><td>48</td><td style="color: var(--green);">0.22</td></tr>
                    <tr><td>LIMIT-2</td><td>1992</td><td>2,316</td><td style="color: var(--green);">0.74</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="slide dark" data-index="5">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Investigation Exercise: The Meta-Analyst's Dilemma</h3>
                </div>
                <p class="direct-address">
                  You are a Cochrane reviewer in 1993. You have been asked to synthesize the evidence on magnesium for MI.
                  The data from seven trials sits before you.
                </p>
                <p class="rhetorical" style="margin: 1rem 0;">
                  Do you see the pattern in this forest plot?
                </p>
                <div id="magnesium-forest-small" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                  <button class="reveal-btn" onclick="drawMagnesiumForest('small')">Generate Forest Plot </button>
                  <button class="reveal-btn" onclick="revealAnswer('mag-pooled')">Pool the Evidence </button>
                </div>
                <div id="mag-pooled" class="hidden-reveal">
                  <div class="result-box" style="background: rgba(34, 197, 94, 0.2); border-color: #22c55e;">
                    <div class="value">Pooled OR = 0.44 (95% CI: 0.270.71)</div>
                    <div class="label">55% mortality reduction! Publish in the Lancet?</div>
                  </div>
                  <p style="text-align: center; margin-top: 1rem; font-style: italic;">
                    But wait... do you notice anything about the trial sizes?
                  </p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="6">
              <div class="content">
                <h2 class="title navy animate">The Warning Signs</h2>
                <p class="rhetorical animate">What should have given us pause?</p>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number">1</div>
                  <p><strong>Small sample sizes:</strong> Six of seven trials had &lt;500 patients</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number">2</div>
                  <p><strong>Extreme effects:</strong> OR of 0.10 (90% reduction) is implausible for any drug</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number">3</div>
                  <p><strong>All positive:</strong> Where were the negative trials? The file drawer problem...</p>
                </div>
                <div class="wrong-item animate delay-4">
                  <div class="wrong-number">4</div>
                  <p><strong>Funnel asymmetry:</strong> Small trials showed much larger effects than larger ones</p>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="7">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>The Funnel Plot Test</h3>
                </div>
                <p class="direct-address">
                  Before we pool, we must check for publication bias. Let us examine the funnel plot.
                </p>
                <div id="magnesium-funnel-small" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
                <button class="reveal-btn" onclick="drawMagnesiumFunnel('small')">Generate Funnel Plot </button>
                <div id="mag-funnel-interpretation" style="display: none; margin-top: 1rem;">
                  <div class="focus-box" style="border-color: #f59e0b;">
                    <p class="main" style="color: #f59e0b;"> Asymmetric Funnel</p>
                    <p class="sub">Small trials cluster on the left (showing benefit). Where are the small negative trials?</p>
                    <p class="sub">Egger's test p = 0.04  statistically significant asymmetry.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">The Year: 1995  ISIS-4 Reports</h2>
                <p class="direct-address animate delay-1">
                  "And then came the truth..."
                </p>
                <div class="card animate delay-2">
                  <p class="card-text text-center">
                    The <strong>Fourth International Study of Infarct Survival (ISIS-4)</strong>
                    enrolled 58,050 patients across 1,086 hospitals in 31 countries.
                  </p>
                </div>
                <div class="stats-grid animate delay-3">
                  <div class="stat-box">
                    <div class="stat-value">58,050</div>
                    <div class="stat-label">Patients</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">2,216</div>
                    <div class="stat-label">Deaths in Mg group</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">2,103</div>
                    <div class="stat-label">Deaths in placebo</div>
                  </div>
                </div>
                <div class="result-box animate delay-4" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
                  <div class="value">OR = 1.06 (95% CI: 1.001.12)</div>
                  <div class="label">No benefit. If anything, a trend toward harm.</div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="9">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Before and After: The Complete Picture</h3>
                </div>
                <p class="direct-address">
                  Watch what happens when we add the mega-trial to our forest plot...
                </p>
                <div class="comparison-grid" style="margin-top: 1rem;">
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">BEFORE ISIS-4</h4>
                    <p>7 small trials (N = 3,274)</p>
                    <p style="color: #22c55e; font-weight: bold;">OR = 0.44</p>
                    <p style="font-size: 0.9rem;">Strong benefit signal</p>
                  </div>
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">AFTER ISIS-4</h4>
                    <p>8 trials (N = 61,324)</p>
                    <p style="color: #C53030; font-weight: bold;">OR = 1.02</p>
                    <p style="font-size: 0.9rem;">No effect</p>
                  </div>
                </div>
                <div id="magnesium-forest-full" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
                <button class="reveal-btn" onclick="drawMagnesiumForest('full')">Show Complete Forest Plot </button>
              </div>
            </div>
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Why Did Small Trials Mislead?</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Publication Bias</h4>
                    <p>Small negative trials were never publishedthey sat in file drawers</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Small-Study Effects</h4>
                    <p>Smaller trials tend to show larger effects due to methodological weaknesses</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Random High Bias</h4>
                    <p>By chance, some small trials hit extreme resultsand those get published</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Random-Effects Amplification</h4>
                    <p>Random-effects models give more weight to small trials, amplifying bias</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">Fixed vs. Random Effects</h2>
                <p class="rhetorical animate">Which model should you choose?</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 850px;" class="animate delay-1">
                  <div class="card" style="border-left: 4px solid #3b82f6;">
                    <div class="card-label">FIXED EFFECT MODEL</div>
                    <p class="card-text">Assumes <strong>one true effect</strong>. Weights studies by inverse variance (precision). Large trials dominate.</p>
                    <p style="font-size: 0.85rem; color: var(--navy); margin-top: 0.5rem;">
                      <strong>Magnesium result:</strong> OR = 0.96 (p = 0.52)
                    </p>
                  </div>
                  <div class="card" style="border-left: 4px solid #f59e0b;">
                    <div class="card-label">RANDOM EFFECTS MODEL</div>
                    <p class="card-text">Assumes <strong>distribution of effects</strong>. Gives more weight to small trials. Wider confidence intervals.</p>
                    <p style="font-size: 0.85rem; color: var(--navy); margin-top: 0.5rem;">
                      <strong>Magnesium result:</strong> OR = 0.59 (p = 0.01)
                    </p>
                  </div>
                </div>
                <div class="focus-box animate delay-2 mt-2" style="border-color: #f59e0b;">
                  <p class="main" style="color: #f59e0b;"> The model choice determined the conclusion!</p>
                  <p class="sub">Random effects does not fix bias; with small-study effects, it may shift weight toward smaller trials and change conclusions.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="12">
              <div class="content">
                <h2 class="title navy animate">The Lessons of Magnesium</h2>
                <div class="card animate delay-1">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>1. Check for publication bias</strong> before trusting a pooled estimate.
                    Use funnel plots and Egger's test when study count is sufficient (about 10 or more), and interpret asymmetry in context.
                  </p>
                </div>
                <div class="card animate delay-2">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>2. Be wary of small-study effects.</strong> If only small trials show benefit,
                    wait for a large, well-conducted trial.
                  </p>
                </div>
                <div class="card animate delay-3">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>3. Model choice matters.</strong> Random effects does not repair biased evidence.
                    Compare prespecified sensitivity analyses (fixed, random, influence analysis) and explain why conclusions are robust.
                  </p>
                </div>
                <div class="card animate delay-4">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>4. One large trial can overturn many small ones.</strong>
                    This is why mega-trials like ISIS-4 are so valuable.
                  </p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="12c" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Special Study Designs in Meta-Analysis</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Not all RCTs use standard parallel-group designs. Two common alternatives require
                    special handling when pooling results:
                  </p>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Cluster-Randomized Trials</h4>
                    <p>
                      Randomize groups (hospitals, schools), not individuals. The <strong>design effect</strong>
                      = 1 + (m&minus;1) &times; ICC reduces the effective sample size. Divide N by the design
                      effect before pooling, or use the adjusted SE from the trial. Ignoring clustering
                      produces artificially narrow CIs.
                    </p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Crossover Trials</h4>
                    <p>
                      Each patient receives both treatments. The paired design reduces variance, but
                      you need the <strong>within-patient correlation</strong> (or the paired analysis SE) to pool correctly.
                      Using the parallel-group SE is conservative; using the wrong N double-counts patients.
                    </p>
                  </div>
                </div>
                <p class="footnote animate delay-4">See Cochrane Handbook v6.4, Chapter 23 for detailed formulas and worked examples.</p>
              </div>
            </div>

            <!-- STORY: The Early Surfactant Reversal -->
            <div class="slide dark" data-index="12b">
              <div class="story-box animate">
                <p class="story-opener">What if the way you combine studies determines whether a treatment looks life-saving or useless?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    Early surfactant for premature babies was supported by <span class="data-highlight">6 small trials</span>
                    showing <span class="data-highlight">reduced mortality</span> (RR 0.84).
                    A <span class="data-highlight">fixed-effect meta-analysis</span> confirmed benefit (p=0.04).
                    But a <span class="data-highlight">random-effects model</span> showed no significance (p=0.12)
                     the confidence interval crossed 1.0.
                    Later, <span class="data-highlight">SUPPORT (2010)</span> and <span class="data-highlight">VON (2012)</span>,
                    two large pragmatic trials with <span class="data-highlight">~2,000 neonates</span> combined,
                    found <span class="data-highlight">no benefit</span> of early vs. later surfactant.
                    Clinical practice had been changed based on small trials and the wrong model.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Neonatologist's Model Choice: 2005</div>
                  <div class="decision-scenario">
                    You are updating a Cochrane review of early surfactant. Six small trials show benefit with a fixed-effect model. The random-effects model is non-significant. Which do you report?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Report Fixed-Effect Only</div>
                      <div class="path-choice">Fixed-effect is significant. Report the positive result. Change practice.</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">NICUs adopt early surfactant. Later trials show no benefit. Practice reverses.</div>
                      <div class="path-outcome">OUTCOME: Years of unnecessary intubation of premature infants</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Report Both Models</div>
                      <div class="path-choice">Show FE and RE results. Flag that significance depends on model choice. Call for large trials.</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Honest uncertainty. Large trials prioritized. True answer emerges faster.</div>
                      <div class="path-outcome">OUTCOME: Premature babies spared unnecessary intervention</div>
                    </div>
                  </div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    When a conclusion changes depending on whether you use fixed-effect or random-effects,
                    the conclusion is fragile. Report both. Acknowledge uncertainty. And remember:
                    a fragile result from small trials is not a mandate to change practice.
                  </div>
                </div>
              </div>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="13">
              <div class="content">
                <h2 class="title navy animate">Module 7 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q7-1">
                    <h4>1. Why did the magnesium meta-analysis show benefit that ISIS-4 did not find?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-1', 0, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
                        <span>A.</span> ISIS-4 methodology was flawed
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-1', 1, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
                        <span>B.</span> Calculation error in meta-analysis
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-1', 2, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
                        <span>C.</span> Publication bias in small trials
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-1', 3, 2, ['ISIS-4 used wrong methods.', 'The pooled effect was calculated correctly.', 'Correct! Small negative trials were never published, creating a biased sample.', 'LIMIT-2 had adequate power.'])">
                        <span>D.</span> LIMIT-2 was underpowered
                      </div>
                    </div>
                    <div id="q7-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q7-2" style="margin-top: 1.5rem;">
                    <h4>2. What warning sign should have alerted reviewers to potential bias?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-2', 0, 0, ['Correct! Small trials showed much larger effects than larger onesa classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
                        <span>A.</span> Asymmetric funnel plot (small trials showing larger effects)
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-2', 1, 0, ['Correct! Small trials showed much larger effects than larger onesa classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
                        <span>B.</span> Low heterogeneity (I = 0%)
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-2', 2, 0, ['Correct! Small trials showed much larger effects than larger onesa classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
                        <span>C.</span> Strong biological plausibility
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-2', 3, 0, ['Correct! Small trials showed much larger effects than larger onesa classic sign of small-study effects; publication bias is one explanation.', 'All trials showed consistent effects.', 'The biological mechanism was valid.', 'More trials needed to be published.'])">
                        <span>D.</span> Too few trials to analyze
                      </div>
                    </div>
                    <div id="q7-2-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q7-3" style="margin-top: 1.5rem;">
                    <h4>3. When publication bias is suspected, which model may amplify the bias?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-3', 0, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
                        <span>A.</span> Fixed effect model
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-3', 1, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
                        <span>B.</span> Random effects model
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-3', 2, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
                        <span>C.</span> Bayesian model
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q7-3', 3, 1, ['Fixed effects weights by precision, so large trials dominate.', 'Correct! Random effects gives more weight to small trials, which may be biased.', 'Bayesian models would be preferable.', 'Network meta-analysis handles bias differently.'])">
                        <span>D.</span> Network meta-analysis
                      </div>
                    </div>
                    <div id="q7-3-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="14">
              <p class="closing-line animate">Small trials can show false signals.</p>
              <p class="closing-line animate delay-1">Large trials anchor the truth.</p>
              <p class="closing-line gold animate delay-2">Heterogeneity is a message, not noise.</p>
              <div class="gold-line animate delay-3"></div>
            </div>
            <div class="slide black" data-index="15">
              <p class="refrain animate">Heterogeneity is a message, not noise.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 8: The Heterogeneity</p>
            </div>
          </div>

          <!-- Module 8: The Heterogeneity (ACCORD) -->
          <div class="module-slides" data-module="8">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Heterogeneity is a message, not noise.</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">ACCORD: 2008</p>
              <p class="title gold animate delay-1 text-center">When the average hides the truth.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 8: The Heterogeneity</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Calculate and interpret I, , and prediction intervals</li>
                    <li>Apply ICEMAN criteria to assess subgroup credibility</li>
                    <li>Distinguish between clinical, methodological, and statistical heterogeneity</li>
                    <li>Conduct and interpret leave-one-out sensitivity analyses</li>
                    <li>Explain how ACCORD revealed differential effects across subgroups</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Year: 2008</h2>
                <p class="direct-address animate delay-1">
                  "You are about to witness one of the most shocking trial terminations in history..."
                </p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    For decades, the diabetes community had one guiding principle: <strong>lower blood sugar is better</strong>.
                    The landmark DCCT (1993) and UKPDS (1998) showed that intensive glucose control reduced
                    microvascular complicationsblindness, kidney failure, nerve damage.
                  </p>
                </div>
                <div class="focus-box animate delay-3 mt-2">
                  <p class="main">The logical extrapolation:</p>
                  <p class="sub">If controlling glucose prevents complications, shouldn't intensive control prevent cardiovascular disease too?</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">ACCORD: Action to Control Cardiovascular Risk in Diabetes</h2>
                <p class="animate delay-1" style="font-style: italic;">The definitive test of intensive glucose control</p>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">10,251</div>
                    <div class="stat-label">Type 2 diabetics</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">HbA1c &lt;6%</div>
                    <div class="stat-label">Intensive target</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">HbA1c 7-7.9%</div>
                    <div class="stat-label">Standard target</div>
                  </div>
                </div>
                <div class="card animate delay-3">
                  <p class="card-text">
                    All patients had Type 2 diabetes with high cardiovascular riskeither established
                    cardiovascular disease or multiple risk factors. The trial was designed for 5.6 years.
                  </p>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="4">
              <p class="rhetorical animate" style="font-size: 2rem;">
                February 6, 2008
              </p>
              <p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                The Data Safety Monitoring Board calls an emergency meeting.
              </p>
              <p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                After 3.5 years, they make an unprecedented decision:
              </p>
              <p class="title gold animate delay-3" style="font-size: 2.5rem; margin-top: 1.5rem;">
                STOP THE TRIAL.
              </p>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">The Shocking Results</h2>
                <table class="results-table animate delay-1">
                  <thead>
                    <tr>
                      <th>Outcome</th>
                      <th>Intensive</th>
                      <th>Standard</th>
                      <th>HR (95% CI)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Primary CV endpoint</td>
                      <td>352 events</td>
                      <td>371 events</td>
                      <td>0.90 (0.781.04)</td>
                    </tr>
                    <tr style="background: rgba(197, 48, 48, 0.15);">
                      <td><strong>All-cause mortality</strong></td>
                      <td><strong>257 deaths</strong></td>
                      <td><strong>203 deaths</strong></td>
                      <td class="highlight"><strong>1.22 (1.011.46)</strong></td>
                    </tr>
                    <tr>
                      <td>Severe hypoglycemia</td>
                      <td>10.5%</td>
                      <td>3.5%</td>
                      <td>3.0 higher</td>
                    </tr>
                  </tbody>
                </table>
                <div class="result-box animate delay-2" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
                  <div class="value">22% increase in mortality</div>
                  <div class="label">54 excess deaths in the intensive arm</div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="6">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Investigation Exercise: The Clinician's Dilemma</h3>
                </div>
                <p class="direct-address">
                  You are an endocrinologist with 500 diabetic patients. The ACCORD results are published.
                  What do you tell your patients who have been striving for HbA1c &lt;6%?
                </p>
                <p class="rhetorical" style="margin: 1.5rem 0;">
                  Is intensive control harmful for everyone? Or only for some?
                </p>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                  <button class="reveal-btn" onclick="revealAnswer('accord-subgroup')">Examine the Subgroups </button>
                </div>
                <div id="accord-subgroup" class="hidden-reveal">
                  <h4 style="color: var(--gold); margin-top: 1rem;">Subgroup Analysis Revealed:</h4>
                  <table class="data-table-investigation" style="margin-top: 0.5rem;">
                    <thead><tr><th>Subgroup</th><th>Intensive HR</th><th>Interpretation</th></tr></thead>
                    <tbody>
                      <tr><td>No prior CVD</td><td>1.00 (0.761.32)</td><td>No effect</td></tr>
                      <tr><td>Prior CVD</td><td style="color: #C53030;">1.45 (1.151.84)</td><td>Significant harm</td></tr>
                      <tr><td>Baseline HbA1c &lt;8%</td><td>1.02 (0.751.40)</td><td>No effect</td></tr>
                      <tr><td>Baseline HbA1c 8%</td><td style="color: #C53030;">1.29 (1.031.60)</td><td>Harm</td></tr>
                    </tbody>
                  </table>
                  <div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
                    <p class="main" style="color: #f59e0b;">The average effect masked critical heterogeneity!</p>
                    <p class="sub">For patients with established CVD or poor baseline control, intensive therapy was harmful.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">Understanding Heterogeneity: I and Beyond</h2>
                <p class="animate delay-1">When studies (or subgroups) show different effects, we must quantify this variation.</p>
                <div style="max-width: 700px;" class="animate delay-2">
                  <div class="card" style="border-left: 4px solid #22c55e;">
                    <p class="card-text"><strong>I = 025%:</strong> Low heterogeneity. Effects are consistent across studies.</p>
                  </div>
                  <div class="card" style="border-left: 4px solid #3b82f6; margin-top: 0.5rem;">
                    <p class="card-text"><strong>I = 2550%:</strong> Moderate. Look for sources of variation.</p>
                  </div>
                  <div class="card" style="border-left: 4px solid #f59e0b; margin-top: 0.5rem;">
                    <p class="card-text"><strong>I = 5075%:</strong> Substantial. Consider whether pooling is appropriate.</p>
                  </div>
                  <div class="card" style="border-left: 4px solid #C53030; margin-top: 0.5rem;">
                    <p class="card-text"><strong>I = 75100%:</strong> Considerable. A single pooled estimate may mislead.</p>
                  </div>
                </div>
                <p class="footnote animate delay-3">But I alone doesn't tell you what to doit signals that you need to investigate further.</p>
              </div>
            </div>
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">Tau (): The Between-Study Variance</h2>
                <p class="animate delay-1">While I tells you the proportion of variance due to heterogeneity,  tells you the magnitude.</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 800px;" class="animate delay-2">
                  <div class="card">
                    <div class="card-label">I (percentage)</div>
                    <p class="card-text">"What fraction of the total variance is due to true differences between studies?"</p>
                    <p style="font-size: 0.85rem;">Scale: 0% to 100%</p>
                  </div>
                  <div class="card">
                    <div class="card-label"> (absolute)</div>
                    <p class="card-text">"How much do the true effects vary between studies?"</p>
                    <p style="font-size: 0.85rem;">Same scale as the effect measure</p>
                  </div>
                </div>
                <div class="focus-box animate delay-3 mt-2">
                  <p class="main">Use  to calculate <strong>prediction intervals</strong></p>
                  <p class="sub">A prediction interval shows the range of effects you'd expect in a new studyoften much wider than the confidence interval.</p>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="9">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>The Prediction Interval: What ACCORD Really Tells Us</h3>
                </div>
                <p class="direct-address">
                  Consider a meta-analysis of intensive glucose control across multiple trials...
                </p>
                <div class="comparison-grid" style="margin-top: 1rem;">
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">Confidence Interval</h4>
                    <p style="font-size: 1.2rem; font-weight: bold;">HR 1.10 (0.951.27)</p>
                    <p style="font-size: 0.9rem;">"Our best estimate of the average effect"</p>
                  </div>
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">Prediction Interval</h4>
                    <p style="font-size: 1.2rem; font-weight: bold;">HR 1.10 (0.701.73)</p>
                    <p style="font-size: 0.9rem;">"The range of effects in a new setting"</p>
                  </div>
                </div>
                <div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
                  <p class="main" style="color: #f59e0b;">The prediction interval spans both benefit and harm!</p>
                  <p class="sub">In some settings, intensive control might help. In others, it could kill.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">When Is a Subgroup Effect Credible?</h2>
                <p class="animate delay-1" style="font-style: italic;">Subgroup Credibility Criteria (adapted from ICEMAN, Schandelmaier 2020 &amp; Sun 2012)</p>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Was the subgroup analysis pre-specified?</h4>
                    <p>Post-hoc subgroups are prone to data dredging</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Is there a plausible biological rationale?</h4>
                    <p>Mechanism should be clear and independent of the data</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Is the effect consistent across related outcomes?</h4>
                    <p>If harm appears for mortality, is there similar harm for MI, stroke?</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-5">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Is there independent replication?</h4>
                    <p>Has the subgroup effect been confirmed in other studies?</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">ICEMAN Applied to ACCORD</h2>
                <table class="results-table animate delay-1">
                  <thead>
                    <tr><th>Criterion</th><th>Assessment</th><th>Score</th></tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Pre-specified?</td>
                      <td>Yesprior CVD was in the protocol</td>
                      <td style="color: #22c55e;"></td>
                    </tr>
                    <tr>
                      <td>Biological rationale?</td>
                      <td>Yeshypoglycemia more dangerous with CVD</td>
                      <td style="color: #22c55e;"></td>
                    </tr>
                    <tr>
                      <td>Consistent outcomes?</td>
                      <td>YesCV mortality and all-cause mortality aligned</td>
                      <td style="color: #22c55e;"></td>
                    </tr>
                    <tr>
                      <td>Independent replication?</td>
                      <td>PartiallyADVANCE, VADT showed similar patterns</td>
                      <td style="color: #f59e0b;">~</td>
                    </tr>
                  </tbody>
                </table>
                <div class="focus-box animate delay-2 mt-2">
                  <p class="main">ICEMAN Rating: High Credibility</p>
                  <p class="sub">The differential harm in high-risk patients appears genuine.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="12">
              <div class="content">
                <h2 class="title navy animate">The Clinical Implications</h2>
                <div class="card animate delay-1">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>For patients without CVD:</strong> Moderate glucose control (HbA1c ~7%) remains the goal.
                    Intensive control may reduce microvascular complications.
                  </p>
                </div>
                <div class="card animate delay-2">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>For patients with established CVD:</strong> Avoid intensive targets.
                    Hypoglycemia is dangerous for damaged hearts.
                  </p>
                </div>
                <div class="card animate delay-3">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>For elderly patients:</strong> Relaxed targets. Quality of life matters.
                    Tight control causes falls, confusion, and excess mortality.
                  </p>
                </div>
                <p class="footnote animate delay-4" style="font-size: 1rem; font-style: italic;">
                  "One size fits all" treatment is not patient-centered medicine.
                </p>
              </div>
            </div>
            <!-- Meta-Regression -->
            <div class="slide light" data-index="13">
              <div class="content">
                <h2 class="title navy animate">Meta-Regression: Explaining Heterogeneity</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  When heterogeneity is high, meta-regression can identify study-level covariates that explain variation.
                </p>
                <div class="card animate delay-2" style="margin-bottom: 1rem;">
                  <div class="card-label">THE QUESTION</div>
                  <p class="card-text">Does the effect size vary systematically with study characteristics?</p>
                </div>
                <div class="stats-grid animate delay-3">
                  <div class="stat-box">
                    <div class="stat-value" style="font-size: 1.1rem;">Covariates</div>
                    <div class="stat-label">Year, dose, duration, baseline risk, study quality</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value" style="font-size: 1.1rem;">Output</div>
                    <div class="stat-label">Regression coefficient (slope), R, residual heterogeneity</div>
                  </div>
                </div>
                <div class="focus-box animate delay-4">
                  <p class="main" style="color: var(--red);">Caution</p>
                  <p class="sub">Meta-regression requires 10 studies per covariate. With few studies, it is exploratory only. Ecological fallacy: study-level associations may not apply to individuals.</p>
                </div>
                <p class="footnote animate delay-5" style="margin-top: 1rem;">
                  <strong>Example:</strong> In ACCORD, meta-regression might test if treatment effect varies by baseline HbA1c, showing harm concentrated in patients with very high levels.
                </p>
              </div>
            </div>
            <!-- STORY: The SPRINT Blood Pressure Revolution -->
            <div class="slide dark" data-index="13b">
              <div class="story-box animate">
                <p class="story-opener">What number saves lives? Who decides?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    For decades, the target was: treat blood pressure to <span class="data-highlight">&lt;140 mmHg systolic</span>.
                    Then came <span class="data-highlight">SPRINT (2015)</span>: <span class="data-highlight">9,361 high-risk patients</span>
                    randomized to intensive (&lt;120) vs standard (&lt;140) targets.
                    Intensive treatment reduced <span class="data-highlight">CV events by 25%</span> and
                    <span class="data-highlight">death by 27%</span>.
                    Trial stopped early for benefit. Guidelines changed worldwide.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">Before SPRINT: The Guidelines Committee</div>
                  <div class="decision-scenario">
                    You are setting blood pressure guidelines in 2014. The target has been &lt;140 for years. Should you wait for better evidence?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Maintain Status Quo</div>
                      <div class="path-choice">Keep &lt;140 target (established practice, minimal controversy)</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Guidelines unchanged. Physicians continue treating to &lt;140.</div>
                      <div class="path-outcome">OUTCOME: Miss opportunity to prevent deaths</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Fund the Definitive Trial</div>
                      <div class="path-choice">Wait for SPRINT results before updating targets</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">SPRINT demonstrates benefit. Update target to &lt;120 for high-risk patients.</div>
                      <div class="path-outcome">OUTCOME: Estimated 100,000+ lives saved globally</div>
                    </div>
                  </div>
                </div>

                <div class="story-timeline">
                  <div class="timeline-point">JNC 7 (2003): &lt;140</div>
                  <div class="timeline-point critical">Years of uncertainty</div>
                  <div class="timeline-point resolution">SPRINT (2015): &lt;120 for high-risk</div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    "Standard of care" is not fixed. It changes when trials challenge assumptions.
                    For a decade, patients may have been undertreated because no one tested the obvious question.
                  </div>
                </div>
              </div>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="14">
              <div class="content">
                <h2 class="title navy animate">Module 8 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q8-1">
                    <h4>1. Why was the ACCORD trial stopped early?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-1', 0, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
                        <span>A.</span> Intensive control showed clear cardiovascular benefit
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-1', 1, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
                        <span>B.</span> Intensive control increased mortality
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-1', 2, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
                        <span>C.</span> Enrollment was too slow
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-1', 3, 1, ['Incorrect. Intensive glycemic control actually increased mortality by 22%.', 'Correct! The intensive arm had 22% higher mortality, triggering early termination.', 'Enrollment was adequate; the issue was excess mortality.', 'Budget was not the reason for early termination.'])">
                        <span>D.</span> Budget ran out
                      </div>
                    </div>
                    <div id="q8-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q8-2" style="margin-top: 1.5rem;">
                    <h4>2. What does a prediction interval tell us that a confidence interval doesn't?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-2', 0, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
                        <span>A.</span> The true effect is more precisely estimated
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-2', 1, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
                        <span>B.</span> The sample size is adequate
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-2', 2, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
                        <span>C.</span> The range of effects we'd expect in a new study
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-2', 3, 2, ['Both are estimates, but PI includes heterogeneity.', 'Sample size affects precision.', 'Correct! The prediction interval shows what effects we might see in a new setting, accounting for between-study variance.', 'The formula is indeed different.'])">
                        <span>D.</span> The mathematical formula used
                      </div>
                    </div>
                    <div id="q8-2-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q8-3" style="margin-top: 1.5rem;">
                    <h4>3. According to ICEMAN, which factor is MOST important for subgroup credibility?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-3', 0, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
                        <span>A.</span> Pre-specification of the subgroup hypothesis
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-3', 1, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
                        <span>B.</span> Large sample size in the subgroup
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-3', 2, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
                        <span>C.</span> Statistically significant p-value
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q8-3', 3, 0, ['Correct! Pre-specification protects against data dredging. All other criteria support but don\\'t replace it.', 'Sample size matters, but pre-specification is paramount.', 'P-values can be gamed.', 'Multiple outcomes can be misleading.'])">
                        <span>D.</span> Multiple outcomes showing same direction
                      </div>
                    </div>
                    <div id="q8-3-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="15">
              <p class="closing-line animate">When studies disagree,</p>
              <p class="closing-line animate delay-1">listen to the disagreement.</p>
              <p class="closing-line gold animate delay-2">Heterogeneity is a message, not noise.</p>
              <div class="gold-line animate delay-3"></div>
            </div>
            <div class="slide black" data-index="16">
              <p class="refrain animate">Absence of evidence is not evidence of absence.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 9: The Hidden Studies</p>
            </div>
          </div>

          <!-- Module 9: The Hidden Studies (Reboxetine) -->
          <div class="module-slides" data-module="9">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Absence of evidence is not evidence of absence.</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">Reboxetine: 2010</p>
              <p class="title gold animate delay-1 text-center">The 74% that never saw light.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 9: The Hidden Studies</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Interpret funnel plots for asymmetry detection</li>
                    <li>Apply Egger's test and other statistical tests for publication bias</li>
                    <li>Implement trim-and-fill method for bias adjustment</li>
                    <li>Critically appraise the limitations of publication bias tests</li>
                    <li>Apply the principle: "Absence of evidence is not evidence of absence"</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Year: 1997</h2>
                <p class="direct-address animate delay-1">
                  "A new hope for depression patients who cannot tolerate SSRIs..."
                </p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    Reboxetine (Edronax) was a novel antidepressanta selective norepinephrine reuptake inhibitor (NRI).
                    Unlike SSRIs, it targeted a different neurotransmitter system. For patients who failed or couldn't
                    tolerate fluoxetine or sertraline, it offered a new mechanism.
                  </p>
                </div>
                <div class="stats-grid animate delay-3">
                  <div class="stat-box">
                    <div class="stat-value">1997</div>
                    <div class="stat-label">EU approval</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">50+</div>
                    <div class="stat-label">Countries approved</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Millions</div>
                    <div class="stat-label">Prescriptions written</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Published Evidence</h2>
                <p class="animate delay-1" style="font-style: italic;">What doctors could find in medical journals:</p>
                <table class="results-table animate delay-2">
                  <thead>
                    <tr><th>Comparison</th><th>Published Trials</th><th>Published Result</th></tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Reboxetine vs Placebo</td>
                      <td>3 trials (n=507)</td>
                      <td style="color: #22c55e;">Significantly better (SMD = 0.56)</td>
                    </tr>
                    <tr>
                      <td>Reboxetine vs SSRIs</td>
                      <td>4 trials (n=628)</td>
                      <td style="color: #22c55e;">Equivalent or better</td>
                    </tr>
                  </tbody>
                </table>
                <div class="focus-box animate delay-3 mt-2">
                  <p class="main">The published literature told a clear story:</p>
                  <p class="sub">Reboxetine works. Patients benefit. Prescribe with confidence.</p>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="4">
              <p class="rhetorical animate" style="font-size: 2rem;">
                But what about the trials you couldn't see?
              </p>
              <p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                In 2010, German researchers at IQWiG made a request to the European Medicines Agency...
              </p>
              <p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                They demanded access to <strong>all</strong> trial datapublished and unpublished.
              </p>
              <p class="title gold animate delay-3" style="font-size: 2rem; margin-top: 1.5rem;">
                What they found changed everything.
              </p>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">The Complete Picture</h2>
                <p class="animate delay-1" style="color: #C53030; font-weight: bold; font-style: italic;">Eyding et al., BMJ 2010</p>
                <table class="results-table animate delay-2">
                  <thead>
                    <tr><th>Comparison</th><th>Published Only</th><th>ALL DATA</th></tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Reboxetine vs Placebo</strong></td>
                      <td style="color: #22c55e;">SMD 0.56 (benefit)</td>
                      <td style="color: #C53030;"><strong>SMD 0.10 (no benefit)</strong></td>
                    </tr>
                    <tr>
                      <td>Patients in analysis</td>
                      <td>507 (14%)</td>
                      <td><strong>2,731 (100%)</strong></td>
                    </tr>
                    <tr>
                      <td><strong>Reboxetine vs SSRIs</strong></td>
                      <td style="color: #22c55e;">Equivalent</td>
                      <td style="color: #C53030;"><strong>Inferior (RR 1.23 for harm)</strong></td>
                    </tr>
                    <tr>
                      <td>Patients in analysis</td>
                      <td>628 (26%)</td>
                      <td><strong>2,411 (100%)</strong></td>
                    </tr>
                  </tbody>
                </table>
                <div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
                  <div class="value">74% of patient data was never published</div>
                  <div class="label">The hidden trials showed no benefit and more harm</div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="6">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Investigation Exercise: The File Drawer</h3>
                </div>
                <p class="direct-address">
                  You are a systematic reviewer in 2008. You search PubMed, Embase, and the Cochrane Library
                  for all reboxetine trials. You find 7 published trials showing benefit.
                </p>
                <p class="rhetorical" style="margin: 1.5rem 0;">
                  Can you trust this evidence?
                </p>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                  <button class="reveal-btn" onclick="revealAnswer('rebox-funnel')">Generate Funnel Plot </button>
                </div>
                <div id="rebox-funnel" class="hidden-reveal">
                  <div id="reboxetine-funnel" style="background: white; border-radius: 8px; padding: 1rem; margin: 1rem 0;"></div>
                  <script>
                    // This will be called when revealed
                    setTimeout(() => {
                      if (document.getElementById('rebox-funnel').classList.contains('hidden-reveal') === false) {
                        drawReboxetineFunnel();
                      }
                    }, 100);
                  </script>
                  <button class="reveal-btn" onclick="drawReboxetineFunnel()" style="margin-top: 0.5rem;">Draw Funnel </button>
                  <div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
                    <p class="main" style="color: #f59e0b;"> The funnel is drastically asymmetric!</p>
                    <p class="sub">All published studies cluster on one side. Where are the null and negative trials?</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">The Publication Bias Toolkit</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Funnel Plot</h4>
                    <p>Plot effect size vs. standard error. A symmetric funnel suggests no bias; asymmetry raises alarms.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Egger's Regression Test</h4>
                    <p>Regress effect/SE on 1/SE. A non-zero intercept (P &lt; 0.10) suggests small-study effects. Note: inflated false-positive rate with binary outcomes; use Peters' test instead.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Peters' Test</h4>
                    <p>For binary outcomes, regresses log OR on inverse of total sample size. Less prone to false positives.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Trim-and-Fill</h4>
                    <p>Imputes "missing" studies to make the funnel symmetric, then recalculates the pooled effect.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="8">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Interactive: Trim-and-Fill Analysis</h3>
                </div>
                <p class="direct-address">
                  Let us apply trim-and-fill to the reboxetine data and see what the adjusted estimate would be...
                </p>
                <div class="comparison-grid" style="margin-top: 1rem;">
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">Published Only</h4>
                    <p>7 trials</p>
                    <p style="font-size: 1.2rem; font-weight: bold; color: #22c55e;">SMD = 0.56</p>
                    <p style="font-size: 0.9rem;">Significant benefit</p>
                  </div>
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">Trim-and-Fill</h4>
                    <p>7 + 5 imputed = 12 trials</p>
                    <p style="font-size: 1.2rem; font-weight: bold; color: #f59e0b;">SMD = 0.23</p>
                    <p style="font-size: 0.9rem;">Reduced, still nominally significant</p>
                  </div>
                </div>
                <div class="focus-box" style="margin-top: 1rem; border-color: #C53030;">
                  <p class="main" style="color: #C53030;">But even trim-and-fill underestimated the problem!</p>
                  <p class="sub">The true effect with all data was SMD = 0.10 (essentially null).<br>Trim-and-fill is conservativeit doesn't fully correct for selective publication.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">The Best Defense: Trial Registries</h2>
                <p class="animate delay-1">Publication bias detection methods are imperfect. The real solution is <strong>prospective registration</strong>.</p>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">ClinicalTrials.gov</div>
                    <div class="stat-label">US registry (2000)</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">WHO ICTRP</div>
                    <div class="stat-label">Global portal</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">PROSPERO</div>
                    <div class="stat-label">Review registration</div>
                  </div>
                </div>
                <div class="card animate delay-3">
                  <p class="card-text">
                    When searching for trials, always check registries. Compare the number of <strong>registered</strong> trials
                    to the number <strong>published</strong>. The gap is your warning signal.
                  </p>
                </div>
                <p class="footnote animate delay-4">
                  Since 2005, ICMJE requires trial registration as a condition of publication.
                </p>
              </div>
            </div>
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">The AllTrials Campaign</h2>
                <div class="card animate delay-1">
                  <p class="card-text" style="font-size: 1.2rem; text-align: center;">
                    <strong>"All trials registered. All results reported."</strong>
                  </p>
                </div>
                <p class="animate delay-2" style="margin-top: 1rem;">
                  The reboxetine scandal, along with similar cases in other drugs, catalyzed a global movement:
                </p>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number"></div>
                  <div class="lesson-content">
                    <h4>2013: EMA Clinical Data Policy</h4>
                    <p>European Medicines Agency commits to publishing clinical study reports</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number"></div>
                  <div class="lesson-content">
                    <h4>2016: FDA Amendments Act enforcement</h4>
                    <p>Mandatory results reporting on ClinicalTrials.gov within 12 months</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-5">
                  <div class="lesson-number"></div>
                  <div class="lesson-content">
                    <h4>AllTrials Coalition</h4>
                    <p>Over 90,000 supporters, 700+ organizations demanding transparency</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">The Reboxetine Aftermath</h2>
                <div class="wrong-item animate delay-1">
                  <div class="wrong-number" style="background: #C53030;">!</div>
                  <p>Germany's IQWiG recommended against reboxetine for depression</p>
                </div>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number" style="background: #C53030;">!</div>
                  <p>The UK's NICE downgraded it to "not recommended"</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number" style="background: #C53030;">!</div>
                  <p>The FDA had rejected reboxetine in 2001 (they had access to unpublished data)</p>
                </div>
                <div class="focus-box animate delay-4 mt-2">
                  <p class="main">For over a decade, patients received a drug no better than placebo.</p>
                  <p class="sub">Because only the positive trials were published.</p>
                </div>
              </div>
            </div>
            <!-- STORY: The Paroxetine Study 329 Deception -->
            <div class="slide dark" data-index="11b">
              <div class="story-box animate">
                <p class="story-opener">What if the published conclusion is the opposite of the actual data?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    GlaxoSmithKline's Study 329 tested paroxetine in <span class="data-highlight">adolescent depression</span>.
                    The published paper (2001) concluded paroxetine was <span class="data-highlight">"generally well tolerated and effective."</span>
                    The actual data: paroxetine <span class="data-highlight">failed on all 8 pre-specified outcomes</span>.
                    When re-analyzed (RIAT 2015), suicidal/self-harm events: <span class="data-highlight">23 in the paroxetine group vs 5 on placebo</span>.
                    The published paper re-defined outcomes post-hoc to manufacture significance.
                    In 2015, a RIAT (Restoring Invisible and Abandoned Trials) re-analysis
                    using the <span class="data-highlight">original clinical study report</span>
                    concluded: paroxetine was <span class="data-highlight">neither safe nor effective</span> for adolescents.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Prescriber's Puzzle: 2003</div>
                  <div class="decision-scenario">
                    You are a child psychiatrist. Study 329  the only large trial  says paroxetine works in teens. But the FDA has not approved it for adolescents. A parent asks you to prescribe it. What do you do?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Trust the Publication</div>
                      <div class="path-choice">A peer-reviewed JAACAP paper says it works. Prescribe off-label.</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Millions of prescriptions worldwide. Suicidal events in adolescents.</div>
                      <div class="path-outcome">OUTCOME: FDA issues black box warning for SSRIs in youth (2004)</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Check the Trial Registry</div>
                      <div class="path-choice">Search ClinicalTrials.gov for original endpoints. Notice the published outcomes don't match the registered protocol.</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Red flag: outcome switching detected. You withhold the drug. Patient is safer.</div>
                      <div class="path-outcome">OUTCOME: Publication bias identified before harm</div>
                    </div>
                  </div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    Publication bias is not just about missing studies. It is about missing truth within published studies.
                    Outcome switching, ghost-writing, and selective reporting can turn a failed trial into a marketing tool.
                    Always compare published results against trial registry protocols.
                  </div>
                </div>
              </div>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="12">
              <div class="content">
                <h2 class="title navy animate">Module 9 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q9-1">
                    <h4>1. What percentage of reboxetine trial data was hidden from the published literature?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-1', 0, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
                        <span>A.</span> 25%
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-1', 1, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
                        <span>B.</span> 50%
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-1', 2, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
                        <span>C.</span> 74%
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-1', 3, 2, ['Some data was hidden but much less.', 'About half was hidden.', 'Correct! 74% of patient data was in unpublished trials.', 'A larger fraction was hidden.'])">
                        <span>D.</span> 90%
                      </div>
                    </div>
                    <div id="q9-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q9-2" style="margin-top: 1.5rem;">
                    <h4>2. Why can trim-and-fill underestimate the correction needed?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-2', 0, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
                        <span>A.</span> It assumes effects are normally distributed
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-2', 1, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
                        <span>B.</span> It only imputes studies to achieve symmetry, which may not fully reflect reality
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-2', 2, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
                        <span>C.</span> It requires at least 20 studies
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-2', 3, 1, ['Trim-and-fill does not require normality.', 'Correct! It estimates missing studies but makes assumptions that may not hold when publication bias is severe.', 'Funnel plots can work with fewer studies.', 'More studies generally help.'])">
                        <span>D.</span> It only works with very large studies
                      </div>
                    </div>
                    <div id="q9-2-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q9-3" style="margin-top: 1.5rem;">
                    <h4>3. What is the best prospective defense against publication bias?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-3', 0, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
                        <span>A.</span> Funnel plots in all meta-analyses
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-3', 1, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
                        <span>B.</span> Egger's test before pooling
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-3', 2, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
                        <span>C.</span> Prospective trial registration
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q9-3', 3, 2, ['Funnel plots detect, not prevent, bias.', 'Egger\\'s test detects, not prevents.', 'Correct! Registering all trials upfront ensures we know what exists, even if not all are published.', 'More journals doesn\\'t ensure negative trials get published.'])">
                        <span>D.</span> More medical journals
                      </div>
                    </div>
                    <div id="q9-3-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="13">
              <p class="closing-line animate">What you cannot see</p>
              <p class="closing-line animate delay-1">may be more important than what you can.</p>
              <p class="closing-line gold animate delay-2">Absence of evidence is not evidence of absence.</p>
              <div class="gold-line animate delay-3"></div>
            </div>
            <div class="slide black" data-index="14">
              <p class="refrain animate">Certainty must be earned, not assumed.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 10: The Certainty</p>
            </div>
          </div>

          <!-- Module 10: The Certainty (Early Surfactant) -->
          <div class="module-slides" data-module="10">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Certainty must be earned, not assumed.</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">Early Surfactant: 2012</p>
              <p class="title gold animate delay-1 text-center">When high-quality evidence evolves.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 10: The Certainty</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Apply the complete GRADE framework to assess certainty of evidence</li>
                    <li>Evaluate all five downgrade factors (RoB, inconsistency, indirectness, imprecision, publication bias)</li>
                    <li>Identify when to upgrade for large effect, dose-response, or confounding</li>
                    <li>Construct Summary of Findings tables with absolute effect estimates</li>
                    <li>Apply the principle: "Certainty must be earned, not assumed"</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Year: 1990s</h2>
                <p class="direct-address animate delay-1">
                  "A revolution in neonatal care..."
                </p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    Respiratory Distress Syndrome (RDS) was the leading cause of death in premature infants.
                    The development of exogenous <strong>surfactant</strong>the substance that keeps alveoli from
                    collapsingwas one of the great advances in neonatal medicine.
                  </p>
                </div>
                <div class="focus-box animate delay-3 mt-2">
                  <p class="main">The question became: When should we give surfactant?</p>
                  <p class="sub">Prophylactically (to all high-risk infants) or selectively (only after RDS develops)?</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Original Cochrane Review (2003)</h2>
                <p class="animate delay-1" style="font-style: italic;">Multiple RCTs conducted before the era of routine CPAP</p>
                <table class="results-table animate delay-2">
                  <thead>
                    <tr><th>Outcome</th><th>Prophylactic vs Selective</th><th>Certainty</th></tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Neonatal mortality</td>
                      <td style="color: #22c55e;">RR 0.73 (favors prophylactic)</td>
                      <td>High</td>
                    </tr>
                    <tr>
                      <td>BPD or death</td>
                      <td style="color: #22c55e;">RR 0.84 (favors prophylactic)</td>
                      <td>High</td>
                    </tr>
                  </tbody>
                </table>
                <div class="result-box animate delay-3">
                  <div class="value">Recommendation: Give surfactant prophylactically</div>
                  <div class="label">Guidelines worldwide adopted this approach</div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="4">
              <p class="rhetorical animate" style="font-size: 2rem;">
                But the world of neonatal care was changing...
              </p>
              <p class="animate delay-1" style="font-size: 1.3rem; margin-top: 2rem;">
                A new technology emerged: <strong>Continuous Positive Airway Pressure (CPAP)</strong>
              </p>
              <p class="animate delay-2" style="font-size: 1.3rem; margin-top: 1rem;">
                Non-invasive support that could help preterm lungs without intubation.
              </p>
              <p class="title gold animate delay-3" style="font-size: 1.5rem; margin-top: 1.5rem;">
                Would the old evidence still apply?
              </p>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">The 2012 Cochrane Update</h2>
                <p class="animate delay-1" style="color: #C53030; font-weight: bold;">New trials conducted in the CPAP era</p>
                <table class="results-table animate delay-2">
                  <thead>
                    <tr><th>Outcome</th><th>Old Trials</th><th>New Trials</th></tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>BPD or death</td>
                      <td style="color: #22c55e;">RR 0.84 (favors prophylactic)</td>
                      <td style="color: #C53030;">RR 1.12 (favors selective)</td>
                    </tr>
                    <tr>
                      <td>Need for mechanical ventilation</td>
                      <td style="color: #22c55e;">Lower with prophylactic</td>
                      <td style="color: #C53030;">Higher with prophylactic!</td>
                    </tr>
                  </tbody>
                </table>
                <div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
                  <div class="value">Complete Reversal</div>
                  <div class="label">In the CPAP era, prophylactic surfactant causes more harm</div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="6">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Investigation: Why Did Evidence Evolve?</h3>
                </div>
                <p class="direct-address">
                  You are a neonatologist. A colleague asks: "How can randomized trials contradict each other?"
                </p>
                <p class="rhetorical" style="margin: 1rem 0;">
                  Was the original evidence wrong?
                </p>
                <button class="reveal-btn" onclick="revealAnswer('surfactant-explain')">Understand the Evolution </button>
                <div id="surfactant-explain" class="hidden-reveal">
                  <div class="lesson-item" style="margin-top: 1rem;">
                    <div class="lesson-number">1</div>
                    <div class="lesson-content">
                      <h4>Indirectness Changed</h4>
                      <p>Old trials: No CPAP available. New trials: CPAP standard of care.</p>
                    </div>
                  </div>
                  <div class="lesson-item">
                    <div class="lesson-number">2</div>
                    <div class="lesson-content">
                      <h4>The Comparator Improved</h4>
                      <p>Selective surfactant + CPAP is better than prophylactic intubation.</p>
                    </div>
                  </div>
                  <div class="lesson-item">
                    <div class="lesson-number">3</div>
                    <div class="lesson-content">
                      <h4>Context Matters</h4>
                      <p>Evidence from one era may not apply to another.</p>
                    </div>
                  </div>
                  <div class="focus-box" style="margin-top: 1rem; border-color: #f59e0b;">
                    <p class="main" style="color: #f59e0b;">This is why GRADE assesses Indirectness!</p>
                    <p class="sub">High-quality evidence can become inapplicable when context changes.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">The GRADE Framework</h2>
                <p class="animate delay-1" style="margin-bottom: 1rem; font-style: italic;">
                  Grading of Recommendations, Assessment, Development and Evaluations
                </p>
                <p class="animate delay-2">GRADE answers the question: <strong>How confident are we in this estimate?</strong></p>
                <div style="max-width: 700px;" class="animate delay-3">
                  <div class="card" style="background: rgba(34,197,94,0.15); border-left: 4px solid #22c55e;">
                    <p class="card-text"><strong> HIGH:</strong> Very confident. True effect is close to the estimate.</p>
                  </div>
                  <div class="card" style="background: rgba(59,130,246,0.15); border-left: 4px solid #3b82f6; margin-top: 0.5rem;">
                    <p class="card-text"><strong> MODERATE:</strong> Moderately confident. True effect likely close, but may differ substantially.</p>
                  </div>
                  <div class="card" style="background: rgba(245,158,11,0.15); border-left: 4px solid #f59e0b; margin-top: 0.5rem;">
                    <p class="card-text"><strong> LOW:</strong> Limited confidence. True effect may differ substantially.</p>
                  </div>
                  <div class="card" style="background: rgba(197,48,48,0.15); border-left: 4px solid #C53030; margin-top: 0.5rem;">
                    <p class="card-text"><strong> VERY LOW:</strong> Very little confidence. True effect likely substantially different.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">GRADE: Factors That Downgrade Certainty</h2>
                <p class="animate delay-1">RCT evidence starts at HIGH. It can be downgraded for:</p>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #C53030;">1</div>
                  <div class="lesson-content">
                    <h4>Risk of Bias</h4>
                    <p>Flawed randomization, lack of blinding, incomplete follow-up, selective reporting</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background: #C53030;">2</div>
                  <div class="lesson-content">
                    <h4>Inconsistency</h4>
                    <p>Unexplained heterogeneity across studies (large I, non-overlapping CIs)</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background: #C53030;">3</div>
                  <div class="lesson-content">
                    <h4>Indirectness</h4>
                    <p>Differences in population, intervention, comparator, or outcomes from the question</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-5">
                  <div class="lesson-number" style="background: #C53030;">4</div>
                  <div class="lesson-content">
                    <h4>Imprecision</h4>
                    <p>Wide confidence intervals, small sample size, few events</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">GRADE: The Fifth Factor</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number" style="background: #C53030;">5</div>
                  <div class="lesson-content">
                    <h4>Publication Bias</h4>
                    <p>Asymmetric funnel plot, missing registered trials, sponsor influence</p>
                  </div>
                </div>
                <div class="focus-box animate delay-2 mt-2">
                  <p class="main">Each factor can downgrade by one or two levels</p>
                  <p class="sub">High  Moderate  Low  Very Low</p>
                </div>
                <div class="card animate delay-3" style="margin-top: 1rem;">
                  <p class="card-text">
                    <strong>Example:</strong> A meta-analysis of RCTs (starts HIGH) with high risk of bias (1)
                    and serious indirectness (1) would be rated <strong>LOW</strong>.
                  </p>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="10">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Interactive: Apply GRADE to Surfactant</h3>
                </div>
                <p class="direct-address">
                  Let's rate the certainty of evidence for prophylactic surfactant using old vs. new trials.
                </p>
                <div class="comparison-grid" style="margin-top: 1rem;">
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">OLD TRIALS (Pre-CPAP)</h4>
                    <p><strong>Starting:</strong> HIGH (RCTs)</p>
                    <p><strong>Risk of Bias:</strong> Low (0)</p>
                    <p><strong>Inconsistency:</strong> None (0)</p>
                    <p><strong>Indirectness:</strong> Serious (1)</p>
                    <p style="font-size: 0.85rem; color: #f59e0b;">Different standard of care today</p>
                    <p><strong>Final:</strong>  MODERATE</p>
                  </div>
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">NEW TRIALS (CPAP Era)</h4>
                    <p><strong>Starting:</strong> HIGH (RCTs)</p>
                    <p><strong>Risk of Bias:</strong> Low (0)</p>
                    <p><strong>Inconsistency:</strong> None (0)</p>
                    <p><strong>Indirectness:</strong> None (0)</p>
                    <p style="font-size: 0.85rem; color: #22c55e;">Matches current practice</p>
                    <p><strong>Final:</strong>  HIGH</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">GRADE: Factors That Upgrade Certainty</h2>
                <p class="animate delay-1">Observational evidence starts at LOW. It can be upgraded for:</p>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #22c55e;">+1</div>
                  <div class="lesson-content">
                    <h4>Large Magnitude of Effect</h4>
                    <p>RR &gt;2 or &lt;0.5 with no plausible confounding</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background: #22c55e;">+1</div>
                  <div class="lesson-content">
                    <h4>Dose-Response Gradient</h4>
                    <p>Higher exposure = larger effect in a consistent pattern</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background: #22c55e;">+1</div>
                  <div class="lesson-content">
                    <h4>Residual Confounding</h4>
                    <p>All plausible confounders would reduce the effect (strengthens causal inference)</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="12">
              <div class="content">
                <h2 class="title navy animate">Communicating Certainty</h2>
                <p class="animate delay-1">GRADE requires transparent language about confidence:</p>
                <div class="card animate delay-2">
                  <p class="card-text"><strong>HIGH:</strong> "Prophylactic surfactant <em>reduces</em> mortality..."</p>
                </div>
                <div class="card animate delay-3">
                  <p class="card-text"><strong>MODERATE:</strong> "Prophylactic surfactant <em>probably reduces</em> mortality..."</p>
                </div>
                <div class="card animate delay-4">
                  <p class="card-text"><strong>LOW:</strong> "Prophylactic surfactant <em>may reduce</em> mortality..."</p>
                </div>
                <div class="card animate delay-5">
                  <p class="card-text"><strong>VERY LOW:</strong> "We are <em>uncertain whether</em> prophylactic surfactant reduces mortality..."</p>
                </div>
                <p class="footnote animate delay-6">
                  This language ensures clinicians understand the strength of the evidence.
                </p>
              </div>
            </div>
            <!-- STORY: The Premature Baby Oxygen Paradox -->
            <div class="slide dark" data-index="12b">
              <div class="story-box animate">
                <p class="story-opener">Can too much of a lifesaver become a killer?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    <span class="data-highlight">1940s-50s:</span> High oxygen concentrations saved premature babies from respiratory failure.
                    Then came an <span class="data-highlight">epidemic of blindness</span>retrolental fibroplasia (now called ROP).
                    Doctors <span class="data-highlight">reduced oxygen dramatically</span>. Blindness dropped.
                    But then: <span class="data-highlight">increased deaths and brain damage</span> from hypoxia.
                    The optimal oxygen level required <span class="data-highlight">decades of trials</span> to find.
                    Recent SUPPORT/BOOST II trials finally defined the therapeutic window: SpO2 <span class="data-highlight">91-95%</span>.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Neonatologist's Dilemma: 1955</div>
                  <div class="decision-scenario">
                    You are a neonatologist. Premature babies on high oxygen are going blind. What do you do?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Dramatic Reduction</div>
                      <div class="path-choice">Drastically reduce oxygen to prevent blindness</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Blindness rates drop. But some babies die or suffer brain damage from hypoxia.</div>
                      <div class="path-outcome">OUTCOME: Trading one harm for another</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Systematic Study</div>
                      <div class="path-choice">Carefully titrate oxygen, study the dose-response relationship</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Takes decades but eventually identifies the optimal range.</div>
                      <div class="path-outcome">OUTCOME: Optimize both survival and vision</div>
                    </div>
                  </div>
                </div>

                <div class="story-timeline">
                  <div class="timeline-point">1940s: High O2 saves lives</div>
                  <div class="timeline-point critical">1950s: Blindness epidemic</div>
                  <div class="timeline-point critical">1960s-70s: Deaths from low O2</div>
                  <div class="timeline-point resolution">2010s: SUPPORT/BOOST define optimal range</div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    Every intervention has a therapeutic window. Finding it requires measurement, not assumption.
                    The pendulum swung for 60 years before evidence defined the balance.
                  </div>
                </div>
              </div>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="13">
              <div class="content">
                <h2 class="title navy animate">Module 10 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q10-1">
                    <h4>1. Why did the surfactant recommendation reverse between 2003 and 2012?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-1', 0, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
                        <span>A.</span> The original trials were fraudulent
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-1', 1, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
                        <span>B.</span> CPAP changed the comparator (indirectness)
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-1', 2, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
                        <span>C.</span> Not enough patients in original trials
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-1', 3, 1, ['The original trials were well-conducted.', 'Correct! CPAP changed the standard of care, making old evidence indirect.', 'Sample size was adequate.', 'The outcome definition stayed the same.'])">
                        <span>D.</span> The outcome was measured differently
                      </div>
                    </div>
                    <div id="q10-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q10-2" style="margin-top: 1.5rem;">
                    <h4>2. Which of the following is NOT a GRADE downgrade factor?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-2', 0, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
                        <span>A.</span> Risk of bias
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-2', 1, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
                        <span>B.</span> Imprecision
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-2', 2, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
                        <span>C.</span> Publication bias
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-2', 3, 3, ['Risk of bias downgrades certainty.', 'Imprecision downgrades certainty.', 'Publication bias downgrades certainty.', 'Correct! Large effect is an upgrade factor for observational studies, not a downgrade factor.'])">
                        <span>D.</span> Large magnitude of effect
                      </div>
                    </div>
                    <div id="q10-2-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q10-3" style="margin-top: 1.5rem;">
                    <h4>3. What language should be used for LOW certainty evidence?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-3', 0, 2, ['\"Reduces\" implies high confidence.', '\"Probably reduces\" implies moderate confidence.', 'Correct! \"May reduce\" signals low confidence.', '\"Uncertain\" is for very low confidence.'])">
                        <span>A.</span> "The intervention reduces..."
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-3', 1, 2, ['\"Reduces\" implies high confidence.', '\"Probably reduces\" implies moderate confidence.', 'Correct! \"May reduce\" signals low confidence.', '\"Uncertain\" is for very low confidence.'])">
                        <span>B.</span> "The intervention probably reduces..."
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-3', 2, 2, ['\"Reduces\" implies high confidence.', '\"Probably reduces\" implies moderate confidence.', 'Correct! \"May reduce\" signals low confidence.', '\"Uncertain\" is for very low confidence.'])">
                        <span>C.</span> "The intervention may reduce..."
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q10-3', 3, 2, ['\"Reduces\" implies high confidence.', '\"Probably reduces\" implies moderate confidence.', 'Correct! \"May reduce\" signals low confidence.', '\"Uncertain\" is for very low confidence.'])">
                        <span>D.</span> "We are uncertain whether..."
                      </div>
                    </div>
                    <div id="q10-3-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="14">
              <p class="closing-line animate">A number is not enough.</p>
              <p class="closing-line animate delay-1">You must communicate how certain you are.</p>
              <p class="closing-line gold animate delay-2">Certainty must be earned, not assumed.</p>
              <div class="gold-line animate delay-3"></div>
            </div>
            <div class="slide black" data-index="15">
              <p class="refrain animate">Methods protect patients from our confidence.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 11: The Living Review</p>
            </div>
          </div>

          <!-- Module 11: The Living Review (COVID-19) -->
          <div class="module-slides" data-module="11">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Methods protect patients from our confidence.</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">COVID-19 Hydroxychloroquine: 2020</p>
              <p class="title gold animate delay-1 text-center">When urgency met evidence.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 11: The Living Review</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Apply Trial Sequential Analysis to determine when evidence is sufficient</li>
                    <li>Design and maintain a living systematic review</li>
                    <li>Establish update triggers and futility/harm boundaries</li>
                    <li>Manage multiplicity and alpha-spending in sequential analyses</li>
                    <li>Explain how rapid evidence synthesis evolved during COVID-19</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">March 2020: A World in Crisis</h2>
                <p class="direct-address animate delay-1">
                  "The virus spreads faster than our understanding..."
                </p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    COVID-19 was killing thousands. ICUs overflowed. There was no vaccine, no treatment.
                    Then a glimmer of hope: <strong>hydroxychloroquine (HCQ)</strong>an old malaria drugshowed
                    antiviral activity in lab studies.
                  </p>
                </div>
                <div class="stats-grid animate delay-3">
                  <div class="stat-box">
                    <div class="stat-value">March 20</div>
                    <div class="stat-label">Gautret study (France)</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">36 pts</div>
                    <div class="stat-label">Non-randomized</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Viral</div>
                    <div class="stat-label">Clearance improved</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Rush to Adopt</h2>
                <p class="animate delay-1" style="font-style: italic;">Within weeks of the Gautret study:</p>
                <div class="wrong-item animate delay-2">
                  <div class="wrong-number" style="background: #f59e0b;">!</div>
                  <p><strong>March 28:</strong> FDA issues Emergency Use Authorization for HCQ</p>
                </div>
                <div class="wrong-item animate delay-3">
                  <div class="wrong-number" style="background: #f59e0b;">!</div>
                  <p><strong>April 4:</strong> India bans HCQ export (hoarding fears)</p>
                </div>
                <div class="wrong-item animate delay-4">
                  <div class="wrong-number" style="background: #f59e0b;">!</div>
                  <p><strong>Global:</strong> Shortages affect lupus and rheumatoid arthritis patients</p>
                </div>
                <div class="focus-box animate delay-5 mt-2" style="border-color: #f59e0b;">
                  <p class="main" style="color: #f59e0b;">Millions received HCQ based on a 36-patient observational study</p>
                  <p class="sub">What could go wrong?</p>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="4">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Investigation: The Gautret Study</h3>
                </div>
                <p class="direct-address">
                  You are an EBM expert asked to evaluate the French HCQ study. Examine the design...
                </p>
                <button class="reveal-btn" onclick="revealAnswer('hcq-flaws')">Identify the Flaws </button>
                <div id="hcq-flaws" class="hidden-reveal">
                  <table class="data-table-investigation" style="margin-top: 1rem;">
                    <thead><tr><th>Issue</th><th>Impact</th></tr></thead>
                    <tbody>
                      <tr><td><strong>Non-randomized</strong></td><td>Selection biaswho got HCQ?</td></tr>
                      <tr><td><strong>6 patients excluded</strong></td><td>3 went to ICU, 1 died, 1 withdrew, 1 had nausea</td></tr>
                      <tr><td><strong>Surrogate outcome</strong></td><td>Viral load, not clinical outcomes</td></tr>
                      <tr><td><strong>Control from different hospital</strong></td><td>Different care, different testing</td></tr>
                      <tr><td><strong>No blinding</strong></td><td>Expectation bias in lab testing</td></tr>
                    </tbody>
                  </table>
                  <div class="focus-box" style="margin-top: 1rem; border-color: #C53030;">
                    <p class="main" style="color: #C53030;">This study would score HIGH risk of bias on RoB 2.0</p>
                    <p class="sub">GRADE certainty: VERY LOW. Yet it changed global policy.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">Why Observational COVID Studies Misled</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number" style="background: #C53030;">1</div>
                  <div class="lesson-content">
                    <h4>Immortal Time Bias</h4>
                    <p>Patients must survive long enough to receive treatment. Survivors are compared to non-survivors.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #C53030;">2</div>
                  <div class="lesson-content">
                    <h4>Confounding by Indication</h4>
                    <p>Sicker patients may get different treatments. Healthier patients received HCQ early.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background: #C53030;">3</div>
                  <div class="lesson-content">
                    <h4>Healthy User Effect</h4>
                    <p>Patients who seek treatment tend to be healthier overall.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background: #C53030;">4</div>
                  <div class="lesson-content">
                    <h4>Outcome Reporting</h4>
                    <p>Studies with positive results got published faster.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="6">
              <div class="content">
                <h2 class="title navy animate">June 2020: The RCTs Report</h2>
                <p class="animate delay-1" style="font-style: italic;">Large, rigorous trials completed at remarkable speed</p>
                <table class="results-table animate delay-2">
                  <thead>
                    <tr><th>Trial</th><th>N</th><th>Result</th></tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>RECOVERY (UK)</td>
                      <td>4,716</td>
                      <td style="color: #C53030;">No benefit on mortality (RR 1.09)</td>
                    </tr>
                    <tr>
                      <td>WHO SOLIDARITY</td>
                      <td>954</td>
                      <td style="color: #C53030;">No benefit (RR 1.19)</td>
                    </tr>
                    <tr>
                      <td>ORCHID (US)</td>
                      <td>479</td>
                      <td style="color: #C53030;">Stopped for futility</td>
                    </tr>
                  </tbody>
                </table>
                <div class="result-box animate delay-3" style="background: rgba(197, 48, 48, 0.2); border-color: #C53030;">
                  <div class="value">HCQ provided no benefitand may have caused harm</div>
                  <div class="label">June 15, 2020: FDA revokes Emergency Use Authorization</div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="7">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>Timeline: Observational vs. RCT Evidence</h3>
                </div>
                <div class="comparison-grid" style="margin-top: 1rem;">
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">March-May 2020</h4>
                    <p><strong>Observational:</strong> ~20 studies</p>
                    <p style="color: #22c55e;">Suggest benefit</p>
                    <p style="font-size: 0.85rem;">Pooled OR ~0.65</p>
                  </div>
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">June-July 2020</h4>
                    <p><strong>RCTs:</strong> RECOVERY, SOLIDARITY</p>
                    <p style="color: #C53030;">Show no benefit/harm</p>
                    <p style="font-size: 0.85rem;">Pooled RR ~1.10</p>
                  </div>
                </div>
                <div class="focus-box" style="margin-top: 1rem;">
                  <p class="main">From "promising" to "ineffective" in 3 months</p>
                  <p class="sub">This is why we need randomizationand living reviews to track evolving evidence.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">Living Systematic Reviews</h2>
                <p class="animate delay-1">A new approach for rapidly evolving evidence:</p>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #22c55e;">1</div>
                  <div class="lesson-content">
                    <h4>Continuous Surveillance</h4>
                    <p>Search literature weekly or even daily for new evidence</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background: #22c55e;">2</div>
                  <div class="lesson-content">
                    <h4>Cumulative Meta-Analysis</h4>
                    <p>Update pooled estimates as each new trial reports</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background: #22c55e;">3</div>
                  <div class="lesson-content">
                    <h4>Trial Sequential Analysis (TSA)</h4>
                    <p>Determine when sufficient information has accumulated to conclude</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-5">
                  <div class="lesson-number" style="background: #22c55e;">4</div>
                  <div class="lesson-content">
                    <h4>Transparent Versioning</h4>
                    <p>Track every change, maintain full audit trail</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Trial Sequential Analysis (TSA)</h2>
                <p class="animate delay-1" style="font-style: italic;">When have we learned enough?</p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    TSA applies stopping boundaries to meta-analysissimilar to interim analysis in a single trial.
                    It accounts for the <strong>required information size (RIS)</strong> needed to detect or exclude
                    a clinically meaningful effect.
                  </p>
                </div>
                <div class="stats-grid animate delay-3">
                  <div class="stat-box">
                    <div class="stat-value">RIS</div>
                    <div class="stat-label">Required sample size</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">-spending</div>
                    <div class="stat-label">Controls type I error</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Boundaries</div>
                    <div class="stat-label">Benefit / Harm / Futility</div>
                  </div>
                </div>
                <p class="footnote animate delay-4">
                  For HCQ in COVID, TSA showed futility boundary was crossed by June 2020.
                </p>
              </div>
            </div>
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Lessons from the HCQ Saga</h2>
                <div class="card animate delay-1">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>1. Observational studies can mislead spectacularly</strong> when bias is prevalent.
                    Even many studies pointing the same direction can be wrong.
                  </p>
                </div>
                <div class="card animate delay-2">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>2. RCTs can be conducted quickly</strong> when the will exists.
                    RECOVERY enrolled 5,000+ patients in weeks.
                  </p>
                </div>
                <div class="card animate delay-3">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>3. Living reviews are essential</strong> for evolving topics.
                    Fixed-point-in-time reviews become obsolete instantly.
                  </p>
                </div>
                <div class="card animate delay-4">
                  <p class="card-text" style="font-size: 1.1rem;">
                    <strong>4. Political pressure doesn't change biology.</strong>
                    Rigorous methods protect patients even when under pressure.
                  </p>
                </div>
              </div>
            </div>
            <!-- STORY: The LEAP Peanut Allergy Revolution -->
            <div class="slide dark" data-index="10b">
              <div class="story-box animate">
                <p class="story-opener">What if the prevention IS the cause?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    For decades, pediatric guidelines recommended: <span class="data-highlight">avoid peanuts in infancy</span> to prevent allergy.
                    Meanwhile, peanut allergy rates <span class="data-highlight">tripled</span> from 1997 to 2008.
                    Then came <span class="data-highlight">LEAP (2015)</span>: 640 high-risk infants randomized to
                    early peanut introduction vs. avoidance.
                    Result: Early introduction <span class="data-highlight">reduced peanut allergy by 81%</span> (1.9% vs 13.7%).
                    The prevention strategy was causing the epidemic.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Allergist's Crossroads: 2010</div>
                  <div class="decision-scenario">
                    You are a pediatric allergist. Peanut allergies are rising despite avoidance guidelines. Do you question the dogma?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Follow Guidelines</div>
                      <div class="path-choice">Continue recommending peanut avoidance in high-risk infants</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Guidelines are "evidence-based." Safe to follow consensus.</div>
                      <div class="path-outcome">OUTCOME: Peanut allergies continue to rise</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Question the Dogma</div>
                      <div class="path-choice">Design a trial to test if early introduction might be protective</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">LEAP trial reveals the truth. Guidelines reverse worldwide.</div>
                      <div class="path-outcome">OUTCOME: Prevent an epidemic</div>
                    </div>
                  </div>
                </div>

                <div class="story-timeline">
                  <div class="timeline-point">2000: AAP recommends avoidance</div>
                  <div class="timeline-point critical">2008: Allergy rates triple</div>
                  <div class="timeline-point resolution">2015: LEAP reverses the evidence</div>
                  <div class="timeline-point resolution">2017: Guidelines flip to early introduction</div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    "First, do no harm" requires evidence. Assumptions, even well-intentioned ones, can cause harm at scale.
                    The immune system needed exposure to develop toleranceavoidance created sensitization.
                  </div>
                </div>
              </div>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">Module 11 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q11-1">
                    <h4>1. What was the main flaw in the Gautret hydroxychloroquine study?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-1', 0, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
                        <span>A.</span> Too few patients
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-1', 1, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
                        <span>B.</span> No blinding
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-1', 2, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
                        <span>C.</span> Excluding patients who deteriorated
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-1', 3, 2, ['Sample size was indeed small but not the main issue.', 'Blinding was missing but not the main issue.', 'Correct! Excluding 6 patients (including ICU/death) from HCQ group created severe selection bias.', 'Follow-up was adequate.'])">
                        <span>D.</span> Too short follow-up
                      </div>
                    </div>
                    <div id="q11-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q11-2" style="margin-top: 1.5rem;">
                    <h4>2. What does Trial Sequential Analysis help determine?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-2', 0, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
                        <span>A.</span> Which studies have high risk of bias
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-2', 1, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
                        <span>B.</span> When enough evidence has accumulated
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-2', 2, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
                        <span>C.</span> The degree of heterogeneity
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-2', 3, 1, ['TSA doesn\\'t identify bias directly.', 'Correct! TSA determines when cumulative evidence reaches required information size.', 'Heterogeneity is assessed separately.', 'TSA doesn\\'t rank treatments.'])">
                        <span>D.</span> Which treatment is best
                      </div>
                    </div>
                    <div id="q11-2-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q11-3" style="margin-top: 1.5rem;">
                    <h4>3. Why did observational COVID studies show HCQ benefit while RCTs did not?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-3', 0, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
                        <span>A.</span> RCTs enrolled sicker patients
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-3', 1, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
                        <span>B.</span> RCTs used different outcomes
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-3', 2, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
                        <span>C.</span> Bias in observational studies
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q11-3', 3, 2, ['Patient populations were similar.', 'RCTs measured the same outcomes.', 'Correct! Immortal time bias and confounding by indication created false apparent benefit.', 'Observational data quality was adequate.'])">
                        <span>D.</span> Observational studies had better data
                      </div>
                    </div>
                    <div id="q11-3-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="12">
              <p class="closing-line animate">Speed cannot replace rigor.</p>
              <p class="closing-line animate delay-1">But rigor can be fast.</p>
              <p class="closing-line gold animate delay-2">Living reviews balance both.</p>
              <div class="gold-line animate delay-3"></div>
            </div>
            <div class="slide black" data-index="13">
              <p class="refrain animate">Not every signal is truth.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 12: Advanced Methods</p>
            </div>
          </div>

          <!-- Module 12: Advanced Methods -->
          <div class="module-slides" data-module="12">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Not every signal is truth.</p>
            </div>
            <div class="slide dark" data-index="1">
              <p class="title cream animate text-center">Advanced Methods</p>
              <p class="title gold animate delay-1 text-center">Beyond pairwise meta-analysis.</p>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Module 12: Advanced Methods</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Interpret network meta-analysis geometry and SUCRA rankings</li>
                    <li>Apply bivariate models for diagnostic test accuracy meta-analysis</li>
                    <li>Conduct dose-response meta-analysis with flexible splines</li>
                    <li>Understand when individual patient data (IPD) meta-analysis is needed</li>
                    <li>Recognize the assumptions and limitations of each advanced method</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">When Pairwise Is Not Enough</h2>
                <p class="direct-address animate delay-1">
                  "Sometimes the question is more complex than A versus B..."
                </p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    The methods you've learned form the foundation. But clinical reality often demands more:
                    <strong>Which of 10 antidepressants is best?</strong> <strong>What's the optimal dose of statin?</strong>
                    <strong>Does this test accurately diagnose early cancer?</strong>
                  </p>
                </div>
                <p class="footnote animate delay-3">
                  This module introduces four advanced methodseach answering different complex questions.
                </p>
              </div>
            </div>
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">Network Meta-Analysis (NMA)</h2>
                <p class="animate delay-1" style="font-style: italic;">When you have many treatments but few head-to-head trials</p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    NMA combines <strong>direct evidence</strong> (A vs B) with <strong>indirect evidence</strong>
                    (A vs C, B vs C  inferred A vs B) to compare multiple treatments simultaneously.
                  </p>
                </div>
                <div class="stats-grid animate delay-3">
                  <div class="stat-box">
                    <div class="stat-value">SUCRA</div>
                    <div class="stat-label">Ranking probabilities, not effect size</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Consistency</div>
                    <div class="stat-label">Direct = Indirect?</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Networks</div>
                    <div class="stat-label">Visualize evidence</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide dark" data-index="4">
              <div class="investigation-box animate">
                <div class="investigation-header">
                  <span class="icon"></span>
                  <h3>NMA Example: Antidepressants</h3>
                </div>
                <p class="direct-address">
                  The landmark Cipriani 2018 NMA compared 21 antidepressants using 522 trials.
                </p>
                <div class="comparison-grid" style="margin-top: 1rem;">
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">The Challenge</h4>
                    <p>21 drugs, but not every pair tested head-to-head</p>
                    <p style="font-size: 0.85rem;">Many vs. placebo, few vs. each other</p>
                  </div>
                  <div class="comparison-box">
                    <h4 style="color: var(--gold);">The Solution</h4>
                    <p>NMA combines direct and indirect evidence across the network</p>
                    <p style="font-size: 0.85rem;">Produces comparative estimates and rankings, with uncertainty and assumptions made explicit</p>
                  </div>
                </div>
                <div class="focus-box" style="margin-top: 1rem;">
                  <p class="main">Result: Some drugs ranked higher for efficacy, others for acceptability</p>
                  <p class="sub">No single drug is universally "best"; interpret rankings with credible intervals, transitivity, and clinical trade-offs.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">NMA: Critical Assumptions</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number" style="background: #f59e0b;">1</div>
                  <div class="lesson-content">
                    <h4>Transitivity</h4>
                    <p>Effect modifiers should be similarly distributed across comparisons; otherwise indirect comparisons may be biased</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #f59e0b;">2</div>
                  <div class="lesson-content">
                    <h4>Consistency</h4>
                    <p>Direct and indirect estimates should agree within uncertainty; test globally and locally, then investigate discrepancies</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background: #f59e0b;">3</div>
                  <div class="lesson-content">
                    <h4>Connected Network</h4>
                    <p>All treatments linked through at least one common comparator</p>
                  </div>
                </div>
                <div class="focus-box animate delay-4 mt-2">
                  <p class="main">When assumptions fail, NMA can mislead</p>
                  <p class="sub">Always assess transitivity and test for inconsistency.</p>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="6">
              <div class="content">
                <h2 class="title navy animate">Dose-Response Meta-Analysis</h2>
                <p class="animate delay-1" style="font-style: italic;">Finding the optimal dose</p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    Uses the <strong>Greenland-Longnecker method</strong> with restricted cubic splines
                    to model non-linear relationships between dose and effect.
                  </p>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Non-linear patterns</h4>
                    <p>J-shaped (alcohol & mortality), U-shaped (vitamin D), threshold (aspirin)</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Clinical relevance</h4>
                    <p>Find dose with best benefit-harm balance, not just "more is better"</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">Individual Patient Data (IPD)</h2>
                <p class="animate delay-1" style="font-style: italic;">The gold standard for subgroup analysis</p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    Instead of published summary data, obtain <strong>raw patient-level data</strong> from trialists.
                    Enables precise subgroup analyses, time-to-event modeling, and standardized definitions.
                  </p>
                </div>
                <div class="stats-grid animate delay-3">
                  <div class="stat-box">
                    <div class="stat-value">One-Stage</div>
                    <div class="stat-label">Single hierarchical model (not mega-trial)</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Two-Stage</div>
                    <div class="stat-label">Analyze, then pool</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">80%+ target</div>
                    <div class="stat-label">Data availability goal</div>
                  </div>
                </div>
                <p class="footnote animate delay-4">
                  The Early Breast Cancer Trialists' Collaborative Group pioneered IPD MA in the 1980s.
                </p>
              </div>
            </div>
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">Diagnostic Test Accuracy (DTA)</h2>
                <p class="animate delay-1" style="font-style: italic;">When the "intervention" is a test</p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    DTA meta-analysis synthesizes <strong>sensitivity</strong> (true positive rate) and
                    <strong>specificity</strong> (true negative rate)two correlated outcomes requiring
                    bivariate models.
                  </p>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Bivariate/HSROC Model</h4>
                    <p>Accounts for correlation between sensitivity and specificity</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>SROC Curve</h4>
                    <p>Summary ROC curve with 95% confidence and prediction regions</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-5">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>QUADAS-2</h4>
                    <p>Quality Assessment of Diagnostic Accuracy Studies</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Choosing the Right Method</h2>
                <table class="results-table animate delay-1">
                  <thead>
                    <tr><th>Question</th><th>Method</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>Does A beat B?</td><td><strong>Pairwise MA</strong></td></tr>
                    <tr><td>Which of many treatments is best?</td><td><strong>Network MA (NMA)</strong></td></tr>
                    <tr><td>What is the optimal dose?</td><td><strong>Dose-Response MA</strong></td></tr>
                    <tr><td>Who benefits most? (subgroups)</td><td><strong>IPD MA</strong></td></tr>
                    <tr><td>How accurate is this test?</td><td><strong>DTA MA</strong></td></tr>
                    <tr><td>How does the effect evolve over time?</td><td><strong>Survival/Time-to-Event MA</strong></td></tr>
                  </tbody>
                </table>
                <p class="footnote animate delay-2">The method must match the question. Never force a question into the wrong method.</p>
              </div>
            </div>
            <!-- STORY: The Steroids in Sepsis Saga -->
            <div class="slide dark" data-index="9b">
              <div class="story-box animate">
                <p class="story-opener">Three large trials. Three different answers. What do you believe?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    <span class="data-highlight">CORTICUS (2008):</span> 499 patients. Hydrocortisone in septic shock. <span class="data-highlight">No mortality benefit</span>.
                    <span class="data-highlight">ADRENAL (2018):</span> 3,658 patients. Hydrocortisone. <span class="data-highlight">No mortality benefit</span>.
                    <span class="data-highlight">APROCCHSS (2018):</span> 1,241 patients. Hydrocortisone + fludrocortisone. <span class="data-highlight">Mortality reduced</span> (43% vs 49.1%, p=0.03).
                    Same class of intervention. Different protocols. Different results.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Guidelines Writer's Challenge</div>
                  <div class="decision-scenario">
                    You are writing sepsis guidelines. Three major trials disagree. How do you recommend?
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Simple Average</div>
                      <div class="path-choice">Pool all three trials. Overall effect uncertain. Conclude "evidence unclear."</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Guidelines say steroids are optional. No strong recommendation.</div>
                      <div class="path-outcome">OUTCOME: Clinicians left without clear guidance</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: Investigate Heterogeneity</div>
                      <div class="path-choice">Analyze why APROCCHSS differed (fludrocortisone, longer duration, different population)</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Identify that the effective protocol differs from the ineffective ones.</div>
                      <div class="path-outcome">OUTCOME: Recommend the specific effective protocol</div>
                    </div>
                  </div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    Conflicting trials are not failures. They are maps of where the treatment works and where it does not.
                    The differences between trialsdose, duration, co-interventions, populationare the key to understanding.
                  </div>
                </div>
              </div>
            </div>
            <!-- Quiz -->
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Module 12 Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q12-1">
                    <h4>1. What is the key advantage of Network Meta-Analysis over pairwise?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-1', 0, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
                        <span>A.</span> It doesn't require data extraction
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-1', 1, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
                        <span>B.</span> It compares treatments not directly tested against each other
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-1', 2, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
                        <span>C.</span> It eliminates the need for risk of bias assessment
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-1', 3, 1, ['All MA requires data extraction.', 'Correct! NMA combines direct and indirect evidence to compare treatments without head-to-head trials.', 'NMA still requires quality assessment.', 'Forest plots work differently.'])">
                        <span>D.</span> It produces better forest plots
                      </div>
                    </div>
                    <div id="q12-1-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q12-2" style="margin-top: 1.5rem;">
                    <h4>2. Why does DTA meta-analysis require bivariate models?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-2', 0, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
                        <span>A.</span> To handle more than two studies
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-2', 1, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
                        <span>B.</span> To adjust for publication bias
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-2', 2, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
                        <span>C.</span> Sensitivity and specificity are correlated
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-2', 3, 2, ['Univariate models can sometimes be appropriate.', 'DTA has other specific requirements.', 'Correct! Sensitivity and specificity trade off against each other and must be modeled together.', 'Forest plots are used differently.'])">
                        <span>D.</span> To generate forest plots
                      </div>
                    </div>
                    <div id="q12-2-feedback" style="display: none;"></div>
                  </div>
                  <div class="quiz-question" id="q12-3" style="margin-top: 1.5rem;">
                    <h4>3. What does the "consistency" assumption in NMA require?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-3', 0, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
                        <span>A.</span> All studies must be high quality
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-3', 1, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
                        <span>B.</span> Direct and indirect evidence must agree
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-3', 2, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
                        <span>C.</span> Sample sizes must be similar
                      </div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q12-3', 3, 1, ['Quality is assessed separately.', 'Correct! If direct evidence says A beats B by X, indirect evidence should agree.', 'Sample sizes vary in real networks.', 'Missing studies are a separate concern.'])">
                        <span>D.</span> No missing studies
                      </div>
                    </div>
                    <div id="q12-3-feedback" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="11" data-tier="mastery">
              <span class="tier-badge mastery">Methodologist</span>
              <div class="content">
                <h2 class="title navy animate">The Course Ecosystem</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  This course covers the full systematic review workflow. For deep dives, explore the companion courses:
                </p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; max-width: 700px; font-size: 0.85rem;" class="animate delay-2">
                  <div class="card" style="padding: 0.5rem 0.75rem;"><strong>DTA Course</strong><br>Bivariate/HSROC, SROC curves, QUADAS-2</div>
                  <div class="card" style="padding: 0.5rem 0.75rem;"><strong>Risk of Bias Mastery</strong><br>RoB 2, ROBINS-I/E, domain-level assessment</div>
                  <div class="card" style="padding: 0.5rem 0.75rem;"><strong>GRADE Certainty</strong><br>Full SoF tables, GRADE-CERQual</div>
                  <div class="card" style="padding: 0.5rem 0.75rem;"><strong>IPD Meta-Analysis</strong><br>One-stage/two-stage, mixed-effects models</div>
                  <div class="card" style="padding: 0.5rem 0.75rem;"><strong>Publication Bias Detective</strong><br>Copas, PET-PEESE, p-curve, selection models</div>
                  <div class="card" style="padding: 0.5rem 0.75rem;"><strong>Umbrella Reviews</strong><br>AMSTAR 2, ROBIS, overlap correction</div>
                  <div class="card" style="padding: 0.5rem 0.75rem;"><strong>Prognostic Reviews</strong><br>CHARMS, PROBAST, c-statistic pooling</div>
                  <div class="card" style="padding: 0.5rem 0.75rem;"><strong>Living Reviews + Rapid Reviews</strong><br>TSA, update triggers, abbreviated methods</div>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="12">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 12 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "The method must match the question. Advanced methods answer advanced questions&mdash;but the fundamentals never change."
                </p>
                <p class="animate delay-3" style="font-size: 1rem; margin-top: 1.5rem; opacity: 0.8;">
                  You have mastered the core workflow. The next ten modules explore the frontier:
                  Bayesian inference, network meta-analysis, individual patient data, dose&ndash;response modelling,
                  robustness and fragility, equity, AI-assisted synthesis, qualitative evidence,
                  multivariate methods, and reproducibility.
                </p>
              </div>
            </div>
            <div class="slide black" data-index="12">
              <p class="refrain animate">Not every signal is truth.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 13: The Bayesian Turn</p>
            </div>
          </div>

          <!-- ============================================================
               MODULE 13: THE BAYESIAN TURN (STAMPEDE platform trial)
               ============================================================ -->
          <div class="module-slides" data-module="13">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Not every signal is truth.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 13: The Bayesian Turn</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 13: The Bayesian Turn</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Explain the difference between frequentist and Bayesian inference</li>
                    <li>Interpret prior distributions, likelihoods, and posterior distributions</li>
                    <li>Distinguish credible intervals from confidence intervals</li>
                    <li>Understand when Bayesian meta-analysis offers advantages</li>
                    <li>Recognize how prior choice affects conclusions</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Story opener: STAMPEDE -->
            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">In 2005, a trial began</p>
              <p class="title gold animate delay-1 text-center">that would never truly end.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                The STAMPEDE trial for prostate cancer used a multi-arm, multi-stage (MAMS) platform design.
                Arms could be added or dropped as evidence accumulated. Though its statistics were frequentist, the adaptive philosophy embodied the Bayesian spirit: updating decisions as data accumulate.
              </p>
            </div>

            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Frequentist Worldview</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    In frequentist statistics, probability means <strong>long-run frequency</strong>.
                    A 95% CI does NOT mean "95% probability the true effect is inside."
                    It means: if we repeated the study infinitely, 95% of intervals would contain the truth.
                  </p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">p-value</div>
                    <div class="stat-label">P(data | H), not P(H | data)</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">95% CI</div>
                    <div class="stat-label">Coverage property, not belief</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Fixed</div>
                    <div class="stat-label">The true parameter is fixed</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">The Bayesian Worldview</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    In Bayesian statistics, probability represents <strong>degree of belief</strong>.
                    We start with a <strong>prior</strong> (what we believe before data), update with the
                    <strong>likelihood</strong> (what data tells us), and get a <strong>posterior</strong> (updated belief).
                  </p>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Prior &times; Likelihood = Posterior</h4>
                    <p>Bayes' theorem: P(&theta;|data) &prop; P(data|&theta;) &times; P(&theta;)</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Credible Intervals</h4>
                    <p>A 95% credible interval is probabilistically interpretable, conditional on the specified model and prior.</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="5" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Choosing Priors</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Non-informative (Vague)</h4>
                    <p>Very diffuse priors can reduce prior influence but may be unstable on some scales; weakly informative priors are often safer defaults.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Weakly Informative</h4>
                    <p>Normal(0, 1) for log-OR. Regularizes extreme estimates while remaining flexible.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Informative</h4>
                    <p>Based on previous evidence. Powerful but controversial. Must be pre-specified.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content">
                    <h4>Half-Cauchy for &tau;</h4>
                    <p>A commonly used weakly informative prior family for heterogeneity. Half-Cauchy(0, 0.5) allows large &tau; but concentrates near zero.</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="6" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">MCMC Sampling</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Most Bayesian models cannot be solved analytically. We use
                    <strong>Markov Chain Monte Carlo</strong> (MCMC) to draw samples from the posterior.
                    Tools: JAGS, Stan, brms (R), PyMC (Python).
                  </p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">Chains</div>
                    <div class="stat-label">Multiple independent chains (typically 4)</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">R&#770;</div>
                    <div class="stat-label">Convergence: R&#770; &lt; 1.01 (strict; older texts use &lt; 1.1)</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">ESS</div>
                    <div class="stat-label">Bulk-ESS &gt; 400 for means; tail-ESS &gt; 400 for CIs</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="7" data-tier="mastery">
              <span class="tier-badge mastery">Methodologist</span>
              <div class="content">
                <h2 class="title navy animate">Bayesian Model Averaging</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Instead of choosing between fixed-effect and random-effects models,
                    <strong>Bayesian model averaging</strong> (BMA) weights each model by its posterior probability.
                    This accounts for model uncertainty in the final estimate.
                  </p>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">BF</div>
                  <div class="lesson-content">
                    <h4>Bayes Factors</h4>
                    <p>Interpretation bands are conventions (not absolutes) and can change with prior choices; always report sensitivity to priors.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Interactive tool placeholder -->
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">Interactive: Posterior Visualizer</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Adjust the prior strength to see how it affects the posterior. Watch how more data overwhelms the prior.
                </p>
                <div id="bayesianPosteriorTool" class="animate delay-2" style="min-height: 300px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
                  <div style="margin-bottom: 1rem;">
                    <label style="font-weight:600;">Prior Strength: <span id="priorStrengthLabel">Vague</span></label><br>
                    <input type="range" id="priorStrengthSlider" min="0" max="100" value="10" style="width:100%;" oninput="updateBayesianPosterior()">
                  </div>
                  <div style="margin-bottom: 1rem;">
                    <label style="font-weight:600;">Prior Mean (log-OR): <span id="priorMeanLabel">0.00</span></label><br>
                    <input type="range" id="priorMeanSlider" min="-200" max="200" value="0" style="width:100%;" oninput="updateBayesianPosterior()">
                  </div>
                  <div id="bayesianPlotArea" style="width:100%; min-height:220px;"></div>
                </div>
              </div>
            </div>

            <!-- Story box -->
            <div class="slide dark" data-index="9">
              <div class="content" style="max-width: 700px;">
                <div class="story-box animate">
                  <h3 style="color: var(--gold); margin-bottom: 1rem;">The STAMPEDE Story</h3>
                  <p style="margin-bottom: 0.75rem;">
                    STAMPEDE launched in 2005 with 5 research arms comparing treatments for advanced prostate cancer.
                    By 2016 it had added abiraterone and shown a 37% reduction in death (HR 0.63, 95% CI 0.52&ndash;0.76).
                  </p>
                  <p style="margin-bottom: 0.75rem;">
                    The platform design embodies Bayesian adaptive thinking: interim analyses guide arm selection,
                    new arms can enter as treatments emerge, and futile arms drop early&mdash;saving patients from
                    ineffective therapies.
                  </p>
                  <p style="font-style: italic; opacity: 0.9;">
                    STAMPEDE enrolled over 10,000 patients across 100+ centers and fundamentally changed
                    prostate cancer care. The Bayesian mindset let evidence accumulate and inform decisions
                    in real time.
                  </p>
                </div>
              </div>
            </div>

            <!-- Decision tree -->
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Decision Tree: When to Go Bayesian?</h2>
                <div class="decision-tree animate delay-1">
                  <div class="decision-tree-header">Frequentist vs Bayesian Meta-Analysis</div>
                  <div class="decision-scenario">
                    Choose Bayesian when: (1) you have genuine prior information, (2) you need probabilistic statements ("80% chance effect &gt; 0"), (3) few studies make frequentist properties unreliable, or (4) you want to do model averaging.
                  </div>
                  <div class="decision-options">
                    <div class="decision-option correct">
                      <div class="decision-label">Bayesian with weakly informative prior</div>
                      <div class="decision-detail">A common practical default. Regularizes extreme estimates without forcing strong prior conclusions.</div>
                    </div>
                    <div class="decision-option">
                      <div class="decision-label">Bayesian with informative prior</div>
                      <div class="decision-detail">Only when prior evidence is strong and pre-specified. Must do sensitivity analysis.</div>
                    </div>
                    <div class="decision-option">
                      <div class="decision-label">Stay frequentist</div>
                      <div class="decision-detail">Simpler, well-understood. Preferred when k is large and no prior information.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Callback -->
            <div class="slide dark" data-index="11">
              <div class="content" style="text-align: center;">
                <p class="animate" style="font-size: 1.1rem; opacity: 0.7;">Remember Module 1?</p>
                <p class="title gold animate delay-1">CAST Through a Bayesian Lens</p>
                <div class="gold-line animate delay-2"></div>
                <p class="animate delay-3" style="max-width: 600px; font-size: 1.05rem;">
                  Had a Bayesian analysis of CAST used an informative prior from basic science (antiarrhythmics suppress PVCs),
                  the posterior would still have shifted strongly toward harm. With enough data, even a strong prior yields to the likelihood.
                  The lesson: Bayesian methods don't protect against bad priors&mdash;but they make the assumptions <em>transparent</em>.
                </p>
              </div>
            </div>

            <!-- Quiz -->
            <div class="slide light" data-index="12">
              <div class="content">
                <h2 class="title navy animate">Module 13 Quiz</h2>
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q1.</strong> What does a 95% Bayesian credible interval mean?</p>
                  <div class="quiz-options" id="m13-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 0, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
                      <span>A.</span> 95% of repeated experiments would produce intervals containing the true value
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 1, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
                      <span>B.</span> Given the model and prior, there is a 95% posterior probability the parameter lies in this interval
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 2, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
                      <span>C.</span> The interval has a 95% chance of being correct
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m13-q1', 3, 1, ['That is the frequentist interpretation of a confidence interval.', 'Correct! Under the specified model and prior, a credible interval gives posterior probability for the parameter range.', 'Credible intervals have a direct probabilistic interpretation conditional on assumptions.', 'Bayesian intervals are about the parameter, not future data.'])">
                      <span>D.</span> 95% of future data will fall in this range
                    </div>
                  </div>
                  <div id="m13-q1-feedback" style="display: none;"></div>
                </div>

                <div class="quiz-box animate delay-2">
                  <p class="quiz-question"><strong>Q2.</strong> Which is a commonly used weakly informative prior family for between-study heterogeneity (&tau;)?</p>
                  <div class="quiz-options" id="m13-q2">
                    <div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 0, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
                      <span>A.</span> Uniform(0, 100)
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 1, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
                      <span>B.</span> Normal(0, 1)
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 2, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
                      <span>C.</span> Half-Cauchy(0, 0.5)
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m13-q2', 3, 2, ['Uniform priors on variance can be improper and favor large heterogeneity.', 'Normal priors are used for effect parameters, not variance.', 'Correct! Half-Cauchy priors are commonly used and should be justified with sensitivity analyses.', 'Fixed values eliminate uncertainty about heterogeneity, defeating the purpose.'])">
                      <span>D.</span> Fixed at 0.5
                    </div>
                  </div>
                  <div id="m13-q2-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>

            <!-- Closing ceremony -->
            <div class="slide dark" data-index="13">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 13 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "The Bayesian turn is not about mathematics. It is about honesty&mdash;making our assumptions visible."
                </p>
              </div>
            </div>

            <!-- Transition -->
            <div class="slide black" data-index="14">
              <p class="refrain animate">Not every signal is truth.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 14: The Network</p>
            </div>
          </div>

          <!-- ============================================================
               MODULE 14: THE NETWORK (Cipriani 2018  21 antidepressants)
               ============================================================ -->
          <div class="module-slides" data-module="14">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Methods protect patients from our confidence.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 14: The Network</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 14: The Network</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Explain why pairwise comparisons are insufficient when many treatments exist</li>
                    <li>Interpret network geometry (nodes, edges, thickness)</li>
                    <li>Understand transitivity, consistency, and the role of indirect evidence</li>
                    <li>Interpret SUCRA rankings and league tables</li>
                    <li>Recognize when NMA assumptions are violated</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Story: Cipriani 2018 -->
            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">A clinician faces a patient</p>
              <p class="title gold animate delay-1 text-center">with depression. Which drug?</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                There are 21 commonly prescribed antidepressants. Most head-to-head trials compare only 2 or 3.
                Cipriani et al. (2018, Lancet) connected 522 trials and 116,477 patients into a single network.
              </p>
            </div>

            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Logic of Network Meta-Analysis</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Direct Evidence</h4>
                    <p>Trials directly comparing A vs B give the most reliable estimate.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Indirect Evidence</h4>
                    <p>If A vs C and B vs C exist, we can infer A vs B. This is the "transitive" assumption.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Mixed Evidence</h4>
                    <p>NMA combines both, weighted by precision, to rank all treatments simultaneously.</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">Interactive: Network Graph</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Each node is a treatment. Edge thickness represents the number of studies comparing those two treatments.
                </p>
                <div id="nmaNetworkTool" class="animate delay-2" style="min-height: 350px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
                  <div id="nmaNetworkArea" style="width:100%; min-height:320px;"></div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="5" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Transitivity &amp; Consistency</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    <strong>Transitivity</strong>: Effect modifiers should be similarly distributed across comparisons, so indirect comparisons are clinically coherent.
                  </p>
                </div>
                <div class="card animate delay-2" style="margin-top: 1rem;">
                  <p class="card-text">
                    <strong>Consistency</strong>: Agreement between direct and indirect estimates within uncertainty.
                    Global (design-by-treatment interaction) and local (node-splitting) tests help identify potential inconsistency loops.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="6" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">SUCRA &amp; P-scores</h2>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box">
                    <div class="stat-value">SUCRA</div>
                    <div class="stat-label">Surface Under Cumulative Ranking. Higher values indicate better ranking probability, not guaranteed superiority.</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">P-score</div>
                    <div class="stat-label">Frequentist analogue to ranking probability summaries. Interpret with effect sizes and uncertainty.</div>
                  </div>
                </div>
                <div class="card animate delay-2" style="margin-top: 1rem;">
                  <p class="card-text">
                    <strong>Caution:</strong> Ranking is seductive but misleading when differences between treatments are small
                    or uncertain. Always report credible/confidence intervals alongside ranks.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="7" data-tier="mastery">
              <span class="tier-badge mastery">Methodologist</span>
              <div class="content">
                <h2 class="title navy animate">Component NMA</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    When interventions are complex (e.g., behavioral + pharmacological), <strong>component NMA</strong>
                    decomposes multi-component treatments to estimate the individual contribution of each component.
                    Uses additive models: effect(A+B) = effect(A) + effect(B) + interaction.
                  </p>
                </div>
              </div>
            </div>

            <!-- Story box -->
            <div class="slide dark" data-index="8">
              <div class="content" style="max-width: 700px;">
                <div class="story-box animate">
                  <h3 style="color: var(--gold); margin-bottom: 1rem;">The Cipriani Network</h3>
                  <p style="margin-bottom: 0.75rem;">
                    The 2018 Lancet analysis found that all 21 antidepressants were more effective than placebo.
                    Amitriptyline, mirtazapine, and venlafaxine ranked highest for efficacy.
                    Agomelatine, fluoxetine, and escitalopram ranked highest for acceptability (fewest dropouts).
                  </p>
                  <p style="font-style: italic; opacity: 0.9;">
                    No single drug "won" on all outcomes. The network revealed trade-offs invisible to pairwise analysis.
                  </p>
                </div>
              </div>
            </div>

            <!-- Decision tree -->
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Decision Tree: Is NMA Appropriate?</h2>
                <div class="decision-tree animate delay-1">
                  <div class="decision-tree-header">NMA Feasibility Check</div>
                  <div class="decision-scenario">
                    You have 15 RCTs comparing 6 different statins. Some pairs have direct evidence, others do not.
                  </div>
                  <div class="decision-options">
                    <div class="decision-option correct">
                      <div class="decision-label">Check transitivity, then fit NMA</div>
                      <div class="decision-detail">Verify that patient populations and study designs are sufficiently similar across comparisons.</div>
                    </div>
                    <div class="decision-option">
                      <div class="decision-label">Ignore indirect evidence</div>
                      <div class="decision-detail">Loses statistical power and leaves gaps in the evidence base.</div>
                    </div>
                    <div class="decision-option">
                      <div class="decision-label">Pool all into one pairwise comparison</div>
                      <div class="decision-detail">Violates the structure of the evidence. Statins are different drugs.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quiz -->
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Module 14 Quiz</h2>
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q1.</strong> What assumption must hold for indirect evidence to be valid in NMA?</p>
                  <div class="quiz-options" id="m14-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 0, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I, not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
                      <span>A.</span> Transitivity  effect modifiers are balanced across comparisons
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 1, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I, not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
                      <span>B.</span> Homogeneity  I must be below 25%
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 2, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I, not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
                      <span>C.</span> All studies must have similar sample sizes
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m14-q1', 3, 0, ['Correct! Transitivity means effect modifiers are similarly distributed across comparisons, making indirect evidence valid.', 'Homogeneity is about pairwise I, not NMA validity.', 'Similar sample size is not required for NMA.', 'Blinding status matters for bias assessment, not transitivity.'])">
                      <span>D.</span> All studies must be double-blinded
                    </div>
                  </div>
                  <div id="m14-q1-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>

            <!-- Closing -->
            <div class="slide dark" data-index="11">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 14 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "The network sees what pairwise comparisons cannot: the whole landscape of treatment choice."
                </p>
              </div>
            </div>

            <div class="slide black" data-index="12">
              <p class="refrain animate">Not every signal is truth.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 15: The Individual</p>
            </div>
          </div>

          <!-- ============================================================
               MODULE 15: THE INDIVIDUAL (EBCTCG  IPD meta-analysis)
               ============================================================ -->
          <div class="module-slides" data-module="15">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">What was hidden in plain sight?</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 15: The Individual</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 15: The Individual</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Explain why aggregate data can mask treatment&ndash;covariate interactions</li>
                    <li>Distinguish one-stage from two-stage IPD models</li>
                    <li>Recognize ecological bias in aggregate meta-analysis</li>
                    <li>Understand the practical challenges of IPD collection</li>
                    <li>Interpret treatment&ndash;covariate interaction plots</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">For decades, breast cancer trials</p>
              <p class="title gold animate delay-1 text-center">published summaries. Not patients.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                The Early Breast Cancer Trialists' Collaborative Group (EBCTCG) collected individual records from
                over 100,000 women across hundreds of trials. Their IPD meta-analyses showed that tamoxifen
                benefits depend heavily on estrogen receptor status&mdash;something invisible in aggregate data.
              </p>
            </div>

            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">What the Summaries Concealed</h2>
                <p class="direct-address animate delay-1">Every published trial of tamoxifen reported an overall result. Across hundreds of studies, tamoxifen appeared to offer a modest benefit. But &ldquo;modest benefit&rdquo; was an average that concealed a profound truth.</p>
                <div class="investigation-box animate delay-2">
                  <h4>The Hidden Subgroup Split</h4>
                  <div class="stats-grid" style="margin-top: 1rem;">
                    <div class="stat-box" style="border-left: 4px solid #22c55e;">
                      <div class="stat-value" style="color: #22c55e;">RR 0.59</div>
                      <div class="stat-label">ER-positive subgroup: 41% reduction in recurrence</div>
                    </div>
                    <div class="stat-box" style="border-left: 4px solid #ef4444;">
                      <div class="stat-value" style="color: #ef4444;">RR 0.97</div>
                      <div class="stat-label">ER-negative subgroup: essentially no benefit at all</div>
                    </div>
                  </div>
                  <p style="margin-top: 1rem; font-style: italic;">The overall pooled effect&mdash;mixing responsive and non-responsive patients&mdash;was a statistical fiction. A &ldquo;modest&rdquo; average that overstated benefit for one group and implied benefit where none existed for the other.</p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">Aggregate vs Individual Patient Data</h2>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box">
                    <div class="stat-value">AD</div>
                    <div class="stat-label">Aggregate: published effect + CI only</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">IPD</div>
                    <div class="stat-label">Individual: raw patient-level records</div>
                  </div>
                </div>
                <div class="card animate delay-2" style="margin-top: 1rem;">
                  <p class="card-text">
                    IPD allows: (1) consistent outcome definitions, (2) subgroup analysis by patient characteristics,
                    (3) time-to-event modelling, (4) checking for ecological bias. It is the <strong>gold standard</strong>
                    for exploring treatment effect modification.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="5" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">One-Stage vs Two-Stage IPD</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Two-Stage</h4>
                    <p>Analyze each study separately, then combine estimates (like standard MA). Simple but loses information.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>One-Stage</h4>
                    <p>Fit a single mixed-effects model to all patient data simultaneously. More powerful for interactions and rare events.</p>
                  </div>
                </div>
                <div class="card animate delay-3" style="margin-top: 1rem;">
                  <p class="card-text">
                    <strong>Key:</strong> Both should account for study clustering. Never pool IPD as if from one mega-trial&mdash;this
                    introduces confounding (Simpson's paradox).
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="6" data-tier="mastery">
              <span class="tier-badge mastery">Methodologist</span>
              <div class="content">
                <h2 class="title navy animate">Ecological Bias</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    A meta-regression using study-level mean age might show older patients benefit more.
                    But this could be <strong>ecological bias</strong>&mdash;the study-level association does not reflect
                    the patient-level truth. Only IPD can separate <em>within-study</em> from <em>between-study</em> effects.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="7">
              <div class="content" style="max-width: 700px;">
                <h2 class="title cream animate text-center">When the Whole Lies About Its Parts</h2>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2" style="font-size: 1.05rem; text-align: center; max-width: 650px; margin-top: 1rem;">
                  Simpson&rsquo;s paradox: a trend that appears in aggregate data reverses when the data are grouped by a confounding variable.
                </p>
                <div class="investigation-box animate delay-3" style="margin-top: 1.5rem;">
                  <h4>The Paradox in Practice</h4>
                  <p style="margin-top: 0.75rem;">A mega-trial analysis found Treatment X beneficial <em>overall</em>. But <strong>within each study</strong>, it was harmful. How? Differences in baseline risk between studies created an illusion&mdash;sicker populations happened to receive more treatment, inflating the aggregate benefit.</p>
                  <p style="margin-top: 0.75rem;">Cates (2002, <em>BMJ</em>) showed that pooling across studies without accounting for clustering can reverse the apparent direction of effect.</p>
                  <p style="margin-top: 0.75rem; font-weight: 600; color: var(--gold);">This is why IPD one-stage models include study as a clustering variable&mdash;to prevent between-study confounding from masquerading as treatment effect.</p>
                </div>
              </div>
            </div>

            <!-- Story box -->
            <div class="slide dark" data-index="8">
              <div class="content" style="max-width: 700px;">
                <div class="story-box animate">
                  <h3 style="color: var(--gold); margin-bottom: 1rem;">The EBCTCG Legacy</h3>
                  <p style="margin-bottom: 0.75rem;">
                    The EBCTCG's IPD meta-analyses have defined breast cancer treatment for 40 years.
                    Their 2005 analysis of tamoxifen vs no treatment showed a clear benefit in ER-positive
                    tumors (RR 0.59) but no benefit in ER-negative tumors (RR 0.97).
                  </p>
                  <p style="font-style: italic; opacity: 0.9;">
                    Without IPD, the overall aggregate effect would have been pooled across both groups&mdash;
                    diluting the benefit and potentially denying ER-positive patients the magnitude of their gain.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Decision Tree: When Is IPD Worth Pursuing?</h2>
                <div class="decision-tree animate delay-1">
                  <div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    Do you suspect treatment&ndash;covariate interactions?
                  </div>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
                      <strong>Yes &rarr;</strong>
                      <p style="margin-top: 0.5rem; font-size: 0.95rem;">Can you obtain IPD from &gt;80% of trials?</p>
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.75rem;">
                        <div style="background: rgba(34,197,94,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
                          <strong style="color: #22c55e;">Yes &rarr;</strong> One-stage IPD meta-analysis with interaction terms
                        </div>
                        <div style="background: rgba(212,175,55,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
                          <strong style="color: var(--gold);">No &rarr;</strong> Two-stage: request available IPD + aggregate for the rest
                        </div>
                      </div>
                    </div>
                    <div style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
                      <strong>No &rarr;</strong>
                      <p style="margin-top: 0.5rem; font-size: 0.95rem;">Is ecological bias a concern?</p>
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.75rem;">
                        <div style="background: rgba(212,175,55,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
                          <strong style="color: var(--gold);">Yes &rarr;</strong> IPD preferred even without interactions
                        </div>
                        <div style="background: rgba(239,68,68,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
                          <strong style="color: #ef4444;">No &rarr;</strong> Aggregate data meta-analysis may suffice
                        </div>
                      </div>
                    </div>
                  </div>
                  <p class="footnote animate delay-2" style="margin-top: 1rem; font-size: 0.85rem; font-style: italic;">EBCTCG collected data from hundreds of trials over 40 years. Most IPD meta-analyses involve 5&ndash;20 trials. The decision depends on the question, not the ambition.</p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="10" data-tier="mastery">
              <span class="tier-badge mastery">Methodologist</span>
              <div class="content">
                <h2 class="title navy animate">The Pattern Repeats</h2>
                <p class="direct-address animate delay-1">Remember Module 3? HRT appeared beneficial in observational studies but harmful in RCTs. The same aggregate masking occurred: overall benefit hid subgroup harm.</p>
                <div class="card animate delay-2">
                  <p class="card-text">
                    IPD analysis of the Women&rsquo;s Health Initiative later showed that <strong>timing mattered</strong>&mdash;women starting HRT within 10 years of menopause had different outcomes than those starting later. The &ldquo;timing hypothesis&rdquo; was invisible in published aggregate summaries.
                  </p>
                </div>
                <div class="card animate delay-3" style="margin-top: 1rem; border-left: 4px solid var(--gold);">
                  <p class="card-text">
                    <strong>The lesson recurs:</strong> aggregate data can obscure critical treatment&ndash;covariate interactions. Whether it is ER status in breast cancer or timing in HRT, the individual-level data reveals what summaries conceal.
                  </p>
                </div>
              </div>
            </div>

            <!-- Quiz -->
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">Module 15 Quiz</h2>
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q1.</strong> What is the primary advantage of IPD over aggregate-data meta-analysis?</p>
                  <div class="quiz-options" id="m15-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 0, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
                      <span>A.</span> It always includes more studies
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 1, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
                      <span>B.</span> It is cheaper and faster
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 2, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
                      <span>C.</span> It can explore treatment&ndash;covariate interactions without ecological bias
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m15-q1', 3, 2, ['More studies doesn\'t help if the data granularity is the same.', 'Cheaper is false\u2014IPD is much more expensive to collect.', 'Correct! IPD allows exploration of patient-level effect modifiers without ecological bias.', 'Faster is false\u2014IPD requires extensive data sharing negotiations.'])">
                      <span>D.</span> It eliminates the need for random-effects models
                    </div>
                  </div>
                  <div id="m15-q1-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>

            <!-- Closing -->
            <div class="slide dark" data-index="12">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 15 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "Behind every pooled estimate are individuals whose stories the aggregate cannot tell."
                </p>
              </div>
            </div>

            <div class="slide black" data-index="13">
              <p class="refrain animate">Heterogeneity is a message, not noise.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 16: The Dose</p>
            </div>
          </div>

          <!-- ============================================================
               MODULE 16: THE DOSE (Alcohol J-curve / Stockwell 2016)
               ============================================================ -->
          <div class="module-slides" data-module="16">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Heterogeneity is a message, not noise.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 16: The Dose</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 16: The Dose</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Explain why simple pairwise comparisons miss dose&ndash;response relationships</li>
                    <li>Distinguish linear, quadratic, and spline dose&ndash;response models</li>
                    <li>Interpret restricted cubic splines with knots</li>
                    <li>Identify threshold effects and J/U-shaped curves</li>
                    <li>Understand model comparison with AIC/BIC</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">For decades, moderate drinking</p>
              <p class="title gold animate delay-1 text-center">appeared to protect the heart.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                The "J-shaped curve" showed non-drinkers had higher cardiovascular mortality than moderate drinkers.
                But Stockwell et al. (2016) demonstrated that the J-curve was an artefact of misclassifying
                former drinkers (who quit due to illness) as "abstainers."
              </p>
            </div>

            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">A Scientific Consensus Built on Sand</h2>
                <p class="direct-address animate delay-1">By 2010, over 100 observational studies had confirmed the J-curve. Medical textbooks taught it. Cardiologists cited it. Wine industry lobbyists funded conferences around it.</p>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">100+</div>
                    <div class="stat-label">Observational studies confirming the J-curve</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">15&ndash;25%</div>
                    <div class="stat-label">Lower cardiovascular mortality in moderate drinkers vs abstainers</div>
                  </div>
                </div>
                <div class="card animate delay-3" style="margin-top: 1rem; border-left: 4px solid var(--red);">
                  <p class="card-text">
                    The evidence seemed overwhelming. But what if the comparison group&mdash;&ldquo;abstainers&rdquo;&mdash;was contaminated?
                  </p>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="4">
              <div class="content" style="max-width: 700px;">
                <h2 class="title cream animate text-center">The Sick Quitter</h2>
                <p class="title gold animate delay-1 text-center" style="font-size: 1.2rem;">A Hidden Confounder</p>
                <div class="gold-line animate delay-2"></div>
                <div class="investigation-box animate delay-3" style="margin-top: 1.5rem;">
                  <h4>The Problem</h4>
                  <p style="margin-top: 0.75rem;">People who stop drinking often do so <strong>because they are already ill</strong>&mdash;liver disease, medication interactions, cancer diagnosis. These &ldquo;former drinkers&rdquo; were classified as &ldquo;abstainers&rdquo; in most studies.</p>
                  <p style="margin-top: 0.75rem;"><strong>The Effect:</strong> The reference group (abstainers) appeared <em>less healthy</em>&mdash;not because abstinence was harmful, but because sick people had joined it.</p>
                </div>
                <div class="card animate delay-4" style="margin-top: 1rem; background: rgba(212,175,55,0.15); border-left: 4px solid var(--gold);">
                  <p class="card-text" style="color: var(--cream);">
                    When Stockwell et al. (2016, <em>J Stud Alcohol Drugs</em>) removed former drinkers and applied appropriate study-quality corrections: <strong>the J-curve disappeared</strong>. The protective effect was a phantom.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">Dose&ndash;Response Meta-Analysis</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Standard meta-analysis asks: "Does treatment X work?" Dose&ndash;response meta-analysis asks:
                    "<strong>At what dose</strong> does treatment X work best?" It models the relationship between
                    dose level and outcome across multiple studies.
                  </p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">Linear</div>
                    <div class="stat-label">Simplest: log(RR) = &beta; &times; dose</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Spline</div>
                    <div class="stat-label">Flexible: piecewise polynomials with knots</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Fractional</div>
                    <div class="stat-label">Polynomial: dose^p1 + dose^p2</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="6" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Restricted Cubic Splines</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    RCS place <strong>knots</strong> at pre-specified dose points and fit smooth polynomials between them.
                    Typically 3&ndash;5 knots at quantiles of the dose distribution. Linear beyond boundary knots.
                    Tests for non-linearity compare the spline model against a simpler linear model.
                  </p>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">AIC</div>
                  <div class="lesson-content">
                    <h4>Model Comparison</h4>
                    <p>AIC/BIC compare linear vs spline fit. Lower = better. Also test departure from linearity (p-value for spline terms).</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Interactive tool -->
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">Interactive: Dose&ndash;Response Builder</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Compare linear vs quadratic vs spline fits. Watch how the model shape changes with different assumptions.
                </p>
                <div id="doseResponseTool" class="animate delay-2" style="min-height: 300px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
                  <div style="display:flex; gap:1rem; margin-bottom:1rem; flex-wrap:wrap;">
                    <button class="btn" onclick="setDoseModel('linear')" id="doseBtn-linear">Linear</button>
                    <button class="btn" onclick="setDoseModel('quadratic')" id="doseBtn-quadratic">Quadratic</button>
                    <button class="btn primary" onclick="setDoseModel('spline')" id="doseBtn-spline">Spline (3 knots)</button>
                  </div>
                  <div id="doseResponsePlotArea" style="width:100%; min-height:240px;"></div>
                </div>
              </div>
            </div>

            <!-- Story box -->
            <div class="slide dark" data-index="8">
              <div class="content" style="max-width: 700px;">
                <div class="story-box animate">
                  <h3 style="color: var(--gold); margin-bottom: 1rem;">The Alcohol J-Curve Debunked</h3>
                  <p style="margin-bottom: 0.75rem;">
                    Stockwell's 2016 re-analysis found that when former drinkers were correctly excluded
                    from the "abstainer" reference group, the protective effect of moderate drinking disappeared.
                    The J-curve was driven by sick-quitter bias.
                  </p>
                  <p style="font-style: italic; opacity: 0.9;">
                    Dose&ndash;response meta-analysis revealed the truth: the shape of the curve depends
                    critically on how you define "zero dose." The wrong reference category created a phantom benefit.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">When Curves Shape Policy</h2>
                <p class="direct-address animate delay-1">The phantom J-curve influenced alcohol guidelines worldwide:</p>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #1a3a5c; color: white;">UK</div>
                  <div class="lesson-content">
                    <h4>NHS Guidance (until 2016)</h4>
                    <p>&ldquo;Moderate drinking may protect the heart&rdquo; appeared in official guidance. After Stockwell&rsquo;s correction, the UK revised limits to 14 units/week for <strong>all</strong> drinkers (previously 21 for men). No amount was declared &ldquo;safe.&rdquo;</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background: #3b4d8c; color: white;">US</div>
                  <div class="lesson-content">
                    <h4>Dietary Guidelines Advisory Committee</h4>
                    <p>J-curve studies were cited through 2015. The 2020 committee recommended lowering limits to 1 drink/day for men, acknowledging the reference-group bias.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background: #2d6a4f; color: white;">AU</div>
                  <div class="lesson-content">
                    <h4>Australian Guidelines</h4>
                    <p>Safe drinking limits were delayed by industry-funded J-curve research promoting &ldquo;cardioprotective&rdquo; moderate intake.</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Decision Tree: Is Dose-Response Analysis Appropriate?</h2>
                <div class="decision-tree animate delay-1">
                  <div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    Do you have &ge;3 exposure levels (not just exposed vs unexposed)?
                  </div>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
                      <strong>Yes &rarr;</strong>
                      <p style="margin-top: 0.5rem; font-size: 0.95rem;">Is the relationship plausibly non-linear?</p>
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.75rem;">
                        <div style="background: rgba(34,197,94,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
                          <strong style="color: #22c55e;">Yes &rarr;</strong> Restricted cubic splines (3&ndash;5 knots). Compare AIC with linear model.
                        </div>
                        <div style="background: rgba(212,175,55,0.2); padding: 0.75rem; border-radius: 6px; font-size: 0.85rem;">
                          <strong style="color: var(--gold);">No &rarr;</strong> Linear dose-response meta-regression may suffice
                        </div>
                      </div>
                    </div>
                    <div style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
                      <strong>No &rarr;</strong>
                      <p style="margin-top: 0.5rem; font-size: 0.95rem;">Standard pairwise meta-analysis (no dose-response possible with only two levels)</p>
                    </div>
                  </div>
                  <div style="background: rgba(197,48,48,0.15); padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid var(--red);">
                    <strong style="color: #f87171;">Warning:</strong> Always check&mdash;is your reference category clean? The J-curve lesson: a contaminated reference group creates phantom non-linearity.
                  </div>
                </div>
              </div>
            </div>

            <!-- Quiz -->
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">Module 16 Quiz</h2>
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q1.</strong> What makes restricted cubic splines useful in dose&ndash;response meta-analysis?</p>
                  <div class="quiz-options" id="m16-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 0, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
                      <span>A.</span> They always produce a straight line
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 1, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
                      <span>B.</span> They flexibly capture non-linear dose&ndash;response curves
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 2, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
                      <span>C.</span> They reduce the number of studies needed
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m16-q1', 3, 1, ['Splines are not limited to straight lines\u2014that is the linear model.', 'Correct! Splines can model non-linear shapes (J-curves, U-curves, thresholds) while remaining smooth.', 'Fewer studies does not improve with any model choice alone.', 'Splines may increase parameters compared to a linear model.'])">
                      <span>D.</span> They simplify the model to fewer parameters
                    </div>
                  </div>
                  <div id="m16-q1-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>

            <!-- Closing -->
            <div class="slide dark" data-index="12">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 16 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "The dose makes the poison. And the shape of the curve reveals whether the poison is real."
                </p>
              </div>
            </div>

            <div class="slide black" data-index="13">
              <p class="refrain animate">Absence of evidence is not evidence of absence.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 17: The Fragility</p>
            </div>
          </div>

          <!-- ============================================================
               MODULE 17: THE FRAGILITY (Oseltamivir / Jefferson 2014)
               ============================================================ -->
          <div class="module-slides" data-module="17">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Absence of evidence is not evidence of absence.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 17: The Fragility</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 17: The Fragility</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Calculate and interpret the fragility index</li>
                    <li>Use GOSH plots to identify influential studies and subset effects</li>
                    <li>Interpret contour-enhanced funnel plots</li>
                    <li>Apply Copas selection models and PET-PEESE for publication bias</li>
                    <li>Understand how sensitivity analyses strengthen meta-analytic conclusions</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">Governments stockpiled billions</p>
              <p class="title gold animate delay-1 text-center">based on evidence they could not see.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                After H1N1, governments spent billions on oseltamivir (Tamiflu) stockpiles.
                The Cochrane team (Jefferson et al. 2014) fought for years to access unpublished data.
                When they finally did, the evidence for preventing complications evaporated.
              </p>
            </div>

            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Fragility Index</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    The fragility index asks: <strong>"How many patients would need to change outcome
                    to flip a statistically significant result to non-significant?"</strong>
                    It iteratively adds events (converts non-events to events) in the group with fewer events until p &gt; 0.05.
                  </p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">FI = 1</div>
                    <div class="stat-label">Extremely fragile. One patient flip changes conclusion.</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">FI &gt; 8</div>
                    <div class="stat-label">Reasonably robust. Less sensitive to individual outcomes.</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Interactive tools -->
            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">Interactive: Fragility Calculator</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Enter a 2&times;2 table to calculate the fragility index. Watch events shift until significance flips.
                </p>
                <div id="fragilityTool" class="animate delay-2" style="min-height: 200px; background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
                  <div style="display:grid; grid-template-columns: auto 1fr 1fr; gap:0.5rem; max-width:350px; margin-bottom:1rem;">
                    <div></div>
                    <div style="font-weight:600; text-align:center;">Events</div>
                    <div style="font-weight:600; text-align:center;">Total N</div>
                    <div style="font-weight:600;">Treatment</div>
                    <input type="number" id="fi-eventsTx" value="15" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;">
                    <input type="number" id="fi-nTx" value="100" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;">
                    <div style="font-weight:600;">Control</div>
                    <input type="number" id="fi-eventsCtrl" value="30" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;">
                    <input type="number" id="fi-nCtrl" value="100" style="padding:0.3rem; border:1px solid #ccc; border-radius:4px; text-align:center;">
                  </div>
                  <button class="btn primary" onclick="calculateFragilityIndex()">Calculate Fragility Index</button>
                  <div id="fragilityResult" style="margin-top:1rem; padding:1rem; background:rgba(212,175,55,0.1); border-radius:6px; display:none;"></div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="5" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">GOSH Plots</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    <strong>Graphical Overview of Study Heterogeneity</strong> (GOSH) fits meta-analysis models
                    to all possible subsets of studies. Each dot plots the pooled effect vs I&sup2; for one subset.
                    Clusters suggest distinct subgroups; outlier clouds suggest one study driving heterogeneity.
                  </p>
                </div>
                <p class="footnote animate delay-2">For k studies, there are 2<sup>k</sup>&minus;1 subsets. For k &gt; 15, random sampling is used.</p>
              </div>
            </div>

            <div class="slide light" data-index="6" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Contour-Enhanced Funnel Plots</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Standard funnel plots show effect size vs standard error. <strong>Contour-enhanced</strong> versions
                    add shaded regions for p &lt; 0.01, p &lt; 0.05, and p &lt; 0.10.
                    If missing studies fall in non-significant regions, publication bias becomes more plausible (not proven).
                    If they fall in significant regions, other causes (e.g., study quality) may explain asymmetry.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="7" data-tier="mastery">
              <span class="tier-badge mastery">Methodologist</span>
              <div class="content">
                <h2 class="title navy animate">Copas Selection &amp; PET-PEESE</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Copas Selection Model</h4>
                    <p>Models the probability of a study being published as a function of its SE and effect size. Jointly estimates the true effect and the selection mechanism.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>PET-PEESE</h4>
                    <p>Precision-Effect Test (PET): regress effects on SE. If intercept = 0, no true effect. PEESE uses SE&sup2; for better performance when a true effect exists.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Story box -->
            <div class="slide dark" data-index="8">
              <div class="content" style="max-width: 700px;">
                <div class="story-box animate">
                  <h3 style="color: var(--gold); margin-bottom: 1rem;">The Oseltamivir Saga</h3>
                  <p style="margin-bottom: 0.75rem;">
                    The original Roche-funded meta-analysis (Kaiser 2003) showed oseltamivir reduced
                    influenza complications by 67%. But 8 of 10 trials had never been published.
                    After Cochrane obtained the clinical study reports, the benefit for complications
                    fell to a non-significant 11%.
                  </p>
                  <p style="font-style: italic; opacity: 0.9;">
                    The fragility was not just statistical&mdash;it was informational. The evidence base itself
                    was missing most of the data.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Decision Tree: Interpreting Your Fragility Results</h2>
                <div class="decision-tree animate delay-1">
                  <div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    You calculated the Fragility Index. What does the number mean?
                  </div>
                  <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.75rem;">
                    <div style="background: rgba(239,68,68,0.15); padding: 1rem; border-radius: 8px; border-top: 4px solid #ef4444;">
                      <strong style="color: #f87171; font-size: 1.1rem;">FI &le; 3</strong>
                      <p style="margin-top: 0.5rem; font-size: 0.9rem;"><strong>Highly fragile.</strong> A handful of different events would reverse the conclusion. Interpret with extreme caution.</p>
                    </div>
                    <div style="background: rgba(212,175,55,0.15); padding: 1rem; border-radius: 8px; border-top: 4px solid var(--gold);">
                      <strong style="color: var(--gold); font-size: 1.1rem;">FI 4&ndash;8</strong>
                      <p style="margin-top: 0.5rem; font-size: 0.9rem;"><strong>Moderately fragile.</strong> Sensitive to small perturbations. Are there unpublished trials that might shift this?</p>
                    </div>
                    <div style="background: rgba(34,197,94,0.15); padding: 1rem; border-radius: 8px; border-top: 4px solid #22c55e;">
                      <strong style="color: #22c55e; font-size: 1.1rem;">FI &gt; 8</strong>
                      <p style="margin-top: 0.5rem; font-size: 0.9rem;"><strong>Relatively robust.</strong> But remember: fragility is only one dimension. Publication bias can undermine even robust results.</p>
                    </div>
                  </div>
                  <div class="card animate delay-2" style="margin-top: 1rem; background: rgba(0,0,0,0.05);">
                    <p class="card-text" style="font-size: 0.9rem;">
                      Walsh et al. (2014, <em>J Clin Epidemiol</em>) found that in 399 RCTs published in top journals, the median fragility index was just 8. Over 25% had FI &le; 3. Landmark trials influencing clinical practice were often hanging by a statistical thread.
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="10" data-tier="mastery">
              <span class="tier-badge mastery">Methodologist</span>
              <div class="content">
                <h2 class="title navy animate">Beyond the Index: Structural Fragility</h2>
                <p class="direct-address animate delay-1">The oseltamivir saga revealed <strong>three types of fragility</strong>&mdash;and the Fragility Index captures only the first.</p>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #ef4444;">1</div>
                  <div class="lesson-content">
                    <h4>Statistical Fragility (FI)</h4>
                    <p>How many events flip the p-value? This is what the Fragility Index measures. It quantifies sensitivity to individual patient outcomes.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background: var(--gold); color: var(--navy);">2</div>
                  <div class="lesson-content">
                    <h4>Informational Fragility</h4>
                    <p>How much of the evidence is hidden? Eight of ten Roche oseltamivir trials were unpublished. The evidence base was structurally incomplete.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number" style="background: #3b82f6;">3</div>
                  <div class="lesson-content">
                    <h4>Analytical Fragility</h4>
                    <p>How many researcher degrees of freedom could change the conclusion? Different outcome definitions, analysis populations, or statistical methods.</p>
                  </div>
                </div>
                <div class="card animate delay-5" style="margin-top: 1rem; border-left: 4px solid var(--gold);">
                  <p class="card-text">
                    <strong>Callback to Module 10 (Paroxetine):</strong> Re-analysis with different outcome definitions reversed the conclusion entirely. That was analytical fragility&mdash;the FI was never calculated because the endpoint itself was disputed. A complete robustness assessment examines all three dimensions.
                  </p>
                </div>
              </div>
            </div>

            <!-- Quiz -->
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">Module 17 Quiz</h2>
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q1.</strong> A trial has 200 patients per arm, 12 events in treatment, 25 in control (p=0.03). The fragility index is 3. What does this mean?</p>
                  <div class="quiz-options" id="m17-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 0, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
                      <span>A.</span> The effect size is exactly 3
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 1, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
                      <span>B.</span> Changing just 3 patient outcomes would flip the result to non-significant
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 2, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
                      <span>C.</span> The result is very robust with 3 confirmatory studies
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m17-q1', 3, 1, ['Fragility index is about significance, not effect size.', 'Correct! Changing just 3 events would flip p from &lt;0.05 to &gt;0.05. The conclusion is fragile.', 'It means fragile, not robust.', '3 patients are not the minimum for the study\u2014it is the minimum to flip significance.'])">
                      <span>D.</span> At least 3 patients are needed for the study
                    </div>
                  </div>
                  <div id="m17-q1-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>

            <!-- Closing -->
            <div class="slide dark" data-index="12">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 17 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "The number that survives every attempt to break it is the number worth trusting."
                </p>
              </div>
            </div>

            <div class="slide black" data-index="13">
              <p class="refrain animate">Not every signal is truth.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 18: The Equity</p>
            </div>
          </div>

          <!-- ============================================================
               MODULE 18: THE EQUITY (SPRINT exclusions / PROGRESS-Plus)
               ============================================================ -->
          <div class="module-slides" data-module="18">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Certainty must be earned, not assumed.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 18: The Equity</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 18: The Equity</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Identify how trial exclusion criteria create evidence gaps</li>
                    <li>Apply the PROGRESS-Plus framework to assess equity in evidence</li>
                    <li>Use PRISMA-Equity reporting guidelines</li>
                    <li>Understand transportability: when trial findings fail in practice</li>
                    <li>Design equity-sensitive search and synthesis strategies</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">SPRINT proved tight blood pressure control</p>
              <p class="title gold animate delay-1 text-center">saves lives. But whose lives?</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                The landmark SPRINT trial excluded patients with diabetes, prior stroke, and heart failure.
                Over 75% of US hypertensive patients would not have qualified. The evidence was strong
                but the applicability was narrow.
              </p>
            </div>

            <!-- Slide A: The Missing Majority -->
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Trial That Excluded Most of Its Patients</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    SPRINT enrolled 9,361 patients and proved that intensive blood pressure control (target &lt;120 mmHg)
                    reduced cardiovascular events by 25% (HR 0.75, 95% CI 0.64&ndash;0.89). But the inclusion
                    criteria told a different story.
                  </p>
                </div>
                <div class="card animate delay-2" style="margin-top: 1rem; background: rgba(197,48,48,0.08); border-left: 3px solid var(--red);">
                  <p class="card-text"><strong>Who was excluded:</strong></p>
                  <ul style="margin-top: 0.5rem; padding-left: 1.25rem; line-height: 1.8;">
                    <li><strong>Diabetes</strong> &mdash; 35% of US adults with hypertension</li>
                    <li><strong>Prior stroke</strong> &mdash; 8% of the hypertensive population</li>
                    <li><strong>Symptomatic heart failure</strong> &mdash; 6% of hypertensive adults</li>
                    <li><strong>Expected survival &lt;3 years</strong> &mdash; the frailest patients</li>
                    <li><strong>Nursing home residents</strong> &mdash; excluded entirely</li>
                    <li><strong>GFR &lt;20 mL/min</strong> &mdash; advanced kidney disease</li>
                  </ul>
                </div>
                <p class="footnote animate delay-3" style="margin-top: 1rem; font-weight: 600;">
                  Result: Over 75% of US adults with hypertension would NOT have qualified.
                  The evidence was strong. But for whom?
                </p>
              </div>
            </div>

            <!-- Slide B: The Geography of Evidence -->
            <div class="slide dark" data-index="4">
              <div class="content" style="max-width: 750px;">
                <h2 class="title cream animate" style="text-align: center;">Where the Evidence Comes From</h2>
                <div class="gold-line animate delay-1"></div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;">
                  <div class="animate delay-2" style="background: rgba(212,175,55,0.1); padding: 1.25rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
                    <p style="font-size: 2rem; font-weight: 700; color: var(--gold);">78%</p>
                    <p style="font-size: 0.95rem; margin-top: 0.5rem;">of cardiovascular mega-trial participants came from high-income countries (2000&ndash;2020).</p>
                  </div>
                  <div class="animate delay-3" style="background: rgba(212,175,55,0.1); padding: 1.25rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
                    <p style="font-size: 2rem; font-weight: 700; color: var(--gold);">6%</p>
                    <p style="font-size: 0.95rem; margin-top: 0.5rem;">from sub-Saharan Africa &mdash; where cardiovascular disease is rising fastest.</p>
                  </div>
                </div>
                <div class="animate delay-4" style="margin-top: 1.5rem; background: rgba(255,255,255,0.05); padding: 1.25rem; border-radius: 8px;">
                  <p style="font-size: 1rem; line-height: 1.7;">
                    Polypill trials: 4 of 5 were conducted in populations with mean BMI &lt;25.
                    The US mean BMI is 30. Drug metabolism, comorbidity patterns, healthcare access, and genetic
                    variation all differ across populations. <strong>Efficacy in one population does not guarantee
                    effectiveness in another.</strong>
                  </p>
                </div>
                <p class="footnote animate delay-4" style="margin-top: 1rem; opacity: 0.7; font-size: 0.85rem;">
                  Reference: Multinational trials and the PROGRESS-Plus gap
                </p>
              </div>
            </div>

            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">PROGRESS-Plus Framework</h2>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box"><div class="stat-value">P</div><div class="stat-label">Place of residence</div></div>
                  <div class="stat-box"><div class="stat-value">R</div><div class="stat-label">Race / ethnicity</div></div>
                  <div class="stat-box"><div class="stat-value">O</div><div class="stat-label">Occupation</div></div>
                  <div class="stat-box"><div class="stat-value">G</div><div class="stat-label">Gender / sex</div></div>
                  <div class="stat-box"><div class="stat-value">R</div><div class="stat-label">Religion</div></div>
                  <div class="stat-box"><div class="stat-value">E</div><div class="stat-label">Education</div></div>
                  <div class="stat-box"><div class="stat-value">S</div><div class="stat-label">SES (socioeconomic)</div></div>
                  <div class="stat-box"><div class="stat-value">S</div><div class="stat-label">Social capital</div></div>
                </div>
                <p class="footnote animate delay-2"><strong>Plus:</strong> Age, disability, sexual orientation, other vulnerable groups.</p>
              </div>
            </div>

            <div class="slide light" data-index="6" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">PRISMA-Equity &amp; Transportability</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    <strong>PRISMA-Equity</strong> extends PRISMA to require reporting of how equity was addressed
                    in the review: population characteristics, subgroup analyses by disadvantage, and assessment
                    of applicability to underserved populations.
                  </p>
                </div>
                <div class="card animate delay-2" style="margin-top:1rem;">
                  <p class="card-text">
                    <strong>Transportability</strong>: Trial efficacy does not equal real-world effectiveness.
                    Methods exist to re-weight trial data to match the target population distribution.
                  </p>
                </div>
              </div>
            </div>

            <!-- Slide C: The Transportability Question -->
            <div class="slide light" data-index="7" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">From Trial to Real World: Transportability</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    <strong>Transportability</strong> = Can results from trial population X be applied
                    to target population Y? This is not a philosophical question&mdash;it has formal methods.
                  </p>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Inverse Probability of Participation Weighting (IPPW)</h4>
                    <p>Re-weights trial participants so they resemble the target population on key covariates.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Generalizability Index</h4>
                    <p>Quantifies how similar the trial sample is to the target population on observed characteristics.</p>
                  </div>
                </div>
                <div class="card animate delay-4" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
                  <p class="card-text">
                    <strong>Stuart et al. (2015, <em>Stat Med</em>):</strong> When SPRINT results were
                    re-weighted to match the US hypertensive population, the estimated benefit was attenuated
                    &mdash; HR 0.82 (vs 0.75 in-trial). The treatment still works. But the magnitude changes
                    when the population changes.
                  </p>
                </div>
              </div>
            </div>

            <!-- Story box -->
            <div class="slide dark" data-index="8">
              <div class="content" style="max-width: 700px;">
                <div class="story-box animate">
                  <h3 style="color: var(--gold); margin-bottom: 1rem;">SPRINT and the Missing Majority</h3>
                  <p style="margin-bottom: 0.75rem;">
                    SPRINT was a well-designed trial of 9,361 patients. Its finding (HR 0.75 for intensive vs standard BP control) changed guidelines worldwide.
                    But subsequent analyses showed the benefit was strongest in the subgroup most like the trial population&mdash;and uncertain for excluded groups.
                  </p>
                  <p style="font-style: italic; opacity: 0.9;">
                    Equity in evidence synthesis means asking not just "Does it work?" but "For whom does it work?"
                  </p>
                </div>
              </div>
            </div>

            <!-- Slide D: Decision Tree -->
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Decision Tree: Equity Assessment for Your Review</h2>
                <div class="decision-tree animate delay-1" style="font-size: 0.95rem; line-height: 1.7;">
                  <div class="card" style="background: var(--navy); color: var(--cream); padding: 1rem; border-radius: 8px;">
                    <p><strong>ROOT:</strong> Does your review's evidence come from populations similar to your target?</p>
                  </div>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--green);">
                      <p><strong>YES</strong> &rarr; Good. But check: Are subgroups (age, sex, ethnicity, SES) reported separately?</p>
                      <ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
                        <li><strong>Yes:</strong> Use subgroup effects for population-specific recommendations</li>
                        <li><strong>No:</strong> Flag as limitation &mdash; equity gap in reporting</li>
                      </ul>
                    </div>
                    <div style="background: rgba(197,48,48,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--red);">
                      <p><strong>NO</strong> &rarr; Does PROGRESS-Plus analysis reveal differential effects?</p>
                      <ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
                        <li><strong>Yes:</strong> Population-specific recommendations needed. Consider transportability re-weighting.</li>
                        <li><strong>No:</strong> Cautious generalization with explicit equity statement in discussion</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide E: Callback to Module 3 -->
            <div class="slide dark" data-index="10" data-tier="mastery">
              <span class="tier-badge mastery" style="position:absolute; top:1.5rem; right:1.5rem;">Methodologist</span>
              <div class="content" style="max-width: 700px;">
                <h2 class="title cream animate" style="text-align: center;">Callback: The HRT Lesson Revisited</h2>
                <div class="gold-line animate delay-1"></div>
                <div class="card animate delay-2" style="background: rgba(212,175,55,0.1); border: 1px solid rgba(212,175,55,0.3); margin-top: 1.5rem;">
                  <p class="card-text" style="color: var(--cream);">
                    Remember Module 3? The HRT story showed that <strong>healthy-user bias</strong> made a harmful
                    treatment appear beneficial. SPRINT may have the opposite problem &mdash; the &ldquo;healthy
                    volunteer&rdquo; effect may make an effective treatment appear <em>more</em> effective than
                    it would be in the real world.
                  </p>
                </div>
                <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; margin-top: 1.5rem; font-style: italic; opacity: 0.9;">
                  Every meta-analysis should ask: Who was included? Who was excluded?
                  And does that matter?
                </p>
              </div>
            </div>

            <!-- Quiz -->
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">Module 18 Quiz</h2>
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q1.</strong> What does the PROGRESS-Plus framework help reviewers assess?</p>
                  <div class="quiz-options" id="m18-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 0, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
                      <span>A.</span> Statistical heterogeneity
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 1, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
                      <span>B.</span> Equity and applicability across disadvantaged populations
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 2, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
                      <span>C.</span> Internal validity of included studies
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m18-q1', 3, 1, ['PROGRESS-Plus is about equity, not statistical methods.', 'Correct! PROGRESS-Plus prompts reviewers to consider whether evidence applies across social determinants of health.', 'Risk of bias tools (RoB 2.0) handle internal validity.', 'GRADE handles certainty of evidence.'])">
                      <span>D.</span> Overall certainty of evidence
                    </div>
                  </div>
                  <div id="m18-q1-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>

            <!-- Closing -->
            <div class="slide dark" data-index="12">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 18 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "Evidence that excludes the vulnerable cannot claim to serve them."
                </p>
              </div>
            </div>

            <div class="slide black" data-index="13">
              <p class="refrain animate">Not every signal is truth.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 19: The Machine</p>
            </div>
          </div>

          <!-- ============================================================
               MODULE 19: THE MACHINE (Cochrane COVID screening)
               ============================================================ -->
          <div class="module-slides" data-module="19">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">The number without provenance is not a number.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 19: The Machine</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 19: The Machine</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Describe how AI/ML is used in systematic review screening</li>
                    <li>Explain active learning and human-in-the-loop workflows</li>
                    <li>Assess automation validation: recall, workload savings, and risk</li>
                    <li>Recognize the limitations and biases of algorithmic screening</li>
                    <li>Apply frameworks for responsible AI use in evidence synthesis</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">When COVID-19 hit,</p>
              <p class="title gold animate delay-1 text-center">papers arrived faster than humans could read.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                By 2021, over 300,000 COVID papers existed. Cochrane used machine learning classifiers
                to triage studies for their rapid reviews&mdash;reducing screening workload by up to 70%
                while maintaining &gt;95% recall.
              </p>
            </div>

            <!-- The Flood -->
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Flood</h2>
                <div class="card animate delay-1">
                  <p>By April 2020, <strong>4,000 COVID preprints appeared every week</strong>.</p>
                  <p style="margin-top: 0.5rem;">PubMed indexed <strong>500 new COVID articles per day</strong>.</p>
                  <p style="margin-top: 0.5rem;">Cochrane's screening queue hit <strong>10,000 unreviewed titles</strong>.</p>
                </div>
                <div class="investigation-box animate delay-2" style="margin-top: 1rem;">
                  <div class="investigation-header"><span class="icon">&#128269;</span> The Mathematics of Impossibility</div>
                  <div class="investigation-content">
                    <p>A pair of reviewers screens ~200 titles per day.</p>
                    <p><strong>At 500 new articles/day, they fell further behind with every hour.</strong></p>
                    <p style="margin-top: 0.5rem; font-style: italic;">The living review was dying before it could live.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- The First Attempts -->
            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">The First Attempts</h2>
                <p class="direct-address animate delay-1">The idea was not new. Cohen et al. (2006, JAMIA) first showed that machine learning could reduce screening workload by 50%&mdash;with less than 5% loss in recall.</p>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-icon">&#128197;</div>
                  <div class="lesson-text"><strong>2006:</strong> Cohen et al. &mdash; SVM classifiers for drug class reviews. Proof of concept.</div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-icon">&#128197;</div>
                  <div class="lesson-text"><strong>2016:</strong> RobotReviewer (Marshall et al., JMLR) &mdash; ML for risk of bias assessment. Inter-rater reliability comparable to human reviewers.</div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-icon">&#128197;</div>
                  <div class="lesson-text"><strong>2021:</strong> ASReview (van de Schoot et al., Nature Machine Intelligence) &mdash; active learning that simulated 95% workload reduction.</div>
                </div>
                <p class="animate delay-3" style="margin-top: 1rem; font-style: italic; color: var(--gold);">But simulation is not reality. COVID would be the first true test at scale.</p>
              </div>
            </div>

            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">AI in Systematic Reviews</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Screening Prioritization</h4>
                    <p>Active learning ranks citations by relevance. Reviewers screen the most likely relevant first.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Data Extraction Assist</h4>
                    <p>NLP extracts PICO elements, outcomes, and results. Always requires human verification.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Risk of Bias Assessment</h4>
                    <p>ML classifiers predict RoB domains. Experimental&mdash;human judgment remains gold standard.</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="6" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Validating Automation</h2>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box">
                    <div class="stat-value">Recall</div>
                    <div class="stat-label">&gt;95% required. Missing 1 study can change conclusions.</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">WSS@95%</div>
                    <div class="stat-label">Work Saved over Sampling at 95% recall.</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Stopping</div>
                    <div class="stat-label">When to stop screening? Consecutive irrelevant threshold.</div>
                  </div>
                </div>
                <div class="card animate delay-2" style="margin-top:1rem;">
                  <p class="card-text">
                    <strong>The fundamental tension:</strong> Automation saves time but introduces a new source of error.
                    Always report the tool, version, training data, and stopping criteria.
                  </p>
                </div>
              </div>
            </div>

            <!-- The Validation Crisis -->
            <div class="slide dark" data-index="7">
              <div class="content" style="max-width: 700px;">
                <div class="investigation-box animate">
                  <div class="investigation-header"><span class="icon">&#128269;</span> The Paradox of Validation</div>
                  <div class="investigation-content">
                    <p>To know if the machine missed a relevant study, <strong>you need a human to screen everything</strong>.</p>
                    <p style="margin-top: 0.5rem;">But if humans screen everything, <strong>why use the machine?</strong></p>
                    <p style="margin-top: 1rem;">The solution: <strong>prospective holdout validation</strong>.</p>
                    <ul style="margin-top: 0.5rem;">
                      <li>Random 10% sample screened by both human and machine</li>
                      <li>Compare: did the machine miss what the human found?</li>
                      <li>If recall drops below 95%, retrain and expand human screening</li>
                    </ul>
                    <p style="margin-top: 1rem; font-style: italic;">Trust, but verify. The machine earns its role&mdash;it does not inherit it.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Story box -->
            <div class="slide dark" data-index="8">
              <div class="content" style="max-width: 700px;">
                <div class="story-box animate">
                  <h3 style="color: var(--gold); margin-bottom: 1rem;">Cochrane's COVID Response</h3>
                  <p style="margin-bottom: 0.75rem;">
                    Cochrane built the COVID-19 Study Register using machine learning classifiers trained on
                    millions of records. The system achieved 99% sensitivity while reducing manual screening
                    from weeks to days.
                  </p>
                  <p style="font-style: italic; opacity: 0.9;">
                    But the machine was a tool, not a replacement. Every included study was still verified by human reviewers.
                    The lesson: AI augments the reviewer, not replaces them.
                  </p>
                </div>
              </div>
            </div>

            <!-- The Study That Almost Wasn't Found -->
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">The Study That Almost Wasn't Found</h2>
                <div class="story-box animate delay-1">
                  <p>In June 2020, the RECOVERY trial published its dexamethasone results&mdash;<strong>the first treatment proven to reduce COVID mortality</strong> (28-day mortality: 22.9% vs 25.7%, RR 0.83).</p>
                  <p style="margin-top: 0.5rem;">The preprint appeared on medRxiv with a non-standard title. Scenarios like this occurred repeatedly during the pandemic: ML classifiers, trained on existing terminology, ranked unfamiliar framings low.</p>
                  <p style="margin-top: 0.5rem;">In several living reviews, human reviewers scanning flagged titles recognized key drug names and escalated studies that classifiers had deprioritized.</p>
                  <p style="margin-top: 1rem; font-weight: 600; color: var(--gold);">Without those humans, landmark treatment findings might have waited weeks to enter the living review.</p>
                  <p style="margin-top: 0.5rem; font-style: italic;">The machine reads faster. The human reads deeper. Neither is sufficient alone.</p>
                </div>
              </div>
            </div>

            <!-- Decision Tree: When Should You Use AI? -->
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Decision Tree: When Should You Use AI?</h2>
                <div class="decision-tree animate delay-1">
                  <div class="decision-node" style="background: var(--navy); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                    Your review will screen more than 5,000 titles?
                  </div>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="decision-option" style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
                      <strong>Yes &rarr; Consider AI-assisted screening</strong>
                      <p style="margin-top: 0.5rem; font-size: 0.9rem;">Active learning prioritization. Dual-screen random 10% holdout. Stop when 3 consecutive batches yield 0 relevant studies.</p>
                      <p style="margin-top: 0.5rem; font-size: 0.85rem; font-style: italic;">Report: classifier type, training data, recall on holdout, stopping rule.</p>
                    </div>
                    <div class="decision-option" style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
                      <strong>No &rarr; Manual screening is feasible</strong>
                      <p style="margin-top: 0.5rem; font-size: 0.9rem;">For &lt;5,000 titles, dual human screening remains gold standard. AI adds complexity without proportionate benefit.</p>
                    </div>
                  </div>
                  <div class="decision-node animate delay-2" style="background: rgba(212,175,55,0.15); padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid var(--gold);">
                    <strong>Is this a living or rapid review?</strong>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem;">If yes &rarr; AI is especially valuable. Continuous classifier retraining on new evidence. But: <strong>never let the machine make the final inclusion decision.</strong></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- The Pattern Repeats -->
            <div class="slide light" data-index="11" data-tier="mastery">
              <span class="tier-badge mastery">Methodologist</span>
              <div class="content">
                <h2 class="title navy animate">The Pattern Repeats</h2>
                <p class="direct-address animate delay-1">Remember Module 6? Poldermans fabricated DECREASE data that guided perioperative beta-blocker guidelines for a decade.</p>
                <div class="card animate delay-2">
                  <p>AI can now detect statistical anomalies automatically:</p>
                  <ul style="margin-top: 0.5rem;">
                    <li><strong>GRIM test:</strong> Are reported means consistent with integer sample sizes?</li>
                    <li><strong>SPRITE:</strong> Can the reported summary statistics be reconstructed from plausible individual data?</li>
                    <li><strong>Statcheck:</strong> Do reported p-values match the test statistics?</li>
                  </ul>
                  <p style="margin-top: 1rem;">These tools found anomalies in <strong>hundreds of published papers</strong>&mdash;faster than any human auditor.</p>
                  <p style="margin-top: 0.5rem; font-style: italic; color: var(--gold);">But the machine flags. The human judges. The decision to retract remains profoundly human.</p>
                </div>
              </div>
            </div>

            <!-- Quiz -->
            <div class="slide light" data-index="12">
              <div class="content">
                <h2 class="title navy animate">Module 19 Quiz</h2>
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q1.</strong> What is the minimum acceptable recall for AI-assisted screening in systematic reviews?</p>
                  <div class="quiz-options" id="m19-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 0, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
                      <span>A.</span> 80%
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 1, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
                      <span>B.</span> 90%
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 2, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
                      <span>C.</span> &gt;95%
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m19-q1', 3, 2, ['80% means missing 1 in 5 relevant studies\u2014too many.', '90% still risks missing important studies.', 'Correct! &gt;95% recall is the accepted threshold to minimize the risk of missing relevant studies.', 'While ideal, 100% recall is practically impossible with any automated system.'])">
                      <span>D.</span> 100%
                    </div>
                  </div>
                  <div id="m19-q1-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>

            <!-- Closing -->
            <div class="slide dark" data-index="13">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 19 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "The machine reads faster. The human reads deeper. Together, they read truth."
                </p>
              </div>
            </div>

            <div class="slide black" data-index="14">
              <p class="refrain animate">Not every signal is truth.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 20: The Qualitative</p>
            </div>
          </div>

          <!-- ============================================================
               MODULE 20: THE QUALITATIVE (Bohren 2015  maternity care)
               ============================================================ -->
          <div class="module-slides" data-module="20">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Methods protect patients from our confidence.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 20: The Qualitative</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 20: The Qualitative</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Explain why some questions require qualitative evidence synthesis</li>
                    <li>Describe meta-ethnography (Noblit &amp; Hare) and thematic synthesis</li>
                    <li>Apply the CERQual framework to assess confidence in qualitative findings</li>
                    <li>Understand mixed-methods synthesis approaches</li>
                    <li>Recognize when qualitative evidence changes practice</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">The WHO asked a question</p>
              <p class="title gold animate delay-1 text-center">no RCT could answer.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                Why do women worldwide experience disrespect and abuse during childbirth?
                Bohren et al. (2015) synthesized 65 qualitative studies from 34 countries
                into a framework of seven domains of mistreatment.
              </p>
            </div>

            <!-- Slide A: A Question Beyond Randomization -->
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">A Question Beyond Randomization</h2>
                <div class="card animate delay-1" style="background: rgba(197,48,48,0.06); border-left: 3px solid var(--red);">
                  <p class="card-text">
                    In 2014, the WHO convened a panel to address a global crisis: women were being physically
                    abused, verbally humiliated, and denied care during childbirth. This was not a rare event
                    &mdash; reports came from <strong>34 countries</strong>.
                  </p>
                </div>
                <div class="card animate delay-2" style="margin-top: 1rem;">
                  <p class="card-text">
                    They needed to understand <strong>WHY</strong>. What drives disrespect and abuse in maternity care?
                  </p>
                </div>
                <div class="card animate delay-3" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
                  <p class="card-text">
                    No RCT could answer this. You cannot randomize women to abusive vs respectful care.
                    You cannot blind birth attendants. You cannot measure &ldquo;dignity&rdquo; on a Likert scale.
                    <strong>The evidence had to be qualitative.</strong>
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">Meta-Ethnography</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Developed by Noblit &amp; Hare (1988), meta-ethnography <strong>translates</strong>
                    concepts across studies rather than aggregating numbers. It produces new interpretive
                    frameworks (third-order constructs) from first-order (participant quotes) and
                    second-order (author interpretations) data.
                  </p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">Reciprocal</div>
                    <div class="stat-label">Studies confirm each other</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Refutational</div>
                    <div class="stat-label">Studies contradict each other</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Line of<br>argument</div>
                    <div class="stat-label">Studies build a new theory</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Slide B: Bohren's Seven Domains -->
            <div class="slide dark" data-index="5">
              <div class="content" style="max-width: 750px;">
                <h2 class="title cream animate" style="text-align: center;">What Bohren Found: A Taxonomy of Mistreatment</h2>
                <div class="gold-line animate delay-1"></div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 1.5rem;">
                  <div class="animate delay-2" style="background: rgba(197,48,48,0.15); padding: 0.75rem 1rem; border-radius: 6px;">
                    <strong style="color: var(--gold);">1. Physical abuse</strong>
                    <p style="font-size: 0.9rem; margin-top: 0.25rem;">Hitting, pinching, slapping during labor</p>
                  </div>
                  <div class="animate delay-2" style="background: rgba(197,48,48,0.15); padding: 0.75rem 1rem; border-radius: 6px;">
                    <strong style="color: var(--gold);">2. Sexual abuse</strong>
                    <p style="font-size: 0.9rem; margin-top: 0.25rem;">Inappropriate touching, non-consensual procedures</p>
                  </div>
                  <div class="animate delay-3" style="background: rgba(197,48,48,0.12); padding: 0.75rem 1rem; border-radius: 6px;">
                    <strong style="color: var(--gold);">3. Verbal abuse</strong>
                    <p style="font-size: 0.9rem; margin-top: 0.25rem;">Shouting, threats, judgmental comments</p>
                  </div>
                  <div class="animate delay-3" style="background: rgba(197,48,48,0.12); padding: 0.75rem 1rem; border-radius: 6px;">
                    <strong style="color: var(--gold);">4. Stigma &amp; discrimination</strong>
                    <p style="font-size: 0.9rem; margin-top: 0.25rem;">Based on HIV status, ethnicity, age, poverty</p>
                  </div>
                  <div class="animate delay-4" style="background: rgba(197,48,48,0.09); padding: 0.75rem 1rem; border-radius: 6px;">
                    <strong style="color: var(--gold);">5. Professional standards failure</strong>
                    <p style="font-size: 0.9rem; margin-top: 0.25rem;">Neglect, lack of informed consent</p>
                  </div>
                  <div class="animate delay-4" style="background: rgba(197,48,48,0.09); padding: 0.75rem 1rem; border-radius: 6px;">
                    <strong style="color: var(--gold);">6. Poor rapport</strong>
                    <p style="font-size: 0.9rem; margin-top: 0.25rem;">Poor communication, dismissiveness</p>
                  </div>
                </div>
                <div class="animate delay-4" style="background: rgba(197,48,48,0.06); padding: 0.75rem 1rem; border-radius: 6px; margin-top: 0.75rem; text-align: center;">
                  <strong style="color: var(--gold);">7. Health system conditions</strong>
                  <p style="font-size: 0.9rem; margin-top: 0.25rem;">Overcrowding, understaffing, lack of supplies</p>
                </div>
                <p class="animate delay-4" style="font-size: 1rem; text-align: center; margin-top: 1.25rem; font-style: italic; opacity: 0.9;">
                  65 studies. 34 countries. The same patterns repeated across languages, cultures, and systems.
                  This was not anecdote. This was synthesized evidence.
                </p>
              </div>
            </div>

            <div class="slide light" data-index="6" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">CERQual: Confidence in Qualitative Evidence</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    CERQual assesses confidence in qualitative review findings across four components:
                  </p>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content"><h4>Methodological Limitations</h4><p>Quality of contributing studies.</p></div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content"><h4>Coherence</h4><p>How well data supports the finding.</p></div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content"><h4>Adequacy</h4><p>Richness of data (not just number of studies).</p></div>
                </div>
                <div class="lesson-item animate delay-4">
                  <div class="lesson-number">4</div>
                  <div class="lesson-content"><h4>Relevance</h4><p>Applicability to the review question context.</p></div>
                </div>
              </div>
            </div>

            <!-- Slide C: From Evidence to Action -->
            <div class="slide light" data-index="7">
              <div class="content">
                <h2 class="title navy animate">When Qualitative Evidence Changes Practice</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Bohren's synthesis informed the WHO's <strong>2018 Recommendations on Intrapartum Care
                    for a Positive Childbirth Experience</strong>. Specific changes grounded in qualitative evidence:
                  </p>
                </div>
                <div class="stats-grid animate delay-2" style="margin-top: 1rem;">
                  <div class="stat-box" style="text-align: left; padding: 1rem;">
                    <div class="stat-value" style="font-size: 1.2rem;">Rec. 15</div>
                    <div class="stat-label">Companionship during labor</div>
                  </div>
                  <div class="stat-box" style="text-align: left; padding: 1rem;">
                    <div class="stat-value" style="font-size: 1.2rem;">Rec. 1</div>
                    <div class="stat-label">Respectful maternity care</div>
                  </div>
                  <div class="stat-box" style="text-align: left; padding: 1rem;">
                    <div class="stat-value" style="font-size: 1.2rem;">Rec. 3</div>
                    <div class="stat-label">Effective communication</div>
                  </div>
                  <div class="stat-box" style="text-align: left; padding: 1rem;">
                    <div class="stat-value" style="font-size: 1.2rem;">Rec. 12</div>
                    <div class="stat-label">Emotional support</div>
                  </div>
                </div>
                <p class="footnote animate delay-3" style="margin-top: 1rem; font-weight: 600;">
                  These recommendations &mdash; grounded in qualitative evidence &mdash; now guide maternity
                  care in 194 WHO member states. No forest plot could have produced them. No I&sup2; statistic
                  could have revealed them.
                </p>
              </div>
            </div>

            <!-- Story box -->
            <div class="slide dark" data-index="8">
              <div class="content" style="max-width: 700px;">
                <div class="story-box animate">
                  <h3 style="color: var(--gold); margin-bottom: 1rem;">Bohren's Framework of Mistreatment</h3>
                  <p style="margin-bottom: 0.75rem;">
                    The 2015 qualitative synthesis identified seven domains: physical abuse, sexual abuse,
                    verbal abuse, stigma and discrimination, failure to meet professional standards,
                    poor rapport, and health system conditions. This framework informed the
                    WHO Recommendations on intrapartum care (2018).
                  </p>
                  <p style="font-style: italic; opacity: 0.9;">
                    No p-value could capture the experience of being slapped during labor.
                    Qualitative synthesis gave voice to what numbers could not.
                  </p>
                </div>
              </div>
            </div>

            <!-- Slide D: Decision Tree -->
            <div class="slide light" data-index="9">
              <div class="content">
                <h2 class="title navy animate">Decision Tree: When Is Qualitative Synthesis Appropriate?</h2>
                <div class="decision-tree animate delay-1" style="font-size: 0.95rem; line-height: 1.7;">
                  <div class="card" style="background: var(--navy); color: var(--cream); padding: 1rem; border-radius: 8px;">
                    <p><strong>ROOT:</strong> Is your research question about experiences, perceptions, barriers, or facilitators?</p>
                  </div>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--green);">
                      <p><strong>YES</strong> &rarr; Is your question about the HOW or WHY, not just the WHETHER?</p>
                      <ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
                        <li><strong>Yes:</strong> Qualitative evidence synthesis (meta-ethnography, thematic synthesis, or framework synthesis)</li>
                        <li><strong>No:</strong> Consider mixed-methods: quantitative for effect + qualitative for mechanism</li>
                      </ul>
                    </div>
                    <div style="background: rgba(212,175,55,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--gold);">
                      <p><strong>NO</strong> &rarr; Is your question about effectiveness/efficacy?</p>
                      <ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
                        <li><strong>Yes:</strong> Quantitative meta-analysis</li>
                        <li><strong>But:</strong> Complement with qualitative review of implementation barriers (CERQual-assessed)</li>
                      </ul>
                    </div>
                  </div>
                  <div class="card animate delay-2" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
                    <p class="card-text" style="font-style: italic;">
                      <strong>Key insight:</strong> The strongest systematic reviews answer BOTH: Does it work? (quantitative)
                      AND Why does it work or fail? (qualitative)
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quiz -->
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Module 20 Quiz</h2>
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q1.</strong> What distinguishes meta-ethnography from quantitative meta-analysis?</p>
                  <div class="quiz-options" id="m20-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 0, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
                      <span>A.</span> It only includes 3&ndash;5 studies
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 1, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
                      <span>B.</span> It translates concepts across studies rather than pooling numbers
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 2, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
                      <span>C.</span> It does not require a systematic search
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m20-q1', 3, 1, ['Meta-ethnography can include many more studies when needed.', 'Correct! Meta-ethnography translates conceptual themes across studies rather than pooling numerical effect sizes.', 'Both methods require systematic search strategies.', 'Both are systematic approaches, but they synthesize different types of data.'])">
                      <span>D.</span> It is less rigorous than quantitative synthesis
                    </div>
                  </div>
                  <div id="m20-q1-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>

            <!-- Closing -->
            <div class="slide dark" data-index="11">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 20 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "Not everything that counts can be counted. Not everything counted counts."
                </p>
              </div>
            </div>

            <div class="slide black" data-index="12">
              <p class="refrain animate">Heterogeneity is a message, not noise.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 21: The Multivariate</p>
            </div>
          </div>

          <!-- ============================================================
               MODULE 21: THE MULTIVARIATE (Correlated outcomes / RVE)
               ============================================================ -->
          <div class="module-slides" data-module="21">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Heterogeneity is a message, not noise.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 21: The Multivariate</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 21: The Multivariate</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Recognize when outcomes within a study are correlated</li>
                    <li>Explain multivariate random-effects models</li>
                    <li>Apply robust variance estimation (RVE) for dependent effect sizes</li>
                    <li>Understand three-level models for nested data</li>
                    <li>Choose between multivariate approaches based on data structure</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">Cardiovascular trials report</p>
              <p class="title gold animate delay-1 text-center">mortality, MI, stroke, and more.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                These outcomes are correlated within patients. A patient who dies cannot have an MI endpoint.
                Standard meta-analysis treats each outcome independently&mdash;ignoring the dependence
                and potentially double-counting evidence.
              </p>
            </div>

            <!-- Slide A: The Convenience Lie -->
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The Assumption Nobody Questions</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Open any standard meta-analysis textbook. The models assume each study contributes
                    <strong>one independent effect size</strong>. But reality is different.
                  </p>
                </div>
                <div class="card animate delay-2" style="margin-top: 1rem; background: rgba(197,48,48,0.06); border-left: 3px solid var(--red);">
                  <p class="card-text">
                    A single cardiovascular trial reports mortality, myocardial infarction, stroke, and
                    revascularization. A single psychotherapy study reports depression, anxiety, and quality
                    of life at 3, 6, and 12 months.
                  </p>
                </div>
                <div class="stats-grid animate delay-3" style="margin-top: 1rem;">
                  <div class="stat-box">
                    <div class="stat-value">30 trials</div>
                    <div class="stat-label">&times; 4 outcomes</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">= 120</div>
                    <div class="stat-label">effect sizes</div>
                  </div>
                </div>
                <div class="card animate delay-4" style="margin-top: 1rem;">
                  <p class="card-text">
                    Most analysts either: <strong>(a)</strong> treat all 120 as independent (inflating precision
                    by a factor of &radic;4), or <strong>(b)</strong> pick one outcome and discard the rest.
                    <strong>Both approaches are wrong.</strong>
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">The Dependency Problem</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    In standard pairwise meta-analysis, each study contributes <em>one</em> effect size.
                    But many studies report multiple outcomes, subgroups, timepoints, or arms&mdash;creating
                    <strong>dependent</strong> effect sizes. Ignoring this inflates precision and distorts inference.
                  </p>
                </div>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">RVE</div>
                    <div class="stat-label">Robust Variance Estimation. Sandwich estimator handles unknown correlation.</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">3-Level</div>
                    <div class="stat-label">Study &rarr; Outcome nesting modeled explicitly.</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="5" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Robust Variance Estimation</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    RVE (Hedges, Tipton &amp; Johnson, 2010) uses a <strong>sandwich-type</strong> estimator that
                    provides valid standard errors regardless of the true correlation between dependent effects.
                    No need to know or estimate within-study correlation. Best for &ge;20 studies.
                  </p>
                </div>
                <div class="card animate delay-2" style="margin-top:1rem;">
                  <p class="card-text">
                    <strong>Small-sample correction:</strong> Tipton &amp; Pustejovsky (2015) developed
                    small-sample corrections (CR2) for RVE, using Satterthwaite degrees of freedom
                    when the number of clusters is small.
                  </p>
                </div>
              </div>
            </div>

            <!-- Slide B: The Mathematical Truth -->
            <div class="slide dark" data-index="6" data-tier="methods">
              <span class="tier-badge methods" style="position:absolute; top:1.5rem; right:1.5rem;">Researcher</span>
              <div class="content" style="max-width: 700px;">
                <h2 class="title cream animate" style="text-align: center;">What Dependence Does to Your Confidence Intervals</h2>
                <div class="gold-line animate delay-1"></div>
                <div class="animate delay-2" style="margin-top: 1.5rem; background: rgba(212,175,55,0.1); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
                  <p style="font-size: 1rem; margin-bottom: 0.75rem;">
                    If 4 outcomes from the same study have within-study correlation &rho; = 0.5:
                  </p>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <div style="background: rgba(197,48,48,0.2); padding: 1rem; border-radius: 6px; text-align: center;">
                      <p style="font-size: 0.85rem; opacity: 0.8;">Treating as independent</p>
                      <p style="font-size: 1.5rem; font-weight: 700; color: var(--red); margin-top: 0.25rem;">CI width = X</p>
                    </div>
                    <div style="background: rgba(34,197,94,0.2); padding: 1rem; border-radius: 6px; text-align: center;">
                      <p style="font-size: 0.85rem; opacity: 0.8;">Accounting for dependence</p>
                      <p style="font-size: 1.5rem; font-weight: 700; color: var(--green); margin-top: 0.25rem;">CI width = 1.58X</p>
                    </div>
                  </div>
                  <p style="font-size: 1rem; margin-top: 1rem; text-align: center;">
                    Your confidence interval should be <strong>58% wider</strong>. Every meta-analysis that
                    ignored this published falsely precise results.
                  </p>
                </div>
                <div class="card animate delay-3" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border: 1px solid rgba(212,175,55,0.2);">
                  <p class="card-text" style="color: var(--cream);">
                    <strong>RVE</strong> (Hedges, Tipton &amp; Johnson, 2010): Uses a &ldquo;sandwich&rdquo;
                    variance estimator that produces correct standard errors <em>without</em> needing to know
                    the exact within-study correlation.
                  </p>
                </div>
              </div>
            </div>

            <!-- Slide C: The Three Levels (expanded) -->
            <div class="slide light" data-index="7" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Three-Level Models: Making Structure Explicit</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number">1</div>
                  <div class="lesson-content">
                    <h4>Level 1: Sampling Variance</h4>
                    <p>Measurement error within each effect size estimate.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">2</div>
                  <div class="lesson-content">
                    <h4>Level 2: Within-Study Variance</h4>
                    <p>Outcomes and timepoints vary within a single study.</p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number">3</div>
                  <div class="lesson-content">
                    <h4>Level 3: Between-Study Variance</h4>
                    <p>Studies differ from each other in populations, settings, and methods.</p>
                  </div>
                </div>
                <div class="card animate delay-4" style="margin-top: 1rem; background: rgba(212,175,55,0.08); border-left: 3px solid var(--gold);">
                  <p class="card-text">
                    <strong>Example:</strong> In a meta-analysis of psychotherapy for depression (k=50 studies,
                    180 effect sizes), <strong>35%</strong> of variance was within-study (different outcomes)
                    and <strong>65%</strong> was between-study (different therapies, populations). This decomposition
                    reveals how much heterogeneity is <em>within</em> vs <em>between</em> studies.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="8" data-tier="mastery">
              <span class="tier-badge mastery">Methodologist</span>
              <div class="content">
                <h2 class="title navy animate">Three-Level Models: Formal Framework</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    When effects are nested (e.g., multiple outcomes within studies, or studies within research groups),
                    a <strong>three-level model</strong> partitions variance into: (1) sampling variance (level 1),
                    (2) within-study variance (level 2), and (3) between-study variance (level 3).
                    This maintains correct inference while borrowing strength across levels.
                  </p>
                </div>
              </div>
            </div>

            <!-- Story box -->
            <div class="slide dark" data-index="9">
              <div class="content" style="max-width: 700px;">
                <div class="story-box animate">
                  <h3 style="color: var(--gold); margin-bottom: 1rem;">The Cardiovascular Challenge</h3>
                  <p style="margin-bottom: 0.75rem;">
                    A meta-analysis of statins might include 30 trials, each reporting mortality, MI,
                    stroke, and revascularization. That is 120 effect sizes from 30 clusters.
                    Treating them as 120 independent estimates inflates precision by a factor related to
                    the within-study correlation.
                  </p>
                  <p style="font-style: italic; opacity: 0.9;">
                    RVE or multivariate models handle this correctly&mdash;producing wider, honest confidence intervals.
                  </p>
                </div>
              </div>
            </div>

            <!-- Slide D: Decision Tree -->
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Decision Tree: Which Approach for Dependent Effect Sizes?</h2>
                <div class="decision-tree animate delay-1" style="font-size: 0.95rem; line-height: 1.7;">
                  <div class="card" style="background: var(--navy); color: var(--cream); padding: 1rem; border-radius: 8px;">
                    <p><strong>ROOT:</strong> Does your meta-analysis have multiple effects per study?</p>
                  </div>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <div style="background: rgba(34,197,94,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--green);">
                      <p><strong>YES</strong> &rarr; Do you know (or can estimate) the within-study correlations?</p>
                      <ul style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.9rem;">
                        <li><strong>Yes:</strong> Multivariate random-effects model (most efficient)</li>
                        <li><strong>No:</strong> RVE with small-sample correction (robust to unknown correlations)</li>
                      </ul>
                    </div>
                    <div style="background: rgba(212,175,55,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--gold);">
                      <p><strong>NO</strong> &rarr; Standard univariate random-effects model</p>
                    </div>
                  </div>
                  <div class="card animate delay-2" style="margin-top: 1rem;">
                    <p class="card-text"><strong>Sub-question:</strong> Are your multiple effects from different outcomes, timepoints, or subgroups?</p>
                    <ul style="margin-top: 0.5rem; padding-left: 1.25rem; line-height: 1.8; font-size: 0.9rem;">
                      <li><strong>Different outcomes</strong> &rarr; Three-level model or RVE with clustering</li>
                      <li><strong>Different timepoints</strong> &rarr; Network of timepoints with temporal correlation</li>
                      <li><strong>Different subgroups</strong> &rarr; Consider if subgroups are meaningful or should be averaged</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quiz -->
            <div class="slide light" data-index="11">
              <div class="content">
                <h2 class="title navy animate">Module 21 Quiz</h2>
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q1.</strong> What problem does Robust Variance Estimation (RVE) solve?</p>
                  <div class="quiz-options" id="m21-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 0, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I and tau.', 'Small study effects use regression-based methods.'])">
                      <span>A.</span> Publication bias
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 1, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I and tau.', 'Small study effects use regression-based methods.'])">
                      <span>B.</span> Dependency between multiple effect sizes from the same study
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 2, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I and tau.', 'Small study effects use regression-based methods.'])">
                      <span>C.</span> Between-study heterogeneity
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m21-q1', 3, 1, ['Publication bias is addressed by funnel plots and selection models.', 'Correct! RVE provides valid standard errors when multiple effect sizes from the same study are correlated.', 'Heterogeneity is quantified by I and tau.', 'Small study effects use regression-based methods.'])">
                      <span>D.</span> Small-study effects
                    </div>
                  </div>
                  <div id="m21-q1-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>

            <!-- Closing -->
            <div class="slide dark" data-index="12">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 21 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "When outcomes are entangled, pretending they are independent is a lie of convenience."
                </p>
              </div>
            </div>

            <div class="slide black" data-index="13">
              <p class="refrain animate">The number without provenance is not a number.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 22: The Proof</p>
            </div>
          </div>

          <!-- ============================================================
               MODULE 22: THE PROOF (Reinhart-Rogoff Excel error)
               ============================================================ -->
          <div class="module-slides" data-module="22">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">The number without provenance is not a number.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 22: The Proof</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 22: The Proof</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Understand how computational errors propagate through policy</li>
                    <li>Define reproducibility and distinguish from replicability</li>
                    <li>Apply evidence hashing and proof-carrying numbers</li>
                    <li>Use reproducibility checklists for meta-analysis</li>
                    <li>Recognize the role of pre-registration and open data</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="slide dark" data-index="2">
              <p class="title cream animate text-center">A graduate student opened a spreadsheet</p>
              <p class="title gold animate delay-1 text-center">and found the austerity era was built on an error.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                In 2010, Reinhart and Rogoff claimed countries with &gt;90% debt-to-GDP ratios
                had negative growth. This influenced austerity policies across Europe.
                In 2013, Thomas Herndon found an Excel error that excluded 5 countries
                from the average. The corrected result: modest positive growth, not collapse.
              </p>
            </div>

            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">Reproducibility vs Replicability</h2>
                <div class="stats-grid animate delay-1">
                  <div class="stat-box">
                    <div class="stat-value">Reproducible</div>
                    <div class="stat-label">Same data + same code = same result</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Replicable</div>
                    <div class="stat-label">New data + same methods = consistent result</div>
                  </div>
                </div>
                <div class="card animate delay-2" style="margin-top: 1rem;">
                  <p class="card-text">
                    Reproducibility is the <strong>minimum standard</strong>. If others cannot reproduce your
                    pooled estimate from your reported data, the analysis cannot be verified.
                    Meta-analyses should share: extracted data, analysis scripts, software versions, and random seeds.
                  </p>
                </div>
              </div>
            </div>

            <div class="slide light" data-index="4" data-tier="methods">
              <span class="tier-badge methods">Researcher</span>
              <div class="content">
                <h2 class="title navy animate">Proof-Carrying Numbers</h2>
                <div class="card animate delay-1">
                  <p class="card-text">
                    Every number in a meta-analysis should carry its <strong>provenance</strong>:
                    where it came from, how it was transformed, and what code produced it.
                    <strong>Evidence hashing</strong> creates a cryptographic fingerprint of inputs
                    so any change (accidental or deliberate) is detectable.
                  </p>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number">SHA</div>
                  <div class="lesson-content">
                    <h4>Input Hash</h4>
                    <p>SHA-256 hash of extracted data. If one cell changes, the hash changes. Provenance chain: data &rarr; code &rarr; result &rarr; hash.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Interactive tool -->
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">Interactive: Reproducibility Checklist</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Check off each item to assess a meta-analysis's reproducibility. How does your review score?
                </p>
                <div id="reproducibilityTool" class="animate delay-2" style="background: rgba(30,39,97,0.05); border-radius: 8px; padding: 1rem;">
                  <div id="reproChecklist"></div>
                  <div id="reproScore" style="margin-top:1rem; padding:0.75rem; background:rgba(212,175,55,0.1); border-radius:6px;"></div>
                </div>
              </div>
            </div>

            <!-- Story box -->
            <div class="slide dark" data-index="6">
              <div class="content" style="max-width: 700px;">
                <div class="story-box animate">
                  <h3 style="color: var(--gold); margin-bottom: 1rem;">The Excel Error That Changed Economies</h3>
                  <p style="margin-bottom: 0.75rem;">
                    Reinhart-Rogoff's "Growth in a Time of Debt" was cited in Congressional testimony,
                    European Commission reports, and IMF policy briefs. The Excel error (rows 30&ndash;34
                    were excluded from an AVERAGE formula) meant five countries&mdash;Australia, Austria,
                    Belgium, Canada, and Denmark&mdash;were simply missing.
                  </p>
                  <p style="font-style: italic; opacity: 0.9;">
                    The corrected average went from &minus;0.1% to +2.2%. Austerity policies affected millions.
                    Reproducibility is not academic perfectionism&mdash;it is a safeguard against catastrophe.
                  </p>
                </div>
              </div>
            </div>

            <!-- Callback -->
            <div class="slide dark" data-index="7">
              <div class="content" style="text-align: center;">
                <p class="animate" style="font-size: 1.1rem; opacity: 0.7;">Remember Module 5?</p>
                <p class="title gold animate delay-1">DECREASE Through the Lens of Reproducibility</p>
                <div class="gold-line animate delay-2"></div>
                <p class="animate delay-3" style="max-width: 600px; font-size: 1.05rem;">
                  The DECREASE trials by Don Poldermans were retracted for fabricated data.
                  If proof-carrying numbers had existed&mdash;hashed inputs, provenance chains, verified
                  computations&mdash;the fabrication would have been detectable <em>before</em> the evidence
                  entered meta-analyses and changed surgical guidelines.
                </p>
              </div>
            </div>

            <!-- Quiz -->
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">Module 22 Quiz</h2>
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q1.</strong> What was the Reinhart-Rogoff error?</p>
                  <div class="quiz-options" id="m22-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 0, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
                      <span>A.</span> They used too small a sample
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 1, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
                      <span>B.</span> An Excel formula excluded 5 countries, reversing the conclusion
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 2, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
                      <span>C.</span> They studied the wrong time period
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('m22-q1', 3, 1, ['The sample size was the full dataset of countries.', 'Correct! An Excel formula excluded 5 countries from the average, making high-debt growth appear negative when it was actually positive.', 'The analysis used the correct time period.', 'Wrong statistical test was not the primary issue\u2014the data entry error was.'])">
                      <span>D.</span> They used the wrong statistical test
                    </div>
                  </div>
                  <div id="m22-q1-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>

            <!-- Closing -->
            <div class="slide dark" data-index="9">
              <div class="content" style="text-align: center;">
                <p class="title gold animate">Module 22 Complete</p>
                <div class="gold-line animate delay-1"></div>
                <p class="animate delay-2 serif" style="font-size: 1.3rem; font-style: italic; max-width: 600px;">
                  "The number without provenance is not a number. The analysis without reproducibility is not evidence."
                </p>
              </div>
            </div>

            <div class="slide black" data-index="10">
              <p class="refrain animate">Certainty must be earned, not assumed.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 23: Your First Meta-Sprint</p>
            </div>
          </div>

          <!-- Module 23: Capstone - Your First Meta-Sprint -->
          <div class="module-slides" data-module="23">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Certainty must be earned, not assumed.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 23: Your First Meta-Sprint</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Module 23: Your First Meta-Sprint</h2>
                <div class="learning-objectives animate delay-1">
                  <h4> Learning Objectives</h4>
                  <ul>
                    <li>Understand the 40-day systematic review workflow</li>
                    <li>Map the Seven Principles to real practice phases</li>
                    <li>Recognize Definition-of-Done (DoD) gates as quality checkpoints</li>
                    <li>Appreciate why structure prevents the failures you've studied</li>
                    <li>Graduate ready to conduct (not just understand) meta-analysis</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- The Journey Complete -->
            <div class="slide dark" data-index="2">
              <p class="title cream animate">You have learned the stories.</p>
              <p class="title gold animate delay-1">Now you must walk the path.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1.1rem; text-align: center; max-width: 600px;">
                Every evidence reversal you studied happened because teams <em>knew</em> the methods but didn't <em>follow</em> them systematically.
              </p>
            </div>

            <!-- The META-SPRINT Framework -->
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">The META-SPRINT Framework</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  A 40-day structured workflow with 5 phase gates. Each gate is a Definition-of-Done (DoD) checkpoint that prevents you from moving forward until quality is assured.
                </p>
                <div class="stats-grid animate delay-2">
                  <div class="stat-box">
                    <div class="stat-value">40</div>
                    <div class="stat-label">Days to Completion</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">5</div>
                    <div class="stat-label">DoD Phase Gates</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-value">Day 34</div>
                    <div class="stat-label">Hard Freeze</div>
                  </div>
                </div>
                <div class="card animate delay-3" style="margin-top: 1rem; background: rgba(212,175,55,0.1); border: 1px solid var(--gold);">
                  <p class="card-text" style="font-size: 0.9rem;">
                    <strong style="color: var(--gold);">Why 40 days?</strong> Long enough for rigor, short enough to prevent scope creep. The rosiglitazone cardiac signals were buried for years because there was no deadline forcing transparency.
                  </p>
                </div>
              </div>
            </div>

            <!-- The Five Gates -->
            <div class="slide light" data-index="4">
              <div class="content">
                <h2 class="title navy animate">The Five Phase Gates</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number" style="background: #7C3AED;">A</div>
                  <div class="lesson-content">
                    <h4>DoD-A: Protocol Lock (Days 1-3)</h4>
                    <p>PICOS defined, timepoint rules set, model choices pre-specified. <em>No moving target.</em></p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #2563EB;">B</div>
                  <div class="lesson-content">
                    <h4>DoD-B: Search Lock (Days 6-10)</h4>
                    <p>All databases searched, grey literature checked, PRESS validated. <em>No hidden studies.</em></p>
                  </div>
                </div>
                <div class="lesson-item animate delay-3">
                  <div class="lesson-number" style="background: #D97706;">C</div>
                  <div class="lesson-content">
                    <h4>DoD-C: Extraction Lock (Days 10-28)</h4>
                    <p>Dual extraction, provenance linked, RoB assessed. <em>No fabricated numbers.</em></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Gates continued -->
            <div class="slide light" data-index="5">
              <div class="content">
                <h2 class="title navy animate">The Five Phase Gates (continued)</h2>
                <div class="lesson-item animate delay-1">
                  <div class="lesson-number" style="background: #059669;">D</div>
                  <div class="lesson-content">
                    <h4>DoD-D: Analysis Lock (Days 21-33)</h4>
                    <p>Forest plots generated, sensitivity analyses run, heterogeneity explored. <em>No cherry-picking.</em></p>
                  </div>
                </div>
                <div class="lesson-item animate delay-2">
                  <div class="lesson-number" style="background: #DC2626;">E</div>
                  <div class="lesson-content">
                    <h4>DoD-E: Submission Lock (Days 33-40)</h4>
                    <p>GRADE certainty rated, clinical summary written, manuscript finalized. <em>No overconfidence.</em></p>
                  </div>
                </div>
                <div class="card animate delay-3" style="margin-top: 1rem; background: rgba(220,38,38,0.1); border: 1px solid #DC2626;">
                  <p class="card-text" style="font-size: 0.9rem;">
                    <strong style="color: #DC2626;">Day 34 Freeze:</strong> No new studies can be added after Day 34. This prevents the "weaponized scope creep" that plagued the BMP spine surgery meta-analyses, where industry kept "finding" favorable studies.
                  </p>
                </div>
              </div>
            </div>

            <!-- Seven Principles Mapped to Practice -->
            <div class="slide light" data-index="6">
              <div class="content">
                <h2 class="title navy animate">The Seven Principles in Practice</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  Every principle you learned maps to a specific phase gate:
                </p>
                <div style="display: grid; gap: 0.5rem; font-size: 0.85rem;" class="animate delay-2">
                  <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(124,58,237,0.1); border-radius: 6px;">
                    <span style="color: #7C3AED; font-weight: 700; min-width: 40px;">DoD-A</span>
                    <span>"<em>Not every signal is truth</em>"  Pre-specify what counts as evidence</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(37,99,235,0.1); border-radius: 6px;">
                    <span style="color: #2563EB; font-weight: 700; min-width: 40px;">DoD-B</span>
                    <span>"<em>What was hidden in plain sight?</em>"  Search comprehensively</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(217,119,6,0.1); border-radius: 6px;">
                    <span style="color: #D97706; font-weight: 700; min-width: 40px;">DoD-C</span>
                    <span>"<em>The number without provenance is not a number</em>"  Link every data point</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(5,150,105,0.1); border-radius: 6px;">
                    <span style="color: #059669; font-weight: 700; min-width: 40px;">DoD-D</span>
                    <span>"<em>Heterogeneity is a message, not noise</em>"  Investigate, don't ignore</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(220,38,38,0.1); border-radius: 6px;">
                    <span style="color: #DC2626; font-weight: 700; min-width: 40px;">DoD-E</span>
                    <span>"<em>Certainty must be earned, not assumed</em>"  GRADE everything</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Red-Team Adversarial QA -->
            <div class="slide dark" data-index="7">
              <p class="title cream animate">The Red-Team Principle</p>
              <p class="title gold animate delay-1">Your own team tries to break your work.</p>
              <div class="gold-line animate delay-2"></div>
              <p class="animate delay-3" style="font-size: 1rem; text-align: center; max-width: 650px;">
                Every day, two rotating team members spend 12 minutes checking data quality as adversaries. This is how Boldt's fraud was caughtnot by friendly review, but by skeptical checking that noticed impossible recruitment rates.
              </p>
            </div>

            <!-- CondGO Emergency Protocol -->
            <div class="slide light" data-index="8">
              <div class="content">
                <h2 class="title navy animate">CondGO: When Things Go Wrong</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1rem;">
                  What happens when you discover a critical problem mid-sprint?
                </p>
                <div class="card animate delay-2" style="background: rgba(217,119,6,0.1); border: 1px solid #D97706;">
                  <h4 style="color: #D97706;">CondGO = Conditional Go</h4>
                  <p class="card-text" style="font-size: 0.9rem;">
                    A bounded rescue protocol. You have exactly <strong>72 hours</strong> to fix the problem using only allowed actions. If you can't fix it, you must stop the review.
                  </p>
                </div>
                <div class="card animate delay-3" style="margin-top: 1rem;">
                  <p class="card-text" style="font-size: 0.85rem; font-style: italic;">
                     <strong>The Avandia lesson:</strong> GSK saw cardiovascular signals in 2000 but had no forced deadline. They "watched and waited" for 7 years. Tens of thousands were harmed. CondGO exists because "we'll deal with it eventually" kills people.
                  </p>
                </div>
              </div>
            </div>

            <!-- Your Graduation -->
            <div class="slide dark" data-index="9">
              <p class="title cream animate">You began this course with stories.</p>
              <p class="title gold animate delay-1">You end it ready for practice.</p>
              <div class="gold-line animate delay-2"></div>
              <div class="animate delay-3" style="text-align: center; max-width: 600px;">
                <p style="font-size: 1rem; margin-bottom: 1rem;">
                  The META-SPRINT workflow takes everything you've learned and structures it into a 40-day system that prevents the failures you've studied.
                </p>
                <p style="font-size: 0.9rem; opacity: 0.9;">
                  When you're ready to conduct a real systematic review, open the META-SPRINT application. The stories you've learned here will guide youappearing as reminders at every step.
                </p>
              </div>
            </div>

            <!-- STORY: The CTT Collaboration  When Methods Save Millions -->
            <div class="slide dark" data-index="9b">
              <div class="story-box animate">
                <p class="story-opener">What does it look like when every principle is followed?</p>

                <div class="real-data-box">
                  <h4>REAL DATA</h4>
                  <p>
                    The Cholesterol Treatment Trialists' (CTT) Collaboration is the gold standard of meta-analysis.
                    They obtained <span class="data-highlight">individual patient data from 170,000+ participants</span>
                    across <span class="data-highlight">26 statin trials</span>.
                    Pre-specified protocol. IPD from all major trials. Standardized outcomes.
                    Result: statins reduce <span class="data-highlight">major vascular events by 21% per mmol/L LDL reduction</span>
                    (RR 0.79, 95% CI 0.77-0.81), regardless of baseline risk.
                    This finding, replicated across <span class="data-highlight">5 meta-analyses over 15 years</span>,
                    has prevented an estimated <span class="data-highlight">millions of heart attacks and strokes worldwide</span>.
                  </p>
                </div>

                <div class="decision-tree">
                  <div class="decision-tree-header">The Seven Principles Applied</div>
                  <div class="decision-scenario">
                    The CTT story shows what happens when every principle from this course is followed. Consider the alternative:
                  </div>
                  <div class="decision-paths">
                    <div class="decision-path path-a" tabindex="0" role="button">
                      <div class="path-label">PATH A: Without the Principles</div>
                      <div class="path-choice">No protocol. Published data only. No RoB. No heterogeneity investigation. No GRADE.</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Conflicting small trials. Statin controversy persists. Millions untreated.</div>
                      <div class="path-outcome">OUTCOME: Preventable cardiovascular deaths continue</div>
                    </div>
                    <div class="decision-path path-b" tabindex="0" role="button">
                      <div class="path-label">PATH B: The CTT Way</div>
                      <div class="path-choice">Pre-registered protocol. IPD from all trials. Standardized outcomes. Transparent methods. GRADE High certainty.</div>
                      <div class="path-arrow"></div>
                      <div class="path-consequence">Definitive answer. Global guidelines change. Statins prescribed to those who benefit.</div>
                      <div class="path-outcome">OUTCOME: Millions of lives saved by rigorous evidence synthesis</div>
                    </div>
                  </div>
                </div>

                <div class="story-revelation">
                  <div class="revelation-label">THE REVELATION</div>
                  <div class="revelation-text">
                    Every principle in this course exists because its absence caused harm.
                    The CTT Collaboration proves that when methods are rigorous, when data has provenance,
                    when bias is assessed and certainty is earned  meta-analysis becomes the most powerful tool in medicine.
                    You now carry these principles. Use them.
                  </div>
                </div>
              </div>
            </div>
            <!-- Capstone Quiz -->
            <div class="slide light" data-index="10">
              <div class="content">
                <h2 class="title navy animate">Capstone Quiz</h2>
                <div class="quiz-container">
                  <div class="quiz-question" id="q13-1">
                    <h4>1. What is the purpose of the Day 34 "hard freeze" in META-SPRINT?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-1', 0, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">A. To allow time for peer review</div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-1', 1, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">B. To prevent late-added studies from manipulating results</div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-1', 2, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">C. To speed up publication</div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-1', 3, 1, ['Close but incomplete. The freeze also prevents weaponized scope creep.', 'Correct! The BMP spine surgery scandal showed how late-added studies can manipulate pooled estimates.', 'The freeze is about scope control, not speed.', 'Publication timing is separate from the methodological freeze.'])">D. To coordinate with journal deadlines</div>
                    </div>
                    <div class="quiz-feedback" id="q13-1-feedback"></div>
                  </div>

                  <div class="quiz-question" id="q13-2" style="margin-top: 1.5rem;">
                    <h4>2. The CondGO protocol gives teams how long to fix critical problems?</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-2', 0, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too longproblems would fester like they did at GSK.'])">A. 24 hours</div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-2', 1, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too longproblems would fester like they did at GSK.'])">B. 48 hours</div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-2', 2, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too longproblems would fester like they did at GSK.'])">C. 72 hours</div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-2', 3, 2, ['Too short for meaningful fixes.', 'Still too short.', 'Correct! 72 hours forces urgent action without allowing indefinite delay (the Avandia failure mode).', 'Too longproblems would fester like they did at GSK.'])">D. 1 week</div>
                    </div>
                    <div class="quiz-feedback" id="q13-2-feedback"></div>
                  </div>

                  <div class="quiz-question" id="q13-3" style="margin-top: 1.5rem;">
                    <h4>3. Red-team adversarial QA caught Joachim Boldt's fraud by noticing:</h4>
                    <div class="quiz-options">
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-3', 0, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistentthat was part of the deception.', 'There were no whistleblowers initially.'])">A. Impossible patient recruitment rates</div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-3', 1, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistentthat was part of the deception.', 'There were no whistleblowers initially.'])">B. p-hacking in statistical tests</div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-3', 2, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistentthat was part of the deception.', 'There were no whistleblowers initially.'])">C. Inconsistent effect sizes</div>
                      <div class="quiz-option" onclick="checkQuizAnswer('q13-3', 3, 0, ['Correct! Adversarial checking found patterns that friendly review missed for years.', 'Statistical tests came later.', 'The results looked consistentthat was part of the deception.', 'There were no whistleblowers initially.'])">D. Whistleblower testimony</div>
                    </div>
                    <div class="quiz-feedback" id="q13-3-feedback"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Closing -->
            <div class="slide black" data-index="11">
              <div class="animate" style="text-align: center;">
                <p class="refrain">The stories you've learned are not history.</p>
                <p style="font-size: 1.2rem; margin-top: 1rem; color: var(--gold);">They are warnings that guard your future work.</p>
                <div class="gold-line" style="margin: 1.5rem auto;"></div>
                <p style="font-size: 1rem; margin-top: 1.5rem; opacity: 0.9;">
                  When you conduct your first meta-analysis,<br>
                  remember CAST before you trust a signal,<br>
                  remember Poldermans before you skip provenance,<br>
                  remember Reboxetine before you ignore the funnel.
                </p>
                <p style="font-size: 0.9rem; margin-top: 1.5rem; font-style: italic; opacity: 0.8;">
                  You are now ready. Go with structure. Go with humility. Go with the Seven Principles.
                </p>
              </div>
            </div>

            <div class="slide black" data-index="12">
              <p class="refrain animate">Not every signal is truth.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Module 24: Final Examination</p>
            </div>
          </div>

          <!-- Module 24: Final Exam (Summative Assessment) -->
          <div class="module-slides" data-module="24">
            <div class="slide dark active" data-index="0">
              <p class="refrain animate">Certainty must be earned, not assumed.</p>
              <p class="animate delay-1" style="font-size: 1.25rem; margin-top: 1.5rem;">Final Examination</p>
            </div>
            <div class="slide light" data-index="1">
              <div class="content">
                <h2 class="title navy animate">Final Exam: Part 1 of 2</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1.5rem;">
                  Test your mastery of meta-analysis principles. Each question addresses a core concept from the course.
                </p>

                <!-- Q1: PICO -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
                  <p class="quiz-question"><strong>Q1.</strong> A researcher wants to study "the effects of exercise on health." What is the PRIMARY problem with this research question?</p>
                  <div class="quiz-options" id="final-q1">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q1', 0, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
                      <span>A.</span> It lacks randomization
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q1', 1, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
                      <span>B.</span> Sample size is too small
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q1', 2, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
                      <span>C.</span> It is not answerablelacks specific PICO elements
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q1', 3, 2, ['Study design matters, but a poorly framed question can use any design.', 'Study size is about precision, not question framing.', 'Correct! A PICO question must specify Population, Intervention, Comparator, and Outcome. This question lacks all specificity.', 'Ethical approval is procedural, not methodological.'])">
                      <span>D.</span> It lacks ethical approval
                    </div>
                  </div>
                  <div id="final-q1-feedback" style="display: none;"></div>
                </div>

                <!-- Q2: Publication Bias -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
                  <p class="quiz-question"><strong>Q2.</strong> A funnel plot shows pronounced asymmetry with missing studies in the lower-left region. What does this suggest?</p>
                  <div class="quiz-options" id="final-q2">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q2', 0, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
                      <span>A.</span> Large studies have more precise estimates
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q2', 1, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
                      <span>B.</span> Small negative studies are likely unpublished
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q2', 2, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
                      <span>C.</span> The true effect is stronger than estimated
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q2', 3, 1, ['Large effects favor different directions, not one region.', 'Correct! The pattern is consistent with small-study effects; publication bias is one plausible explanation.', 'True effects would show symmetry around the pooled estimate.', 'Random error would cause symmetric scatter, not systematic asymmetry.'])">
                      <span>D.</span> Random sampling error
                    </div>
                  </div>
                  <div id="final-q2-feedback" style="display: none;"></div>
                </div>

                <!-- Q3: Heterogeneity -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
                  <p class="quiz-question"><strong>Q3.</strong> A meta-analysis reports I = 85% and  = 0.42. What is the MOST appropriate interpretation?</p>
                  <div class="quiz-options" id="final-q3">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q3', 0, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I.', 'Correct! High I means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I.'])">
                      <span>A.</span> There is an 85% chance of a true effect
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q3', 1, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I.', 'Correct! High I means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I.'])">
                      <span>B.</span> The effect size is very large
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q3', 2, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I.', 'Correct! High I means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I.'])">
                      <span>C.</span> Substantial between-study variance exists; investigate sources
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q3', 3, 2, ['85% chance would be a probability, not a proportion of variance.', 'Effect magnitude is shown by the pooled estimate, not I.', 'Correct! High I means most variability is true heterogeneity. Explore sources before pooling.', 'Clinical relevance depends on the outcome, not I.'])">
                      <span>D.</span> The results are clinically important
                    </div>
                  </div>
                  <div id="final-q3-feedback" style="display: none;"></div>
                </div>

                <!-- Q4: GRADE -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1.5rem;">
                  <p class="quiz-question"><strong>Q4.</strong> In GRADE, what is the starting certainty for a body of evidence from randomized controlled trials?</p>
                  <div class="quiz-options" id="final-q4">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q4', 0, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting pointit results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
                      <span>A.</span> High
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q4', 1, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting pointit results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
                      <span>B.</span> Moderate
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q4', 2, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting pointit results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
                      <span>C.</span> Low
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q4', 3, 0, ['Correct! RCTs start at HIGH certainty, then may be downgraded for risk of bias, inconsistency, indirectness, imprecision, or publication bias.', 'Moderate is not a starting pointit results from downgrading.', 'Low is the starting point for observational studies.', 'Very low requires multiple downgrades.'])">
                      <span>D.</span> Very low
                    </div>
                  </div>
                  <div id="final-q4-feedback" style="display: none;"></div>
                </div>

                <!-- Q5: Risk of Bias -->
                <div class="quiz-box animate delay-2">
                  <p class="quiz-question"><strong>Q5.</strong> In RoB 2.0, which domain assesses whether outcome assessors knew the treatment allocation?</p>
                  <div class="quiz-options" id="final-q5">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q5', 0, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
                      <span>A.</span> D1: Randomization process
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q5', 1, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
                      <span>B.</span> D2: Deviations from intended interventions
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q5', 2, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
                      <span>C.</span> D3: Missing outcome data
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q5', 3, 3, ['Randomization is about allocation sequence generation.', 'Deviations assess protocol adherence and contamination.', 'Missing data assesses attrition and exclusions.', 'Correct! Domain 4 (Measurement of the outcome) includes blinding of outcome assessors.'])">
                      <span>D.</span> D4: Measurement of the outcome
                    </div>
                  </div>
                  <div id="final-q5-feedback" style="display: none;"></div>
                </div>
              </div>
            </div>
            <div class="slide light" data-index="2">
              <div class="content">
                <h2 class="title navy animate">Final Exam: Part 2 of 2</h2>

                <!-- Q6: Evidence Reversal -->
                <div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
                  <p class="quiz-question"><strong>Q6.</strong> The CAST trial showed that antiarrhythmic drugs increased mortality despite suppressing arrhythmias. This is an example of:</p>
                  <div class="quiz-options" id="final-q6">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q6', 0, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
                      <span>A.</span> Random sampling error
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q6', 1, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
                      <span>B.</span> Surrogate outcome failure
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q6', 2, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
                      <span>C.</span> Confounding by indication
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q6', 3, 1, ['Random error would not show consistent harm.', 'Correct! PVC suppression (surrogate) did not predict mortality (patient-important outcome).', 'Confounding involves unmeasured variables, but CAST was randomized.', 'The trial was stopped early for harm, indicating clear causation.'])">
                      <span>D.</span> Reverse causation
                    </div>
                  </div>
                  <div id="final-q6-feedback" style="display: none;"></div>
                </div>

                <!-- Q7: Fixed vs Random Effects -->
                <div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
                  <p class="quiz-question"><strong>Q7.</strong> When should a random-effects model be preferred over a fixed-effect model?</p>
                  <div class="quiz-options" id="final-q7">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q7', 0, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
                      <span>A.</span> When sample sizes are large
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q7', 1, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
                      <span>B.</span> When outcomes are binary
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q7', 2, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
                      <span>C.</span> When between-study heterogeneity is expected
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q7', 3, 2, ['Sample size does not determine model choice.', 'Outcome type is irrelevant to model selection.', 'Correct! Random-effects assumes true effects vary between studies; use when heterogeneity is expected or observed.', 'Publication bias is assessed separately from model choice.'])">
                      <span>D.</span> When publication bias is suspected
                    </div>
                  </div>
                  <div id="final-q7-feedback" style="display: none;"></div>
                </div>

                <!-- Q8: ICEMAN -->
                <div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
                  <p class="quiz-question"><strong>Q8.</strong> According to ICEMAN criteria, which makes a subgroup analysis MORE credible?</p>
                  <div class="quiz-options" id="final-q8">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q8', 0, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Oppositesmall numbers of subgroups are more credible.', 'Oppositebiological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
                      <span>A.</span> Hypothesis specified a priori
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q8', 1, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Oppositesmall numbers of subgroups are more credible.', 'Oppositebiological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
                      <span>B.</span> Large number of subgroups tested
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q8', 2, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Oppositesmall numbers of subgroups are more credible.', 'Oppositebiological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
                      <span>C.</span> No biological rationale
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q8', 3, 0, ['Correct! Pre-specification prevents fishing for significant subgroups. Post-hoc subgroups are hypothesis-generating only.', 'Oppositesmall numbers of subgroups are more credible.', 'Oppositebiological rationale strengthens credibility.', 'Consistent effects within subgroups would support pooling.'])">
                      <span>D.</span> Inconsistent effects across trials within subgroup
                    </div>
                  </div>
                  <div id="final-q8-feedback" style="display: none;"></div>
                </div>

                <!-- Q9: Network Meta-Analysis -->
                <div class="quiz-box animate delay-1" style="margin-bottom: 1.5rem;">
                  <p class="quiz-question"><strong>Q9.</strong> What assumption must be checked in network meta-analysis to ensure valid indirect comparisons?</p>
                  <div class="quiz-options" id="final-q9">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q9', 0, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparatorsno systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
                      <span>A.</span> All studies have equal sample sizes
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q9', 1, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparatorsno systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
                      <span>B.</span> All studies measure the same outcome
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q9', 2, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparatorsno systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
                      <span>C.</span> Transitivity (consistency of effect modifiers)
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q9', 3, 2, ['Equal sample sizes are not required.', 'Same outcomes are needed, but transitivity is the key assumption.', 'Correct! Transitivity means treatment comparisons are valid through common comparatorsno systematic differences in effect modifiers across comparisons.', 'Blinding is study-level, not network-level.'])">
                      <span>D.</span> Double-blinding in all trials
                    </div>
                  </div>
                  <div id="final-q9-feedback" style="display: none;"></div>
                </div>

                <!-- Q10: TSA -->
                <div class="quiz-box animate delay-1">
                  <p class="quiz-question"><strong>Q10.</strong> In Trial Sequential Analysis (TSA), what does crossing the futility boundary indicate?</p>
                  <div class="quiz-options" id="final-q10">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q10', 0, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Oppositecrossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
                      <span>A.</span> The treatment causes harm
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q10', 1, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Oppositecrossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
                      <span>B.</span> Further studies are unlikely to show a meaningful effect
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q10', 2, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Oppositecrossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
                      <span>C.</span> The evidence is conclusive for benefit
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q10', 3, 1, ['Harm boundary indicates increased risk of adverse events.', 'Correct! Crossing futility means even with more data, the effect is unlikely to reach clinical significance.', 'Oppositecrossing benefit boundary indicates sufficient evidence of effect.', 'Power is about required sample size, not boundary crossing.'])">
                      <span>D.</span> The meta-analysis is underpowered
                    </div>
                  </div>
                  <div id="final-q10-feedback" style="display: none;"></div>
                </div>

                <div class="animate delay-2" style="margin-top: 2rem; padding: 1.5rem; background: rgba(212,175,55,0.1); border-radius: 8px; border-left: 4px solid var(--gold);">
                  <p style="font-weight: 600; color: var(--navy);">Part 1 Complete &mdash; continue to Part 2 (Advanced Modules)</p>
                </div>
              </div>
            </div>

            <!-- Part 2: Advanced Module Questions (Q11-Q25) -->
            <div class="slide light" data-index="3">
              <div class="content">
                <h2 class="title navy animate">Final Exam: Part 2 of 2 (Advanced)</h2>
                <p class="animate delay-1" style="color: var(--light-text); margin-bottom: 1.5rem;">
                  Questions 11&ndash;25 cover Modules 13&ndash;22 (Bayesian, NMA, IPD, Dose-Response, Fragility, Equity, AI, Qualitative, Multivariate, Reproducibility).
                </p>

                <!-- Q11: Bayesian -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
                  <p class="quiz-question"><strong>Q11.</strong> In Bayesian meta-analysis, what happens when you use a vague prior with many studies?</p>
                  <div class="quiz-options" id="final-q11">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q11', 0, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
                      <span>A.</span> The posterior closely matches the frequentist result
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q11', 1, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
                      <span>B.</span> The prior dominates the posterior
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q11', 2, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
                      <span>C.</span> The credible interval becomes infinitely wide
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q11', 3, 0, ['Correct! With enough data, even a vague prior produces results very similar to frequentist. Data dominates.', 'The prior becomes irrelevant\u2014it does not become the result.', 'More studies narrow the posterior, not widen it.', 'The model still converges; it just resembles frequentist results.'])">
                      <span>D.</span> The model fails to converge
                    </div>
                  </div>
                  <div id="final-q11-feedback" style="display: none;"></div>
                </div>

                <!-- Q12: NMA -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
                  <p class="quiz-question"><strong>Q12.</strong> In Cipriani's antidepressant NMA, why was no single drug declared "the winner"?</p>
                  <div class="quiz-options" id="final-q12">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q12', 0, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
                      <span>A.</span> Too few studies
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q12', 1, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
                      <span>B.</span> Different drugs ranked best on different outcomes
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q12', 2, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
                      <span>C.</span> No indirect evidence was available
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q12', 3, 1, ['Statistical power was sufficient with 522 trials.', 'Correct! Different drugs ranked best on different outcomes (efficacy vs acceptability). NMA reveals trade-offs.', 'NMA does use both direct and indirect evidence.', 'Rankings were possible\u2014but they showed different drugs for different outcomes.'])">
                      <span>D.</span> SUCRA could not be calculated
                    </div>
                  </div>
                  <div id="final-q12-feedback" style="display: none;"></div>
                </div>

                <!-- Q13: IPD -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
                  <p class="quiz-question"><strong>Q13.</strong> Why should you never pool IPD as if from one mega-trial?</p>
                  <div class="quiz-options" id="final-q13">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q13', 0, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
                      <span>A.</span> IPD always has fewer studies than aggregate
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q13', 1, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
                      <span>B.</span> It ignores study clustering and introduces confounding
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q13', 2, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
                      <span>C.</span> It cannot handle time-to-event data
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q13', 3, 1, ['IPD is about more granular data, not fewer studies.', 'Correct! Ignoring study clustering can introduce confounding (Simpson\'s paradox). Always account for study as a clustering variable.', 'Time-to-event data can be modelled in IPD meta-analysis.', 'Binary outcomes work fine in IPD models.'])">
                      <span>D.</span> Binary outcomes cannot be pooled
                    </div>
                  </div>
                  <div id="final-q13-feedback" style="display: none;"></div>
                </div>

                <!-- Q14: Dose-response -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
                  <p class="quiz-question"><strong>Q14.</strong> What caused the alcohol "J-curve" to disappear in Stockwell's reanalysis?</p>
                  <div class="quiz-options" id="final-q14">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q14', 0, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
                      <span>A.</span> New studies were added that showed no benefit
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q14', 1, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
                      <span>B.</span> Former drinkers were correctly removed from the abstainer reference group
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q14', 2, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
                      <span>C.</span> The sample size was increased
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q14', 3, 1, ['The studies were the same\u2014only the reference group classification changed.', 'Correct! Former drinkers (who quit due to illness) were misclassified as abstainers, making the reference group appear unhealthier.', 'Larger sample size alone does not change the shape of the curve.', 'Confounders were part of the issue, but the key was the reference group definition.'])">
                      <span>D.</span> Better adjustment for confounders
                    </div>
                  </div>
                  <div id="final-q14-feedback" style="display: none;"></div>
                </div>

                <!-- Q15: Fragility -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
                  <p class="quiz-question"><strong>Q15.</strong> In the oseltamivir saga, what did Cochrane discover when accessing unpublished clinical study reports?</p>
                  <div class="quiz-options" id="final-q15">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q15', 0, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
                      <span>A.</span> The drug was completely ineffective
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q15', 1, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
                      <span>B.</span> The effect was larger than originally thought
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q15', 2, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
                      <span>C.</span> The benefit for complications largely disappeared
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q15', 3, 2, ['The drug was still effective for reducing symptom duration.', 'The original analysis already showed large effects.', 'Correct! The claimed 67% reduction in complications fell to a non-significant 11% when unpublished data was included.', 'Side effects were a separate finding.'])">
                      <span>D.</span> Side effects were more common than reported
                    </div>
                  </div>
                  <div id="final-q15-feedback" style="display: none;"></div>
                </div>

                <!-- Q16: Equity -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
                  <p class="quiz-question"><strong>Q16.</strong> What percentage of US hypertensive patients would NOT have qualified for the SPRINT trial?</p>
                  <div class="quiz-options" id="final-q16">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q16', 0, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
                      <span>A.</span> About 25%
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q16', 1, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
                      <span>B.</span> About 50%
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q16', 2, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
                      <span>C.</span> Over 75%
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q16', 3, 2, ['Only 25% excluded would still leave most patients represented.', 'Half excluded is an underestimate.', 'Correct! Over 75% of US hypertensive patients had exclusion criteria (diabetes, prior stroke, heart failure).', '100% would mean no one qualified\u2014the trial did enroll 9,361 patients.'])">
                      <span>D.</span> Nearly 100%
                    </div>
                  </div>
                  <div id="final-q16-feedback" style="display: none;"></div>
                </div>

                <!-- Q17: AI -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
                  <p class="quiz-question"><strong>Q17.</strong> Why is AI considered an "augmenter" rather than a "replacer" in systematic reviews?</p>
                  <div class="quiz-options" id="final-q17">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q17', 0, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
                      <span>A.</span> AI is slower than human reviewers
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q17', 1, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
                      <span>B.</span> AI has perfect recall
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q17', 2, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
                      <span>C.</span> AI screens fast but cannot make human-level contextual judgments
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q17', 3, 2, ['AI is faster than humans at screening, not slower.', 'AI achieves high recall but requires human verification for inclusion decisions.', 'Correct! AI achieves high recall but cannot make contextual judgments about relevance, quality, and applicability that humans can.', 'Cost is not the primary reason\u2014accuracy and judgment are.'])">
                      <span>D.</span> AI is too expensive for most reviews
                    </div>
                  </div>
                  <div id="final-q17-feedback" style="display: none;"></div>
                </div>

                <!-- Q18: Qualitative -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
                  <p class="quiz-question"><strong>Q18.</strong> What does the "adequacy" component of CERQual assess?</p>
                  <div class="quiz-options" id="final-q18">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q18', 0, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
                      <span>A.</span> The number of studies only
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q18', 1, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
                      <span>B.</span> The richness and quantity of data supporting the finding
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q18', 2, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
                      <span>C.</span> Consistency of findings across studies
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q18', 3, 1, ['Number of studies is part of it, but adequacy is about richness of data, not just count.', 'Correct! Adequacy assesses the richness and quantity of data supporting the review finding, not just how many studies.', 'Consistency is assessed under the coherence component.', 'Generalizability is closer to the relevance component.'])">
                      <span>D.</span> Generalizability to other populations
                    </div>
                  </div>
                  <div id="final-q18-feedback" style="display: none;"></div>
                </div>

                <!-- Q19: Multivariate -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
                  <p class="quiz-question"><strong>Q19.</strong> A meta-analysis includes 30 statin trials, each reporting 4 correlated outcomes (120 effect sizes). Which approach is correct?</p>
                  <div class="quiz-options" id="final-q19">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q19', 0, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
                      <span>A.</span> Treat all 120 as independent effect sizes
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q19', 1, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
                      <span>B.</span> Use RVE with small-sample correction
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q19', 2, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
                      <span>C.</span> Pick only one outcome per study
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q19', 3, 1, ['Treating 120 dependent effects as independent inflates precision.', 'Correct! RVE with small-sample correction handles dependent effect sizes without knowing the true within-study correlation.', 'Picking one outcome wastes data and may not answer the key question.', 'Averaging within studies loses information about outcome-specific effects.'])">
                      <span>D.</span> Average the 4 outcomes within each study
                    </div>
                  </div>
                  <div id="final-q19-feedback" style="display: none;"></div>
                </div>

                <!-- Q20: Reproducibility -->
                <div class="quiz-box animate delay-2" style="margin-bottom: 1rem;">
                  <p class="quiz-question"><strong>Q20.</strong> In the Reinhart-Rogoff error, what was the corrected average growth rate for high-debt countries?</p>
                  <div class="quiz-options" id="final-q20">
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q20', 0, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
                      <span>A.</span> &minus;0.1% (same as claimed)
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q20', 1, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
                      <span>B.</span> +2.2%
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q20', 2, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
                      <span>C.</span> 0%
                    </div>
                    <div class="quiz-option" onclick="checkQuizAnswer('final-q20', 3, 1, ['That was the INCORRECT value from the erroneous spreadsheet.', 'Correct! After including the 5 missing countries, average growth went from -0.1% to +2.2%.', '0% would mean no growth at all.', '5% would be unusually high for high-debt countries.'])">
                      <span>D.</span> +5%
                    </div>
                  </div>
                  <div id="final-q20-feedback" style="display: none;"></div>
                </div>

                <div class="animate delay-2" style="margin-top: 2rem; padding: 1.5rem; background: rgba(212,175,55,0.1); border-radius: 8px; border-left: 4px solid var(--gold);">
                  <p style="font-weight: 600; color: var(--navy);">Passing Score: 15/20 across both parts</p>
                  <p style="margin-top: 0.5rem; color: var(--light-text);">
                    Review any missed questions by returning to the relevant module. Each question tests a core concept.
                  </p>
                </div>
              </div>
            </div>
            <div class="slide black" data-index="4">
              <div class="animate" style="text-align: center;">
                <p class="refrain">Not every signal is truth.</p>
                <p style="font-size: 1.1rem; margin-top: 1rem;">Methods protect patients from our confidence.</p>
                <div class="gold-line" style="margin: 1.5rem auto;"></div>
                <p style="font-size: 1.5rem; color: var(--gold); margin-top: 1.5rem;">
                  Congratulations
                </p>
                <p style="font-size: 1.1rem; margin-top: 1rem;">
                  You have completed Evidence Reversal: A Meta-Analysis Course.
                </p>
                <p style="font-size: 1rem; margin-top: 1rem; opacity: 0.9;">
                  May your synthesis be guided by truth, your pooling by wisdom,<br>
                  and your conclusions by humility.
                </p>
                <div style="margin-top: 2rem; font-size: 0.9rem; opacity: 0.8;">
                  <p style="margin-bottom: 0.5rem;"><strong>The Seven Principles:</strong></p>
                  <p>"Not every signal is truth."</p>
                  <p>"Methods protect patients from our confidence."</p>
                  <p>"What was hidden in plain sight?"</p>
                  <p>"The number without provenance is not a number."</p>
                  <p>"Heterogeneity is a message, not noise."</p>
                  <p>"Absence of evidence is not evidence of absence."</p>
                  <p>"Certainty must be earned, not assumed."</p>
                </div>
                <p style="font-size: 0.9rem; margin-top: 2rem; font-style: italic; opacity: 0.7;">
                  "Guide us to the Straight Path..."
                </p>
              </div>
            </div>
          </div>

          <!-- Slide Navigation - minimal floating arrows -->
          <nav class="slide-nav" id="slideNav">
            <button class="nav-btn" id="prevBtn" onclick="prevSlide()" title="Previous ()"></button>
            <div class="nav-center">
              <div class="progress" id="progress"></div>
              <span class="slide-counter" id="counter">1 / 10</span>
            </div>
            <button class="nav-btn" id="nextBtn" onclick="nextSlide()" title="Next ()"></button>
          </nav>
        </div>

        <!-- Tools Panel -->
        <aside class="tools-panel" id="toolsPanel">
          <div class="tools-header">
            <h3>Interactive Tools</h3>
            <button class="btn" onclick="toggleToolsPanel()" style="padding: 0.25rem 0.5rem;"></button>
          </div>
          <div class="tools-content">
            <!-- Live Story Data Panel -->
            <div class="story-data-panel" id="storyDataPanel">
              <h4><span style="font-size: 1.1rem;"></span> Live Story Data</h4>
              <div id="storyDataContent">
                <div class="no-story-data">
                  Navigate to a module to see its evidence story data with interactive before/after comparison.
                </div>
              </div>
            </div>

            <!-- Effect Size Calculator -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                Effect Size Calculator <span></span>
              </div>
              <div class="tool-section-body">
                <div class="form-group">
                  <label>Effect Type</label>
                  <select id="effectType">
                    <option value="OR">Odds Ratio (OR)</option>
                    <option value="RR">Risk Ratio (RR)</option>
                    <option value="RD">Risk Difference (RD)</option>
                    <option value="SMD">Standardized Mean Difference</option>
                    <option value="MD">Mean Difference</option>
                  </select>
                </div>
                <div id="binaryInputs">
                  <div class="form-group">
                    <label>Treatment: Events / Total</label>
                    <div style="display: flex; gap: 0.5rem;">
                      <input type="number" id="eventsTx" placeholder="Events" style="flex:1">
                      <input type="number" id="nTx" placeholder="Total" style="flex:1">
                    </div>
                  </div>
                  <div class="form-group">
                    <label>Control: Events / Total</label>
                    <div style="display: flex; gap: 0.5rem;">
                      <input type="number" id="eventsCtrl" placeholder="Events" style="flex:1">
                      <input type="number" id="nCtrl" placeholder="Total" style="flex:1">
                    </div>
                  </div>
                </div>
                <button class="btn-small primary" onclick="calculateEffectSize()">Calculate</button>
                <div class="results-display" id="effectResults" style="display: none;"></div>
              </div>
            </div>

            <!-- Meta-Analysis Calculator -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                Meta-Analysis Calculator <span></span>
              </div>
              <div class="tool-section-body">
                <div class="form-group">
                  <label>Enter Studies (Effect, CI Low, CI High)</label>
                  <table class="study-table" id="studyTable">
                    <thead>
                      <tr>
                        <th>Study</th>
                        <th>Effect</th>
                        <th>CI Lo</th>
                        <th>CI Hi</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody id="studyTableBody">
                      <tr>
                        <td><input type="text" value="Study 1"></td>
                        <td><input type="number" step="0.01" value="1.25"></td>
                        <td><input type="number" step="0.01" value="0.95"></td>
                        <td><input type="number" step="0.01" value="1.64"></td>
                        <td><button class="btn-small" onclick="removeStudyRow(this)"></button></td>
                      </tr>
                      <tr>
                        <td><input type="text" value="Study 2"></td>
                        <td><input type="number" step="0.01" value="1.42"></td>
                        <td><input type="number" step="0.01" value="1.10"></td>
                        <td><input type="number" step="0.01" value="1.83"></td>
                        <td><button class="btn-small" onclick="removeStudyRow(this)"></button></td>
                      </tr>
                      <tr>
                        <td><input type="text" value="Study 3"></td>
                        <td><input type="number" step="0.01" value="0.98"></td>
                        <td><input type="number" step="0.01" value="0.72"></td>
                        <td><input type="number" step="0.01" value="1.33"></td>
                        <td><button class="btn-small" onclick="removeStudyRow(this)"></button></td>
                      </tr>
                    </tbody>
                  </table>
                  <button class="btn-small" onclick="addStudyRow()">+ Add Study</button>
                </div>
                <div class="form-group">
                  <label>Tau Estimator</label>
                  <select id="tau2Method">
                    <option value="DL">DerSimonian-Laird (DL)</option>
                    <option value="REML">REML</option>
                    <option value="PM">Paule-Mandel (PM)</option>
                    <option value="SJ">Sidik-Jonkman (SJ)</option>
                    <option value="HE">Hedges (HE)</option>
                    <option value="EB">Empirical Bayes (EB)</option>
                    <option value="ML">Maximum Likelihood (ML)</option>
                    <option value="HS">Hunter-Schmidt (HS)</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>
                    <input type="checkbox" id="useHKSJ" checked> Use HKSJ Adjustment
                  </label>
                </div>
                <button class="btn-small primary" onclick="runMetaAnalysis()">Run Analysis</button>
                <div class="results-display" id="maResults" style="display: none;"></div>
                <div class="forest-plot-container" id="forestPlotContainer" style="display: none;"></div>
              </div>
            </div>

            <!-- PICO Builder -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                PICO Builder <span></span>
              </div>
              <div class="tool-section-body" style="display: none;">
                <div class="form-group">
                  <label>Population</label>
                  <input type="text" id="picoP" placeholder="e.g., Adults with Type 2 Diabetes">
                </div>
                <div class="form-group">
                  <label>Intervention</label>
                  <input type="text" id="picoI" placeholder="e.g., SGLT2 inhibitors">
                </div>
                <div class="form-group">
                  <label>Comparator</label>
                  <input type="text" id="picoC" placeholder="e.g., Placebo or standard care">
                </div>
                <div class="form-group">
                  <label>Outcome</label>
                  <input type="text" id="picoO" placeholder="e.g., All-cause mortality">
                </div>
                <button class="btn-small primary" onclick="generatePICO()">Generate Question</button>
                <div id="picoOutput" style="margin-top: 1rem; padding: 0.75rem; background: #f7fafc; border-radius: 4px; display: none;"></div>
              </div>
            </div>

            <!-- Publication Bias Assessment -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                Publication Bias <span></span>
              </div>
              <div class="tool-section-body" style="display: none;">
                <p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  Uses data from Meta-Analysis Calculator above
                </p>
                <button class="btn-small primary" onclick="runPublicationBias()">Assess Publication Bias</button>
                <div id="pubBiasResults" style="display: none; margin-top: 1rem;">
                  <div class="results-display" id="eggerResults"></div>
                  <div class="forest-plot-container" id="funnelPlotContainer" style="margin-top: 0.5rem;"></div>
                </div>
              </div>
            </div>

            <!-- Risk of Bias 2.0 -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                Risk of Bias 2.0 <span></span>
              </div>
              <div class="tool-section-body" style="display: none;">
                <div class="form-group">
                  <label>Study Name</label>
                  <input type="text" id="robStudyName" placeholder="e.g., Smith 2020">
                </div>
                <div class="rob-domains">
                  <div class="rob-domain">
                    <label>D1: Randomization</label>
                    <select id="robD1" onchange="updateRoBOverall()">
                      <option value="">Select...</option>
                      <option value="low">Low risk</option>
                      <option value="some">Some concerns</option>
                      <option value="high">High risk</option>
                    </select>
                  </div>
                  <div class="rob-domain">
                    <label>D2: Deviations from intervention</label>
                    <select id="robD2" onchange="updateRoBOverall()">
                      <option value="">Select...</option>
                      <option value="low">Low risk</option>
                      <option value="some">Some concerns</option>
                      <option value="high">High risk</option>
                    </select>
                  </div>
                  <div class="rob-domain">
                    <label>D3: Missing outcome data</label>
                    <select id="robD3" onchange="updateRoBOverall()">
                      <option value="">Select...</option>
                      <option value="low">Low risk</option>
                      <option value="some">Some concerns</option>
                      <option value="high">High risk</option>
                    </select>
                  </div>
                  <div class="rob-domain">
                    <label>D4: Outcome measurement</label>
                    <select id="robD4" onchange="updateRoBOverall()">
                      <option value="">Select...</option>
                      <option value="low">Low risk</option>
                      <option value="some">Some concerns</option>
                      <option value="high">High risk</option>
                    </select>
                  </div>
                  <div class="rob-domain">
                    <label>D5: Selection of reported result</label>
                    <select id="robD5" onchange="updateRoBOverall()">
                      <option value="">Select...</option>
                      <option value="low">Low risk</option>
                      <option value="some">Some concerns</option>
                      <option value="high">High risk</option>
                    </select>
                  </div>
                </div>
                <div id="robOverall" style="margin-top: 1rem; padding: 0.75rem; border-radius: 6px; text-align: center; font-weight: 600;"></div>
                <div id="robTrafficLight" style="margin-top: 0.5rem;"></div>
              </div>
            </div>

            <!-- GRADE Assessment -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                GRADE Certainty <span></span>
              </div>
              <div class="tool-section-body" style="display: none;">
                <div class="form-group">
                  <label>Starting certainty</label>
                  <select id="gradeStart">
                    <option value="4">High (RCTs)</option>
                    <option value="2">Low (Observational)</option>
                  </select>
                </div>
                <p style="font-size: 0.7rem; font-weight: 600; color: var(--navy); margin: 0.75rem 0 0.25rem;">Downgrade factors:</p>
                <div class="grade-factors">
                  <div class="form-group" style="margin-bottom: 0.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                      <select id="gradeRoB" style="width: 100px;">
                        <option value="0">None</option>
                        <option value="-1">Serious (-1)</option>
                        <option value="-2">Very serious (-2)</option>
                      </select>
                      Risk of Bias
                    </label>
                  </div>
                  <div class="form-group" style="margin-bottom: 0.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                      <select id="gradeInconsistency" style="width: 100px;">
                        <option value="0">None</option>
                        <option value="-1">Serious (-1)</option>
                        <option value="-2">Very serious (-2)</option>
                      </select>
                      Inconsistency
                    </label>
                  </div>
                  <div class="form-group" style="margin-bottom: 0.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                      <select id="gradeIndirectness" style="width: 100px;">
                        <option value="0">None</option>
                        <option value="-1">Serious (-1)</option>
                        <option value="-2">Very serious (-2)</option>
                      </select>
                      Indirectness
                    </label>
                  </div>
                  <div class="form-group" style="margin-bottom: 0.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                      <select id="gradeImprecision" style="width: 100px;">
                        <option value="0">None</option>
                        <option value="-1">Serious (-1)</option>
                        <option value="-2">Very serious (-2)</option>
                      </select>
                      Imprecision
                    </label>
                  </div>
                  <div class="form-group" style="margin-bottom: 0.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                      <select id="gradePubBias" style="width: 100px;">
                        <option value="0">None</option>
                        <option value="-1">Serious (-1)</option>
                        <option value="-2">Very serious (-2)</option>
                      </select>
                      Publication Bias
                    </label>
                  </div>
                </div>
                <button class="btn-small primary" onclick="calculateGRADE()" style="margin-top: 0.5rem;">Calculate Certainty</button>
                <div id="gradeResult" style="margin-top: 1rem;"></div>
              </div>
            </div>

            <!-- I Interpretation -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                Heterogeneity Guide <span></span>
              </div>
              <div class="tool-section-body" style="display: none;">
                <div class="form-group">
                  <label>Enter I value (%)</label>
                  <input type="number" id="i2Input" min="0" max="100" placeholder="e.g., 75">
                </div>
                <button class="btn-small primary" onclick="interpretI2()">Interpret</button>
                <div id="i2Interpretation" style="margin-top: 1rem;"></div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: #f7fafc; border-radius: 6px; font-size: 0.75rem;">
                  <p style="font-weight: 600; margin-bottom: 0.5rem;">Cochrane Guidelines:</p>
                  <p>0-40%: Might not be important</p>
                  <p>30-60%: Moderate heterogeneity</p>
                  <p>50-90%: Substantial heterogeneity</p>
                  <p>75-100%: Considerable heterogeneity</p>
                  <p style="margin-top: 0.5rem; font-style: italic; color: var(--light-text);">
                    "Heterogeneity is a message, not noise."
                  </p>
                </div>
              </div>
            </div>

            <!-- NNT/NNH Calculator -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                NNT/NNH Calculator <span></span>
              </div>
              <div class="tool-section-body" style="display: none;">
                <p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  Convert effect sizes to Numbers Needed to Treat/Harm
                </p>
                <div class="form-group">
                  <label>Baseline Risk (Control Event Rate)</label>
                  <input type="number" id="nntCER" step="0.01" min="0" max="1" placeholder="e.g., 0.15 for 15%">
                </div>
                <div class="form-group">
                  <label>Effect Measure</label>
                  <select id="nntEffectType">
                    <option value="RR">Risk Ratio (RR)</option>
                    <option value="OR">Odds Ratio (OR)</option>
                    <option value="RD">Risk Difference (RD)</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Effect Size</label>
                  <input type="number" id="nntEffect" step="0.01" placeholder="e.g., 0.75">
                </div>
                <div class="form-group">
                  <label>95% CI Lower</label>
                  <input type="number" id="nntCILo" step="0.01" placeholder="e.g., 0.60">
                </div>
                <div class="form-group">
                  <label>95% CI Upper</label>
                  <input type="number" id="nntCIHi" step="0.01" placeholder="e.g., 0.95">
                </div>
                <button class="btn-small primary" onclick="calculateNNT()">Calculate NNT/NNH</button>
                <div class="results-display" id="nntResults" style="display: none;"></div>
              </div>
            </div>

            <!-- Leave-One-Out Sensitivity -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                Leave-One-Out Analysis <span></span>
              </div>
              <div class="tool-section-body" style="display: none;">
                <p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  Tests influence of each study on pooled result. Uses data from Meta-Analysis Calculator.
                </p>
                <button class="btn-small primary" onclick="runLeaveOneOut()">Run Sensitivity Analysis</button>
                <div id="looResults" style="display: none; margin-top: 1rem;">
                  <div class="results-display" id="looSummary"></div>
                  <div class="forest-plot-container" id="looPlotContainer" style="margin-top: 0.5rem;"></div>
                </div>
              </div>
            </div>

            <!-- Trim-and-Fill -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                Trim-and-Fill <span></span>
              </div>
              <div class="tool-section-body" style="display: none;">
                <p style="font-size: 0.75rem; color: var(--light-text); margin-bottom: 0.75rem;">
                  Imputes missing studies to correct for funnel plot asymmetry. Uses data from Meta-Analysis Calculator.
                </p>
                <div class="form-group">
                  <label>Estimator</label>
                  <select id="trimFillEstimator">
                    <option value="L0">L0 (Linear)</option>
                    <option value="R0" selected>R0 (Rank-based)</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Side</label>
                  <select id="trimFillSide">
                    <option value="right">Right (suppress positive)</option>
                    <option value="left" selected>Left (suppress negative)</option>
                  </select>
                </div>
                <button class="btn-small primary" onclick="runTrimAndFill()">Run Trim-and-Fill</button>
                <div id="trimFillResults" style="display: none; margin-top: 1rem;">
                  <div class="results-display" id="trimFillSummary"></div>
                  <div class="forest-plot-container" id="trimFillPlotContainer" style="margin-top: 0.5rem;"></div>
                </div>
              </div>
            </div>

            <!-- Key References -->
            <div class="tool-section">
              <div class="tool-section-header" onclick="toggleSection(this)">
                Key References <span></span>
              </div>
              <div class="tool-section-body" style="display: none;">
                <p style="font-size: 0.7rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--navy);">Evidence Reversal Cases:</p>
                <ul style="font-size: 0.7rem; color: var(--light-text); margin-left: 1rem; line-height: 1.6;">
                  <li><strong>CAST:</strong> Echt DS et al. NEJM 1991;324:781-788</li>
                  <li><strong>HRT/WHI:</strong> Rossouw JE et al. JAMA 2002;288:321-333</li>
                  <li><strong>Rosiglitazone:</strong> Nissen SE, Wolski K. NEJM 2007;356:2457-2471</li>
                  <li><strong>Vioxx:</strong> Bombardier C et al. NEJM 2000;343:1520-1528</li>
                  <li><strong>DECREASE Fraud:</strong> Erasmus MC Investigation 2012</li>
                  <li><strong>BART:</strong> Fergusson DA et al. NEJM 2008;358:2319-2331</li>
                  <li><strong>ISIS-4:</strong> ISIS-4 Collaborative Group. Lancet 1995;345:669-685</li>
                  <li><strong>ACCORD:</strong> ACCORD Study Group. NEJM 2008;358:2545-2559</li>
                  <li><strong>Reboxetine:</strong> Eyding D et al. BMJ 2010;341:c4737</li>
                </ul>
                <p style="font-size: 0.7rem; font-weight: 600; margin: 0.75rem 0 0.5rem; color: var(--navy);">Methods References:</p>
                <ul style="font-size: 0.7rem; color: var(--light-text); margin-left: 1rem; line-height: 1.6;">
                  <li><strong>GRADE:</strong> Guyatt GH et al. BMJ 2008;336:924-926</li>
                  <li><strong>RoB 2.0:</strong> Sterne JAC et al. BMJ 2019;366:l4898</li>
                  <li><strong>ROBINS-I:</strong> Sterne JA et al. BMJ 2016;355:i4919</li>
                  <li><strong>ICEMAN:</strong> Schandelmaier S et al. CMAJ 2020;192:E901-E906</li>
                  <li><strong>HKSJ:</strong> Hartung J, Knapp G. Stat Med 2001;20:3875-3889</li>
                  <li><strong>PRISMA:</strong> Page MJ et al. BMJ 2021;372:n71</li>
                  <li><strong>TSA:</strong> Wetterslev J et al. BMC Med Res Methodol 2008;8:39</li>
                </ul>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </main>
  </div>

  <script>
    // ============================================================
    // CONSTANTS
    // ============================================================
    const Z_95 = 1.96;
    const Z_95_CI_DIVISOR = 2 * Z_95;

    // ============================================================
    // LIVE STORY DATA SYSTEM
    // ============================================================

    const storyData = {
      1: { // CAST
        title: 'CAST Trial: Antiarrhythmics',
        subtitle: 'Do drugs that suppress PVCs save lives?',
        before: {
          label: 'Before CAST (1989)',
          studies: [
            { name: 'Obs Study 1', effect: 0.45, lo: 0.28, hi: 0.72, n: 450 },
            { name: 'Obs Study 2', effect: 0.52, lo: 0.35, hi: 0.77, n: 380 },
            { name: 'Obs Study 3', effect: 0.38, lo: 0.22, hi: 0.65, n: 290 },
            { name: 'Surrogate', effect: 0.42, lo: 0.31, hi: 0.57, n: 1200 },
          ],
          pooled: { effect: 0.44, lo: 0.35, hi: 0.55 },
          metrics: { or: '0.44', nnt: '12', conclusion: 'Benefit' },
          insight: 'Observational data + biological plausibility suggested antiarrhythmics save lives by suppressing PVCs.'
        },
        after: {
          label: 'After CAST (1991)',
          studies: [
            { name: 'CAST-Encainide', effect: 2.38, lo: 1.59, hi: 3.57, n: 730 },
            { name: 'CAST-Flecainide', effect: 2.64, lo: 1.60, hi: 4.36, n: 641 },
          ],
          pooled: { effect: 2.50, lo: 1.80, hi: 3.47 },
          metrics: { or: '2.50', nnh: '17', conclusion: 'Harm' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Antiarrhythmics INCREASED mortality by 150%. An estimated 50,000+ deaths per year were caused by these drugs.'
        }
      },
      2: { // HRT
        title: 'HRT & Heart Disease',
        subtitle: 'Does hormone replacement protect the heart?',
        before: {
          label: 'Before WHI (2002)',
          studies: [
            { name: "Nurses' Health", effect: 0.50, lo: 0.40, hi: 0.63, n: 48470 },
            { name: 'Framingham', effect: 0.55, lo: 0.35, hi: 0.86, n: 1234 },
            { name: 'Meta 1998', effect: 0.65, lo: 0.52, hi: 0.81, n: 22000 },
          ],
          pooled: { effect: 0.56, lo: 0.47, hi: 0.67 },
          metrics: { rr: '0.56', nnt: '32', conclusion: 'Benefit' },
          insight: 'Over 30 observational studies showed ~44% reduction in CHD. HRT was recommended for cardioprotection.'
        },
        after: {
          label: 'After WHI (2002)',
          studies: [
            { name: 'WHI E+P', effect: 1.29, lo: 1.02, hi: 1.63, n: 16608 },
            { name: 'WHI E-only', effect: 0.91, lo: 0.75, hi: 1.12, n: 10739 },
          ],
          pooled: { effect: 1.13, lo: 0.95, hi: 1.34 },
          metrics: { rr: '1.13', nnh: '', conclusion: 'No Benefit/Harm' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Healthy user bias explained the observational findings. Women who took HRT were healthier at baseline.'
        }
      },
      3: { // Rosiglitazone
        title: 'Rosiglitazone (Avandia)',
        subtitle: 'What was hidden in the unpublished trials?',
        before: {
          label: 'Published Only',
          studies: [
            { name: 'ADOPT', effect: 1.08, lo: 0.75, hi: 1.56, n: 4360 },
            { name: 'DREAM', effect: 1.20, lo: 0.83, hi: 1.74, n: 5269 },
            { name: 'Published pool', effect: 1.14, lo: 0.90, hi: 1.45, n: 15000 },
          ],
          pooled: { effect: 1.14, lo: 0.92, hi: 1.41 },
          metrics: { or: '1.14', pvalue: '0.23', conclusion: 'NS' },
          insight: 'Published trials showed non-significant trend. FDA and physicians were reassured.'
        },
        after: {
          label: 'All Data (Nissen 2007)',
          studies: [
            { name: 'ADOPT', effect: 1.25, lo: 0.78, hi: 2.01, n: 4360 },
            { name: 'DREAM', effect: 1.36, lo: 0.68, hi: 2.71, n: 5269 },
            { name: '42 unpublished', effect: 1.45, lo: 1.10, hi: 1.91, n: 22000 },
          ],
          pooled: { effect: 1.43, lo: 1.03, hi: 1.98 },
          metrics: { or: '1.43', pvalue: '0.03', conclusion: 'HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Including unpublished trials revealed 43% increased MI risk. ~83,000 excess heart attacks estimated.'
        }
      },
      6: { // Aprotinin
        title: 'Aprotinin (Trasylol)',
        subtitle: 'Did observational studies miss the harm?',
        before: {
          label: 'Observational Studies',
          studies: [
            { name: 'Mangano 2006', effect: 0.80, lo: 0.64, hi: 1.00, n: 4374 },
            { name: 'Karkouti 2006', effect: 0.85, lo: 0.68, hi: 1.06, n: 10870 },
            { name: 'Obs Meta', effect: 0.82, lo: 0.70, hi: 0.96, n: 30000 },
          ],
          pooled: { effect: 0.82, lo: 0.71, hi: 0.95 },
          metrics: { rr: '0.82', nnt: '50', conclusion: 'Benefit' },
          insight: 'Observational studies suggested 18% reduced mortality. Aprotinin was widely used in cardiac surgery.'
        },
        after: {
          label: 'BART Trial (RCT)',
          studies: [
            { name: 'BART', effect: 1.53, lo: 1.10, hi: 2.15, n: 2331 },
          ],
          pooled: { effect: 1.53, lo: 1.10, hi: 2.15 },
          metrics: { rr: '1.53', nnh: '53', conclusion: 'HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> The RCT showed 53% INCREASED mortality. Confounding by indication: sickest patients got the drug.'
        }
      },
      7: { // Magnesium
        title: 'IV Magnesium in MI',
        subtitle: 'Small trials vs mega-trial',
        before: {
          label: 'Small Trials Meta (1991)',
          studies: [
            { name: 'Morton 1984', effect: 0.10, lo: 0.01, hi: 0.87, n: 40 },
            { name: 'Rasmussen 1986', effect: 0.35, lo: 0.13, hi: 0.94, n: 273 },
            { name: 'Shechter 1990', effect: 0.27, lo: 0.08, hi: 0.95, n: 103 },
            { name: 'LIMIT-2', effect: 0.74, lo: 0.57, hi: 0.97, n: 2316 },
          ],
          pooled: { effect: 0.44, lo: 0.27, hi: 0.71 },
          metrics: { or: '0.44', nnt: '25', conclusion: 'Benefit' },
          insight: 'Meta-analysis of 7 small trials showed 56% mortality reduction. Magnesium seemed like a miracle.'
        },
        after: {
          label: 'With ISIS-4 (1995)',
          studies: [
            { name: 'Small trials', effect: 0.44, lo: 0.27, hi: 0.71, n: 2774 },
            { name: 'ISIS-4', effect: 1.06, lo: 0.99, hi: 1.13, n: 58050 },
          ],
          pooled: { effect: 1.02, lo: 0.95, hi: 1.09 },
          metrics: { or: '1.02', nnt: '', conclusion: 'No Effect' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> ISIS-4 (58,050 patients) found NO benefit. Small-study effects and publication bias likely contributed to the earlier positive meta-analysis.'
        }
      },
      9: { // Reboxetine
        title: 'Reboxetine',
        subtitle: 'How much data was hidden?',
        before: {
          label: 'Published Only',
          studies: [
            { name: 'Pub Trial 1', effect: 0.62, lo: 0.35, hi: 1.10, n: 254 },
            { name: 'Pub Trial 2', effect: 0.48, lo: 0.22, hi: 1.05, n: 187 },
            { name: 'Pub Trial 3', effect: 0.55, lo: 0.28, hi: 1.08, n: 203 },
          ],
          pooled: { effect: 0.56, lo: 0.39, hi: 0.80 },
          metrics: { smd: '0.56', pvalue: '<0.001', conclusion: 'Benefit' },
          insight: 'Published trials showed significant benefit vs placebo. Reboxetine was approved and marketed.'
        },
        after: {
          label: 'All Data (EMA 2010)',
          studies: [
            { name: 'Published (26%)', effect: 0.56, lo: 0.39, hi: 0.80, n: 644 },
            { name: 'Unpublished (74%)', effect: 0.98, lo: 0.81, hi: 1.19, n: 1802 },
          ],
          pooled: { effect: 0.85, lo: 0.72, hi: 1.00 },
          metrics: { smd: '0.10', pvalue: '0.43', conclusion: 'No Effect' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> 74% of patient data was unpublished! True effect was essentially null. The drug was no better than placebo.'
        }
      },
      4: { // Vioxx
        title: 'Vioxx (Rofecoxib)',
        subtitle: 'What was selectively reported?',
        before: {
          label: 'VIGOR Published (2000)',
          studies: [
            { name: 'VIGOR (GI)', effect: 0.46, lo: 0.33, hi: 0.64, n: 8076 },
          ],
          pooled: { effect: 0.46, lo: 0.33, hi: 0.64 },
          metrics: { rr: '0.46', nnt: '41', conclusion: 'GI Benefit' },
          insight: 'VIGOR was published emphasizing 54% reduction in GI complications. Cardiovascular events were downplayed.'
        },
        after: {
          label: 'Full CV Data Revealed',
          studies: [
            { name: 'VIGOR (CV)', effect: 4.25, lo: 1.39, hi: 17.37, n: 8076 },
            { name: 'APPROVe', effect: 1.92, lo: 1.19, hi: 3.11, n: 2586 },
          ],
          pooled: { effect: 2.24, lo: 1.24, hi: 4.02 },
          metrics: { rr: '2.24', nnh: '73', conclusion: 'CV HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Full data showed 4-fold increased MI risk. ~88,000 excess heart attacks. Withdrawn 2004.'
        }
      },
      5: { // DECREASE
        title: 'DECREASE Trials (Fraud)',
        subtitle: 'What happens when data is fabricated?',
        before: {
          label: 'Before Fraud Exposed',
          studies: [
            { name: 'DECREASE-I', effect: 0.09, lo: 0.02, hi: 0.37, n: 112 },
            { name: 'DECREASE-IV', effect: 0.65, lo: 0.24, hi: 1.74, n: 1066 },
            { name: 'Other trials', effect: 0.78, lo: 0.58, hi: 1.05, n: 3500 },
          ],
          pooled: { effect: 0.56, lo: 0.35, hi: 0.89 },
          metrics: { or: '0.56', nnt: '15', conclusion: 'Benefit' },
          insight: 'Meta-analysis including DECREASE showed 44% mortality reduction. Beta-blockers were mandated in guidelines.'
        },
        after: {
          label: 'Excluding Fraudulent Data',
          studies: [
            { name: 'POISE', effect: 1.33, lo: 1.03, hi: 1.74, n: 8351 },
            { name: 'DIPOM', effect: 1.11, lo: 0.66, hi: 1.87, n: 921 },
            { name: 'MaVS', effect: 0.92, lo: 0.46, hi: 1.84, n: 496 },
          ],
          pooled: { effect: 1.27, lo: 1.01, hi: 1.60 },
          metrics: { or: '1.27', nnh: '67', conclusion: 'HARM' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Without fabricated DECREASE data, beta-blockers INCREASED mortality by 27%. ~10,000 excess deaths in Europe from flawed guidelines.'
        }
      },
      8: { // ACCORD
        title: 'ACCORD Trial',
        subtitle: 'When the average hides the truth',
        before: {
          label: 'Before ACCORD (2008)',
          studies: [
            { name: 'DCCT (Type 1)', effect: 0.42, lo: 0.23, hi: 0.75, n: 1441 },
            { name: 'UKPDS', effect: 0.84, lo: 0.71, hi: 0.99, n: 3867 },
            { name: 'Obs studies', effect: 0.70, lo: 0.60, hi: 0.82, n: 50000 },
          ],
          pooled: { effect: 0.72, lo: 0.62, hi: 0.84 },
          metrics: { hr: '0.72', nnt: '20', conclusion: 'Benefit' },
          insight: 'Previous trials showed intensive glucose control reduced microvascular complications. Assumed benefit for macrovascular too.'
        },
        after: {
          label: 'ACCORD Results',
          studies: [
            { name: 'ACCORD', effect: 1.22, lo: 1.01, hi: 1.46, n: 10251 },
            { name: 'ADVANCE', effect: 0.93, lo: 0.83, hi: 1.06, n: 11140 },
            { name: 'VADT', effect: 1.07, lo: 0.81, hi: 1.42, n: 1791 },
          ],
          pooled: { effect: 1.04, lo: 0.91, hi: 1.19 },
          metrics: { hr: '1.22*', nnh: '95', conclusion: 'Harm in ACCORD' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> ACCORD stopped early - intensive control INCREASED mortality by 22%. Heterogeneity mattered: harm concentrated in older patients with CVD.'
        }
      },
      10: { // Surfactant
        title: 'Early Surfactant in Preterm',
        subtitle: 'When practice context changes',
        before: {
          label: 'Early Trials (1990s)',
          studies: [
            { name: 'Kendig 1991', effect: 0.55, lo: 0.35, hi: 0.86, n: 479 },
            { name: 'OSECT 1992', effect: 0.61, lo: 0.41, hi: 0.91, n: 338 },
            { name: 'Egberts 1993', effect: 0.58, lo: 0.37, hi: 0.91, n: 324 },
          ],
          pooled: { effect: 0.58, lo: 0.45, hi: 0.75 },
          metrics: { rr: '0.58', nnt: '9', conclusion: 'Benefit' },
          insight: 'Early surfactant (prophylactic) showed 42% reduced mortality/BPD compared to rescue surfactant. Became standard.'
        },
        after: {
          label: 'Modern Trials with CPAP',
          studies: [
            { name: 'COIN 2008', effect: 1.05, lo: 0.78, hi: 1.41, n: 610 },
            { name: 'SUPPORT 2010', effect: 0.91, lo: 0.68, hi: 1.21, n: 1316 },
            { name: 'VON 2011', effect: 0.94, lo: 0.71, hi: 1.25, n: 648 },
          ],
          pooled: { effect: 0.96, lo: 0.82, hi: 1.13 },
          metrics: { rr: '0.96', nnt: '', conclusion: 'No Benefit' },
          insight: '<strong>EVIDENCE EVOLUTION:</strong> Modern CPAP changed the context. Early surfactant no longer superior to CPAP + selective surfactant. Practices must evolve with evidence.'
        }
      },
      11: { // HCQ COVID
        title: 'COVID-19 Hydroxychloroquine',
        subtitle: 'Early promise vs rigorous evidence',
        before: {
          label: 'Early Studies (Mar-May 2020)',
          studies: [
            { name: 'Gautret', effect: 0.15, lo: 0.03, hi: 0.75, n: 36 },
            { name: 'Chen J', effect: 0.65, lo: 0.25, hi: 1.69, n: 62 },
            { name: 'Million', effect: 0.22, lo: 0.11, hi: 0.44, n: 1061 },
          ],
          pooled: { effect: 0.28, lo: 0.15, hi: 0.52 },
          metrics: { or: '0.28', pvalue: '<0.001', conclusion: 'Benefit' },
          insight: 'Early small/observational studies suggested massive benefit. Emergency authorizations followed.'
        },
        after: {
          label: 'RCTs (RECOVERY, WHO)',
          studies: [
            { name: 'RECOVERY', effect: 1.09, lo: 0.97, hi: 1.23, n: 4716 },
            { name: 'WHO Solidarity', effect: 1.19, lo: 0.89, hi: 1.59, n: 954 },
            { name: 'RCT Meta', effect: 1.11, lo: 1.00, hi: 1.22, n: 8000 },
          ],
          pooled: { effect: 1.11, lo: 1.00, hi: 1.22 },
          metrics: { or: '1.11', pvalue: '0.05', conclusion: 'No Benefit/Harm' },
          insight: '<strong>EVIDENCE REVERSAL:</strong> Large RCTs showed NO benefit and possible harm. Authorizations revoked. Rigorous trials take time but give truth.'
        }
      }
    };

    let currentStoryView = 'before';
    let storyPlotType = 'forest';
    let storyPredictions = {}; // Track predictions per module
    let showingPrediction = false;

    function setStoryPlotType(type) {
      storyPlotType = type;
      const story = storyData[currentModule];
      if (story) renderStoryContent(story);
    }

    function hasPredicted(moduleId) {
      return storyPredictions[moduleId] !== undefined;
    }

    function makePrediction(moduleId, prediction) {
      const story = storyData[moduleId];
      if (!story) return;

      // Determine the actual answer
      const afterEffect = story.after.pooled.effect;
      let actual;
      if (afterEffect < 0.9) actual = 'benefit';
      else if (afterEffect > 1.1) actual = 'harm';
      else actual = 'neutral';

      // Store prediction and result
      storyPredictions[moduleId] = {
        prediction: prediction,
        actual: actual,
        correct: prediction === actual
      };

      // Update progress
      saveProgress();

      // Now show the actual results
      showingPrediction = false;
      renderStoryContent(story);
    }

    function updateStoryPanel(moduleId) {
      const panel = document.getElementById('storyDataPanel');
      const content = document.getElementById('storyDataContent');
      const story = storyData[moduleId];

      panel.classList.add('updating');
      setTimeout(() => panel.classList.remove('updating'), 500);

      if (!story) {
        content.innerHTML = `
          <div class="no-story-data">
            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;"></p>
            <p>Module ${moduleId}: ${modules[moduleId]?.title || 'Unknown'}</p>
            <p style="margin-top: 0.5rem; opacity: 0.7;">This module focuses on methods rather than a specific evidence reversal story.</p>
          </div>
        `;
        return;
      }

      currentStoryView = 'before';
      renderStoryContent(story);
    }

    function renderStoryContent(story) {
      const content = document.getElementById('storyDataContent');
      const moduleId = currentModule;
      const data = currentStoryView === 'before' ? story.before : story.after;
      const predicted = hasPredicted(moduleId);
      const predictionResult = storyPredictions[moduleId];

      // If viewing "After" and haven't predicted yet, show prediction interface
      if (currentStoryView === 'after' && !predicted && showingPrediction) {
        content.innerHTML = `
          <div style="margin-bottom: 0.75rem;">
            <div style="font-size: 1rem; font-weight: 600; color: white;">${story.title}</div>
            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">${story.subtitle}</div>
          </div>

          <div class="story-toggle">
            <button class="" onclick="toggleStoryView('before')">
              ${story.before.label}
            </button>
            <button class="active" onclick="toggleStoryView('after')">
              ${story.after.label}
            </button>
          </div>

          <div class="predict-first-panel">
            <div class="predict-icon"></div>
            <h4>Predict First!</h4>
            <p>Based on ${story.before.label}, the evidence suggested <strong>${story.before.metrics.conclusion.toLowerCase()}</strong>.</p>
            <p style="margin-top: 0.5rem;">What do you think the rigorous evidence showed?</p>

            <div class="predict-buttons">
              <button class="predict-btn benefit" onclick="makePrediction(${moduleId}, 'benefit')">
                <span class="predict-icon-small"></span>
                Treatment Helps
              </button>
              <button class="predict-btn neutral" onclick="makePrediction(${moduleId}, 'neutral')">
                <span class="predict-icon-small"></span>
                No Effect
              </button>
              <button class="predict-btn harm" onclick="makePrediction(${moduleId}, 'harm')">
                <span class="predict-icon-small"></span>
                Treatment Harms
              </button>
            </div>

            <p style="font-size: 0.7rem; opacity: 0.6; margin-top: 0.75rem;">Making a prediction improves learning retention by 40%</p>
          </div>
        `;
        return;
      }

      // Prediction feedback (shown after predicting)
      let predictionFeedback = '';
      if (currentStoryView === 'after' && predicted) {
        const wasCorrect = predictionResult.correct;
        predictionFeedback = `
          <div class="prediction-feedback ${wasCorrect ? 'correct' : 'incorrect'}">
            <span class="feedback-icon">${wasCorrect ? '' : ''}</span>
            <span>${wasCorrect ? 'Correct! You predicted this evidence reversal.' : 'Not quite - this is why we need rigorous evidence!'}</span>
          </div>
        `;
      }

      content.innerHTML = `
        <div style="margin-bottom: 0.75rem;">
          <div style="font-size: 1rem; font-weight: 600; color: white;">${story.title}</div>
          <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">${story.subtitle}</div>
        </div>

        <div class="story-toggle">
          <button class="${currentStoryView === 'before' ? 'active' : ''}" onclick="toggleStoryView('before')">
            ${story.before.label}
          </button>
          <button class="${currentStoryView === 'after' ? 'active' : ''}" onclick="toggleStoryView('after')">
            ${story.after.label}
          </button>
        </div>

        ${predictionFeedback}

        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
          <button class="btn-small ${storyPlotType === 'forest' ? 'primary' : ''}" onclick="setStoryPlotType('forest')" style="flex:1; font-size: 0.7rem;">Forest Plot</button>
          <button class="btn-small ${storyPlotType === 'funnel' ? 'primary' : ''}" onclick="setStoryPlotType('funnel')" style="flex:1; font-size: 0.7rem;">Funnel Plot</button>
        </div>

        <div class="story-viz" id="storyForestPlot"></div>

        <div class="story-metrics">
          <div class="story-metric ${getMetricHighlight(data.metrics.conclusion)}">
            <div class="value">${Object.values(data.metrics)[0]}</div>
            <div class="label">${Object.keys(data.metrics)[0].toUpperCase()}</div>
          </div>
          <div class="story-metric ${getMetricHighlight(data.metrics.conclusion)}">
            <div class="value">${data.metrics.conclusion}</div>
            <div class="label">Conclusion</div>
          </div>
        </div>

        <div class="story-insight">${data.insight}</div>

        <button class="btn-small primary" style="width: 100%; margin-top: 0.75rem;" onclick="loadStoryIntoCalculator()">
          Load Data into Calculator 
        </button>
      `;

      // Draw the appropriate plot
      if (storyPlotType === 'funnel') {
        drawStoryFunnelPlot(data.studies, data.pooled, currentStoryView === 'after');
      } else {
        drawStoryForestPlot(data.studies, data.pooled, currentStoryView === 'after');
      }
    }

    function getMetricHighlight(conclusion) {
      if (conclusion.includes('Harm') || conclusion === 'HARM') return 'highlight-bad';
      if (conclusion.includes('Benefit')) return 'highlight-good';
      return '';
    }

    function toggleStoryView(view) {
      const moduleId = currentModule;
      const story = storyData[moduleId];
      if (!story) return;

      currentStoryView = view;

      // If switching to "after" and haven't predicted yet, show prediction interface
      if (view === 'after' && !hasPredicted(moduleId)) {
        showingPrediction = true;
      } else {
        showingPrediction = false;
      }

      renderStoryContent(story);
    }

    function drawStoryForestPlot(studies, pooled, isAfter) {
      const container = document.getElementById('storyForestPlot');
      if (!container) return;

      const width = 320;
      const height = studies.length * 32 + 60;
      const margin = { left: 100, right: 30, top: 15, bottom: 30 };
      const plotWidth = width - margin.left - margin.right;

      // Find data range
      const allEffects = [...studies.map(s => [s.lo, s.hi]).flat(), pooled.lo, pooled.hi];
      let minE = Math.min(...allEffects, 0.1);
      let maxE = Math.max(...allEffects, 3);

      // Log scale
      const logMin = Math.log(Math.max(0.05, minE * 0.8));
      const logMax = Math.log(maxE * 1.2);
      const xScale = (v) => margin.left + ((Math.log(v) - logMin) / (logMax - logMin)) * plotWidth;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="width: 100%; height: auto; font-family: sans-serif;" role="img" aria-label="Forest plot showing effect sizes for ${studies.length} studies">`;

      // Add pattern definitions for color-blind accessibility
      svg += `<defs>
        <pattern id="harmPattern" patternUnits="userSpaceOnUse" width="4" height="4">
          <path d="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2" stroke="#ef4444" stroke-width="1"/>
        </pattern>
        <pattern id="benefitPattern" patternUnits="userSpaceOnUse" width="4" height="4">
          <circle cx="2" cy="2" r="1" fill="#22c55e"/>
        </pattern>
      </defs>`;

      // Grid lines
      [0.1, 0.25, 0.5, 1, 2, 4].forEach(tick => {
        if (tick >= minE * 0.8 && tick <= maxE * 1.2) {
          const x = xScale(tick);
          svg += `<line x1="${x}" y1="${margin.top}" x2="${x}" y2="${height - margin.bottom}" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>`;
          svg += `<text x="${x}" y="${height - margin.bottom + 12}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.5)">${tick}</text>`;
        }
      });

      // Null line at 1
      const nullX = xScale(1);
      svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${height - margin.bottom}" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>`;

      // Studies - COLOR-BLIND SAFE: use different shapes + colors
      studies.forEach((study, i) => {
        const y = margin.top + 15 + i * 32;
        const x = xScale(Math.max(0.05, Math.min(10, study.effect)));
        const xLo = xScale(Math.max(0.05, study.lo));
        const xHi = xScale(Math.min(10, study.hi));

        // Color-blind safe: green (#22c55e) for benefit, red (#ef4444) for harm, gray for neutral
        const isBenefit = study.effect < 1;
        const isHarm = study.effect > 1.1;
        const color = isBenefit ? '#22c55e' : (isHarm ? '#ef4444' : '#94a3b8');

        // Study name
        svg += `<text x="${margin.left - 5}" y="${y + 4}" text-anchor="end" font-size="9" fill="white">${study.name}</text>`;

        // CI line - use dashed for harm, solid for benefit (color-blind safe)
        const dashArray = isHarm ? 'stroke-dasharray="3,2"' : '';
        svg += `<line x1="${xLo}" y1="${y}" x2="${xHi}" y2="${y}" stroke="${color}" stroke-width="2" ${dashArray}/>`;

        // Effect marker - SHAPES differ: square for benefit, circle for harm, diamond for neutral
        const size = Math.min(10, Math.max(5, study.n ? Math.sqrt(study.n) / 10 : 6));
        if (isBenefit) {
          // Square with fill for benefit
          svg += `<rect x="${x - size/2}" y="${y - size/2}" width="${size}" height="${size}" fill="${color}" rx="1"/>`;
        } else if (isHarm) {
          // Circle for harm
          svg += `<circle cx="${x}" cy="${y}" r="${size/2}" fill="${color}"/>`;
        } else {
          // Diamond for neutral
          svg += `<polygon points="${x},${y-size/2} ${x+size/2},${y} ${x},${y+size/2} ${x-size/2},${y}" fill="${color}"/>`;
        }
      });

      // Pooled diamond
      const poolY = height - margin.bottom - 10;
      const poolX = xScale(Math.max(0.05, Math.min(10, pooled.effect)));
      const poolXLo = xScale(Math.max(0.05, pooled.lo));
      const poolXHi = xScale(Math.min(10, pooled.hi));
      const isPooledHarm = pooled.effect > 1;
      const diamondColor = isAfter ? (isPooledHarm ? '#ef4444' : '#22c55e') : '#D4AF37';

      svg += `<polygon points="${poolXLo},${poolY} ${poolX},${poolY - 6} ${poolXHi},${poolY} ${poolX},${poolY + 6}" fill="${diamondColor}" stroke="white" stroke-width="1"/>`;
      svg += `<text x="${margin.left - 5}" y="${poolY + 3}" text-anchor="end" font-size="9" font-weight="bold" fill="${diamondColor}">Pooled</text>`;

      // Labels with symbols for color-blind users
      svg += `<text x="${xScale(0.3)}" y="${height - 3}" text-anchor="middle" font-size="7" fill="rgba(255,255,255,0.6)"> Favors Treatment</text>`;
      svg += `<text x="${xScale(2.5)}" y="${height - 3}" text-anchor="middle" font-size="7" fill="rgba(255,255,255,0.6)"> Favors Control</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    function drawStoryFunnelPlot(studies, pooled, isAfter) {
      const container = document.getElementById('storyForestPlot');
      if (!container) return;

      const width = 320;
      const height = 200;
      const margin = { left: 40, right: 20, top: 20, bottom: 35 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Calculate SE from CI
      const studiesWithSE = studies.map(s => ({
        ...s,
        se: (Math.log(s.hi) - Math.log(s.lo)) / 3.92
      }));

      const maxSE = Math.max(...studiesWithSE.map(s => s.se)) * 1.2;
      const logPooled = Math.log(pooled.effect);

      // Scale functions
      const logEffects = studiesWithSE.map(s => Math.log(s.effect));
      const minLog = Math.min(...logEffects, logPooled) - 0.5;
      const maxLog = Math.max(...logEffects, logPooled) + 0.5;

      const xScale = (logE) => margin.left + ((logE - minLog) / (maxLog - minLog)) * plotWidth;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="width: 100%; height: auto; font-family: sans-serif;">`;

      // Funnel shape
      const funnelLeft = xScale(logPooled - 1.96 * maxSE);
      const funnelRight = xScale(logPooled + 1.96 * maxSE);
      const funnelTop = xScale(logPooled);

      svg += `<polygon points="${funnelTop},${margin.top} ${funnelLeft},${margin.top + plotHeight} ${funnelRight},${margin.top + plotHeight}"
               fill="rgba(255,255,255,0.1)" stroke="rgba(255,255,255,0.3)" stroke-dasharray="3"/>`;

      // Vertical line at pooled effect
      svg += `<line x1="${xScale(logPooled)}" y1="${margin.top}" x2="${xScale(logPooled)}" y2="${margin.top + plotHeight}"
               stroke="${isAfter ? '#ef4444' : '#D4AF37'}" stroke-width="2"/>`;

      // Null line at log(1) = 0
      const nullX = xScale(0);
      if (nullX > margin.left && nullX < width - margin.right) {
        svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${margin.top + plotHeight}"
                 stroke="rgba(255,255,255,0.4)" stroke-width="1" stroke-dasharray="4"/>`;
      }

      // Study points
      studiesWithSE.forEach(study => {
        const x = xScale(Math.log(study.effect));
        const y = yScale(study.se);
        const color = study.effect < 1 ? '#22c55e' : '#ef4444';

        svg += `<circle cx="${x}" cy="${y}" r="6" fill="${color}" stroke="white" stroke-width="1"/>`;
      });

      // X-axis label
      svg += `<text x="${width/2}" y="${height - 5}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.6)">Effect Size (log scale)</text>`;

      // Y-axis label
      svg += `<text x="12" y="${height/2}" text-anchor="middle" font-size="8" fill="rgba(255,255,255,0.6)" transform="rotate(-90, 12, ${height/2})">Standard Error</text>`;

      // Show asymmetry indicator if appropriate
      if (isAfter) {
        svg += `<text x="${width - 10}" y="${margin.top + 15}" text-anchor="end" font-size="8" fill="#ef4444"> Asymmetry</text>`;
      }

      svg += '</svg>';
      container.innerHTML = svg;
    }

    // ============================================================
    // INTERACTIVE TOOLS FOR NEW MODULES (13-22)
    // ============================================================

    // --- Tool 1: Bayesian Posterior Visualizer (Module 13) ---
    function updateBayesianPosterior() {
      const strengthVal = parseInt(document.getElementById('priorStrengthSlider').value);
      const meanVal = parseInt(document.getElementById('priorMeanSlider').value) / 100;
      const priorSD = Math.max(0.1, 10 - strengthVal * 0.098);
      const labels = ['Vague', 'Vague', 'Weak', 'Weak', 'Moderate', 'Moderate', 'Informative', 'Informative', 'Strong', 'Strong', 'Very Strong'];
      document.getElementById('priorStrengthLabel').textContent = labels[Math.min(10, Math.floor(strengthVal / 10))];
      document.getElementById('priorMeanLabel').textContent = meanVal.toFixed(2);

      // Data likelihood: centered at observed log-OR = -0.47 (STAMPEDE HR 0.63), SE = 0.10
      const dataM = -0.47, dataSE = 0.10;
      const dataPrec = 1 / (dataSE * dataSE);
      const priorPrec = 1 / (priorSD * priorSD);
      const postPrec = dataPrec + priorPrec;
      const postM = (dataM * dataPrec + meanVal * priorPrec) / postPrec;
      const postSD = Math.sqrt(1 / postPrec);

      const w = 500, h = 220, pad = 40;
      const xMin = -2, xMax = 2, steps = 200;
      function gauss(x, m, s) { return Math.exp(-0.5 * ((x - m) / s) ** 2) / (s * Math.sqrt(2 * Math.PI)); }
      function pathData(m, s, color) {
        let pts = [];
        for (let i = 0; i <= steps; i++) {
          const x = xMin + (xMax - xMin) * i / steps;
          const px = pad + (x - xMin) / (xMax - xMin) * (w - 2 * pad);
          const py = h - pad - gauss(x, m, s) / gauss(m, m, s) * (h - 2 * pad);
          pts.push(`${i === 0 ? 'M' : 'L'}${px.toFixed(1)},${py.toFixed(1)}`);
        }
        return `<path d="${pts.join(' ')}" fill="none" stroke="${color}" stroke-width="2.5"/>`;
      }

      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      svg += `<line x1="${pad}" y1="${h-pad}" x2="${w-pad}" y2="${h-pad}" stroke="#ccc"/>`;
      // Zero line
      const zx = pad + (0 - xMin) / (xMax - xMin) * (w - 2 * pad);
      svg += `<line x1="${zx}" y1="${pad}" x2="${zx}" y2="${h-pad}" stroke="#aaa" stroke-dasharray="4"/>`;
      svg += `<text x="${zx}" y="${h-pad+15}" text-anchor="middle" font-size="10" fill="#666">0</text>`;
      // Labels
      svg += `<text x="${pad}" y="${h-pad+15}" text-anchor="middle" font-size="10" fill="#666">${xMin}</text>`;
      svg += `<text x="${w-pad}" y="${h-pad+15}" text-anchor="middle" font-size="10" fill="#666">${xMax}</text>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">log-OR</text>`;
      // Curves
      svg += pathData(meanVal, priorSD, '#3b82f6');
      svg += pathData(dataM, dataSE, '#22c55e');
      svg += pathData(postM, postSD, '#D4AF37');
      // Legend
      svg += `<circle cx="${pad+10}" cy="15" r="5" fill="#3b82f6"/><text x="${pad+20}" y="19" font-size="10" fill="#333">Prior</text>`;
      svg += `<circle cx="${pad+70}" cy="15" r="5" fill="#22c55e"/><text x="${pad+80}" y="19" font-size="10" fill="#333">Likelihood</text>`;
      svg += `<circle cx="${pad+160}" cy="15" r="5" fill="#D4AF37"/><text x="${pad+170}" y="19" font-size="10" fill="#333">Posterior</text>`;
      // Posterior summary
      svg += `<text x="${w-pad}" y="35" text-anchor="end" font-size="10" fill="#333">Posterior: ${postM.toFixed(2)} [${(postM-1.96*postSD).toFixed(2)}, ${(postM+1.96*postSD).toFixed(2)}]</text>`;
      svg += '</svg>';
      document.getElementById('bayesianPlotArea').innerHTML = svg;
    }

    // --- Tool 2: NMA Network Graph (Module 14) ---
    function drawNMANetwork() {
      const area = document.getElementById('nmaNetworkArea');
      if (!area) return;
      // Simplified antidepressant network (12 key drugs)
      const drugs = [
        { name: 'Placebo', x: 250, y: 160 },
        { name: 'Fluoxetine', x: 120, y: 60 }, { name: 'Sertraline', x: 180, y: 40 },
        { name: 'Paroxetine', x: 310, y: 40 }, { name: 'Citalopram', x: 380, y: 60 },
        { name: 'Escitalopram', x: 420, y: 130 }, { name: 'Venlafaxine', x: 400, y: 220 },
        { name: 'Duloxetine', x: 330, y: 270 }, { name: 'Mirtazapine', x: 220, y: 280 },
        { name: 'Amitriptyline', x: 130, y: 260 }, { name: 'Bupropion', x: 70, y: 200 },
        { name: 'Agomelatine', x: 80, y: 130 }
      ];
      // Edges: [from, to, nStudies]
      const edges = [
        [0,1,35],[0,2,15],[0,3,22],[0,4,12],[0,5,18],[0,6,20],[0,7,10],[0,8,14],[0,9,8],
        [1,2,5],[1,3,8],[1,6,12],[1,8,4],[2,3,3],[2,6,6],[3,6,7],[4,5,6],
        [5,6,8],[6,7,5],[6,8,6],[8,9,3],[1,10,4],[0,10,7],[0,11,9],[5,11,3]
      ];
      const w = 500, h = 320;
      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Edges
      edges.forEach(([a, b, n]) => {
        const d1 = drugs[a], d2 = drugs[b];
        const thick = Math.max(1, Math.min(6, n / 5));
        svg += `<line x1="${d1.x}" y1="${d1.y}" x2="${d2.x}" y2="${d2.y}" stroke="rgba(212,175,55,0.4)" stroke-width="${thick}"/>`;
      });
      // Nodes
      drugs.forEach((d, i) => {
        const r = i === 0 ? 18 : 12;
        const fill = i === 0 ? '#1E2761' : '#D4AF37';
        svg += `<circle cx="${d.x}" cy="${d.y}" r="${r}" fill="${fill}" stroke="white" stroke-width="1.5"/>`;
        svg += `<text x="${d.x}" y="${d.y + r + 12}" text-anchor="middle" font-size="8" fill="#333" font-weight="600">${d.name}</text>`;
      });
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 3: GOSH Plot Generator (Module 17) ---
    // xoshiro128** PRNG for deterministic sampling
    function xoshiro128ss(seed) {
      let s = [seed, seed ^ 0x9E3779B9, seed ^ 0x6A09E667, seed ^ 0xBB67AE85];
      function rotl(x, k) { return ((x << k) | (x >>> (32 - k))) >>> 0; }
      function next() {
        const result = (rotl((s[1] * 5) >>> 0, 7) * 9) >>> 0;
        const t = (s[1] << 9) >>> 0;
        s[2] ^= s[0]; s[3] ^= s[1]; s[1] ^= s[2]; s[0] ^= s[3];
        s[2] ^= t; s[3] = rotl(s[3], 11);
        return result / 4294967296;
      }
      return next;
    }

    function generateGOSHPlot() {
      const area = document.getElementById('goshPlotArea');
      if (!area) return;
      // Example 8-study data (log-OR and SE)
      const studies = [
        { y: -0.5, se: 0.2 }, { y: -0.3, se: 0.15 }, { y: -0.1, se: 0.25 },
        { y: -0.4, se: 0.18 }, { y: 0.6, se: 0.3 }, { y: -0.35, se: 0.12 },
        { y: -0.2, se: 0.22 }, { y: -0.45, se: 0.16 }
      ];
      const k = studies.length;
      const rng = xoshiro128ss(42);
      const nSubsets = Math.min(2000, Math.pow(2, k) - 1);
      const points = [];

      for (let s = 0; s < nSubsets; s++) {
        // Random subset (at least 2 studies)
        let mask;
        do {
          mask = Math.floor(rng() * (Math.pow(2, k) - 1)) + 1;
        } while (mask.toString(2).split('').filter(c => c === '1').length < 2);

        const sub = studies.filter((_, i) => mask & (1 << i));
        // Fixed-effect pooled estimate + I
        const wSum = sub.reduce((a, s) => a + 1 / (s.se * s.se), 0);
        const pooled = sub.reduce((a, s) => a + s.y / (s.se * s.se), 0) / wSum;
        const Q = sub.reduce((a, s) => a + (s.y - pooled) ** 2 / (s.se * s.se), 0);
        const df = sub.length - 1;
        const I2 = Math.max(0, (Q - df) / Q * 100);
        points.push({ effect: pooled, I2 });
      }

      const w = 500, h = 280, pad = 50;
      const xMin = -1.2, xMax = 1.2, yMin = 0, yMax = 100;
      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Axes
      svg += `<line x1="${pad}" y1="${h-pad}" x2="${w-pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<line x1="${pad}" y1="${pad}" x2="${pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">Pooled Effect (log-OR)</text>`;
      svg += `<text x="12" y="${h/2}" text-anchor="middle" font-size="11" fill="#666" transform="rotate(-90,12,${h/2})">I (%)</text>`;
      // Points
      points.forEach(p => {
        const px = pad + (p.effect - xMin) / (xMax - xMin) * (w - 2 * pad);
        const py = h - pad - (p.I2 - yMin) / (yMax - yMin) * (h - 2 * pad);
        svg += `<circle cx="${px.toFixed(1)}" cy="${py.toFixed(1)}" r="2" fill="rgba(212,175,55,0.4)"/>`;
      });
      // Tick labels
      [-1, -0.5, 0, 0.5, 1].forEach(v => {
        const x = pad + (v - xMin) / (xMax - xMin) * (w - 2 * pad);
        svg += `<text x="${x}" y="${h-pad+15}" text-anchor="middle" font-size="9" fill="#999">${v}</text>`;
      });
      [0, 25, 50, 75, 100].forEach(v => {
        const y = h - pad - v / 100 * (h - 2 * pad);
        svg += `<text x="${pad-5}" y="${y+3}" text-anchor="end" font-size="9" fill="#999">${v}</text>`;
      });
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 4: Contour-Enhanced Funnel Plot (Module 17) ---
    function generateContourFunnel() {
      const area = document.getElementById('contourFunnelArea');
      if (!area) return;
      // Reuse magnesium-like data
      const studies = [
        {y: -0.5, se: 0.20}, {y: -0.3, se: 0.15}, {y: -0.1, se: 0.25},
        {y: -0.4, se: 0.18}, {y: 0.6, se: 0.30}, {y: -0.35, se: 0.12},
        {y: -0.2, se: 0.22}, {y: -0.45, se: 0.16}, {y: -0.15, se: 0.28},
        {y: -0.55, se: 0.10}
      ];
      const w = 460, h = 300, pad = 50;
      const pooled = -0.28;
      const maxSE = 0.35;
      const xMin = -1.5, xMax = 1.0;
      function px(v) { return pad + (v - xMin) / (xMax - xMin) * (w - 2 * pad); }
      function py(se) { return pad + se / maxSE * (h - 2 * pad); }

      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Contour regions (p-value regions)
      // Draw widest region first (p<0.10) so narrower regions layer on top
      const zVals = [1.645, 1.96, 2.576]; // p<0.10, p<0.05, p<0.01
      const colors = ['rgba(212,175,55,0.15)', 'rgba(59,130,246,0.15)', 'rgba(34,197,94,0.15)'];
      const labels = ['p<0.10', 'p<0.05', 'p<0.01'];
      for (let z = 0; z < zVals.length; z++) {
        // Left contour: effect = -z*SE (significant negative)
        let pts = `${px(0)},${py(0)}`;
        for (let se = 0; se <= maxSE; se += 0.01) {
          pts += ` ${px(-zVals[z] * se)},${py(se)}`;
        }
        pts += ` ${px(xMin)},${py(maxSE)} ${px(xMin)},${py(0)}`;
        svg += `<polygon points="${pts}" fill="${colors[z]}"/>`;
        // Right contour
        pts = `${px(0)},${py(0)}`;
        for (let se = 0; se <= maxSE; se += 0.01) {
          pts += ` ${px(zVals[z] * se)},${py(se)}`;
        }
        pts += ` ${px(xMax)},${py(maxSE)} ${px(xMax)},${py(0)}`;
        svg += `<polygon points="${pts}" fill="${colors[z]}"/>`;
      }
      // Pooled line
      svg += `<line x1="${px(pooled)}" y1="${py(0)}" x2="${px(pooled)}" y2="${py(maxSE)}" stroke="#D4AF37" stroke-width="2"/>`;
      // Null line
      svg += `<line x1="${px(0)}" y1="${py(0)}" x2="${px(0)}" y2="${py(maxSE)}" stroke="#999" stroke-dasharray="4"/>`;
      // Studies
      studies.forEach(s => {
        svg += `<circle cx="${px(s.y)}" cy="${py(s.se)}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>`;
      });
      // Legend
      svg += `<text x="${w-pad}" y="15" text-anchor="end" font-size="9" fill="#22c55e">p&lt;0.01</text>`;
      svg += `<text x="${w-pad}" y="28" text-anchor="end" font-size="9" fill="#3b82f6">p&lt;0.05</text>`;
      svg += `<text x="${w-pad}" y="41" text-anchor="end" font-size="9" fill="#D4AF37">p&lt;0.10</text>`;
      // Axes
      svg += `<line x1="${pad}" y1="${py(0)}" x2="${w-pad}" y2="${py(0)}" stroke="#999"/>`;
      svg += `<line x1="${pad}" y1="${py(0)}" x2="${pad}" y2="${py(maxSE)}" stroke="#999"/>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">Effect Size</text>`;
      svg += `<text x="12" y="${h/2}" text-anchor="middle" font-size="11" fill="#666" transform="rotate(-90,12,${h/2})">Std Error</text>`;
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 5: Fragility Index Calculator (Module 17) ---
    function calculateFragilityIndex() {
      let eTx = parseInt(document.getElementById('fi-eventsTx').value) || 0;
      let nTx = parseInt(document.getElementById('fi-nTx').value) || 0;
      let eCtrl = parseInt(document.getElementById('fi-eventsCtrl').value) || 0;
      let nCtrl = parseInt(document.getElementById('fi-nCtrl').value) || 0;
      if (nTx <= 0 || nCtrl <= 0 || eTx < 0 || eCtrl < 0) {
        document.getElementById('fragilityResult').innerHTML = '<p style="color:#C53030;">Please enter valid positive numbers.</p>';
        document.getElementById('fragilityResult').style.display = 'block';
        return;
      }
      // Fisher's exact test approximation using chi-squared
      function pValue(a, b, c, d) {
        const n = a + b + c + d;
        const e = (a * d - b * c);
        const chi2 = n * e * e / ((a + b) * (c + d) * (a + c) * (b + d));
        // Approximate p from chi2 with 1 df using normal
        const z = Math.sqrt(chi2);
        return 2 * (1 - normalCDF(z));
      }
      function normalCDF(x) {
        const t = 1 / (1 + 0.2316419 * Math.abs(x));
        const d = 0.3989422804 * Math.exp(-x * x / 2);
        const p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
        return x > 0 ? 1 - p : p;
      }
      let fi = 0;
      let a = eTx, b = nTx - eTx, c = eCtrl, d = nCtrl - eCtrl;
      let p = pValue(a, b, c, d);
      if (p >= 0.05) {
        document.getElementById('fragilityResult').innerHTML = '<p>Result is already non-significant (p = ' + p.toFixed(4) + '). Fragility index = 0.</p>';
        document.getElementById('fragilityResult').style.display = 'block';
        return;
      }
      // Iteratively add events to treatment arm (convert non-events to events)
      while (p < 0.05 && fi < 500 && a < nTx) {
        a++;
        b = nTx - a;
        p = pValue(a, b, c, d);
        fi++;
      }
      const res = document.getElementById('fragilityResult');
      res.innerHTML = `
        <p style="font-weight:600; font-size:1.2rem; color:var(--navy);">Fragility Index = ${fi}</p>
        <p style="margin-top:0.5rem;">Changing <strong>${fi}</strong> event${fi !== 1 ? 's' : ''} flips p from significant to ${p.toFixed(4)}.</p>
        <p style="margin-top:0.5rem; color:${fi <= 3 ? '#C53030' : fi <= 8 ? '#D4AF37' : '#22c55e'}; font-weight:600;">
          ${fi <= 3 ? 'Very fragile result' : fi <= 8 ? 'Moderately fragile' : 'Reasonably robust'}
        </p>
      `;
      res.style.display = 'block';
    }

    // --- Tool 6: Dose-Response Curve Builder (Module 16) ---
    let currentDoseModel = 'spline';
    function setDoseModel(model) {
      currentDoseModel = model;
      ['linear', 'quadratic', 'spline'].forEach(m => {
        const btn = document.getElementById('doseBtn-' + m);
        if (btn) { btn.classList.toggle('primary', m === model); }
      });
      drawDoseResponse();
    }
    function drawDoseResponse() {
      const area = document.getElementById('doseResponsePlotArea');
      if (!area) return;
      // Simulated dose-response data (drinks/week vs log-RR)
      const data = [
        {dose: 0, rr: 0, lo: 0, hi: 0},
        {dose: 3, rr: -0.05, lo: -0.15, hi: 0.05},
        {dose: 7, rr: 0.02, lo: -0.08, hi: 0.12},
        {dose: 14, rr: 0.15, lo: 0.03, hi: 0.27},
        {dose: 21, rr: 0.35, lo: 0.18, hi: 0.52},
        {dose: 28, rr: 0.55, lo: 0.30, hi: 0.80}
      ];
      const w = 480, h = 240, pad = 50;
      const maxDose = 30, yMin = -0.3, yMax = 0.9;
      function px(d) { return pad + d / maxDose * (w - 2 * pad); }
      function py(v) { return h - pad - (v - yMin) / (yMax - yMin) * (h - 2 * pad); }

      let svg = `<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:auto;font-family:sans-serif;">`;
      // Reference line at 0
      svg += `<line x1="${pad}" y1="${py(0)}" x2="${w-pad}" y2="${py(0)}" stroke="#aaa" stroke-dasharray="4"/>`;
      // CI shading
      let ciPath = `M${px(data[0].dose)},${py(data[0].hi)}`;
      data.forEach(d => { ciPath += ` L${px(d.dose)},${py(d.hi)}`; });
      for (let i = data.length - 1; i >= 0; i--) { ciPath += ` L${px(data[i].dose)},${py(data[i].lo)}`; }
      ciPath += 'Z';
      svg += `<path d="${ciPath}" fill="rgba(212,175,55,0.15)"/>`;

      // Model curve
      let curvePts = [];
      for (let d = 0; d <= maxDose; d += 0.5) {
        let val;
        if (currentDoseModel === 'linear') {
          val = 0.019 * d;
        } else if (currentDoseModel === 'quadratic') {
          val = -0.005 * d + 0.0009 * d * d;
        } else { // spline
          // Simulate a J-curve effect
          if (d <= 5) val = -0.01 * d;
          else if (d <= 15) val = -0.05 + 0.02 * (d - 5);
          else val = 0.15 + 0.025 * (d - 15);
        }
        curvePts.push(`${px(d).toFixed(1)},${py(val).toFixed(1)}`);
      }
      svg += `<polyline points="${curvePts.join(' ')}" fill="none" stroke="#D4AF37" stroke-width="2.5"/>`;

      // Data points
      data.forEach(d => {
        svg += `<circle cx="${px(d.dose)}" cy="${py(d.rr)}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>`;
        svg += `<line x1="${px(d.dose)}" y1="${py(d.lo)}" x2="${px(d.dose)}" y2="${py(d.hi)}" stroke="#1E2761" stroke-width="1"/>`;
      });
      // Axes + labels
      svg += `<line x1="${pad}" y1="${h-pad}" x2="${w-pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<line x1="${pad}" y1="${pad}" x2="${pad}" y2="${h-pad}" stroke="#999"/>`;
      svg += `<text x="${w/2}" y="${h-5}" text-anchor="middle" font-size="11" fill="#666">Dose (drinks/week)</text>`;
      svg += `<text x="12" y="${h/2}" text-anchor="middle" font-size="11" fill="#666" transform="rotate(-90,12,${h/2})">log-RR</text>`;
      svg += `<text x="${w-pad}" y="20" text-anchor="end" font-size="11" fill="#D4AF37" font-weight="600">${currentDoseModel.charAt(0).toUpperCase() + currentDoseModel.slice(1)} model</text>`;
      svg += '</svg>';
      area.innerHTML = svg;
    }

    // --- Tool 7: CERQual Assessment Tool (Module 20) ---
    function initCERQualTool() {
      const container = document.getElementById('cerqualTool');
      if (!container) return;
      const components = [
        { id: 'meth', label: 'Methodological Limitations', desc: 'Extent of problems with design/conduct of contributing studies' },
        { id: 'cohe', label: 'Coherence', desc: 'How clearly and consistently the data supports the finding' },
        { id: 'adeq', label: 'Adequacy', desc: 'Degree of richness and quantity of data supporting the finding' },
        { id: 'relv', label: 'Relevance', desc: 'Extent to which the contributing studies apply to the review context' }
      ];
      const levels = ['No concerns', 'Minor concerns', 'Moderate concerns', 'Serious concerns'];
      let html = '';
      components.forEach(c => {
        html += `<div style="margin-bottom:0.75rem; padding:0.75rem; background:white; border-radius:6px; border:1px solid #e2e8f0;">
          <div style="font-weight:600; margin-bottom:0.25rem;">${c.label}</div>
          <div style="font-size:0.8rem; color:#718096; margin-bottom:0.5rem;">${c.desc}</div>
          <select id="cerqual-${c.id}" onchange="updateCERQual()" style="width:100%; padding:0.3rem; border:1px solid #ccc; border-radius:4px;">
            ${levels.map((l, i) => `<option value="${i}">${l}</option>`).join('')}
          </select>
        </div>`;
      });
      html += '<div id="cerqualResult" style="margin-top:0.75rem; padding:0.75rem; background:rgba(212,175,55,0.1); border-radius:6px;"></div>';
      container.innerHTML = html;
      updateCERQual();
    }
    function updateCERQual() {
      const ids = ['meth', 'cohe', 'adeq', 'relv'];
      const total = ids.reduce((s, id) => s + parseInt(document.getElementById('cerqual-' + id)?.value || 0), 0);
      const levels = ['High', 'Moderate', 'Low', 'Very Low'];
      const colors = ['#22c55e', '#D4AF37', '#f59e0b', '#C53030'];
      const idx = Math.min(3, Math.floor(total / 2));
      const res = document.getElementById('cerqualResult');
      if (res) res.innerHTML = `<p style="font-weight:600; color:${colors[idx]}; font-size:1.1rem;">Overall Confidence: ${levels[idx]}</p>
        <p style="font-size:0.85rem; margin-top:0.25rem;">Total concern score: ${total}/12</p>`;
    }

    // --- Tool 8: Reproducibility Checklist (Module 22) ---
    function initReproChecklist() {
      const container = document.getElementById('reproChecklist');
      if (!container) return;
      const items = [
        'Search strategy fully reported and reproducible',
        'Extracted data table available (supplementary or repository)',
        'Analysis code/script shared (R, Python, or equivalent)',
        'Software version and packages documented',
        'Random seed specified for stochastic analyses',
        'Sensitivity analyses pre-specified in protocol',
        'PRISMA checklist completed and submitted',
        'Data available in machine-readable format (CSV/JSON)'
      ];
      container.innerHTML = items.map((item, i) =>
        `<label style="display:flex; align-items:center; gap:0.5rem; padding:0.5rem 0; border-bottom:1px solid #e2e8f0; cursor:pointer;">
          <input type="checkbox" id="repro-${i}" onchange="updateReproScore()" style="width:18px;height:18px;accent-color:#D4AF37;">
          <span style="font-size:0.9rem;">${item}</span>
        </label>`
      ).join('');
      updateReproScore();
    }
    function updateReproScore() {
      const total = 8;
      let checked = 0;
      for (let i = 0; i < total; i++) {
        if (document.getElementById('repro-' + i)?.checked) checked++;
      }
      const pct = Math.round(checked / total * 100);
      const color = pct >= 75 ? '#22c55e' : pct >= 50 ? '#D4AF37' : '#C53030';
      const label = pct >= 75 ? 'Good' : pct >= 50 ? 'Fair' : 'Poor';
      const res = document.getElementById('reproScore');
      if (res) {
        res.innerHTML = `
          <div style="background:#e2e8f0; border-radius:4px; height:12px; margin-bottom:0.5rem;">
            <div style="background:${color}; height:100%; border-radius:4px; width:${pct}%; transition:width 0.3s;"></div>
          </div>
          <p style="font-weight:600; color:${color};">${label} Reproducibility (${checked}/${total} = ${pct}%)</p>
        `;
      }
    }

    // Initialize tools when modules are first visited
    function initAdvancedTools() {
      // Run once on first visit to these modules
      if (document.getElementById('bayesianPlotArea') && !document.getElementById('bayesianPlotArea').innerHTML) {
        updateBayesianPosterior();
      }
      if (document.getElementById('nmaNetworkArea') && !document.getElementById('nmaNetworkArea').innerHTML) {
        drawNMANetwork();
      }
      if (document.getElementById('doseResponsePlotArea') && !document.getElementById('doseResponsePlotArea').innerHTML) {
        drawDoseResponse();
      }
      if (document.getElementById('reproChecklist') && !document.getElementById('reproChecklist').innerHTML) {
        initReproChecklist();
      }
    }

    // Hook into goToModule to init tools
    const _origGoToModuleForTools = typeof goToModule === 'function' ? goToModule : null;

    function openToolsWithStory() {
      // Open tools panel
      const panel = document.getElementById('toolsPanel');
      panel.classList.add('open');

      // Scroll to story data section
      const storyPanel = document.getElementById('storyDataPanel');
      if (storyPanel) {
        storyPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        storyPanel.classList.add('updating');
        setTimeout(() => storyPanel.classList.remove('updating'), 500);
      }

      // Hide the indicator button since they found it
      document.getElementById('storyIndicatorBtn').classList.remove('pulse');
    }

    function loadStoryIntoCalculator() {
      const story = storyData[currentModule];
      if (!story) {
        alert('No story data available for this module.');
        return;
      }

      const data = currentStoryView === 'before' ? story.before : story.after;
      const tbody = document.getElementById('studyTableBody');

      // Clear existing rows
      tbody.innerHTML = '';

      // Add story studies
      data.studies.forEach(study => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input type="text" value="${study.name}"></td>
          <td><input type="number" step="0.01" value="${study.effect.toFixed(2)}"></td>
          <td><input type="number" step="0.01" value="${study.lo.toFixed(2)}"></td>
          <td><input type="number" step="0.01" value="${study.hi.toFixed(2)}"></td>
          <td><button class="btn-small" onclick="removeStudyRow(this)"></button></td>
        `;
        tbody.appendChild(row);
      });

      // Auto-run the analysis
      runMetaAnalysis();

      // Show notification
      const panel = document.getElementById('storyDataPanel');
      panel.classList.add('updating');
      setTimeout(() => panel.classList.remove('updating'), 500);
    }

    // ============================================================
    // STATISTICAL FUNCTIONS
    // ============================================================

    function normalCDF(x) {
      const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741;
      const a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911;
      const sign = x < 0 ? -1 : 1;
      x = Math.abs(x) / Math.sqrt(2);
      const t = 1 / (1 + p * x);
      const y = 1 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
      return 0.5 * (1 + sign * y);
    }

    function tCDF(t, df) {
      if (df <= 0) return 0.5;
      const x = df / (df + t * t);
      const half = 0.5 * incompleteBeta(x, df / 2, 0.5);
      return t >= 0 ? 1 - half : half;
    }

    function incompleteBeta(x, a, b) {
      if (x === 0) return 0;
      if (x === 1) return 1;
      const bt = Math.exp(
        logGamma(a + b) - logGamma(a) - logGamma(b) +
        a * Math.log(x) + b * Math.log(1 - x)
      );
      if (x < (a + 1) / (a + b + 2)) {
        return bt * betaCF(x, a, b) / a;
      }
      return 1 - bt * betaCF(1 - x, b, a) / b;
    }

    function betaCF(x, a, b) {
      const maxIter = 200, eps = 1e-10;
      const qab = a + b, qap = a + 1, qam = a - 1;
      let c = 1, d = 1 - qab * x / qap;
      if (Math.abs(d) < 1e-30) d = 1e-30;
      d = 1 / d;
      let h = d;
      for (let m = 1; m <= maxIter; m++) {
        const m2 = 2 * m;
        let aa = m * (b - m) * x / ((qam + m2) * (a + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < 1e-30) d = 1e-30;
        c = 1 + aa / c;
        if (Math.abs(c) < 1e-30) c = 1e-30;
        d = 1 / d;
        h *= d * c;
        aa = -(a + m) * (qab + m) * x / ((a + m2) * (qap + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < 1e-30) d = 1e-30;
        c = 1 + aa / c;
        if (Math.abs(c) < 1e-30) c = 1e-30;
        d = 1 / d;
        const del = d * c;
        h *= del;
        if (Math.abs(del - 1) < eps) break;
      }
      return h;
    }

    function logGamma(x) {
      const c = [76.18009172947146, -86.50532032941677, 24.01409824083091,
        -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5];
      let y = x, tmp = x + 5.5;
      tmp -= (x + 0.5) * Math.log(tmp);
      let ser = 1.000000000190015;
      for (let j = 0; j < 6; j++) ser += c[j] / ++y;
      return -tmp + Math.log(2.5066282746310005 * ser / x);
    }

    function tQuantile(p, df) {
      if (p <= 0) return -Infinity;
      if (p >= 1) return Infinity;
      if (df <= 0) return NaN;
      let lo = -10, hi = 10;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (tCDF(mid, df) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    function normalQuantile(p) {
      if (p <= 0) return -Infinity;
      if (p >= 1) return Infinity;
      let lo = -10, hi = 10;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (normalCDF(mid) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    function chiSquareCDF(x, df) {
      if (x <= 0) return 0;
      return regularizedGammaP(df / 2, x / 2);
    }

    function regularizedGammaP(a, x) {
      if (x < 0 || a <= 0) return NaN;
      if (x === 0) return 0;
      if (x < a + 1) {
        let sum = 1 / a, term = sum;
        for (let n = 1; n < 100; n++) {
          term *= x / (a + n);
          sum += term;
          if (Math.abs(term) < 1e-10) break;
        }
        return sum * Math.exp(-x + a * Math.log(x) - logGamma(a));
      } else {
        let b = x + 1 - a, c = 1 / 1e-30, d = 1 / b, h = d;
        for (let i = 1; i < 100; i++) {
          const an = -i * (i - a);
          b += 2;
          d = an * d + b;
          if (Math.abs(d) < 1e-30) d = 1e-30;
          c = b + an / c;
          if (Math.abs(c) < 1e-30) c = 1e-30;
          d = 1 / d;
          const del = d * c;
          h *= del;
          if (Math.abs(del - 1) < 1e-10) break;
        }
        return 1 - Math.exp(-x + a * Math.log(x) - logGamma(a)) * h;
      }
    }

    function chiSquareQuantile(p, df) {
      if (p <= 0) return 0;
      if (p >= 1) return Infinity;
      let lo = 0, hi = df * 5 + 50;
      for (let i = 0; i < 100; i++) {
        const mid = (lo + hi) / 2;
        if (chiSquareCDF(mid, df) < p) lo = mid;
        else hi = mid;
      }
      return (lo + hi) / 2;
    }

    // ============================================================
    // TAU ESTIMATORS
    // ============================================================

    function calculateTau2DL(effects, ses) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      const weights = variances.map(v => 1 / v);
      const totalWeight = weights.reduce((a, b) => a + b, 0);
      const meanEffect = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / totalWeight;
      const q = effects.reduce((sum, e, i) => sum + weights[i] * (e - meanEffect) ** 2, 0);
      const c = totalWeight - weights.reduce((sum, w) => sum + w * w, 0) / totalWeight;
      return c > 0 ? Math.max(0, (q - (k - 1)) / c) : 0;
    }

    function calculateTau2REML(effects, ses, maxIter = 100, tol = 1e-6) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < maxIter; iter++) {
        const w = variances.map(v => 1 / (v + tau2));
        const sumW = w.reduce((a, b) => a + b, 0);
        const sumW2 = w.reduce((sum, wi) => sum + wi * wi, 0);
        const mu = effects.reduce((sum, e, i) => sum + e * w[i], 0) / sumW;
        const score = -0.5 * sumW + 0.5 * sumW2 / sumW + 0.5 * effects.reduce((sum, e, i) => sum + w[i] * w[i] * (e - mu) ** 2, 0);
        const info = 0.5 * (sumW2 - w.reduce((sum, wi) => sum + wi * wi * wi, 0) * 2 / sumW + sumW2 * sumW2 / (sumW * sumW));
        const delta = info > 0 ? score / info : 0;
        const newTau2 = Math.max(0, tau2 + delta);
        if (Math.abs(newTau2 - tau2) < tol) return newTau2;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2PM(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      let tau2 = 0.1;
      for (let iter = 0; iter < 100; iter++) {
        const weights = variances.map(v => 1 / (v + tau2));
        const sumW = weights.reduce((a, b) => a + b, 0);
        const meanEffect = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
        const Q = effects.reduce((sum, e, i) => sum + weights[i] * (e - meanEffect) ** 2, 0);
        if (Math.abs(Q - (n - 1)) < 0.0001) break;
        const dQ = -effects.reduce((sum, e, i) => sum + weights[i] * weights[i] * (e - meanEffect) ** 2, 0);
        tau2 = Math.max(0, tau2 - (Q - (n - 1)) / dQ);
      }
      return tau2;
    }

    function calculateTau2SJ(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / n;
      let tau2 = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / (n - 1);
      const weights = variances.map(v => 1 / (v + tau2));
      const sumW = weights.reduce((a, b) => a + b, 0);
      const pooled = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
      tau2 = effects.reduce((sum, e, i) => sum + (e - pooled) ** 2 / (variances[i] + tau2), 0) / (n - 1);
      return Math.max(0, tau2);
    }

    function calculateTau2HE(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / n;
      const S2 = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / (n - 1);
      const avgVar = variances.reduce((a, b) => a + b, 0) / n;
      return Math.max(0, S2 - avgVar);
    }

    function calculateTau2EB(effects, ses) {
      const n = effects.length;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < 20; iter++) {
        const weights = variances.map(v => 1 / (v + tau2));
        const sumW = weights.reduce((a, b) => a + b, 0);
        const mean = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;
        const Q = effects.reduce((sum, e, i) => sum + weights[i] * (e - mean) ** 2, 0);
        const C = sumW - weights.reduce((sum, w) => sum + w * w, 0) / sumW;
        const newTau2 = Math.max(0, (Q - (n - 1)) / C);
        if (Math.abs(newTau2 - tau2) < 1e-8) break;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2ML(effects, ses, maxIter = 100, tol = 1e-6) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      let tau2 = calculateTau2DL(effects, ses);
      for (let iter = 0; iter < maxIter; iter++) {
        const w = variances.map(v => 1 / (v + tau2));
        const sumW = w.reduce((a, b) => a + b, 0);
        const mu = effects.reduce((sum, e, i) => sum + e * w[i], 0) / sumW;
        const score = 0.5 * effects.reduce((sum, e, i) => sum + w[i] * w[i] * (e - mu) ** 2, 0) -
                      0.5 * w.reduce((sum, wi) => sum + wi, 0);
        const sumW2 = w.reduce((sum, wi) => sum + wi * wi, 0);
        const info = 0.5 * sumW2;
        const delta = info > 0 ? score / info : 0;
        const newTau2 = Math.max(0, tau2 + delta);
        if (Math.abs(newTau2 - tau2) < tol) return newTau2;
        tau2 = newTau2;
      }
      return tau2;
    }

    function calculateTau2HS(effects, ses) {
      const k = effects.length;
      if (k < 2) return 0;
      const variances = ses.map(se => se * se);
      const meanEffect = effects.reduce((a, b) => a + b, 0) / k;
      const totalVariance = effects.reduce((sum, e) => sum + (e - meanEffect) ** 2, 0) / k;
      const avgSamplingVar = variances.reduce((a, b) => a + b, 0) / k;
      return Math.max(0, totalVariance - avgSamplingVar);
    }

    // ============================================================
    // MAIN META-ANALYSIS
    // ============================================================

    function calculateMetaAnalysis(studies, options = {}) {
      const settings = { tau2Estimator: 'DL', useHKSJ: true, confidenceLevel: 0.95, ...options };
      const k = studies.length;
      if (k === 0) return { error: 'No studies provided' };

      const isRatio = studies[0].isRatioMeasure !== false;
      const transformedEffects = studies.map(s => isRatio ? Math.log(s.effect) : s.effect);
      const ses = studies.map(s => {
        if (isRatio) return (Math.log(s.ciHi) - Math.log(s.ciLo)) / Z_95_CI_DIVISOR;
        return (s.ciHi - s.ciLo) / Z_95_CI_DIVISOR;
      });

      const fixedWeights = ses.map(se => 1 / (se * se));
      const totalFixedWeight = fixedWeights.reduce((a, b) => a + b, 0);
      const fixedEffect = transformedEffects.reduce((sum, e, i) => sum + e * fixedWeights[i], 0) / totalFixedWeight;
      const q = transformedEffects.reduce((sum, e, i) => sum + fixedWeights[i] * Math.pow(e - fixedEffect, 2), 0);
      const df = k - 1;
      const qPValue = df > 0 ? 1 - chiSquareCDF(q, df) : 1;
      const i2 = q > df ? Math.max(0, ((q - df) / q) * 100) : 0;
      const h2 = df > 0 ? q / df : 1;

      let tau2, tau2Method;
      const estimator = settings.tau2Estimator || 'DL';
      switch (estimator) {
        case 'REML': tau2 = calculateTau2REML(transformedEffects, ses); tau2Method = 'REML'; break;
        case 'PM': tau2 = calculateTau2PM(transformedEffects, ses); tau2Method = 'PM'; break;
        case 'SJ': tau2 = calculateTau2SJ(transformedEffects, ses); tau2Method = 'SJ'; break;
        case 'HE': tau2 = calculateTau2HE(transformedEffects, ses); tau2Method = 'HE'; break;
        case 'EB': tau2 = calculateTau2EB(transformedEffects, ses); tau2Method = 'EB'; break;
        case 'ML': tau2 = calculateTau2ML(transformedEffects, ses); tau2Method = 'ML'; break;
        case 'HS': tau2 = calculateTau2HS(transformedEffects, ses); tau2Method = 'HS'; break;
        default: tau2 = calculateTau2DL(transformedEffects, ses); tau2Method = 'DL';
      }

      const randomWeights = ses.map(se => 1 / (se * se + tau2));
      const totalRandomWeight = randomWeights.reduce((a, b) => a + b, 0);
      const normalizedWeights = randomWeights.map(w => w / totalRandomWeight);
      const randomEffect = transformedEffects.reduce((sum, e, i) => sum + e * randomWeights[i], 0) / totalRandomWeight;
      let randomSE = Math.sqrt(1 / totalRandomWeight);

      let useHKSJ = settings.useHKSJ && k >= 2;
      let hksjAdjustment = null;
      if (useHKSJ) {
        const qStar = transformedEffects.reduce((sum, e, i) => sum + randomWeights[i] * Math.pow(e - randomEffect, 2), 0);
        const hksjMultiplier = df > 0 ? qStar / df : 1;
        hksjAdjustment = { multiplier: hksjMultiplier, adjustedSE: randomSE * Math.sqrt(Math.max(1, hksjMultiplier)) };
      }

      let pooledCiLo, pooledCiHi, pValue, testMethod;
      if (useHKSJ && hksjAdjustment) {
        const tCrit = tQuantile(1 - (1 - settings.confidenceLevel) / 2, df);
        const effectSE = hksjAdjustment.adjustedSE;
        pooledCiLo = isRatio ? Math.exp(randomEffect - tCrit * effectSE) : randomEffect - tCrit * effectSE;
        pooledCiHi = isRatio ? Math.exp(randomEffect + tCrit * effectSE) : randomEffect + tCrit * effectSE;
        const tStat = randomEffect / effectSE;
        pValue = 2 * (1 - tCDF(Math.abs(tStat), df));
        testMethod = 'HKSJ (t-distribution)';
      } else {
        const zCrit = normalQuantile(1 - (1 - settings.confidenceLevel) / 2);
        pooledCiLo = isRatio ? Math.exp(randomEffect - zCrit * randomSE) : randomEffect - zCrit * randomSE;
        pooledCiHi = isRatio ? Math.exp(randomEffect + zCrit * randomSE) : randomEffect + zCrit * randomSE;
        const z = randomEffect / randomSE;
        pValue = 2 * (1 - normalCDF(Math.abs(z)));
        testMethod = 'Wald (z-distribution)';
      }

      const pooledEffect = isRatio ? Math.exp(randomEffect) : randomEffect;

      const predictionInterval = tau2 > 0 && k >= 3 ? {
        lo: isRatio ? Math.exp(randomEffect - tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)) : randomEffect - tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2),
        hi: isRatio ? Math.exp(randomEffect + tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)) : randomEffect + tQuantile(0.975, k - 2) * Math.sqrt(randomSE * randomSE + tau2)
      } : null;

      return {
        pooledEffect, pooledCiLo, pooledCiHi, pValue,
        i2, h2, q, qPValue, tau2, tau2Method,
        k, weights: normalizedWeights, isRatio,
        testMethod, hksjAdjustment, predictionInterval,
        transformedEffects, ses, confidenceLevel: settings.confidenceLevel,
        fixedEffect: isRatio ? Math.exp(fixedEffect) : fixedEffect,
        fixedSE: Math.sqrt(1 / totalFixedWeight)
      };
    }

    // ============================================================
    // FOREST PLOT
    // ============================================================

    function generateForestPlotHTML(studies, meta) {
      const allEffects = [...studies.map(s => s.effect), meta.pooledEffect];
      const allLo = [...studies.map(s => s.ciLo), meta.pooledCiLo];
      const allHi = [...studies.map(s => s.ciHi), meta.pooledCiHi];

      const minEffect = Math.min(...allLo, 0.5);
      const maxEffect = Math.max(...allHi, 2.0);
      const range = maxEffect - minEffect;

      const scale = (val) => ((val - minEffect) / range) * 350 + 50;
      const height = (studies.length + 2) * 28 + 40;

      return `
        <svg viewBox="0 0 550 ${height}" style="width: 100%; height: ${height}px; font-family: 'Source Sans Pro', sans-serif;">
          <line x1="${scale(1)}" y1="15" x2="${scale(1)}" y2="${height - 25}" stroke="#ddd" stroke-width="1.5" stroke-dasharray="4" />
          <line x1="50" y1="${height - 25}" x2="400" y2="${height - 25}" stroke="#333" />
          <text x="${scale(0.5)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">0.5</text>
          <text x="${scale(1)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">1.0</text>
          <text x="${scale(1.5)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">1.5</text>
          <text x="${scale(2)}" y="${height - 8}" font-size="9" text-anchor="middle" fill="#666">2.0</text>
          ${studies.map((s, i) => {
            const y = 25 + i * 28;
            const size = Math.max(4, Math.sqrt(meta.weights[i]) * 12);
            return `
              <text x="5" y="${y + 4}" font-size="9" fill="#333">${_escHtml(s.label || 'Study ' + (i+1))}</text>
              <line x1="${scale(s.ciLo)}" y1="${y}" x2="${scale(s.ciHi)}" y2="${y}" stroke="#1E2761" stroke-width="1.5" />
              <rect x="${scale(s.effect) - size/2}" y="${y - size/2}" width="${size}" height="${size}" fill="#1E2761" />
              <text x="420" y="${y + 4}" font-size="8" fill="#333">${s.effect.toFixed(2)} [${s.ciLo.toFixed(2)}, ${s.ciHi.toFixed(2)}]</text>
            `;
          }).join('')}
          <polygon points="
            ${scale(meta.pooledEffect)},${25 + studies.length * 28 - 7}
            ${scale(meta.pooledCiLo)},${25 + studies.length * 28}
            ${scale(meta.pooledEffect)},${25 + studies.length * 28 + 7}
            ${scale(meta.pooledCiHi)},${25 + studies.length * 28}
          " fill="#D4AF37" />
          <text x="5" y="${25 + studies.length * 28 + 4}" font-size="9" font-weight="bold" fill="#333">Pooled</text>
          <text x="420" y="${25 + studies.length * 28 + 4}" font-size="8" font-weight="bold" fill="#333">${meta.pooledEffect.toFixed(2)} [${meta.pooledCiLo.toFixed(2)}, ${meta.pooledCiHi.toFixed(2)}]</text>
          <text x="${scale(0.7)}" y="${height - 2}" font-size="8" fill="#22c55e">Favors Treatment</text>
          <text x="${scale(1.3)}" y="${height - 2}" font-size="8" fill="#C53030">Favors Control</text>
        </svg>
      `;
    }

    // ============================================================
    // MODULE NAVIGATION
    // ============================================================

    const modules = [
      { id: 0, title: 'The Opening', subtitle: 'Why meta-analysis exists', slides: 12 },
      { id: 1, title: 'The Question', subtitle: 'CAST: PICO framework', slides: 20 },
      { id: 2, title: 'The Protocol', subtitle: 'HRT: Pre-specification', slides: 14 },
      { id: 3, title: 'The Search', subtitle: 'Rosiglitazone: Grey literature', slides: 17 },
      { id: 4, title: 'The Screening', subtitle: 'Vioxx: PRISMA', slides: 18 },
      { id: 5, title: 'The Extraction', subtitle: 'DECREASE: Provenance', slides: 18 },
      { id: 6, title: 'The Bias', subtitle: 'Aprotinin: RoB 2.0 + ROBINS-I', slides: 13 },
      { id: 7, title: 'The Synthesis', subtitle: 'Magnesium: Forest plots', slides: 19 },
      { id: 8, title: 'The Heterogeneity', subtitle: 'ACCORD: I, ICEMAN & Meta-regression', slides: 19 },
      { id: 9, title: 'The Hidden Studies', subtitle: 'Reboxetine: Funnel plots', slides: 17 },
      { id: 10, title: 'The Certainty', subtitle: 'Surfactant: GRADE', slides: 18 },
      { id: 11, title: 'The Living Review', subtitle: 'COVID-19: TSA', slides: 16 },
      { id: 12, title: 'Advanced Methods', subtitle: 'NMA, DTA, Dose-response', slides: 16 },
      { id: 13, title: 'The Bayesian Turn', subtitle: 'STAMPEDE: Priors & posteriors', slides: 16 },
      { id: 14, title: 'The Network', subtitle: 'Cipriani 2018: NMA & SUCRA', slides: 16 },
      { id: 15, title: 'The Individual', subtitle: 'EBCTCG: IPD meta-analysis', slides: 14 },
      { id: 16, title: 'The Dose', subtitle: 'Alcohol J-curve: Dose-response', slides: 14 },
      { id: 17, title: 'The Fragility', subtitle: 'Oseltamivir: Robustness', slides: 14 },
      { id: 18, title: 'The Equity', subtitle: 'SPRINT: PROGRESS-Plus', slides: 14 },
      { id: 19, title: 'The Machine', subtitle: 'Cochrane COVID: AI screening', slides: 15 },
      { id: 20, title: 'The Qualitative', subtitle: 'Bohren 2015: Meta-ethnography', slides: 13 },
      { id: 21, title: 'The Multivariate', subtitle: 'Correlated outcomes: RVE', slides: 14 },
      { id: 22, title: 'The Proof', subtitle: 'Reinhart-Rogoff: Reproducibility', slides: 16 },
      { id: 23, title: 'Capstone', subtitle: 'Your First Meta-Sprint', slides: 14 },
      { id: 24, title: 'Final Exam', subtitle: 'Summative assessment', slides: 5 }
    ];

    let currentModule = 0;
    let currentSlide = 0;
    let currentTier = 'foundation'; // foundation | researcher | methodologist

    function setTier(tier) {
      currentTier = tier;
      document.body.classList.remove('tier-foundation', 'tier-researcher', 'tier-methodologist');
      if (tier !== 'foundation') document.body.classList.add('tier-' + tier);
      document.querySelectorAll('.tier-btn').forEach(btn => {
        const isCurrent = btn.dataset.tier === tier;
        btn.classList.toggle('active', isCurrent);
        btn.setAttribute('aria-checked', isCurrent);
      });
      // Recalculate slide count for current module (tier-hidden slides don't count)
      updateSlideNavForTier();
      try { localStorage.setItem('synthesis_course_tier', tier); } catch(e) {}
    }

    function updateSlideNavForTier() {
      // After tier change, if current slide is now hidden, jump to nearest visible slide
      const container = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      if (!container) return;
      const allSlides = container.querySelectorAll('.slide');
      const activeSlide = allSlides[currentSlide];
      if (activeSlide && getComputedStyle(activeSlide).display === 'none') {
        // Find previous visible slide
        for (let i = currentSlide - 1; i >= 0; i--) {
          if (getComputedStyle(allSlides[i]).display !== 'none') {
            goToSlide(i);
            return;
          }
        }
        goToSlide(0);
      }
      updateCounter();
    }

    function getVisibleSlideCount() {
      const container = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      if (!container) return 0;
      let count = 0;
      container.querySelectorAll('.slide').forEach(s => {
        if (getComputedStyle(s).display !== 'none') count++;
      });
      return count;
    }

    function initModuleList() {
      const list = document.getElementById('moduleList');
      list.innerHTML = modules.map(m => `
        <div class="module-item ${m.id === currentModule ? 'active' : ''}" data-module="${m.id}" onclick="goToModule(${m.id})">
          <div class="module-number">${m.id}</div>
          <div class="module-info">
            <div class="module-title">${m.title}</div>
            <div class="module-subtitle">${m.subtitle}</div>
          </div>
        </div>
      `).join('');
    }

    function goToModule(moduleId) {
      // Hide current module
      document.querySelectorAll('.module-slides').forEach(m => m.classList.remove('active'));
      document.querySelectorAll('.module-item').forEach(m => m.classList.remove('active'));

      // Show new module
      currentModule = moduleId;
      currentSlide = 0;
      const moduleEl = document.querySelector(`.module-slides[data-module="${moduleId}"]`);
      if (moduleEl) {
        moduleEl.classList.add('active');
        updateSlideDisplay(moduleEl);
      }
      document.querySelector(`.module-item[data-module="${moduleId}"]`).classList.add('active');

      // Update header
      document.getElementById('currentModuleNum').textContent = moduleId;
      document.getElementById('currentModuleName').textContent = modules[moduleId].title;

      // Update live story data panel
      updateStoryPanel(moduleId);

      // Initialize advanced interactive tools (modules 13-22)
      setTimeout(initAdvancedTools, 100);

      // Show/hide story indicator button
      const storyBtn = document.getElementById('storyIndicatorBtn');
      if (storyData[moduleId]) {
        storyBtn.classList.add('visible');
      } else {
        storyBtn.classList.remove('visible');
      }

      updateProgress();
    }

    function updateSlideDisplay(moduleEl) {
      const slides = moduleEl.querySelectorAll('.slide');
      slides.forEach((s, i) => s.classList.toggle('active', i === currentSlide));

      // Build visible-only progress dots (skip tier-hidden slides)
      const progress = document.getElementById('progress');
      let dots = '';
      let visibleIndex = 0;
      let currentVisibleIndex = 0;
      let visibleTotal = 0;
      for (let i = 0; i < slides.length; i++) {
        if (getComputedStyle(slides[i]).display === 'none') continue;
        if (i === currentSlide) currentVisibleIndex = visibleIndex;
        dots += `<div class="progress-dot ${i === currentSlide ? 'active' : ''}" onclick="goToSlide(${i})" role="button" tabindex="0" aria-label="Go to slide ${visibleIndex + 1}"></div>`;
        visibleIndex++;
        visibleTotal++;
      }
      progress.innerHTML = dots;

      // Update counter with visible-only count
      document.getElementById('counter').textContent = `${currentVisibleIndex + 1} / ${visibleTotal}`;

      // Update buttons  check if there's a visible next/prev
      const hasVisiblePrev = (() => { for (let i = currentSlide - 1; i >= 0; i--) { if (getComputedStyle(slides[i]).display !== 'none') return true; } return false; })();
      const hasVisibleNext = (() => { for (let i = currentSlide + 1; i < slides.length; i++) { if (getComputedStyle(slides[i]).display !== 'none') return true; } return false; })();
      document.getElementById('prevBtn').disabled = !hasVisiblePrev;
      document.getElementById('nextBtn').disabled = !hasVisibleNext;

      // Announce slide change to screen readers
      const announcer = document.getElementById('slideAnnouncer');
      if (announcer) {
        announcer.textContent = `Slide ${currentVisibleIndex + 1} of ${visibleTotal}`;
      }
    }

    function updateCounter() {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      if (moduleEl) updateSlideDisplay(moduleEl);
    }

    function goToSlide(index) {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      if (index >= 0 && index < slides.length) {
        currentSlide = index;
        updateSlideDisplay(moduleEl);
      }
    }

    function nextSlide() {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      // Skip tier-hidden slides
      for (let i = currentSlide + 1; i < slides.length; i++) {
        if (getComputedStyle(slides[i]).display !== 'none') {
          currentSlide = i;
          updateSlideDisplay(moduleEl);
          return;
        }
      }
    }

    function prevSlide() {
      const moduleEl = document.querySelector(`.module-slides[data-module="${currentModule}"]`);
      const slides = moduleEl.querySelectorAll('.slide');
      for (let i = currentSlide - 1; i >= 0; i--) {
        if (getComputedStyle(slides[i]).display !== 'none') {
          currentSlide = i;
          updateSlideDisplay(moduleEl);
          return;
        }
      }
    }

    function nextModule() {
      if (currentModule < modules.length - 1) {
        goToModule(currentModule + 1);
      }
    }

    function updateProgress() {
      const percent = Math.round((currentModule / (modules.length - 1)) * 100);
      document.getElementById('progressPercent').textContent = percent + '%';
    }

    // ============================================================
    // TOOLS PANEL
    // ============================================================

    function toggleToolsPanel() {
      const panel = document.getElementById('toolsPanel');
      const contentBody = document.querySelector('.content-body');
      panel.classList.toggle('visible');
      contentBody.classList.toggle('tools-open');
    }

    function toggleSection(header) {
      const body = header.nextElementSibling;
      body.style.display = body.style.display === 'none' ? 'block' : 'none';
      header.querySelector('span').textContent = body.style.display === 'none' ? '' : '';
    }

    // ============================================================
    // EFFECT SIZE CALCULATOR
    // ============================================================

    function calculateEffectSize() {
      const type = document.getElementById('effectType').value;
      const eventsTx = parseFloat(document.getElementById('eventsTx').value);
      const nTx = parseFloat(document.getElementById('nTx').value);
      const eventsCtrl = parseFloat(document.getElementById('eventsCtrl').value);
      const nCtrl = parseFloat(document.getElementById('nCtrl').value);

      if (isNaN(eventsTx) || isNaN(nTx) || isNaN(eventsCtrl) || isNaN(nCtrl)) {
        alert('Please enter all values');
        return;
      }

      let effect, se, ciLo, ciHi;
      const cc = 0.5; // continuity correction

      if (type === 'OR') {
        const a = eventsTx + cc, b = nTx - eventsTx + cc;
        const c = eventsCtrl + cc, d = nCtrl - eventsCtrl + cc;
        const or = (a * d) / (b * c);
        se = Math.sqrt(1/a + 1/b + 1/c + 1/d);
        effect = or;
        ciLo = Math.exp(Math.log(or) - 1.96 * se);
        ciHi = Math.exp(Math.log(or) + 1.96 * se);
      } else if (type === 'RR') {
        const p1 = (eventsTx + cc) / (nTx + 2*cc);
        const p2 = (eventsCtrl + cc) / (nCtrl + 2*cc);
        const rr = p1 / p2;
        se = Math.sqrt((1 - p1) / (eventsTx + cc) + (1 - p2) / (eventsCtrl + cc));
        effect = rr;
        ciLo = Math.exp(Math.log(rr) - 1.96 * se);
        ciHi = Math.exp(Math.log(rr) + 1.96 * se);
      } else if (type === 'RD') {
        const p1 = eventsTx / nTx, p2 = eventsCtrl / nCtrl;
        effect = p1 - p2;
        se = Math.sqrt(p1 * (1 - p1) / nTx + p2 * (1 - p2) / nCtrl);
        ciLo = effect - 1.96 * se;
        ciHi = effect + 1.96 * se;
      }

      const resultsDiv = document.getElementById('effectResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Effect (${type}):</span><span class="value">${effect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">[${ciLo.toFixed(3)}, ${ciHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">SE${type === 'RD' ? '' : ' (log)'}:</span><span class="value">${se.toFixed(4)}</span></div>
      `;
    }

    // ============================================================
    // META-ANALYSIS CALCULATOR UI
    // ============================================================

    function addStudyRow() {
      const tbody = document.getElementById('studyTableBody');
      const rowCount = tbody.rows.length + 1;
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input type="text" value="Study ${rowCount}"></td>
        <td><input type="number" step="0.01" value="1.00"></td>
        <td><input type="number" step="0.01" value="0.80"></td>
        <td><input type="number" step="0.01" value="1.25"></td>
        <td><button class="btn-small" onclick="removeStudyRow(this)"></button></td>
      `;
      tbody.appendChild(row);
    }

    function removeStudyRow(btn) {
      const row = btn.closest('tr');
      row.remove();
    }

    function runMetaAnalysis() {
      const rows = document.getElementById('studyTableBody').rows;
      const studies = [];

      for (const row of rows) {
        const inputs = row.querySelectorAll('input');
        const label = inputs[0].value;
        const effect = parseFloat(inputs[1].value);
        const ciLo = parseFloat(inputs[2].value);
        const ciHi = parseFloat(inputs[3].value);

        if (!isNaN(effect) && !isNaN(ciLo) && !isNaN(ciHi)) {
          studies.push({ label, effect, ciLo, ciHi, isRatioMeasure: true });
        }
      }

      if (studies.length < 2) {
        alert('Need at least 2 studies');
        return;
      }

      const tau2Method = document.getElementById('tau2Method').value;
      const useHKSJ = document.getElementById('useHKSJ').checked;

      const result = calculateMetaAnalysis(studies, { tau2Estimator: tau2Method, useHKSJ });

      // Save for publication bias tools
      lastMetaStudies = studies;
      lastMetaResult = result;

      if (result.error) {
        alert(result.error);
        return;
      }

      // Display results
      const resultsDiv = document.getElementById('maResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Pooled Effect:</span><span class="value">${result.pooledEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">[${result.pooledCiLo.toFixed(3)}, ${result.pooledCiHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">p-value:</span><span class="value">${result.pValue < 0.001 ? '< 0.001' : result.pValue.toFixed(4)}</span></div>
        <div class="result-row"><span class="label">I:</span><span class="value">${result.i2.toFixed(1)}%</span></div>
        <div class="result-row"><span class="label"> (${result.tau2Method}):</span><span class="value">${result.tau2.toFixed(4)}</span></div>
        <div class="result-row"><span class="label">Q (p-value):</span><span class="value">${result.q.toFixed(2)} (${result.qPValue.toFixed(4)})</span></div>
        <div class="result-row"><span class="label">Test method:</span><span class="value">${result.testMethod}</span></div>
        ${result.predictionInterval ? `<div class="result-row"><span class="label">95% PI:</span><span class="value">[${result.predictionInterval.lo.toFixed(3)}, ${result.predictionInterval.hi.toFixed(3)}]</span></div>` : ''}
      `;

      // Generate forest plot
      const plotContainer = document.getElementById('forestPlotContainer');
      plotContainer.style.display = 'block';
      plotContainer.innerHTML = generateForestPlotHTML(studies, result);
    }

    // ============================================================
    // PICO BUILDER
    // ============================================================

    function _escHtml(s) {
      const d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }

    function generatePICO() {
      const p = _escHtml(document.getElementById('picoP').value);
      const i = _escHtml(document.getElementById('picoI').value);
      const c = _escHtml(document.getElementById('picoC').value);
      const o = _escHtml(document.getElementById('picoO').value);

      if (!p || !i || !o) {
        alert('Please fill Population, Intervention, and Outcome');
        return;
      }

      const question = `In ${p}, does ${i} compared to ${c || 'standard care'} improve ${o}?`;

      const output = document.getElementById('picoOutput');
      output.style.display = 'block';
      output.innerHTML = `
        <strong>Research Question:</strong><br>
        <em>${question}</em>
      `;
    }

    // ============================================================
    // KEYBOARD NAVIGATION  see enhanced handler below (near toggleKeyboardHelp)
    // ============================================================

    // ============================================================
    // PUBLICATION BIAS
    // ============================================================

    let lastMetaStudies = null;
    let lastMetaResult = null;

    // runMetaAnalysis now saves lastMetaStudies/lastMetaResult directly (merged from override)

    function calculateEggersTest(effects, ses) {
      const n = effects.length;
      if (n < 3) return { intercept: NaN, pValue: NaN, significant: false };
      const precision = ses.map(se => 1 / se);
      const standardizedEffects = effects.map((e, i) => e / ses[i]);
      const meanX = precision.reduce((a, b) => a + b, 0) / n;
      const meanY = standardizedEffects.reduce((a, b) => a + b, 0) / n;
      let ssXY = 0, ssXX = 0;
      for (let i = 0; i < n; i++) {
        ssXY += (precision[i] - meanX) * (standardizedEffects[i] - meanY);
        ssXX += (precision[i] - meanX) ** 2;
      }
      const slope = ssXX > 0 ? ssXY / ssXX : 0;
      const intercept = meanY - slope * meanX;
      let ssResid = 0;
      for (let i = 0; i < n; i++) {
        const predicted = intercept + slope * precision[i];
        ssResid += (standardizedEffects[i] - predicted) ** 2;
      }
      const residSE = Math.sqrt(ssResid / (n - 2));
      const interceptSE = residSE * Math.sqrt(1/n + meanX * meanX / ssXX);
      const tStat = intercept / interceptSE;
      const pValue = 2 * (1 - tCDF(Math.abs(tStat), n - 2));
      return { intercept, slope, tStat, pValue, significant: pValue < 0.1 };
    }

    function calculateBeggsTest(effects, ses) {
      const n = effects.length;
      if (n < 3) return { tau: NaN, pValue: NaN };
      const indices = effects.map((_, i) => i);
      const variances = ses.map(se => se * se);
      indices.sort((a, b) => variances[a] - variances[b]);
      const sortedEffects = indices.map(i => effects[i]);
      let concordant = 0, discordant = 0;
      for (let i = 0; i < n - 1; i++) {
        for (let j = i + 1; j < n; j++) {
          if (sortedEffects[j] > sortedEffects[i]) concordant++;
          else if (sortedEffects[j] < sortedEffects[i]) discordant++;
        }
      }
      const tau = (concordant - discordant) / (n * (n - 1) / 2);
      const se = Math.sqrt((2 * (2 * n + 5)) / (9 * n * (n - 1)));
      const z = tau / se;
      const pValue = 2 * (1 - normalCDF(Math.abs(z)));
      return { tau, z, pValue, significant: pValue < 0.1 };
    }

    function generateFunnelPlotHTML(effects, ses, pooledEffect) {
      const minEffect = Math.min(...effects) - 0.5;
      const maxEffect = Math.max(...effects) + 0.5;
      const maxSE = Math.max(...ses);
      const range = maxEffect - minEffect;

      const scaleX = (val) => ((val - minEffect) / range) * 300 + 25;
      const scaleY = (se) => (se / maxSE) * 180 + 20;

      const pooledX = scaleX(pooledEffect);

      return `
        <svg viewBox="0 0 350 220" style="width: 100%; height: 220px; font-family: 'Source Sans Pro', sans-serif;">
          <!-- Funnel shape -->
          <polygon points="${pooledX},20 ${scaleX(pooledEffect - 1.96 * maxSE)},200 ${scaleX(pooledEffect + 1.96 * maxSE)},200"
                   fill="rgba(30,39,97,0.1)" stroke="none"/>

          <!-- Axes -->
          <line x1="25" y1="200" x2="325" y2="200" stroke="#333" />
          <line x1="25" y1="20" x2="25" y2="200" stroke="#333" />

          <!-- Pooled effect line -->
          <line x1="${pooledX}" y1="20" x2="${pooledX}" y2="200" stroke="#D4AF37" stroke-width="2" stroke-dasharray="4" />

          <!-- Points -->
          ${effects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(ses[i])}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>
          `).join('')}

          <!-- Labels -->
          <text x="175" y="218" font-size="10" text-anchor="middle" fill="#666">Effect Size (log scale)</text>
          <text x="12" y="110" font-size="10" text-anchor="middle" fill="#666" transform="rotate(-90, 12, 110)">Standard Error</text>
          <text x="${pooledX}" y="15" font-size="8" text-anchor="middle" fill="#D4AF37">Pooled</text>
        </svg>
      `;
    }

    function runPublicationBias() {
      if (!lastMetaResult || !lastMetaStudies || lastMetaStudies.length < 3) {
        alert('Run meta-analysis first with at least 3 studies');
        return;
      }

      const effects = lastMetaResult.transformedEffects;
      const ses = lastMetaResult.ses;

      const egger = calculateEggersTest(effects, ses);
      const begg = calculateBeggsTest(effects, ses);

      document.getElementById('pubBiasResults').style.display = 'block';
      document.getElementById('eggerResults').innerHTML = `
        <div class="result-row"><span class="label">Egger's intercept:</span><span class="value">${egger.intercept.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Egger's p-value:</span><span class="value ${egger.significant ? 'red' : ''}">${egger.pValue.toFixed(4)} ${egger.significant ? '(Significant)' : ''}</span></div>
        <div class="result-row"><span class="label">Begg's tau:</span><span class="value">${begg.tau.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Begg's p-value:</span><span class="value ${begg.significant ? 'red' : ''}">${begg.pValue.toFixed(4)} ${begg.significant ? '(Significant)' : ''}</span></div>
        <div class="result-row"><span class="label">Interpretation:</span><span class="value">${egger.significant || begg.significant ? 'Possible small-study effects (publication bias is one explanation)' : 'No strong statistical evidence of asymmetry'}</span></div>
      `;

      const pooledLog = Math.log(lastMetaResult.pooledEffect);
      document.getElementById('funnelPlotContainer').innerHTML = generateFunnelPlotHTML(effects, ses, pooledLog);
    }

    // ============================================================
    // RISK OF BIAS 2.0
    // ============================================================

    function updateRoBOverall() {
      const domains = ['robD1', 'robD2', 'robD3', 'robD4', 'robD5'];
      const values = domains.map(id => document.getElementById(id).value);

      if (values.some(v => !v)) {
        document.getElementById('robOverall').innerHTML = '<span style="color: var(--light-text);">Complete all domains</span>';
        document.getElementById('robTrafficLight').innerHTML = '';
        return;
      }

      let overall;
      if (values.includes('high')) {
        overall = 'high';
      } else if (values.includes('some')) {
        overall = 'some';
      } else {
        overall = 'low';
      }

      const colors = { low: '#22c55e', some: '#f59e0b', high: '#C53030' };
      const labels = { low: 'Low Risk of Bias', some: 'Some Concerns', high: 'High Risk of Bias' };

      document.getElementById('robOverall').innerHTML = `
        <span style="color: ${colors[overall]};">${labels[overall]}</span>
      `;
      document.getElementById('robOverall').style.background = overall === 'low' ? 'rgba(34,197,94,0.1)' :
                                                                overall === 'some' ? 'rgba(245,158,11,0.1)' : 'rgba(197,48,48,0.1)';

      // Traffic light
      document.getElementById('robTrafficLight').innerHTML = `
        <div style="display: flex; gap: 0.25rem; justify-content: center; margin-top: 0.5rem;">
          ${domains.map((id, i) => {
            const val = values[i];
            return `<div style="width: 20px; height: 20px; border-radius: 50%; background: ${colors[val]};" title="D${i+1}: ${val}"></div>`;
          }).join('')}
        </div>
      `;
    }

    // ============================================================
    // GRADE ASSESSMENT
    // ============================================================

    function calculateGRADE() {
      const start = parseInt(document.getElementById('gradeStart').value);
      const rob = parseInt(document.getElementById('gradeRoB').value);
      const inconsistency = parseInt(document.getElementById('gradeInconsistency').value);
      const indirectness = parseInt(document.getElementById('gradeIndirectness').value);
      const imprecision = parseInt(document.getElementById('gradeImprecision').value);
      const pubBias = parseInt(document.getElementById('gradePubBias').value);

      const total = start + rob + inconsistency + indirectness + imprecision + pubBias;
      const finalScore = Math.max(1, Math.min(4, total));

      const levels = {
        4: { label: 'HIGH', color: '#22c55e', symbol: '', desc: 'Very confident the true effect is close to the estimate' },
        3: { label: 'MODERATE', color: '#3b82f6', symbol: '', desc: 'Moderately confident; true effect likely close to estimate' },
        2: { label: 'LOW', color: '#f59e0b', symbol: '', desc: 'Limited confidence; true effect may be substantially different' },
        1: { label: 'VERY LOW', color: '#C53030', symbol: '', desc: 'Very little confidence in the effect estimate' }
      };

      const level = levels[finalScore];

      document.getElementById('gradeResult').innerHTML = `
        <div style="text-align: center; padding: 1rem; background: rgba(${finalScore === 4 ? '34,197,94' : finalScore === 3 ? '59,130,246' : finalScore === 2 ? '245,158,11' : '197,48,48'},0.1); border-radius: 8px;">
          <div style="font-size: 1.5rem; letter-spacing: 0.2rem; color: ${level.color};">${level.symbol}</div>
          <div style="font-size: 1.1rem; font-weight: 700; color: ${level.color}; margin: 0.5rem 0;">${level.label}</div>
          <div style="font-size: 0.75rem; color: var(--light-text);">${level.desc}</div>
        </div>
        <div style="margin-top: 0.75rem; font-size: 0.75rem; color: var(--light-text);">
          Starting: ${start === 4 ? 'High (RCTs)' : 'Low (Observational)'}<br>
          Downgrades: ${Math.abs(rob + inconsistency + indirectness + imprecision + pubBias)} levels
        </div>
      `;
    }

    // ============================================================
    // HETEROGENEITY INTERPRETATION
    // ============================================================

    function interpretI2() {
      const i2 = parseFloat(document.getElementById('i2Input').value);

      if (isNaN(i2) || i2 < 0 || i2 > 100) {
        alert('Enter a valid I value between 0 and 100');
        return;
      }

      let interpretation, color, recommendation;

      if (i2 <= 25) {
        interpretation = 'Low heterogeneity';
        color = '#22c55e';
        recommendation = 'Fixed-effect model may be appropriate. Results are consistent across studies.';
      } else if (i2 <= 50) {
        interpretation = 'Moderate heterogeneity';
        color = '#3b82f6';
        recommendation = 'Consider random-effects model. Investigate potential sources of variation.';
      } else if (i2 <= 75) {
        interpretation = 'Substantial heterogeneity';
        color = '#f59e0b';
        recommendation = 'Use random-effects model. Subgroup analysis or meta-regression recommended. Consider whether pooling is appropriate.';
      } else {
        interpretation = 'Considerable heterogeneity';
        color = '#C53030';
        recommendation = 'Pooling may be inappropriate. Focus on understanding sources of heterogeneity before synthesizing. Report prediction interval.';
      }

      document.getElementById('i2Interpretation').innerHTML = `
        <div style="padding: 0.75rem; background: rgba(${i2 <= 25 ? '34,197,94' : i2 <= 50 ? '59,130,246' : i2 <= 75 ? '245,158,11' : '197,48,48'},0.1); border-radius: 6px; border-left: 3px solid ${color};">
          <div style="font-weight: 700; color: ${color}; margin-bottom: 0.25rem;">I = ${i2}%: ${interpretation}</div>
          <div style="font-size: 0.8rem; color: var(--text);">${recommendation}</div>
        </div>
      `;
    }

    // ============================================================
    // NNT/NNH CALCULATOR
    // ============================================================

    function calculateNNT() {
      const cer = parseFloat(document.getElementById('nntCER').value);
      const effectType = document.getElementById('nntEffectType').value;
      const effect = parseFloat(document.getElementById('nntEffect').value);
      const ciLo = parseFloat(document.getElementById('nntCILo').value);
      const ciHi = parseFloat(document.getElementById('nntCIHi').value);

      if (isNaN(cer) || isNaN(effect) || cer <= 0 || cer >= 1) {
        alert('Enter valid baseline risk (0 < CER < 1) and effect size');
        return;
      }

      let arr, arrLo, arrHi; // Absolute Risk Reduction

      if (effectType === 'RD') {
        arr = -effect; // RD is already absolute
        arrLo = -ciHi;
        arrHi = -ciLo;
      } else if (effectType === 'RR') {
        const eer = cer * effect;
        const eerLo = cer * ciLo;
        const eerHi = cer * ciHi;
        arr = cer - eer;
        arrLo = cer - eerHi;
        arrHi = cer - eerLo;
      } else { // OR
        const eer = (cer * effect) / (1 - cer + cer * effect);
        const eerLo = (cer * ciLo) / (1 - cer + cer * ciLo);
        const eerHi = (cer * ciHi) / (1 - cer + cer * ciHi);
        arr = cer - eer;
        arrLo = cer - eerHi;
        arrHi = cer - eerLo;
      }

      const nnt = arr !== 0 ? 1 / arr : Infinity;
      const nntLo = arrHi !== 0 ? 1 / arrHi : Infinity;
      const nntHi = arrLo !== 0 ? 1 / arrLo : Infinity;
      const ciCrossesNull = arrLo * arrHi < 0;

      const isBenefit = arr > 0;
      const label = isBenefit ? 'NNT (Benefit)' : 'NNH (Harm)';
      const color = isBenefit ? 'var(--green)' : 'var(--red)';

      let nntCiText;
      if (ciCrossesNull) {
        // Altman (1998) convention: NNTB X to  to NNTH Y
        const nntB = arrHi > 0 ? Math.abs(1 / arrHi).toFixed(1) : Math.abs(1 / arrLo).toFixed(1);
        const nntH = arrLo < 0 ? Math.abs(1 / arrLo).toFixed(1) : Math.abs(1 / arrHi).toFixed(1);
        nntCiText = `NNTB ${nntB} to \u221E to NNTH ${nntH}`;
      } else {
        nntCiText = `[${Math.abs(nntLo).toFixed(1)}, ${Math.abs(nntHi).toFixed(1)}]`;
      }

      const resultsDiv = document.getElementById('nntResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <div class="result-row"><span class="label">Baseline Risk (CER):</span><span class="value">${(cer * 100).toFixed(1)}%</span></div>
        <div class="result-row"><span class="label">Absolute Risk Reduction:</span><span class="value">${(arr * 100).toFixed(2)}%</span></div>
        <div class="result-row"><span class="label" style="color: ${color}; font-weight: 700;">${label}:</span><span class="value" style="color: ${color}; font-weight: 700;">${Math.abs(nnt).toFixed(1)}</span></div>
        <div class="result-row"><span class="label">95% CI:</span><span class="value">${nntCiText}</span></div>
        ${ciCrossesNull ? '<div style="margin-top: 0.5rem; padding: 0.4rem; background: rgba(234,179,8,0.15); border-radius: 4px; font-size: 0.7rem; color: var(--text);">CI crosses the null \u2014 effect may be beneficial or harmful</div>' : ''}
        <div style="margin-top: 0.75rem; padding: 0.5rem; background: rgba(${isBenefit ? '34,197,94' : '197,48,48'},0.1); border-radius: 4px; font-size: 0.75rem;">
          ${isBenefit
            ? `Treat <strong>${Math.ceil(Math.abs(nnt))}</strong> patients to prevent 1 event`
            : `Treat <strong>${Math.ceil(Math.abs(nnt))}</strong> patients before causing 1 harm`}
        </div>
      `;
    }

    // ============================================================
    // LEAVE-ONE-OUT SENSITIVITY ANALYSIS
    // ============================================================

    function runLeaveOneOut() {
      if (!lastMetaStudies || lastMetaStudies.length < 3) {
        alert('Run meta-analysis first with at least 3 studies');
        return;
      }

      const tau2Method = document.getElementById('tau2Method').value;
      const useHKSJ = document.getElementById('useHKSJ').checked;
      const results = [];

      // Run meta-analysis leaving out each study
      for (let i = 0; i < lastMetaStudies.length; i++) {
        const subset = lastMetaStudies.filter((_, idx) => idx !== i);
        const ma = calculateMetaAnalysis(subset, { tau2Estimator: tau2Method, useHKSJ });
        results.push({
          omitted: lastMetaStudies[i].label,
          effect: ma.pooledEffect,
          ciLo: ma.pooledCiLo,
          ciHi: ma.pooledCiHi,
          i2: ma.i2,
          pValue: ma.pValue
        });
      }

      // Find most influential study
      const originalEffect = lastMetaResult.pooledEffect;
      let maxChange = 0;
      let mostInfluential = '';
      results.forEach(r => {
        const change = (lastMetaResult.isRatio !== false && r.effect > 0 && originalEffect > 0)
          ? Math.abs(Math.log(r.effect) - Math.log(originalEffect))
          : Math.abs(r.effect - originalEffect);
        if (change > maxChange) {
          maxChange = change;
          mostInfluential = r.omitted;
        }
      });

      // Check if any exclusion changes significance
      const originalSig = lastMetaResult.pValue < 0.05;
      const sensitivityIssue = results.some(r => (r.pValue < 0.05) !== originalSig);

      document.getElementById('looResults').style.display = 'block';
      document.getElementById('looSummary').innerHTML = `
        <div class="result-row"><span class="label">Original pooled effect:</span><span class="value">${originalEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Most influential study:</span><span class="value">${_escHtml(mostInfluential)}</span></div>
        <div class="result-row"><span class="label">Sensitivity concern:</span><span class="value ${sensitivityIssue ? 'red' : ''}">${sensitivityIssue ? 'Yes - significance changes' : 'No - results robust'}</span></div>
        <div style="margin-top: 0.5rem; font-size: 0.7rem; color: var(--light-text);">
          ${results.map(r => `Omit ${_escHtml(r.omitted)}: ${r.effect.toFixed(3)} [${r.ciLo.toFixed(3)}, ${r.ciHi.toFixed(3)}] I=${r.i2.toFixed(0)}%`).join('<br>')}
        </div>
      `;

      // Generate LOO forest plot
      document.getElementById('looPlotContainer').innerHTML = generateLOOPlotHTML(results, lastMetaResult);
    }

    function generateLOOPlotHTML(looResults, originalMeta) {
      const allEffects = [...looResults.map(r => r.effect), originalMeta.pooledEffect];
      const allLo = [...looResults.map(r => r.ciLo), originalMeta.pooledCiLo];
      const allHi = [...looResults.map(r => r.ciHi), originalMeta.pooledCiHi];

      const minEffect = Math.min(...allLo, 0.5);
      const maxEffect = Math.max(...allHi, 2.0);
      const range = maxEffect - minEffect;

      const scale = (val) => ((val - minEffect) / range) * 280 + 80;
      const height = (looResults.length + 2) * 22 + 30;

      return `
        <svg viewBox="0 0 500 ${height}" style="width: 100%; height: ${height}px; font-family: 'Source Sans Pro', sans-serif;">
          <line x1="${scale(1)}" y1="10" x2="${scale(1)}" y2="${height - 20}" stroke="#ddd" stroke-width="1" stroke-dasharray="3" />
          <text x="40" y="15" font-size="8" fill="#666" font-weight="600">Omitting:</text>
          ${looResults.map((r, i) => {
            const y = 25 + i * 22;
            return `
              <text x="5" y="${y + 3}" font-size="8" fill="#333">${_escHtml(r.omitted)}</text>
              <line x1="${scale(r.ciLo)}" y1="${y}" x2="${scale(r.ciHi)}" y2="${y}" stroke="#1E2761" stroke-width="1" />
              <circle cx="${scale(r.effect)}" cy="${y}" r="4" fill="#1E2761" />
              <text x="380" y="${y + 3}" font-size="7" fill="#333">${r.effect.toFixed(2)} [${r.ciLo.toFixed(2)}, ${r.ciHi.toFixed(2)}]</text>
            `;
          }).join('')}
          <line x1="${scale(originalMeta.pooledCiLo)}" y1="${height - 25}" x2="${scale(originalMeta.pooledCiHi)}" y2="${height - 25}" stroke="#D4AF37" stroke-width="2" />
          <polygon points="${scale(originalMeta.pooledEffect)},${height - 30} ${scale(originalMeta.pooledEffect) - 5},${height - 25} ${scale(originalMeta.pooledEffect)},${height - 20} ${scale(originalMeta.pooledEffect) + 5},${height - 25}" fill="#D4AF37" />
          <text x="5" y="${height - 22}" font-size="8" font-weight="bold" fill="#D4AF37">All studies</text>
          <text x="380" y="${height - 22}" font-size="7" font-weight="bold" fill="#333">${originalMeta.pooledEffect.toFixed(2)} [${originalMeta.pooledCiLo.toFixed(2)}, ${originalMeta.pooledCiHi.toFixed(2)}]</text>
        </svg>
      `;
    }

    // ============================================================
    // TRIM-AND-FILL
    // ============================================================

    function runTrimAndFill() {
      if (!lastMetaResult || !lastMetaStudies || lastMetaStudies.length < 3) {
        alert('Run meta-analysis first with at least 3 studies');
        return;
      }

      const estimator = document.getElementById('trimFillEstimator').value;
      const side = document.getElementById('trimFillSide').value;

      const effects = [...lastMetaResult.transformedEffects];
      const ses = [...lastMetaResult.ses];
      const k = effects.length;

      // Get initial pooled estimate
      const weights = ses.map(se => 1 / (se * se));
      const sumW = weights.reduce((a, b) => a + b, 0);
      let theta = effects.reduce((sum, e, i) => sum + e * weights[i], 0) / sumW;

      // Calculate ranks of |yi - theta| for each study
      const deviations = effects.map((e, i) => ({
        idx: i,
        dev: e - theta,
        absDev: Math.abs(e - theta),
        se: ses[i]
      }));

      // Sort by absolute deviation
      deviations.sort((a, b) => a.absDev - b.absDev);
      const ranks = deviations.map((d, i) => ({ ...d, rank: i + 1 }));

      // Count studies on the specified side
      let n0;
      if (estimator === 'L0') {
        // Linear estimator
        const T = ranks.reduce((sum, r) => {
          const onSide = (side === 'right' && r.dev > 0) || (side === 'left' && r.dev < 0);
          return sum + (onSide ? r.rank : 0);
        }, 0);
        n0 = Math.max(0, Math.round((4 * T - k * (k + 1)) / (2 * k - 1)));
      } else {
        // R0 rank-based estimator
        const gamma = ranks.reduce((sum, r) => {
          const onSide = (side === 'right' && r.dev > 0) || (side === 'left' && r.dev < 0);
          return sum + (onSide ? 1 : 0);
        }, 0);
        n0 = Math.max(0, Math.round((4 * gamma - k + 1) / 3));
      }

      const nFilled = Math.round(n0);

      // Impute missing studies by reflecting the most extreme ones
      const sortedBySide = [...ranks].sort((a, b) => {
        if (side === 'right') return b.dev - a.dev;
        return a.dev - b.dev;
      });

      const imputedEffects = [...effects];
      const imputedSEs = [...ses];
      const imputedLabels = lastMetaStudies.map(s => s.label);

      for (let i = 0; i < nFilled && i < sortedBySide.length; i++) {
        const study = sortedBySide[i];
        const mirroredEffect = 2 * theta - study.dev - theta; // = -study.dev relative to theta
        imputedEffects.push(2 * theta - effects[study.idx]);
        imputedSEs.push(ses[study.idx]);
        imputedLabels.push(`[Imputed ${i + 1}]`);
      }

      // Recalculate pooled effect with imputed studies
      const newWeights = imputedSEs.map(se => 1 / (se * se));
      const newSumW = newWeights.reduce((a, b) => a + b, 0);
      const adjustedTheta = imputedEffects.reduce((sum, e, i) => sum + e * newWeights[i], 0) / newSumW;
      const adjustedSE = Math.sqrt(1 / newSumW);

      const isRatio = lastMetaResult.isRatio;
      const tfZCrit = normalQuantile(1 - (1 - (lastMetaResult.confidenceLevel || 0.95)) / 2);
      const adjustedEffect = isRatio ? Math.exp(adjustedTheta) : adjustedTheta;
      const adjustedCILo = isRatio ? Math.exp(adjustedTheta - tfZCrit * adjustedSE) : adjustedTheta - tfZCrit * adjustedSE;
      const adjustedCIHi = isRatio ? Math.exp(adjustedTheta + tfZCrit * adjustedSE) : adjustedTheta + tfZCrit * adjustedSE;

      const originalEffect = lastMetaResult.pooledEffect;
      const changePercent = ((adjustedEffect - originalEffect) / originalEffect * 100).toFixed(1);

      document.getElementById('trimFillResults').style.display = 'block';
      document.getElementById('trimFillSummary').innerHTML = `
        <div class="result-row"><span class="label">Studies imputed:</span><span class="value">${nFilled}</span></div>
        <div class="result-row"><span class="label">Original effect:</span><span class="value">${originalEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Adjusted effect:</span><span class="value ${nFilled > 0 ? 'red' : ''}">${adjustedEffect.toFixed(3)}</span></div>
        <div class="result-row"><span class="label">Adjusted ${Math.round((lastMetaResult.confidenceLevel || 0.95) * 100)}% CI:</span><span class="value">[${adjustedCILo.toFixed(3)}, ${adjustedCIHi.toFixed(3)}]</span></div>
        <div class="result-row"><span class="label">Change:</span><span class="value">${changePercent}%</span></div>
        ${nFilled > 0 ? `
          <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(197,48,48,0.1); border-radius: 4px; font-size: 0.75rem;">
            <strong>Caution:</strong> ${nFilled} potentially missing studies imputed.
            Treat this as sensitivity analysis, not correction; assumptions may not hold under severe asymmetry.
          </div>
        ` : `
          <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(34,197,94,0.1); border-radius: 4px; font-size: 0.75rem;">
            No missing studies detected on the ${side} side.
          </div>
        `}
      `;

      // Generate filled funnel plot
      document.getElementById('trimFillPlotContainer').innerHTML = generateFilledFunnelHTML(
        lastMetaResult.transformedEffects,
        lastMetaResult.ses,
        imputedEffects.slice(k),
        imputedSEs.slice(k),
        adjustedTheta,
        Math.log(originalEffect)
      );
    }

    function generateFilledFunnelHTML(origEffects, origSEs, impEffects, impSEs, adjustedTheta, originalTheta) {
      const allEffects = [...origEffects, ...impEffects];
      const allSEs = [...origSEs, ...impSEs];

      const minEffect = Math.min(...allEffects) - 0.5;
      const maxEffect = Math.max(...allEffects) + 0.5;
      const maxSE = Math.max(...allSEs);
      const range = maxEffect - minEffect;

      const scaleX = (val) => ((val - minEffect) / range) * 280 + 35;
      const scaleY = (se) => (se / maxSE) * 160 + 20;

      return `
        <svg viewBox="0 0 350 200" style="width: 100%; height: 200px; font-family: 'Source Sans Pro', sans-serif;">
          <!-- Original funnel -->
          <polygon points="${scaleX(originalTheta)},20 ${scaleX(originalTheta - 1.96 * maxSE)},180 ${scaleX(originalTheta + 1.96 * maxSE)},180"
                   fill="rgba(30,39,97,0.05)" stroke="rgba(30,39,97,0.3)" stroke-dasharray="3"/>
          <!-- Adjusted funnel -->
          <polygon points="${scaleX(adjustedTheta)},20 ${scaleX(adjustedTheta - 1.96 * maxSE)},180 ${scaleX(adjustedTheta + 1.96 * maxSE)},180"
                   fill="rgba(212,175,55,0.1)" stroke="#D4AF37"/>

          <!-- Original effect line -->
          <line x1="${scaleX(originalTheta)}" y1="20" x2="${scaleX(originalTheta)}" y2="180" stroke="#1E2761" stroke-width="1" stroke-dasharray="4" />
          <!-- Adjusted effect line -->
          <line x1="${scaleX(adjustedTheta)}" y1="20" x2="${scaleX(adjustedTheta)}" y2="180" stroke="#D4AF37" stroke-width="2" />

          <!-- Original studies -->
          ${origEffects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(origSEs[i])}" r="5" fill="#1E2761" stroke="white" stroke-width="1"/>
          `).join('')}

          <!-- Imputed studies -->
          ${impEffects.map((e, i) => `
            <circle cx="${scaleX(e)}" cy="${scaleY(impSEs[i])}" r="5" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="2"/>
          `).join('')}

          <!-- Legend -->
          <circle cx="280" cy="15" r="4" fill="#1E2761"/>
          <text x="290" y="18" font-size="7" fill="#666">Original</text>
          <circle cx="280" cy="28" r="4" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="2"/>
          <text x="290" y="31" font-size="7" fill="#666">Imputed</text>

          <text x="175" y="198" font-size="9" text-anchor="middle" fill="#666">Effect Size (log scale)</text>
        </svg>
      `;
    }

    // ============================================================
    // GAMIFICATION & PROGRESS SYSTEM
    // ============================================================

    const STORAGE_KEY = 'evidence_reversal_course_progress';

    // Seven Principles for tracking
    const sevenPrinciples = [
      "Not every signal is truth.",
      "Methods protect patients from our confidence.",
      "What was hidden in plain sight?",
      "The number without provenance is not a number.",
      "Heterogeneity is a message, not noise.",
      "Absence of evidence is not evidence of absence.",
      "Certainty must be earned, not assumed."
    ];

    // Badge definitions
    const badges = [
      { id: 'first_module', icon: '', name: 'First Steps', desc: 'Complete your first module' },
      { id: 'predictor', icon: '', name: 'Predictor', desc: 'Make your first prediction' },
      { id: 'correct_prediction', icon: '', name: 'Sharp Mind', desc: 'Predict correctly' },
      { id: 'five_modules', icon: '', name: 'Scholar', desc: 'Complete 5 modules' },
      { id: 'all_predictions', icon: '', name: 'Oracle', desc: 'Make all predictions' },
      { id: 'streak_3', icon: '', name: 'On Fire', desc: '3-day streak' },
      { id: 'quiz_master', icon: '', name: 'Quiz Master', desc: 'Complete 5 quizzes' },
      { id: 'ready_practice', icon: '', name: 'Ready for Practice', desc: 'Complete the Capstone module' },
      { id: 'completionist', icon: '', name: 'Completionist', desc: 'Finish all modules' }
    ];

    // Level definitions
    const levels = [
      { name: 'Novice', minPoints: 0 },
      { name: 'Apprentice', minPoints: 200 },
      { name: 'Practitioner', minPoints: 500 },
      { name: 'Expert', minPoints: 1000 },
      { name: 'Master', minPoints: 2000 }
    ];

    // Gamification state
    let gameState = {
      points: 0,
      earnedBadges: [],
      streak: 0,
      lastVisitDate: null,
      principlesMastered: [],
      quizzesCompleted: 0
    };

    function getLevel(points) {
      for (let i = levels.length - 1; i >= 0; i--) {
        if (points >= levels[i].minPoints) return { level: i + 1, name: levels[i].name };
      }
      return { level: 1, name: 'Novice' };
    }

    function awardPoints(amount, reason) {
      gameState.points += amount;
      updateSidebarPoints();
      saveProgress();
    }

    function earnBadge(badgeId) {
      if (!gameState.earnedBadges.includes(badgeId)) {
        gameState.earnedBadges.push(badgeId);
        saveProgress();
      }
    }

    function checkBadges() {
      const completedModules = document.querySelectorAll('.module-item.completed').length;
      const predictionCount = Object.keys(storyPredictions).length;
      const correctPredictions = Object.values(storyPredictions).filter(p => p.correct).length;

      if (completedModules >= 1) earnBadge('first_module');
      if (completedModules >= 5) earnBadge('five_modules');
      if (completedModules >= 23) earnBadge('ready_practice');
      if (completedModules >= 15) earnBadge('completionist');
      if (predictionCount >= 1) earnBadge('predictor');
      if (correctPredictions >= 1) earnBadge('correct_prediction');
      if (predictionCount >= 11) earnBadge('all_predictions');
      if (gameState.streak >= 3) earnBadge('streak_3');
      if (gameState.quizzesCompleted >= 5) earnBadge('quiz_master');
    }

    function updateStreak() {
      const today = new Date().toDateString();
      if (gameState.lastVisitDate) {
        const lastVisit = new Date(gameState.lastVisitDate).toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        if (lastVisit === today) { /* Same day */ }
        else if (lastVisit === yesterday) { gameState.streak++; awardPoints(10, 'Daily streak'); }
        else { gameState.streak = 1; }
      } else { gameState.streak = 1; }
      gameState.lastVisitDate = new Date().toISOString();
    }

    function saveProgress() {
      const completedModules = [];
      document.querySelectorAll('.module-item.completed').forEach(el => {
        completedModules.push(parseInt(el.dataset.module));
      });

      const progress = {
        currentModule, currentSlide, completedModules,
        lastVisit: new Date().toISOString(),
        gameState: gameState,
        predictions: storyPredictions,
        spacedRepetition: spacedRepetitionState,
        scenarioState: scenarioState,
        calibrationState: calibrationState
      };

      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        updateSidebarPoints();
      } catch (e) { console.log('Could not save progress'); }
    }

    function loadProgress() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          const progress = JSON.parse(saved);
          // Migrate old module IDs: 1323, 1424 (one-time)
          if (!progress._migrated25) {
            const remap = {13: 23, 14: 24};
            progress.completedModules = progress.completedModules.map(id => remap[id] || id);
            if (remap[progress.currentModule]) progress.currentModule = remap[progress.currentModule];
            progress._migrated25 = true;
            try { localStorage.setItem(STORAGE_KEY, JSON.stringify(progress)); } catch(e) {}
          }
          progress.completedModules.forEach(moduleId => {
            const el = document.querySelector(`.module-item[data-module="${moduleId}"]`);
            if (el) el.classList.add('completed');
          });
          if (progress.gameState) gameState = progress.gameState;
          if (progress.predictions) Object.assign(storyPredictions, progress.predictions);
          if (progress.spacedRepetition) {
            spacedRepetitionState = progress.spacedRepetition;
          }
          if (progress.scenarioState) {
            scenarioState = progress.scenarioState;
          }
          if (progress.calibrationState) {
            calibrationState = progress.calibrationState;
          }
          updateStreak();
          updateSidebarPoints();
          if (progress.currentModule !== undefined) {
            return { module: progress.currentModule, slide: progress.currentSlide || 0 };
          }
        }
      } catch (e) { console.log('Could not load progress'); }
      return null;
    }

    function resetProgress() {
      if (confirm('Reset all progress including points and badges?')) {
        try {
          localStorage.removeItem(STORAGE_KEY);
          document.querySelectorAll('.module-item.completed').forEach(el => el.classList.remove('completed'));
          gameState = { points: 0, earnedBadges: [], streak: 0, lastVisitDate: null, principlesMastered: [], quizzesCompleted: 0 };
          storyPredictions = {};
          spacedRepetitionState = { principles: {}, lastDailyReview: null, dailyReviewsCompleted: 0 };
          scenarioState = { completed: {}, scores: {} };
          calibrationState = { predictions: [], totalPredictions: 0, calibrationScore: null };
          updateSidebarPoints();
          updateReviewButtonStatus();
          goToModule(0);
          alert('Progress reset successfully.');
        } catch (e) { console.log('Could not reset progress'); }
      }
    }

    function markModuleComplete(moduleId) {
      const el = document.querySelector(`.module-item[data-module="${moduleId}"]`);
      if (el && !el.classList.contains('completed')) {
        el.classList.add('completed');
        awardPoints(100, 'Module completed');
        checkBadges();
      }
      saveProgress();
    }

    function updateSidebarPoints() {
      const el = document.getElementById('sidebarPoints');
      if (el) el.textContent = gameState.points + ' pts';
    }

    // ============================================================
    // PROGRESS DASHBOARD
    // ============================================================

    function openDashboard() {
      updateDashboardDisplay();
      document.getElementById('progressDashboard').classList.add('open');
    }

    function closeDashboard() {
      document.getElementById('progressDashboard').classList.remove('open');
    }

    function updateDashboardDisplay() {
      const levelInfo = getLevel(gameState.points);
      document.getElementById('levelBadge').textContent = `Level ${levelInfo.level}: ${levelInfo.name}`;
      document.getElementById('totalPoints').textContent = gameState.points;

      const completedModules = document.querySelectorAll('.module-item.completed').length;
      document.getElementById('modulesCompleted').textContent = `${completedModules}/${modules.length}`;

      const predictionCount = Object.keys(storyPredictions).length;
      const correctPredictions = Object.values(storyPredictions).filter(p => p.correct).length;
      document.getElementById('predictionsCorrect').textContent = `${correctPredictions}/${predictionCount}`;
      document.getElementById('quizzesCompleted').textContent = gameState.quizzesCompleted;

      const principlesHtml = sevenPrinciples.map((p, i) => {
        const mastered = gameState.principlesMastered.includes(i);
        return `<div class="principle-item">
          <div class="principle-num ${mastered ? 'mastered' : ''}">${i + 1}</div>
          <div class="principle-text">"${p}"</div>
          <span>${mastered ? '' : ''}</span>
        </div>`;
      }).join('');
      document.getElementById('principlesList').innerHTML = principlesHtml;

      const badgesHtml = badges.map(b => {
        const earned = gameState.earnedBadges.includes(b.id);
        return `<div class="badge ${earned ? 'earned' : ''}" title="${b.name}: ${b.desc}">
          ${b.icon}<div class="badge-tooltip">${b.name}</div>
        </div>`;
      }).join('');
      document.getElementById('badgesGrid').innerHTML = badgesHtml;

      document.getElementById('streakCount').textContent = `${gameState.streak} day${gameState.streak !== 1 ? 's' : ''}`;
      document.getElementById('streakFlame').textContent = gameState.streak >= 3 ? '' : '';
    }

    // ============================================================
    // SPACED REPETITION ENGINE
    // ============================================================

    // Questions for each principle (used in daily review)
    const principleQuestions = [
      { // Principle 1: "Not every signal is truth."
        principle: 0,
        question: "When a drug shows benefits in observational studies, what should you remember?",
        options: [
          "The benefit is probably real and should guide treatment",
          "Not every signal is truth - RCTs are needed to confirm",
          "Observational studies are always biased and useless",
          "We should immediately conduct a meta-analysis"
        ],
        correct: 1,
        explanation: "Observational signals can be confounded. CAST showed that antiarrhythmics, which appeared beneficial, actually tripled mortality in RCTs."
      },
      { // Principle 2: "Methods protect patients from our confidence."
        principle: 1,
        question: "Why do we pre-register protocols before conducting a meta-analysis?",
        options: [
          "To impress journal editors",
          "Methods protect patients from our confidence",
          "It's required by law in most countries",
          "To speed up the publication process"
        ],
        correct: 1,
        explanation: "Pre-registration prevents us from unconsciously biasing results toward what we expect. HRT observational studies were affected by healthy user bias."
      },
      { // Principle 3: "What was hidden in plain sight?"
        principle: 2,
        question: "When evaluating publication bias, what question should guide your thinking?",
        options: [
          "Are the authors reputable?",
          "Is the journal high impact?",
          "What was hidden in plain sight?",
          "How many studies were included?"
        ],
        correct: 2,
        explanation: "Rosiglitazone's cardiac risks were buried in unpublished FDA data. Always search beyond published literature for the complete picture."
      },
      { // Principle 4: "The number without provenance is not a number."
        principle: 3,
        question: "What makes an effect size trustworthy in meta-analysis?",
        options: [
          "Its statistical significance (p < 0.05)",
          "Clear provenance - knowing exactly where it came from",
          "Publication in a high-impact journal",
          "Agreement with biological plausibility"
        ],
        correct: 1,
        explanation: "DECREASE trials showed fabricated data. Without verifiable provenance (raw data, audit trail), numbers cannot be trusted."
      },
      { // Principle 5: "Heterogeneity is a message, not noise."
        principle: 4,
        question: "When you see high heterogeneity (I = 80%) in a meta-analysis, what should you think?",
        options: [
          "The meta-analysis has failed and should be abandoned",
          "Use a random-effects model and ignore it",
          "Heterogeneity is a message - investigate its sources",
          "Average the results anyway, that's what meta-analysis does"
        ],
        correct: 2,
        explanation: "ACCORD showed that intensive glucose control had different effects in different patient subgroups. High I signals important effect modification."
      },
      { // Principle 6: "Absence of evidence is not evidence of absence."
        principle: 5,
        question: "A meta-analysis of 3 small trials shows no significant effect (p = 0.15). What does this mean?",
        options: [
          "The treatment definitely doesn't work",
          "Absence of evidence is not evidence of absence",
          "We need exactly 5 more trials to be sure",
          "The treatment is harmful"
        ],
        correct: 1,
        explanation: "Small studies may lack power to detect real effects. Early surfactant trials initially showed 'no effect' due to small samples, but larger studies proved benefit."
      },
      { // Principle 7: "Certainty must be earned, not assumed."
        principle: 6,
        question: "What does the GRADE framework help us assess?",
        options: [
          "Whether a treatment is cost-effective",
          "How certain we can be in the evidence",
          "Whether authors have conflicts of interest",
          "The optimal sample size for future trials"
        ],
        correct: 1,
        explanation: "GRADE reminds us that certainty must be earned through high-quality evidence, not assumed from statistical significance alone."
      }
    ];

    // Extended question bank for variety
    const extendedQuestions = [
      { principle: 0, question: "The CAST trial showed antiarrhythmics increased mortality by:", options: ["50%", "100%", "200-300%", "400%"], correct: 2, explanation: "Encainide, flecainide, and moricizine roughly tripled mortality compared to placebo." },
      { principle: 1, question: "HRT appeared beneficial in observational studies due to:", options: ["Confounding by indication", "Healthy user bias", "Publication bias", "Data fabrication"], correct: 1, explanation: "Women who chose HRT were healthier at baseline (healthy user bias), creating an apparent benefit." },
      { principle: 2, question: "What percentage of negative trials often go unpublished?", options: ["10-20%", "30-40%", "40-50%", "60-80%"], correct: 2, explanation: "Studies estimate 40-50% of trials with negative results remain unpublished, distorting the evidence base." },
      { principle: 3, question: "The DECREASE trials fraud was detected through:", options: ["Peer review", "Statistical impossibilities", "Journal retraction", "Patient complaints"], correct: 1, explanation: "Patterns in the data were statistically impossible - too perfect, revealing fabrication." },
      { principle: 4, question: "What I value suggests substantial heterogeneity?", options: [">25%", ">50%", ">75%", ">90%"], correct: 1, explanation: "I > 50% suggests substantial heterogeneity; > 75% is considerable. Always investigate sources." },
      { principle: 5, question: "A funnel plot shows asymmetry. This suggests:", options: ["Perfect methodology", "Large sample sizes", "Possible small-study effects", "High certainty"], correct: 2, explanation: "Funnel plot asymmetry can indicate small-study effects; publication bias is one explanation, but not the only one." },
      { principle: 6, question: "In GRADE, what can LOWER certainty in RCT evidence?", options: ["Large effect size", "Risk of bias", "Dose-response gradient", "Biological plausibility"], correct: 1, explanation: "Risk of bias, imprecision, inconsistency, indirectness, and publication bias can lower certainty from 'high' to lower levels." }
    ];

    // SM-2 inspired spaced repetition state
    let spacedRepetitionState = {
      principles: {}, // { 0: { lastReview: Date, interval: days, easeFactor: 2.5, repetitions: 0, nextReview: Date } }
      lastDailyReview: null,
      dailyReviewsCompleted: 0
    };

    // Initialize spaced repetition for all principles
    function initSpacedRepetition() {
      for (let i = 0; i < 7; i++) {
        if (!spacedRepetitionState.principles[i]) {
          spacedRepetitionState.principles[i] = {
            lastReview: null,
            interval: 1,
            easeFactor: 2.5,
            repetitions: 0,
            nextReview: new Date().toISOString()
          };
        }
      }
    }

    // SM-2 algorithm: update interval based on performance
    function updateSpacedRepetition(principleIndex, quality) {
      // quality: 0-5 (0-2 = fail, 3-5 = pass)
      const p = spacedRepetitionState.principles[principleIndex];
      if (!p) return;

      if (quality >= 3) {
        // Correct answer
        if (p.repetitions === 0) {
          p.interval = 1;
        } else if (p.repetitions === 1) {
          p.interval = 6;
        } else {
          p.interval = Math.round(p.interval * p.easeFactor);
        }
        p.repetitions++;
        p.easeFactor = Math.max(1.3, p.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02)));

        // Mark as mastered after 3 successful reviews
        if (p.repetitions >= 3 && !gameState.principlesMastered.includes(principleIndex)) {
          gameState.principlesMastered.push(principleIndex);
          awardPoints(50, 'Principle mastered');
          earnBadge('principle_master');
        }
      } else {
        // Incorrect answer - reset
        p.repetitions = 0;
        p.interval = 1;
      }

      p.lastReview = new Date().toISOString();
      p.nextReview = new Date(Date.now() + p.interval * 24 * 60 * 60 * 1000).toISOString();
      saveProgress();
    }

    // Get principles due for review (sorted by urgency)
    function getPrinciplesDueForReview() {
      const now = new Date();
      const due = [];

      for (let i = 0; i < 7; i++) {
        const p = spacedRepetitionState.principles[i];
        if (!p) continue;

        const nextReview = p.nextReview ? new Date(p.nextReview) : new Date(0);
        if (nextReview <= now) {
          due.push({
            index: i,
            overdueDays: Math.floor((now - nextReview) / (24 * 60 * 60 * 1000)),
            repetitions: p.repetitions
          });
        }
      }

      // Sort: most overdue first, then least practiced
      due.sort((a, b) => {
        if (b.overdueDays !== a.overdueDays) return b.overdueDays - a.overdueDays;
        return a.repetitions - b.repetitions;
      });

      return due;
    }

    // ============================================================
    // DAILY REVIEW SYSTEM
    // ============================================================

    let reviewState = {
      active: false,
      questions: [],
      currentIndex: 0,
      answers: [],
      timerInterval: null,
      timeRemaining: 120 // 2 minutes in seconds
    };

    function shouldShowDailyReview() {
      if (!spacedRepetitionState.lastDailyReview) return true;

      const lastReview = new Date(spacedRepetitionState.lastDailyReview);
      const today = new Date();

      // Check if it's a new day
      return lastReview.toDateString() !== today.toDateString();
    }

    function openDailyReview() {
      initSpacedRepetition();

      // Get principles due for review
      const duePrinciples = getPrinciplesDueForReview();

      // Select up to 5 questions (mix of due principles and random for variety)
      let selectedQuestions = [];

      // First, add questions for due principles
      duePrinciples.slice(0, 3).forEach(dp => {
        const available = [principleQuestions[dp.index], ...extendedQuestions.filter(q => q.principle === dp.index)];
        const randomQ = available[Math.floor(Math.random() * available.length)];
        if (randomQ && !selectedQuestions.find(q => q.question === randomQ.question)) {
          selectedQuestions.push({ ...randomQ });
        }
      });

      // Fill remaining with random questions
      const allQuestions = [...principleQuestions, ...extendedQuestions];
      while (selectedQuestions.length < 5) {
        const randomQ = allQuestions[Math.floor(Math.random() * allQuestions.length)];
        if (!selectedQuestions.find(q => q.question === randomQ.question)) {
          selectedQuestions.push({ ...randomQ });
        }
      }

      // Shuffle
      selectedQuestions.sort(() => Math.random() - 0.5);

      // Initialize review state
      reviewState = {
        active: true,
        questions: selectedQuestions.slice(0, 5),
        currentIndex: 0,
        answers: [],
        timerInterval: null,
        timeRemaining: 120
      };

      // Show modal
      document.getElementById('dailyReviewModal').classList.add('open');

      // Render progress dots
      renderReviewProgress();

      // Render first question
      renderReviewQuestion();

      // Start timer
      startReviewTimer();
    }

    function closeDailyReview() {
      reviewState.active = false;
      if (reviewState.timerInterval) {
        clearInterval(reviewState.timerInterval);
      }
      document.getElementById('dailyReviewModal').classList.remove('open');
    }

    function skipDailyReview() {
      spacedRepetitionState.lastDailyReview = new Date().toISOString();
      saveProgress();
      closeDailyReview();
      updateReviewButtonStatus();
    }

    function startReviewTimer() {
      const timerEl = document.getElementById('reviewTimer');

      reviewState.timerInterval = setInterval(() => {
        reviewState.timeRemaining--;

        const mins = Math.floor(reviewState.timeRemaining / 60);
        const secs = reviewState.timeRemaining % 60;
        timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;

        if (reviewState.timeRemaining <= 0) {
          clearInterval(reviewState.timerInterval);
          finishDailyReview();
        }
      }, 1000);
    }

    function renderReviewProgress() {
      const container = document.getElementById('reviewProgress');
      container.innerHTML = reviewState.questions.map((_, i) => {
        let cls = 'progress-dot';
        if (i < reviewState.currentIndex) cls += ' completed';
        if (i === reviewState.currentIndex) cls += ' current';
        return `<div class="${cls}"></div>`;
      }).join('');
    }

    function renderReviewQuestion() {
      if (reviewState.currentIndex >= reviewState.questions.length) {
        finishDailyReview();
        return;
      }

      const q = reviewState.questions[reviewState.currentIndex];
      const container = document.getElementById('reviewCardContainer');

      container.innerHTML = `
        <div class="review-card">
          <div class="review-principle-num">${q.principle + 1}</div>
          <div class="review-principle-text">"${sevenPrinciples[q.principle]}"</div>
          <div class="review-question">${q.question}</div>
          <div class="review-options">
            ${q.options.map((opt, i) => `
              <button class="review-option" onclick="selectReviewAnswer(${i})">${opt}</button>
            `).join('')}
          </div>
          <div id="reviewFeedback"></div>
        </div>
      `;

      document.getElementById('reviewNextBtn').disabled = true;
    }

    function selectReviewAnswer(answerIndex) {
      const q = reviewState.questions[reviewState.currentIndex];
      const isCorrect = answerIndex === q.correct;

      // Store answer
      reviewState.answers.push({
        principle: q.principle,
        correct: isCorrect,
        selected: answerIndex
      });

      // Update spaced repetition
      updateSpacedRepetition(q.principle, isCorrect ? 4 : 1);

      // Award points
      if (isCorrect) {
        awardPoints(15, 'Daily review correct');
      }

      // Visual feedback
      const options = document.querySelectorAll('.review-option');
      options.forEach((opt, i) => {
        opt.disabled = true;
        opt.style.cursor = 'default';
        if (i === q.correct) {
          opt.classList.add('correct');
        }
        if (i === answerIndex && !isCorrect) {
          opt.classList.add('incorrect');
        }
        if (i === answerIndex) {
          opt.classList.add('selected');
        }
      });

      // Show feedback
      const feedbackEl = document.getElementById('reviewFeedback');
      feedbackEl.innerHTML = `
        <div class="review-feedback ${isCorrect ? 'correct' : 'incorrect'}">
          ${isCorrect ? ' Correct!' : ' Not quite.'} ${q.explanation}
        </div>
      `;

      // Enable next button
      document.getElementById('reviewNextBtn').disabled = false;
    }

    function nextReviewQuestion() {
      reviewState.currentIndex++;
      renderReviewProgress();
      renderReviewQuestion();
    }

    function finishDailyReview() {
      if (reviewState.timerInterval) {
        clearInterval(reviewState.timerInterval);
      }

      const correctCount = reviewState.answers.filter(a => a.correct).length;
      const totalCount = reviewState.answers.length;
      const score = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;

      // Update state
      spacedRepetitionState.lastDailyReview = new Date().toISOString();
      spacedRepetitionState.dailyReviewsCompleted++;
      gameState.quizzesCompleted++;
      saveProgress();
      checkBadges();

      // Award bonus for perfect score
      if (correctCount === totalCount && totalCount > 0) {
        awardPoints(25, 'Perfect daily review');
        earnBadge('perfect_review');
      }

      // Show summary
      const container = document.getElementById('reviewCardContainer');
      container.innerHTML = `
        <div class="review-summary">
          <div class="summary-score">${score}%</div>
          <div class="summary-text">Daily Review Complete!</div>

          <div class="summary-breakdown">
            <div class="summary-stat">
              <div class="summary-stat-value correct-val">${correctCount}</div>
              <div class="summary-stat-label">Correct</div>
            </div>
            <div class="summary-stat">
              <div class="summary-stat-value incorrect-val">${totalCount - correctCount}</div>
              <div class="summary-stat-label">To Review</div>
            </div>
          </div>

          ${gameState.streak >= 2 ? `
            <div class="review-streak-bonus">
              <span class="flame"></span>
              <span class="text">${gameState.streak} day learning streak!</span>
            </div>
          ` : ''}
        </div>
      `;

      // Update actions
      document.getElementById('reviewActions').innerHTML = `
        <button class="review-btn next" onclick="closeDailyReview()">Continue Learning</button>
      `;

      updateReviewButtonStatus();
    }

    function updateReviewButtonStatus() {
      const btn = document.getElementById('dailyReviewBtn');
      const status = document.getElementById('reviewStatus');

      if (!btn || !status) return;

      if (shouldShowDailyReview()) {
        btn.classList.add('pending');
        status.textContent = 'Due!';
      } else {
        btn.classList.remove('pending');
        status.textContent = ' Done';
      }
    }

    // Add badge for spaced repetition mastery
    if (!badges.find(b => b.id === 'principle_master')) {
      badges.push({ id: 'principle_master', icon: '', name: 'Principle Master', desc: 'Master a principle through spaced repetition' });
    }
    if (!badges.find(b => b.id === 'perfect_review')) {
      badges.push({ id: 'perfect_review', icon: '', name: 'Perfect Review', desc: 'Get 100% on a daily review' });
    }
    if (!badges.find(b => b.id === 'daily_dedication')) {
      badges.push({ id: 'daily_dedication', icon: '', name: 'Daily Dedication', desc: 'Complete 7 daily reviews' });
    }
    if (!badges.find(b => b.id === 'scenario_solver')) {
      badges.push({ id: 'scenario_solver', icon: '', name: 'Scenario Solver', desc: 'Complete 5 branching scenarios' });
    }
    if (!badges.find(b => b.id === 'well_calibrated')) {
      badges.push({ id: 'well_calibrated', icon: '', name: 'Well Calibrated', desc: 'Achieve 80%+ calibration accuracy' });
    }

    // ============================================================
    // BRANCHING SCENARIOS SYSTEM
    // ============================================================

    // Scenarios based on Evidence Reversal stories - decisions with consequences
    const branchingScenarios = [
      {
        id: 'cast_scenario',
        module: 1,
        title: 'The Antiarrhythmic Decision',
        situation: "You're on a hospital formulary committee in 1988. A cardiologist presents data showing encainide suppresses PVCs by 80% in post-MI patients. He wants it added to the formulary for routine use.",
        question: "What do you recommend?",
        choices: [
          { id: 'a', text: "Approve it - PVC suppression is a validated surrogate for mortality", consequence: 'bad', result: "The CAST trial (1989) showed these drugs TRIPLED mortality despite suppressing PVCs. 50,000+ patients died from drugs that 'worked' on the surrogate." },
          { id: 'b', text: "Request RCT evidence on hard outcomes (death, cardiac arrest) before approval", consequence: 'good', result: "Correct! Surrogate endpoints can mislead. The relationship between PVC suppression and survival was never proven - and turned out to be the opposite of expected." },
          { id: 'c', text: "Approve for low-risk patients only", consequence: 'bad', result: "Still wrong. Without mortality data, you can't know which patients might be harmed. CAST showed harm across subgroups." }
        ],
        correct: 'b',
        principle: 0,
        lesson: "Not every signal is truth. Surrogates must be validated against hard outcomes before driving treatment decisions."
      },
      {
        id: 'hrt_scenario',
        module: 2,
        title: 'The HRT Recommendation',
        situation: "It's 1998. A postmenopausal woman asks about hormone replacement therapy. You have 30+ observational studies showing 40-50% reduction in heart disease. No large RCTs exist yet.",
        question: "What do you tell her?",
        choices: [
          { id: 'a', text: "Recommend HRT strongly - the observational evidence is overwhelming", consequence: 'bad', result: "The WHI trial (2002) showed HRT INCREASED heart disease (HR 1.29). The observational benefit was confounded by healthy user bias - women who chose HRT were healthier at baseline." },
          { id: 'b', text: "Explain the uncertainty - observational data may be confounded, wait for RCT results", consequence: 'good', result: "Correct! You appropriately communicated uncertainty. The WHI proved the observational signal was misleading due to confounding." },
          { id: 'c', text: "Recommend HRT but only for women with risk factors", consequence: 'bad', result: "Still problematic. Targeting 'high-risk' women doesn't fix confounding - it may concentrate harm." }
        ],
        correct: 'b',
        principle: 1,
        lesson: "Methods protect patients from our confidence. Observational associations are not causal proof."
      },
      {
        id: 'rosi_scenario',
        module: 3,
        title: 'The Hidden Trials',
        situation: "You're conducting a meta-analysis of rosiglitazone for diabetes in 2006. You've found 12 published trials. A colleague mentions the FDA might have unpublished data.",
        question: "What do you do?",
        choices: [
          { id: 'a', text: "Proceed with published trials only - unpublished data is too hard to get", consequence: 'bad', result: "Nissen's 2007 meta-analysis found the unpublished GSK trials. Including them revealed a 43% increased MI risk (OR 1.43) that wasn't visible in published data alone." },
          { id: 'b', text: "File FOIA requests, search ClinicalTrials.gov, contact the manufacturer", consequence: 'good', result: "Correct! Grey literature searching is essential. The rosiglitazone cardiac signal was hidden in unpublished regulatory submissions for years." },
          { id: 'c', text: "Add a sensitivity analysis assuming unpublished trials exist", consequence: 'neutral', result: "Better than nothing, but not sufficient. You can't model what you haven't tried to find. Active searching is required." }
        ],
        correct: 'b',
        principle: 2,
        lesson: "What was hidden in plain sight? Comprehensive searching beyond published literature is methodologically required."
      },
      {
        id: 'decrease_scenario',
        module: 5,
        title: 'The Suspicious Pattern',
        situation: "You're verifying extracted data for a meta-analysis. One prominent researcher's trials show remarkably consistent effects (I = 0%) while other trials show high heterogeneity. His event rates are unusually balanced.",
        question: "What do you do?",
        choices: [
          { id: 'a', text: "Accept the data - low heterogeneity is good, and he's a respected researcher", consequence: 'bad', result: "Don Poldermans' DECREASE trials were later found to be fabricated. The 'perfect' consistency was a red flag - real data is messier. His fraud influenced guidelines for years." },
          { id: 'b', text: "Request source documents and verify numbers against original publications", consequence: 'good', result: "Correct! Provenance verification caught the fraud. When investigators traced his numbers to source, patients didn't exist. 800,000 may have been harmed by guidelines built on his fabrications." },
          { id: 'c', text: "Conduct sensitivity analysis excluding his studies", consequence: 'neutral', result: "Helpful but insufficient. You should verify first - if fraud is suspected, exclusion should be justified by evidence, not suspicion." }
        ],
        correct: 'b',
        principle: 3,
        lesson: "The number without provenance is not a number. Every data point needs verification to its source."
      },
      {
        id: 'heterogeneity_scenario',
        module: 8,
        title: 'The I Dilemma',
        situation: "Your meta-analysis of intensive glucose control shows a pooled HR of 0.91 (95% CI 0.84-0.99) for cardiovascular events, but I = 78%. The ACCORD trial shows harm (HR 1.22) while others show benefit.",
        question: "How do you report this?",
        choices: [
          { id: 'a', text: "Report the pooled estimate - it's statistically significant and favors treatment", consequence: 'bad', result: "Dangerous! High heterogeneity means the pooled estimate doesn't represent reality. ACCORD showed that intensive control INCREASED mortality in some patients. Reporting only the average hides life-threatening subgroup effects." },
          { id: 'b', text: "Investigate heterogeneity sources, report subgroup differences prominently", consequence: 'good', result: "Correct! ACCORD found that intensive control harmed patients with long diabetes duration and cardiovascular disease. The 'average' benefit masked deadly harm in specific subgroups." },
          { id: 'c', text: "Use random effects and report wider confidence intervals", consequence: 'neutral', result: "Technically correct but misses the point. Random effects accounts for heterogeneity statistically but doesn't explain it clinically. The ACCORD harm signal needs investigation, not statistical smoothing." }
        ],
        correct: 'b',
        principle: 4,
        lesson: "Heterogeneity is a message, not noise. High I demands investigation, not just statistical adjustment."
      },
      {
        id: 'orbita_scenario',
        module: 4,
        title: 'The Sham Surgery Question',
        situation: "It's 2015. You're designing a trial of PCI for stable angina. Previous unblinded trials show symptom improvement. A statistician suggests using a sham procedure (catheterization without stenting) as control.",
        question: "What's your response?",
        choices: [
          { id: 'a', text: "Reject sham control - it's unethical to do an invasive procedure without benefit", consequence: 'bad', result: "The ORBITA trial (2017) used sham control and found NO difference in exercise time (16.6 sec, 95% CI -8.9 to 42.0). Without the sham, the placebo effect of PCI would have been mistaken for treatment effect." },
          { id: 'b', text: "Support sham control - without blinding, we can't distinguish placebo from treatment effect", consequence: 'good', result: "Correct! ORBITA revolutionized cardiology by showing that much of PCI's benefit in stable angina was placebo effect. The sham control was essential to reveal this." },
          { id: 'c', text: "Use objective endpoints like MI or death instead of symptoms", consequence: 'neutral', result: "These are important but COURAGE already showed no mortality benefit. The question was whether symptom improvement was real - and only sham control could answer that." }
        ],
        correct: 'b',
        principle: 1,
        lesson: "Methods protect patients from our confidence. Sham controls reveal what unblinded trials cannot."
      },
      {
        id: 'prowess_scenario',
        module: 6,
        title: 'The Single Positive Trial',
        situation: "It's 2002. The PROWESS trial shows activated protein C reduces sepsis mortality (RR 0.81, p=0.005). The manufacturer seeks FDA approval. You're on the advisory committee.",
        question: "What do you recommend?",
        choices: [
          { id: 'a', text: "Approve immediately - the trial is large and statistically significant", consequence: 'bad', result: "PROWESS-SHOCK (2012) found NO benefit (RR 1.09, 95% CI 0.92-1.28) and bleeding harm. The drug was withdrawn after 10 years of use. Single trials, however impressive, need replication." },
          { id: 'b', text: "Require confirmatory trial before broad approval", consequence: 'good', result: "Correct! Replication is essential. PROWESS was likely a false positive or affected by trial conduct issues. The confirmatory trial would have prevented years of inappropriate use." },
          { id: 'c', text: "Approve with post-marketing surveillance", consequence: 'neutral', result: "Insufficient. Post-marketing surveillance rarely generates the evidence quality needed to reverse approvals. A proper confirmatory trial was needed." }
        ],
        correct: 'b',
        principle: 5,
        lesson: "Absence of replication evidence is not evidence of efficacy. Single trials do not crown therapies."
      },
      {
        id: 'egdt_scenario',
        module: 7,
        title: 'The Landmark Replication',
        situation: "The Rivers EGDT trial (2001) showed dramatic mortality reduction in sepsis. By 2014, three large replication trials (ProCESS, ARISE, ProMISe) all show no benefit. How do you interpret this?",
        question: "What's your conclusion?",
        choices: [
          { id: 'a', text: "Rivers was wrong - EGDT doesn't work", consequence: 'neutral', result: "Partially correct but misses nuance. Rivers wasn't necessarily 'wrong' - the context changed. Usual care in 2014 was much better than 2001. The comparison groups differed dramatically." },
          { id: 'b', text: "Usual care improved so much that EGDT's advantage disappeared", consequence: 'good', result: "Correct! This is 'secular trend' - the control group in 2014 received care that incorporated EGDT principles. The intervention effect was diluted by improved standard practice." },
          { id: 'c', text: "The replication trials were done in different populations", consequence: 'neutral', result: "True but incomplete. Population differences (external validity) don't fully explain why EGDT failed in multiple countries. The secular trend in usual care quality is the key factor." }
        ],
        correct: 'b',
        principle: 5,
        lesson: "Context matters. Treatments that worked against outdated usual care may show no benefit when standards improve."
      },
      {
        id: 'grade_scenario',
        module: 10,
        title: 'The Certainty Rating',
        situation: "You're rating certainty of evidence for intensive BP control. You have RCTs showing benefit (SPRINT), but they excluded diabetics and used automated office BP. Your population includes diabetics and uses manual BP.",
        question: "How do you rate certainty for your guideline population?",
        choices: [
          { id: 'a', text: "High certainty - SPRINT was a well-conducted RCT", consequence: 'bad', result: "Wrong! GRADE requires rating for YOUR population. SPRINT's results don't directly apply to diabetics (excluded) or clinics using manual BP measurement (which reads ~10 mmHg higher). This is INDIRECTNESS." },
          { id: 'b', text: "Downgrade for indirectness - the population and measurements differ", consequence: 'good', result: "Correct! SPRINT excluded diabetics (ACCORD showed harm in diabetics!) and used automated BP (lower readings than manual). Applying SPRINT targets with manual BP would overtreate patients." },
          { id: 'c', text: "Moderate certainty - some uncertainty but RCTs are gold standard", consequence: 'neutral', result: "Not specific enough. You need to identify WHY you're downgrading. Indirectness in population (diabetics excluded) and intervention (BP measurement method) requires explicit acknowledgment." }
        ],
        correct: 'b',
        principle: 6,
        lesson: "Certainty must be earned for YOUR population. Direct evidence beats indirect evidence, regardless of study design."
      },
      {
        id: 'funnel_scenario',
        module: 9,
        title: 'The Asymmetric Funnel',
        situation: "Your funnel plot for a surgical intervention shows marked asymmetry - small studies cluster on the positive side, large studies near the null. Egger's test p=0.02.",
        question: "How do you proceed?",
        choices: [
          { id: 'a', text: "Apply trim-and-fill to adjust the pooled estimate", consequence: 'neutral', result: "Trim-and-fill is a sensitivity analysis, not a fix. It assumes the asymmetry is pure publication bias, but small-study effects could also be due to patient selection, intervention fidelity, or true heterogeneity." },
          { id: 'b', text: "Report the asymmetry, explore causes, and present with and without small studies", consequence: 'good', result: "Correct! Funnel asymmetry has multiple causes: publication bias, true heterogeneity, or different patient populations in small vs large studies. Transparent reporting of all possibilities is essential." },
          { id: 'c', text: "Exclude small studies as they're likely biased", consequence: 'bad', result: "Arbitrary exclusion creates its own bias. Small studies might represent different populations where the treatment truly works better. Investigation, not exclusion, is the answer." }
        ],
        correct: 'b',
        principle: 2,
        lesson: "What was hidden in plain sight? Funnel asymmetry reveals problems but doesn't specify the cause. Investigation is required."
      }
    ];

    // Track scenario completions
    let scenarioState = {
      completed: {},
      confidenceRatings: []
    };

    function renderScenario(scenarioId, containerId) {
      const scenario = branchingScenarios.find(s => s.id === scenarioId);
      if (!scenario) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      const isCompleted = scenarioState.completed[scenarioId];

      container.innerHTML = `
        <div class="scenario-panel" id="scenario-${scenarioId}">
          <div class="scenario-header">
            <span class="scenario-icon"></span>
            <span class="scenario-title">${scenario.title}</span>
          </div>
          <div class="scenario-situation">${scenario.situation}</div>
          <div class="scenario-question">${scenario.question}</div>
          <div class="scenario-choices">
            ${scenario.choices.map(c => `
              <div class="scenario-choice ${isCompleted ? 'answered' : ''} ${isCompleted && c.id === scenario.correct ? 'correct' : ''} ${isCompleted && scenarioState.completed[scenarioId] === c.id && c.id !== scenario.correct ? 'incorrect' : ''}"
                   onclick="${isCompleted ? '' : `selectScenarioChoice('${scenarioId}', '${c.id}')`}">
                <span class="choice-letter">${c.id.toUpperCase()}</span>
                <span class="choice-text">${c.text}</span>
              </div>
            `).join('')}
          </div>
          <div class="scenario-consequence ${isCompleted ? 'visible' : ''} ${isCompleted ? scenario.choices.find(c => c.id === scenarioState.completed[scenarioId])?.consequence || '' : ''}" id="consequence-${scenarioId}">
            ${isCompleted ? renderConsequence(scenario, scenarioState.completed[scenarioId]) : ''}
          </div>
        </div>
      `;
    }

    function renderConsequence(scenario, choiceId) {
      const choice = scenario.choices.find(c => c.id === choiceId);
      const isCorrect = choiceId === scenario.correct;
      return `
        <div class="consequence-title">
          ${isCorrect ? ' Good decision!' : ' Problematic decision'}
        </div>
        <div class="consequence-text">${choice.result}</div>
        <div class="consequence-lesson"><strong>Principle ${scenario.principle + 1}:</strong> ${scenario.lesson}</div>
      `;
    }

    function selectScenarioChoice(scenarioId, choiceId) {
      const scenario = branchingScenarios.find(s => s.id === scenarioId);
      if (!scenario || scenarioState.completed[scenarioId]) return;

      scenarioState.completed[scenarioId] = choiceId;

      // Award points
      if (choiceId === scenario.correct) {
        awardPoints(30, 'Correct scenario decision');
      } else {
        awardPoints(10, 'Scenario attempted');
      }

      // Check for badge
      const completedCount = Object.keys(scenarioState.completed).length;
      if (completedCount >= 5) {
        earnBadge('scenario_solver');
      }

      saveProgress();

      // Re-render with answer shown
      const container = document.getElementById(`scenario-${scenarioId}`)?.parentElement;
      if (container) {
        renderScenario(scenarioId, container.id);
      }
    }

    // ============================================================
    // CONFIDENCE CALIBRATION SYSTEM
    // ============================================================

    let calibrationState = {
      predictions: [], // { confidence: 0-100, correct: boolean }
      totalPredictions: 0,
      calibrationScore: null
    };

    function addConfidenceToPredict(containerId) {
      const container = document.getElementById(containerId);
      if (!container) return;

      const existingSection = container.querySelector('.confidence-section');
      if (existingSection) return;

      const section = document.createElement('div');
      section.className = 'confidence-section';
      section.innerHTML = `
        <div class="confidence-label">How confident are you in your prediction?</div>
        <div class="confidence-slider-container">
          <input type="range" class="confidence-slider" min="0" max="100" value="50"
                 oninput="updateConfidenceDisplay(this)">
          <span class="confidence-value">50%</span>
        </div>
        <div class="confidence-labels">
          <span>Guessing</span>
          <span>Very sure</span>
        </div>
      `;
      container.appendChild(section);
    }

    function updateConfidenceDisplay(slider) {
      const value = slider.value;
      slider.nextElementSibling.textContent = value + '%';
    }

    function recordConfidence(confidence, wasCorrect) {
      calibrationState.predictions.push({ confidence, correct: wasCorrect });
      calibrationState.totalPredictions++;
      calculateCalibrationScore();
      saveProgress();
    }

    function calculateCalibrationScore() {
      if (calibrationState.predictions.length < 5) {
        calibrationState.calibrationScore = null;
        return;
      }

      // Group predictions by confidence bands
      const bands = { low: [], mid: [], high: [] };
      calibrationState.predictions.forEach(p => {
        if (p.confidence < 40) bands.low.push(p);
        else if (p.confidence < 70) bands.mid.push(p);
        else bands.high.push(p);
      });

      // Calculate accuracy per band
      const bandAccuracy = {};
      Object.keys(bands).forEach(band => {
        if (bands[band].length > 0) {
          const correct = bands[band].filter(p => p.correct).length;
          bandAccuracy[band] = correct / bands[band].length;
        }
      });

      // Perfect calibration: high confidence = high accuracy, low confidence = low accuracy
      // Score: 100 - average absolute deviation from expected
      let totalDeviation = 0;
      let count = 0;

      if (bands.high.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.high || 0) - 0.85) * 100;
        count++;
      }
      if (bands.mid.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.mid || 0) - 0.55) * 100;
        count++;
      }
      if (bands.low.length > 0) {
        totalDeviation += Math.abs((bandAccuracy.low || 0) - 0.25) * 100;
        count++;
      }

      calibrationState.calibrationScore = count > 0 ? Math.max(0, 100 - (totalDeviation / count)) : null;

      // Award badge for good calibration
      if (calibrationState.calibrationScore >= 80) {
        earnBadge('well_calibrated');
      }
    }

    // ============================================================
    // ENHANCED ANALOGY SYSTEM
    // ============================================================

    const conceptAnalogies = {
      'heterogeneity': {
        icon: '',
        title: 'Orchestra Tuning',
        concept: 'I (Heterogeneity)',
        text: "Like an orchestra tuning up - some variance is normal and expected. But if violins are playing in different keys, something's wrong. High I means your studies aren't playing the same tune."
      },
      'publication_bias': {
        icon: '',
        title: 'Missing Socks',
        concept: 'Publication Bias',
        text: "Like socks in the laundry - you KNOW pairs went in, but only the positive results come out. The missing negative trials are like those single socks that vanished. The asymmetric funnel plot reveals the gap."
      },
      'forest_plot': {
        icon: '',
        title: 'Jury of Studies',
        concept: 'Forest Plot',
        text: "Each study is a juror giving a verdict. Some are more certain (narrow CI), some less. The diamond is the jury's consensus - but if jurors wildly disagree (heterogeneity), should you trust the average verdict?"
      },
      'funnel_plot': {
        icon: '',
        title: 'Flashlight Beam',
        concept: 'Funnel Plot',
        text: "A flashlight should illuminate evenly in all directions. An asymmetric funnel plot is like a flashlight with something blocking one side - you're not seeing the full picture. Small studies on one side are suspiciously missing."
      },
      'grade': {
        icon: '',
        title: 'Ladder of Confidence',
        concept: 'GRADE Certainty',
        text: "Each rung must be earned, not assumed. You start at the top (RCT) or bottom (observational) and can only move with evidence. Risk of bias pushes you down; large effects can pull you up. No shortcuts."
      },
      'tau_squared': {
        icon: '',
        title: 'Background Static',
        concept: ' (Between-study variance)',
        text: "Like static on a radio station - how much noise is in the signal? Low  means clear reception (studies agree). High  means interference from unknown sources - different populations, interventions, or outcomes."
      },
      'random_effects': {
        icon: '',
        title: 'Different Orchestras',
        concept: 'Random Effects Model',
        text: "Fixed effects: same orchestra playing multiple times. Random effects: different orchestras playing the same piece. Each adds their interpretation. We want the average of all possible orchestras, not just this one."
      },
      'prediction_interval': {
        icon: '',
        title: 'Where Will the Arrow Land?',
        concept: 'Prediction Interval',
        text: "The CI tells you where the TRUE average is. The prediction interval tells you where the NEXT study will likely fall. If your PI crosses the line of no effect, a new study might flip the conclusion."
      },
      'surrogate': {
        icon: '',
        title: 'Map vs Territory',
        concept: 'Surrogate Endpoints',
        text: "A map (surrogate) represents the territory (clinical outcome). But a map can be wrong. PVC suppression was the map; mortality was the territory. CAST proved the map led off a cliff."
      },
      'confounding': {
        icon: '',
        title: 'Umbrella & Rain',
        concept: 'Confounding',
        text: "Umbrella sales predict rain. But buying umbrellas doesn't cause rain. The confounder (weather forecast) affects both. HRT users weren't healthier BECAUSE of HRT - they were healthier women who CHOSE HRT."
      }
    };

    function getAnalogy(conceptKey) {
      return conceptAnalogies[conceptKey] || null;
    }

    function renderAnalogy(conceptKey, containerId) {
      const analogy = getAnalogy(conceptKey);
      if (!analogy) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="analogy-card">
          <div class="analogy-header">
            <span class="analogy-icon">${analogy.icon}</span>
            <span class="analogy-title">${analogy.title}</span>
            <span class="analogy-concept">${analogy.concept}</span>
          </div>
          <div class="analogy-text">"${analogy.text}"</div>
        </div>
      `;
    }

    // ============================================================
    // MISCONCEPTION CHALLENGES (from Evidence Reversal 40)
    // ============================================================

    const misconceptions = [
      // Original 10 - Evidence Reversals
      { id: 1, statement: "If arrhythmias fall, survival must rise.", truth: false, story: "CAST", explanation: "Encainide/flecainide suppressed PVCs but tripled mortality. Surrogates can deceive." },
      { id: 2, statement: "Observational prevention equals causal prevention.", truth: false, story: "WHI/HRT", explanation: "Healthy user bias made HRT look protective. RCTs showed harm." },
      { id: 3, statement: "Surgery proves itself without sham control.", truth: false, story: "Moseley", explanation: "Arthroscopic knee surgery was no better than sham. Placebo effect is powerful." },
      { id: 4, statement: "If the artery is open, outcomes must improve.", truth: false, story: "COURAGE", explanation: "PCI for stable CAD didn't reduce death/MI vs medical therapy alone." },
      { id: 5, statement: "Lower glucose always means better outcomes.", truth: false, story: "NICE-SUGAR", explanation: "Intensive glucose control increased mortality in ICU patients." },
      { id: 6, statement: "A positive early signal is enough for adoption.", truth: false, story: "PROWESS-SHOCK", explanation: "Activated protein C looked promising until definitive trial showed no benefit." },
      { id: 7, statement: "If a mechanism is plausible, outcomes follow.", truth: false, story: "MAGIC", explanation: "Magnesium had sound antiarrhythmic theory but no mortality benefit in large trials." },
      { id: 8, statement: "More measurements mean more survival.", truth: false, story: "ESCAPE", explanation: "Pulmonary artery catheters provided data but no outcome improvement in heart failure." },
      { id: 9, statement: "Device enthusiasm replaces randomized proof.", truth: false, story: "CORAL", explanation: "Renal artery stenting had no benefit despite strong mechanistic rationale." },
      { id: 10, statement: "Guidelines equal proof.", truth: false, story: "IABP-SHOCK", explanation: "Intra-aortic balloon pump was Class I recommended but showed no benefit in RCT." },
      // More Evidence Reversals
      { id: 11, statement: "Raising HDL with drugs guarantees fewer heart attacks.", truth: false, story: "AIM-HIGH", explanation: "Niacin raised HDL but didn't reduce cardiovascular events. HDL was a marker, not a modifiable cause." },
      { id: 12, statement: "If it worked in one landmark trial, it works everywhere.", truth: false, story: "ProCESS/ARISE/ProMISe", explanation: "Rivers' EGDT worked in 2001 but three replication trials failed. Usual care had improved, diluting the effect." },
      { id: 13, statement: "Antioxidants prevent cancer in smokers.", truth: false, story: "ATBC/CARET", explanation: "Beta-carotene INCREASED lung cancer in smokers (RR 1.16-1.28). Mechanism doesn't guarantee benefit." },
      { id: 14, statement: "More screening always saves more lives.", truth: false, story: "PLCO", explanation: "PSA screening found more cancers but didn't reduce mortality - it found cancers that would never kill." },
      { id: 15, statement: "Normalizing hemoglobin improves kidney patient outcomes.", truth: false, story: "CHOIR/TREAT", explanation: "Higher Hb targets increased stroke and death. The target became the enemy." },
      { id: 16, statement: "New devices are safer because they are new.", truth: false, story: "SAMMPRIS", explanation: "Intracranial stents tripled 30-day stroke/death vs medical therapy (14.7% vs 5.8%)." },
      { id: 17, statement: "If homocysteine drops, cardiovascular risk drops.", truth: false, story: "NORVIT", explanation: "B vitamins lowered homocysteine but didn't reduce events. Biomarker fallacy." },
      { id: 18, statement: "Routine oxygen helps heart attack patients.", truth: false, story: "DETO2X-AMI", explanation: "Oxygen in non-hypoxic MI patients showed no mortality benefit. A century of practice, no evidence." },
      { id: 19, statement: "Early aggressive feeding speeds ICU recovery.", truth: false, story: "EPaNIC", explanation: "Late parenteral nutrition led to FASTER discharge than early feeding. Timing matters." },
      { id: 20, statement: "Removing thrombus during PCI must improve outcomes.", truth: false, story: "TASTE", explanation: "Thrombus aspiration added procedural time but no mortality benefit. Logical doesn't mean proven." },
      // Cochrane Methods Misconceptions
      { id: 21, statement: "Low I means the studies agree enough to pool.", truth: false, story: "Methods", explanation: "I can be low with clinically important differences. Prediction intervals reveal the true spread of effects." },
      { id: 22, statement: "Statistically significant means clinically important.", truth: false, story: "Methods", explanation: "Large trials can detect tiny, meaningless effects. Effect SIZE and CI width matter more than p-values." },
      { id: 23, statement: "RCTs are always high certainty evidence.", truth: false, story: "GRADE", explanation: "RCTs start high but are downgraded for bias, imprecision, indirectness, inconsistency, or publication bias." },
      { id: 24, statement: "Funnel plot asymmetry proves publication bias.", truth: false, story: "Methods", explanation: "Asymmetry has many causes: true heterogeneity, small-study effects, different populations. Investigation needed." },
      { id: 25, statement: "Random effects models fix heterogeneity.", truth: false, story: "Methods", explanation: "Random effects account for heterogeneity statistically but don't explain it. Clinical investigation is still required." }
    ];

    function renderMisconceptionChallenge(misconceptionId, containerId) {
      const m = misconceptions.find(x => x.id === misconceptionId);
      if (!m) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="misconception-challenge" id="misconception-${m.id}">
          <div class="misconception-header">
            <span></span>
            <span>Common Belief Challenge</span>
          </div>
          <div class="misconception-statement">"${m.statement}"</div>
          <div class="misconception-buttons">
            <button class="misconception-btn true-btn" onclick="answerMisconception(${m.id}, true)">TRUE</button>
            <button class="misconception-btn false-btn" onclick="answerMisconception(${m.id}, false)">FALSE</button>
          </div>
          <div class="misconception-result" id="misconception-result-${m.id}"></div>
        </div>
      `;
    }

    function answerMisconception(id, answer) {
      const m = misconceptions.find(x => x.id === id);
      if (!m) return;

      const isCorrect = answer === m.truth;
      const trueBtn = document.querySelector(`#misconception-${id} .true-btn`);
      const falseBtn = document.querySelector(`#misconception-${id} .false-btn`);
      const resultDiv = document.getElementById(`misconception-result-${id}`);

      // Disable buttons
      trueBtn.disabled = true;
      falseBtn.disabled = true;

      // Show correct/incorrect
      if (m.truth) {
        trueBtn.classList.add('correct');
        if (!answer) falseBtn.classList.add('wrong');
      } else {
        falseBtn.classList.add('correct');
        if (answer) trueBtn.classList.add('wrong');
      }

      // Show result
      resultDiv.className = `misconception-result visible ${isCorrect ? 'correct' : 'incorrect'}`;
      resultDiv.innerHTML = `
        <strong>${isCorrect ? ' Correct!' : ' Not quite.'}</strong>
        This belief is <strong>${m.truth ? 'TRUE' : 'FALSE'}</strong>.
        <br><br>
        <strong>${m.story}:</strong> ${m.explanation}
      `;

      // Award points
      if (isCorrect) {
        awardPoints(20, 'Misconception challenge correct');
      }
      saveProgress();
    }

    // ============================================================
    // PRACTICE PROBLEMS (Addressing Cochrane Gaps)
    // ============================================================

    const practiceProblems = [
      // GRADE Problems
      {
        id: 'grade_1',
        category: 'GRADE',
        title: 'Rating Certainty: SPRINT Trial',
        scenario: 'You\'re creating a guideline for hypertension. The SPRINT trial (RCT, n=9,361) shows intensive BP control reduces CV events (HR 0.75, 95% CI 0.64-0.89). However: (1) Trial excluded diabetics, (2) Used automated office BP (reads ~10 mmHg lower than manual), (3) Composite endpoint included heart failure.',
        question: 'What GRADE certainty rating is appropriate for YOUR clinic population that includes diabetics and uses manual BP?',
        options: [
          { id: 'a', text: 'High - SPRINT was a large, well-conducted RCT', correct: false },
          { id: 'b', text: 'Moderate - Downgrade one level for indirectness (population differs)', correct: true },
          { id: 'c', text: 'Low - Downgrade two levels for indirectness and imprecision', correct: false },
          { id: 'd', text: 'Very Low - Multiple serious concerns', correct: false }
        ],
        explanation: 'Downgrade ONE level for serious indirectness: (1) Population excludes diabetics (ACCORD showed HARM in diabetics with intensive control), (2) BP measurement method differs (applying SPRINT targets with manual BP would overtreate). The trial quality was good, but the results don\'t directly apply to your population.',
        principle: 6
      },
      {
        id: 'grade_2',
        category: 'GRADE',
        title: 'When Observational Beats RCT',
        scenario: 'For a rare adverse effect (hepatotoxicity with a new drug), you have: (1) RCTs showing 0/2,000 events in treatment vs 0/2,000 in control, (2) Large pharmacovigilance database showing 45 cases in 500,000 users (9/100,000).',
        question: 'What provides higher certainty for this safety signal?',
        options: [
          { id: 'a', text: 'The RCTs - they\'re the gold standard', correct: false },
          { id: 'b', text: 'The observational data - it has the power to detect rare events', correct: true },
          { id: 'c', text: 'Neither - you need more RCT data', correct: false },
          { id: 'd', text: 'Combine them in a meta-analysis', correct: false }
        ],
        explanation: 'RCTs are underpowered for rare events. With 2,000 patients, you\'d need a risk >1/500 to detect one event. The observational data, despite confounding risks, provides the only evidence of a real signal. GRADE can rate UP observational data when effect is large or there\'s dose-response.',
        principle: 5
      },
      // Prediction Interval Problems
      {
        id: 'pi_1',
        category: 'Prediction Intervals',
        title: 'Beyond I-squared',
        scenario: 'A meta-analysis of 8 trials shows: Pooled RR = 0.80 (95% CI 0.72-0.89), I = 65%,  = 0.04. The 95% prediction interval is 0.55-1.16.',
        question: 'If you run a new trial in a similar population, what range of effects is plausible?',
        options: [
          { id: 'a', text: '0.72-0.89 (the confidence interval)', correct: false },
          { id: 'b', text: '0.55-1.16 (the prediction interval)', correct: true },
          { id: 'c', text: 'Around 0.80 (the point estimate)', correct: false },
          { id: 'd', text: 'Cannot predict from this data', correct: false }
        ],
        explanation: 'The PREDICTION INTERVAL (0.55-1.16) shows the range of true effects in different settings. It INCLUDES 1.0, meaning a new trial might show HARM even though the pooled estimate shows benefit. I tells you heterogeneity exists; prediction intervals tell you what it means for the next patient/setting.',
        principle: 4
      },
      {
        id: 'pi_2',
        category: 'Prediction Intervals',
        title: 'Clinical Interpretation',
        scenario: 'You\'re advising a colleague about implementing an intervention. The meta-analysis shows: RR = 0.70 (95% CI 0.60-0.82), I = 45% (moderate), 95% prediction interval = 0.50-0.98.',
        question: 'What do you tell your colleague?',
        options: [
          { id: 'a', text: 'Strong evidence of benefit - implement confidently', correct: false },
          { id: 'b', text: 'Likely beneficial but effect size may vary substantially by setting', correct: true },
          { id: 'c', text: 'Too much heterogeneity to draw conclusions', correct: false },
          { id: 'd', text: 'Wait for more trials to reduce uncertainty', correct: false }
        ],
        explanation: 'The prediction interval (0.50-0.98) stays below 1.0, suggesting benefit is likely in most settings, though the magnitude varies (30-50% reduction). This is MORE informative than just reporting "moderate heterogeneity." The treatment probably helps, but by how much depends on local factors.',
        principle: 4
      },
      // Risk of Bias Problems
      {
        id: 'rob_1',
        category: 'Risk of Bias',
        title: 'Retrospective Red Flags',
        scenario: 'Reviewing a trial of a surgical intervention: (1) Patients knew their allocation, (2) Surgeons obviously couldn\'t be blinded, (3) Primary outcome was "patient-reported pain at 6 months", (4) 15% lost to follow-up, similar between groups.',
        question: 'What is the MAIN risk of bias concern?',
        options: [
          { id: 'a', text: 'Selection bias - randomization might have been subverted', correct: false },
          { id: 'b', text: 'Performance bias - surgeons weren\'t blinded', correct: false },
          { id: 'c', text: 'Detection bias - patients knew allocation and reported subjective outcome', correct: true },
          { id: 'd', text: 'Attrition bias - 15% lost to follow-up', correct: false }
        ],
        explanation: 'With UNBLINDED patients reporting SUBJECTIVE outcomes, detection bias is critical. Patients who know they got the "real" surgery often report more improvement (placebo effect). This is exactly why ORBITA used sham surgery - to separate placebo from true treatment effect. The 15% attrition, balanced between groups, is less concerning.',
        principle: 1
      },
      {
        id: 'rob_2',
        category: 'Risk of Bias',
        title: 'The DECREASE Signals',
        scenario: 'Reviewing trials by a prolific researcher, you notice: (1) Event rates perfectly balanced between groups, (2) I = 0% when his trials pooled alone (but 70% when combined with others), (3) Effects consistently larger than other researchers\' trials, (4) Unable to verify source data.',
        question: 'What should you do?',
        options: [
          { id: 'a', text: 'Include the trials - low heterogeneity is desirable', correct: false },
          { id: 'b', text: 'Conduct sensitivity analysis excluding his trials', correct: false },
          { id: 'c', text: 'Request source data verification before inclusion', correct: true },
          { id: 'd', text: 'Report concerns but include anyway', correct: false }
        ],
        explanation: 'These are classic fabrication signals (from the DECREASE fraud case). "Perfect" data is a red flag - real biological data is messy. The ONLY acceptable path is source data verification. Don Poldermans\' fraud influenced guidelines for years; 800,000 patients may have been harmed. Numbers without provenance are not numbers.',
        principle: 3
      },
      // Publication Bias Problems
      {
        id: 'pb_1',
        category: 'Publication Bias',
        title: 'Asymmetric Funnel',
        scenario: 'Your funnel plot shows: Large trials cluster around RR=1.0, small trials cluster around RR=0.6 (all on the "benefit" side). Egger\'s test p=0.01.',
        question: 'What\'s the most likely explanation?',
        options: [
          { id: 'a', text: 'Publication bias - small negative trials weren\'t published', correct: false },
          { id: 'b', text: 'Small-study effects - could be publication bias OR true heterogeneity', correct: true },
          { id: 'c', text: 'The small trials found the true effect; large trials are diluted', correct: false },
          { id: 'd', text: 'Random variation - asymmetry is expected', correct: false }
        ],
        explanation: 'Funnel asymmetry has MULTIPLE causes: (1) Publication bias, (2) True heterogeneity (small trials in different populations), (3) Methodological differences (small trials less rigorous), (4) Chance. You cannot conclude "publication bias" from asymmetry alone. Investigation of WHY is required.',
        principle: 2
      },
      {
        id: 'pb_2',
        category: 'Publication Bias',
        title: 'The Missing Trials',
        scenario: 'You\'re meta-analyzing an antidepressant. ClinicalTrials.gov shows 12 registered trials; you found 8 publications. The 4 missing trials were completed 3+ years ago.',
        question: 'What do you do?',
        options: [
          { id: 'a', text: 'Proceed with the 8 published trials - that\'s standard practice', correct: false },
          { id: 'b', text: 'Contact sponsors/authors and file FOIA requests for unpublished data', correct: true },
          { id: 'c', text: 'Note the limitation in your discussion section', correct: false },
          { id: 'd', text: 'Use trim-and-fill to adjust for the missing trials', correct: false }
        ],
        explanation: 'The FDA found that 94% of published antidepressant trials were positive, vs 51% of ALL trials submitted to FDA. You MUST attempt to obtain the missing data - that\'s not optional. "Noting the limitation" without trying to fix it is methodological negligence.',
        principle: 2
      }
    ];

    function renderPracticeProblem(problemId, containerId) {
      const problem = practiceProblems.find(p => p.id === problemId);
      if (!problem) return;

      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = `
        <div class="practice-problem" id="problem-${problem.id}">
          <div class="practice-header">
            <span class="practice-category">${problem.category}</span>
            <span class="practice-title">${problem.title}</span>
          </div>
          <div class="practice-scenario">${problem.scenario}</div>
          <div class="practice-question"><strong>${problem.question}</strong></div>
          <div class="practice-options">
            ${problem.options.map(opt => `
              <button class="practice-option" onclick="answerPracticeProblem('${problem.id}', '${opt.id}')">
                <span class="option-letter">${opt.id.toUpperCase()}</span>
                <span class="option-text">${opt.text}</span>
              </button>
            `).join('')}
          </div>
          <div class="practice-feedback" id="feedback-${problem.id}"></div>
        </div>
      `;
    }

    function answerPracticeProblem(problemId, answerId) {
      const problem = practiceProblems.find(p => p.id === problemId);
      if (!problem) return;

      const selectedOption = problem.options.find(o => o.id === answerId);
      const correctOption = problem.options.find(o => o.correct);
      const isCorrect = selectedOption.correct;

      // Disable all buttons and show correct/incorrect
      const buttons = document.querySelectorAll(`#problem-${problemId} .practice-option`);
      buttons.forEach(btn => {
        btn.disabled = true;
        const letter = btn.querySelector('.option-letter').textContent.toLowerCase();
        if (letter === correctOption.id) {
          btn.classList.add('correct');
        } else if (letter === answerId) {
          btn.classList.add('incorrect');
        }
      });

      // Show feedback
      const feedbackDiv = document.getElementById(`feedback-${problemId}`);
      feedbackDiv.className = `practice-feedback visible ${isCorrect ? 'correct' : 'incorrect'}`;
      feedbackDiv.innerHTML = `
        <strong>${isCorrect ? ' Correct!' : ' Not quite.'}</strong>
        <p>${problem.explanation}</p>
        <p class="principle-link"><em>Principle ${problem.principle + 1}: ${sevenPrinciples[problem.principle]?.text || ''}</em></p>
      `;

      // Award points
      if (isCorrect) {
        awardPoints(25, 'Practice problem correct');
      } else {
        awardPoints(5, 'Practice problem attempted');
      }
      saveProgress();
    }

    // ============================================================
    // INVESTIGATION EXERCISES
    // ============================================================

    function revealAnswer(elementId) {
      const el = document.getElementById(elementId);
      if (el) {
        el.classList.add('visible');
        // Scroll into view
        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function generateMiniForest(containerId, studies, pooled, showAfter = false) {
      const container = document.getElementById(containerId);
      if (!container) return;

      const minE = Math.min(...studies.map(s => s.lo), pooled.lo, 0.3);
      const maxE = Math.max(...studies.map(s => s.hi), pooled.hi, 3);
      const range = maxE - minE;
      const scale = (v) => ((v - minE) / range) * 240 + 30;
      const height = (studies.length + 1) * 24 + 30;

      container.innerHTML = `
        <svg viewBox="0 0 320 ${height}" style="width: 100%; height: ${height}px; font-family: sans-serif;">
          <line x1="${scale(1)}" y1="5" x2="${scale(1)}" y2="${height - 15}" stroke="#999" stroke-width="1" stroke-dasharray="3"/>
          ${studies.map((s, i) => {
            const y = 18 + i * 24;
            const color = showAfter && s.excluded ? '#ccc' : '#1E2761';
            return `
              <text x="2" y="${y + 3}" font-size="9" fill="${color}" ${s.excluded ? 'text-decoration="line-through"' : ''}>${s.name}</text>
              <line x1="${scale(s.lo)}" y1="${y}" x2="${scale(s.hi)}" y2="${y}" stroke="${color}" stroke-width="1.5"/>
              <rect x="${scale(s.effect) - 4}" y="${y - 4}" width="8" height="8" fill="${color}"/>
              <text x="280" y="${y + 3}" font-size="8" fill="${color}">${s.effect.toFixed(2)}</text>
            `;
          }).join('')}
          <polygon points="${scale(pooled.effect)},${height - 20} ${scale(pooled.lo)},${height - 13} ${scale(pooled.effect)},${height - 6} ${scale(pooled.hi)},${height - 13}" fill="${showAfter ? '#C53030' : '#D4AF37'}"/>
          <text x="2" y="${height - 10}" font-size="9" font-weight="bold" fill="${showAfter ? '#C53030' : '#1E2761'}">Pooled</text>
          <text x="280" y="${height - 10}" font-size="8" font-weight="bold">${pooled.effect.toFixed(2)}</text>
          <text x="${scale(0.5)}" y="${height}" font-size="7" fill="#666">Favors Tx</text>
          <text x="${scale(2)}" y="${height}" font-size="7" fill="#666">Favors Ctrl</text>
        </svg>
      `;
    }

    // CAST Investigation Data
    const castStudiesPublished = [
      { name: 'Obs Study 1', effect: 0.45, lo: 0.28, hi: 0.72 },
      { name: 'Obs Study 2', effect: 0.52, lo: 0.35, hi: 0.77 },
      { name: 'Obs Study 3', effect: 0.38, lo: 0.22, hi: 0.65 },
    ];
    const castPooledBefore = { effect: 0.45, lo: 0.33, hi: 0.61 };
    const castPooledAfter = { effect: 2.50, lo: 1.60, hi: 4.50 };

    // Rosiglitazone data (real from Nissen 2007)
    const rosiStudies = [
      { name: 'ADOPT', effect: 1.25, lo: 0.78, hi: 2.01 },
      { name: 'DREAM', effect: 1.36, lo: 0.68, hi: 2.71 },
      { name: 'Trial 49653/020', effect: 1.81, lo: 0.59, hi: 5.55 },
      { name: 'Trial 49653/024', effect: 2.67, lo: 0.50, hi: 14.3 },
      { name: 'Trial 49653/093', effect: 1.50, lo: 0.25, hi: 8.98 },
    ];
    const rosiPooled = { effect: 1.43, lo: 1.03, hi: 1.98 };

    // DECREASE data (before/after fraud removal)
    const decreaseStudies = [
      { name: 'DECREASE-I', effect: 0.09, lo: 0.02, hi: 0.37, excluded: true },
      { name: 'DECREASE-IV', effect: 0.65, lo: 0.24, hi: 1.74, excluded: true },
      { name: 'POISE', effect: 1.33, lo: 1.03, hi: 1.74 },
      { name: 'DIPOM', effect: 1.11, lo: 0.66, hi: 1.87 },
      { name: 'MaVS', effect: 0.92, lo: 0.46, hi: 1.84 },
    ];
    const decreasePooledBefore = { effect: 0.56, lo: 0.35, hi: 0.89 };
    const decreasePooledAfter = { effect: 1.27, lo: 1.01, hi: 1.60 };

    // Magnesium ISIS-4 data
    const magnesiumSmallTrials = [
      { name: 'Rasmussen', effect: 0.23, lo: 0.05, hi: 1.01 },
      { name: 'Smith', effect: 0.31, lo: 0.09, hi: 1.10 },
      { name: 'Ceremuzynski', effect: 0.48, lo: 0.17, hi: 1.34 },
      { name: 'Schechter 1', effect: 0.52, lo: 0.20, hi: 1.35 },
      { name: 'Schechter 2', effect: 0.35, lo: 0.13, hi: 0.94 },
    ];
    const magPooledSmall = { effect: 0.44, lo: 0.27, hi: 0.71 };
    const isis4Result = { effect: 1.06, lo: 0.99, hi: 1.13 };

    // Complete magnesium trial data with sample sizes for visualization
    const magnesiumTrialsComplete = [
      { name: 'Morton 1984', n: 40, effect: 0.10, lo: 0.01, hi: 0.87, se: 0.55 },
      { name: 'Rasmussen 1986', n: 273, effect: 0.35, lo: 0.13, hi: 0.94, se: 0.25 },
      { name: 'Smith 1986', n: 400, effect: 0.48, lo: 0.21, hi: 1.09, se: 0.21 },
      { name: 'Abraham 1987', n: 94, effect: 0.87, lo: 0.33, hi: 2.30, se: 0.35 },
      { name: 'Shechter 1990', n: 103, effect: 0.27, lo: 0.08, hi: 0.95, se: 0.42 },
      { name: 'Ceremuzynski 1989', n: 48, effect: 0.22, lo: 0.03, hi: 1.50, se: 0.68 },
      { name: 'LIMIT-2', n: 2316, effect: 0.74, lo: 0.57, hi: 0.97, se: 0.09 },
    ];
    const isis4Complete = { name: 'ISIS-4', n: 58050, effect: 1.06, lo: 0.99, hi: 1.13, se: 0.025 };

    function drawMagnesiumForest(mode) {
      const containerId = mode === 'small' ? 'magnesium-forest-small' : 'magnesium-forest-full';
      const container = document.getElementById(containerId);
      if (!container) return;

      let trials = [...magnesiumTrialsComplete];
      let pooled = { effect: 0.44, lo: 0.27, hi: 0.71, label: 'Pooled (small trials)' };

      if (mode === 'full') {
        trials.push(isis4Complete);
        pooled = { effect: 1.02, lo: 0.95, hi: 1.09, label: 'Pooled (all trials)' };
      }

      const width = 800;
      const height = trials.length * 35 + 100;
      const margin = { left: 150, right: 50, top: 30, bottom: 50 };
      const plotWidth = width - margin.left - margin.right;

      // Log scale for OR
      const minLog = Math.log(0.05);
      const maxLog = Math.log(3);
      const xScale = (logVal) => margin.left + ((logVal - minLog) / (maxLog - minLog)) * plotWidth;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="max-width: 100%; height: auto;">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Forest Plot: Magnesium in MI${mode === 'full' ? ' (with ISIS-4)' : ' (small trials only)'}
      </text>`;

      // Grid lines and axis
      const ticks = [0.1, 0.25, 0.5, 1.0, 2.0];
      ticks.forEach(tick => {
        const x = xScale(Math.log(tick));
        svg += `<line x1="${x}" y1="${margin.top}" x2="${x}" y2="${height - margin.bottom}" stroke="#e2e8f0" stroke-width="1"/>`;
        svg += `<text x="${x}" y="${height - margin.bottom + 15}" text-anchor="middle" font-size="11" fill="#64748b">${tick}</text>`;
      });

      // Null line
      const nullX = xScale(0);
      svg += `<line x1="${nullX}" y1="${margin.top}" x2="${nullX}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="2"/>`;

      // Studies
      trials.forEach((trial, i) => {
        const y = margin.top + 20 + i * 35;
        const x = xScale(Math.log(trial.effect));
        const xLo = xScale(Math.log(Math.max(0.05, trial.lo)));
        const xHi = xScale(Math.log(Math.min(3, trial.hi)));

        // Weight based on sample size
        const weight = Math.sqrt(trial.n) / Math.sqrt(isis4Complete.n) * 10;
        const boxSize = Math.max(4, Math.min(12, weight + 4));

        const color = trial.name === 'ISIS-4' ? '#C53030' : (trial.effect < 1 ? '#22c55e' : '#64748b');

        // Label
        svg += `<text x="${margin.left - 10}" y="${y + 4}" text-anchor="end" font-size="11" fill="#1a365d">${trial.name} (n=${trial.n.toLocaleString()})</text>`;

        // CI line
        svg += `<line x1="${xLo}" y1="${y}" x2="${xHi}" y2="${y}" stroke="${color}" stroke-width="2"/>`;

        // Effect point
        svg += `<rect x="${x - boxSize/2}" y="${y - boxSize/2}" width="${boxSize}" height="${boxSize}" fill="${color}"/>`;

        // CI caps
        svg += `<line x1="${xLo}" y1="${y - 4}" x2="${xLo}" y2="${y + 4}" stroke="${color}" stroke-width="1"/>`;
        svg += `<line x1="${xHi}" y1="${y - 4}" x2="${xHi}" y2="${y + 4}" stroke="${color}" stroke-width="1"/>`;
      });

      // Pooled diamond
      const poolY = height - margin.bottom - 20;
      const poolX = xScale(Math.log(pooled.effect));
      const poolXLo = xScale(Math.log(pooled.lo));
      const poolXHi = xScale(Math.log(pooled.hi));
      const diamondColor = pooled.effect < 1 ? '#22c55e' : '#C53030';

      svg += `<polygon points="${poolXLo},${poolY} ${poolX},${poolY - 8} ${poolXHi},${poolY} ${poolX},${poolY + 8}" fill="${diamondColor}" stroke="${diamondColor}"/>`;
      svg += `<text x="${margin.left - 10}" y="${poolY + 4}" text-anchor="end" font-size="11" font-weight="bold" fill="#1a365d">${pooled.label}</text>`;

      // Axis label
      svg += `<text x="${width/2}" y="${height - 5}" text-anchor="middle" font-size="12" fill="#1a365d">Odds Ratio (log scale)</text>`;

      // Favors labels
      svg += `<text x="${xScale(Math.log(0.2))}" y="${height - margin.bottom + 30}" text-anchor="middle" font-size="10" fill="#22c55e"> Favors Magnesium</text>`;
      svg += `<text x="${xScale(Math.log(2))}" y="${height - margin.bottom + 30}" text-anchor="middle" font-size="10" fill="#C53030">Favors Placebo </text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    function drawMagnesiumFunnel(mode) {
      const container = document.getElementById('magnesium-funnel-small');
      if (!container) return;

      const trials = magnesiumTrialsComplete;
      const width = 600;
      const height = 400;
      const margin = { left: 80, right: 40, top: 40, bottom: 60 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Pooled effect (log scale)
      const pooledLog = Math.log(0.44);

      // X axis: log(OR)
      const minLogOR = -2.5;
      const maxLogOR = 1;
      const xScale = (logOR) => margin.left + ((logOR - minLogOR) / (maxLogOR - minLogOR)) * plotWidth;

      // Y axis: SE (inverted - high precision at top)
      const maxSE = 0.75;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="max-width: 100%; height: auto;">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Funnel Plot: Magnesium in MI (small trials)
      </text>`;

      // Funnel shape (95% CI bounds)
      const funnelPoints = [];
      for (let se = 0; se <= maxSE; se += 0.01) {
        const ciWidth = 1.96 * se;
        const xLeft = xScale(pooledLog - ciWidth);
        const xRight = xScale(pooledLog + ciWidth);
        const y = yScale(se);
        funnelPoints.push({ xLeft, xRight, y });
      }

      // Draw funnel
      let leftPath = `M ${xScale(pooledLog)} ${yScale(0)}`;
      let rightPath = `M ${xScale(pooledLog)} ${yScale(0)}`;
      funnelPoints.forEach(p => {
        leftPath += ` L ${p.xLeft} ${p.y}`;
        rightPath += ` L ${p.xRight} ${p.y}`;
      });
      svg += `<path d="${leftPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;
      svg += `<path d="${rightPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;

      // Vertical line at pooled effect
      svg += `<line x1="${xScale(pooledLog)}" y1="${margin.top}" x2="${xScale(pooledLog)}" y2="${height - margin.bottom}" stroke="#22c55e" stroke-width="2" stroke-dasharray="4"/>`;

      // Null line at OR = 1
      svg += `<line x1="${xScale(0)}" y1="${margin.top}" x2="${xScale(0)}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="2"/>`;

      // Plot studies
      trials.forEach(trial => {
        const x = xScale(Math.log(trial.effect));
        const y = yScale(trial.se);
        const color = trial.effect < 1 ? '#22c55e' : '#64748b';
        svg += `<circle cx="${x}" cy="${y}" r="6" fill="${color}" stroke="#fff" stroke-width="1"/>`;
        svg += `<text x="${x + 8}" y="${y + 3}" font-size="9" fill="#1a365d">${trial.name}</text>`;
      });

      // Axes
      svg += `<line x1="${margin.left}" y1="${height - margin.bottom}" x2="${width - margin.right}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;
      svg += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;

      // X axis ticks
      [-2, -1, 0, 0.5].forEach(logOR => {
        const x = xScale(logOR);
        const or = Math.exp(logOR).toFixed(2);
        svg += `<line x1="${x}" y1="${height - margin.bottom}" x2="${x}" y2="${height - margin.bottom + 5}" stroke="#1a365d"/>`;
        svg += `<text x="${x}" y="${height - margin.bottom + 18}" text-anchor="middle" font-size="10" fill="#1a365d">${or}</text>`;
      });

      // Y axis ticks
      [0, 0.25, 0.5, 0.75].forEach(se => {
        const y = yScale(se);
        svg += `<line x1="${margin.left - 5}" y1="${y}" x2="${margin.left}" y2="${y}" stroke="#1a365d"/>`;
        svg += `<text x="${margin.left - 10}" y="${y + 3}" text-anchor="end" font-size="10" fill="#1a365d">${se.toFixed(2)}</text>`;
      });

      // Axis labels
      svg += `<text x="${width/2}" y="${height - 10}" text-anchor="middle" font-size="12" fill="#1a365d">Odds Ratio</text>`;
      svg += `<text x="15" y="${height/2}" text-anchor="middle" transform="rotate(-90, 15, ${height/2})" font-size="12" fill="#1a365d">Standard Error</text>`;

      // Annotations
      svg += `<text x="${xScale(-1.5)}" y="${height - margin.bottom + 40}" text-anchor="middle" font-size="10" fill="#f59e0b" font-weight="bold">
         Asymmetric: Small trials cluster left
      </text>`;

      svg += '</svg>';
      container.innerHTML = svg;

      // Show interpretation
      document.getElementById('mag-funnel-interpretation').style.display = 'block';
    }

    // Reboxetine funnel plot data (published trials only - showing bias)
    function drawReboxetineFunnel() {
      const container = document.getElementById('reboxetine-funnel');
      if (!container) return;

      // Published trials (all showing benefit - biased)
      const publishedTrials = [
        { name: 'Trial 1', smd: 0.72, se: 0.18 },
        { name: 'Trial 2', smd: 0.58, se: 0.22 },
        { name: 'Trial 3', smd: 0.45, se: 0.20 },
        { name: 'Trial 4', smd: 0.61, se: 0.25 },
        { name: 'Trial 5', smd: 0.52, se: 0.19 },
        { name: 'Trial 6', smd: 0.68, se: 0.28 },
        { name: 'Trial 7', smd: 0.41, se: 0.16 },
      ];

      // Where the missing trials likely were (shown as ghost points)
      const missingTrials = [
        { name: 'Hidden 1', smd: -0.12, se: 0.22 },
        { name: 'Hidden 2', smd: 0.05, se: 0.19 },
        { name: 'Hidden 3', smd: -0.08, se: 0.25 },
        { name: 'Hidden 4', smd: 0.11, se: 0.20 },
        { name: 'Hidden 5', smd: -0.15, se: 0.28 },
      ];

      const width = 600;
      const height = 400;
      const margin = { left: 80, right: 40, top: 40, bottom: 60 };
      const plotWidth = width - margin.left - margin.right;
      const plotHeight = height - margin.top - margin.bottom;

      // Pooled effect (published)
      const pooledSMD = 0.56;

      // X axis: SMD
      const minSMD = -0.5;
      const maxSMD = 1.0;
      const xScale = (smd) => margin.left + ((smd - minSMD) / (maxSMD - minSMD)) * plotWidth;

      // Y axis: SE (inverted)
      const maxSE = 0.35;
      const yScale = (se) => margin.top + (se / maxSE) * plotHeight;

      let svg = `<svg viewBox="0 0 ${width} ${height}" style="max-width: 100%; height: auto;">`;

      // Title
      svg += `<text x="${width/2}" y="20" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1a365d">
        Funnel Plot: Reboxetine vs Placebo (Published Only)
      </text>`;

      // Funnel shape
      const funnelPoints = [];
      for (let se = 0.01; se <= maxSE; se += 0.01) {
        const ciWidth = 1.96 * se;
        const xLeft = xScale(pooledSMD - ciWidth);
        const xRight = xScale(pooledSMD + ciWidth);
        const y = yScale(se);
        funnelPoints.push({ xLeft, xRight, y });
      }

      let leftPath = `M ${xScale(pooledSMD)} ${yScale(0.01)}`;
      let rightPath = `M ${xScale(pooledSMD)} ${yScale(0.01)}`;
      funnelPoints.forEach(p => {
        leftPath += ` L ${p.xLeft} ${p.y}`;
        rightPath += ` L ${p.xRight} ${p.y}`;
      });
      svg += `<path d="${leftPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;
      svg += `<path d="${rightPath}" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="4"/>`;

      // Pooled effect line
      svg += `<line x1="${xScale(pooledSMD)}" y1="${margin.top}" x2="${xScale(pooledSMD)}" y2="${height - margin.bottom}" stroke="#22c55e" stroke-width="2" stroke-dasharray="4"/>`;

      // Null line at SMD = 0
      svg += `<line x1="${xScale(0)}" y1="${margin.top}" x2="${xScale(0)}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="2"/>`;

      // Plot missing trials (ghost points)
      missingTrials.forEach(trial => {
        const x = xScale(trial.smd);
        const y = yScale(trial.se);
        svg += `<circle cx="${x}" cy="${y}" r="8" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="3"/>`;
      });

      // Plot published trials
      publishedTrials.forEach(trial => {
        const x = xScale(trial.smd);
        const y = yScale(trial.se);
        svg += `<circle cx="${x}" cy="${y}" r="6" fill="#22c55e" stroke="#fff" stroke-width="1"/>`;
      });

      // Axes
      svg += `<line x1="${margin.left}" y1="${height - margin.bottom}" x2="${width - margin.right}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;
      svg += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${height - margin.bottom}" stroke="#1a365d" stroke-width="1"/>`;

      // X axis ticks
      [-0.4, -0.2, 0, 0.2, 0.4, 0.6, 0.8].forEach(smd => {
        const x = xScale(smd);
        svg += `<line x1="${x}" y1="${height - margin.bottom}" x2="${x}" y2="${height - margin.bottom + 5}" stroke="#1a365d"/>`;
        svg += `<text x="${x}" y="${height - margin.bottom + 18}" text-anchor="middle" font-size="10" fill="#1a365d">${smd.toFixed(1)}</text>`;
      });

      // Y axis ticks
      [0.05, 0.15, 0.25, 0.35].forEach(se => {
        const y = yScale(se);
        svg += `<line x1="${margin.left - 5}" y1="${y}" x2="${margin.left}" y2="${y}" stroke="#1a365d"/>`;
        svg += `<text x="${margin.left - 10}" y="${y + 3}" text-anchor="end" font-size="10" fill="#1a365d">${se.toFixed(2)}</text>`;
      });

      // Axis labels
      svg += `<text x="${width/2}" y="${height - 10}" text-anchor="middle" font-size="12" fill="#1a365d">Standardized Mean Difference</text>`;
      svg += `<text x="15" y="${height/2}" text-anchor="middle" transform="rotate(-90, 15, ${height/2})" font-size="12" fill="#1a365d">Standard Error</text>`;

      // Legend
      svg += `<circle cx="${width - 120}" cy="${margin.top + 10}" r="5" fill="#22c55e"/>`;
      svg += `<text x="${width - 110}" y="${margin.top + 14}" font-size="10" fill="#1a365d">Published</text>`;
      svg += `<circle cx="${width - 120}" cy="${margin.top + 28}" r="6" fill="none" stroke="#C53030" stroke-width="2" stroke-dasharray="3"/>`;
      svg += `<text x="${width - 110}" y="${margin.top + 32}" font-size="10" fill="#C53030">Missing?</text>`;

      svg += '</svg>';
      container.innerHTML = svg;
    }

    // ============================================================
    // ACCESSIBILITY & UI HELPERS
    // ============================================================

    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('open');
      var btn = document.querySelector('.sidebar-toggle, .hamburger, .mobile-menu-btn'); if (btn) btn.setAttribute('aria-expanded', btn.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
    }

    function toggleGlossary() {
      const panel = document.getElementById('glossaryPanel');
      panel.classList.toggle('open');
      if (panel.classList.contains('open')) {
        document.getElementById('glossarySearch').focus();
      }
    }

    function filterGlossary() {
      const query = document.getElementById('glossarySearch').value.toLowerCase();
      const terms = document.querySelectorAll('.glossary-term');
      terms.forEach(term => {
        const text = term.textContent.toLowerCase();
        term.style.display = text.includes(query) ? 'block' : 'none';
      });
    }

    function toggleKeyboardHelp() {
      const help = document.getElementById('keyboardHelp');
      help.classList.toggle('open');
    }

    // Enhanced keyboard navigation
    document.addEventListener('keydown', (e) => {
      // Don't trigger shortcuts when typing in inputs
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
        if (e.key === 'Escape') {
          e.target.blur();
        }
        return;
      }

      switch(e.key) {
        case 'ArrowRight':
        case ' ':
          if (!e.shiftKey) {
            e.preventDefault();
            nextSlide();
          }
          break;
        case 'ArrowLeft':
        case 'Backspace':
          e.preventDefault();
          prevSlide();
          break;
        case 'ArrowDown':
        case 'n':
        case 'N':
          if (currentModule < modules.length - 1) {
            e.preventDefault();
            goToModule(currentModule + 1);
          }
          break;
        case 'ArrowUp':
        case 'p':
        case 'P':
          if (currentModule > 0) {
            e.preventDefault();
            goToModule(currentModule - 1);
          }
          break;
        case 't':
        case 'T':
          e.preventDefault();
          toggleToolsPanel();
          break;
        case 'g':
        case 'G':
          e.preventDefault();
          toggleGlossary();
          break;
        case '?':
          e.preventDefault();
          toggleKeyboardHelp();
          break;
        case 'Escape':
          document.getElementById('glossaryPanel').classList.remove('open');
          document.getElementById('keyboardHelp').classList.remove('open');
          document.querySelector('.sidebar').classList.remove('open');
          document.getElementById('sidebarOverlay').classList.remove('open');
          break;
      }
    });

    // ============================================================
    // QUIZ SYSTEM
    // ============================================================

    function checkQuizAnswer(questionId, selectedIdx, correctIdx, explanations) {
      const options = document.querySelectorAll(`#${questionId} .quiz-option`);
      options.forEach((opt, i) => {
        opt.classList.remove('selected');
        opt.onclick = null; // Disable further clicks
        if (i === correctIdx) {
          opt.classList.add('correct');
        } else if (i === selectedIdx && selectedIdx !== correctIdx) {
          opt.classList.add('incorrect');
        }
      });

      // Show explanation
      const feedbackEl = document.getElementById(`${questionId}-feedback`);
      if (feedbackEl) {
        const isCorrect = selectedIdx === correctIdx;
        feedbackEl.style.display = 'block';
        feedbackEl.innerHTML = `
          <div style="padding: 0.75rem; margin-top: 0.5rem; border-radius: 6px; background: ${isCorrect ? 'rgba(34,197,94,0.1)' : 'rgba(197,48,48,0.1)'}; border-left: 3px solid ${isCorrect ? 'var(--green)' : 'var(--red)'};">
            <strong>${isCorrect ? 'Correct!' : 'Not quite.'}</strong> ${explanations[correctIdx]}
          </div>
        `;
      }
    }

    // ============================================================
    // INITIALIZE
    // ============================================================

    document.addEventListener('DOMContentLoaded', () => {
      initModuleList();

      // Restore saved tier
      try {
        const savedTier = localStorage.getItem('synthesis_course_tier');
        if (savedTier && ['foundation','researcher','methodologist'].includes(savedTier)) {
          setTier(savedTier);
        }
      } catch(e) {}

      // Load saved progress
      const savedProgress = loadProgress();
      if (savedProgress) {
        goToModule(savedProgress.module);
        if (savedProgress.slide > 0) {
          setTimeout(() => goToSlide(savedProgress.slide), 100);
        }
      } else {
        goToModule(0);
      }

      // Initialize spaced repetition
      initSpacedRepetition();
      updateReviewButtonStatus();

      // Check for daily review badge
      if (spacedRepetitionState.dailyReviewsCompleted >= 7) {
        earnBadge('daily_dedication');
      }

      // Show daily review prompt if due (with slight delay for UX)
      if (shouldShowDailyReview()) {
        setTimeout(() => {
          // Only auto-prompt if they've completed at least one module
          const completedModules = document.querySelectorAll('.module-item.completed').length;
          if (completedModules >= 1) {
            openDailyReview();
          }
        }, 2000);
      }

      // Auto-save on navigation
      const originalGoToModule = goToModule;
      goToModule = function(moduleId) {
        // Mark previous module as complete if we're progressing
        if (moduleId > currentModule) {
          markModuleComplete(currentModule);
        }
        originalGoToModule(moduleId);
        saveProgress();
      };

      const originalGoToSlide = goToSlide;
      goToSlide = function(index) {
        originalGoToSlide(index);
        saveProgress();
      };
    });
  </script>
</body>
</html>
